/*! For license information please see nunu.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Nunu=e():t.Nunu=e()}(self,(()=>(()=>{var __webpack_modules__={872:(t,e,n)=>{"use strict";n(590).Decoder,n(435).Encoder,n(806).ProgressivePair;var r=n(808);e.fG=r.StaticPair},590:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(546),i=n(285);e.Decoder=class{constructor(t=[],e,n={}){this.dict=t,this.progressive=e,this.options=n}decode(t){t instanceof r||(t=r.wrap(t));const e=t.littleEndian;try{const n=this.decodeValue(t.LE());return t.littleEndian=e,n}catch(n){throw t.littleEndian=e,n}}decodeValue(t){let e=t.readUint8();if(e<=i.MAX)return r.zigZagDecode32(e);switch(e){case i.NULL:return null;case i.TRUE:return!0;case i.FALSE:return!1;case i.EOBJECT:return{};case i.EARRAY:return[];case i.ESTRING:return"";case i.OBJECT:e=t.readVarint32();const n={};for(;--e>=0;)n[this.decodeValue(t)]=this.decodeValue(t);return n;case i.ARRAY:e=t.readVarint32();const r=[];for(;--e>=0;)r.push(this.decodeValue(t));return r;case i.INTEGER:return t.readVarint32ZigZag();case i.LONG:const s=t.readVarint64ZigZag();return s.lessThanOrEqual(Number.MAX_SAFE_INTEGER)&&s.greaterThanOrEqual(Number.MIN_SAFE_INTEGER)?s.toNumber():s;case i.FLOAT:return t.readFloat32();case i.DOUBLE:return t.readFloat64();case i.STRING:return t.readVString();case i.STRING_ADD:const o=t.readVString();return this.dict.push(o),o;case i.STRING_GET:return this.dict[t.readVarint32()];case i.BINARY:e=t.readVarint32();const a=t.slice(t.offset,t.offset+e);return t.offset+=e,a;default:throw new Error(`Illegal type at ${t.offset}: ${e}`)}}}},435:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(546),i=n(285),s=n(734),o=new r(4);o.compact(0,4),e.Encoder=class{constructor(t=[],e,n){if(this.progressive=e,this.dict=new Map,this.next=0,t)for(;this.next<t.length;)this.dict.set(t[this.next],this.next++)}encode(t,e){let n=!1;e||(e=new r,n=!0);const i=e.littleEndian;try{return this.encodeValue(t,e.LE()),e.littleEndian=i,n?e.flip():e}catch(t){throw e.littleEndian=i,t}}encodeValue(t,e){if(null!==t)switch(typeof t){case"function":t=t.toString();case"string":0===t.length?e.writeUint8(i.ESTRING):this.dict.has(t)?(e.writeUint8(i.STRING_GET),e.writeVarint32(this.dict.get(t))):(e.writeUint8(i.STRING),e.writeVString(t));break;case"number":if(t%1==0)if(t<=2147483647&&t>=-2147483648){const n=r.zigZagEncode32(t);n<=i.MAX?e.writeUint8(n):(e.writeUint8(i.INTEGER),e.writeVarint32ZigZag(t))}else e.writeUint8(i.LONG),e.writeVarint64ZigZag(t);else o.writeFloat32(t,0),t===o.readFloat32(0)?(e.writeUint8(i.FLOAT),e.writeFloat32(t)):(e.writeUint8(i.DOUBLE),e.writeFloat64(t));break;case"boolean":e.writeUint8(t?i.TRUE:i.FALSE);break;case"object":let n;if(Array.isArray(t))if(0===t.length)e.writeUint8(i.EARRAY);else for(e.writeUint8(i.ARRAY),e.writeVarint32(t.length),n=0;n<t.length;n++)this.encodeValue(t[n],e);else if(t instanceof s)e.writeUint8(i.LONG),e.writeVarint64ZigZag(t);else if(t instanceof Buffer||t instanceof ArrayBuffer||t instanceof Uint8Array||t instanceof r)t=r.wrap(t),e.writeUint8(i.BINARY),e.writeVarint32(t.remaining()),e.append(t);else{const r=Object.keys(t);let s=0;for(n=0;n<r.length;n++)void 0!==t[r[n]]&&s++;if(0===s)e.writeUint8(i.EOBJECT);else for(e.writeUint8(i.OBJECT),e.writeVarint32(s),n=0;n<r.length;n++){const s=r[n];void 0!==t[s]&&(this.dict.has(s)?(e.writeUint8(i.STRING_GET),e.writeVarint32(this.dict.get(s))):(this.progressive?(this.dict.set(s,this.next++),e.writeUint8(i.STRING_ADD)):e.writeUint8(i.STRING),e.writeVString(s)),this.encodeValue(t[s],e))}}break;case"undefined":e.writeUint8(i.NULL)}else e.writeUint8(i.NULL)}}},606:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Pair=class{encode(t){return this.encoder.encode(t)}toArrayBuffer(t){return this.encoder.encode(t).toArrayBuffer()}toBuffer(t){return this.encoder.encode(t).toBuffer()}decode(t){return this.decoder.decode(t)}}},806:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(606),i=n(435),s=n(590);class o extends r.Pair{constructor(t,e){super(),this.encoder=new i.Encoder(t,!0,e),this.decoder=new s.Decoder(t,!0,e)}}e.ProgressivePair=o},808:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(606),i=n(435),s=n(590);class o extends r.Pair{constructor(t,e){super(),this.encoder=new i.Encoder(t,!1,e),this.decoder=new s.Decoder(t,!1,e)}}e.StaticPair=o},285:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ZERO=0,e.MAX=239,e.NULL=240,e.TRUE=241,e.FALSE=242,e.EOBJECT=243,e.EARRAY=244,e.ESTRING=245,e.OBJECT=246,e.ARRAY=247,e.INTEGER=248,e.LONG=249,e.FLOAT=250,e.DOUBLE=251,e.STRING=252,e.STRING_ADD=253,e.STRING_GET=254,e.BINARY=255},175:(t,e,n)=>{"use strict";n.r(e),n.d(e,{ACESFilmicToneMapping:()=>nt,AddEquation:()=>T,AddOperation:()=>Z,AdditiveAnimationBlendMode:()=>We,AdditiveBlending:()=>x,AlphaFormat:()=>Ot,AlwaysDepth:()=>j,AlwaysStencilFunc:()=>Mn,AmbientLight:()=>sp,AmbientLightProbe:()=>Ep,AnimationClip:()=>Ah,AnimationLoader:()=>Ih,AnimationMixer:()=>id,AnimationObjectGroup:()=>nd,AnimationUtils:()=>fh,ArcCurve:()=>Jc,ArrayCamera:()=>bl,ArrowHelper:()=>Xd,Audio:()=>Fp,AudioAnalyser:()=>Gp,AudioContext:()=>Sp,AudioListener:()=>Op,AudioLoader:()=>Mp,AxesHelper:()=>Yd,AxisHelper:()=>Mf,BackSide:()=>m,BasicDepthPacking:()=>sn,BasicShadowMap:()=>u,BinaryTextureLoader:()=>Cf,Bone:()=>sc,BooleanKeyframeTrack:()=>bh,BoundingBoxHelper:()=>Tf,Box2:()=>fd,Box3:()=>ur,Box3Helper:()=>Gd,BoxBufferGeometry:()=>bs,BoxGeometry:()=>bs,BoxHelper:()=>jd,BufferAttribute:()=>Ni,BufferGeometry:()=>ts,BufferGeometryLoader:()=>pp,ByteType:()=>Tt,Cache:()=>Ch,Camera:()=>Ts,CameraHelper:()=>Dd,CanvasRenderer:()=>Lf,CanvasTexture:()=>Oc,CatmullRomCurve3:()=>nu,CineonToneMapping:()=>et,CircleBufferGeometry:()=>kc,CircleGeometry:()=>kc,ClampToEdgeWrapping:()=>pt,Clock:()=>Bp,Color:()=>Ci,ColorKeyframeTrack:()=>xh,CompressedTexture:()=>Ic,CompressedTextureLoader:()=>Oh,ConeBufferGeometry:()=>Uc,ConeGeometry:()=>Uc,CubeCamera:()=>$s,CubeReflectionMapping:()=>st,CubeRefractionMapping:()=>ot,CubeTexture:()=>Cs,CubeTextureLoader:()=>kh,CubeUVReflectionMapping:()=>ct,CubeUVRefractionMapping:()=>ut,CubicBezierCurve:()=>ou,CubicBezierCurve3:()=>au,CubicInterpolant:()=>_h,CullFaceBack:()=>a,CullFaceFront:()=>l,CullFaceFrontBack:()=>c,CullFaceNone:()=>o,Curve:()=>Xc,CurvePath:()=>zh,CustomBlending:()=>M,CustomToneMapping:()=>rt,CylinderBufferGeometry:()=>Dc,CylinderGeometry:()=>Dc,Cylindrical:()=>pd,DataTexture:()=>oc,DataTexture2DArray:()=>Bo,DataTexture3D:()=>Lo,DataTextureLoader:()=>Dh,DataUtils:()=>Qd,DecrementStencilOp:()=>dn,DecrementWrapStencilOp:()=>mn,DefaultLoadingManager:()=>Lh,DepthFormat:()=>jt,DepthStencilFormat:()=>Gt,DepthTexture:()=>Fc,DirectionalLight:()=>ip,DirectionalLightHelper:()=>Od,DiscreteInterpolant:()=>yh,DodecahedronBufferGeometry:()=>jc,DodecahedronGeometry:()=>jc,DoubleSide:()=>_,DstAlphaFactor:()=>O,DstColorFactor:()=>k,DynamicBufferAttribute:()=>ff,DynamicCopyUsage:()=>Rn,DynamicDrawUsage:()=>En,DynamicReadUsage:()=>Cn,EdgesGeometry:()=>qc,EdgesHelper:()=>Ef,EllipseCurve:()=>Yc,EqualDepth:()=>V,EqualStencilFunc:()=>vn,EquirectangularReflectionMapping:()=>at,EquirectangularRefractionMapping:()=>lt,Euler:()=>Xr,EventDispatcher:()=>On,ExtrudeBufferGeometry:()=>zu,ExtrudeGeometry:()=>zu,FaceColors:()=>nf,FileLoader:()=>Ph,FlatShading:()=>g,Float16BufferAttribute:()=>zi,Float32Attribute:()=>wf,Float32BufferAttribute:()=>ji,Float64Attribute:()=>Sf,Float64BufferAttribute:()=>Gi,FloatType:()=>Bt,Fog:()=>Cl,FogExp2:()=>$l,Font:()=>vp,FontLoader:()=>xp,FrontSide:()=>f,Frustum:()=>Fs,GLBufferAttribute:()=>ad,GLSL1:()=>Pn,GLSL3:()=>In,GammaEncoding:()=>Qe,GreaterDepth:()=>q,GreaterEqualDepth:()=>W,GreaterEqualStencilFunc:()=>Sn,GreaterStencilFunc:()=>xn,GridHelper:()=>Ld,Group:()=>xl,HalfFloatType:()=>Lt,HemisphereLight:()=>Vh,HemisphereLightHelper:()=>Bd,HemisphereLightProbe:()=>Tp,IcosahedronBufferGeometry:()=>Gu,IcosahedronGeometry:()=>Gu,ImageBitmapLoader:()=>gp,ImageLoader:()=>Fh,ImageUtils:()=>Qn,ImmediateRenderObject:()=>yd,IncrementStencilOp:()=>pn,IncrementWrapStencilOp:()=>fn,InstancedBufferAttribute:()=>uc,InstancedBufferGeometry:()=>hp,InstancedInterleavedBuffer:()=>od,InstancedMesh:()=>mc,Int16Attribute:()=>yf,Int16BufferAttribute:()=>Fi,Int32Attribute:()=>bf,Int32BufferAttribute:()=>Di,Int8Attribute:()=>mf,Int8BufferAttribute:()=>Pi,IntType:()=>$t,InterleavedBuffer:()=>Ll,InterleavedBufferAttribute:()=>Nl,Interpolant:()=>mh,InterpolateDiscrete:()=>De,InterpolateLinear:()=>Ue,InterpolateSmooth:()=>ze,InvertStencilOp:()=>_n,JSONLoader:()=>Rf,KeepStencilOp:()=>un,KeyframeTrack:()=>vh,LOD:()=>Ql,LatheBufferGeometry:()=>Hu,LatheGeometry:()=>Hu,Layers:()=>Yr,LensFlare:()=>Pf,LessDepth:()=>G,LessEqualDepth:()=>H,LessEqualStencilFunc:()=>bn,LessStencilFunc:()=>yn,Light:()=>Hh,LightProbe:()=>lp,Line:()=>wc,Line3:()=>gd,LineBasicMaterial:()=>_c,LineCurve:()=>lu,LineCurve3:()=>cu,LineDashedMaterial:()=>ph,LineLoop:()=>Ec,LinePieces:()=>tf,LineSegments:()=>Tc,LineStrip:()=>Kd,LinearEncoding:()=>Je,LinearFilter:()=>vt,LinearInterpolant:()=>gh,LinearMipMapLinearFilter:()=>St,LinearMipMapNearestFilter:()=>xt,LinearMipmapLinearFilter:()=>wt,LinearMipmapNearestFilter:()=>bt,LinearToneMapping:()=>K,Loader:()=>Rh,LoaderUtils:()=>up,LoadingManager:()=>Bh,LogLuvEncoding:()=>tn,LoopOnce:()=>Oe,LoopPingPong:()=>ke,LoopRepeat:()=>Fe,LuminanceAlphaFormat:()=>Ut,LuminanceFormat:()=>Dt,MOUSE:()=>i,Material:()=>wi,MaterialLoader:()=>cp,Math:()=>Xn,MathUtils:()=>Xn,Matrix3:()=>Jn,Matrix4:()=>kr,MaxEquation:()=>C,Mesh:()=>ys,MeshBasicMaterial:()=>Bi,MeshDepthMaterial:()=>pl,MeshDistanceMaterial:()=>dl,MeshFaceMaterial:()=>sf,MeshLambertMaterial:()=>uh,MeshMatcapMaterial:()=>hh,MeshNormalMaterial:()=>ch,MeshPhongMaterial:()=>ah,MeshPhysicalMaterial:()=>oh,MeshStandardMaterial:()=>sh,MeshToonMaterial:()=>lh,MinEquation:()=>$,MirroredRepeatWrapping:()=>dt,MixOperation:()=>J,MultiMaterial:()=>of,MultiplyBlending:()=>S,MultiplyOperation:()=>Y,NearestFilter:()=>ft,NearestMipMapLinearFilter:()=>yt,NearestMipMapNearestFilter:()=>_t,NearestMipmapLinearFilter:()=>gt,NearestMipmapNearestFilter:()=>mt,NeverDepth:()=>z,NeverStencilFunc:()=>gn,NoBlending:()=>v,NoColors:()=>ef,NoToneMapping:()=>Q,NormalAnimationBlendMode:()=>Ve,NormalBlending:()=>b,NotEqualDepth:()=>X,NotEqualStencilFunc:()=>wn,NumberKeyframeTrack:()=>wh,Object3D:()=>ci,ObjectLoader:()=>dp,ObjectSpaceNormalMap:()=>ln,OctahedronBufferGeometry:()=>Vu,OctahedronGeometry:()=>Vu,OneFactor:()=>L,OneMinusDstAlphaFactor:()=>F,OneMinusDstColorFactor:()=>D,OneMinusSrcAlphaFactor:()=>I,OneMinusSrcColorFactor:()=>N,OrthographicCamera:()=>Js,PCFShadowMap:()=>h,PCFSoftShadowMap:()=>p,PMREMGenerator:()=>fo,ParametricBufferGeometry:()=>Wu,ParametricGeometry:()=>Wu,Particle:()=>lf,ParticleBasicMaterial:()=>hf,ParticleSystem:()=>cf,ParticleSystemMaterial:()=>pf,Path:()=>jh,PerspectiveCamera:()=>Es,Plane:()=>Ps,PlaneBufferGeometry:()=>Us,PlaneGeometry:()=>Us,PlaneHelper:()=>Hd,PointCloud:()=>af,PointCloudMaterial:()=>uf,PointLight:()=>np,PointLightHelper:()=>Ed,Points:()=>Rc,PointsMaterial:()=>Ac,PolarGridHelper:()=>Rd,PolyhedronBufferGeometry:()=>zc,PolyhedronGeometry:()=>zc,PositionalAudio:()=>jp,PropertyBinding:()=>ed,PropertyMixer:()=>Hp,QuadraticBezierCurve:()=>uu,QuadraticBezierCurve3:()=>hu,Quaternion:()=>or,QuaternionKeyframeTrack:()=>Mh,QuaternionLinearInterpolant:()=>Sh,REVISION:()=>r,RGBADepthPacking:()=>on,RGBAFormat:()=>kt,RGBAIntegerFormat:()=>Yt,RGBA_ASTC_10x10_Format:()=>ye,RGBA_ASTC_10x5_Format:()=>me,RGBA_ASTC_10x6_Format:()=>_e,RGBA_ASTC_10x8_Format:()=>ge,RGBA_ASTC_12x10_Format:()=>ve,RGBA_ASTC_12x12_Format:()=>be,RGBA_ASTC_4x4_Format:()=>ae,RGBA_ASTC_5x4_Format:()=>le,RGBA_ASTC_5x5_Format:()=>ce,RGBA_ASTC_6x5_Format:()=>ue,RGBA_ASTC_6x6_Format:()=>he,RGBA_ASTC_8x5_Format:()=>pe,RGBA_ASTC_8x6_Format:()=>de,RGBA_ASTC_8x8_Format:()=>fe,RGBA_BPTC_Format:()=>xe,RGBA_ETC2_EAC_Format:()=>oe,RGBA_PVRTC_2BPPV1_Format:()=>re,RGBA_PVRTC_4BPPV1_Format:()=>ne,RGBA_S3TC_DXT1_Format:()=>Zt,RGBA_S3TC_DXT3_Format:()=>Qt,RGBA_S3TC_DXT5_Format:()=>Kt,RGBDEncoding:()=>rn,RGBEEncoding:()=>Ke,RGBEFormat:()=>zt,RGBFormat:()=>Ft,RGBIntegerFormat:()=>Xt,RGBM16Encoding:()=>nn,RGBM7Encoding:()=>en,RGB_ETC1_Format:()=>ie,RGB_ETC2_Format:()=>se,RGB_PVRTC_2BPPV1_Format:()=>ee,RGB_PVRTC_4BPPV1_Format:()=>te,RGB_S3TC_DXT1_Format:()=>Jt,RGFormat:()=>Wt,RGIntegerFormat:()=>qt,RawShaderMaterial:()=>Zs,Ray:()=>Fr,Raycaster:()=>ld,RectAreaLight:()=>op,RedFormat:()=>Ht,RedIntegerFormat:()=>Vt,ReinhardToneMapping:()=>tt,RepeatWrapping:()=>ht,ReplaceStencilOp:()=>hn,ReverseSubtractEquation:()=>A,RingBufferGeometry:()=>qu,RingGeometry:()=>qu,SRGB8_ALPHA8_ASTC_10x10_Format:()=>Ne,SRGB8_ALPHA8_ASTC_10x5_Format:()=>Be,SRGB8_ALPHA8_ASTC_10x6_Format:()=>Le,SRGB8_ALPHA8_ASTC_10x8_Format:()=>Re,SRGB8_ALPHA8_ASTC_12x10_Format:()=>Pe,SRGB8_ALPHA8_ASTC_12x12_Format:()=>Ie,SRGB8_ALPHA8_ASTC_4x4_Format:()=>we,SRGB8_ALPHA8_ASTC_5x4_Format:()=>Se,SRGB8_ALPHA8_ASTC_5x5_Format:()=>Me,SRGB8_ALPHA8_ASTC_6x5_Format:()=>Te,SRGB8_ALPHA8_ASTC_6x6_Format:()=>Ee,SRGB8_ALPHA8_ASTC_8x5_Format:()=>Ae,SRGB8_ALPHA8_ASTC_8x6_Format:()=>$e,SRGB8_ALPHA8_ASTC_8x8_Format:()=>Ce,Scene:()=>Bl,SceneUtils:()=>Nf,ShaderChunk:()=>zs,ShaderLib:()=>Gs,ShaderMaterial:()=>Ms,ShadowMaterial:()=>ih,Shape:()=>Gh,ShapeBufferGeometry:()=>Xu,ShapeGeometry:()=>Xu,ShapePath:()=>yp,ShapeUtils:()=>ku,ShortType:()=>Et,Skeleton:()=>cc,SkeletonHelper:()=>Md,SkinnedMesh:()=>ic,SmoothShading:()=>y,Sphere:()=>Cr,SphereBufferGeometry:()=>Yu,SphereGeometry:()=>Yu,Spherical:()=>hd,SphericalHarmonics3:()=>ap,SplineCurve:()=>pu,SpotLight:()=>Zh,SpotLightHelper:()=>bd,Sprite:()=>Xl,SpriteMaterial:()=>Pl,SrcAlphaFactor:()=>P,SrcAlphaSaturateFactor:()=>U,SrcColorFactor:()=>R,StaticCopyUsage:()=>Ln,StaticDrawUsage:()=>Tn,StaticReadUsage:()=>$n,StereoCamera:()=>Cp,StreamCopyUsage:()=>Nn,StreamDrawUsage:()=>An,StreamReadUsage:()=>Bn,StringKeyframeTrack:()=>Th,SubtractEquation:()=>E,SubtractiveBlending:()=>w,TOUCH:()=>s,TangentSpaceNormalMap:()=>an,TetrahedronBufferGeometry:()=>Ju,TetrahedronGeometry:()=>Ju,TextBufferGeometry:()=>Zu,TextGeometry:()=>Zu,Texture:()=>tr,TextureLoader:()=>Uh,TorusBufferGeometry:()=>Qu,TorusGeometry:()=>Qu,TorusKnotBufferGeometry:()=>Ku,TorusKnotGeometry:()=>Ku,Triangle:()=>bi,TriangleFanDrawMode:()=>Ye,TriangleStripDrawMode:()=>Xe,TrianglesDrawMode:()=>qe,TubeBufferGeometry:()=>th,TubeGeometry:()=>th,UVMapping:()=>it,Uint16Attribute:()=>vf,Uint16BufferAttribute:()=>ki,Uint32Attribute:()=>xf,Uint32BufferAttribute:()=>Ui,Uint8Attribute:()=>_f,Uint8BufferAttribute:()=>Ii,Uint8ClampedAttribute:()=>gf,Uint8ClampedBufferAttribute:()=>Oi,Uniform:()=>sd,UniformsLib:()=>js,UniformsUtils:()=>Ss,UnsignedByteType:()=>Mt,UnsignedInt248Type:()=>It,UnsignedIntType:()=>Ct,UnsignedShort4444Type:()=>Rt,UnsignedShort5551Type:()=>Nt,UnsignedShort565Type:()=>Pt,UnsignedShortType:()=>At,VSMShadowMap:()=>d,Vector2:()=>Yn,Vector3:()=>ar,Vector4:()=>nr,VectorKeyframeTrack:()=>Eh,Vertex:()=>df,VertexColors:()=>rf,VideoTexture:()=>Pc,WebGL1Renderer:()=>Al,WebGLCubeRenderTarget:()=>Bs,WebGLMultipleRenderTargets:()=>ir,WebGLMultisampleRenderTarget:()=>sr,WebGLRenderTarget:()=>rr,WebGLRenderTargetCube:()=>Bf,WebGLRenderer:()=>El,WebGLUtils:()=>vl,WireframeGeometry:()=>eh,WireframeHelper:()=>Af,WrapAroundEnding:()=>He,XHRLoader:()=>$f,ZeroCurvatureEnding:()=>je,ZeroFactor:()=>B,ZeroSlopeEnding:()=>Ge,ZeroStencilOp:()=>cn,sRGBEncoding:()=>Ze});const r="132",i={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=0,a=1,l=2,c=3,u=0,h=1,p=2,d=3,f=0,m=1,_=2,g=1,y=2,v=0,b=1,x=2,w=3,S=4,M=5,T=100,E=101,A=102,$=103,C=104,B=200,L=201,R=202,N=203,P=204,I=205,O=206,F=207,k=208,D=209,U=210,z=0,j=1,G=2,H=3,V=4,W=5,q=6,X=7,Y=0,J=1,Z=2,Q=0,K=1,tt=2,et=3,nt=4,rt=5,it=300,st=301,ot=302,at=303,lt=304,ct=306,ut=307,ht=1e3,pt=1001,dt=1002,ft=1003,mt=1004,_t=1004,gt=1005,yt=1005,vt=1006,bt=1007,xt=1007,wt=1008,St=1008,Mt=1009,Tt=1010,Et=1011,At=1012,$t=1013,Ct=1014,Bt=1015,Lt=1016,Rt=1017,Nt=1018,Pt=1019,It=1020,Ot=1021,Ft=1022,kt=1023,Dt=1024,Ut=1025,zt=kt,jt=1026,Gt=1027,Ht=1028,Vt=1029,Wt=1030,qt=1031,Xt=1032,Yt=1033,Jt=33776,Zt=33777,Qt=33778,Kt=33779,te=35840,ee=35841,ne=35842,re=35843,ie=36196,se=37492,oe=37496,ae=37808,le=37809,ce=37810,ue=37811,he=37812,pe=37813,de=37814,fe=37815,me=37816,_e=37817,ge=37818,ye=37819,ve=37820,be=37821,xe=36492,we=37840,Se=37841,Me=37842,Te=37843,Ee=37844,Ae=37845,$e=37846,Ce=37847,Be=37848,Le=37849,Re=37850,Ne=37851,Pe=37852,Ie=37853,Oe=2200,Fe=2201,ke=2202,De=2300,Ue=2301,ze=2302,je=2400,Ge=2401,He=2402,Ve=2500,We=2501,qe=0,Xe=1,Ye=2,Je=3e3,Ze=3001,Qe=3007,Ke=3002,tn=3003,en=3004,nn=3005,rn=3006,sn=3200,on=3201,an=0,ln=1,cn=0,un=7680,hn=7681,pn=7682,dn=7683,fn=34055,mn=34056,_n=5386,gn=512,yn=513,vn=514,bn=515,xn=516,wn=517,Sn=518,Mn=519,Tn=35044,En=35048,An=35040,$n=35045,Cn=35049,Bn=35041,Ln=35046,Rn=35050,Nn=35042,Pn="100",In="300 es";class On{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,r=n.length;e<r;e++)n[e].call(this,t);t.target=null}}}const Fn=[];for(let t=0;t<256;t++)Fn[t]=(t<16?"0":"")+t.toString(16);let kn=1234567;const Dn=Math.PI/180,Un=180/Math.PI;function zn(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Fn[255&t]+Fn[t>>8&255]+Fn[t>>16&255]+Fn[t>>24&255]+"-"+Fn[255&e]+Fn[e>>8&255]+"-"+Fn[e>>16&15|64]+Fn[e>>24&255]+"-"+Fn[63&n|128]+Fn[n>>8&255]+"-"+Fn[n>>16&255]+Fn[n>>24&255]+Fn[255&r]+Fn[r>>8&255]+Fn[r>>16&255]+Fn[r>>24&255]).toUpperCase()}function jn(t,e,n){return Math.max(e,Math.min(n,t))}function Gn(t,e){return(t%e+e)%e}function Hn(t,e,n){return(1-n)*t+n*e}function Vn(t){return 0==(t&t-1)&&0!==t}function Wn(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function qn(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var Xn=Object.freeze({__proto__:null,DEG2RAD:Dn,RAD2DEG:Un,generateUUID:zn,clamp:jn,euclideanModulo:Gn,mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:Hn,damp:function(t,e,n,r){return Hn(t,e,1-Math.exp(-n*r))},pingpong:function(t,e=1){return e-Math.abs(Gn(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(kn=t%2147483647),kn=16807*kn%2147483647,(kn-1)/2147483646},degToRad:function(t){return t*Dn},radToDeg:function(t){return t*Un},isPowerOfTwo:Vn,ceilPowerOfTwo:Wn,floorPowerOfTwo:qn,setQuaternionFromProperEuler:function(t,e,n,r,i){const s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),c=s((e+r)/2),u=o((e+r)/2),h=s((e-r)/2),p=o((e-r)/2),d=s((r-e)/2),f=o((r-e)/2);switch(i){case"XYX":t.set(a*u,l*h,l*p,a*c);break;case"YZY":t.set(l*p,a*u,l*h,a*c);break;case"ZXZ":t.set(l*h,l*p,a*u,a*c);break;case"XZX":t.set(a*u,l*f,l*d,a*c);break;case"YXY":t.set(l*d,a*u,l*f,a*c);break;case"ZYZ":t.set(l*f,l*d,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}});class Yn{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Yn.prototype.isVector2=!0;class Jn{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,s,o,a,l){const c=this.elements;return c[0]=t,c[1]=r,c[2]=o,c[3]=e,c[4]=i,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],p=n[5],d=n[8],f=r[0],m=r[3],_=r[6],g=r[1],y=r[4],v=r[7],b=r[2],x=r[5],w=r[8];return i[0]=s*f+o*g+a*b,i[3]=s*m+o*y+a*x,i[6]=s*_+o*v+a*w,i[1]=l*f+c*g+u*b,i[4]=l*m+c*y+u*x,i[7]=l*_+c*v+u*w,i[2]=h*f+p*g+d*b,i[5]=h*m+p*y+d*x,i[8]=h*_+p*v+d*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-n*i*c+n*o*a+r*i*l-r*s*a}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=c*s-o*l,h=o*a-c*i,p=l*i-s*a,d=e*u+n*h+r*p;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const f=1/d;return t[0]=u*f,t[1]=(r*l-c*n)*f,t[2]=(o*n-r*s)*f,t[3]=h*f,t[4]=(c*e-r*a)*f,t[5]=(r*i-o*e)*f,t[6]=p*f,t[7]=(n*a-l*e)*f,t[8]=(s*e-n*i)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,s,o){const a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-r*l,r*a,-r*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],s=r[3],o=r[6],a=r[1],l=r[4],c=r[7];return r[0]=e*i+n*a,r[3]=e*s+n*l,r[6]=e*o+n*c,r[1]=-n*i+e*a,r[4]=-n*s+e*l,r[7]=-n*o+e*c,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}let Zn;Jn.prototype.isMatrix3=!0;class Qn{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Zn&&(Zn=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Zn.width=t.width,Zn.height=t.height;const n=Zn.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Zn}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}}let Kn=0;class tr extends On{constructor(t=tr.DEFAULT_IMAGE,e=tr.DEFAULT_MAPPING,n=pt,r=pt,i=vt,s=wt,o=kt,a=Mt,l=1,c=Je){super(),Object.defineProperty(this,"id",{value:Kn++}),this.uuid=zn(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Yn(0,0),this.repeat=new Yn(1,1),this.center=new Yn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Jn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=zn()),!e&&void 0===t.images[r.uuid]){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(er(r[t].image)):e.push(er(r[t]))}else e=er(r);t.images[r.uuid]={uuid:r.uuid,url:e}}n.image=r.uuid}return e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==it)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case ht:t.x=t.x-Math.floor(t.x);break;case pt:t.x=t.x<0?0:1;break;case dt:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case ht:t.y=t.y-Math.floor(t.y);break;case pt:t.y=t.y<0?0:1;break;case dt:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&this.version++}}function er(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Qn.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}tr.DEFAULT_IMAGE=void 0,tr.DEFAULT_MAPPING=it,tr.prototype.isTexture=!0;class nr{constructor(t=0,e=0,n=0,r=1){this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*e+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*e+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*e+s[7]*n+s[11]*r+s[15]*i,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i;const s=.01,o=.1,a=t.elements,l=a[0],c=a[4],u=a[8],h=a[1],p=a[5],d=a[9],f=a[2],m=a[6],_=a[10];if(Math.abs(c-h)<s&&Math.abs(u-f)<s&&Math.abs(d-m)<s){if(Math.abs(c+h)<o&&Math.abs(u+f)<o&&Math.abs(d+m)<o&&Math.abs(l+p+_-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(p+1)/2,g=(_+1)/2,y=(c+h)/4,v=(u+f)/4,b=(d+m)/4;return t>a&&t>g?t<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=y/n,i=v/n):a>g?a<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=y/r,i=b/r):g<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(g),n=v/i,r=b/i),this.set(n,r,i,e),this}let g=Math.sqrt((m-d)*(m-d)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(g)<.001&&(g=1),this.x=(m-d)/g,this.y=(u-f)/g,this.z=(h-c)/g,this.w=Math.acos((l+p+_-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}nr.prototype.isVector4=!0;class rr extends On{constructor(t,e,n={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new nr(0,0,t,e),this.scissorTest=!1,this.viewport=new nr(0,0,t,e),this.texture=new tr(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:t,height:e,depth:1},this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:vt,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t}setSize(t,e,n=1){this.width===t&&this.height===e&&this.depth===n||(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}rr.prototype.isWebGLRenderTarget=!0;class ir extends rr{constructor(t,e,n){super(t,e);const r=this.texture;this.texture=[];for(let t=0;t<n;t++)this.texture[t]=r.clone()}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let r=0,i=this.texture.length;r<i;r++)this.texture[r].image.width=t,this.texture[r].image.height=e,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,n=t.texture.length;e<n;e++)this.texture[e]=t.texture[e].clone();return this}}ir.prototype.isWebGLMultipleRenderTargets=!0;class sr extends rr{constructor(t,e,n){super(t,e,n),this.samples=4}copy(t){return super.copy.call(this,t),this.samples=t.samples,this}}sr.prototype.isWebGLMultisampleRenderTarget=!0;class or{constructor(t=0,e=0,n=0,r=1){this._x=t,this._y=e,this._z=n,this._w=r}static slerp(t,e,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,r)}static slerpFlat(t,e,n,r,i,s,o){let a=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const h=i[s+0],p=i[s+1],d=i[s+2],f=i[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=c,void(t[e+3]=u);if(1===o)return t[e+0]=h,t[e+1]=p,t[e+2]=d,void(t[e+3]=f);if(u!==f||a!==h||l!==p||c!==d){let t=1-o;const e=a*h+l*p+c*d+u*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){const i=Math.sqrt(r),s=Math.atan2(i,e*n);t=Math.sin(t*s)/i,o=Math.sin(o*s)/i}const i=o*n;if(a=a*t+h*i,l=l*t+p*i,c=c*t+d*i,u=u*t+f*i,t===1-o){const t=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=t,l*=t,c*=t,u*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,r,i,s){const o=n[r],a=n[r+1],l=n[r+2],c=n[r+3],u=i[s],h=i[s+1],p=i[s+2],d=i[s+3];return t[e]=o*d+c*u+a*p-l*h,t[e+1]=a*d+c*h+l*u-o*p,t[e+2]=l*d+c*p+o*h-a*u,t[e+3]=c*d-o*u-a*h-l*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,r=t._y,i=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),h=a(n/2),p=a(r/2),d=a(i/2);switch(s){case"XYZ":this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d;break;case"YXZ":this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d;break;case"ZXY":this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d;break;case"ZYX":this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d;break;case"YZX":this._x=h*c*u+l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u-h*p*d;break;case"XZY":this._x=h*c*u-l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u+h*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],i=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],u=e[10],h=n+o+u;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(c-a)*t,this._y=(i-l)*t,this._z=(s-r)*t}else if(n>o&&n>u){const t=2*Math.sqrt(1+n-o-u);this._w=(c-a)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(i+l)/t}else if(o>u){const t=2*Math.sqrt(1+o-n-u);this._w=(i-l)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(a+c)/t}else{const t=2*Math.sqrt(1+u-n-o);this._w=(s-r)/t,this._x=(i+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(jn(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=n*c+s*o+r*l-i*a,this._y=r*c+s*a+i*o-n*l,this._z=i*c+s*l+n*a-r*o,this._w=s*c-n*o-r*a-i*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,r=this._y,i=this._z,s=this._w;let o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,n){this.copy(t).slerp(e,n)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}or.prototype.isQuaternion=!0;class ar{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(cr.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(cr.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*r-o*n,c=a*n+o*e-i*r,u=a*r+i*n-s*e,h=-i*e-s*n-o*r;return this.x=l*a+h*-i+c*-o-u*-s,this.y=c*a+h*-s+u*-i-l*-o,this.z=u*a+h*-o+l*-s-c*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return lr.copy(this).projectOnVector(t),this.sub(lr)}reflect(t){return this.sub(lr.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(jn(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}ar.prototype.isVector3=!0;const lr=new ar,cr=new or;class ur{constructor(t=new ar(1/0,1/0,1/0),e=new ar(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.length;a<l;a+=3){const l=t[a],c=t[a+1],u=t[a+2];l<e&&(e=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(e,n,r),this.max.set(i,s,o),this}setFromBufferAttribute(t){let e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.count;a<l;a++){const l=t.getX(a),c=t.getY(a),u=t.getZ(a);l<e&&(e=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(e,n,r),this.max.set(i,s,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=pr.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),dr.copy(e.boundingBox),dr.applyMatrix4(t.matrixWorld),this.union(dr));const n=t.children;for(let t=0,e=n.length;t<e;t++)this.expandByObject(n[t]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,pr),pr.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(br),xr.subVectors(this.max,br),fr.subVectors(t.a,br),mr.subVectors(t.b,br),_r.subVectors(t.c,br),gr.subVectors(mr,fr),yr.subVectors(_r,mr),vr.subVectors(fr,_r);let e=[0,-gr.z,gr.y,0,-yr.z,yr.y,0,-vr.z,vr.y,gr.z,0,-gr.x,yr.z,0,-yr.x,vr.z,0,-vr.x,-gr.y,gr.x,0,-yr.y,yr.x,0,-vr.y,vr.x,0];return!!Mr(e,fr,mr,_r,xr)&&(e=[1,0,0,0,1,0,0,0,1],!!Mr(e,fr,mr,_r,xr)&&(wr.crossVectors(gr,yr),e=[wr.x,wr.y,wr.z],Mr(e,fr,mr,_r,xr)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return pr.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(pr).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(hr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),hr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),hr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),hr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),hr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),hr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),hr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),hr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(hr)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}ur.prototype.isBox3=!0;const hr=[new ar,new ar,new ar,new ar,new ar,new ar,new ar,new ar],pr=new ar,dr=new ur,fr=new ar,mr=new ar,_r=new ar,gr=new ar,yr=new ar,vr=new ar,br=new ar,xr=new ar,wr=new ar,Sr=new ar;function Mr(t,e,n,r,i){for(let s=0,o=t.length-3;s<=o;s+=3){Sr.fromArray(t,s);const o=i.x*Math.abs(Sr.x)+i.y*Math.abs(Sr.y)+i.z*Math.abs(Sr.z),a=e.dot(Sr),l=n.dot(Sr),c=r.dot(Sr);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const Tr=new ur,Er=new ar,Ar=new ar,$r=new ar;class Cr{constructor(t=new ar,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):Tr.setFromPoints(t).getCenter(n);let r=0;for(let e=0,i=t.length;e<i;e++)r=Math.max(r,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){$r.subVectors(t,this.center);const e=$r.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.add($r.multiplyScalar(n/t)),this.radius+=n}return this}union(t){return Ar.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(Er.copy(t.center).add(Ar)),this.expandByPoint(Er.copy(t.center).sub(Ar)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Br=new ar,Lr=new ar,Rr=new ar,Nr=new ar,Pr=new ar,Ir=new ar,Or=new ar;class Fr{constructor(t=new ar,e=new ar(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Br)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Br.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Br.copy(this.direction).multiplyScalar(e).add(this.origin),Br.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){Lr.copy(t).add(e).multiplyScalar(.5),Rr.copy(e).sub(t).normalize(),Nr.copy(this.origin).sub(Lr);const i=.5*t.distanceTo(e),s=-this.direction.dot(Rr),o=Nr.dot(this.direction),a=-Nr.dot(Rr),l=Nr.lengthSq(),c=Math.abs(1-s*s);let u,h,p,d;if(c>0)if(u=s*a-o,h=s*o-a,d=i*c,u>=0)if(h>=-d)if(h<=d){const t=1/c;u*=t,h*=t,p=u*(u+s*h+2*o)+h*(s*u+h+2*a)+l}else h=i,u=Math.max(0,-(s*h+o)),p=-u*u+h*(h+2*a)+l;else h=-i,u=Math.max(0,-(s*h+o)),p=-u*u+h*(h+2*a)+l;else h<=-d?(u=Math.max(0,-(-s*i+o)),h=u>0?-i:Math.min(Math.max(-i,-a),i),p=-u*u+h*(h+2*a)+l):h<=d?(u=0,h=Math.min(Math.max(-i,-a),i),p=h*(h+2*a)+l):(u=Math.max(0,-(s*i+o)),h=u>0?i:Math.min(Math.max(-i,-a),i),p=-u*u+h*(h+2*a)+l);else h=s>0?-i:i,u=Math.max(0,-(s*h+o)),p=-u*u+h*(h+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(Rr).multiplyScalar(h).add(Lr),p}intersectSphere(t,e){Br.subVectors(t.center,this.origin);const n=Br.dot(this.direction),r=Br.dot(Br)-n*n,i=t.radius*t.radius;if(r>i)return null;const s=Math.sqrt(i-r),o=n-s,a=n+s;return o<0&&a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,i,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(t.min.x-h.x)*l,r=(t.max.x-h.x)*l):(n=(t.max.x-h.x)*l,r=(t.min.x-h.x)*l),c>=0?(i=(t.min.y-h.y)*c,s=(t.max.y-h.y)*c):(i=(t.max.y-h.y)*c,s=(t.min.y-h.y)*c),n>s||i>r?null:((i>n||n!=n)&&(n=i),(s<r||r!=r)&&(r=s),u>=0?(o=(t.min.z-h.z)*u,a=(t.max.z-h.z)*u):(o=(t.max.z-h.z)*u,a=(t.min.z-h.z)*u),n>a||o>r?null:((o>n||n!=n)&&(n=o),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,e)))}intersectsBox(t){return null!==this.intersectBox(t,Br)}intersectTriangle(t,e,n,r,i){Pr.subVectors(e,t),Ir.subVectors(n,t),Or.crossVectors(Pr,Ir);let s,o=this.direction.dot(Or);if(o>0){if(r)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Nr.subVectors(this.origin,t);const a=s*this.direction.dot(Ir.crossVectors(Nr,Ir));if(a<0)return null;const l=s*this.direction.dot(Pr.cross(Nr));if(l<0)return null;if(a+l>o)return null;const c=-s*Nr.dot(Or);return c<0?null:this.at(c/o,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class kr{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,s,o,a,l,c,u,h,p,d,f,m){const _=this.elements;return _[0]=t,_[4]=e,_[8]=n,_[12]=r,_[1]=i,_[5]=s,_[9]=o,_[13]=a,_[2]=l,_[6]=c,_[10]=u,_[14]=h,_[3]=p,_[7]=d,_[11]=f,_[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new kr).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/Dr.setFromMatrixColumn(t,0).length(),i=1/Dr.setFromMatrixColumn(t,1).length(),s=1/Dr.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,r=t.y,i=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){const t=s*c,n=s*u,r=o*c,i=o*u;e[0]=a*c,e[4]=-a*u,e[8]=l,e[1]=n+r*l,e[5]=t-i*l,e[9]=-o*a,e[2]=i-t*l,e[6]=r+n*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*c,n=a*u,r=l*c,i=l*u;e[0]=t+i*o,e[4]=r*o-n,e[8]=s*l,e[1]=s*u,e[5]=s*c,e[9]=-o,e[2]=n*o-r,e[6]=i+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*c,n=a*u,r=l*c,i=l*u;e[0]=t-i*o,e[4]=-s*u,e[8]=r+n*o,e[1]=n+r*o,e[5]=s*c,e[9]=i-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*c,n=s*u,r=o*c,i=o*u;e[0]=a*c,e[4]=r*l-n,e[8]=t*l+i,e[1]=a*u,e[5]=i*l+t,e[9]=n*l-r,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*c,e[4]=i-t*u,e[8]=r*u+n,e[1]=u,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=n*u+r,e[10]=t-i*u}else if("XZY"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*c,e[4]=-u,e[8]=l*c,e[1]=t*u+i,e[5]=s*c,e[9]=n*u-r,e[2]=r*u-n,e[6]=o*c,e[10]=i*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(zr,t,jr)}lookAt(t,e,n){const r=this.elements;return Vr.subVectors(t,e),0===Vr.lengthSq()&&(Vr.z=1),Vr.normalize(),Gr.crossVectors(n,Vr),0===Gr.lengthSq()&&(1===Math.abs(n.z)?Vr.x+=1e-4:Vr.z+=1e-4,Vr.normalize(),Gr.crossVectors(n,Vr)),Gr.normalize(),Hr.crossVectors(Vr,Gr),r[0]=Gr.x,r[4]=Hr.x,r[8]=Vr.x,r[1]=Gr.y,r[5]=Hr.y,r[9]=Vr.y,r[2]=Gr.z,r[6]=Hr.z,r[10]=Vr.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],p=n[13],d=n[2],f=n[6],m=n[10],_=n[14],g=n[3],y=n[7],v=n[11],b=n[15],x=r[0],w=r[4],S=r[8],M=r[12],T=r[1],E=r[5],A=r[9],$=r[13],C=r[2],B=r[6],L=r[10],R=r[14],N=r[3],P=r[7],I=r[11],O=r[15];return i[0]=s*x+o*T+a*C+l*N,i[4]=s*w+o*E+a*B+l*P,i[8]=s*S+o*A+a*L+l*I,i[12]=s*M+o*$+a*R+l*O,i[1]=c*x+u*T+h*C+p*N,i[5]=c*w+u*E+h*B+p*P,i[9]=c*S+u*A+h*L+p*I,i[13]=c*M+u*$+h*R+p*O,i[2]=d*x+f*T+m*C+_*N,i[6]=d*w+f*E+m*B+_*P,i[10]=d*S+f*A+m*L+_*I,i[14]=d*M+f*$+m*R+_*O,i[3]=g*x+y*T+v*C+b*N,i[7]=g*w+y*E+v*B+b*P,i[11]=g*S+y*A+v*L+b*I,i[15]=g*M+y*$+v*R+b*O,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],u=t[6],h=t[10],p=t[14];return t[3]*(+i*a*u-r*l*u-i*o*h+n*l*h+r*o*p-n*a*p)+t[7]*(+e*a*p-e*l*h+i*s*h-r*s*p+r*l*c-i*a*c)+t[11]*(+e*l*u-e*o*p-i*s*u+n*s*p+i*o*c-n*l*c)+t[15]*(-r*o*c-e*a*u+e*o*h+r*s*u-n*s*h+n*a*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],p=t[11],d=t[12],f=t[13],m=t[14],_=t[15],g=u*m*l-f*h*l+f*a*p-o*m*p-u*a*_+o*h*_,y=d*h*l-c*m*l-d*a*p+s*m*p+c*a*_-s*h*_,v=c*f*l-d*u*l+d*o*p-s*f*p-c*o*_+s*u*_,b=d*u*a-c*f*a-d*o*h+s*f*h+c*o*m-s*u*m,x=e*g+n*y+r*v+i*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return t[0]=g*w,t[1]=(f*h*i-u*m*i-f*r*p+n*m*p+u*r*_-n*h*_)*w,t[2]=(o*m*i-f*a*i+f*r*l-n*m*l-o*r*_+n*a*_)*w,t[3]=(u*a*i-o*h*i-u*r*l+n*h*l+o*r*p-n*a*p)*w,t[4]=y*w,t[5]=(c*m*i-d*h*i+d*r*p-e*m*p-c*r*_+e*h*_)*w,t[6]=(d*a*i-s*m*i-d*r*l+e*m*l+s*r*_-e*a*_)*w,t[7]=(s*h*i-c*a*i+c*r*l-e*h*l-s*r*p+e*a*p)*w,t[8]=v*w,t[9]=(d*u*i-c*f*i-d*n*p+e*f*p+c*n*_-e*u*_)*w,t[10]=(s*f*i-d*o*i+d*n*l-e*f*l-s*n*_+e*o*_)*w,t[11]=(c*o*i-s*u*i-c*n*l+e*u*l+s*n*p-e*o*p)*w,t[12]=b*w,t[13]=(c*f*r-d*u*r+d*n*h-e*f*h-c*n*m+e*u*m)*w,t[14]=(d*o*r-s*f*r-d*n*a+e*f*a+s*n*m-e*o*m)*w,t[15]=(s*u*r-c*o*r+c*n*a-e*u*a-s*n*h+e*o*h)*w,this}scale(t){const e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),i=1-n,s=t.x,o=t.y,a=t.z,l=i*s,c=i*o;return this.set(l*s+n,l*o-r*a,l*a+r*o,0,l*o+r*a,c*o+n,c*a-r*s,0,l*a-r*o,c*a+r*s,i*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,r,i,s){return this.set(1,n,i,0,t,1,s,0,e,r,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,l=i+i,c=s+s,u=o+o,h=i*l,p=i*c,d=i*u,f=s*c,m=s*u,_=o*u,g=a*l,y=a*c,v=a*u,b=n.x,x=n.y,w=n.z;return r[0]=(1-(f+_))*b,r[1]=(p+v)*b,r[2]=(d-y)*b,r[3]=0,r[4]=(p-v)*x,r[5]=(1-(h+_))*x,r[6]=(m+g)*x,r[7]=0,r[8]=(d+y)*w,r[9]=(m-g)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let i=Dr.set(r[0],r[1],r[2]).length();const s=Dr.set(r[4],r[5],r[6]).length(),o=Dr.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],Ur.copy(this);const a=1/i,l=1/s,c=1/o;return Ur.elements[0]*=a,Ur.elements[1]*=a,Ur.elements[2]*=a,Ur.elements[4]*=l,Ur.elements[5]*=l,Ur.elements[6]*=l,Ur.elements[8]*=c,Ur.elements[9]*=c,Ur.elements[10]*=c,e.setFromRotationMatrix(Ur),n.x=i,n.y=s,n.z=o,this}makePerspective(t,e,n,r,i,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*i/(e-t),l=2*i/(n-r),c=(e+t)/(e-t),u=(n+r)/(n-r),h=-(s+i)/(s-i),p=-2*s*i/(s-i);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,r,i,s){const o=this.elements,a=1/(e-t),l=1/(n-r),c=1/(s-i),u=(e+t)*a,h=(n+r)*l,p=(s+i)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}kr.prototype.isMatrix4=!0;const Dr=new ar,Ur=new kr,zr=new ar(0,0,0),jr=new ar(1,1,1),Gr=new ar,Hr=new ar,Vr=new ar,Wr=new kr,qr=new or;class Xr{constructor(t=0,e=0,n=0,r=Xr.DefaultOrder){this._x=t,this._y=e,this._z=n,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r=this._order){return this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const r=t.elements,i=r[0],s=r[4],o=r[8],a=r[1],l=r[5],c=r[9],u=r[2],h=r[6],p=r[10];switch(e){case"XYZ":this._y=Math.asin(jn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-jn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(jn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,i));break;case"ZYX":this._y=Math.asin(-jn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,p),this._z=Math.atan2(a,i)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(jn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-jn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-c,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Wr.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Wr,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return qr.setFromEuler(this),this.setFromQuaternion(qr,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new ar(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Xr.prototype.isEuler=!0,Xr.DefaultOrder="XYZ",Xr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Yr{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}}let Jr=0;const Zr=new ar,Qr=new or,Kr=new kr,ti=new ar,ei=new ar,ni=new ar,ri=new or,ii=new ar(1,0,0),si=new ar(0,1,0),oi=new ar(0,0,1),ai={type:"added"},li={type:"removed"};class ci extends On{constructor(){super(),Object.defineProperty(this,"id",{value:Jr++}),this.uuid=zn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ci.DefaultUp.clone();const t=new ar,e=new Xr,n=new or,r=new ar(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new kr},normalMatrix:{value:new Jn}}),this.matrix=new kr,this.matrixWorld=new kr,this.matrixAutoUpdate=ci.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Yr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Qr.setFromAxisAngle(t,e),this.quaternion.multiply(Qr),this}rotateOnWorldAxis(t,e){return Qr.setFromAxisAngle(t,e),this.quaternion.premultiply(Qr),this}rotateX(t){return this.rotateOnAxis(ii,t)}rotateY(t){return this.rotateOnAxis(si,t)}rotateZ(t){return this.rotateOnAxis(oi,t)}translateOnAxis(t,e){return Zr.copy(t).applyQuaternion(this.quaternion),this.position.add(Zr.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(ii,t)}translateY(t){return this.translateOnAxis(si,t)}translateZ(t){return this.translateOnAxis(oi,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Kr.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?ti.copy(t):ti.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),ei.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Kr.lookAt(ei,ti,this.up):Kr.lookAt(ti,ei,this.up),this.quaternion.setFromRotationMatrix(Kr),r&&(Kr.extractRotation(r.matrixWorld),Qr.setFromRotationMatrix(Kr),this.quaternion.premultiply(Qr.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(ai)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(li)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(li)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Kr.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Kr.multiply(t.parent.matrixWorld)),t.applyMatrix4(Kr),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ei,t,ni),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ei,ri,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){const r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];r.animations.push(i(t.animations,n))}}if(e){const e=s(t.geometries),r=s(t.materials),i=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),c=s(t.animations);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c)}return n.object=r,n;function s(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}ci.DefaultUp=new ar(0,1,0),ci.DefaultMatrixAutoUpdate=!0,ci.prototype.isObject3D=!0;const ui=new ar,hi=new ar,pi=new ar,di=new ar,fi=new ar,mi=new ar,_i=new ar,gi=new ar,yi=new ar,vi=new ar;class bi{constructor(t=new ar,e=new ar,n=new ar){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,r){r.subVectors(n,e),ui.subVectors(t,e),r.cross(ui);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(t,e,n,r,i){ui.subVectors(r,e),hi.subVectors(n,e),pi.subVectors(t,e);const s=ui.dot(ui),o=ui.dot(hi),a=ui.dot(pi),l=hi.dot(hi),c=hi.dot(pi),u=s*l-o*o;if(0===u)return i.set(-2,-1,-1);const h=1/u,p=(l*a-o*c)*h,d=(s*c-o*a)*h;return i.set(1-p-d,d,p)}static containsPoint(t,e,n,r){return this.getBarycoord(t,e,n,r,di),di.x>=0&&di.y>=0&&di.x+di.y<=1}static getUV(t,e,n,r,i,s,o,a){return this.getBarycoord(t,e,n,r,di),a.set(0,0),a.addScaledVector(i,di.x),a.addScaledVector(s,di.y),a.addScaledVector(o,di.z),a}static isFrontFacing(t,e,n,r){return ui.subVectors(n,e),hi.subVectors(t,e),ui.cross(hi).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return ui.subVectors(this.c,this.b),hi.subVectors(this.a,this.b),.5*ui.cross(hi).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return bi.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return bi.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,r,i){return bi.getUV(t,this.a,this.b,this.c,e,n,r,i)}containsPoint(t){return bi.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return bi.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,r=this.b,i=this.c;let s,o;fi.subVectors(r,n),mi.subVectors(i,n),gi.subVectors(t,n);const a=fi.dot(gi),l=mi.dot(gi);if(a<=0&&l<=0)return e.copy(n);yi.subVectors(t,r);const c=fi.dot(yi),u=mi.dot(yi);if(c>=0&&u<=c)return e.copy(r);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return s=a/(a-c),e.copy(n).addScaledVector(fi,s);vi.subVectors(t,i);const p=fi.dot(vi),d=mi.dot(vi);if(d>=0&&p<=d)return e.copy(i);const f=p*l-a*d;if(f<=0&&l>=0&&d<=0)return o=l/(l-d),e.copy(n).addScaledVector(mi,o);const m=c*d-p*u;if(m<=0&&u-c>=0&&p-d>=0)return _i.subVectors(i,r),o=(u-c)/(u-c+(p-d)),e.copy(r).addScaledVector(_i,o);const _=1/(m+f+h);return s=f*_,o=h*_,e.copy(n).addScaledVector(fi,s).addScaledVector(mi,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let xi=0;class wi extends On{constructor(){super(),Object.defineProperty(this,"id",{value:xi++}),this.uuid=zn(),this.name="",this.type="Material",this.fog=!0,this.blending=b,this.side=f,this.vertexColors=!1,this.opacity=1,this.format=kt,this.transparent=!1,this.blendSrc=P,this.blendDst=I,this.blendEquation=T,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=H,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Mn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=un,this.stencilZFail=un,this.stencilZPass=un,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===g;continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheenTint&&this.sheenTint.isColor&&(n.sheenTint=this.sheenTint.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(n.specularTint=this.specularTint.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(n.specularTintMap=this.specularTintMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationTint&&(n.attenuationTint=this.attenuationTint.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==b&&(n.blending=this.blending),this.side!==f&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.format!==kt&&(n.format=this.format),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.format=t.format,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}wi.prototype.isMaterial=!0;const Si={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Mi={h:0,s:0,l:0},Ti={h:0,s:0,l:0};function Ei(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function Ai(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function $i(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class Ci{constructor(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,n){return this.r=t,this.g=e,this.b=n,this}setHSL(t,e,n){if(t=Gn(t,1),e=jn(e,0,1),n=jn(n,0,1),0===e)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=Ei(i,r,t+1/3),this.g=Ei(i,r,t),this.b=Ei(i,r,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const r=n[1],i=n[2];switch(r){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){const n=parseFloat(t[1])/360,r=parseInt(t[2],10)/100,i=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(n,r,i)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=Si[t.toLowerCase()];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){const n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=Ai(t.r),this.g=Ai(t.g),this.b=Ai(t.b),this}copyLinearToSRGB(t){return this.r=$i(t.r),this.g=$i(t.g),this.b=$i(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const e=this.r,n=this.g,r=this.b,i=Math.max(e,n,r),s=Math.min(e,n,r);let o,a;const l=(s+i)/2;if(s===i)o=0,a=0;else{const t=i-s;switch(a=l<=.5?t/(i+s):t/(2-i-s),i){case e:o=(n-r)/t+(n<r?6:0);break;case n:o=(r-e)/t+2;break;case r:o=(e-n)/t+4}o/=6}return t.h=o,t.s=a,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,n){return this.getHSL(Mi),Mi.h+=t,Mi.s+=e,Mi.l+=n,this.setHSL(Mi.h,Mi.s,Mi.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Mi),t.getHSL(Ti);const n=Hn(Mi.h,Ti.h,e),r=Hn(Mi.s,Ti.s,e),i=Hn(Mi.l,Ti.l,e);return this.setHSL(n,r,i),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Ci.NAMES=Si,Ci.prototype.isColor=!0,Ci.prototype.r=1,Ci.prototype.g=1,Ci.prototype.b=1;class Bi extends wi{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new Ci(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}Bi.prototype.isMeshBasicMaterial=!0;const Li=new ar,Ri=new Yn;class Ni{constructor(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=Tn,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new Ci),e[n++]=i.r,e[n++]=i.g,e[n++]=i.b}return this}copyVector2sArray(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new Yn),e[n++]=i.x,e[n++]=i.y}return this}copyVector3sArray(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new ar),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z}return this}copyVector4sArray(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new nr),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z,e[n++]=i.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)Ri.fromBufferAttribute(this,e),Ri.applyMatrix3(t),this.setXY(e,Ri.x,Ri.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)Li.fromBufferAttribute(this,e),Li.applyMatrix3(t),this.setXYZ(e,Li.x,Li.y,Li.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)Li.x=this.getX(e),Li.y=this.getY(e),Li.z=this.getZ(e),Li.applyMatrix4(t),this.setXYZ(e,Li.x,Li.y,Li.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Li.x=this.getX(e),Li.y=this.getY(e),Li.z=this.getZ(e),Li.applyNormalMatrix(t),this.setXYZ(e,Li.x,Li.y,Li.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Li.x=this.getX(e),Li.y=this.getY(e),Li.z=this.getZ(e),Li.transformDirection(t),this.setXYZ(e,Li.x,Li.y,Li.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Tn&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}Ni.prototype.isBufferAttribute=!0;class Pi extends Ni{constructor(t,e,n){super(new Int8Array(t),e,n)}}class Ii extends Ni{constructor(t,e,n){super(new Uint8Array(t),e,n)}}class Oi extends Ni{constructor(t,e,n){super(new Uint8ClampedArray(t),e,n)}}class Fi extends Ni{constructor(t,e,n){super(new Int16Array(t),e,n)}}class ki extends Ni{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class Di extends Ni{constructor(t,e,n){super(new Int32Array(t),e,n)}}class Ui extends Ni{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class zi extends Ni{constructor(t,e,n){super(new Uint16Array(t),e,n)}}zi.prototype.isFloat16BufferAttribute=!0;class ji extends Ni{constructor(t,e,n){super(new Float32Array(t),e,n)}}class Gi extends Ni{constructor(t,e,n){super(new Float64Array(t),e,n)}}function Hi(t){if(0===t.length)return-1/0;let e=t[0];for(let n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}const Vi={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Wi(t,e){return new Vi[t](e)}let qi=0;const Xi=new kr,Yi=new ci,Ji=new ar,Zi=new ur,Qi=new ur,Ki=new ar;class ts extends On{constructor(){super(),Object.defineProperty(this,"id",{value:qi++}),this.uuid=zn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Hi(t)>65535?Ui:ki)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new Jn).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Xi.makeRotationFromQuaternion(t),this.applyMatrix4(Xi),this}rotateX(t){return Xi.makeRotationX(t),this.applyMatrix4(Xi),this}rotateY(t){return Xi.makeRotationY(t),this.applyMatrix4(Xi),this}rotateZ(t){return Xi.makeRotationZ(t),this.applyMatrix4(Xi),this}translate(t,e,n){return Xi.makeTranslation(t,e,n),this.applyMatrix4(Xi),this}scale(t,e,n){return Xi.makeScale(t,e,n),this.applyMatrix4(Xi),this}lookAt(t){return Yi.lookAt(t),Yi.updateMatrix(),this.applyMatrix4(Yi.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ji).negate(),this.translate(Ji.x,Ji.y,Ji.z),this}setFromPoints(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new ji(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ur);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ar(-1/0,-1/0,-1/0),new ar(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Zi.setFromBufferAttribute(n),this.morphTargetsRelative?(Ki.addVectors(this.boundingBox.min,Zi.min),this.boundingBox.expandByPoint(Ki),Ki.addVectors(this.boundingBox.max,Zi.max),this.boundingBox.expandByPoint(Ki)):(this.boundingBox.expandByPoint(Zi.min),this.boundingBox.expandByPoint(Zi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Cr);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ar,1/0);if(t){const n=this.boundingSphere.center;if(Zi.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Qi.setFromBufferAttribute(n),this.morphTargetsRelative?(Ki.addVectors(Zi.min,Qi.min),Zi.expandByPoint(Ki),Ki.addVectors(Zi.max,Qi.max),Zi.expandByPoint(Ki)):(Zi.expandByPoint(Qi.min),Zi.expandByPoint(Qi.max))}Zi.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)Ki.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(Ki));if(e)for(let i=0,s=e.length;i<s;i++){const s=e[i],o=this.morphTargetsRelative;for(let e=0,i=s.count;e<i;e++)Ki.fromBufferAttribute(s,e),o&&(Ji.fromBufferAttribute(t,e),Ki.add(Ji)),r=Math.max(r,n.distanceToSquared(Ki))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.array,r=e.position.array,i=e.normal.array,s=e.uv.array,o=r.length/3;void 0===e.tangent&&this.setAttribute("tangent",new Ni(new Float32Array(4*o),4));const a=e.tangent.array,l=[],c=[];for(let t=0;t<o;t++)l[t]=new ar,c[t]=new ar;const u=new ar,h=new ar,p=new ar,d=new Yn,f=new Yn,m=new Yn,_=new ar,g=new ar;function y(t,e,n){u.fromArray(r,3*t),h.fromArray(r,3*e),p.fromArray(r,3*n),d.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*n),h.sub(u),p.sub(u),f.sub(d),m.sub(d);const i=1/(f.x*m.y-m.x*f.y);isFinite(i)&&(_.copy(h).multiplyScalar(m.y).addScaledVector(p,-f.y).multiplyScalar(i),g.copy(p).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(i),l[t].add(_),l[e].add(_),l[n].add(_),c[t].add(g),c[e].add(g),c[n].add(g))}let v=this.groups;0===v.length&&(v=[{start:0,count:n.length}]);for(let t=0,e=v.length;t<e;++t){const e=v[t],r=e.start;for(let t=r,i=r+e.count;t<i;t+=3)y(n[t+0],n[t+1],n[t+2])}const b=new ar,x=new ar,w=new ar,S=new ar;function M(t){w.fromArray(i,3*t),S.copy(w);const e=l[t];b.copy(e),b.sub(w.multiplyScalar(w.dot(e))).normalize(),x.crossVectors(S,e);const n=x.dot(c[t])<0?-1:1;a[4*t]=b.x,a[4*t+1]=b.y,a[4*t+2]=b.z,a[4*t+3]=n}for(let t=0,e=v.length;t<e;++t){const e=v[t],r=e.start;for(let t=r,i=r+e.count;t<i;t+=3)M(n[t+0]),M(n[t+1]),M(n[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new Ni(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const r=new ar,i=new ar,s=new ar,o=new ar,a=new ar,l=new ar,c=new ar,u=new ar;if(t)for(let h=0,p=t.count;h<p;h+=3){const p=t.getX(h+0),d=t.getX(h+1),f=t.getX(h+2);r.fromBufferAttribute(e,p),i.fromBufferAttribute(e,d),s.fromBufferAttribute(e,f),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),o.fromBufferAttribute(n,p),a.fromBufferAttribute(n,d),l.fromBufferAttribute(n,f),o.add(c),a.add(c),l.add(c),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===t.attributes[r])continue;const i=n[r].array,s=t.attributes[r],o=s.array,a=s.itemSize*e,l=Math.min(o.length,i.length-a);for(let t=0,e=a;t<l;t++,e++)i[e]=o[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Ki.fromBufferAttribute(t,e),Ki.normalize(),t.setXYZ(e,Ki.x,Ki.y,Ki.z)}toNonIndexed(){function t(t,e){const n=t.array,r=t.itemSize,i=t.normalized,s=new n.constructor(e.length*r);let o=0,a=0;for(let i=0,l=e.length;i<l;i++){o=t.isInterleavedBufferAttribute?e[i]*t.data.stride+t.offset:e[i]*r;for(let t=0;t<r;t++)s[a++]=n[o++]}return new Ni(s,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new ts,n=this.index.array,r=this.attributes;for(const i in r){const s=t(r[i],n);e.setAttribute(i,s)}const i=this.morphAttributes;for(const r in i){const s=[],o=i[r];for(let e=0,r=o.length;e<r;e++){const r=t(o[e],n);s.push(r)}e.morphAttributes[r]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.addGroup(n.start,n.count,n.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const r=n[e];t.data.attributes[e]=r.toJSON(t.data)}const r={};let i=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,r=n.length;e<r;e++){const r=n[e];s.push(r.toJSON(t.data))}s.length>0&&(r[e]=s,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new ts).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const r=t.attributes;for(const t in r){const n=r[t];this.setAttribute(t,n.clone(e))}const i=t.morphAttributes;for(const t in i){const n=[],r=i[t];for(let t=0,i=r.length;t<i;t++)n.push(r[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}ts.prototype.isBufferGeometry=!0;const es=new kr,ns=new Fr,rs=new Cr,is=new ar,ss=new ar,os=new ar,as=new ar,ls=new ar,cs=new ar,us=new ar,hs=new ar,ps=new ar,ds=new Yn,fs=new Yn,ms=new Yn,_s=new ar,gs=new ar;class ys extends ci{constructor(t=new ts,e=new Bi){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),rs.copy(n.boundingSphere),rs.applyMatrix4(i),!1===t.ray.intersectsSphere(rs))return;if(es.copy(i).invert(),ns.copy(t.ray).applyMatrix4(es),null!==n.boundingBox&&!1===ns.intersectsBox(n.boundingBox))return;let s;if(n.isBufferGeometry){const i=n.index,o=n.attributes.position,a=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,u=n.attributes.uv2,h=n.groups,p=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,d=h.length;n<d;n++){const d=h[n],f=r[d.materialIndex];for(let n=Math.max(d.start,p.start),r=Math.min(d.start+d.count,p.start+p.count);n<r;n+=3){const r=i.getX(n),h=i.getX(n+1),p=i.getX(n+2);s=vs(this,f,t,ns,o,a,l,c,u,r,h,p),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=d.materialIndex,e.push(s))}}else for(let n=Math.max(0,p.start),h=Math.min(i.count,p.start+p.count);n<h;n+=3){const h=i.getX(n),p=i.getX(n+1),d=i.getX(n+2);s=vs(this,r,t,ns,o,a,l,c,u,h,p,d),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}else if(void 0!==o)if(Array.isArray(r))for(let n=0,i=h.length;n<i;n++){const i=h[n],d=r[i.materialIndex];for(let n=Math.max(i.start,p.start),r=Math.min(i.start+i.count,p.start+p.count);n<r;n+=3)s=vs(this,d,t,ns,o,a,l,c,u,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=i.materialIndex,e.push(s))}else for(let n=Math.max(0,p.start),i=Math.min(o.count,p.start+p.count);n<i;n+=3)s=vs(this,r,t,ns,o,a,l,c,u,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function vs(t,e,n,r,i,s,o,a,l,c,u,h){is.fromBufferAttribute(i,c),ss.fromBufferAttribute(i,u),os.fromBufferAttribute(i,h);const p=t.morphTargetInfluences;if(s&&p){us.set(0,0,0),hs.set(0,0,0),ps.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=p[t],n=s[t];0!==e&&(as.fromBufferAttribute(n,c),ls.fromBufferAttribute(n,u),cs.fromBufferAttribute(n,h),o?(us.addScaledVector(as,e),hs.addScaledVector(ls,e),ps.addScaledVector(cs,e)):(us.addScaledVector(as.sub(is),e),hs.addScaledVector(ls.sub(ss),e),ps.addScaledVector(cs.sub(os),e)))}is.add(us),ss.add(hs),os.add(ps)}t.isSkinnedMesh&&(t.boneTransform(c,is),t.boneTransform(u,ss),t.boneTransform(h,os));const d=function(t,e,n,r,i,s,o,a){let l;if(l=e.side===m?r.intersectTriangle(o,s,i,!0,a):r.intersectTriangle(i,s,o,e.side!==_,a),null===l)return null;gs.copy(a),gs.applyMatrix4(t.matrixWorld);const c=n.ray.origin.distanceTo(gs);return c<n.near||c>n.far?null:{distance:c,point:gs.clone(),object:t}}(t,e,n,r,is,ss,os,_s);if(d){a&&(ds.fromBufferAttribute(a,c),fs.fromBufferAttribute(a,u),ms.fromBufferAttribute(a,h),d.uv=bi.getUV(_s,is,ss,os,ds,fs,ms,new Yn)),l&&(ds.fromBufferAttribute(l,c),fs.fromBufferAttribute(l,u),ms.fromBufferAttribute(l,h),d.uv2=bi.getUV(_s,is,ss,os,ds,fs,ms,new Yn));const t={a:c,b:u,c:h,normal:new ar,materialIndex:0};bi.getNormal(is,ss,os,t.normal),d.face=t}return d}ys.prototype.isMesh=!0;class bs extends ts{constructor(t=1,e=1,n=1,r=1,i=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:s};const o=this;r=Math.floor(r),i=Math.floor(i),s=Math.floor(s);const a=[],l=[],c=[],u=[];let h=0,p=0;function d(t,e,n,r,i,s,d,f,m,_,g){const y=s/m,v=d/_,b=s/2,x=d/2,w=f/2,S=m+1,M=_+1;let T=0,E=0;const A=new ar;for(let s=0;s<M;s++){const o=s*v-x;for(let a=0;a<S;a++){const h=a*y-b;A[t]=h*r,A[e]=o*i,A[n]=w,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=f>0?1:-1,c.push(A.x,A.y,A.z),u.push(a/m),u.push(1-s/_),T+=1}}for(let t=0;t<_;t++)for(let e=0;e<m;e++){const n=h+e+S*t,r=h+e+S*(t+1),i=h+(e+1)+S*(t+1),s=h+(e+1)+S*t;a.push(n,r,s),a.push(r,i,s),E+=6}o.addGroup(p,E,g),p+=E,h+=T}d("z","y","x",-1,-1,n,e,t,s,i,0),d("z","y","x",1,-1,n,e,-t,s,i,1),d("x","z","y",1,1,t,n,e,r,s,2),d("x","z","y",1,-1,t,n,-e,r,s,3),d("x","y","z",1,-1,t,e,n,r,i,4),d("x","y","z",-1,-1,t,e,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new ji(l,3)),this.setAttribute("normal",new ji(c,3)),this.setAttribute("uv",new ji(u,2))}static fromJSON(t){return new bs(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function xs(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function ws(t){const e={};for(let n=0;n<t.length;n++){const r=xs(t[n]);for(const t in r)e[t]=r[t]}return e}const Ss={clone:xs,merge:ws};class Ms extends wi{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=xs(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?e.uniforms[n]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[n]={type:"m4",value:r.toArray()}:e.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}Ms.prototype.isShaderMaterial=!0;class Ts extends ci{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new kr,this.projectionMatrix=new kr,this.projectionMatrixInverse=new kr}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Ts.prototype.isCamera=!0;class Es extends Ts{constructor(t=50,e=1,n=.1,r=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Un*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Dn*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Un*Math.atan(Math.tan(.5*Dn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,r,i,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Dn*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;i+=s.offsetX*r/t,e-=s.offsetY*n/o,r*=s.width/t,n*=s.height/o}const o=this.filmOffset;0!==o&&(i+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}Es.prototype.isPerspectiveCamera=!0;const As=90;class $s extends ci{constructor(t,e,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new Es(As,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new ar(1,0,0)),this.add(r);const i=new Es(As,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new ar(-1,0,0)),this.add(i);const s=new Es(As,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new ar(0,1,0)),this.add(s);const o=new Es(As,1,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new ar(0,-1,0)),this.add(o);const a=new Es(As,1,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new ar(0,0,1)),this.add(a);const l=new Es(As,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new ar(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[r,i,s,o,a,l]=this.children,c=t.xr.enabled,u=t.getRenderTarget();t.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,r),t.setRenderTarget(n,1),t.render(e,i),t.setRenderTarget(n,2),t.render(e,s),t.setRenderTarget(n,3),t.render(e,o),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=h,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(u),t.xr.enabled=c}}class Cs extends tr{constructor(t,e,n,r,i,s,o,a,l,c){super(t=void 0!==t?t:[],e=void 0!==e?e:st,n,r,i,s,o=void 0!==o?o:Ft,a,l,c),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}Cs.prototype.isCubeTexture=!0;class Bs extends rr{constructor(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),super(t,t,e),e=e||{},this.texture=new Cs(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:vt,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=kt,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new bs(5,5,5),o=new Ms({name:"CubemapFromEquirect",uniforms:xs(n),vertexShader:r,fragmentShader:i,side:m,blending:v});o.uniforms.tEquirect.value=e;const a=new ys(s,o),l=e.minFilter;return e.minFilter===wt&&(e.minFilter=vt),new $s(1,10,this).update(t,a),e.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(t,e,n,r){const i=t.getRenderTarget();for(let i=0;i<6;i++)t.setRenderTarget(this,i),t.clear(e,n,r);t.setRenderTarget(i)}}Bs.prototype.isWebGLCubeRenderTarget=!0;const Ls=new ar,Rs=new ar,Ns=new Jn;class Ps{constructor(t=new ar(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const r=Ls.subVectors(n,e).cross(Rs.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const n=t.delta(Ls),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:e.copy(n).multiplyScalar(i).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||Ns.getNormalMatrix(t),r=this.coplanarPoint(Ls).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Ps.prototype.isPlane=!0;const Is=new Cr,Os=new ar;class Fs{constructor(t=new Ps,e=new Ps,n=new Ps,r=new Ps,i=new Ps,s=new Ps){this.planes=[t,e,n,r,i,s]}set(t,e,n,r,i,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7],h=n[8],p=n[9],d=n[10],f=n[11],m=n[12],_=n[13],g=n[14],y=n[15];return e[0].setComponents(o-r,u-a,f-h,y-m).normalize(),e[1].setComponents(o+r,u+a,f+h,y+m).normalize(),e[2].setComponents(o+i,u+l,f+p,y+_).normalize(),e[3].setComponents(o-i,u-l,f-p,y-_).normalize(),e[4].setComponents(o-s,u-c,f-d,y-g).normalize(),e[5].setComponents(o+s,u+c,f+d,y+g).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Is.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Is)}intersectsSprite(t){return Is.center.set(0,0,0),Is.radius=.7071067811865476,Is.applyMatrix4(t.matrixWorld),this.intersectsSphere(Is)}intersectsSphere(t){const e=this.planes,n=t.center,r=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(n)<r)return!1;return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const r=e[n];if(Os.x=r.normal.x>0?t.max.x:t.min.x,Os.y=r.normal.y>0?t.max.y:t.min.y,Os.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(Os)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function ks(){let t=null,e=!1,n=null,r=null;function i(e,s){n(e,s),r=t.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==n&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function Ds(t,e){const n=e.isWebGL2,r=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),r.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=r.get(e);n&&(t.deleteBuffer(n.buffer),r.delete(e))},update:function(e,i){if(e.isGLBufferAttribute){const t=r.get(e);return void((!t||t.version<e.version)&&r.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=r.get(e);void 0===s?r.set(e,function(e,r){const i=e.array,s=e.usage,o=t.createBuffer();t.bindBuffer(r,o),t.bufferData(r,i,s),e.onUploadCallback();let a=5126;return i instanceof Float32Array?a=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?e.isFloat16BufferAttribute?n?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:i instanceof Int16Array?a=5122:i instanceof Uint32Array?a=5125:i instanceof Int32Array?a=5124:i instanceof Int8Array?a=5120:(i instanceof Uint8Array||i instanceof Uint8ClampedArray)&&(a=5121),{buffer:o,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}(e,i)):s.version<e.version&&(function(e,r,i){const s=r.array,o=r.updateRange;t.bindBuffer(i,e),-1===o.count?t.bufferSubData(i,0,s):(n?t.bufferSubData(i,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):t.bufferSubData(i,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,e,i),s.version=e.version)}}}class Us extends ts{constructor(t=1,e=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};const i=t/2,s=e/2,o=Math.floor(n),a=Math.floor(r),l=o+1,c=a+1,u=t/o,h=e/a,p=[],d=[],f=[],m=[];for(let t=0;t<c;t++){const e=t*h-s;for(let n=0;n<l;n++){const r=n*u-i;d.push(r,-e,0),f.push(0,0,1),m.push(n/o),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const n=e+l*t,r=e+l*(t+1),i=e+1+l*(t+1),s=e+1+l*t;p.push(n,r,s),p.push(r,i,s)}this.setIndex(p),this.setAttribute("position",new ji(d,3)),this.setAttribute("normal",new ji(f,3)),this.setAttribute("uv",new ji(m,2))}static fromJSON(t){return new Us(t.width,t.height,t.widthSegments,t.heightSegments)}}const zs={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotVH = saturate( dot( geometry.viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float NoH ) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float NoV, float NoL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( NoL + NoV - NoL * NoV ) ) );\n}\nvec3 BRDF_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in GeometricContext geometry ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularTintFactor = specularTint;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARTINTMAP\n\t\t\tspecularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularTintFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenTint = sheenTint;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenTint;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( material.roughness, directLight.direction, geometry, material.sheenTint );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationTint, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = transmission.a;\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationTint;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularTint;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARTINTMAP\n\t\tuniform sampler2D specularTintMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenTint;\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},js={common:{diffuse:{value:new Ci(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Jn},uv2Transform:{value:new Jn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Yn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ci(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ci(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Jn}},sprite:{diffuse:{value:new Ci(16777215)},opacity:{value:1},center:{value:new Yn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Jn}}},Gs={basic:{uniforms:ws([js.common,js.specularmap,js.envmap,js.aomap,js.lightmap,js.fog]),vertexShader:zs.meshbasic_vert,fragmentShader:zs.meshbasic_frag},lambert:{uniforms:ws([js.common,js.specularmap,js.envmap,js.aomap,js.lightmap,js.emissivemap,js.fog,js.lights,{emissive:{value:new Ci(0)}}]),vertexShader:zs.meshlambert_vert,fragmentShader:zs.meshlambert_frag},phong:{uniforms:ws([js.common,js.specularmap,js.envmap,js.aomap,js.lightmap,js.emissivemap,js.bumpmap,js.normalmap,js.displacementmap,js.fog,js.lights,{emissive:{value:new Ci(0)},specular:{value:new Ci(1118481)},shininess:{value:30}}]),vertexShader:zs.meshphong_vert,fragmentShader:zs.meshphong_frag},standard:{uniforms:ws([js.common,js.envmap,js.aomap,js.lightmap,js.emissivemap,js.bumpmap,js.normalmap,js.displacementmap,js.roughnessmap,js.metalnessmap,js.fog,js.lights,{emissive:{value:new Ci(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:zs.meshphysical_vert,fragmentShader:zs.meshphysical_frag},toon:{uniforms:ws([js.common,js.aomap,js.lightmap,js.emissivemap,js.bumpmap,js.normalmap,js.displacementmap,js.gradientmap,js.fog,js.lights,{emissive:{value:new Ci(0)}}]),vertexShader:zs.meshtoon_vert,fragmentShader:zs.meshtoon_frag},matcap:{uniforms:ws([js.common,js.bumpmap,js.normalmap,js.displacementmap,js.fog,{matcap:{value:null}}]),vertexShader:zs.meshmatcap_vert,fragmentShader:zs.meshmatcap_frag},points:{uniforms:ws([js.points,js.fog]),vertexShader:zs.points_vert,fragmentShader:zs.points_frag},dashed:{uniforms:ws([js.common,js.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:zs.linedashed_vert,fragmentShader:zs.linedashed_frag},depth:{uniforms:ws([js.common,js.displacementmap]),vertexShader:zs.depth_vert,fragmentShader:zs.depth_frag},normal:{uniforms:ws([js.common,js.bumpmap,js.normalmap,js.displacementmap,{opacity:{value:1}}]),vertexShader:zs.meshnormal_vert,fragmentShader:zs.meshnormal_frag},sprite:{uniforms:ws([js.sprite,js.fog]),vertexShader:zs.sprite_vert,fragmentShader:zs.sprite_frag},background:{uniforms:{uvTransform:{value:new Jn},t2D:{value:null}},vertexShader:zs.background_vert,fragmentShader:zs.background_frag},cube:{uniforms:ws([js.envmap,{opacity:{value:1}}]),vertexShader:zs.cube_vert,fragmentShader:zs.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:zs.equirect_vert,fragmentShader:zs.equirect_frag},distanceRGBA:{uniforms:ws([js.common,js.displacementmap,{referencePosition:{value:new ar},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:zs.distanceRGBA_vert,fragmentShader:zs.distanceRGBA_frag},shadow:{uniforms:ws([js.lights,js.fog,{color:{value:new Ci(0)},opacity:{value:1}}]),vertexShader:zs.shadow_vert,fragmentShader:zs.shadow_frag}};function Hs(t,e,n,r,i){const s=new Ci(0);let o,a,l=0,c=null,u=0,h=null;function p(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,i)}return{getClearColor:function(){return s},setClearColor:function(t,e=1){s.set(t),l=e,p(s,l)},getClearAlpha:function(){return l},setClearAlpha:function(t){l=t,p(s,l)},render:function(n,i){let d=!1,_=!0===i.isScene?i.background:null;_&&_.isTexture&&(_=e.get(_));const g=t.xr,y=g.getSession&&g.getSession();y&&"additive"===y.environmentBlendMode&&(_=null),null===_?p(s,l):_&&_.isColor&&(p(_,1),d=!0),(t.autoClear||d)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),_&&(_.isCubeTexture||_.mapping===ct)?(void 0===a&&(a=new ys(new bs(1,1,1),new Ms({name:"BackgroundCubeMaterial",uniforms:xs(Gs.cube.uniforms),vertexShader:Gs.cube.vertexShader,fragmentShader:Gs.cube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a)),a.material.uniforms.envMap.value=_,a.material.uniforms.flipEnvMap.value=_.isCubeTexture&&!1===_.isRenderTargetTexture?-1:1,c===_&&u===_.version&&h===t.toneMapping||(a.material.needsUpdate=!0,c=_,u=_.version,h=t.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):_&&_.isTexture&&(void 0===o&&(o=new ys(new Us(2,2),new Ms({name:"BackgroundMaterial",uniforms:xs(Gs.background.uniforms),vertexShader:Gs.background.vertexShader,fragmentShader:Gs.background.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=_,!0===_.matrixAutoUpdate&&_.updateMatrix(),o.material.uniforms.uvTransform.value.copy(_.matrix),c===_&&u===_.version&&h===t.toneMapping||(o.material.needsUpdate=!0,c=_,u=_.version,h=t.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null))}}}function Vs(t,e,n,r){const i=t.getParameter(34921),s=r.isWebGL2?null:e.get("OES_vertex_array_object"),o=r.isWebGL2||null!==s,a={},l=p(null);let c=l;function u(e){return r.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function h(e){return r.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function p(t){const e=[],n=[],r=[];for(let t=0;t<i;t++)e[t]=0,n[t]=0,r[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:r,object:t,attributes:{},index:null}}function d(){const t=c.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function f(t){m(t,0)}function m(n,i){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;s[n]=1,0===o[n]&&(t.enableVertexAttribArray(n),o[n]=1),a[n]!==i&&((r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),a[n]=i)}function _(){const e=c.newAttributes,n=c.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==e[r]&&(t.disableVertexAttribArray(r),n[r]=0)}function g(e,n,i,s,o,a){!0!==r.isWebGL2||5124!==i&&5125!==i?t.vertexAttribPointer(e,n,i,s,o,a):t.vertexAttribIPointer(e,n,i,o,a)}function y(){v(),c!==l&&(c=l,u(c.object))}function v(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,h,y,v){let b=!1;if(o){const e=function(e,n,i){const o=!0===i.wireframe;let l=a[e.id];void 0===l&&(l={},a[e.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[o];return void 0===u&&(u=p(r.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[o]=u),u}(y,h,l);c!==e&&(c=e,u(c.object)),b=function(t,e){const n=c.attributes,r=t.attributes;let i=0;for(const t in r){const e=n[t],s=r[t];if(void 0===e)return!0;if(e.attribute!==s)return!0;if(e.data!==s.data)return!0;i++}return c.attributesNum!==i||c.index!==e}(y,v),b&&function(t,e){const n={},r=t.attributes;let i=0;for(const t in r){const e=r[t],s={};s.attribute=e,e.data&&(s.data=e.data),n[t]=s,i++}c.attributes=n,c.attributesNum=i,c.index=e}(y,v)}else{const t=!0===l.wireframe;c.geometry===y.id&&c.program===h.id&&c.wireframe===t||(c.geometry=y.id,c.program=h.id,c.wireframe=t,b=!0)}!0===i.isInstancedMesh&&(b=!0),null!==v&&n.update(v,34963),b&&(function(i,s,o,a){if(!1===r.isWebGL2&&(i.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;d();const l=a.attributes,c=o.getAttributes(),u=s.defaultAttributeValues;for(const e in c){const r=c[e];if(r.location>=0){let s=l[e];if(void 0===s&&("instanceMatrix"===e&&i.instanceMatrix&&(s=i.instanceMatrix),"instanceColor"===e&&i.instanceColor&&(s=i.instanceColor)),void 0!==s){const e=s.normalized,o=s.itemSize,l=n.get(s);if(void 0===l)continue;const c=l.buffer,u=l.type,h=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const n=s.data,l=n.stride,p=s.offset;if(n&&n.isInstancedInterleavedBuffer){for(let t=0;t<r.locationSize;t++)m(r.location+t,n.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let t=0;t<r.locationSize;t++)f(r.location+t);t.bindBuffer(34962,c);for(let t=0;t<r.locationSize;t++)g(r.location+t,o/r.locationSize,u,e,l*h,(p+o/r.locationSize*t)*h)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<r.locationSize;t++)m(r.location+t,s.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<r.locationSize;t++)f(r.location+t);t.bindBuffer(34962,c);for(let t=0;t<r.locationSize;t++)g(r.location+t,o/r.locationSize,u,e,o*h,o/r.locationSize*t*h)}}else if(void 0!==u){const n=u[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(r.location,n);break;case 3:t.vertexAttrib3fv(r.location,n);break;case 4:t.vertexAttrib4fv(r.location,n);break;default:t.vertexAttrib1fv(r.location,n)}}}}_()}(i,l,h,y),null!==v&&t.bindBuffer(34963,n.get(v).buffer))},reset:y,resetDefaultState:v,dispose:function(){y();for(const t in a){const e=a[t];for(const t in e){const n=e[t];for(const t in n)h(n[t].object),delete n[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const n=e[t];for(const t in n)h(n[t].object),delete n[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const n=a[e];if(void 0===n[t.id])continue;const r=n[t.id];for(const t in r)h(r[t].object),delete r[t];delete n[t.id]}},initAttributes:d,enableAttribute:f,disableUnusedAttributes:_}}function Ws(t,e,n,r){const i=r.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,r){t.drawArrays(s,e,r),n.update(r,s,1)},this.renderInstances=function(r,o,a){if(0===a)return;let l,c;if(i)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,r,o,a),n.update(o,s,a)}}function qs(t,e,n){let r;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let o=void 0!==n.precision?n.precision:"highp";const a=i(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=s||e.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=t.getParameter(34930),h=t.getParameter(35660),p=t.getParameter(3379),d=t.getParameter(34076),f=t.getParameter(34921),m=t.getParameter(36347),_=t.getParameter(36348),g=t.getParameter(36349),y=h>0,v=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:p,maxCubemapSize:d,maxAttributes:f,maxVertexUniforms:m,maxVaryings:_,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:v,floatVertexTextures:y&&v,maxSamples:s?t.getParameter(36183):0}}function Xs(t){const e=this;let n=null,r=0,i=!1,s=!1;const o=new Ps,a=new Jn,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(t,n,r,i){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==i||null===c){const e=r+4*s,i=n.matrixWorldInverse;a.getNormalMatrix(i),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,n=r;e!==s;++e,n+=4)o.copy(t[e]).applyMatrix4(i,a),o.normal.toArray(c,n),c[n+3]=o.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const o=0!==t.length||e||0!==r||i;return i=e,n=u(t,s,0),r=t.length,o},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1,c()},this.setState=function(e,o,a){const h=e.clippingPlanes,p=e.clipIntersection,d=e.clipShadows,f=t.get(e);if(!i||null===h||0===h.length||s&&!d)s?u(null):c();else{const t=s?0:r,e=4*t;let i=f.clippingState||null;l.value=i,i=u(h,o,e,a);for(let t=0;t!==e;++t)i[t]=n[t];f.clippingState=i,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=t}}}function Ys(t){let e=new WeakMap;function n(t,e){return e===at?t.mapping=st:e===lt&&(t.mapping=ot),t}function r(t){const n=t.target;n.removeEventListener("dispose",r);const i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){const s=i.mapping;if(s===at||s===lt){if(e.has(i))return n(e.get(i).texture,i.mapping);{const s=i.image;if(s&&s.height>0){const o=t.getRenderTarget(),a=new Bs(s.height/2);return a.fromEquirectangularTexture(t,i),e.set(i,a),t.setRenderTarget(o),i.addEventListener("dispose",r),n(a.texture,i.mapping)}return null}}}return i},dispose:function(){e=new WeakMap}}}Gs.physical={uniforms:ws([Gs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Yn(1,1)},clearcoatNormalMap:{value:null},sheenTint:{value:new Ci(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Yn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new Ci(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new Ci(1,1,1)},specularTintMap:{value:null}}]),vertexShader:zs.meshphysical_vert,fragmentShader:zs.meshphysical_frag};class Js extends Ts{constructor(t=-1,e=1,n=1,r=-1,i=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=i,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,r,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-t,s=n+t,o=r+e,a=r-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,s=i+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(i,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}Js.prototype.isOrthographicCamera=!0;class Zs extends Ms{constructor(t){super(t),this.type="RawShaderMaterial"}}Zs.prototype.isRawShaderMaterial=!0;const Qs=4,Ks=8,to=Math.pow(2,Ks),eo=[.125,.215,.35,.446,.526,.582],no=Ks-Qs+1+eo.length,ro={[Je]:0,[Ze]:1,[Ke]:2,[en]:3,[nn]:4,[rn]:5,[Qe]:6},io=new Js,{_lodPlanes:so,_sizeLods:oo,_sigmas:ao}=_o(),lo=new Ci;let co=null;const uo=(1+Math.sqrt(5))/2,ho=1/uo,po=[new ar(1,1,1),new ar(-1,1,1),new ar(1,1,-1),new ar(-1,1,-1),new ar(0,uo,ho),new ar(0,uo,-ho),new ar(ho,0,uo),new ar(-ho,0,uo),new ar(uo,ho,0),new ar(-uo,ho,0)];class fo{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(t){const e=new Float32Array(20),n=new ar(0,1,0);return new Zs({name:"SphericalGaussianBlur",defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:ro[Je]},outputEncoding:{value:ro[Je]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:v,depthTest:!1,depthWrite:!1})}(),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,r=100){co=this._renderer.getRenderTarget();const i=this._allocateTargets();return this._sceneToCubeUV(t,n,r,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=bo(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=vo(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<so.length;t++)so[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(co),t.scissorTest=!1,yo(t,0,0,t.width,t.height)}_fromTexture(t){co=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:ft,minFilter:ft,generateMipmaps:!1,type:Mt,format:zt,encoding:mo(t)?t.encoding:Ke,depthBuffer:!1},n=go(e);return n.depthBuffer=!t,this._pingPongRenderTarget=go(e),n}_compileMaterial(t){const e=new ys(so[0],t);this._renderer.compile(e,io)}_sceneToCubeUV(t,e,n,r){const i=new Es(90,1,e,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.outputEncoding,u=a.toneMapping;a.getClearColor(lo),a.toneMapping=Q,a.outputEncoding=Je,a.autoClear=!1;const h=new Bi({name:"PMREM.Background",side:m,depthWrite:!1,depthTest:!1}),p=new ys(new bs,h);let d=!1;const f=t.background;f?f.isColor&&(h.color.copy(f),t.background=null,d=!0):(h.color.copy(lo),d=!0);for(let e=0;e<6;e++){const n=e%3;0==n?(i.up.set(0,s[e],0),i.lookAt(o[e],0,0)):1==n?(i.up.set(0,0,s[e]),i.lookAt(0,o[e],0)):(i.up.set(0,s[e],0),i.lookAt(0,0,o[e])),yo(r,n*to,e>2?to:0,to,to),a.setRenderTarget(r),d&&a.render(p,i),a.render(t,i)}p.geometry.dispose(),p.material.dispose(),a.toneMapping=u,a.outputEncoding=c,a.autoClear=l,t.background=f}_textureToCubeUV(t,e){const n=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=bo()):null==this._equirectShader&&(this._equirectShader=vo());const r=t.isCubeTexture?this._cubemapShader:this._equirectShader,i=new ys(so[0],r),s=r.uniforms;s.envMap.value=t,t.isCubeTexture||s.texelSize.value.set(1/t.image.width,1/t.image.height),s.inputEncoding.value=ro[t.encoding],s.outputEncoding.value=ro[e.texture.encoding],yo(e,0,0,3*to,2*to),n.setRenderTarget(e),n.render(i,io)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let e=1;e<no;e++){const n=Math.sqrt(ao[e]*ao[e]-ao[e-1]*ao[e-1]),r=po[(e-1)%po.length];this._blur(t,e-1,e,n,r)}e.autoClear=n}_blur(t,e,n,r,i){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,r,"latitudinal",i),this._halfBlur(s,t,n,n,r,"longitudinal",i)}_halfBlur(t,e,n,r,i,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new ys(so[r],l),u=l.uniforms,h=oo[n]-1,p=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,d=i/p,f=isFinite(i)?1+Math.floor(3*d):20;f>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let _=0;for(let t=0;t<20;++t){const e=t/d,n=Math.exp(-e*e/2);m.push(n),0==t?_+=n:t<f&&(_+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/_;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===s,o&&(u.poleAxis.value=o),u.dTheta.value=p,u.mipInt.value=Ks-n,u.inputEncoding.value=ro[t.texture.encoding],u.outputEncoding.value=ro[t.texture.encoding];const g=oo[r];yo(e,3*Math.max(0,to-2*g),(0===r?0:2*to)+2*g*(r>Ks-Qs?r-Ks+Qs:0),3*g,2*g),a.setRenderTarget(e),a.render(c,io)}}function mo(t){return void 0!==t&&t.type===Mt&&(t.encoding===Je||t.encoding===Ze||t.encoding===Qe)}function _o(){const t=[],e=[],n=[];let r=Ks;for(let i=0;i<no;i++){const s=Math.pow(2,r);e.push(s);let o=1/s;i>Ks-Qs?o=eo[i-Ks+Qs-1]:0==i&&(o=0),n.push(o);const a=1/(s-1),l=-a/2,c=1+a/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,p=6,d=3,f=2,m=1,_=new Float32Array(d*p*h),g=new Float32Array(f*p*h),y=new Float32Array(m*p*h);for(let t=0;t<h;t++){const e=t%3*2/3-1,n=t>2?0:-1,r=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];_.set(r,d*p*t),g.set(u,f*p*t);const i=[t,t,t,t,t,t];y.set(i,m*p*t)}const v=new ts;v.setAttribute("position",new Ni(_,d)),v.setAttribute("uv",new Ni(g,f)),v.setAttribute("faceIndex",new Ni(y,m)),t.push(v),r>Qs&&r--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}function go(t){const e=new rr(3*to,3*to,t);return e.texture.mapping=ct,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function yo(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function vo(){const t=new Yn(1,1);return new Zs({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:t},inputEncoding:{value:ro[Je]},outputEncoding:{value:ro[Je]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:v,depthTest:!1,depthWrite:!1})}function bo(){return new Zs({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:ro[Je]},outputEncoding:{value:ro[Je]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:v,depthTest:!1,depthWrite:!1})}function xo(t){let e=new WeakMap,n=null;function r(t){const n=t.target;n.removeEventListener("dispose",r);const i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){const s=i.mapping,o=s===at||s===lt,a=s===st||s===ot;if(o||a){if(e.has(i))return e.get(i).texture;{const s=i.image;if(o&&s&&s.height>0||a&&s&&function(t){let e=0;for(let n=0;n<6;n++)void 0!==t[n]&&e++;return 6===e}(s)){const s=t.getRenderTarget();null===n&&(n=new fo(t));const a=o?n.fromEquirectangular(i):n.fromCubemap(i);return e.set(i,a),t.setRenderTarget(s),i.addEventListener("dispose",r),a.texture}return null}}}return i},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function wo(t){const e={};function n(n){if(void 0!==e[n])return e[n];let r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return e[n]=r,r}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(t){const e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function So(t,e,n,r){const i={},s=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);a.removeEventListener("dispose",o),delete i[a.id];const l=s.get(a);l&&(e.remove(l),s.delete(a)),r.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){const n=[],r=t.index,i=t.attributes.position;let o=0;if(null!==r){const t=r.array;o=r.version;for(let e=0,r=t.length;e<r;e+=3){const r=t[e+0],i=t[e+1],s=t[e+2];n.push(r,i,i,s,s,r)}}else{const t=i.array;o=i.version;for(let e=0,r=t.length/3-1;e<r;e+=3){const t=e+0,r=e+1,i=e+2;n.push(t,r,r,i,i,t)}}const a=new(Hi(n)>65535?Ui:ki)(n,1);a.version=o;const l=s.get(t);l&&e.remove(l),s.set(t,a)}return{get:function(t,e){return!0===i[e.id]||(e.addEventListener("dispose",o),i[e.id]=!0,n.memory.geometries++),e},update:function(t){const n=t.attributes;for(const t in n)e.update(n[t],34962);const r=t.morphAttributes;for(const t in r){const n=r[t];for(let t=0,r=n.length;t<r;t++)e.update(n[t],34962)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return s.get(t)}}}function Mo(t,e,n,r){const i=r.isWebGL2;let s,o,a;this.setMode=function(t){s=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,r){t.drawElements(s,r,o,e*a),n.update(r,s,1)},this.renderInstances=function(r,l,c){if(0===c)return;let u,h;if(i)u=t,h="drawElementsInstanced";else if(u=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](s,l,o,r*a,c),n.update(l,s,c)}}function To(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,r){switch(e.calls++,n){case 4:e.triangles+=r*(t/3);break;case 1:e.lines+=r*(t/2);break;case 3:e.lines+=r*(t-1);break;case 2:e.lines+=r*t;break;case 0:e.points+=r*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Eo(t,e){return t[0]-e[0]}function Ao(t,e){return Math.abs(e[1])-Math.abs(t[1])}function $o(t){const e={},n=new Float32Array(8),r=[];for(let t=0;t<8;t++)r[t]=[t,0];return{update:function(i,s,o,a){const l=i.morphTargetInfluences,c=void 0===l?0:l.length;let u=e[s.id];if(void 0===u||u.length!==c){u=[];for(let t=0;t<c;t++)u[t]=[t,0];e[s.id]=u}for(let t=0;t<c;t++){const e=u[t];e[0]=t,e[1]=l[t]}u.sort(Ao);for(let t=0;t<8;t++)t<c&&u[t][1]?(r[t][0]=u[t][0],r[t][1]=u[t][1]):(r[t][0]=Number.MAX_SAFE_INTEGER,r[t][1]=0);r.sort(Eo);const h=s.morphAttributes.position,p=s.morphAttributes.normal;let d=0;for(let t=0;t<8;t++){const e=r[t],i=e[0],o=e[1];i!==Number.MAX_SAFE_INTEGER&&o?(h&&s.getAttribute("morphTarget"+t)!==h[i]&&s.setAttribute("morphTarget"+t,h[i]),p&&s.getAttribute("morphNormal"+t)!==p[i]&&s.setAttribute("morphNormal"+t,p[i]),n[t]=o,d+=o):(h&&!0===s.hasAttribute("morphTarget"+t)&&s.deleteAttribute("morphTarget"+t),p&&!0===s.hasAttribute("morphNormal"+t)&&s.deleteAttribute("morphNormal"+t),n[t]=0)}const f=s.morphTargetsRelative?1:1-d;a.getUniforms().setValue(t,"morphTargetBaseInfluence",f),a.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function Co(t,e,n,r){let i=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(t){const o=r.render.frame,a=t.geometry,l=e.get(t,a);return i.get(l)!==o&&(e.update(l),i.set(l,o)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",s)&&t.addEventListener("dispose",s),n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),l},dispose:function(){i=new WeakMap}}}class Bo extends tr{constructor(t=null,e=1,n=1,r=1){super(null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=ft,this.minFilter=ft,this.wrapR=pt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Bo.prototype.isDataTexture2DArray=!0;class Lo extends tr{constructor(t=null,e=1,n=1,r=1){super(null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=ft,this.minFilter=ft,this.wrapR=pt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Lo.prototype.isDataTexture3D=!0;const Ro=new tr,No=new Bo,Po=new Lo,Io=new Cs,Oo=[],Fo=[],ko=new Float32Array(16),Do=new Float32Array(9),Uo=new Float32Array(4);function zo(t,e,n){const r=t[0];if(r<=0||r>0)return t;const i=e*n;let s=Oo[i];if(void 0===s&&(s=new Float32Array(i),Oo[i]=s),0!==e){r.toArray(s,0);for(let r=1,i=0;r!==e;++r)i+=n,t[r].toArray(s,i)}return s}function jo(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Go(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function Ho(t,e){let n=Fo[e];void 0===n&&(n=new Int32Array(e),Fo[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function Vo(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Wo(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(jo(n,e))return;t.uniform2fv(this.addr,e),Go(n,e)}}function qo(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(jo(n,e))return;t.uniform3fv(this.addr,e),Go(n,e)}}function Xo(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(jo(n,e))return;t.uniform4fv(this.addr,e),Go(n,e)}}function Yo(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(jo(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Go(n,e)}else{if(jo(n,r))return;Uo.set(r),t.uniformMatrix2fv(this.addr,!1,Uo),Go(n,r)}}function Jo(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(jo(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Go(n,e)}else{if(jo(n,r))return;Do.set(r),t.uniformMatrix3fv(this.addr,!1,Do),Go(n,r)}}function Zo(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(jo(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Go(n,e)}else{if(jo(n,r))return;ko.set(r),t.uniformMatrix4fv(this.addr,!1,ko),Go(n,r)}}function Qo(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Ko(t,e){const n=this.cache;jo(n,e)||(t.uniform2iv(this.addr,e),Go(n,e))}function ta(t,e){const n=this.cache;jo(n,e)||(t.uniform3iv(this.addr,e),Go(n,e))}function ea(t,e){const n=this.cache;jo(n,e)||(t.uniform4iv(this.addr,e),Go(n,e))}function na(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function ra(t,e){const n=this.cache;jo(n,e)||(t.uniform2uiv(this.addr,e),Go(n,e))}function ia(t,e){const n=this.cache;jo(n,e)||(t.uniform3uiv(this.addr,e),Go(n,e))}function sa(t,e){const n=this.cache;jo(n,e)||(t.uniform4uiv(this.addr,e),Go(n,e))}function oa(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(e||Ro,i)}function aa(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||Po,i)}function la(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(e||Io,i)}function ca(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||No,i)}function ua(t,e){t.uniform1fv(this.addr,e)}function ha(t,e){const n=zo(e,this.size,2);t.uniform2fv(this.addr,n)}function pa(t,e){const n=zo(e,this.size,3);t.uniform3fv(this.addr,n)}function da(t,e){const n=zo(e,this.size,4);t.uniform4fv(this.addr,n)}function fa(t,e){const n=zo(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function ma(t,e){const n=zo(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function _a(t,e){const n=zo(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function ga(t,e){t.uniform1iv(this.addr,e)}function ya(t,e){t.uniform2iv(this.addr,e)}function va(t,e){t.uniform3iv(this.addr,e)}function ba(t,e){t.uniform4iv(this.addr,e)}function xa(t,e){t.uniform1uiv(this.addr,e)}function wa(t,e){t.uniform2uiv(this.addr,e)}function Sa(t,e){t.uniform3uiv(this.addr,e)}function Ma(t,e){t.uniform4uiv(this.addr,e)}function Ta(t,e,n){const r=e.length,i=Ho(n,r);t.uniform1iv(this.addr,i);for(let t=0;t!==r;++t)n.safeSetTexture2D(e[t]||Ro,i[t])}function Ea(t,e,n){const r=e.length,i=Ho(n,r);t.uniform1iv(this.addr,i);for(let t=0;t!==r;++t)n.safeSetTextureCube(e[t]||Io,i[t])}function Aa(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return Vo;case 35664:return Wo;case 35665:return qo;case 35666:return Xo;case 35674:return Yo;case 35675:return Jo;case 35676:return Zo;case 5124:case 35670:return Qo;case 35667:case 35671:return Ko;case 35668:case 35672:return ta;case 35669:case 35673:return ea;case 5125:return na;case 36294:return ra;case 36295:return ia;case 36296:return sa;case 35678:case 36198:case 36298:case 36306:case 35682:return oa;case 35679:case 36299:case 36307:return aa;case 35680:case 36300:case 36308:case 36293:return la;case 36289:case 36303:case 36311:case 36292:return ca}}(e.type)}function $a(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return ua;case 35664:return ha;case 35665:return pa;case 35666:return da;case 35674:return fa;case 35675:return ma;case 35676:return _a;case 5124:case 35670:return ga;case 35667:case 35671:return ya;case 35668:case 35672:return va;case 35669:case 35673:return ba;case 5125:return xa;case 36294:return wa;case 36295:return Sa;case 36296:return Ma;case 35678:case 36198:case 36298:case 36306:case 35682:return Ta;case 35680:case 36300:case 36308:case 36293:return Ea}}(e.type)}function Ca(t){this.id=t,this.seq=[],this.map={}}$a.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),Go(e,t)},Ca.prototype.setValue=function(t,e,n){const r=this.seq;for(let i=0,s=r.length;i!==s;++i){const s=r[i];s.setValue(t,e[s.id],n)}};const Ba=/(\w+)(\])?(\[|\.)?/g;function La(t,e){t.seq.push(e),t.map[e.id]=e}function Ra(t,e,n){const r=t.name,i=r.length;for(Ba.lastIndex=0;;){const s=Ba.exec(r),o=Ba.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===i){La(n,void 0===c?new Aa(a,t,e):new $a(a,t,e));break}{let t=n.map[a];void 0===t&&(t=new Ca(a),La(n,t)),n=t}}}function Na(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let r=0;r<n;++r){const n=t.getActiveUniform(e,r);Ra(n,t.getUniformLocation(e,n.name),this)}}function Pa(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}Na.prototype.setValue=function(t,e,n,r){const i=this.map[e];void 0!==i&&i.setValue(t,n,r)},Na.prototype.setOptional=function(t,e,n){const r=e[n];void 0!==r&&this.setValue(t,n,r)},Na.upload=function(t,e,n,r){for(let i=0,s=e.length;i!==s;++i){const s=e[i],o=n[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,r)}},Na.seqWithValue=function(t,e){const n=[];for(let r=0,i=t.length;r!==i;++r){const i=t[r];i.id in e&&n.push(i)}return n};let Ia=0;function Oa(t){switch(t){case Je:return["Linear","( value )"];case Ze:return["sRGB","( value )"];case Ke:return["RGBE","( value )"];case en:return["RGBM","( value, 7.0 )"];case nn:return["RGBM","( value, 16.0 )"];case rn:return["RGBD","( value, 256.0 )"];case Qe:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case tn:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function Fa(t,e,n){const r=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();return r&&""===i?"":n.toUpperCase()+"\n\n"+i+"\n\n"+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function ka(t,e){const n=Oa(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Da(t,e){const n=Oa(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Ua(t,e){let n;switch(e){case K:n="Linear";break;case tt:n="Reinhard";break;case et:n="OptimizedCineon";break;case nt:n="ACESFilmic";break;case rt:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function za(t){return""!==t}function ja(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Ga(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Ha=/^[ \t]*#include +<([\w\d./]+)>/gm;function Va(t){return t.replace(Ha,Wa)}function Wa(t,e){const n=zs[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return Va(n)}const qa=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Xa=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ya(t){return t.replace(Xa,Za).replace(qa,Ja)}function Ja(t,e,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Za(0,e,n,r)}function Za(t,e,n,r){let i="";for(let t=parseInt(e);t<parseInt(n);t++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return i}function Qa(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Ka(t,e,n,r){const i=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===h?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===p?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===d&&(e="SHADOWMAP_TYPE_VSM"),e}(n),c=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case st:case ot:e="ENVMAP_TYPE_CUBE";break;case ct:case ut:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),u=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case ot:case ut:e="ENVMAP_MODE_REFRACTION"}return e}(n),f=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Y:e="ENVMAP_BLENDING_MULTIPLY";break;case J:e="ENVMAP_BLENDING_MIX";break;case Z:e="ENVMAP_BLENDING_ADD"}return e}(n),m=t.gammaFactor>0?t.gammaFactor:1,_=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(za).join("\n")}(n),g=function(t){const e=[];for(const n in t){const r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}(s),y=i.createProgram();let v,b,x=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(v=[g].filter(za).join("\n"),v.length>0&&(v+="\n"),b=[_,g].filter(za).join("\n"),b.length>0&&(b+="\n")):(v=[Qa(n),"#define SHADER_NAME "+n.shaderName,g,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularTintMap?"#define USE_SPECULARTINTMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(za).join("\n"),b=[_,Qa(n),"#define SHADER_NAME "+n.shaderName,g,"#define GAMMA_FACTOR "+m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularTintMap?"#define USE_SPECULARTINTMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheenTint?"#define USE_SHEEN":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Q?"#define TONE_MAPPING":"",n.toneMapping!==Q?zs.tonemapping_pars_fragment:"",n.toneMapping!==Q?Ua("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.format===Ft?"#define OPAQUE":"",zs.encodings_pars_fragment,n.map?ka("mapTexelToLinear",n.mapEncoding):"",n.matcap?ka("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?ka("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?ka("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.specularTintMap?ka("specularTintMapTexelToLinear",n.specularTintMapEncoding):"",n.lightMap?ka("lightMapTexelToLinear",n.lightMapEncoding):"",Da("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(za).join("\n")),o=Va(o),o=ja(o,n),o=Ga(o,n),a=Va(a),a=ja(a,n),a=Ga(a,n),o=Ya(o),a=Ya(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(x="#version 300 es\n",v=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+v,b=["#define varying in",n.glslVersion===In?"":"out highp vec4 pc_fragColor;",n.glslVersion===In?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b);const w=x+b+a,S=Pa(i,35633,x+v+o),M=Pa(i,35632,w);if(i.attachShader(y,S),i.attachShader(y,M),void 0!==n.index0AttributeName?i.bindAttribLocation(y,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(y,0,"position"),i.linkProgram(y),t.debug.checkShaderErrors){const t=i.getProgramInfoLog(y).trim(),e=i.getShaderInfoLog(S).trim(),n=i.getShaderInfoLog(M).trim();let r=!0,s=!0;if(!1===i.getProgramParameter(y,35714)){r=!1;const e=Fa(i,S,"vertex"),n=Fa(i,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(y,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+n)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==n||(s=!1);s&&(this.diagnostics={runnable:r,programLog:t,vertexShader:{log:e,prefix:v},fragmentShader:{log:n,prefix:b}})}let T,E;return i.deleteShader(S),i.deleteShader(M),this.getUniforms=function(){return void 0===T&&(T=new Na(i,y)),T},this.getAttributes=function(){return void 0===E&&(E=function(t,e){const n={},r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const r=t.getActiveAttrib(e,i),s=r.name;let o=1;35674===r.type&&(o=2),35675===r.type&&(o=3),35676===r.type&&(o=4),n[s]={type:r.type,location:t.getAttribLocation(e,s),locationSize:o}}return n}(i,y)),E},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(y),this.program=void 0},this.name=n.shaderName,this.id=Ia++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=S,this.fragmentShader=M,this}function tl(t,e,n,r,i,s,o){const a=[],l=i.isWebGL2,c=i.logarithmicDepthBuffer,u=i.floatVertexTextures,h=i.maxVertexUniforms,p=i.vertexTextures;let d=i.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},g=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","sheenTint","transmission","transmissionMap","thicknessMap"];function y(t){let e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=Je,e}return{getParameters:function(s,a,g,v,b){const x=v.fog,w=s.isMeshStandardMaterial?v.environment:null,S=(s.isMeshStandardMaterial?n:e).get(s.envMap||w),M=f[s.type],T=b.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(u)return 1024;{const t=h,n=Math.floor((t-20)/4),r=Math.min(n,e.length);return r<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+r+"."),0):r}}(b):0;let E,A;if(null!==s.precision&&(d=i.getMaxPrecision(s.precision),d!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",d,"instead.")),M){const t=Gs[M];E=t.vertexShader,A=t.fragmentShader}else E=s.vertexShader,A=s.fragmentShader;const $=t.getRenderTarget(),C=s.alphaTest>0,B=s.clearcoat>0;return{isWebGL2:l,shaderID:M,shaderName:s.type,vertexShader:E,fragmentShader:A,defines:s.defines,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:d,instancing:!0===b.isInstancedMesh,instancingColor:!0===b.isInstancedMesh&&null!==b.instanceColor,supportsVertexTextures:p,outputEncoding:null!==$?y($.texture):t.outputEncoding,map:!!s.map,mapEncoding:y(s.map),matcap:!!s.matcap,matcapEncoding:y(s.matcap),envMap:!!S,envMapMode:S&&S.mapping,envMapEncoding:y(S),envMapCubeUV:!!S&&(S.mapping===ct||S.mapping===ut),lightMap:!!s.lightMap,lightMapEncoding:y(s.lightMap),aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,emissiveMapEncoding:y(s.emissiveMap),bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:s.normalMapType===ln,tangentSpaceNormalMap:s.normalMapType===an,clearcoat:B,clearcoatMap:B&&!!s.clearcoatMap,clearcoatRoughnessMap:B&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:B&&!!s.clearcoatNormalMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularTintMap:!!s.specularTintMap,specularTintMapEncoding:y(s.specularTintMap),alphaMap:!!s.alphaMap,alphaTest:C,gradientMap:!!s.gradientMap,sheenTint:!!s.sheenTint&&(s.sheenTint.r>0||s.sheenTint.g>0||s.sheenTint.b>0),transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!b.geometry&&!!b.geometry.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!b.geometry&&!!b.geometry.attributes.color&&4===b.geometry.attributes.color.itemSize,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.displacementMap||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularTintMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularTintMap||!s.displacementMap),fog:!!x,useFog:s.fog,fogExp2:x&&x.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:c,skinning:!0===b.isSkinnedMesh&&T>0,maxBones:T,useVertexTexture:u,morphTargets:!!b.geometry&&!!b.geometry.morphAttributes.position,morphNormals:!!b.geometry&&!!b.geometry.morphAttributes.normal,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,format:s.format,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&g.length>0,shadowMapType:t.shadowMap.type,toneMapping:s.toneMapped?t.toneMapping:Q,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===_,flipSided:s.side===m,depthPacking:void 0!==s.depthPacking&&s.depthPacking,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||r.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<g.length;t++)n.push(e[g[t]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=f[t.type];let n;if(e){const t=Gs[e];n=Ss.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let r;for(let t=0,e=a.length;t<e;t++){const e=a[t];if(e.cacheKey===n){r=e,++r.usedTimes;break}}return void 0===r&&(r=new Ka(t,n,e,s),a.push(r)),r},releaseProgram:function(t){if(0==--t.usedTimes){const e=a.indexOf(t);a[e]=a[a.length-1],a.pop(),t.destroy()}},programs:a}}function el(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new WeakMap}}}function nl(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function rl(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function il(t){const e=[];let n=0;const r=[],i=[],s=[],o={id:-1};function a(r,i,s,a,l,c){let u=e[n];const h=t.get(s);return void 0===u?(u={id:r.id,object:r,geometry:i,material:s,program:h.program||o,groupOrder:a,renderOrder:r.renderOrder,z:l,group:c},e[n]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=s,u.program=h.program||o,u.groupOrder=a,u.renderOrder=r.renderOrder,u.z=l,u.group=c),n++,u}return{opaque:r,transmissive:i,transparent:s,init:function(){n=0,r.length=0,i.length=0,s.length=0},push:function(t,e,n,o,l,c){const u=a(t,e,n,o,l,c);n.transmission>0?i.push(u):!0===n.transparent?s.push(u):r.push(u)},unshift:function(t,e,n,o,l,c){const u=a(t,e,n,o,l,c);n.transmission>0?i.unshift(u):!0===n.transparent?s.unshift(u):r.unshift(u)},finish:function(){for(let t=n,r=e.length;t<r;t++){const n=e[t];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(t,e){r.length>1&&r.sort(t||nl),i.length>1&&i.sort(e||rl),s.length>1&&s.sort(e||rl)}}}function sl(t){let e=new WeakMap;return{get:function(n,r){let i;return!1===e.has(n)?(i=new il(t),e.set(n,[i])):r>=e.get(n).length?(i=new il(t),e.get(n).push(i)):i=e.get(n)[r],i},dispose:function(){e=new WeakMap}}}function ol(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new ar,color:new Ci};break;case"SpotLight":n={position:new ar,direction:new ar,color:new Ci,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new ar,color:new Ci,distance:0,decay:0};break;case"HemisphereLight":n={direction:new ar,skyColor:new Ci,groundColor:new Ci};break;case"RectAreaLight":n={color:new Ci,position:new ar,halfWidth:new ar,halfHeight:new ar}}return t[e.id]=n,n}}}let al=0;function ll(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function cl(t,e){const n=new ol,r=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Yn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Yn,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)i.probe.push(new ar);const s=new ar,o=new kr,a=new kr;return{setup:function(s,o){let a=0,l=0,c=0;for(let t=0;t<9;t++)i.probe[t].set(0,0,0);let u=0,h=0,p=0,d=0,f=0,m=0,_=0,g=0;s.sort(ll);const y=!0!==o?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],o=e.color,v=e.intensity,b=e.distance,x=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=o.r*v*y,l+=o.g*v*y,c+=o.b*v*y;else if(e.isLightProbe)for(let t=0;t<9;t++)i.probe[t].addScaledVector(e.sh.coefficients[t],v);else if(e.isDirectionalLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,i.directionalShadow[u]=n,i.directionalShadowMap[u]=x,i.directionalShadowMatrix[u]=e.shadow.matrix,m++}i.directional[u]=t,u++}else if(e.isSpotLight){const t=n.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(o).multiplyScalar(v*y),t.distance=b,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,i.spotShadow[p]=n,i.spotShadowMap[p]=x,i.spotShadowMatrix[p]=e.shadow.matrix,g++}i.spot[p]=t,p++}else if(e.isRectAreaLight){const t=n.get(e);t.color.copy(o).multiplyScalar(v),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),i.rectArea[d]=t,d++}else if(e.isPointLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,i.pointShadow[h]=n,i.pointShadowMap[h]=x,i.pointShadowMatrix[h]=e.shadow.matrix,_++}i.point[h]=t,h++}else if(e.isHemisphereLight){const t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(v*y),t.groundColor.copy(e.groundColor).multiplyScalar(v*y),i.hemi[f]=t,f++}}d>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(i.rectAreaLTC1=js.LTC_FLOAT_1,i.rectAreaLTC2=js.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=js.LTC_HALF_1,i.rectAreaLTC2=js.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=a,i.ambient[1]=l,i.ambient[2]=c;const v=i.hash;v.directionalLength===u&&v.pointLength===h&&v.spotLength===p&&v.rectAreaLength===d&&v.hemiLength===f&&v.numDirectionalShadows===m&&v.numPointShadows===_&&v.numSpotShadows===g||(i.directional.length=u,i.spot.length=p,i.rectArea.length=d,i.point.length=h,i.hemi.length=f,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=_,i.pointShadowMap.length=_,i.spotShadow.length=g,i.spotShadowMap.length=g,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=_,i.spotShadowMatrix.length=g,v.directionalLength=u,v.pointLength=h,v.spotLength=p,v.rectAreaLength=d,v.hemiLength=f,v.numDirectionalShadows=m,v.numPointShadows=_,v.numSpotShadows=g,i.version=al++)},setupView:function(t,e){let n=0,r=0,l=0,c=0,u=0;const h=e.matrixWorldInverse;for(let e=0,p=t.length;e<p;e++){const p=t[e];if(p.isDirectionalLight){const t=i.directional[n];t.direction.setFromMatrixPosition(p.matrixWorld),s.setFromMatrixPosition(p.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(h),n++}else if(p.isSpotLight){const t=i.spot[l];t.position.setFromMatrixPosition(p.matrixWorld),t.position.applyMatrix4(h),t.direction.setFromMatrixPosition(p.matrixWorld),s.setFromMatrixPosition(p.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(h),l++}else if(p.isRectAreaLight){const t=i.rectArea[c];t.position.setFromMatrixPosition(p.matrixWorld),t.position.applyMatrix4(h),a.identity(),o.copy(p.matrixWorld),o.premultiply(h),a.extractRotation(o),t.halfWidth.set(.5*p.width,0,0),t.halfHeight.set(0,.5*p.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),c++}else if(p.isPointLight){const t=i.point[r];t.position.setFromMatrixPosition(p.matrixWorld),t.position.applyMatrix4(h),r++}else if(p.isHemisphereLight){const t=i.hemi[u];t.direction.setFromMatrixPosition(p.matrixWorld),t.direction.transformDirection(h),t.direction.normalize(),u++}}},state:i}}function ul(t,e){const n=new cl(t,e),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(t){n.setup(r,t)},setupLightsView:function(t){n.setupView(r,t)},pushLight:function(t){r.push(t)},pushShadow:function(t){i.push(t)}}}function hl(t,e){let n=new WeakMap;return{get:function(r,i=0){let s;return!1===n.has(r)?(s=new ul(t,e),n.set(r,[s])):i>=n.get(r).length?(s=new ul(t,e),n.get(r).push(s)):s=n.get(r)[i],s},dispose:function(){n=new WeakMap}}}class pl extends wi{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=sn,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}pl.prototype.isMeshDepthMaterial=!0;class dl extends wi{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new ar,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}dl.prototype.isMeshDistanceMaterial=!0;var fl="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\nuniform float samples;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",ml="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function _l(t,e,n){let r=new Fs;const i=new Yn,s=new Yn,o=new nr,a=new pl({depthPacking:on}),l=new dl,c={},u=n.maxTextureSize,p={0:m,1:f,2:_},g=new Ms({uniforms:{shadow_pass:{value:null},resolution:{value:new Yn},radius:{value:4},samples:{value:8}},vertexShader:ml,fragmentShader:fl}),y=g.clone();y.defines.HORIZONTAL_PASS=1;const b=new ts;b.setAttribute("position",new Ni(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const x=new ys(b,g),w=this;function S(n,r){const i=e.update(x);g.uniforms.shadow_pass.value=n.map.texture,g.uniforms.resolution.value=n.mapSize,g.uniforms.radius.value=n.radius,g.uniforms.samples.value=n.blurSamples,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(r,null,i,g,x,null),y.uniforms.shadow_pass.value=n.mapPass.texture,y.uniforms.resolution.value=n.mapSize,y.uniforms.radius.value=n.radius,y.uniforms.samples.value=n.blurSamples,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(r,null,i,y,x,null)}function M(e,n,r,i,s,o,u){let h=null;const f=!0===i.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(h=void 0!==f?f:!0===i.isPointLight?l:a,t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length||r.displacementMap&&0!==r.displacementScale||r.alphaMap&&r.alphaTest>0){const t=h.uuid,e=r.uuid;let n=c[t];void 0===n&&(n={},c[t]=n);let i=n[e];void 0===i&&(i=h.clone(),n[e]=i),h=i}return h.visible=r.visible,h.wireframe=r.wireframe,h.side=u===d?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:p[r.side],h.alphaMap=r.alphaMap,h.alphaTest=r.alphaTest,h.clipShadows=r.clipShadows,h.clippingPlanes=r.clippingPlanes,h.clipIntersection=r.clipIntersection,h.displacementMap=r.displacementMap,h.displacementScale=r.displacementScale,h.displacementBias=r.displacementBias,h.wireframeLinewidth=r.wireframeLinewidth,h.linewidth=r.linewidth,!0===i.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(i.matrixWorld),h.nearDistance=s,h.farDistance=o),h}function T(n,i,s,o,a){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===d)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const r=e.update(n),i=n.material;if(Array.isArray(i)){const e=r.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],u=i[c.materialIndex];if(u&&u.visible){const e=M(n,0,u,o,s.near,s.far,a);t.renderBufferDirect(s,null,r,e,n,c)}}}else if(i.visible){const e=M(n,0,i,o,s.near,s.far,a);t.renderBufferDirect(s,null,r,e,n,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)T(l[t],i,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=h,this.render=function(e,n,a){if(!1===w.enabled)return;if(!1===w.autoUpdate&&!1===w.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),c=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),p=t.state;p.setBlending(v),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(let l=0,c=e.length;l<c;l++){const c=e[l],h=c.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const f=h.getFrameExtents();if(i.multiply(f),s.copy(h.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/f.x),i.x=s.x*f.x,h.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/f.y),i.y=s.y*f.y,h.mapSize.y=s.y)),null===h.map&&!h.isPointLightShadow&&this.type===d){const t={minFilter:vt,magFilter:vt,format:kt};h.map=new rr(i.x,i.y,t),h.map.texture.name=c.name+".shadowMap",h.mapPass=new rr(i.x,i.y,t),h.camera.updateProjectionMatrix()}if(null===h.map){const t={minFilter:ft,magFilter:ft,format:kt};h.map=new rr(i.x,i.y,t),h.map.texture.name=c.name+".shadowMap",h.camera.updateProjectionMatrix()}t.setRenderTarget(h.map),t.clear();const m=h.getViewportCount();for(let t=0;t<m;t++){const e=h.getViewport(t);o.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),p.viewport(o),h.updateMatrices(c,t),r=h.getFrustum(),T(n,a,h.camera,c,this.type)}h.isPointLightShadow||this.type!==d||S(h,a),h.needsUpdate=!1}w.needsUpdate=!1,t.setRenderTarget(l,c,h)}}function gl(t,e,n){const r=n.isWebGL2,i=new function(){let e=!1;const n=new nr;let r=null;const i=new nr(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,s,o,a){!0===a&&(e*=o,r*=o,s*=o),n.set(e,r,s,o),!1===i.equals(n)&&(t.clearColor(e,r,s,o),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},s=new function(){let e=!1,n=null,r=null,i=null;return{setTest:function(t){t?yt(2929):vt(2929)},setMask:function(r){n===r||e||(t.depthMask(r),n=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case z:t.depthFunc(512);break;case j:t.depthFunc(519);break;case G:t.depthFunc(513);break;case H:t.depthFunc(515);break;case V:t.depthFunc(514);break;case W:t.depthFunc(518);break;case q:t.depthFunc(516);break;case X:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);r=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,n=null,r=null,i=null}}},c=new function(){let e=!1,n=null,r=null,i=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(t){e||(t?yt(2960):vt(2960))},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,o){r===e&&i===n&&s===o||(t.stencilFunc(e,n,o),r=e,i=n,s=o)},setOp:function(e,n,r){o===e&&a===n&&l===r||(t.stencilOp(e,n,r),o=e,a=n,l=r)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,r=null,i=null,s=null,o=null,a=null,l=null,c=null}}};let u={},h=null,p={},d=null,f=!1,g=null,y=null,Y=null,J=null,Z=null,Q=null,K=null,tt=!1,et=null,nt=null,rt=null,it=null,st=null;const ot=t.getParameter(35661);let at=!1,lt=0;const ct=t.getParameter(7938);-1!==ct.indexOf("WebGL")?(lt=parseFloat(/^WebGL (\d)/.exec(ct)[1]),at=lt>=1):-1!==ct.indexOf("OpenGL ES")&&(lt=parseFloat(/^OpenGL ES (\d)/.exec(ct)[1]),at=lt>=2);let ut=null,ht={};const pt=t.getParameter(3088),dt=t.getParameter(2978),ft=(new nr).fromArray(pt),mt=(new nr).fromArray(dt);function _t(e,n,r){const i=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<r;e++)t.texImage2D(n+e,0,6408,1,1,0,6408,5121,i);return s}const gt={};function yt(e){!0!==u[e]&&(t.enable(e),u[e]=!0)}function vt(e){!1!==u[e]&&(t.disable(e),u[e]=!1)}gt[3553]=_t(3553,3553,1),gt[34067]=_t(34067,34069,6),i.setClear(0,0,0,1),s.setClear(1),c.setClear(0),yt(2929),s.setFunc(H),St(!1),Mt(a),yt(2884),wt(v);const bt={[T]:32774,[E]:32778,[A]:32779};if(r)bt[$]=32775,bt[C]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(bt[$]=t.MIN_EXT,bt[C]=t.MAX_EXT)}const xt={[B]:0,[L]:1,[R]:768,[P]:770,[U]:776,[k]:774,[O]:772,[N]:769,[I]:771,[D]:775,[F]:773};function wt(e,n,r,i,s,o,a,l){if(e!==v){if(!1===f&&(yt(3042),f=!0),e===M)s=s||n,o=o||r,a=a||i,n===y&&s===Z||(t.blendEquationSeparate(bt[n],bt[s]),y=n,Z=s),r===Y&&i===J&&o===Q&&a===K||(t.blendFuncSeparate(xt[r],xt[i],xt[o],xt[a]),Y=r,J=i,Q=o,K=a),g=e,tt=null;else if(e!==g||l!==tt){if(y===T&&Z===T||(t.blendEquation(32774),y=T,Z=T),l)switch(e){case b:t.blendFuncSeparate(1,771,1,771);break;case x:t.blendFunc(1,1);break;case w:t.blendFuncSeparate(0,0,769,771);break;case S:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case b:t.blendFuncSeparate(770,771,1,771);break;case x:t.blendFunc(770,1);break;case w:t.blendFunc(0,769);break;case S:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}Y=null,J=null,Q=null,K=null,g=e,tt=l}}else!0===f&&(vt(3042),f=!1)}function St(e){et!==e&&(e?t.frontFace(2304):t.frontFace(2305),et=e)}function Mt(e){e!==o?(yt(2884),e!==nt&&(e===a?t.cullFace(1029):e===l?t.cullFace(1028):t.cullFace(1032))):vt(2884),nt=e}function Tt(e,n,r){e?(yt(32823),it===n&&st===r||(t.polygonOffset(n,r),it=n,st=r)):vt(32823)}function Et(e){void 0===e&&(e=33984+ot-1),ut!==e&&(t.activeTexture(e),ut=e)}return{buffers:{color:i,depth:s,stencil:c},enable:yt,disable:vt,bindFramebuffer:function(e,n){return null===n&&null!==h&&(n=h),p[e]!==n&&(t.bindFramebuffer(e,n),p[e]=n,r&&(36009===e&&(p[36160]=n),36160===e&&(p[36009]=n)),!0)},bindXRFramebuffer:function(e){e!==h&&(t.bindFramebuffer(36160,e),h=e)},useProgram:function(e){return d!==e&&(t.useProgram(e),d=e,!0)},setBlending:wt,setMaterial:function(t,e){t.side===_?vt(2884):yt(2884);let n=t.side===m;e&&(n=!n),St(n),t.blending===b&&!1===t.transparent?wt(v):wt(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),i.setMask(t.colorWrite);const r=t.stencilWrite;c.setTest(r),r&&(c.setMask(t.stencilWriteMask),c.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),c.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),Tt(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?yt(32926):vt(32926)},setFlipSided:St,setCullFace:Mt,setLineWidth:function(e){e!==rt&&(at&&t.lineWidth(e),rt=e)},setPolygonOffset:Tt,setScissorTest:function(t){t?yt(3089):vt(3089)},activeTexture:Et,bindTexture:function(e,n){null===ut&&Et();let r=ht[ut];void 0===r&&(r={type:void 0,texture:void 0},ht[ut]=r),r.type===e&&r.texture===n||(t.bindTexture(e,n||gt[e]),r.type=e,r.texture=n)},unbindTexture:function(){const e=ht[ut];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===ft.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),ft.copy(e))},viewport:function(e){!1===mt.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),mt.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===r&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),u={},ut=null,ht={},h=null,p={},d=null,f=!1,g=null,y=null,Y=null,J=null,Z=null,Q=null,K=null,tt=!1,et=null,nt=null,rt=null,it=null,st=null,ft.set(0,0,t.canvas.width,t.canvas.height),mt.set(0,0,t.canvas.width,t.canvas.height),i.reset(),s.reset(),c.reset()}}}function yl(t,e,n,r,i,s,o){const a=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,h=i.maxSamples,p=new WeakMap;let d,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function m(t,e){return f?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function _(t,e,n,r){let i=1;if((t.width>r||t.height>r)&&(i=r/Math.max(t.width,t.height)),i<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const r=e?qn:Math.floor,s=r(i*t.width),o=r(i*t.height);void 0===d&&(d=m(s,o));const a=n?m(s,o):d;return a.width=s,a.height=o,a.getContext("2d").drawImage(t,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+o+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function g(t){return Vn(t.width)&&Vn(t.height)}function y(t,e){return t.generateMipmaps&&e&&t.minFilter!==ft&&t.minFilter!==vt}function v(e,n,i,s,o=1){t.generateMipmap(e),r.get(n).__maxMipLevel=Math.log2(Math.max(i,s,o))}function b(n,r,i){if(!1===a)return r;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let s=r;return 6403===r&&(5126===i&&(s=33326),5131===i&&(s=33325),5121===i&&(s=33321)),6407===r&&(5126===i&&(s=34837),5131===i&&(s=34843),5121===i&&(s=32849)),6408===r&&(5126===i&&(s=34836),5131===i&&(s=34842),5121===i&&(s=32856)),33325!==s&&33326!==s&&34842!==s&&34836!==s||e.get("EXT_color_buffer_float"),s}function x(t){return t===ft||t===mt||t===gt?9728:9729}function w(e){const n=e.target;n.removeEventListener("dispose",w),function(e){const n=r.get(e);void 0!==n.__webglInit&&(t.deleteTexture(n.__webglTexture),r.remove(e))}(n),n.isVideoTexture&&p.delete(n),o.memory.textures--}function S(e){const n=e.target;n.removeEventListener("dispose",S),function(e){const n=e.texture,i=r.get(e),s=r.get(n);if(e){if(void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),o.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(i.__webglFramebuffer[e]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[e]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&t.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&t.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&t.deleteRenderbuffer(i.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,i=n.length;e<i;e++){const i=r.get(n[e]);i.__webglTexture&&(t.deleteTexture(i.__webglTexture),o.memory.textures--),r.remove(n[e])}r.remove(n),r.remove(e)}}(n)}let M=0;function T(t,e){const i=r.get(t);if(t.isVideoTexture&&function(t){const e=o.render.frame;p.get(t)!==e&&(p.set(t,e),t.update())}(t),t.version>0&&i.__version!==t.version){const n=t.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void L(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,i.__webglTexture)}function E(e,i){const o=r.get(e);e.version>0&&o.__version!==e.version?function(e,r,i){if(6!==r.image.length)return;B(e,r),n.activeTexture(33984+i),n.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),t.pixelStorei(37443,0);const o=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),l=r.image[0]&&r.image[0].isDataTexture,u=[];for(let t=0;t<6;t++)u[t]=o||l?l?r.image[t].image:r.image[t]:_(r.image[t],!1,!0,c);const h=u[0],p=g(h)||a,d=s.convert(r.format),f=s.convert(r.type),m=b(r.internalFormat,d,f);let x;if(C(34067,r,p),o){for(let t=0;t<6;t++){x=u[t].mipmaps;for(let e=0;e<x.length;e++){const i=x[e];r.format!==kt&&r.format!==Ft?null!==d?n.compressedTexImage2D(34069+t,e,m,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+t,e,m,i.width,i.height,0,d,f,i.data)}}e.__maxMipLevel=x.length-1}else{x=r.mipmaps;for(let t=0;t<6;t++)if(l){n.texImage2D(34069+t,0,m,u[t].width,u[t].height,0,d,f,u[t].data);for(let e=0;e<x.length;e++){const r=x[e].image[t].image;n.texImage2D(34069+t,e+1,m,r.width,r.height,0,d,f,r.data)}}else{n.texImage2D(34069+t,0,m,d,f,u[t]);for(let e=0;e<x.length;e++){const r=x[e];n.texImage2D(34069+t,e+1,m,d,f,r.image[t])}}e.__maxMipLevel=x.length}y(r,p)&&v(34067,r,h.width,h.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}(o,e,i):(n.activeTexture(33984+i),n.bindTexture(34067,o.__webglTexture))}const A={[ht]:10497,[pt]:33071,[dt]:33648},$={[ft]:9728,[mt]:9984,[gt]:9986,[vt]:9729,[bt]:9985,[wt]:9987};function C(n,s,o){if(o?(t.texParameteri(n,10242,A[s.wrapS]),t.texParameteri(n,10243,A[s.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,A[s.wrapR]),t.texParameteri(n,10240,$[s.magFilter]),t.texParameteri(n,10241,$[s.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),s.wrapS===pt&&s.wrapT===pt||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,x(s.magFilter)),t.texParameteri(n,10241,x(s.minFilter)),s.minFilter!==ft&&s.minFilter!==vt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const o=e.get("EXT_texture_filter_anisotropic");if(s.type===Bt&&!1===e.has("OES_texture_float_linear"))return;if(!1===a&&s.type===Lt&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||r.get(s).__currentAnisotropy)&&(t.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,i.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy)}}function B(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",w),e.__webglTexture=t.createTexture(),o.memory.textures++)}function L(e,r,i){let o=3553;r.isDataTexture2DArray&&(o=35866),r.isDataTexture3D&&(o=32879),B(e,r),n.activeTexture(33984+i),n.bindTexture(o,e.__webglTexture),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),t.pixelStorei(37443,0);const l=function(t){return!a&&(t.wrapS!==pt||t.wrapT!==pt||t.minFilter!==ft&&t.minFilter!==vt)}(r)&&!1===g(r.image),c=_(r.image,l,!1,u),h=g(c)||a,p=s.convert(r.format);let d,f=s.convert(r.type),m=b(r.internalFormat,p,f);C(o,r,h);const x=r.mipmaps;if(r.isDepthTexture)m=6402,a?m=r.type===Bt?36012:r.type===Ct?33190:r.type===It?35056:33189:r.type===Bt&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===jt&&6402===m&&r.type!==At&&r.type!==Ct&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=At,f=s.convert(r.type)),r.format===Gt&&6402===m&&(m=34041,r.type!==It&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=It,f=s.convert(r.type))),n.texImage2D(3553,0,m,c.width,c.height,0,p,f,null);else if(r.isDataTexture)if(x.length>0&&h){for(let t=0,e=x.length;t<e;t++)d=x[t],n.texImage2D(3553,t,m,d.width,d.height,0,p,f,d.data);r.generateMipmaps=!1,e.__maxMipLevel=x.length-1}else n.texImage2D(3553,0,m,c.width,c.height,0,p,f,c.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(let t=0,e=x.length;t<e;t++)d=x[t],r.format!==kt&&r.format!==Ft?null!==p?n.compressedTexImage2D(3553,t,m,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,t,m,d.width,d.height,0,p,f,d.data);e.__maxMipLevel=x.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,m,c.width,c.height,c.depth,0,p,f,c.data),e.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,m,c.width,c.height,c.depth,0,p,f,c.data),e.__maxMipLevel=0;else if(x.length>0&&h){for(let t=0,e=x.length;t<e;t++)d=x[t],n.texImage2D(3553,t,m,p,f,d);r.generateMipmaps=!1,e.__maxMipLevel=x.length-1}else n.texImage2D(3553,0,m,p,f,c),e.__maxMipLevel=0;y(r,h)&&v(o,r,c.width,c.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function R(e,i,o,a,l){const c=s.convert(o.format),u=s.convert(o.type),h=b(o.internalFormat,c,u);32879===l||35866===l?n.texImage3D(l,0,h,i.width,i.height,i.depth,0,c,u,null):n.texImage2D(l,0,h,i.width,i.height,0,c,u,null),n.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,a,l,r.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function N(e,n,r){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let i=33189;if(r){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===Bt?i=36012:e.type===Ct&&(i=33190));const r=P(n);t.renderbufferStorageMultisample(36161,r,i,n.width,n.height)}else t.renderbufferStorage(36161,i,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){if(r){const e=P(n);t.renderbufferStorageMultisample(36161,e,35056,n.width,n.height)}else t.renderbufferStorage(36161,34041,n.width,n.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,i=s.convert(e.format),o=s.convert(e.type),a=b(e.internalFormat,i,o);if(r){const e=P(n);t.renderbufferStorageMultisample(36161,e,a,n.width,n.height)}else t.renderbufferStorage(36161,a,n.width,n.height)}t.bindRenderbuffer(36161,null)}function P(t){return a&&t.isWebGLMultisampleRenderTarget?Math.min(h,t.samples):0}let I=!1,O=!1;this.allocateTextureUnit=function(){const t=M;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),M+=1,t},this.resetTextureUnits=function(){M=0},this.setTexture2D=T,this.setTexture2DArray=function(t,e){const i=r.get(t);t.version>0&&i.__version!==t.version?L(i,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(t,e){const i=r.get(t);t.version>0&&i.__version!==t.version?L(i,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=E,this.setupRenderTarget=function(e){const l=e.texture,c=r.get(e),u=r.get(l);e.addEventListener("dispose",S),!0!==e.isWebGLMultipleRenderTargets&&(u.__webglTexture=t.createTexture(),u.__version=l.version,o.memory.textures++);const h=!0===e.isWebGLCubeRenderTarget,p=!0===e.isWebGLMultipleRenderTargets,d=!0===e.isWebGLMultisampleRenderTarget,f=l.isDataTexture3D||l.isDataTexture2DArray,m=g(e)||a;if(!a||l.format!==Ft||l.type!==Bt&&l.type!==Lt||(l.format=kt,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),h){c.__webglFramebuffer=[];for(let e=0;e<6;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else if(c.__webglFramebuffer=t.createFramebuffer(),p)if(i.drawBuffers){const n=e.texture;for(let e=0,i=n.length;e<i;e++){const i=r.get(n[e]);void 0===i.__webglTexture&&(i.__webglTexture=t.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(d)if(a){c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const r=s.convert(l.format),i=s.convert(l.type),o=b(l.internalFormat,r,i),a=P(e);t.renderbufferStorageMultisample(36161,a,o,e.width,e.height),n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),N(c.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){n.bindTexture(34067,u.__webglTexture),C(34067,l,m);for(let t=0;t<6;t++)R(c.__webglFramebuffer[t],e,l,36064,34069+t);y(l,m)&&v(34067,l,e.width,e.height),n.unbindTexture()}else if(p){const t=e.texture;for(let i=0,s=t.length;i<s;i++){const s=t[i],o=r.get(s);n.bindTexture(3553,o.__webglTexture),C(3553,s,m),R(c.__webglFramebuffer,e,s,36064+i,3553),y(s,m)&&v(3553,s,e.width,e.height)}n.unbindTexture()}else{let t=3553;f&&(a?t=l.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),n.bindTexture(t,u.__webglTexture),C(t,l,m),R(c.__webglFramebuffer,e,l,36064,t),y(l,m)&&v(t,l,e.width,e.height,e.depth),n.unbindTexture()}e.depthBuffer&&function(e){const i=r.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),T(i.depthTexture,0);const s=r.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===jt)t.framebufferTexture2D(36160,36096,3553,s,0);else{if(i.depthTexture.format!==Gt)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,s,0)}}(i.__webglFramebuffer,e)}else if(s){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(36160,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=t.createRenderbuffer(),N(i.__webglDepthbuffer[r],e,!1)}else n.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),N(i.__webglDepthbuffer,e,!1);n.bindFramebuffer(36160,null)}(e)},this.updateRenderTargetMipmap=function(t){const e=g(t)||a,i=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,o=i.length;s<o;s++){const o=i[s];if(y(o,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,i=r.get(o).__webglTexture;n.bindTexture(e,i),v(e,o,t.width,t.height),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(a){const i=e.width,s=e.height;let o=16384;e.depthBuffer&&(o|=256),e.stencilBuffer&&(o|=1024);const a=r.get(e);n.bindFramebuffer(36008,a.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,a.__webglFramebuffer),t.blitFramebuffer(0,0,i,s,0,0,i,s,o,9728),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,a.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===I&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),I=!0),t=t.texture),T(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===O&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),O=!0),t=t.texture),E(t,e)}}function vl(t,e,n){const r=n.isWebGL2;return{convert:function(t){let n;if(t===Mt)return 5121;if(t===Rt)return 32819;if(t===Nt)return 32820;if(t===Pt)return 33635;if(t===Tt)return 5120;if(t===Et)return 5122;if(t===At)return 5123;if(t===$t)return 5124;if(t===Ct)return 5125;if(t===Bt)return 5126;if(t===Lt)return r?5131:(n=e.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(t===Ot)return 6406;if(t===Ft)return 6407;if(t===kt)return 6408;if(t===Dt)return 6409;if(t===Ut)return 6410;if(t===jt)return 6402;if(t===Gt)return 34041;if(t===Ht)return 6403;if(t===Vt)return 36244;if(t===Wt)return 33319;if(t===qt)return 33320;if(t===Xt)return 36248;if(t===Yt)return 36249;if(t===Jt||t===Zt||t===Qt||t===Kt){if(n=e.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(t===Jt)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Zt)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Qt)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Kt)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===te||t===ee||t===ne||t===re){if(n=e.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(t===te)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===ee)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===ne)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===re)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===ie)return n=e.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===se||t===oe)&&(n=e.get("WEBGL_compressed_texture_etc"),null!==n)){if(t===se)return n.COMPRESSED_RGB8_ETC2;if(t===oe)return n.COMPRESSED_RGBA8_ETC2_EAC}return t===ae||t===le||t===ce||t===ue||t===he||t===pe||t===de||t===fe||t===me||t===_e||t===ge||t===ye||t===ve||t===be||t===we||t===Se||t===Me||t===Te||t===Ee||t===Ae||t===$e||t===Ce||t===Be||t===Le||t===Re||t===Ne||t===Pe||t===Ie?(n=e.get("WEBGL_compressed_texture_astc"),null!==n?t:null):t===xe?(n=e.get("EXT_texture_compression_bptc"),null!==n?t:null):t===It?r?34042:(n=e.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class bl extends Es{constructor(t=[]){super(),this.cameras=t}}bl.prototype.isArrayCamera=!0;class xl extends ci{constructor(){super(),this.type="Group"}}xl.prototype.isGroup=!0;const wl={type:"move"};class Sl{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new xl,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new xl,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ar,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ar),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new xl,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ar,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ar),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let r=null,i=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==o&&(r=e.getPose(t.targetRaySpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(wl))),l&&t.hand){s=!0;for(const r of t.hand.values()){const t=e.getJointPose(r,n);if(void 0===l.joints[r.jointName]){const t=new xl;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[r.jointName]=t,l.add(t)}const i=l.joints[r.jointName];null!==t&&(i.matrix.fromArray(t.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=t.radius),i.visible=null!==t}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],o=r.position.distanceTo(i.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(i=e.getPose(t.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==r),null!==a&&(a.visible=null!==i),null!==l&&(l.visible=null!==s),this}}class Ml extends On{constructor(t,e){super();const n=this,r=t.state;let i=null,s=1,o=null,a="local-floor",l=null,c=null,u=null,h=null,p=null,d=!1,f=null,m=null,_=null,g=null,y=null,v=null;const b=[],x=new Map,w=new Es;w.layers.enable(1),w.viewport=new nr;const S=new Es;S.layers.enable(2),S.viewport=new nr;const M=[w,S],T=new bl;T.layers.enable(1),T.layers.enable(2);let E=null,A=null;function $(t){const e=x.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function C(){x.forEach((function(t,e){t.disconnect(e)})),x.clear(),E=null,A=null,r.bindXRFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),u&&e.deleteFramebuffer(u),f&&e.deleteFramebuffer(f),m&&e.deleteRenderbuffer(m),_&&e.deleteRenderbuffer(_),u=null,f=null,m=null,_=null,p=null,h=null,c=null,i=null,I.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function B(t){const e=i.inputSources;for(let t=0;t<b.length;t++)x.set(e[t],b[t]);for(let e=0;e<t.removed.length;e++){const n=t.removed[e],r=x.get(n);r&&(r.dispatchEvent({type:"disconnected",data:n}),x.delete(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e],r=x.get(n);r&&r.dispatchEvent({type:"connected",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=b[t];return void 0===e&&(e=new Sl,b[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=b[t];return void 0===e&&(e=new Sl,b[t]=e),e.getGripSpace()},this.getHand=function(t){let e=b[t];return void 0===e&&(e=new Sl,b[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){s=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getBaseLayer=function(){return null!==h?h:p},this.getBinding=function(){return c},this.getFrame=function(){return g},this.getSession=function(){return i},this.setSession=async function(t){if(i=t,null!==i){i.addEventListener("select",$),i.addEventListener("selectstart",$),i.addEventListener("selectend",$),i.addEventListener("squeeze",$),i.addEventListener("squeezestart",$),i.addEventListener("squeezeend",$),i.addEventListener("end",C),i.addEventListener("inputsourceschange",B);const t=e.getContextAttributes();if(!0!==t.xrCompatible&&await e.makeXRCompatible(),void 0===i.renderState.layers){const n={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(i,e,n),i.updateRenderState({baseLayer:p})}else if(e instanceof WebGLRenderingContext){const n={antialias:!0,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(i,e,n),i.updateRenderState({layers:[p]})}else{d=t.antialias;let n=null;t.depth&&(v=256,t.stencil&&(v|=1024),y=t.stencil?33306:36096,n=t.stencil?35056:33190);const o={colorFormat:t.alpha?32856:32849,depthFormat:n,scaleFactor:s};c=new XRWebGLBinding(i,e),h=c.createProjectionLayer(o),u=e.createFramebuffer(),i.updateRenderState({layers:[h]}),d&&(f=e.createFramebuffer(),m=e.createRenderbuffer(),e.bindRenderbuffer(36161,m),e.renderbufferStorageMultisample(36161,4,32856,h.textureWidth,h.textureHeight),r.bindFramebuffer(36160,f),e.framebufferRenderbuffer(36160,36064,36161,m),e.bindRenderbuffer(36161,null),null!==n&&(_=e.createRenderbuffer(),e.bindRenderbuffer(36161,_),e.renderbufferStorageMultisample(36161,4,n,h.textureWidth,h.textureHeight),e.framebufferRenderbuffer(36160,y,36161,_),e.bindRenderbuffer(36161,null)),r.bindFramebuffer(36160,null))}o=await i.requestReferenceSpace(a),I.setContext(i),I.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const L=new ar,R=new ar;function N(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===i)return;T.near=S.near=w.near=t.near,T.far=S.far=w.far=t.far,E===T.near&&A===T.far||(i.updateRenderState({depthNear:T.near,depthFar:T.far}),E=T.near,A=T.far);const e=t.parent,n=T.cameras;N(T,e);for(let t=0;t<n.length;t++)N(n[t],e);T.matrixWorld.decompose(T.position,T.quaternion,T.scale),t.position.copy(T.position),t.quaternion.copy(T.quaternion),t.scale.copy(T.scale),t.matrix.copy(T.matrix),t.matrixWorld.copy(T.matrixWorld);const r=t.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(!0);2===n.length?function(t,e,n){L.setFromMatrixPosition(e.matrixWorld),R.setFromMatrixPosition(n.matrixWorld);const r=L.distanceTo(R),i=e.projectionMatrix.elements,s=n.projectionMatrix.elements,o=i[14]/(i[10]-1),a=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(s[8]+1)/s[0],p=o*u,d=o*h,f=r/(-u+h),m=f*-u;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const _=o+f,g=a+f,y=p-m,v=d+(r-m),b=l*a/g*_,x=c*a/g*_;t.projectionMatrix.makePerspective(y,v,b,x,_,g)}(T,w,S):T.projectionMatrix.copy(w.projectionMatrix)},this.getCamera=function(){return T},this.getFoveation=function(){return null!==h?h.fixedFoveation:null!==p?p.fixedFoveation:void 0},this.setFoveation=function(t){null!==h&&(h.fixedFoveation=t),null!==p&&void 0!==p.fixedFoveation&&(p.fixedFoveation=t)};let P=null;const I=new ks;I.setAnimationLoop((function(t,n){if(l=n.getViewerPose(o),g=n,null!==l){const t=l.views;null!==p&&r.bindXRFramebuffer(p.framebuffer);let n=!1;t.length!==T.cameras.length&&(T.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const s=t[i];let o=null;if(null!==p)o=p.getViewport(s);else{const t=c.getViewSubImage(h,s);r.bindXRFramebuffer(u),void 0!==t.depthStencilTexture&&e.framebufferTexture2D(36160,y,3553,t.depthStencilTexture,0),e.framebufferTexture2D(36160,36064,3553,t.colorTexture,0),o=t.viewport}const a=M[i];a.matrix.fromArray(s.transform.matrix),a.projectionMatrix.fromArray(s.projectionMatrix),a.viewport.set(o.x,o.y,o.width,o.height),0===i&&T.matrix.copy(a.matrix),!0===n&&T.cameras.push(a)}d&&(r.bindXRFramebuffer(f),null!==v&&e.clear(v))}const s=i.inputSources;for(let t=0;t<b.length;t++){const e=b[t],r=s[t];e.update(r,n,o)}if(P&&P(t,n),d){const t=h.textureWidth,n=h.textureHeight;r.bindFramebuffer(36008,f),r.bindFramebuffer(36009,u),e.invalidateFramebuffer(36008,[y]),e.invalidateFramebuffer(36009,[y]),e.blitFramebuffer(0,0,t,n,0,0,t,n,16384,9728),e.invalidateFramebuffer(36008,[36064]),r.bindFramebuffer(36008,null),r.bindFramebuffer(36009,null),r.bindFramebuffer(36160,f)}g=null})),this.setAnimationLoop=function(t){P=t},this.dispose=function(){}}}function Tl(t){function e(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap),n.alphaTest>0&&(e.alphaTest.value=n.alphaTest);const r=t.get(n).envMap;if(r){e.envMap.value=r,e.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,e.reflectivity.value=n.reflectivity,e.ior.value=n.ior,e.refractionRatio.value=n.refractionRatio;const i=t.get(r).__maxMipLevel;void 0!==i&&(e.maxMipLevel.value=i)}let i,s;n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap?i=n.clearcoatRoughnessMap:n.specularIntensityMap?i=n.specularIntensityMap:n.specularTintMap?i=n.specularTintMap:n.transmissionMap?i=n.transmissionMap:n.thicknessMap&&(i=n.thicknessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix)),n.aoMap?s=n.aoMap:n.lightMap&&(s=n.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uv2Transform.value.copy(s.matrix))}function n(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,n.side===m&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),n.side===m&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias),t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,r,i,s,o){r.isMeshBasicMaterial?e(t,r):r.isMeshLambertMaterial?(e(t,r),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,r)):r.isMeshToonMaterial?(e(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshPhongMaterial?(e(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshStandardMaterial?(e(t,r),r.isMeshPhysicalMaterial?function(t,e,r){n(t,e),t.ior.value=e.ior,e.sheenTint&&t.sheenTint.value.copy(e.sheenTint),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===m&&t.clearcoatNormalScale.value.negate())),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=r.texture,t.transmissionSamplerSize.value.set(r.width,r.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationTint.value.copy(e.attenuationTint)),t.specularIntensity.value=e.specularIntensity,t.specularTint.value.copy(e.specularTint),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap),e.specularTintMap&&(t.specularTintMap.value=e.specularTintMap)}(t,r,o):n(t,r)):r.isMeshMatcapMaterial?(e(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDepthMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDistanceMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,r)):r.isMeshNormalMaterial?(e(t,r),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,n,r){let i;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*r,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?i=e.map:e.alphaMap&&(i=e.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,r,i,s):r.isSpriteMaterial?function(t,e){let n;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?n=e.map:e.alphaMap&&(n=e.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function El(t={}){const e=void 0!==t.canvas?t.canvas:function(){const t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return t.style.display="block",t}(),n=void 0!==t.context?t.context:null,r=void 0!==t.alpha&&t.alpha,i=void 0===t.depth||t.depth,s=void 0===t.stencil||t.stencil,o=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.powerPreference?t.powerPreference:"default",u=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let h=null,p=null;const d=[],g=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Je,this.physicallyCorrectLights=!1,this.toneMapping=Q,this.toneMappingExposure=1;const y=this;let v=!1,b=0,x=0,w=null,S=-1,M=null;const T=new nr,E=new nr;let A=null,$=e.width,C=e.height,B=1,L=null,R=null;const N=new nr(0,0,$,C),P=new nr(0,0,$,C);let I=!1;const O=[],F=new Fs;let k=!1,D=!1,U=null;const z=new kr,j=new ar,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function H(){return null===w?B:1}let V,W,q,X,Y,J,Z,K,tt,et,nt,rt,it,st,ot,at,lt,ct,ut,ht,dt,mt,_t,gt=n;function yt(t,n){for(let r=0;r<t.length;r++){const i=t[r],s=e.getContext(i,n);if(null!==s)return s}return null}try{const t={alpha:r,depth:i,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(e.addEventListener("webglcontextlost",xt,!1),e.addEventListener("webglcontextrestored",St,!1),null===gt){const e=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&e.shift(),gt=yt(e,t),null===gt)throw yt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===gt.getShaderPrecisionFormat&&(gt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function vt(){V=new wo(gt),W=new qs(gt,V,t),V.init(W),mt=new vl(gt,V,W),q=new gl(gt,V,W),O[0]=1029,X=new To(gt),Y=new el,J=new yl(gt,V,q,Y,W,mt,X),Z=new Ys(y),K=new xo(y),tt=new Ds(gt,W),_t=new Vs(gt,V,tt,W),et=new So(gt,tt,X,_t),nt=new Co(gt,et,tt,X),ut=new $o(gt),at=new Xs(Y),rt=new tl(y,Z,K,V,W,_t,at),it=new Tl(Y),st=new sl(Y),ot=new hl(V,W),ct=new Hs(y,Z,q,nt,a),lt=new _l(y,nt,W),ht=new Ws(gt,V,X,W),dt=new Mo(gt,V,X,W),X.programs=rt.programs,y.capabilities=W,y.extensions=V,y.properties=Y,y.renderLists=st,y.shadowMap=lt,y.state=q,y.info=X}vt();const bt=new Ml(y,gt);function xt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function St(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;const t=X.autoReset,e=lt.enabled,n=lt.autoUpdate,r=lt.needsUpdate,i=lt.type;vt(),X.autoReset=t,lt.enabled=e,lt.autoUpdate=n,lt.needsUpdate=r,lt.type=i}function Tt(t){const e=t.target;e.removeEventListener("dispose",Tt),function(t){(function(t){const e=Y.get(t).programs;void 0!==e&&e.forEach((function(t){rt.releaseProgram(t)}))})(t),Y.remove(t)}(e)}this.xr=bt,this.getContext=function(){return gt},this.getContextAttributes=function(){return gt.getContextAttributes()},this.forceContextLoss=function(){const t=V.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=V.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return B},this.setPixelRatio=function(t){void 0!==t&&(B=t,this.setSize($,C,!1))},this.getSize=function(t){return t.set($,C)},this.setSize=function(t,n,r){bt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):($=t,C=n,e.width=Math.floor(t*B),e.height=Math.floor(n*B),!1!==r&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set($*B,C*B).floor()},this.setDrawingBufferSize=function(t,n,r){$=t,C=n,B=r,e.width=Math.floor(t*r),e.height=Math.floor(n*r),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(T)},this.getViewport=function(t){return t.copy(N)},this.setViewport=function(t,e,n,r){t.isVector4?N.set(t.x,t.y,t.z,t.w):N.set(t,e,n,r),q.viewport(T.copy(N).multiplyScalar(B).floor())},this.getScissor=function(t){return t.copy(P)},this.setScissor=function(t,e,n,r){t.isVector4?P.set(t.x,t.y,t.z,t.w):P.set(t,e,n,r),q.scissor(E.copy(P).multiplyScalar(B).floor())},this.getScissorTest=function(){return I},this.setScissorTest=function(t){q.setScissorTest(I=t)},this.setOpaqueSort=function(t){L=t},this.setTransparentSort=function(t){R=t},this.getClearColor=function(t){return t.copy(ct.getClearColor())},this.setClearColor=function(){ct.setClearColor.apply(ct,arguments)},this.getClearAlpha=function(){return ct.getClearAlpha()},this.setClearAlpha=function(){ct.setClearAlpha.apply(ct,arguments)},this.clear=function(t,e,n){let r=0;(void 0===t||t)&&(r|=16384),(void 0===e||e)&&(r|=256),(void 0===n||n)&&(r|=1024),gt.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",xt,!1),e.removeEventListener("webglcontextrestored",St,!1),st.dispose(),ot.dispose(),Y.dispose(),Z.dispose(),K.dispose(),nt.dispose(),_t.dispose(),bt.dispose(),bt.removeEventListener("sessionstart",At),bt.removeEventListener("sessionend",$t),U&&(U.dispose(),U=null),Ct.stop()},this.renderBufferImmediate=function(t,e){_t.initAttributes();const n=Y.get(t);t.hasPositions&&!n.position&&(n.position=gt.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=gt.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=gt.createBuffer()),t.hasColors&&!n.color&&(n.color=gt.createBuffer());const r=e.getAttributes();t.hasPositions&&(gt.bindBuffer(34962,n.position),gt.bufferData(34962,t.positionArray,35048),_t.enableAttribute(r.position.location),gt.vertexAttribPointer(r.position.location,3,5126,!1,0,0)),t.hasNormals&&(gt.bindBuffer(34962,n.normal),gt.bufferData(34962,t.normalArray,35048),_t.enableAttribute(r.normal.location),gt.vertexAttribPointer(r.normal.location,3,5126,!1,0,0)),t.hasUvs&&(gt.bindBuffer(34962,n.uv),gt.bufferData(34962,t.uvArray,35048),_t.enableAttribute(r.uv.location),gt.vertexAttribPointer(r.uv.location,2,5126,!1,0,0)),t.hasColors&&(gt.bindBuffer(34962,n.color),gt.bufferData(34962,t.colorArray,35048),_t.enableAttribute(r.color.location),gt.vertexAttribPointer(r.color.location,3,5126,!1,0,0)),_t.disableUnusedAttributes(),gt.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,r,i,s){null===e&&(e=G);const o=i.isMesh&&i.matrixWorld.determinant()<0,a=Dt(t,e,r,i);q.setMaterial(r,o);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,h=1;!0===r.wireframe&&(l=et.getWireframeAttribute(n),h=2),void 0===n.morphAttributes.position&&void 0===n.morphAttributes.normal||ut.update(i,n,r,a),_t.setup(i,r,a,n,l);let p=ht;null!==l&&(u=tt.get(l),p=dt,p.setIndex(u));const d=null!==l?l.count:c.count,f=n.drawRange.start*h,m=n.drawRange.count*h,_=null!==s?s.start*h:0,g=null!==s?s.count*h:1/0,y=Math.max(f,_),v=Math.min(d,f+m,_+g)-1,b=Math.max(0,v-y+1);if(0!==b){if(i.isMesh)!0===r.wireframe?(q.setLineWidth(r.wireframeLinewidth*H()),p.setMode(1)):p.setMode(4);else if(i.isLine){let t=r.linewidth;void 0===t&&(t=1),q.setLineWidth(t*H()),i.isLineSegments?p.setMode(1):i.isLineLoop?p.setMode(2):p.setMode(3)}else i.isPoints?p.setMode(0):i.isSprite&&p.setMode(4);if(i.isInstancedMesh)p.renderInstances(y,b,i.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);p.renderInstances(y,b,t)}else p.render(y,b)}},this.compile=function(t,e){p=ot.get(t),p.init(),g.push(p),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(p.pushLight(t),t.castShadow&&p.pushShadow(t))})),p.setupLights(y.physicallyCorrectLights),t.traverse((function(e){const n=e.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++)Ot(n[r],t,e);else Ot(n,t,e)})),g.pop(),p=null};let Et=null;function At(){Ct.stop()}function $t(){Ct.start()}const Ct=new ks;function Rt(t,e,n,r){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)p.pushLight(t),t.castShadow&&p.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||F.intersectsSprite(t)){r&&j.setFromMatrixPosition(t.matrixWorld).applyMatrix4(z);const e=nt.update(t),i=t.material;i.visible&&h.push(t,e,i,n,j.z,null)}}else if(t.isImmediateRenderObject)r&&j.setFromMatrixPosition(t.matrixWorld).applyMatrix4(z),h.push(t,null,t.material,n,j.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==X.render.frame&&(t.skeleton.update(),t.skeleton.frame=X.render.frame),!t.frustumCulled||F.intersectsObject(t))){r&&j.setFromMatrixPosition(t.matrixWorld).applyMatrix4(z);const e=nt.update(t),i=t.material;if(Array.isArray(i)){const r=e.groups;for(let s=0,o=r.length;s<o;s++){const o=r[s],a=i[o.materialIndex];a&&a.visible&&h.push(t,e,a,n,j.z,o)}}else i.visible&&h.push(t,e,i,n,j.z,null)}const i=t.children;for(let t=0,s=i.length;t<s;t++)Rt(i[t],e,n,r)}function Nt(t,e,n,r){const i=t.opaque,s=t.transmissive,a=t.transparent;p.setupLightsView(n),s.length>0&&function(t,e,n){if(null===U){const t=!0===o&&!0===W.isWebGL2;U=new(t?sr:rr)(1024,1024,{generateMipmaps:!0,type:null!==mt.convert(Lt)?Lt:Mt,minFilter:wt,magFilter:ft,wrapS:pt,wrapT:pt})}const r=y.getRenderTarget();y.setRenderTarget(U),y.clear();const i=y.toneMapping;y.toneMapping=Q,Pt(t,e,n),y.toneMapping=i,J.updateMultisampleRenderTarget(U),J.updateRenderTargetMipmap(U),y.setRenderTarget(r)}(i,e,n),r&&q.viewport(T.copy(r)),i.length>0&&Pt(i,e,n),s.length>0&&Pt(s,e,n),a.length>0&&Pt(a,e,n)}function Pt(t,e,n){const r=!0===e.isScene?e.overrideMaterial:null;for(let i=0,s=t.length;i<s;i++){const s=t[i],o=s.object,a=s.geometry,l=null===r?s.material:r,c=s.group;o.layers.test(n.layers)&&It(o,e,n,a,l,c)}}function It(t,e,n,r,i,s){if(t.onBeforeRender(y,e,n,r,i,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){const r=Dt(n,e,i,t);q.setMaterial(i),_t.reset(),function(t,e){t.render((function(t){y.renderBufferImmediate(t,e)}))}(t,r)}else!0===i.transparent&&i.side===_?(i.side=m,i.needsUpdate=!0,y.renderBufferDirect(n,e,r,i,t,s),i.side=f,i.needsUpdate=!0,y.renderBufferDirect(n,e,r,i,t,s),i.side=_):y.renderBufferDirect(n,e,r,i,t,s);t.onAfterRender(y,e,n,r,i,s)}function Ot(t,e,n){!0!==e.isScene&&(e=G);const r=Y.get(t),i=p.state.lights,s=p.state.shadowsArray,o=i.state.version,a=rt.getParameters(t,i.state,s,e,n),l=rt.getProgramCacheKey(a);let c=r.programs;r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.envMap=(t.isMeshStandardMaterial?K:Z).get(t.envMap||r.environment),void 0===c&&(t.addEventListener("dispose",Tt),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===o)return Ft(t,a),u}else a.uniforms=rt.getUniforms(t),t.onBuild(a,y),t.onBeforeCompile(a,y),u=rt.acquireProgram(a,l),c.set(l,u),r.uniforms=a.uniforms;const h=r.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(h.clippingPlanes=at.uniform),Ft(t,a),r.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const d=u.getUniforms(),f=Na.seqWithValue(d.seq,h);return r.currentProgram=u,r.uniformsList=f,u}function Ft(t,e){const n=Y.get(t);n.outputEncoding=e.outputEncoding,n.instancing=e.instancing,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents}function Dt(t,e,n,r){!0!==e.isScene&&(e=G),J.resetTextureUnits();const i=e.fog,s=n.isMeshStandardMaterial?e.environment:null,o=null===w?y.outputEncoding:w.texture.encoding,a=(n.isMeshStandardMaterial?K:Z).get(n.envMap||s),l=!0===n.vertexColors&&!!r.geometry&&!!r.geometry.attributes.color&&4===r.geometry.attributes.color.itemSize,c=!!r.geometry&&!!r.geometry.attributes.tangent,u=!!r.geometry&&!!r.geometry.morphAttributes.position,h=!!r.geometry&&!!r.geometry.morphAttributes.normal,d=Y.get(n),f=p.state.lights;if(!0===k&&(!0===D||t!==M)){const e=t===M&&n.id===S;at.setState(n,t,e)}let m=!1;n.version===d.__version?d.needsLights&&d.lightsStateVersion!==f.state.version||d.outputEncoding!==o||r.isInstancedMesh&&!1===d.instancing?m=!0:r.isInstancedMesh||!0!==d.instancing?r.isSkinnedMesh&&!1===d.skinning?m=!0:r.isSkinnedMesh||!0!==d.skinning?d.envMap!==a||n.fog&&d.fog!==i?m=!0:void 0===d.numClippingPlanes||d.numClippingPlanes===at.numPlanes&&d.numIntersection===at.numIntersection?(d.vertexAlphas!==l||d.vertexTangents!==c||d.morphTargets!==u||d.morphNormals!==h)&&(m=!0):m=!0:m=!0:m=!0:(m=!0,d.__version=n.version);let _=d.currentProgram;!0===m&&(_=Ot(n,e,r));let g=!1,v=!1,b=!1;const x=_.getUniforms(),T=d.uniforms;if(q.useProgram(_.program)&&(g=!0,v=!0,b=!0),n.id!==S&&(S=n.id,v=!0),g||M!==t){if(x.setValue(gt,"projectionMatrix",t.projectionMatrix),W.logarithmicDepthBuffer&&x.setValue(gt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),M!==t&&(M=t,v=!0,b=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=x.map.cameraPosition;void 0!==e&&e.setValue(gt,j.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&x.setValue(gt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&x.setValue(gt,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){x.setOptional(gt,r,"bindMatrix"),x.setOptional(gt,r,"bindMatrixInverse");const t=r.skeleton;t&&(W.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),x.setValue(gt,"boneTexture",t.boneTexture,J),x.setValue(gt,"boneTextureSize",t.boneTextureSize)):x.setOptional(gt,t,"boneMatrices"))}var E,A;return(v||d.receiveShadow!==r.receiveShadow)&&(d.receiveShadow=r.receiveShadow,x.setValue(gt,"receiveShadow",r.receiveShadow)),v&&(x.setValue(gt,"toneMappingExposure",y.toneMappingExposure),d.needsLights&&(A=b,(E=T).ambientLightColor.needsUpdate=A,E.lightProbe.needsUpdate=A,E.directionalLights.needsUpdate=A,E.directionalLightShadows.needsUpdate=A,E.pointLights.needsUpdate=A,E.pointLightShadows.needsUpdate=A,E.spotLights.needsUpdate=A,E.spotLightShadows.needsUpdate=A,E.rectAreaLights.needsUpdate=A,E.hemisphereLights.needsUpdate=A),i&&n.fog&&it.refreshFogUniforms(T,i),it.refreshMaterialUniforms(T,n,B,C,U),Na.upload(gt,d.uniformsList,T,J)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Na.upload(gt,d.uniformsList,T,J),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&x.setValue(gt,"center",r.center),x.setValue(gt,"modelViewMatrix",r.modelViewMatrix),x.setValue(gt,"normalMatrix",r.normalMatrix),x.setValue(gt,"modelMatrix",r.matrixWorld),_}Ct.setAnimationLoop((function(t){Et&&Et(t)})),"undefined"!=typeof window&&Ct.setContext(window),this.setAnimationLoop=function(t){Et=t,bt.setAnimationLoop(t),null===t?Ct.stop():Ct.start()},bt.addEventListener("sessionstart",At),bt.addEventListener("sessionend",$t),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===v)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===bt.enabled&&!0===bt.isPresenting&&(!0===bt.cameraAutoUpdate&&bt.updateCamera(e),e=bt.getCamera()),!0===t.isScene&&t.onBeforeRender(y,t,e,w),p=ot.get(t,g.length),p.init(),g.push(p),z.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),F.setFromProjectionMatrix(z),D=this.localClippingEnabled,k=at.init(this.clippingPlanes,D,e),h=st.get(t,d.length),h.init(),d.push(h),Rt(t,e,0,y.sortObjects),h.finish(),!0===y.sortObjects&&h.sort(L,R),!0===k&&at.beginShadows();const n=p.state.shadowsArray;if(lt.render(n,t,e),!0===k&&at.endShadows(),!0===this.info.autoReset&&this.info.reset(),ct.render(h,t),p.setupLights(y.physicallyCorrectLights),e.isArrayCamera){const n=e.cameras;for(let e=0,r=n.length;e<r;e++){const r=n[e];Nt(h,t,r,r.viewport)}}else Nt(h,t,e);null!==w&&(J.updateMultisampleRenderTarget(w),J.updateRenderTargetMipmap(w)),!0===t.isScene&&t.onAfterRender(y,t,e),q.buffers.depth.setTest(!0),q.buffers.depth.setMask(!0),q.buffers.color.setMask(!0),q.setPolygonOffset(!1),_t.resetDefaultState(),S=-1,M=null,g.pop(),p=g.length>0?g[g.length-1]:null,d.pop(),h=d.length>0?d[d.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return w},this.setRenderTarget=function(t,e=0,n=0){w=t,b=e,x=n,t&&void 0===Y.get(t).__webglFramebuffer&&J.setupRenderTarget(t);let r=null,i=!1,s=!1;if(t){const n=t.texture;(n.isDataTexture3D||n.isDataTexture2DArray)&&(s=!0);const o=Y.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=o[e],i=!0):r=t.isWebGLMultisampleRenderTarget?Y.get(t).__webglMultisampledFramebuffer:o,T.copy(t.viewport),E.copy(t.scissor),A=t.scissorTest}else T.copy(N).multiplyScalar(B).floor(),E.copy(P).multiplyScalar(B).floor(),A=I;if(q.bindFramebuffer(36160,r)&&W.drawBuffers){let e=!1;if(t)if(t.isWebGLMultipleRenderTargets){const n=t.texture;if(O.length!==n.length||36064!==O[0]){for(let t=0,e=n.length;t<e;t++)O[t]=36064+t;O.length=n.length,e=!0}}else 1===O.length&&36064===O[0]||(O[0]=36064,O.length=1,e=!0);else 1===O.length&&1029===O[0]||(O[0]=1029,O.length=1,e=!0);e&&(W.isWebGL2?gt.drawBuffers(O):V.get("WEBGL_draw_buffers").drawBuffersWEBGL(O))}if(q.viewport(T),q.scissor(E),q.setScissorTest(A),i){const r=Y.get(t.texture);gt.framebufferTexture2D(36160,36064,34069+e,r.__webglTexture,n)}else if(s){const r=Y.get(t.texture),i=e||0;gt.framebufferTextureLayer(36160,36064,r.__webglTexture,n||0,i)}S=-1},this.readRenderTargetPixels=function(t,e,n,r,i,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=Y.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){q.bindFramebuffer(36160,a);try{const o=t.texture,a=o.format,l=o.type;if(a!==kt&&mt.convert(a)!==gt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===Lt&&(V.has("EXT_color_buffer_half_float")||W.isWebGL2&&V.has("EXT_color_buffer_float"));if(!(l===Mt||mt.convert(l)===gt.getParameter(35738)||l===Bt&&(W.isWebGL2||V.has("OES_texture_float")||V.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===gt.checkFramebufferStatus(36160)?e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i&&gt.readPixels(e,n,r,i,mt.convert(a),mt.convert(l),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const t=null!==w?Y.get(w).__webglFramebuffer:null;q.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,n=0){const r=Math.pow(2,-n),i=Math.floor(e.image.width*r),s=Math.floor(e.image.height*r);let o=mt.convert(e.format);W.isWebGL2&&(6407===o&&(o=32849),6408===o&&(o=32856)),J.setTexture2D(e,0),gt.copyTexImage2D(3553,n,o,t.x,t.y,i,s,0),q.unbindTexture()},this.copyTextureToTexture=function(t,e,n,r=0){const i=e.image.width,s=e.image.height,o=mt.convert(n.format),a=mt.convert(n.type);J.setTexture2D(n,0),gt.pixelStorei(37440,n.flipY),gt.pixelStorei(37441,n.premultiplyAlpha),gt.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?gt.texSubImage2D(3553,r,t.x,t.y,i,s,o,a,e.image.data):e.isCompressedTexture?gt.compressedTexSubImage2D(3553,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):gt.texSubImage2D(3553,r,t.x,t.y,o,a,e.image),0===r&&n.generateMipmaps&&gt.generateMipmap(3553),q.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,r,i=0){if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,a=t.max.z-t.min.z+1,l=mt.convert(r.format),c=mt.convert(r.type);let u;if(r.isDataTexture3D)J.setTexture3D(r,0),u=32879;else{if(!r.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");J.setTexture2DArray(r,0),u=35866}gt.pixelStorei(37440,r.flipY),gt.pixelStorei(37441,r.premultiplyAlpha),gt.pixelStorei(3317,r.unpackAlignment);const h=gt.getParameter(3314),p=gt.getParameter(32878),d=gt.getParameter(3316),f=gt.getParameter(3315),m=gt.getParameter(32877),_=n.isCompressedTexture?n.mipmaps[0]:n.image;gt.pixelStorei(3314,_.width),gt.pixelStorei(32878,_.height),gt.pixelStorei(3316,t.min.x),gt.pixelStorei(3315,t.min.y),gt.pixelStorei(32877,t.min.z),n.isDataTexture||n.isDataTexture3D?gt.texSubImage3D(u,i,e.x,e.y,e.z,s,o,a,l,c,_.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),gt.compressedTexSubImage3D(u,i,e.x,e.y,e.z,s,o,a,l,_.data)):gt.texSubImage3D(u,i,e.x,e.y,e.z,s,o,a,l,c,_),gt.pixelStorei(3314,h),gt.pixelStorei(32878,p),gt.pixelStorei(3316,d),gt.pixelStorei(3315,f),gt.pixelStorei(32877,m),0===i&&r.generateMipmaps&&gt.generateMipmap(u),q.unbindTexture()},this.initTexture=function(t){J.setTexture2D(t,0),q.unbindTexture()},this.resetState=function(){b=0,x=0,w=null,q.reset(),_t.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Al extends El{}Al.prototype.isWebGL1Renderer=!0;class $l{constructor(t,e=25e-5){this.name="",this.color=new Ci(t),this.density=e}clone(){return new $l(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}$l.prototype.isFogExp2=!0;class Cl{constructor(t,e=1,n=1e3){this.name="",this.color=new Ci(t),this.near=e,this.far=n}clone(){return new Cl(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Cl.prototype.isFog=!0;class Bl extends ci{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}Bl.prototype.isScene=!0;class Ll{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Tn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=zn()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=zn()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=zn()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Ll.prototype.isInterleavedBuffer=!0;const Rl=new ar;class Nl{constructor(t,e,n,r=!1){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)Rl.x=this.getX(e),Rl.y=this.getY(e),Rl.z=this.getZ(e),Rl.applyMatrix4(t),this.setXYZ(e,Rl.x,Rl.y,Rl.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Rl.x=this.getX(e),Rl.y=this.getY(e),Rl.z=this.getZ(e),Rl.applyNormalMatrix(t),this.setXYZ(e,Rl.x,Rl.y,Rl.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Rl.x=this.getX(e),Rl.y=this.getY(e),Rl.z=this.getZ(e),Rl.transformDirection(t),this.setXYZ(e,Rl.x,Rl.y,Rl.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new Ni(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Nl(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Nl.prototype.isInterleavedBufferAttribute=!0;class Pl extends wi{constructor(t){super(),this.type="SpriteMaterial",this.color=new Ci(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}let Il;Pl.prototype.isSpriteMaterial=!0;const Ol=new ar,Fl=new ar,kl=new ar,Dl=new Yn,Ul=new Yn,zl=new kr,jl=new ar,Gl=new ar,Hl=new ar,Vl=new Yn,Wl=new Yn,ql=new Yn;class Xl extends ci{constructor(t){if(super(),this.type="Sprite",void 0===Il){Il=new ts;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new Ll(t,5);Il.setIndex([0,1,2,0,2,3]),Il.setAttribute("position",new Nl(e,3,0,!1)),Il.setAttribute("uv",new Nl(e,2,3,!1))}this.geometry=Il,this.material=void 0!==t?t:new Pl,this.center=new Yn(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Fl.setFromMatrixScale(this.matrixWorld),zl.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),kl.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Fl.multiplyScalar(-kl.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const s=this.center;Yl(jl.set(-.5,-.5,0),kl,s,Fl,r,i),Yl(Gl.set(.5,-.5,0),kl,s,Fl,r,i),Yl(Hl.set(.5,.5,0),kl,s,Fl,r,i),Vl.set(0,0),Wl.set(1,0),ql.set(1,1);let o=t.ray.intersectTriangle(jl,Gl,Hl,!1,Ol);if(null===o&&(Yl(Gl.set(-.5,.5,0),kl,s,Fl,r,i),Wl.set(0,1),o=t.ray.intersectTriangle(jl,Hl,Gl,!1,Ol),null===o))return;const a=t.ray.origin.distanceTo(Ol);a<t.near||a>t.far||e.push({distance:a,point:Ol.clone(),uv:bi.getUV(Ol,jl,Gl,Hl,Vl,Wl,ql,new Yn),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function Yl(t,e,n,r,i,s){Dl.subVectors(t,n).addScalar(.5).multiply(r),void 0!==i?(Ul.x=s*Dl.x-i*Dl.y,Ul.y=i*Dl.x+s*Dl.y):Ul.copy(Dl),t.copy(e),t.x+=Ul.x,t.y+=Ul.y,t.applyMatrix4(zl)}Xl.prototype.isSprite=!0;const Jl=new ar,Zl=new ar;class Ql extends ci{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,n=e.length;t<n;t++){const n=e[t];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0){e=Math.abs(e);const n=this.levels;let r;for(r=0;r<n.length&&!(e<n[r].distance);r++);return n.splice(r,0,{distance:e,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let n,r;for(n=1,r=e.length;n<r&&!(t<e[n].distance);n++);return e[n-1].object}return null}raycast(t,e){if(this.levels.length>0){Jl.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(Jl);this.getObjectForDistance(n).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){Jl.setFromMatrixPosition(t.matrixWorld),Zl.setFromMatrixPosition(this.matrixWorld);const n=Jl.distanceTo(Zl)/t.zoom;let r,i;for(e[0].object.visible=!0,r=1,i=e.length;r<i&&n>=e[r].distance;r++)e[r-1].object.visible=!1,e[r].object.visible=!0;for(this._currentLevel=r-1;r<i;r++)e[r].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let t=0,r=n.length;t<r;t++){const r=n[t];e.object.levels.push({object:r.object.uuid,distance:r.distance})}return e}}const Kl=new ar,tc=new nr,ec=new nr,nc=new ar,rc=new kr;class ic extends ys{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new kr,this.bindMatrixInverse=new kr}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new nr,e=this.geometry.attributes.skinWeight;for(let n=0,r=e.count;n<r;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);const r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const n=this.skeleton,r=this.geometry;tc.fromBufferAttribute(r.attributes.skinIndex,t),ec.fromBufferAttribute(r.attributes.skinWeight,t),Kl.fromBufferAttribute(r.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const r=ec.getComponent(t);if(0!==r){const i=tc.getComponent(t);rc.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),e.addScaledVector(nc.copy(Kl).applyMatrix4(rc),r)}}return e.applyMatrix4(this.bindMatrixInverse)}}ic.prototype.isSkinnedMesh=!0;class sc extends ci{constructor(){super(),this.type="Bone"}}sc.prototype.isBone=!0;class oc extends tr{constructor(t=null,e=1,n=1,r,i,s,o,a,l=ft,c=ft,u,h){super(null,s,o,a,l,c,r,i,u,h),this.image={data:t,width:e,height:n},this.magFilter=l,this.minFilter=c,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}oc.prototype.isDataTexture=!0;const ac=new kr,lc=new kr;class cc{constructor(t=[],e=[]){this.uuid=zn(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new kr)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new kr;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=t.length;r<i;r++){const i=t[r]?t[r].matrixWorld:lc;ac.multiplyMatrices(i,e[r]),ac.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new cc(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=Wn(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new oc(e,t,t,kt,Bt);return this.boneMatrices=e,this.boneTexture=n,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,r=t.bones.length;n<r;n++){const r=t.bones[n];let i=e[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new sc),this.bones.push(i),this.boneInverses.push((new kr).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let r=0,i=e.length;r<i;r++){const i=e[r];t.bones.push(i.uuid);const s=n[r];t.boneInverses.push(s.toArray())}return t}}class uc extends Ni{constructor(t,e,n,r=1){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,n),this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}uc.prototype.isInstancedBufferAttribute=!0;const hc=new kr,pc=new kr,dc=[],fc=new ys;class mc extends ys{constructor(t,e,n){super(t,e),this.instanceMatrix=new uc(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const n=this.matrixWorld,r=this.count;if(fc.geometry=this.geometry,fc.material=this.material,void 0!==fc.material)for(let i=0;i<r;i++){this.getMatrixAt(i,hc),pc.multiplyMatrices(n,hc),fc.matrixWorld=pc,fc.raycast(t,dc);for(let t=0,n=dc.length;t<n;t++){const n=dc[t];n.instanceId=i,n.object=this,e.push(n)}dc.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new uc(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}mc.prototype.isInstancedMesh=!0;class _c extends wi{constructor(t){super(),this.type="LineBasicMaterial",this.color=new Ci(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}_c.prototype.isLineBasicMaterial=!0;const gc=new ar,yc=new ar,vc=new kr,bc=new Fr,xc=new Cr;class wc extends ci{constructor(t=new ts,e=new _c){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,r=e.count;t<r;t++)gc.fromBufferAttribute(e,t-1),yc.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=gc.distanceTo(yc);t.setAttribute("lineDistance",new ji(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),xc.copy(n.boundingSphere),xc.applyMatrix4(r),xc.radius+=i,!1===t.ray.intersectsSphere(xc))return;vc.copy(r).invert(),bc.copy(t.ray).applyMatrix4(vc);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new ar,c=new ar,u=new ar,h=new ar,p=this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes.position;if(null!==r)for(let n=Math.max(0,s.start),o=Math.min(r.count,s.start+s.count)-1;n<o;n+=p){const s=r.getX(n),o=r.getX(n+1);if(l.fromBufferAttribute(i,s),c.fromBufferAttribute(i,o),bc.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const p=t.ray.origin.distanceTo(h);p<t.near||p>t.far||e.push({distance:p,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,s.start),r=Math.min(i.count,s.start+s.count)-1;n<r;n+=p){if(l.fromBufferAttribute(i,n),c.fromBufferAttribute(i,n+1),bc.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(h);r<t.near||r>t.far||e.push({distance:r,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}wc.prototype.isLine=!0;const Sc=new ar,Mc=new ar;class Tc extends wc{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,r=e.count;t<r;t+=2)Sc.fromBufferAttribute(e,t),Mc.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Sc.distanceTo(Mc);t.setAttribute("lineDistance",new ji(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Tc.prototype.isLineSegments=!0;class Ec extends wc{constructor(t,e){super(t,e),this.type="LineLoop"}}Ec.prototype.isLineLoop=!0;class Ac extends wi{constructor(t){super(),this.type="PointsMaterial",this.color=new Ci(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}Ac.prototype.isPointsMaterial=!0;const $c=new kr,Cc=new Fr,Bc=new Cr,Lc=new ar;class Rc extends ci{constructor(t=new ts,e=new Ac){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Bc.copy(n.boundingSphere),Bc.applyMatrix4(r),Bc.radius+=i,!1===t.ray.intersectsSphere(Bc))return;$c.copy(r).invert(),Cc.copy(t.ray).applyMatrix4($c);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(n.isBufferGeometry){const i=n.index,o=n.attributes.position;if(null!==i)for(let n=Math.max(0,s.start),l=Math.min(i.count,s.start+s.count);n<l;n++){const s=i.getX(n);Lc.fromBufferAttribute(o,s),Nc(Lc,s,a,r,t,e,this)}else for(let n=Math.max(0,s.start),i=Math.min(o.count,s.start+s.count);n<i;n++)Lc.fromBufferAttribute(o,n),Nc(Lc,n,a,r,t,e,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Nc(t,e,n,r,i,s,o){const a=Cc.distanceSqToPoint(t);if(a<n){const n=new ar;Cc.closestPointToPoint(t,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:o})}}Rc.prototype.isPoints=!0;class Pc extends tr{constructor(t,e,n,r,i,s,o,a,l){super(t,e,n,r,i,s,o,a,l),this.format=void 0!==o?o:Ft,this.minFilter=void 0!==s?s:vt,this.magFilter=void 0!==i?i:vt,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}Pc.prototype.isVideoTexture=!0;class Ic extends tr{constructor(t,e,n,r,i,s,o,a,l,c,u,h){super(null,s,o,a,l,c,r,i,u,h),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}Ic.prototype.isCompressedTexture=!0;class Oc extends tr{constructor(t,e,n,r,i,s,o,a,l){super(t,e,n,r,i,s,o,a,l),this.needsUpdate=!0}}Oc.prototype.isCanvasTexture=!0;class Fc extends tr{constructor(t,e,n,r,i,s,o,a,l,c){if((c=void 0!==c?c:jt)!==jt&&c!==Gt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===jt&&(n=At),void 0===n&&c===Gt&&(n=It),super(null,r,i,s,o,a,c,n,l),this.image={width:t,height:e},this.magFilter=void 0!==o?o:ft,this.minFilter=void 0!==a?a:ft,this.flipY=!1,this.generateMipmaps=!1}}Fc.prototype.isDepthTexture=!0;class kc extends ts{constructor(t=1,e=8,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},e=Math.max(3,e);const i=[],s=[],o=[],a=[],l=new ar,c=new Yn;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let i=0,u=3;i<=e;i++,u+=3){const h=n+i/e*r;l.x=t*Math.cos(h),l.y=t*Math.sin(h),s.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(s[u]/t+1)/2,c.y=(s[u+1]/t+1)/2,a.push(c.x,c.y)}for(let t=1;t<=e;t++)i.push(t,t+1,0);this.setIndex(i),this.setAttribute("position",new ji(s,3)),this.setAttribute("normal",new ji(o,3)),this.setAttribute("uv",new ji(a,2))}static fromJSON(t){return new kc(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class Dc extends ts{constructor(t=1,e=1,n=1,r=8,i=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a};const l=this;r=Math.floor(r),i=Math.floor(i);const c=[],u=[],h=[],p=[];let d=0;const f=[],m=n/2;let _=0;function g(n){const i=d,s=new Yn,f=new ar;let g=0;const y=!0===n?t:e,v=!0===n?1:-1;for(let t=1;t<=r;t++)u.push(0,m*v,0),h.push(0,v,0),p.push(.5,.5),d++;const b=d;for(let t=0;t<=r;t++){const e=t/r*a+o,n=Math.cos(e),i=Math.sin(e);f.x=y*i,f.y=m*v,f.z=y*n,u.push(f.x,f.y,f.z),h.push(0,v,0),s.x=.5*n+.5,s.y=.5*i*v+.5,p.push(s.x,s.y),d++}for(let t=0;t<r;t++){const e=i+t,r=b+t;!0===n?c.push(r,r+1,e):c.push(r+1,r,e),g+=3}l.addGroup(_,g,!0===n?1:2),_+=g}!function(){const s=new ar,g=new ar;let y=0;const v=(e-t)/n;for(let l=0;l<=i;l++){const c=[],_=l/i,y=_*(e-t)+t;for(let t=0;t<=r;t++){const e=t/r,i=e*a+o,l=Math.sin(i),f=Math.cos(i);g.x=y*l,g.y=-_*n+m,g.z=y*f,u.push(g.x,g.y,g.z),s.set(l,v,f).normalize(),h.push(s.x,s.y,s.z),p.push(e,1-_),c.push(d++)}f.push(c)}for(let t=0;t<r;t++)for(let e=0;e<i;e++){const n=f[e][t],r=f[e+1][t],i=f[e+1][t+1],s=f[e][t+1];c.push(n,r,s),c.push(r,i,s),y+=6}l.addGroup(_,y,0),_+=y}(),!1===s&&(t>0&&g(!0),e>0&&g(!1)),this.setIndex(c),this.setAttribute("position",new ji(u,3)),this.setAttribute("normal",new ji(h,3)),this.setAttribute("uv",new ji(p,2))}static fromJSON(t){return new Dc(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Uc extends Dc{constructor(t=1,e=1,n=8,r=1,i=!1,s=0,o=2*Math.PI){super(0,t,e,n,r,i,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:s,thetaLength:o}}static fromJSON(t){return new Uc(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class zc extends ts{constructor(t,e,n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r};const i=[],s=[];function o(t,e,n,r){const i=r+1,s=[];for(let r=0;r<=i;r++){s[r]=[];const o=t.clone().lerp(n,r/i),a=e.clone().lerp(n,r/i),l=i-r;for(let t=0;t<=l;t++)s[r][t]=0===t&&r===i?o:o.clone().lerp(a,t/l)}for(let t=0;t<i;t++)for(let e=0;e<2*(i-t)-1;e++){const n=Math.floor(e/2);e%2==0?(a(s[t][n+1]),a(s[t+1][n]),a(s[t][n])):(a(s[t][n+1]),a(s[t+1][n+1]),a(s[t+1][n]))}}function a(t){i.push(t.x,t.y,t.z)}function l(e,n){const r=3*e;n.x=t[r+0],n.y=t[r+1],n.z=t[r+2]}function c(t,e,n,r){r<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=r/2/Math.PI+.5)}function u(t){return Math.atan2(t.z,-t.x)}!function(t){const n=new ar,r=new ar,i=new ar;for(let s=0;s<e.length;s+=3)l(e[s+0],n),l(e[s+1],r),l(e[s+2],i),o(n,r,i,t)}(r),function(t){const e=new ar;for(let n=0;n<i.length;n+=3)e.x=i[n+0],e.y=i[n+1],e.z=i[n+2],e.normalize().multiplyScalar(t),i[n+0]=e.x,i[n+1]=e.y,i[n+2]=e.z}(n),function(){const t=new ar;for(let n=0;n<i.length;n+=3){t.x=i[n+0],t.y=i[n+1],t.z=i[n+2];const r=u(t)/2/Math.PI+.5,o=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(r,1-o)}var e;(function(){const t=new ar,e=new ar,n=new ar,r=new ar,o=new Yn,a=new Yn,l=new Yn;for(let h=0,p=0;h<i.length;h+=9,p+=6){t.set(i[h+0],i[h+1],i[h+2]),e.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),o.set(s[p+0],s[p+1]),a.set(s[p+2],s[p+3]),l.set(s[p+4],s[p+5]),r.copy(t).add(e).add(n).divideScalar(3);const d=u(r);c(o,p+0,t,d),c(a,p+2,e,d),c(l,p+4,n,d)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],n=s[t+2],r=s[t+4],i=Math.max(e,n,r),o=Math.min(e,n,r);i>.9&&o<.1&&(e<.2&&(s[t+0]+=1),n<.2&&(s[t+2]+=1),r<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new ji(i,3)),this.setAttribute("normal",new ji(i.slice(),3)),this.setAttribute("uv",new ji(s,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new zc(t.vertices,t.indices,t.radius,t.details)}}class jc extends zc{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new jc(t.radius,t.detail)}}const Gc=new ar,Hc=new ar,Vc=new ar,Wc=new bi;class qc extends ts{constructor(t,e){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1,!0===t.isGeometry)return void console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const n=Math.pow(10,4),r=Math.cos(Dn*e),i=t.getIndex(),s=t.getAttribute("position"),o=i?i.count:s.count,a=[0,0,0],l=["a","b","c"],c=new Array(3),u={},h=[];for(let t=0;t<o;t+=3){i?(a[0]=i.getX(t),a[1]=i.getX(t+1),a[2]=i.getX(t+2)):(a[0]=t,a[1]=t+1,a[2]=t+2);const{a:e,b:o,c:p}=Wc;if(e.fromBufferAttribute(s,a[0]),o.fromBufferAttribute(s,a[1]),p.fromBufferAttribute(s,a[2]),Wc.getNormal(Vc),c[0]=`${Math.round(e.x*n)},${Math.round(e.y*n)},${Math.round(e.z*n)}`,c[1]=`${Math.round(o.x*n)},${Math.round(o.y*n)},${Math.round(o.z*n)}`,c[2]=`${Math.round(p.x*n)},${Math.round(p.y*n)},${Math.round(p.z*n)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let t=0;t<3;t++){const e=(t+1)%3,n=c[t],i=c[e],s=Wc[l[t]],o=Wc[l[e]],p=`${n}_${i}`,d=`${i}_${n}`;d in u&&u[d]?(Vc.dot(u[d].normal)<=r&&(h.push(s.x,s.y,s.z),h.push(o.x,o.y,o.z)),u[d]=null):p in u||(u[p]={index0:a[t],index1:a[e],normal:Vc.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:n}=u[t];Gc.fromBufferAttribute(s,e),Hc.fromBufferAttribute(s,n),h.push(Gc.x,Gc.y,Gc.z),h.push(Hc.x,Hc.y,Hc.z)}this.setAttribute("position",new ji(h,3))}}class Xc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,r=this.getPoint(0),i=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),i+=n.distanceTo(r),e.push(i),r=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let r=0;const i=n.length;let s;s=e||t*n[i-1];let o,a=0,l=i-1;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),o=n[r]-s,o<0)a=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(r=l,n[r]===s)return r/(i-1);const c=n[r];return(r+(s-c)/(n[r+1]-c))/(i-1)}getTangent(t,e){const n=1e-4;let r=t-n,i=t+n;r<0&&(r=0),i>1&&(i=1);const s=this.getPoint(r),o=this.getPoint(i),a=e||(s.isVector2?new Yn:new ar);return a.copy(o).sub(s).normalize(),a}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new ar,r=[],i=[],s=[],o=new ar,a=new kr;for(let e=0;e<=t;e++){const n=e/t;r[e]=this.getTangentAt(n,new ar),r[e].normalize()}i[0]=new ar,s[0]=new ar;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),s[0].crossVectors(r[0],i[0]);for(let e=1;e<=t;e++){if(i[e]=i[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(r[e-1],r[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(jn(r[e-1].dot(r[e]),-1,1));i[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(r[e],i[e])}if(!0===e){let e=Math.acos(jn(i[0].dot(i[t]),-1,1));e/=t,r[0].dot(o.crossVectors(i[0],i[t]))>0&&(e=-e);for(let n=1;n<=t;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],e*n)),s[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Yc extends Xc{constructor(t=0,e=0,n=1,r=1,i=0,s=2*Math.PI,o=!1,a=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e){const n=e||new Yn,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const s=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=s?0:r),!0!==this.aClockwise||s||(i===r?i=-r:i-=r);const o=this.aStartAngle+t*i;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,r=l-this.aY;a=n*t-r*e+this.aX,l=n*e+r*t+this.aY}return n.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}Yc.prototype.isEllipseCurve=!0;class Jc extends Yc{constructor(t,e,n,r,i,s){super(t,e,n,n,r,i,s),this.type="ArcCurve"}}function Zc(){let t=0,e=0,n=0,r=0;function i(i,s,o,a){t=i,e=o,n=-3*i+3*s-2*o-a,r=2*i-2*s+o+a}return{initCatmullRom:function(t,e,n,r,s){i(e,n,s*(n-t),s*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,s,o,a){let l=(e-t)/s-(n-t)/(s+o)+(n-e)/o,c=(n-e)/o-(r-e)/(o+a)+(r-n)/a;l*=o,c*=o,i(e,n,l,c)},calc:function(i){const s=i*i;return t+e*i+n*s+r*(s*i)}}}Jc.prototype.isArcCurve=!0;const Qc=new ar,Kc=new Zc,tu=new Zc,eu=new Zc;class nu extends Xc{constructor(t=[],e=!1,n="centripetal",r=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=r}getPoint(t,e=new ar){const n=e,r=this.points,i=r.length,s=(i-(this.closed?0:1))*t;let o,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===c&&l===i-1&&(l=i-2,c=1),this.closed||l>0?o=r[(l-1)%i]:(Qc.subVectors(r[0],r[1]).add(r[0]),o=Qc);const u=r[l%i],h=r[(l+1)%i];if(this.closed||l+2<i?a=r[(l+2)%i]:(Qc.subVectors(r[i-1],r[i-2]).add(r[i-1]),a=Qc),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(h),t),r=Math.pow(h.distanceToSquared(a),t);n<1e-4&&(n=1),e<1e-4&&(e=n),r<1e-4&&(r=n),Kc.initNonuniformCatmullRom(o.x,u.x,h.x,a.x,e,n,r),tu.initNonuniformCatmullRom(o.y,u.y,h.y,a.y,e,n,r),eu.initNonuniformCatmullRom(o.z,u.z,h.z,a.z,e,n,r)}else"catmullrom"===this.curveType&&(Kc.initCatmullRom(o.x,u.x,h.x,a.x,this.tension),tu.initCatmullRom(o.y,u.y,h.y,a.y,this.tension),eu.initCatmullRom(o.z,u.z,h.z,a.z,this.tension));return n.set(Kc.calc(c),tu.calc(c),eu.calc(c)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new ar).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function ru(t,e,n,r,i){const s=.5*(r-e),o=.5*(i-n),a=t*t;return(2*n-2*r+s+o)*(t*a)+(-3*n+3*r-2*s-o)*a+s*t+n}function iu(t,e,n,r){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function su(t,e,n,r,i){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}nu.prototype.isCatmullRomCurve3=!0;class ou extends Xc{constructor(t=new Yn,e=new Yn,n=new Yn,r=new Yn){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new Yn){const n=e,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(su(t,r.x,i.x,s.x,o.x),su(t,r.y,i.y,s.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}ou.prototype.isCubicBezierCurve=!0;class au extends Xc{constructor(t=new ar,e=new ar,n=new ar,r=new ar){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new ar){const n=e,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(su(t,r.x,i.x,s.x,o.x),su(t,r.y,i.y,s.y,o.y),su(t,r.z,i.z,s.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}au.prototype.isCubicBezierCurve3=!0;class lu extends Xc{constructor(t=new Yn,e=new Yn){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Yn){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const n=e||new Yn;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}lu.prototype.isLineCurve=!0;class cu extends Xc{constructor(t=new ar,e=new ar){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new ar){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class uu extends Xc{constructor(t=new Yn,e=new Yn,n=new Yn){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Yn){const n=e,r=this.v0,i=this.v1,s=this.v2;return n.set(iu(t,r.x,i.x,s.x),iu(t,r.y,i.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}uu.prototype.isQuadraticBezierCurve=!0;class hu extends Xc{constructor(t=new ar,e=new ar,n=new ar){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new ar){const n=e,r=this.v0,i=this.v1,s=this.v2;return n.set(iu(t,r.x,i.x,s.x),iu(t,r.y,i.y,s.y),iu(t,r.z,i.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}hu.prototype.isQuadraticBezierCurve3=!0;class pu extends Xc{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new Yn){const n=e,r=this.points,i=(r.length-1)*t,s=Math.floor(i),o=i-s,a=r[0===s?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],u=r[s>r.length-3?r.length-1:s+2];return n.set(ru(o,a.x,l.x,c.x,u.x),ru(o,a.y,l.y,c.y,u.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Yn).fromArray(n))}return this}}pu.prototype.isSplineCurve=!0;var du=Object.freeze({__proto__:null,ArcCurve:Jc,CatmullRomCurve3:nu,CubicBezierCurve:ou,CubicBezierCurve3:au,EllipseCurve:Yc,LineCurve:lu,LineCurve3:cu,QuadraticBezierCurve:uu,QuadraticBezierCurve3:hu,SplineCurve:pu});function fu(t,e,n,r,i){let s,o;if(i===function(t,e,n,r){let i=0;for(let s=e,o=n-r;s<n;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}(t,e,n,r)>0)for(s=e;s<n;s+=r)o=Iu(s,t[s],t[s+1],o);else for(s=n-r;s>=e;s-=r)o=Iu(s,t[s],t[s+1],o);return o&&Cu(o,o.next)&&(Ou(o),o=o.next),o}function mu(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!Cu(r,r.next)&&0!==$u(r.prev,r,r.next))r=r.next;else{if(Ou(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function _u(t,e,n,r,i,s,o){if(!t)return;!o&&s&&function(t,e,n,r){let i=t;do{null===i.z&&(i.z=Mu(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){let e,n,r,i,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,r=n,a=0,e=0;e<c&&(a++,r=r.nextZ,r);e++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,c*=2}while(o>1)}(i)}(t,r,i,s);let a,l,c=t;for(;t.prev!==t.next;)if(a=t.prev,l=t.next,s?yu(t,r,i,s):gu(t))e.push(a.i/n),e.push(t.i/n),e.push(l.i/n),Ou(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?_u(t=vu(mu(t),e,n),e,n,r,i,s,2):2===o&&bu(t,e,n,r,i,s):_u(mu(t),e,n,r,i,s,1);break}}function gu(t){const e=t.prev,n=t,r=t.next;if($u(e,n,r)>=0)return!1;let i=t.next.next;for(;i!==t.prev;){if(Eu(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&$u(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function yu(t,e,n,r){const i=t.prev,s=t,o=t.next;if($u(i,s,o)>=0)return!1;const a=i.x<s.x?i.x<o.x?i.x:o.x:s.x<o.x?s.x:o.x,l=i.y<s.y?i.y<o.y?i.y:o.y:s.y<o.y?s.y:o.y,c=i.x>s.x?i.x>o.x?i.x:o.x:s.x>o.x?s.x:o.x,u=i.y>s.y?i.y>o.y?i.y:o.y:s.y>o.y?s.y:o.y,h=Mu(a,l,e,n,r),p=Mu(c,u,e,n,r);let d=t.prevZ,f=t.nextZ;for(;d&&d.z>=h&&f&&f.z<=p;){if(d!==t.prev&&d!==t.next&&Eu(i.x,i.y,s.x,s.y,o.x,o.y,d.x,d.y)&&$u(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==t.prev&&f!==t.next&&Eu(i.x,i.y,s.x,s.y,o.x,o.y,f.x,f.y)&&$u(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==t.prev&&d!==t.next&&Eu(i.x,i.y,s.x,s.y,o.x,o.y,d.x,d.y)&&$u(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&Eu(i.x,i.y,s.x,s.y,o.x,o.y,f.x,f.y)&&$u(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function vu(t,e,n){let r=t;do{const i=r.prev,s=r.next.next;!Cu(i,s)&&Bu(i,r,r.next,s)&&Nu(i,s)&&Nu(s,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(s.i/n),Ou(r),Ou(r.next),r=t=s),r=r.next}while(r!==t);return mu(r)}function bu(t,e,n,r,i,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&Au(o,t)){let a=Pu(o,t);return o=mu(o,o.next),a=mu(a,a.next),_u(o,e,n,r,i,s),void _u(a,e,n,r,i,s)}t=t.next}o=o.next}while(o!==t)}function xu(t,e){return t.x-e.x}function wu(t,e){if(e=function(t,e){let n=e;const r=t.x,i=t.y;let s,o=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const t=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>o){if(o=t,t===r){if(i===n.y)return n;if(i===n.next.y)return n.next}s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!s)return null;if(r===o)return s;const a=s,l=s.x,c=s.y;let u,h=1/0;n=s;do{r>=n.x&&n.x>=l&&r!==n.x&&Eu(i<c?r:o,i,l,c,i<c?o:r,i,n.x,n.y)&&(u=Math.abs(i-n.y)/(r-n.x),Nu(n,t)&&(u<h||u===h&&(n.x>s.x||n.x===s.x&&Su(s,n)))&&(s=n,h=u)),n=n.next}while(n!==a);return s}(t,e),e){const n=Pu(e,t);mu(e,e.next),mu(n,n.next)}}function Su(t,e){return $u(t.prev,t,e.prev)<0&&$u(e.next,t,t.next)<0}function Mu(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Tu(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Eu(t,e,n,r,i,s,o,a){return(i-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(r-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(i-o)*(r-a)>=0}function Au(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Bu(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Nu(t,e)&&Nu(e,t)&&function(t,e){let n=t,r=!1;const i=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&($u(t.prev,t,e.prev)||$u(t,e.prev,e))||Cu(t,e)&&$u(t.prev,t,t.next)>0&&$u(e.prev,e,e.next)>0)}function $u(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Cu(t,e){return t.x===e.x&&t.y===e.y}function Bu(t,e,n,r){const i=Ru($u(t,e,n)),s=Ru($u(t,e,r)),o=Ru($u(n,r,t)),a=Ru($u(n,r,e));return i!==s&&o!==a||!(0!==i||!Lu(t,n,e))||!(0!==s||!Lu(t,r,e))||!(0!==o||!Lu(n,t,r))||!(0!==a||!Lu(n,e,r))}function Lu(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Ru(t){return t>0?1:t<0?-1:0}function Nu(t,e){return $u(t.prev,t,t.next)<0?$u(t,e,t.next)>=0&&$u(t,t.prev,e)>=0:$u(t,e,t.prev)<0||$u(t,t.next,e)<0}function Pu(t,e){const n=new Fu(t.i,t.x,t.y),r=new Fu(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function Iu(t,e,n,r){const i=new Fu(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Ou(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Fu(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class ku{static area(t){const e=t.length;let n=0;for(let r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n}static isClockWise(t){return ku.area(t)<0}static triangulateShape(t,e){const n=[],r=[],i=[];Du(t),Uu(n,t);let s=t.length;e.forEach(Du);for(let t=0;t<e.length;t++)r.push(s),s+=e[t].length,Uu(n,e[t]);const o=function(t,e,n=2){const r=e&&e.length,i=r?e[0]*n:t.length;let s=fu(t,0,i,n,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,u,h,p,d;if(r&&(s=function(t,e,n,r){const i=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*r,l=s<o-1?e[s+1]*r:t.length,c=fu(t,a,l,r,!1),c===c.next&&(c.steiner=!0),i.push(Tu(c));for(i.sort(xu),s=0;s<i.length;s++)wu(i[s],n),n=mu(n,n.next);return n}(t,e,s,n)),t.length>80*n){a=c=t[0],l=u=t[1];for(let e=n;e<i;e+=n)h=t[e],p=t[e+1],h<a&&(a=h),p<l&&(l=p),h>c&&(c=h),p>u&&(u=p);d=Math.max(c-a,u-l),d=0!==d?1/d:0}return _u(s,o,n,a,l,d),o}(n,r);for(let t=0;t<o.length;t+=3)i.push(o.slice(t,t+3));return i}}function Du(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Uu(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class zu extends ts{constructor(t,e){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,r=[],i=[];for(let e=0,n=t.length;e<n;e++)s(t[e]);function s(t){const s=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:100,c=void 0===e.bevelEnabled||e.bevelEnabled,u=void 0!==e.bevelThickness?e.bevelThickness:6,h=void 0!==e.bevelSize?e.bevelSize:u-2,p=void 0!==e.bevelOffset?e.bevelOffset:0,d=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:ju;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let _,g,y,v,b,x=!1;f&&(_=f.getSpacedPoints(a),x=!0,c=!1,g=f.computeFrenetFrames(a,!1),y=new ar,v=new ar,b=new ar),c||(d=0,u=0,h=0,p=0);const w=t.extractPoints(o);let S=w.shape;const M=w.holes;if(!ku.isClockWise(S)){S=S.reverse();for(let t=0,e=M.length;t<e;t++){const e=M[t];ku.isClockWise(e)&&(M[t]=e.reverse())}}const T=ku.triangulateShape(S,M),E=S;for(let t=0,e=M.length;t<e;t++){const e=M[t];S=S.concat(e)}function A(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const $=S.length,C=T.length;function B(t,e,n){let r,i,s;const o=t.x-e.x,a=t.y-e.y,l=n.x-t.x,c=n.y-t.y,u=o*o+a*a,h=o*c-a*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),p=Math.sqrt(l*l+c*c),d=e.x-a/h,f=e.y+o/h,m=((n.x-c/p-d)*c-(n.y+l/p-f)*l)/(o*c-a*l);r=d+o*m-t.x,i=f+a*m-t.y;const _=r*r+i*i;if(_<=2)return new Yn(r,i);s=Math.sqrt(_/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(c)&&(t=!0),t?(r=-a,i=o,s=Math.sqrt(u)):(r=o,i=a,s=Math.sqrt(u/2))}return new Yn(r/s,i/s)}const L=[];for(let t=0,e=E.length,n=e-1,r=t+1;t<e;t++,n++,r++)n===e&&(n=0),r===e&&(r=0),L[t]=B(E[t],E[n],E[r]);const R=[];let N,P=L.concat();for(let t=0,e=M.length;t<e;t++){const e=M[t];N=[];for(let t=0,n=e.length,r=n-1,i=t+1;t<n;t++,r++,i++)r===n&&(r=0),i===n&&(i=0),N[t]=B(e[t],e[r],e[i]);R.push(N),P=P.concat(N)}for(let t=0;t<d;t++){const e=t/d,n=u*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+p;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],L[t],r);F(e.x,e.y,-n)}for(let t=0,e=M.length;t<e;t++){const e=M[t];N=R[t];for(let t=0,i=e.length;t<i;t++){const i=A(e[t],N[t],r);F(i.x,i.y,-n)}}}const I=h+p;for(let t=0;t<$;t++){const e=c?A(S[t],P[t],I):S[t];x?(v.copy(g.normals[0]).multiplyScalar(e.x),y.copy(g.binormals[0]).multiplyScalar(e.y),b.copy(_[0]).add(v).add(y),F(b.x,b.y,b.z)):F(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<$;e++){const n=c?A(S[e],P[e],I):S[e];x?(v.copy(g.normals[t]).multiplyScalar(n.x),y.copy(g.binormals[t]).multiplyScalar(n.y),b.copy(_[t]).add(v).add(y),F(b.x,b.y,b.z)):F(n.x,n.y,l/a*t)}for(let t=d-1;t>=0;t--){const e=t/d,n=u*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+p;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],L[t],r);F(e.x,e.y,l+n)}for(let t=0,e=M.length;t<e;t++){const e=M[t];N=R[t];for(let t=0,i=e.length;t<i;t++){const i=A(e[t],N[t],r);x?F(i.x,i.y+_[a-1].y,_[a-1].x+n):F(i.x,i.y,l+n)}}}function O(t,e){let n=t.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=t.length-1);for(let t=0,n=a+2*d;t<n;t++){const n=$*t,s=$*(t+1);D(e+r+n,e+i+n,e+i+s,e+r+s)}}}function F(t,e,n){s.push(t),s.push(e),s.push(n)}function k(t,e,i){U(t),U(e),U(i);const s=r.length/3,o=m.generateTopUV(n,r,s-3,s-2,s-1);z(o[0]),z(o[1]),z(o[2])}function D(t,e,i,s){U(t),U(e),U(s),U(e),U(i),U(s);const o=r.length/3,a=m.generateSideWallUV(n,r,o-6,o-3,o-2,o-1);z(a[0]),z(a[1]),z(a[3]),z(a[1]),z(a[2]),z(a[3])}function U(t){r.push(s[3*t+0]),r.push(s[3*t+1]),r.push(s[3*t+2])}function z(t){i.push(t.x),i.push(t.y)}!function(){const t=r.length/3;if(c){let t=0,e=$*t;for(let t=0;t<C;t++){const n=T[t];k(n[2]+e,n[1]+e,n[0]+e)}t=a+2*d,e=$*t;for(let t=0;t<C;t++){const n=T[t];k(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<C;t++){const e=T[t];k(e[2],e[1],e[0])}for(let t=0;t<C;t++){const e=T[t];k(e[0]+$*a,e[1]+$*a,e[2]+$*a)}}n.addGroup(t,r.length/3-t,0)}(),function(){const t=r.length/3;let e=0;O(E,e),e+=E.length;for(let t=0,n=M.length;t<n;t++){const n=M[t];O(n,e),e+=n.length}n.addGroup(t,r.length/3-t,1)}()}this.setAttribute("position",new ji(r,3)),this.setAttribute("uv",new ji(i,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,r=t.length;e<r;e++){const r=t[e];n.shapes.push(r.uuid)}else n.shapes.push(t.uuid);return void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const n=[];for(let r=0,i=t.shapes.length;r<i;r++){const i=e[t.shapes[r]];n.push(i)}const r=t.options.extrudePath;return void 0!==r&&(t.options.extrudePath=(new du[r.type]).fromJSON(r)),new zu(n,t.options)}}const ju={generateTopUV:function(t,e,n,r,i){const s=e[3*n],o=e[3*n+1],a=e[3*r],l=e[3*r+1],c=e[3*i],u=e[3*i+1];return[new Yn(s,o),new Yn(a,l),new Yn(c,u)]},generateSideWallUV:function(t,e,n,r,i,s){const o=e[3*n],a=e[3*n+1],l=e[3*n+2],c=e[3*r],u=e[3*r+1],h=e[3*r+2],p=e[3*i],d=e[3*i+1],f=e[3*i+2],m=e[3*s],_=e[3*s+1],g=e[3*s+2];return Math.abs(a-u)<Math.abs(o-c)?[new Yn(o,1-l),new Yn(c,1-h),new Yn(p,1-f),new Yn(m,1-g)]:[new Yn(a,1-l),new Yn(u,1-h),new Yn(d,1-f),new Yn(_,1-g)]}};class Gu extends zc{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Gu(t.radius,t.detail)}}class Hu extends ts{constructor(t,e=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},e=Math.floor(e),r=jn(r,0,2*Math.PI);const i=[],s=[],o=[],a=1/e,l=new ar,c=new Yn;for(let i=0;i<=e;i++){const u=n+i*a*r,h=Math.sin(u),p=Math.cos(u);for(let n=0;n<=t.length-1;n++)l.x=t[n].x*h,l.y=t[n].y,l.z=t[n].x*p,s.push(l.x,l.y,l.z),c.x=i/e,c.y=n/(t.length-1),o.push(c.x,c.y)}for(let n=0;n<e;n++)for(let e=0;e<t.length-1;e++){const r=e+n*t.length,s=r,o=r+t.length,a=r+t.length+1,l=r+1;i.push(s,o,l),i.push(o,a,l)}if(this.setIndex(i),this.setAttribute("position",new ji(s,3)),this.setAttribute("uv",new ji(o,2)),this.computeVertexNormals(),r===2*Math.PI){const n=this.attributes.normal.array,r=new ar,i=new ar,s=new ar,o=e*t.length*3;for(let e=0,a=0;e<t.length;e++,a+=3)r.x=n[a+0],r.y=n[a+1],r.z=n[a+2],i.x=n[o+a+0],i.y=n[o+a+1],i.z=n[o+a+2],s.addVectors(r,i).normalize(),n[a+0]=n[o+a+0]=s.x,n[a+1]=n[o+a+1]=s.y,n[a+2]=n[o+a+2]=s.z}}static fromJSON(t){return new Hu(t.points,t.segments,t.phiStart,t.phiLength)}}class Vu extends zc{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Vu(t.radius,t.detail)}}class Wu extends ts{constructor(t,e,n){super(),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n};const r=[],i=[],s=[],o=[],a=1e-5,l=new ar,c=new ar,u=new ar,h=new ar,p=new ar;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const d=e+1;for(let r=0;r<=n;r++){const d=r/n;for(let n=0;n<=e;n++){const r=n/e;t(r,d,c),i.push(c.x,c.y,c.z),r-a>=0?(t(r-a,d,u),h.subVectors(c,u)):(t(r+a,d,u),h.subVectors(u,c)),d-a>=0?(t(r,d-a,u),p.subVectors(c,u)):(t(r,d+a,u),p.subVectors(u,c)),l.crossVectors(h,p).normalize(),s.push(l.x,l.y,l.z),o.push(r,d)}}for(let t=0;t<n;t++)for(let n=0;n<e;n++){const e=t*d+n,i=t*d+n+1,s=(t+1)*d+n+1,o=(t+1)*d+n;r.push(e,i,o),r.push(i,s,o)}this.setIndex(r),this.setAttribute("position",new ji(i,3)),this.setAttribute("normal",new ji(s,3)),this.setAttribute("uv",new ji(o,2))}}class qu extends ts{constructor(t=.5,e=1,n=8,r=1,i=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:s},n=Math.max(3,n);const o=[],a=[],l=[],c=[];let u=t;const h=(e-t)/(r=Math.max(1,r)),p=new ar,d=new Yn;for(let t=0;t<=r;t++){for(let t=0;t<=n;t++){const r=i+t/n*s;p.x=u*Math.cos(r),p.y=u*Math.sin(r),a.push(p.x,p.y,p.z),l.push(0,0,1),d.x=(p.x/e+1)/2,d.y=(p.y/e+1)/2,c.push(d.x,d.y)}u+=h}for(let t=0;t<r;t++){const e=t*(n+1);for(let t=0;t<n;t++){const r=t+e,i=r,s=r+n+1,a=r+n+2,l=r+1;o.push(i,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new ji(a,3)),this.setAttribute("normal",new ji(l,3)),this.setAttribute("uv",new ji(c,2))}static fromJSON(t){return new qu(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class Xu extends ts{constructor(t,e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],r=[],i=[],s=[];let o=0,a=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(o,a,e),o+=a,a=0;function l(t){const o=r.length/3,l=t.extractPoints(e);let c=l.shape;const u=l.holes;!1===ku.isClockWise(c)&&(c=c.reverse());for(let t=0,e=u.length;t<e;t++){const e=u[t];!0===ku.isClockWise(e)&&(u[t]=e.reverse())}const h=ku.triangulateShape(c,u);for(let t=0,e=u.length;t<e;t++){const e=u[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];r.push(e.x,e.y,0),i.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=h.length;t<e;t++){const e=h[t],r=e[0]+o,i=e[1]+o,s=e[2]+o;n.push(r,i,s),a+=3}}this.setIndex(n),this.setAttribute("position",new ji(r,3)),this.setAttribute("normal",new ji(i,3)),this.setAttribute("uv",new ji(s,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,r=t.length;n<r;n++){const r=t[n];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const n=[];for(let r=0,i=t.shapes.length;r<i;r++){const i=e[t.shapes[r]];n.push(i)}return new Xu(n,t.curveSegments)}}class Yu extends ts{constructor(t=1,e=32,n=16,r=0,i=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const a=Math.min(s+o,Math.PI);let l=0;const c=[],u=new ar,h=new ar,p=[],d=[],f=[],m=[];for(let p=0;p<=n;p++){const _=[],g=p/n;let y=0;0==p&&0==s?y=.5/e:p==n&&a==Math.PI&&(y=-.5/e);for(let n=0;n<=e;n++){const a=n/e;u.x=-t*Math.cos(r+a*i)*Math.sin(s+g*o),u.y=t*Math.cos(s+g*o),u.z=t*Math.sin(r+a*i)*Math.sin(s+g*o),d.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+y,1-g),_.push(l++)}c.push(_)}for(let t=0;t<n;t++)for(let r=0;r<e;r++){const e=c[t][r+1],i=c[t][r],o=c[t+1][r],l=c[t+1][r+1];(0!==t||s>0)&&p.push(e,i,l),(t!==n-1||a<Math.PI)&&p.push(i,o,l)}this.setIndex(p),this.setAttribute("position",new ji(d,3)),this.setAttribute("normal",new ji(f,3)),this.setAttribute("uv",new ji(m,2))}static fromJSON(t){return new Yu(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Ju extends zc{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Ju(t.radius,t.detail)}}class Zu extends zu{constructor(t,e={}){const n=e.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new ts;const r=n.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),super(r,e),this.type="TextGeometry"}}class Qu extends ts{constructor(t=1,e=.4,n=8,r=6,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const s=[],o=[],a=[],l=[],c=new ar,u=new ar,h=new ar;for(let s=0;s<=n;s++)for(let p=0;p<=r;p++){const d=p/r*i,f=s/n*Math.PI*2;u.x=(t+e*Math.cos(f))*Math.cos(d),u.y=(t+e*Math.cos(f))*Math.sin(d),u.z=e*Math.sin(f),o.push(u.x,u.y,u.z),c.x=t*Math.cos(d),c.y=t*Math.sin(d),h.subVectors(u,c).normalize(),a.push(h.x,h.y,h.z),l.push(p/r),l.push(s/n)}for(let t=1;t<=n;t++)for(let e=1;e<=r;e++){const n=(r+1)*t+e-1,i=(r+1)*(t-1)+e-1,o=(r+1)*(t-1)+e,a=(r+1)*t+e;s.push(n,i,a),s.push(i,o,a)}this.setIndex(s),this.setAttribute("position",new ji(o,3)),this.setAttribute("normal",new ji(a,3)),this.setAttribute("uv",new ji(l,2))}static fromJSON(t){return new Qu(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Ku extends ts{constructor(t=1,e=.4,n=64,r=8,i=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:s},n=Math.floor(n),r=Math.floor(r);const o=[],a=[],l=[],c=[],u=new ar,h=new ar,p=new ar,d=new ar,f=new ar,m=new ar,_=new ar;for(let o=0;o<=n;++o){const y=o/n*i*Math.PI*2;g(y,i,s,t,p),g(y+.01,i,s,t,d),m.subVectors(d,p),_.addVectors(d,p),f.crossVectors(m,_),_.crossVectors(f,m),f.normalize(),_.normalize();for(let t=0;t<=r;++t){const i=t/r*Math.PI*2,s=-e*Math.cos(i),d=e*Math.sin(i);u.x=p.x+(s*_.x+d*f.x),u.y=p.y+(s*_.y+d*f.y),u.z=p.z+(s*_.z+d*f.z),a.push(u.x,u.y,u.z),h.subVectors(u,p).normalize(),l.push(h.x,h.y,h.z),c.push(o/n),c.push(t/r)}}for(let t=1;t<=n;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),s=(r+1)*t+e,a=(r+1)*(t-1)+e;o.push(n,i,a),o.push(i,s,a)}function g(t,e,n,r,i){const s=Math.cos(t),o=Math.sin(t),a=n/e*t,l=Math.cos(a);i.x=r*(2+l)*.5*s,i.y=r*(2+l)*o*.5,i.z=r*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new ji(a,3)),this.setAttribute("normal",new ji(l,3)),this.setAttribute("uv",new ji(c,2))}static fromJSON(t){return new Ku(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class th extends ts{constructor(t,e=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i};const s=t.computeFrenetFrames(e,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new ar,a=new ar,l=new Yn;let c=new ar;const u=[],h=[],p=[],d=[];function f(i){c=t.getPointAt(i/e,c);const l=s.normals[i],p=s.binormals[i];for(let t=0;t<=r;t++){const e=t/r*Math.PI*2,i=Math.sin(e),s=-Math.cos(e);a.x=s*l.x+i*p.x,a.y=s*l.y+i*p.y,a.z=s*l.z+i*p.z,a.normalize(),h.push(a.x,a.y,a.z),o.x=c.x+n*a.x,o.y=c.y+n*a.y,o.z=c.z+n*a.z,u.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===i?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=r;n++)l.x=t/e,l.y=n/r,p.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),s=(r+1)*t+e,o=(r+1)*(t-1)+e;d.push(n,i,o),d.push(i,s,o)}}()}(),this.setIndex(d),this.setAttribute("position",new ji(u,3)),this.setAttribute("normal",new ji(h,3)),this.setAttribute("uv",new ji(p,2))}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new th((new du[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class eh extends ts{constructor(t){if(super(),this.type="WireframeGeometry",!0===t.isGeometry)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const e=[],n=new Set,r=new ar,i=new ar;if(null!==t.index){const s=t.attributes.position,o=t.index;let a=t.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let t=0,l=a.length;t<l;++t){const l=a[t],c=l.start;for(let t=c,a=c+l.count;t<a;t+=3)for(let a=0;a<3;a++){const l=o.getX(t+a),c=o.getX(t+(a+1)%3);r.fromBufferAttribute(s,l),i.fromBufferAttribute(s,c),!0===nh(r,i,n)&&(e.push(r.x,r.y,r.z),e.push(i.x,i.y,i.z))}}}else{const s=t.attributes.position;for(let t=0,o=s.count/3;t<o;t++)for(let o=0;o<3;o++){const a=3*t+o,l=3*t+(o+1)%3;r.fromBufferAttribute(s,a),i.fromBufferAttribute(s,l),!0===nh(r,i,n)&&(e.push(r.x,r.y,r.z),e.push(i.x,i.y,i.z))}}this.setAttribute("position",new ji(e,3))}}function nh(t,e,n){const r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==n.has(r)&&!0!==n.has(i)&&(n.add(r,i),!0)}var rh=Object.freeze({__proto__:null,BoxGeometry:bs,BoxBufferGeometry:bs,CircleGeometry:kc,CircleBufferGeometry:kc,ConeGeometry:Uc,ConeBufferGeometry:Uc,CylinderGeometry:Dc,CylinderBufferGeometry:Dc,DodecahedronGeometry:jc,DodecahedronBufferGeometry:jc,EdgesGeometry:qc,ExtrudeGeometry:zu,ExtrudeBufferGeometry:zu,IcosahedronGeometry:Gu,IcosahedronBufferGeometry:Gu,LatheGeometry:Hu,LatheBufferGeometry:Hu,OctahedronGeometry:Vu,OctahedronBufferGeometry:Vu,ParametricGeometry:Wu,ParametricBufferGeometry:Wu,PlaneGeometry:Us,PlaneBufferGeometry:Us,PolyhedronGeometry:zc,PolyhedronBufferGeometry:zc,RingGeometry:qu,RingBufferGeometry:qu,ShapeGeometry:Xu,ShapeBufferGeometry:Xu,SphereGeometry:Yu,SphereBufferGeometry:Yu,TetrahedronGeometry:Ju,TetrahedronBufferGeometry:Ju,TextGeometry:Zu,TextBufferGeometry:Zu,TorusGeometry:Qu,TorusBufferGeometry:Qu,TorusKnotGeometry:Ku,TorusKnotBufferGeometry:Ku,TubeGeometry:th,TubeBufferGeometry:th,WireframeGeometry:eh});class ih extends wi{constructor(t){super(),this.type="ShadowMaterial",this.color=new Ci(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}ih.prototype.isShadowMaterial=!0;class sh extends wi{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ci(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new Yn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}sh.prototype.isMeshStandardMaterial=!0;class oh extends sh{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Yn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return jn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenTint=new Ci(0),this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new Ci(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new Ci(1,1,1),this.specularTintMap=null,this._clearcoat=0,this._transmission=0,this.setValues(t)}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheenTint.copy(t.sheenTint),this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationTint.copy(t.attenuationTint),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularTint.copy(t.specularTint),this.specularTintMap=t.specularTintMap,this}}oh.prototype.isMeshPhysicalMaterial=!0;class ah extends wi{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new Ci(16777215),this.specular=new Ci(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new Yn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}ah.prototype.isMeshPhongMaterial=!0;class lh extends wi{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ci(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new Yn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}lh.prototype.isMeshToonMaterial=!0;class ch extends wi{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new Yn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}ch.prototype.isMeshNormalMaterial=!0;class uh extends wi{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new Ci(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}uh.prototype.isMeshLambertMaterial=!0;class hh extends wi{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ci(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new Yn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}hh.prototype.isMeshMatcapMaterial=!0;class ph extends _c{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}ph.prototype.isLineDashedMaterial=!0;var dh=Object.freeze({__proto__:null,ShadowMaterial:ih,SpriteMaterial:Pl,RawShaderMaterial:Zs,ShaderMaterial:Ms,PointsMaterial:Ac,MeshPhysicalMaterial:oh,MeshStandardMaterial:sh,MeshPhongMaterial:ah,MeshToonMaterial:lh,MeshNormalMaterial:ch,MeshLambertMaterial:uh,MeshDepthMaterial:pl,MeshDistanceMaterial:dl,MeshBasicMaterial:Bi,MeshMatcapMaterial:hh,LineDashedMaterial:ph,LineBasicMaterial:_c,Material:wi});const fh={arraySlice:function(t,e,n){return fh.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){const r=t.length,i=new t.constructor(r);for(let s=0,o=0;o!==r;++s){const r=n[s]*e;for(let n=0;n!==e;++n)i[o++]=t[r+n]}return i},flattenJSON:function(t,e,n,r){let i=1,s=t[0];for(;void 0!==s&&void 0===s[r];)s=t[i++];if(void 0===s)return;let o=s[r];if(void 0!==o)if(Array.isArray(o))do{o=s[r],void 0!==o&&(e.push(s.time),n.push.apply(n,o)),s=t[i++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[r],void 0!==o&&(e.push(s.time),o.toArray(n,n.length)),s=t[i++]}while(void 0!==s);else do{o=s[r],void 0!==o&&(e.push(s.time),n.push(o)),s=t[i++]}while(void 0!==s)},subclip:function(t,e,n,r,i=30){const s=t.clone();s.name=e;const o=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],a=e.getValueSize(),l=[],c=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*i;if(!(s<n||s>=r)){l.push(e.times[t]);for(let n=0;n<a;++n)c.push(e.values[t*a+n])}}0!==l.length&&(e.times=fh.convertArray(l,e.times.constructor),e.values=fh.convertArray(c,e.values.constructor),o.push(e))}s.tracks=o;let a=1/0;for(let t=0;t<s.tracks.length;++t)a>s.tracks[t].times[0]&&(a=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,n=t,r=30){r<=0&&(r=30);const i=n.tracks.length,s=e/r;for(let e=0;e<i;++e){const r=n.tracks[e],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const o=t.tracks.find((function(t){return t.name===r.name&&t.ValueTypeName===i}));if(void 0===o)continue;let a=0;const l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=r.times.length-1;let p;if(s<=r.times[0]){const t=a,e=l-a;p=fh.arraySlice(r.values,t,e)}else if(s>=r.times[h]){const t=h*l+a,e=t+l-a;p=fh.arraySlice(r.values,t,e)}else{const t=r.createInterpolant(),e=a,n=l-a;t.evaluate(s),p=fh.arraySlice(t.resultBuffer,e,n)}"quaternion"===i&&(new or).fromArray(p).normalize().conjugate().toArray(p);const d=o.times.length;for(let t=0;t<d;++t){const e=t*u+c;if("quaternion"===i)or.multiplyQuaternionsFlat(o.values,e,p,0,o.values,e);else{const t=u-2*c;for(let n=0;n<t;++n)o.values[e+n]-=p[n]}}}return t.blendMode=We,t}};class mh{constructor(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{let s;n:{r:if(!(t<r)){for(let s=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,i)}if(n===s)break;if(i=r,r=e[++n],t<r)break e}s=e.length;break n}if(t>=i)break t;{const o=e[1];t<o&&(n=2,i=o);for(let s=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===s)break;if(r=i,i=e[--n-1],t>=i)break e}s=n,n=0}}for(;n<s;){const r=n+s>>>1;t<e[r]?s=r:n=r+1}if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r;for(let t=0;t!==r;++t)e[t]=n[i+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}mh.prototype.beforeStart_=mh.prototype.copySampleValue_,mh.prototype.afterEnd_=mh.prototype.copySampleValue_;class _h extends mh{constructor(t,e,n,r){super(t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:je,endingEnd:je}}intervalChanged_(t,e,n){const r=this.parameterPositions;let i=t-2,s=t+1,o=r[i],a=r[s];if(void 0===o)switch(this.getSettings_().endingStart){case Ge:i=t,o=2*e-n;break;case He:i=r.length-2,o=e+r[i]-r[i+1];break;default:i=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case Ge:s=t,a=2*n-e;break;case He:s=1,a=n+r[1]-r[0];break;default:s=t-1,a=e}const l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=i*c,this._offsetNext=s*c}interpolate_(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(n-e)/(r-e),f=d*d,m=f*d,_=-h*m+2*h*f-h*d,g=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,v=p*m-p*f;for(let t=0;t!==o;++t)i[t]=_*s[c+t]+g*s[l+t]+y*s[a+t]+v*s[u+t];return i}}class gh extends mh{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=(n-e)/(r-e),u=1-c;for(let t=0;t!==o;++t)i[t]=s[l+t]*u+s[a+t]*c;return i}}class yh extends mh{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t){return this.copySampleValue_(t-1)}}class vh{constructor(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=fh.convertArray(e,this.TimeBufferType),this.values=fh.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:fh.convertArray(t.times,Array),values:fh.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new yh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new gh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new _h(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case De:e=this.InterpolantFactoryMethodDiscrete;break;case Ue:e=this.InterpolantFactoryMethodLinear;break;case ze:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return De;case this.InterpolantFactoryMethodLinear:return Ue;case this.InterpolantFactoryMethodSmooth:return ze}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]*=t}return this}trim(t,e){const n=this.times,r=n.length;let i=0,s=r-1;for(;i!==r&&n[i]<t;)++i;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==i||s!==r){i>=s&&(s=Math.max(s,1),i=s-1);const t=this.getValueSize();this.times=fh.arraySlice(n,i,s),this.values=fh.arraySlice(this.values,i*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==i;e++){const r=n[e];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,r),t=!1;break}if(null!==s&&s>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,r,s),t=!1;break}s=r}if(void 0!==r&&fh.isTypedArray(r))for(let e=0,n=r.length;e!==n;++e){const n=r[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t}optimize(){const t=fh.arraySlice(this.times),e=fh.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===ze,i=t.length-1;let s=1;for(let o=1;o<i;++o){let i=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(r)i=!0;else{const t=o*n,r=t-n,s=t+n;for(let o=0;o!==n;++o){const n=e[t+o];if(n!==e[r+o]||n!==e[s+o]){i=!0;break}}}if(i){if(o!==s){t[s]=t[o];const r=o*n,i=s*n;for(let t=0;t!==n;++t)e[i+t]=e[r+t]}++s}}if(i>0){t[s]=t[i];for(let t=i*n,r=s*n,o=0;o!==n;++o)e[r+o]=e[t+o];++s}return s!==t.length?(this.times=fh.arraySlice(t,0,s),this.values=fh.arraySlice(e,0,s*n)):(this.times=t,this.values=e),this}clone(){const t=fh.arraySlice(this.times,0),e=fh.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}vh.prototype.TimeBufferType=Float32Array,vh.prototype.ValueBufferType=Float32Array,vh.prototype.DefaultInterpolation=Ue;class bh extends vh{}bh.prototype.ValueTypeName="bool",bh.prototype.ValueBufferType=Array,bh.prototype.DefaultInterpolation=De,bh.prototype.InterpolantFactoryMethodLinear=void 0,bh.prototype.InterpolantFactoryMethodSmooth=void 0;class xh extends vh{}xh.prototype.ValueTypeName="color";class wh extends vh{}wh.prototype.ValueTypeName="number";class Sh extends mh{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(r-e);let l=t*o;for(let t=l+o;l!==t;l+=4)or.slerpFlat(i,0,s,l-o,s,l,a);return i}}class Mh extends vh{InterpolantFactoryMethodLinear(t){return new Sh(this.times,this.values,this.getValueSize(),t)}}Mh.prototype.ValueTypeName="quaternion",Mh.prototype.DefaultInterpolation=Ue,Mh.prototype.InterpolantFactoryMethodSmooth=void 0;class Th extends vh{}Th.prototype.ValueTypeName="string",Th.prototype.ValueBufferType=Array,Th.prototype.DefaultInterpolation=De,Th.prototype.InterpolantFactoryMethodLinear=void 0,Th.prototype.InterpolantFactoryMethodSmooth=void 0;class Eh extends vh{}Eh.prototype.ValueTypeName="vector";class Ah{constructor(t,e=-1,n,r=Ve){this.name=t,this.tracks=n,this.duration=e,this.blendMode=r,this.uuid=zn(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,r=1/(t.fps||1);for(let t=0,i=n.length;t!==i;++t)e.push($h(n[t]).scale(r));const i=new this(t.name,t.duration,e,t.blendMode);return i.uuid=t.uuid,i}static toJSON(t){const e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,r=n.length;t!==r;++t)e.push(vh.toJSON(n[t]));return r}static CreateFromMorphTargetSequence(t,e,n,r){const i=e.length,s=[];for(let t=0;t<i;t++){let o=[],a=[];o.push((t+i-1)%i,t,(t+1)%i),a.push(0,1,0);const l=fh.getKeyframeOrder(o);o=fh.sortedArray(o,1,l),a=fh.sortedArray(a,1,l),r||0!==o[0]||(o.push(i),a.push(a[0])),s.push(new wh(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/n))}return new this(t,-1,s)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.name.match(i);if(s&&s.length>1){const t=s[1];let e=r[t];e||(r[t]=e=[]),e.push(n)}}const s=[];for(const t in r)s.push(this.CreateFromMorphTargetSequence(t,r[t],e,n));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,r,i){if(0!==n.length){const s=[],o=[];fh.flattenJSON(n,s,o,r),0!==s.length&&i.push(new t(e,s,o))}},r=[],i=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const i=l[t].keys;if(i&&0!==i.length)if(i[0].morphTargets){const t={};let e;for(e=0;e<i.length;e++)if(i[e].morphTargets)for(let n=0;n<i[e].morphTargets.length;n++)t[i[e].morphTargets[n]]=-1;for(const n in t){const t=[],s=[];for(let r=0;r!==i[e].morphTargets.length;++r){const r=i[e];t.push(r.time),s.push(r.morphTarget===n?1:0)}r.push(new wh(".morphTargetInfluence["+n+"]",t,s))}a=t.length*(s||1)}else{const s=".bones["+e[t].name+"]";n(Eh,s+".position",i,"pos",r),n(Mh,s+".quaternion",i,"rot",r),n(Eh,s+".scale",i,"scl",r)}}return 0===r.length?null:new this(i,a,r,o)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function $h(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return wh;case"vector":case"vector2":case"vector3":case"vector4":return Eh;case"color":return xh;case"quaternion":return Mh;case"bool":case"boolean":return bh;case"string":return Th}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];fh.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Ch={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class Bh{constructor(t,e,n){const r=this;let i,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===s&&void 0!==r.onStart&&r.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,a),o===a&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return i?i(t):t},this.setURLModifier=function(t){return i=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],r=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return r}return null}}}const Lh=new Bh;class Rh{constructor(t){this.manager=void 0!==t?t:Lh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const Nh={};class Ph extends Rh{constructor(t){super(t)}load(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=Ch.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;if(void 0!==Nh[t])return void Nh[t].push({onLoad:e,onProgress:n,onError:r});const o=t.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(o){const n=o[1],s=!!o[2];let a=o[3];a=decodeURIComponent(a),s&&(a=atob(a));try{let r;const s=(this.responseType||"").toLowerCase();switch(s){case"arraybuffer":case"blob":const t=new Uint8Array(a.length);for(let e=0;e<a.length;e++)t[e]=a.charCodeAt(e);r="blob"===s?new Blob([t.buffer],{type:n}):t.buffer;break;case"document":const e=new DOMParser;r=e.parseFromString(a,n);break;case"json":r=JSON.parse(a);break;default:r=a}setTimeout((function(){e&&e(r),i.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}),0)}}else{Nh[t]=[],Nh[t].push({onLoad:e,onProgress:n,onError:r}),a=new XMLHttpRequest,a.open("GET",t,!0),a.addEventListener("load",(function(e){const n=this.response,r=Nh[t];if(delete Nh[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Ch.add(t,n);for(let t=0,e=r.length;t<e;t++){const e=r[t];e.onLoad&&e.onLoad(n)}i.manager.itemEnd(t)}else{for(let t=0,n=r.length;t<n;t++){const n=r[t];n.onError&&n.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}}),!1),a.addEventListener("progress",(function(e){const n=Nh[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onProgress&&r.onProgress(e)}}),!1),a.addEventListener("error",(function(e){const n=Nh[t];delete Nh[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),a.addEventListener("abort",(function(e){const n=Nh[t];delete Nh[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)a.setRequestHeader(t,this.requestHeader[t]);a.send(null)}return i.manager.itemStart(t),a}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class Ih extends Rh{constructor(t){super(t)}load(t,e,n,r){const i=this,s=new Ph(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}parse(t){const e=[];for(let n=0;n<t.length;n++){const r=Ah.parse(t[n]);e.push(r)}return e}}class Oh extends Rh{constructor(t){super(t)}load(t,e,n,r){const i=this,s=[],o=new Ic,a=new Ph(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials);let l=0;function c(c){a.load(t[c],(function(t){const n=i.parse(t,!0);s[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(o.minFilter=vt),o.image=s,o.format=n.format,o.needsUpdate=!0,e&&e(o))}),n,r)}if(Array.isArray(t))for(let e=0,n=t.length;e<n;++e)c(e);else a.load(t,(function(t){const n=i.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)s[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),s[e].format=n.format,s[e].width=n.width,s[e].height=n.height}o.image=s}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=vt),o.format=n.format,o.needsUpdate=!0,e&&e(o)}),n,r);return o}}class Fh extends Rh{constructor(t){super(t)}load(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=Ch.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;const o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),Ch.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(t),o.src=t,o}}class kh extends Rh{constructor(t){super(t)}load(t,e,n,r){const i=new Cs,s=new Fh(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(n){s.load(t[n],(function(t){i.images[n]=t,o++,6===o&&(i.needsUpdate=!0,e&&e(i))}),void 0,r)}for(let e=0;e<t.length;++e)a(e);return i}}class Dh extends Rh{constructor(t){super(t)}load(t,e,n,r){const i=this,s=new oc,o=new Ph(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(i.withCredentials),o.load(t,(function(t){const n=i.parse(t);n&&(void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:pt,s.wrapT=void 0!==n.wrapT?n.wrapT:pt,s.magFilter=void 0!==n.magFilter?n.magFilter:vt,s.minFilter=void 0!==n.minFilter?n.minFilter:vt,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(s.encoding=n.encoding),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=wt),1===n.mipmapCount&&(s.minFilter=vt),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,e&&e(s,n))}),n,r),s}}class Uh extends Rh{constructor(t){super(t)}load(t,e,n,r){const i=new tr,s=new Fh(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(n){i.image=n;const r=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);i.format=r?Ft:kt,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i}}class zh extends Xc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new lu(e,t))}getPoint(t){const e=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=e){const t=n[r]-e,i=this.curves[r],s=i.getLength(),o=0===s?0:1-t/s;return i.getPointAt(o)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const s=i[r],o=s&&s.isEllipseCurve?2*t:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o);for(let t=0;t<a.length;t++){const r=a[t];n&&n.equals(r)||(e.push(r),n=r)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new du[n.type]).fromJSON(n))}return this}}class jh extends zh{constructor(t){super(),this.type="Path",this.currentPoint=new Yn,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new lu(this.currentPoint.clone(),new Yn(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,r){const i=new uu(this.currentPoint.clone(),new Yn(t,e),new Yn(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(t,e,n,r,i,s){const o=new ou(this.currentPoint.clone(),new Yn(t,e),new Yn(n,r),new Yn(i,s));return this.curves.push(o),this.currentPoint.set(i,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new pu(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,r,i,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,n,r,i,s),this}absarc(t,e,n,r,i,s){return this.absellipse(t,e,n,n,r,i,s),this}ellipse(t,e,n,r,i,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,r,i,s,o,a),this}absellipse(t,e,n,r,i,s,o,a){const l=new Yc(t,e,n,r,i,s,o,a);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Gh extends jh{constructor(t){super(t),this.uuid=zn(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new jh).fromJSON(n))}return this}}class Hh extends ci{constructor(t,e=1){super(),this.type="Light",this.color=new Ci(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}Hh.prototype.isLight=!0;class Vh extends Hh{constructor(t,e,n){super(t,n),this.type="HemisphereLight",this.position.copy(ci.DefaultUp),this.updateMatrix(),this.groundColor=new Ci(e)}copy(t){return Hh.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}Vh.prototype.isHemisphereLight=!0;const Wh=new kr,qh=new ar,Xh=new ar;class Yh{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Yn(512,512),this.map=null,this.mapPass=null,this.matrix=new kr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Fs,this._frameExtents=new Yn(1,1),this._viewportCount=1,this._viewports=[new nr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;qh.setFromMatrixPosition(t.matrixWorld),e.position.copy(qh),Xh.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Xh),e.updateMatrixWorld(),Wh.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Wh),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Jh extends Yh{constructor(){super(new Es(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,n=2*Un*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}Jh.prototype.isSpotLightShadow=!0;class Zh extends Hh{constructor(t,e,n=0,r=Math.PI/3,i=0,s=1){super(t,e),this.type="SpotLight",this.position.copy(ci.DefaultUp),this.updateMatrix(),this.target=new ci,this.distance=n,this.angle=r,this.penumbra=i,this.decay=s,this.shadow=new Jh}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Zh.prototype.isSpotLight=!0;const Qh=new kr,Kh=new ar,tp=new ar;class ep extends Yh{constructor(){super(new Es(90,1,.5,500)),this._frameExtents=new Yn(4,2),this._viewportCount=6,this._viewports=[new nr(2,1,1,1),new nr(0,1,1,1),new nr(3,1,1,1),new nr(1,1,1,1),new nr(3,0,1,1),new nr(1,0,1,1)],this._cubeDirections=[new ar(1,0,0),new ar(-1,0,0),new ar(0,0,1),new ar(0,0,-1),new ar(0,1,0),new ar(0,-1,0)],this._cubeUps=[new ar(0,1,0),new ar(0,1,0),new ar(0,1,0),new ar(0,1,0),new ar(0,0,1),new ar(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,r=this.matrix,i=t.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),Kh.setFromMatrixPosition(t.matrixWorld),n.position.copy(Kh),tp.copy(n.position),tp.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(tp),n.updateMatrixWorld(),r.makeTranslation(-Kh.x,-Kh.y,-Kh.z),Qh.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Qh)}}ep.prototype.isPointLightShadow=!0;class np extends Hh{constructor(t,e,n=0,r=1){super(t,e),this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new ep}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}np.prototype.isPointLight=!0;class rp extends Yh{constructor(){super(new Js(-5,5,5,-5,.5,500))}}rp.prototype.isDirectionalLightShadow=!0;class ip extends Hh{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(ci.DefaultUp),this.updateMatrix(),this.target=new ci,this.shadow=new rp}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}ip.prototype.isDirectionalLight=!0;class sp extends Hh{constructor(t,e){super(t,e),this.type="AmbientLight"}}sp.prototype.isAmbientLight=!0;class op extends Hh{constructor(t,e,n=10,r=10){super(t,e),this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}op.prototype.isRectAreaLight=!0;class ap{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new ar)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,r=t.y,i=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*r),e.addScaledVector(s[2],.488603*i),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],n*r*1.092548),e.addScaledVector(s[5],r*i*1.092548),e.addScaledVector(s[6],.315392*(3*i*i-1)),e.addScaledVector(s[7],n*i*1.092548),e.addScaledVector(s[8],.546274*(n*n-r*r)),e}getIrradianceAt(t,e){const n=t.x,r=t.y,i=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*r),e.addScaledVector(s[2],1.023328*i),e.addScaledVector(s[3],1.023328*n),e.addScaledVector(s[4],.858086*n*r),e.addScaledVector(s[5],.858086*r*i),e.addScaledVector(s[6],.743125*i*i-.247708),e.addScaledVector(s[7],.858086*n*i),e.addScaledVector(s[8],.429043*(n*n-r*r)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(t,e+3*r);return this}toArray(t=[],e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(t,e+3*r);return t}static getBasisAt(t,e){const n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)}}ap.prototype.isSphericalHarmonics3=!0;class lp extends Hh{constructor(t=new ap,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}lp.prototype.isLightProbe=!0;class cp extends Rh{constructor(t){super(t),this.textures={}}load(t,e,n,r){const i=this,s=new Ph(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}parse(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const r=new dh[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&void 0!==r.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheenTint&&(r.sheenTint=(new Ci).setHex(t.sheenTint)),void 0!==t.emissive&&void 0!==r.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==r.specular&&r.specular.setHex(t.specular),void 0!==t.specularIntensity&&(r.specularIntensity=t.specularIntensity),void 0!==t.specularTint&&void 0!==r.specularTint&&r.specularTint.setHex(t.specularTint),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.transmission&&(r.transmission=t.transmission),void 0!==t.thickness&&(r.thickness=t.thickness),void 0!==t.attenuationDistance&&(r.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationTint&&void 0!==r.attenuationTint&&r.attenuationTint.setHex(t.attenuationTint),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.shadowSide&&(r.shadowSide=t.shadowSide),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.format&&(r.format=t.format),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.alphaToCoverage&&(r.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(r.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?r.vertexColors=t.vertexColors>0:r.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const i=t.uniforms[e];switch(r.uniforms[e]={},i.type){case"t":r.uniforms[e].value=n(i.value);break;case"c":r.uniforms[e].value=(new Ci).setHex(i.value);break;case"v2":r.uniforms[e].value=(new Yn).fromArray(i.value);break;case"v3":r.uniforms[e].value=(new ar).fromArray(i.value);break;case"v4":r.uniforms[e].value=(new nr).fromArray(i.value);break;case"m3":r.uniforms[e].value=(new Jn).fromArray(i.value);break;case"m4":r.uniforms[e].value=(new kr).fromArray(i.value);break;default:r.uniforms[e].value=i.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)r.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(r.flatShading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=n(t.map)),void 0!==t.matcap&&(r.matcap=n(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),r.normalScale=(new Yn).fromArray(e)}return void 0!==t.displacementMap&&(r.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=n(t.specularMap)),void 0!==t.specularIntensityMap&&(r.specularIntensityMap=n(t.specularIntensityMap)),void 0!==t.specularTintMap&&(r.specularTintMap=n(t.specularTintMap)),void 0!==t.envMap&&(r.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Yn).fromArray(t.clearcoatNormalScale)),void 0!==t.transmissionMap&&(r.transmissionMap=n(t.transmissionMap)),void 0!==t.thicknessMap&&(r.thicknessMap=n(t.thicknessMap)),r}setTextures(t){return this.textures=t,this}}class up{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}}class hp extends ts{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}hp.prototype.isInstancedBufferGeometry=!0;class pp extends Rh{constructor(t){super(t)}load(t,e,n,r){const i=this,s=new Ph(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}parse(t){const e={},n={};function r(t,r){if(void 0!==e[r])return e[r];const i=t.interleavedBuffers[r],s=function(t,e){if(void 0!==n[e])return n[e];const r=t.arrayBuffers[e],i=new Uint32Array(r).buffer;return n[e]=i,i}(t,i.buffer),o=Wi(i.type,s),a=new Ll(o,i.stride);return a.uuid=i.uuid,e[r]=a,a}const i=t.isInstancedBufferGeometry?new hp:new ts,s=t.data.index;if(void 0!==s){const t=Wi(s.type,s.array);i.setIndex(new Ni(t,1))}const o=t.data.attributes;for(const e in o){const n=o[e];let s;if(n.isInterleavedBufferAttribute){const e=r(t.data,n.data);s=new Nl(e,n.itemSize,n.offset,n.normalized)}else{const t=Wi(n.type,n.array);s=new(n.isInstancedBufferAttribute?uc:Ni)(t,n.itemSize,n.normalized)}void 0!==n.name&&(s.name=n.name),void 0!==n.usage&&s.setUsage(n.usage),void 0!==n.updateRange&&(s.updateRange.offset=n.updateRange.offset,s.updateRange.count=n.updateRange.count),i.setAttribute(e,s)}const a=t.data.morphAttributes;if(a)for(const e in a){const n=a[e],s=[];for(let e=0,i=n.length;e<i;e++){const i=n[e];let o;if(i.isInterleavedBufferAttribute){const e=r(t.data,i.data);o=new Nl(e,i.itemSize,i.offset,i.normalized)}else{const t=Wi(i.type,i.array);o=new Ni(t,i.itemSize,i.normalized)}void 0!==i.name&&(o.name=i.name),s.push(o)}i.morphAttributes[e]=s}t.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];i.addGroup(e.start,e.count,e.materialIndex)}const c=t.data.boundingSphere;if(void 0!==c){const t=new ar;void 0!==c.center&&t.fromArray(c.center),i.boundingSphere=new Cr(t,c.radius)}return t.name&&(i.name=t.name),t.userData&&(i.userData=t.userData),i}}class dp extends Rh{constructor(t){super(t)}load(t,e,n,r){const i=this,s=""===this.path?up.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const o=new Ph(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){let s=null;try{s=JSON.parse(n)}catch(e){return void 0!==r&&r(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const o=s.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?i.parse(s,e):console.error("THREE.ObjectLoader: Can't load "+t)}),n,r)}async loadAsync(t,e){const n=""===this.path?up.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;const r=new Ph(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const i=await r.loadAsync(t,e),s=JSON.parse(i),o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(s)}parse(t,e){const n=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,r),s=this.parseImages(t.images,(function(){void 0!==e&&e(l)})),o=this.parseTextures(t.textures,s),a=this.parseMaterials(t.materials,o),l=this.parseObject(t.object,i,a,o,n),c=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,c),void 0!==e){let t=!1;for(const e in s)if(s[e]instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}async parseAsync(t){const e=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,n),i=await this.parseImagesAsync(t.images),s=this.parseTextures(t.textures,i),o=this.parseMaterials(t.materials,s),a=this.parseObject(t.object,r,o,s,e),l=this.parseSkeletons(t.skeletons,a);return this.bindSkeletons(a,l),a}parseShapes(t){const e={};if(void 0!==t)for(let n=0,r=t.length;n<r;n++){const r=(new Gh).fromJSON(t[n]);e[r.uuid]=r}return e}parseSkeletons(t,e){const n={},r={};if(e.traverse((function(t){t.isBone&&(r[t.uuid]=t)})),void 0!==t)for(let e=0,i=t.length;e<i;e++){const i=(new cc).fromJSON(t[e],r);n[i.uuid]=i}return n}parseGeometries(t,e){const n={};if(void 0!==t){const r=new pp;for(let i=0,s=t.length;i<s;i++){let s;const o=t[i];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(o);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:o.type in rh?s=rh[o.type].fromJSON(o,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),!0===s.isBufferGeometry&&void 0!==o.userData&&(s.userData=o.userData),n[o.uuid]=s}}return n}parseMaterials(t,e){const n={},r={};if(void 0!==t){const i=new cp;i.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];if("MultiMaterial"===s.type){const t=[];for(let e=0;e<s.materials.length;e++){const r=s.materials[e];void 0===n[r.uuid]&&(n[r.uuid]=i.parse(r)),t.push(n[r.uuid])}r[s.uuid]=t}else void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r}parseAnimations(t){const e={};if(void 0!==t)for(let n=0;n<t.length;n++){const r=t[n],i=Ah.parse(r);e[i.uuid]=i}return e}parseImages(t,e){const n=this,r={};let i;function s(t){if("string"==typeof t){const e=t;return function(t){return n.manager.itemStart(t),i.load(t,(function(){n.manager.itemEnd(t)}),void 0,(function(){n.manager.itemError(t),n.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e)}return t.data?{data:Wi(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const n=new Bh(e);i=new Fh(n),i.setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],i=n.url;if(Array.isArray(i)){r[n.uuid]=[];for(let t=0,e=i.length;t<e;t++){const e=s(i[t]);null!==e&&(e instanceof HTMLImageElement?r[n.uuid].push(e):r[n.uuid].push(new oc(e.data,e.width,e.height)))}}else{const t=s(n.url);null!==t&&(r[n.uuid]=t)}}}return r}async parseImagesAsync(t){const e=this,n={};let r;async function i(t){if("string"==typeof t){const n=t,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:e.resourcePath+n;return await r.loadAsync(i)}return t.data?{data:Wi(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){r=new Fh(this.manager),r.setCrossOrigin(this.crossOrigin);for(let e=0,r=t.length;e<r;e++){const r=t[e],s=r.url;if(Array.isArray(s)){n[r.uuid]=[];for(let t=0,e=s.length;t<e;t++){const e=s[t],o=await i(e);null!==o&&(o instanceof HTMLImageElement?n[r.uuid].push(o):n[r.uuid].push(new oc(o.data,o.width,o.height)))}}else{const t=await i(r.url);null!==t&&(n[r.uuid]=t)}}}return n}parseTextures(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const r={};if(void 0!==t)for(let i=0,s=t.length;i<s;i++){const s=t[i];let o;void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const a=e[s.image];Array.isArray(a)?(o=new Cs(a),6===a.length&&(o.needsUpdate=!0)):(o=a&&a.data?new oc(a.data,a.width,a.height):new tr(a),a&&(o.needsUpdate=!0)),o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=n(s.mapping,fp)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=n(s.wrap[0],mp),o.wrapT=n(s.wrap[1],mp)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=n(s.minFilter,_p)),void 0!==s.magFilter&&(o.magFilter=n(s.magFilter,_p)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),r[s.uuid]=o}return r}parseObject(t,e,n,r,i){let s,o,a;function l(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function c(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),e.push(n[i])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}function u(t){return void 0===r[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),r[t]}switch(t.type){case"Scene":s=new Bl,void 0!==t.background&&(Number.isInteger(t.background)?s.background=new Ci(t.background):s.background=u(t.background)),void 0!==t.environment&&(s.environment=u(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new Cl(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new $l(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":s=new Es(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new Js(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new sp(t.color,t.intensity);break;case"DirectionalLight":s=new ip(t.color,t.intensity);break;case"PointLight":s=new np(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new op(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new Zh(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new Vh(t.color,t.groundColor,t.intensity);break;case"LightProbe":s=(new lp).fromJSON(t);break;case"SkinnedMesh":o=l(t.geometry),a=c(t.material),s=new ic(o,a),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":o=l(t.geometry),a=c(t.material),s=new ys(o,a);break;case"InstancedMesh":o=l(t.geometry),a=c(t.material);const e=t.count,n=t.instanceMatrix,r=t.instanceColor;s=new mc(o,a,e),s.instanceMatrix=new uc(new Float32Array(n.array),16),void 0!==r&&(s.instanceColor=new uc(new Float32Array(r.array),r.itemSize));break;case"LOD":s=new Ql;break;case"Line":s=new wc(l(t.geometry),c(t.material));break;case"LineLoop":s=new Ec(l(t.geometry),c(t.material));break;case"LineSegments":s=new Tc(l(t.geometry),c(t.material));break;case"PointCloud":case"Points":s=new Rc(l(t.geometry),c(t.material));break;case"Sprite":s=new Xl(c(t.material));break;case"Group":s=new xl;break;case"Bone":s=new sc;break;default:s=new ci}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){const o=t.children;for(let t=0;t<o.length;t++)s.add(this.parseObject(o[t],e,n,r,i))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const n=e[t];s.animations.push(i[n])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],r=s.getObjectByProperty("uuid",n.object);void 0!==r&&s.addLevel(r,n.distance)}}return s}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const n=e[t.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(n,t.bindMatrix)}}))}setTexturePath(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}const fp={UVMapping:it,CubeReflectionMapping:st,CubeRefractionMapping:ot,EquirectangularReflectionMapping:at,EquirectangularRefractionMapping:lt,CubeUVReflectionMapping:ct,CubeUVRefractionMapping:ut},mp={RepeatWrapping:ht,ClampToEdgeWrapping:pt,MirroredRepeatWrapping:dt},_p={NearestFilter:ft,NearestMipmapNearestFilter:mt,NearestMipmapLinearFilter:gt,LinearFilter:vt,LinearMipmapNearestFilter:bt,LinearMipmapLinearFilter:wt};class gp extends Rh{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=Ch.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){Ch.add(t,n),e&&e(n),i.manager.itemEnd(t)})).catch((function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)}}gp.prototype.isImageBitmapLoader=!0;class yp{constructor(){this.type="ShapePath",this.color=new Ci,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new jh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,n,r){return this.currentPath.quadraticCurveTo(t,e,n,r),this}bezierCurveTo(t,e,n,r,i,s){return this.currentPath.bezierCurveTo(t,e,n,r,i,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t,e){function n(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n],i=new Gh;i.curves=r.curves,e.push(i)}return e}function r(t,e){const n=e.length;let r=!1;for(let i=n-1,s=0;s<n;i=s++){let n=e[i],o=e[s],a=o.x-n.x,l=o.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=e[s],a=-a,o=e[i],l=-l),t.y<n.y||t.y>o.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=l*(t.x-n.x)-a*(t.y-n.y);if(0===e)return!0;if(e<0)continue;r=!r}}else{if(t.y!==n.y)continue;if(o.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=o.x)return!0}}return r}const i=ku.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===e)return n(s);let o,a,l;const c=[];if(1===s.length)return a=s[0],l=new Gh,l.curves=a.curves,c.push(l),c;let u=!i(s[0].getPoints());u=t?!u:u;const h=[],p=[];let d,f,m=[],_=0;p[_]=void 0,m[_]=[];for(let e=0,n=s.length;e<n;e++)a=s[e],d=a.getPoints(),o=i(d),o=t?!o:o,o?(!u&&p[_]&&_++,p[_]={s:new Gh,p:d},p[_].s.curves=a.curves,u&&_++,m[_]=[]):m[_].push({h:a,p:d[0]});if(!p[0])return n(s);if(p.length>1){let t=!1;const e=[];for(let t=0,e=p.length;t<e;t++)h[t]=[];for(let n=0,i=p.length;n<i;n++){const i=m[n];for(let s=0;s<i.length;s++){const o=i[s];let a=!0;for(let i=0;i<p.length;i++)r(o.p,p[i].p)&&(n!==i&&e.push({froms:n,tos:i,hole:s}),a?(a=!1,h[i].push(o)):t=!0);a&&h[n].push(o)}}e.length>0&&(t||(m=h))}for(let t=0,e=p.length;t<e;t++){l=p[t].s,c.push(l),f=m[t];for(let t=0,e=f.length;t<e;t++)l.holes.push(f[t].h)}return c}}class vp{constructor(t){this.type="Font",this.data=t}generateShapes(t,e=100){const n=[],r=function(t,e,n){const r=Array.from(t),i=e/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,o=[];let a=0,l=0;for(let t=0;t<r.length;t++){const e=r[t];if("\n"===e)a=0,l-=s;else{const t=bp(e,i,a,l,n);a+=t.offsetX,o.push(t.path)}}return o}(t,e,this.data);for(let t=0,e=r.length;t<e;t++)Array.prototype.push.apply(n,r[t].toShapes());return n}}function bp(t,e,n,r,i){const s=i.glyphs[t]||i.glyphs["?"];if(!s)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+i.familyName+".");const o=new yp;let a,l,c,u,h,p,d,f;if(s.o){const t=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let i=0,s=t.length;i<s;)switch(t[i++]){case"m":a=t[i++]*e+n,l=t[i++]*e+r,o.moveTo(a,l);break;case"l":a=t[i++]*e+n,l=t[i++]*e+r,o.lineTo(a,l);break;case"q":c=t[i++]*e+n,u=t[i++]*e+r,h=t[i++]*e+n,p=t[i++]*e+r,o.quadraticCurveTo(h,p,c,u);break;case"b":c=t[i++]*e+n,u=t[i++]*e+r,h=t[i++]*e+n,p=t[i++]*e+r,d=t[i++]*e+n,f=t[i++]*e+r,o.bezierCurveTo(h,p,d,f,c,u)}}return{offsetX:s.ha*e,path:o}}vp.prototype.isFont=!0;class xp extends Rh{constructor(t){super(t)}load(t,e,n,r){const i=this,s=new Ph(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,(function(t){let n;try{n=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}const r=i.parse(n);e&&e(r)}),n,r)}parse(t){return new vp(t)}}let wp;const Sp={getContext:function(){return void 0===wp&&(wp=new(window.AudioContext||window.webkitAudioContext)),wp},setContext:function(t){wp=t}};class Mp extends Rh{constructor(t){super(t)}load(t,e,n,r){const i=this,s=new Ph(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){try{const t=n.slice(0);Sp.getContext().decodeAudioData(t,(function(t){e(t)}))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}}class Tp extends lp{constructor(t,e,n=1){super(void 0,n);const r=(new Ci).set(t),i=(new Ci).set(e),s=new ar(r.r,r.g,r.b),o=new ar(i.r,i.g,i.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}}Tp.prototype.isHemisphereLightProbe=!0;class Ep extends lp{constructor(t,e=1){super(void 0,e);const n=(new Ci).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Ep.prototype.isAmbientLightProbe=!0;const Ap=new kr,$p=new kr;class Cp{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Es,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Es,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const n=t.projectionMatrix.clone(),r=e.eyeSep/2,i=r*e.near/e.focus,s=e.near*Math.tan(Dn*e.fov*.5)/e.zoom;let o,a;$p.elements[12]=-r,Ap.elements[12]=r,o=-s*e.aspect+i,a=s*e.aspect+i,n.elements[0]=2*e.near/(a-o),n.elements[8]=(a+o)/(a-o),this.cameraL.projectionMatrix.copy(n),o=-s*e.aspect-i,a=s*e.aspect-i,n.elements[0]=2*e.near/(a-o),n.elements[8]=(a+o)/(a-o),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply($p),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Ap)}}class Bp{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Lp(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=Lp();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function Lp(){return("undefined"==typeof performance?Date:performance).now()}const Rp=new ar,Np=new or,Pp=new ar,Ip=new ar;class Op extends ci{constructor(){super(),this.type="AudioListener",this.context=Sp.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Bp}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Rp,Np,Pp),Ip.set(0,0,-1).applyQuaternion(Np),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Rp.x,t),e.positionY.linearRampToValueAtTime(Rp.y,t),e.positionZ.linearRampToValueAtTime(Rp.z,t),e.forwardX.linearRampToValueAtTime(Ip.x,t),e.forwardY.linearRampToValueAtTime(Ip.y,t),e.forwardZ.linearRampToValueAtTime(Ip.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition(Rp.x,Rp.y,Rp.z),e.setOrientation(Ip.x,Ip.y,Ip.z,n.x,n.y,n.z)}}class Fp extends ci{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const kp=new ar,Dp=new or,Up=new ar,zp=new ar;class jp extends Fp{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(kp,Dp,Up),zp.set(0,0,1).applyQuaternion(Dp);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(kp.x,t),e.positionY.linearRampToValueAtTime(kp.y,t),e.positionZ.linearRampToValueAtTime(kp.z,t),e.orientationX.linearRampToValueAtTime(zp.x,t),e.orientationY.linearRampToValueAtTime(zp.y,t),e.orientationZ.linearRampToValueAtTime(zp.z,t)}else e.setPosition(kp.x,kp.y,kp.z),e.setOrientation(zp.x,zp.y,zp.z)}}class Gp{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}class Hp{constructor(t,e,n){let r,i,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":r=this._slerp,i=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,r=this.valueSize,i=t*r+r;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==r;++t)n[i+t]=n[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(n,i,0,t,r)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const t=e*this._origIndex;this._mixBufferRegion(n,r,t,1-i,e)}s>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*e,1,e);for(let t=e,i=e+e;t!==i;++t)if(n[t]!==n[t+e]){o.setValue(n,r);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(e,r);for(let t=n,i=r;t!==i;++t)e[t]=e[r+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)t[e+r]=t[n+r]}_slerp(t,e,n,r){or.slerpFlat(t,e,t,e,t,n,r)}_slerpAdditive(t,e,n,r,i){const s=this._workIndex*i;or.multiplyQuaternionsFlat(t,s,t,e,t,n),or.slerpFlat(t,e,t,e,t,s,r)}_lerp(t,e,n,r,i){const s=1-r;for(let o=0;o!==i;++o){const i=e+o;t[i]=t[i]*s+t[n+o]*r}}_lerpAdditive(t,e,n,r,i){for(let s=0;s!==i;++s){const i=e+s;t[i]=t[i]+t[n+s]*r}}}const Vp="\\[\\]\\.:\\/",Wp=new RegExp("["+Vp+"]","g"),qp="[^"+Vp+"]",Xp="[^"+Vp.replace("\\.","")+"]",Yp=/((?:WC+[\/:])*)/.source.replace("WC",qp),Jp=/(WCOD+)?/.source.replace("WCOD",Xp),Zp=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",qp),Qp=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",qp),Kp=new RegExp("^"+Yp+Jp+Zp+Qp+"$"),td=["material","materials","bones"];class ed{constructor(t,e,n){this.path=e,this.parsedPath=n||ed.parseTrackName(e),this.node=ed.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new ed.Composite(t,e,n):new ed(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Wp,"")}static parseTrackName(t){const e=Kp.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const t=n.nodeName.substring(r+1);-1!==td.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let r=0;r<t.length;r++){const i=t[r];if(i.name===e||i.uuid===e)return i;const s=n(i.children);if(s)return s}return null},r=n(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)t[e++]=n[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,r=e.propertyName;let i=e.propertyIndex;if(t||(t=ed.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===r){r=e;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==r){if(void 0===t[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[r]}}const s=t[r];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ed.Composite=class{constructor(t,e,n){const r=n||ed.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},ed.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ed.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ed.prototype.GetterByBindingType=[ed.prototype._getValue_direct,ed.prototype._getValue_array,ed.prototype._getValue_arrayElement,ed.prototype._getValue_toArray],ed.prototype.SetterByBindingTypeAndVersioning=[[ed.prototype._setValue_direct,ed.prototype._setValue_direct_setNeedsUpdate,ed.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ed.prototype._setValue_array,ed.prototype._setValue_array_setNeedsUpdate,ed.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ed.prototype._setValue_arrayElement,ed.prototype._setValue_arrayElement_setNeedsUpdate,ed.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ed.prototype._setValue_fromArray,ed.prototype._setValue_fromArray_setNeedsUpdate,ed.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class nd{constructor(){this.uuid=zn(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,s=i.length;let o,a=t.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let p=e[h];if(void 0===p){p=a++,e[h]=p,t.push(u);for(let t=0,e=s;t!==e;++t)i[t].push(new ed(u,n[t],r[t]))}else if(p<l){o=t[p];const a=--l,c=t[a];e[c.uuid]=p,t[p]=c,e[h]=a,t[a]=u;for(let t=0,e=s;t!==e;++t){const e=i[t],s=e[a];let o=e[p];e[p]=s,void 0===o&&(o=new ed(u,n[t],r[t])),e[a]=o}}else t[p]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s],a=o.uuid,l=e[a];if(void 0!==l&&l>=i){const s=i++,c=t[s];e[c.uuid]=l,t[l]=c,e[a]=s,t[s]=o;for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[s],i=e[l];e[l]=r,e[s]=i}}}this.nCachedObjects_=i}uncache(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,s=t.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,l=e[a];if(void 0!==l)if(delete e[a],l<i){const o=--i,a=t[o],c=--s,u=t[c];e[a.uuid]=l,t[l]=a,e[u.uuid]=o,t[o]=u,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[o],i=e[c];e[l]=r,e[o]=i,e.pop()}}else{const i=--s,o=t[i];i>0&&(e[o.uuid]=l),t[l]=o,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t];e[l]=e[i],e.pop()}}}this.nCachedObjects_=i}subscribe_(t,e){const n=this._bindingsIndicesByPath;let r=n[t];const i=this._bindings;if(void 0!==r)return i[r];const s=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[t]=r,s.push(t),o.push(e),i.push(u);for(let n=c,r=a.length;n!==r;++n){const r=a[n];u[n]=new ed(r,t,e)}return u}unsubscribe_(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const r=this._paths,i=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o];e[t[o]]=n,s[n]=a,s.pop(),i[n]=i[o],i.pop(),r[n]=r[o],r.pop()}}}nd.prototype.isAnimationObjectGroup=!0;class rd{constructor(t,e,n=null,r=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=r;const i=e.tracks,s=i.length,o=new Array(s),a={endingStart:je,endingEnd:je};for(let t=0;t!==s;++t){const e=i[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Fe,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,r=t._clip.duration,i=r/n,s=n/r;t.warp(1,i,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const r=this._mixer,i=r.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=i,a[1]=i+n,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,r){if(!this.enabled)return void this._updateWeight(t);const i=this._startTime;if(null!==i){const r=(t-i)*n;if(r<0||0===n)return;this._startTime=null,e=n*r}e*=this._updateTimeScale(t);const s=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===We)for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(s),e[n].accumulateAdditive(o);else for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(s),e[n].accumulate(r,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let r=this.time+t,i=this._loopCount;const s=n===ke;if(0===t)return-1===i?r:s&&1==(1&i)?e-r:r;if(n===Oe){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),r>=e||r<0){const n=Math.floor(r/e);r-=e*n,i+=Math.abs(n);const o=this.repetitions-i;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(s&&1==(1&i))return e-r}return r}_setEndings(t,e,n){const r=this._interpolantSettings;n?(r.endingStart=Ge,r.endingEnd=Ge):(r.endingStart=t?this.zeroSlopeAtStart?Ge:je:He,r.endingEnd=e?this.zeroSlopeAtEnd?Ge:je:He)}_scheduleFading(t,e,n){const r=this._mixer,i=r.time;let s=this._weightInterpolant;null===s&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=i,a[0]=e,o[1]=i+t,a[1]=n,this}}class id extends On{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,s=t._propertyBindings,o=t._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let t=0;t!==i;++t){const i=r[t],l=i.name;let u=c[l];if(void 0!==u)s[t]=u;else{if(u=s[t],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,l));continue}const r=e&&e._propertyBindings[t].binding.parsedPath;u=new Hp(ed.create(n,l,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,l),s[t]=u}o[t].resultBuffer=u.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){const r=this._actions,i=this._actionsByClip;let s=i[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=r.length,r.push(t),s.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;const i=t._clip.uuid,s=this._actionsByClip,o=s[i],a=o.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[i],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_addInactiveBinding(t,e,n){const r=this._bindingsByRootAndName,i=this._bindings;let s=r[e];void 0===s&&(s={},r[e]=s),s[n]=t,t._cacheIndex=i.length,i.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,s=this._bindingsByRootAndName,o=s[r],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[i],0===Object.keys(o).length&&delete s[r]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new gh(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i}clipAction(t,e,n){const r=e||this._root,i=r.uuid;let s="string"==typeof t?Ah.findByName(r,t):t;const o=null!==s?s.uuid:t,a=this._actionsByClip[o];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:Ve),void 0!==a){const t=a.actionByRoot[i];if(void 0!==t&&t.blendMode===n)return t;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new rd(this,s,e,n);return this._bindAction(c,l),this._addInactiveAction(c,o,i),c}existingAction(t,e){const n=e||this._root,r=n.uuid,i="string"==typeof t?Ah.findByName(n,t):t,s=i?i.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[r]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),s=this._accuIndex^=1;for(let o=0;o!==n;++o)e[o]._update(r,t,i,s);const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const t=i.knownActions;for(let n=0,r=t.length;n!==r;++n){const r=t[n];this._deactivateAction(r);const i=r._cacheIndex,s=e[e.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,s._cacheIndex=i,e[i]=s,e.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const r=n[t].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[e];if(void 0!==r)for(const t in r){const e=r[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}id.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class sd{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new sd(void 0===this.value.clone?this.value:this.value.clone())}}class od extends Ll{constructor(t,e,n=1){super(t,e),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}od.prototype.isInstancedInterleavedBuffer=!0;class ad{constructor(t,e,n,r,i){this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}ad.prototype.isGLBufferAttribute=!0;class ld{constructor(t,e,n=0,r=1/0){this.ray=new Fr(t,e),this.near=n,this.far=r,this.camera=null,this.layers=new Yr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!1,n=[]){return ud(t,this,n,e),n.sort(cd),n}intersectObjects(t,e=!1,n=[]){for(let r=0,i=t.length;r<i;r++)ud(t[r],this,n,e);return n.sort(cd),n}}function cd(t,e){return t.distance-e.distance}function ud(t,e,n,r){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===r){const r=t.children;for(let t=0,i=r.length;t<i;t++)ud(r[t],e,n,!0)}}class hd{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(jn(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class pd{constructor(t=1,e=0,n=0){return this.radius=t,this.theta=e,this.y=n,this}set(t,e,n){return this.radius=t,this.theta=e,this.y=n,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}clone(){return(new this.constructor).copy(this)}}const dd=new Yn;class fd{constructor(t=new Yn(1/0,1/0),e=new Yn(-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=dd.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return dd.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}fd.prototype.isBox2=!0;const md=new ar,_d=new ar;class gd{constructor(t=new ar,e=new ar){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){md.subVectors(t,this.start),_d.subVectors(this.end,this.start);const n=_d.dot(_d);let r=_d.dot(md)/n;return e&&(r=jn(r,0,1)),r}closestPointToPoint(t,e,n){const r=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}class yd extends ci{constructor(t){super(),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}yd.prototype.isImmediateRenderObject=!0;const vd=new ar;class bd extends ci{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const n=new ts,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,n=32;t<n;t++,e++){const i=t/n*Math.PI*2,s=e/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new ji(r,3));const i=new _c({fog:!1,toneMapped:!1});this.cone=new Tc(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),vd.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(vd),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const xd=new ar,wd=new kr,Sd=new kr;class Md extends Tc{constructor(t){const e=Td(t),n=new ts,r=[],i=[],s=new Ci(0,0,1),o=new Ci(0,1,0);for(let t=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(s.r,s.g,s.b),i.push(o.r,o.g,o.b))}n.setAttribute("position",new ji(r,3)),n.setAttribute("color",new ji(i,3)),super(n,new _c({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,r=n.getAttribute("position");Sd.copy(this.root.matrixWorld).invert();for(let t=0,n=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(wd.multiplyMatrices(Sd,i.matrixWorld),xd.setFromMatrixPosition(wd),r.setXYZ(n,xd.x,xd.y,xd.z),wd.multiplyMatrices(Sd,i.parent.matrixWorld),xd.setFromMatrixPosition(wd),r.setXYZ(n+1,xd.x,xd.y,xd.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}function Td(t){const e=[];t&&t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,Td(t.children[n]));return e}class Ed extends ys{constructor(t,e,n){super(new Yu(e,4,2),new Bi({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Ad=new ar,$d=new Ci,Cd=new Ci;class Bd extends ci{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const r=new Vu(e);r.rotateY(.5*Math.PI),this.material=new Bi({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),s=new Float32Array(3*i.count);r.setAttribute("color",new Ni(s,3)),this.add(new ys(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");$d.copy(this.light.color),Cd.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const r=t<n/2?$d:Cd;e.setXYZ(t,r.r,r.g,r.b)}e.needsUpdate=!0}t.lookAt(Ad.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Ld extends Tc{constructor(t=10,e=10,n=4473924,r=8947848){n=new Ci(n),r=new Ci(r);const i=e/2,s=t/e,o=t/2,a=[],l=[];for(let t=0,c=0,u=-o;t<=e;t++,u+=s){a.push(-o,0,u,o,0,u),a.push(u,0,-o,u,0,o);const e=t===i?n:r;e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3}const c=new ts;c.setAttribute("position",new ji(a,3)),c.setAttribute("color",new ji(l,3)),super(c,new _c({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class Rd extends Tc{constructor(t=10,e=16,n=8,r=64,i=4473924,s=8947848){i=new Ci(i),s=new Ci(s);const o=[],a=[];for(let n=0;n<=e;n++){const r=n/e*(2*Math.PI),l=Math.sin(r)*t,c=Math.cos(r)*t;o.push(0,0,0),o.push(l,0,c);const u=1&n?i:s;a.push(u.r,u.g,u.b),a.push(u.r,u.g,u.b)}for(let e=0;e<=n;e++){const l=1&e?i:s,c=t-t/n*e;for(let t=0;t<r;t++){let e=t/r*(2*Math.PI),n=Math.sin(e)*c,i=Math.cos(e)*c;o.push(n,0,i),a.push(l.r,l.g,l.b),e=(t+1)/r*(2*Math.PI),n=Math.sin(e)*c,i=Math.cos(e)*c,o.push(n,0,i),a.push(l.r,l.g,l.b)}}const l=new ts;l.setAttribute("position",new ji(o,3)),l.setAttribute("color",new ji(a,3)),super(l,new _c({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const Nd=new ar,Pd=new ar,Id=new ar;class Od extends ci{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);let r=new ts;r.setAttribute("position",new ji([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const i=new _c({fog:!1,toneMapped:!1});this.lightPlane=new wc(r,i),this.add(this.lightPlane),r=new ts,r.setAttribute("position",new ji([0,0,0,0,0,1],3)),this.targetLine=new wc(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Nd.setFromMatrixPosition(this.light.matrixWorld),Pd.setFromMatrixPosition(this.light.target.matrixWorld),Id.subVectors(Pd,Nd),this.lightPlane.lookAt(Pd),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Pd),this.targetLine.scale.z=Id.length()}}const Fd=new ar,kd=new Ts;class Dd extends Tc{constructor(t){const e=new ts,n=new _c({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],s={},o=new Ci(16755200),a=new Ci(16711680),l=new Ci(43775),c=new Ci(16777215),u=new Ci(3355443);function h(t,e,n){p(t,n),p(e,n)}function p(t,e){r.push(0,0,0),i.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(r.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),e.setAttribute("position",new ji(r,3)),e.setAttribute("color",new ji(i,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){const t=this.geometry,e=this.pointMap;kd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ud("c",e,t,kd,0,0,-1),Ud("t",e,t,kd,0,0,1),Ud("n1",e,t,kd,-1,-1,-1),Ud("n2",e,t,kd,1,-1,-1),Ud("n3",e,t,kd,-1,1,-1),Ud("n4",e,t,kd,1,1,-1),Ud("f1",e,t,kd,-1,-1,1),Ud("f2",e,t,kd,1,-1,1),Ud("f3",e,t,kd,-1,1,1),Ud("f4",e,t,kd,1,1,1),Ud("u1",e,t,kd,.7,1.1,-1),Ud("u2",e,t,kd,-.7,1.1,-1),Ud("u3",e,t,kd,0,2,-1),Ud("cf1",e,t,kd,-1,0,1),Ud("cf2",e,t,kd,1,0,1),Ud("cf3",e,t,kd,0,-1,1),Ud("cf4",e,t,kd,0,1,1),Ud("cn1",e,t,kd,-1,0,-1),Ud("cn2",e,t,kd,1,0,-1),Ud("cn3",e,t,kd,0,-1,-1),Ud("cn4",e,t,kd,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ud(t,e,n,r,i,s,o){Fd.set(i,s,o).unproject(r);const a=e[t];if(void 0!==a){const t=n.getAttribute("position");for(let e=0,n=a.length;e<n;e++)t.setXYZ(a[e],Fd.x,Fd.y,Fd.z)}}const zd=new ur;class jd extends Tc{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new ts;i.setIndex(new Ni(n,1)),i.setAttribute("position",new Ni(r,3)),super(i,new _c({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&zd.setFromObject(this.object),zd.isEmpty())return;const e=zd.min,n=zd.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=e.x,i[4]=n.y,i[5]=n.z,i[6]=e.x,i[7]=e.y,i[8]=n.z,i[9]=n.x,i[10]=e.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=e.z,i[15]=e.x,i[16]=n.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=n.x,i[22]=e.y,i[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return Tc.prototype.copy.call(this,t),this.object=t.object,this}}class Gd extends Tc{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new ts;r.setIndex(new Ni(n,1)),r.setAttribute("position",new ji([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new _c({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}}class Hd extends wc{constructor(t,e=1,n=16776960){const r=n,i=new ts;i.setAttribute("position",new ji([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),super(i,new _c({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=new ts;s.setAttribute("position",new ji([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),this.add(new ys(s,new Bi({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?m:f,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}}const Vd=new ar;let Wd,qd;class Xd extends ci{constructor(t=new ar(0,0,1),e=new ar(0,0,0),n=1,r=16776960,i=.2*n,s=.2*i){super(),this.type="ArrowHelper",void 0===Wd&&(Wd=new ts,Wd.setAttribute("position",new ji([0,0,0,0,1,0],3)),qd=new Dc(0,.5,1,5,1),qd.translate(0,-.5,0)),this.position.copy(e),this.line=new wc(Wd,new _c({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ys(qd,new Bi({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,i,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Vd.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(Vd,e)}}setLength(t,e=.2*t,n=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}}class Yd extends Tc{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new ts;n.setAttribute("position",new ji(e,3)),n.setAttribute("color",new ji([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new _c({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,n){const r=new Ci,i=this.geometry.attributes.color.array;return r.set(t),r.toArray(i,0),r.toArray(i,3),r.set(e),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const Jd=new Float32Array(1),Zd=new Int32Array(Jd.buffer);class Qd{static toHalfFloat(t){Jd[0]=t;const e=Zd[0];let n=e>>16&32768,r=e>>12&2047;const i=e>>23&255;return i<103?n:i>142?(n|=31744,n|=(255==i?0:1)&&8388607&e,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=1&r,n)}}const Kd=0,tf=1,ef=0,nf=1,rf=2;function sf(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function of(t=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function af(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Rc(t,e)}function lf(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Xl(t)}function cf(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Rc(t,e)}function uf(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Ac(t)}function hf(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Ac(t)}function pf(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Ac(t)}function df(t,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new ar(t,e,n)}function ff(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Ni(t,e).setUsage(En)}function mf(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Pi(t,e)}function _f(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Ii(t,e)}function gf(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Oi(t,e)}function yf(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Fi(t,e)}function vf(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new ki(t,e)}function bf(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Di(t,e)}function xf(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Ui(t,e)}function wf(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new ji(t,e)}function Sf(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Gi(t,e)}function Mf(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Yd(t)}function Tf(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new jd(t,e)}function Ef(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Tc(new qc(t.geometry),new _c({color:void 0!==e?e:16777215}))}function Af(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Tc(new eh(t.geometry),new _c({color:void 0!==e?e:16777215}))}function $f(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Ph(t)}function Cf(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Dh(t)}function Bf(t,e,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Bs(t,n)}function Lf(){console.error("THREE.CanvasRenderer has been removed")}function Rf(){console.error("THREE.JSONLoader has been removed.")}Xc.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Xc.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},jh.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},Ld.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Md.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Rh.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),up.extractUrlBase(t)},Rh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},fd.prototype.center=function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},fd.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},fd.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},fd.prototype.size=function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)},ur.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},ur.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},ur.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},ur.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},ur.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},Cr.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Fs.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},gd.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Jn.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},Jn.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Jn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Jn.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Jn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Jn.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},kr.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},kr.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},kr.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new ar).setFromMatrixColumn(this,3)},kr.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},kr.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},kr.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},kr.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},kr.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},kr.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},kr.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},kr.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},kr.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},kr.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},kr.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},kr.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},kr.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},kr.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},kr.prototype.makeFrustum=function(t,e,n,r,i,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,r,n,i,s)},kr.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Ps.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},or.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},or.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Fr.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Fr.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},Fr.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},bi.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},bi.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},bi.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},bi.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},bi.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},bi.barycoordFromPoint=function(t,e,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),bi.getBarycoord(t,e,n,r,i)},bi.normal=function(t,e,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),bi.getNormal(t,e,n,r)},Gh.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},Gh.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new zu(this,t)},Gh.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Xu(this,t)},Yn.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Yn.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Yn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},ar.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},ar.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},ar.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},ar.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},ar.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},ar.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},ar.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},ar.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},ar.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},nr.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},nr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},ci.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},ci.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},ci.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},ci.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},ci.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(ci.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),ys.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(ys.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),qe},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),ic.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Es.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Hh.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(Ni.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===En},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(En)}}}),Ni.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?En:Tn),this},Ni.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Ni.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ts.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},ts.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new Ni(arguments[1],arguments[2])))},ts.prototype.addDrawCall=function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},ts.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},ts.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},ts.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},ts.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(ts.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Ll.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?En:Tn),this},Ll.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},zu.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},zu.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},zu.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Bl.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},sd.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(wi.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Ci}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===g}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Ms.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),El.prototype.clearTarget=function(t,e,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,r)},El.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},El.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},El.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},El.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},El.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},El.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},El.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},El.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},El.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},El.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},El.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},El.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},El.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},El.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},El.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},El.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},El.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},El.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},El.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},El.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},El.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},El.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},El.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},El.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(El.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?Ze:Je}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(_l.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(rr.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Fp.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new Mp).load(t,(function(t){e.setBuffer(t)})),this},Gp.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},$s.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},$s.prototype.clear=function(t,e,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,n,r)},Qn.crossOrigin=void 0,Qn.loadTexture=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new Uh;i.setCrossOrigin(this.crossOrigin);const s=i.load(t,n,void 0,r);return e&&(s.mapping=e),s},Qn.loadTextureCube=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new kh;i.setCrossOrigin(this.crossOrigin);const s=i.load(t,n,void 0,r);return e&&(s.mapping=e),s},Qn.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Qn.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Nf={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function Pf(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:r}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=r)},980:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,factory;"undefined"!=typeof self&&self,factory=function(){var process={release:{name:""}},__BRYTHON__=__BRYTHON__||{};try{eval("async function* f(){}")}catch(t){console.warn("Your browser is not fully supported. If you are using Microsoft Edge, please upgrade to the latest version")}!function(t){var e;t.isWebWorker="undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,t.isNode=void 0!==process&&"node"===process.release.name;var n,r=(e=t.isNode?{location:{href:"",origin:"",pathname:""},navigator:{userLanguage:""}}:self).location.href;if(t.protocol=r.split(":")[0],t.BigInt=e.BigInt,void 0===t.brython_path){var i;if(t.isWebWorker)(i=e.location.href).startsWith("blob:")&&(i=i.substr(5));else{var s=document.getElementsByTagName("script");i=s[s.length-1].src}var o=i.split("/");o.pop(),n=t.brython_path=o.join("/")+"/"}else t.brython_path.endsWith("/")||(t.brython_path+="/"),n=t.brython_path;var a=(e.location.origin+e.location.pathname).split("/");a.pop();var l=t.script_dir=a.join("/");if(t.__ARGV=[],t.webworkers={},t.$py_module_path={},t.file_cache={},t.$py_src={},t.path=[n+"Lib",n+"libs",l,n+"Lib/site-packages"],t.async_enabled=!1,t.async_enabled&&(t.block={}),t.imported={},t.precompiled={},t.frames_stack=[],t.builtins={},t.builtins_scope={id:"__builtins__",module:"__builtins__",binding:{}},t.builtin_funcs={},t.builtin_classes=[],t.__getattr__=function(t){return this[t]},t.__setattr__=function(e,n){if(!(["debug","stdout","stderr"].indexOf(e)>-1))throw t.builtins.AttributeError.$factory("__BRYTHON__ object has no attribute "+e);t[e]=n},t.language=e.navigator.userLanguage||e.navigator.language,t.locale="C",t.isWebWorker?t.charset="utf-8":t.charset=document.characterSet||document.inputEncoding||"utf-8",t.max_int=Math.pow(2,53)-1,t.min_int=-t.max_int,t.$py_next_hash=Math.pow(2,53)-1,t.$py_UUID=0,t.lambda_magic=Math.random().toString(36).substr(2,8),t.set_func_names=function(e,n){if(e.$infos){var r=e.$infos.__name__;e.$infos.__module__=n,e.$infos.__qualname__=r}else r=e.__name__,e.$infos={__name__:r,__module__:n,__qualname__:r};for(var i in e.__module__=n,e)"function"==typeof e[i]&&(e[i].$infos={__doc__:e[i].__doc__||"",__module__:n,__qualname__:r+"."+i,__name__:i},"classmethod"==e[i].$type&&(e[i].__class__=t.method))},"undefined"!=typeof Storage){t.has_local_storage=!1;try{localStorage&&(t.local_storage=localStorage,t.has_local_storage=!0)}catch(t){}t.has_session_storage=!1;try{sessionStorage&&(t.session_storage=sessionStorage,t.has_session_storage=!0)}catch(t){}}else t.has_local_storage=!1,t.has_session_storage=!1;t.globals=function(){return t.frames_stack[t.frames_stack.length-1][3]},t.scripts={},t.$options={},t.update_VFS=function(e){t.VFS=t.VFS||{};var n=e.$timestamp;for(var r in void 0!==n&&delete e.$timestamp,e)t.VFS.hasOwnProperty(r)&&console.warn("Virtual File System: duplicate entry "+r),t.VFS[r]=e[r],t.VFS[r].timestamp=n},t.add_files=function(e){for(var n in t.files=t.files||{},e)t.files[n]=e[n]},t.python_to_js=function(e,n){t.meta_path=t.$meta_path.slice(),t.use_VFS||t.meta_path.shift(),void 0===n&&(n="__main__");var r=__BRYTHON__.py2js(e,n,n).to_js();return"(function() {\n var $locals_"+n+" = {}\n"+r+"\n}())"},e.py=function(e){var n=t.py2js(e[0],"script","script").to_js();t.set_import_paths(),new Function("$locals_script",n)({})}}(__BRYTHON__),__BRYTHON__.implementation=[3,8,10,"final",0],__BRYTHON__.__MAGIC__="3.8.10",__BRYTHON__.version_info=[3,8,0,"final",0],__BRYTHON__.compiled_date="2020-10-06 14:56:18.181563",__BRYTHON__.timestamp=1601988978181,__BRYTHON__.builtin_module_names=["_aio","_ajax","_base64","_binascii","_io_classes","_json","_jsre","_locale","_multiprocessing","_posixsubprocess","_profile","_sre_utils","_string","_strptime","_svg","_warnings","_webcomponent","_webworker","_zlib_utils","array","builtins","dis","hashlib","long_int","marshal","math","math1","modulefinder","posix","random","unicodedata"],function($B){var js,$pos,res,$op;Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.isSafeInteger=Number.isSafeInteger||function(t){return Number.isInteger(t)&&Math.abs(t)<=Number.MAX_SAFE_INTEGER};var _b_=$B.builtins,_window;_window=$B.isNode?{location:{href:"",origin:"",pathname:""}}:self,$B.parser={};var clone=$B.clone=function(t){var e={};for(var n in t)e[n]=t[n];return e};$B.last=function(t){return void 0===t&&console.log($B.frames_stack.slice()),t[t.length-1]},$B.list2obj=function(t,e){var n={},r=t.length;for(void 0===e&&(e=!0);r-- >0;)n[t[r]]=e;return n},$B.op2method={operations:{"**":"pow","//":"floordiv","<<":"lshift",">>":"rshift","+":"add","-":"sub","*":"mul","/":"truediv","%":"mod","@":"matmul"},augmented_assigns:{"//=":"ifloordiv",">>=":"irshift","<<=":"ilshift","**=":"ipow","+=":"iadd","-=":"isub","*=":"imul","/=":"itruediv","%=":"imod","&=":"iand","|=":"ior","^=":"ixor","@=":"imatmul"},binary:{"&":"and","|":"or","~":"invert","^":"xor"},comparisons:{"<":"lt",">":"gt","<=":"le",">=":"ge","==":"eq","!=":"ne"},boolean:{or:"or",and:"and",in:"in",not:"not",is:"is",not_in:"not_in",is_not:"is_not"},subset:function(){var t={},e=[];if("all"==arguments[0])(e=Object.keys($B.op2method)).splice(e.indexOf("subset"),1);else for(var n=0,r=arguments.length;n<r;n++)e.push(arguments[n]);for(n=0,r=e.length;n<r;n++){var i=e[n],s=$B.op2method[i];if(void 0===s)throw Error(i);for(var o in s)t[o]=s[o]}return t}};var $operators=$B.op2method.subset("all"),$augmented_assigns=$B.augmented_assigns=$B.op2method.augmented_assigns,noassign=$B.list2obj(["True","False","None","__debug__"]),$op_order=[["or"],["and"],["not"],["in","not_in"],["<","<=",">",">=","!=","==","is","is_not"],["|"],["^"],["&"],[">>","<<"],["+"],["-"],["*","@","/","//","%"],["unary_neg","unary_inv","unary_pos"],["**"]],$op_weight={},$weight=1;$op_order.forEach((function(t){t.forEach((function(t){$op_weight[t]=$weight})),$weight++}));var $loop_num=0,create_temp_name=$B.parser.create_temp_name=function(t){return(t||"$temp")+$loop_num++},replace_node=$B.parser.replace_node=function(t,e){var n=t.parent,r=get_rank_in_parent(t);n.children[r]=e,e.parent=n,e.bindings=t.bindings},get_rank_in_parent=$B.parser.get_rank_in_parent=function(t){return t.parent.children.indexOf(t)},add_identnode=$B.parser.add_identnode=function(t,e,n,r){var i=new $Node;i.parent=t,i.locals=t.locals,i.module=t.module;var s=new $NodeCtx(i),o=new $ExprCtx(s,"id",!0),a=(new $IdCtx(o,n),new $AssignCtx(o));return-1===e?t.add(i):t.insert(e,i),a.tree[1]=r,i},chained_comp_num=0,$_SyntaxError=$B.parser.$_SyntaxError=function(t,e,n){for(var r=t;"node"!==r.type;)r=r.parent;for(var i=r.node,s=i;void 0!==s.parent;)s=s.parent;var o=i.module,a=s.src,l=i.line_num;if(a&&(l=a.substr(0,$pos).split("\n").length),s.line_info&&(l=s.line_info),void 0!==n&&"number"==typeof n)throw $B.$IndentationError(o,e,a,$pos,l,s);Array.isArray(e)&&$B.$SyntaxError(o,e[0],a,$pos,l,s),"Triple string end not found"===e&&$B.$SyntaxError(o,"invalid syntax : triple string end not found",a,$pos,l,s);var c="invalid syntax";e.startsWith("token ")||(c+=" ("+e+")"),$B.$SyntaxError(o,c,a,$pos,l,s)};function SyntaxWarning(t,e){var n=$get_node(t),r=$get_module(t),i=r.src.split("\n"),s=`Module ${r.module}line ${n.line_num}:${e}\n    `+i[n.line_num-1];$B.$getattr($B.stderr,"write")(s)}function check_assignment(t){for(var e=t,n=["assert","del","import","raise","return"];e;)n.indexOf(e.type)>-1?$_SyntaxError(t,"invalid syntax - assign"):"expr"==e.type&&"op"==e.tree[0].type&&(void 0!==$B.op2method.comparisons[e.tree[0].op]?$_SyntaxError(t,["cannot assign to comparison"]):$_SyntaxError(t,["cannot assign to operator"])),e=e.parent}var $Node=$B.parser.$Node=function(t){this.type=t,this.children=[]};$Node.prototype.add=function(t){this.children[this.children.length]=t,t.parent=this,t.module=this.module},$Node.prototype.insert=function(t,e){this.children.splice(t,0,e),e.parent=this,e.module=this.module},$Node.prototype.toString=function(){return"<object 'Node'>"},$Node.prototype.show=function(t){var e="";return"module"===this.type?(this.children.forEach((function(n){e+=n.show(t)})),e):(e+=" ".repeat(t=t||0),e+=this.C,this.children.length>0&&(e+="{"),e+="\n",this.children.forEach((function(n){e+="["+i+"] "+n.show(t+4)})),this.children.length>0&&(e+=" ".repeat(t),e+="}\n"),e)},$Node.prototype.to_js=function(t){if(void 0!==this.js)return this.js;if(this.res=[],this.unbound=[],"module"===this.type)return this.children.forEach((function(t){this.res.push(t.to_js())}),this),this.js=this.res.join(""),this.js;t=t||0;var e=this.C.to_js();return e&&(this.res.push(" ".repeat(t)),this.res.push(e),this.children.length>0&&this.res.push("{"),this.res.push("\n"),this.children.forEach((function(e){this.res.push(e.to_js(t+4))}),this),this.children.length>0&&(this.res.push(" ".repeat(t)),this.res.push("}\n"))),this.js=this.res.join(""),this.js},$Node.prototype.transform=function(t){if(this.has_await)return this.parent.insert(t,$NodeJS("var save_stack = $B.save_stack()")),this.parent.insert(t+2,$NodeJS("$B.restore_stack(save_stack, $locals)")),this.has_await=!1,1;if(this.has_yield&&!this.has_yield.transformed){var e=this.parent;if(this.has_yield.from){var n=new $Node,r=new $NodeCtx(n),i=new $ExprCtx(r,"js",!1),s=new $RawJSCtx(i,`var _i${this.has_yield.from_num}`),o=new $AssignCtx(i);new $ExprCtx(o).tree=this.has_yield.tree,e.insert(t,n),$get_node(this.has_yield);var a=this.has_yield.from_num,l=`$B.$import("sys",[],{})\n_i${a}=_b_.iter(_i${a})\nvar $failed${a}=false\ntry{var _y${a}=_b_.next(_i${a})}catch(_e){$B.set_exc(_e)\n$failed${a}=true\n$B.pmframe=$B.last($B.frames_stack)\n_e=$B.exception(_e)\nif(_e.__class__===_b_.StopIteration){var _r${a}=$B.$getattr(_e,"value")}else{throw _e}}\nif(! $failed${a}){while(true){var $failed1${a}=false\ntry{$B.leave_frame({$locals})\nvar _s${a}=yield _y${a}\n$B.frames_stack.push($top_frame)}catch(_e){if(_e.__class__===_b_.GeneratorExit){var $failed2${a}=false\ntry{var _m${a}=$B.$geatttr(_i${a},"close")}catch(_e1){$failed2${a}=true\nif(_e1.__class__ !==_b_.AttributeError){throw _e1}}\nif(! $failed2${a}){$B.$call(_m${a})()}\nthrow _e}else if($B.is_exc(_e,[_b_.BaseException])){var _x=$B.$call($B.$getattr($locals.sys,"exc_info"))()\nvar $failed3${a}=false\ntry{var _m${a}=$B.$getattr(_i${a},"throw")}catch(err){$failed3${a}=true\nif($B.is_exc(err,[_b_.AttributeError])){throw err}}\nif(! $failed3${a}){try{_y${a}=$B.$call(_m${a}).apply(null,_b_.list.$factory(_x${a}))}catch(err){if($B.$is_exc(err,[_b_.StopIteration])){_r${a}=$B.$getattr(err,"value")\nbreak}\nthrow err}}}}\nif(! $failed1${a}){try{if(_s${a}===_b_.None){_y${a}=_b_.next(_i${a})}else{_y${a}=$B.$call($B.$getattr(_i${a},"send"))(_s${a})}}catch(err){if($B.is_exc(err,[_b_.StopIteration])){_r${a}=$B.$getattr(err,"value")\nbreak}\nthrow err}}}}`;return e.insert(t+1,$NodeJS(l)),3}e.children.splice(t,1),"abstract_expr"===this.has_yield.tree[0].type?n=$NodeJS("var result = _b_.None"):(n=new $Node,r=new $NodeCtx(n),i=new $ExprCtx(r,"js",!1),s=new $RawJSCtx(i,"var result"),(o=new $AssignCtx(i)).tree[1]=this.has_yield.tree[0],s.parent=o),n.line_num=this.line_num,e.insert(t,n);var c=new $NodeJS("try");c.add($NodeJS("$B.leave_frame({$locals})")),c.add(this),e.insert(t+1,c),this.has_yield.to_js=function(){return"yield result"},this.has_yield.transformed=!0;for(var u=0;u<c.children.length;)void 0===(f=c.children[u].transform(u))&&(f=1),u+=f;var h=$NodeJS(`catch(err${this.line_num})`);return h.add($NodeJS("$B.frames_stack.push($top_frame)")),h.add($NodeJS(`throw err${this.line_num}`)),e.insert(t+2,h),e.insert(t+3,$NodeJS("$B.frames_stack.push($top_frame)")),2}if("module"!==this.type){var p,d=this.C.tree[0];for(void 0===d&&console.log(this),void 0!==d.transform&&(p=d.transform(this,t)),u=0;u<this.children.length;)void 0===(f=this.children[u].transform(u))&&(f=1),u+=f;return void 0===p&&(p=1),p}this.__doc__=$get_docstring(this);for(u=0;u<this.children.length;){var f;void 0===(f=this.children[u].transform(u))&&(f=1),u+=f}},$Node.prototype.clone=function(){var t=new $Node(this.type);for(var e in this)t[e]=this[e];return t},$Node.prototype.clone_tree=function(){var t=new $Node(this.type);for(var e in this)t[e]=this[e];t.children=[];for(var n=0,r=this.children.length;n<r;n++)t.add(this.children[n].clone_tree());return t};var $AbstractExprCtx=$B.parser.$AbstractExprCtx=function(t,e){this.type="abstract_expr",this.with_commas=e,this.parent=t,this.tree=[],t.tree[t.tree.length]=this};$AbstractExprCtx.prototype.toString=function(){return"(abstract_expr "+this.with_commas+") "+this.tree},$AbstractExprCtx.prototype.transition=function(t,e){var n=this,r=n.packed,i=n.is_await,s=n.assign;if(!s)switch(t){case"id":case"imaginary":case"int":case"float":case"str":case"bytes":case"[":case"(":case"{":case".":case"not":case"lambda":case"yield":n.parent.tree.pop();var o=n.with_commas;(n=n.parent).packed=r,n.is_await=i,s&&(console.log("set assign to parent",n),n.assign=s)}switch(t){case"await":return new $AwaitCtx(n);case"id":return new $IdCtx(new $ExprCtx(n,"id",o),e);case"str":return new $StringCtx(new $ExprCtx(n,"str",o),e);case"bytes":return new $StringCtx(new $ExprCtx(n,"bytes",o),e);case"int":return new $NumberCtx("int",new $ExprCtx(n,"int",o),e);case"float":return new $NumberCtx("float",new $ExprCtx(n,"float",o),e);case"imaginary":return new $NumberCtx("imaginary",new $ExprCtx(n,"imaginary",o),e);case"(":return new $ListOrTupleCtx(new $ExprCtx(n,"tuple",o),"tuple");case"[":return new $ListOrTupleCtx(new $ExprCtx(n,"list",o),"list");case"{":return new $DictOrSetCtx(new $ExprCtx(n,"dict_or_set",o));case".":return new $EllipsisCtx(new $ExprCtx(n,"ellipsis",o));case"not":return"op"==n.type&&"is"==n.op?(n.op="is_not",n):new $NotCtx(new $ExprCtx(n,"not",o));case"lambda":return new $LambdaCtx(new $ExprCtx(n,"lambda",o));case"op":var a=e;switch(a){case"*":return n.parent.tree.pop(),o=n.with_commas,n=n.parent,new $PackedCtx(new $ExprCtx(n,"expr",o));case"-":case"~":case"+":n.parent.tree.pop();var l=new $UnaryCtx(n.parent,a);if("-"==a)var c=new $OpCtx(l,"unary_neg");else c=new $OpCtx(l,"+"==a?"unary_pos":"unary_inv");return new $AbstractExprCtx(c,!1);case"not":return n.parent.tree.pop(),o=n.with_commas,n=n.parent,new $NotCtx(new $ExprCtx(n,"not",o))}$_SyntaxError(n,"token "+t+" after "+n);case"=":$_SyntaxError(n,"token "+t+" after "+n);case"yield":return new $AbstractExprCtx(new $YieldCtx(n),!0);case":":return"sub"==n.parent.type||"list_or_tuple"==n.parent.type&&"sub"==n.parent.parent.type?new $AbstractExprCtx(new $SliceCtx(n.parent),!1):$transition(n.parent,t,e);case")":case",":switch(n.parent.type){case"list_or_tuple":case"slice":case"call_arg":case"op":case"yield":break;case"annotation":$_SyntaxError(n,"empty annotation");default:$_SyntaxError(n,t)}}return $transition(n.parent,t,e)},$AbstractExprCtx.prototype.to_js=function(){return this.js_processed=!0,"list"===this.type?"["+$to_js(this.tree)+"]":$to_js(this.tree)};var $AliasCtx=$B.parser.$AliasCtx=function(t){this.type="ctx_manager_alias",this.parent=t,this.tree=[],t.tree[t.tree.length-1].alias=this};$AliasCtx.prototype.transition=function(t,e){var n=this;switch(t){case",":case":":return n.parent.set_alias(n.tree[0].tree[0]),$transition(n.parent,t,e)}$_SyntaxError(n,"token "+t+" after "+n)};var $AnnotationCtx=$B.parser.$AnnotationCtx=function(t){this.type="annotation",this.parent=t,this.tree=[],t.annotation=this;var e=$get_scope(t);if(void 0===e.binding.__annotations__&&(e.binding.__annotations__=!0,t.create_annotations=!0),"def"==e.ntype&&t.tree&&t.tree.length>0&&"id"==t.tree[0].type){var n=t.tree[0].value;e.globals&&e.globals.has(n)>-1&&$_SyntaxError(t,["annotated name '"+n+"' can't be global"]),e.annotations=e.annotations||new Set,e.annotations.add(n),t.$in_parens||(e.binding=e.binding||{},e.binding[n]=!0)}};$AnnotationCtx.prototype.toString=function(){return"(annotation) "+this.tree},$AnnotationCtx.prototype.transition=function(t,e){var n=this;return"eol"==t&&1==n.tree.length&&0==n.tree[0].tree.length?$_SyntaxError(n,"empty annotation"):":"==t&&"def"!=n.parent.type?$_SyntaxError(n,"more than one annotation"):"augm_assign"==t?$_SyntaxError(n,"augmented assign as annotation"):"op"==t&&$_SyntaxError(n,"operator as annotation"),$transition(n.parent,t)},$AnnotationCtx.prototype.to_js=function(){return $to_js(this.tree)};var $AssertCtx=$B.parser.$AssertCtx=function(t){this.type="assert",this.parent=t,this.tree=[],t.tree[t.tree.length]=this};$AssertCtx.prototype.toString=function(){return"(assert) "+this.tree},$AssertCtx.prototype.transition=function(t,e){var n=this;return","==t?(this.tree.length>1&&$_SyntaxError(n,"too many commas after assert"),new $AbstractExprCtx(this,!1)):"eol"==t?$transition(n.parent,t):void $_SyntaxError(n,t)},$AssertCtx.prototype.transform=function(t,e){if(this.tree.length>1)var n=this.tree[0],r=this.tree[1];else n=this.tree[0],r=null;"expr"==this.tree[0].type&&"tuple"==this.tree[0].name&&this.tree[0].tree[0].tree.length>1&&SyntaxWarning(this,"assertion is always true, perhaps remove parentheses?");var i=new $ConditionCtx(t.C,"if");new $NotCtx(i).tree=[n],t.C=i;var s=new $Node,o="throw _b_.AssertionError.$factory()";null!==r&&(o="throw _b_.AssertionError.$factory(_b_.str.$factory("+r.to_js()+"))"),new $NodeJSCtx(s,o),t.add(s)};var $AssignCtx=$B.parser.$AssignCtx=function(t,e){check_assignment(t),"expr"==t.type&&"lambda"==t.tree[0].type&&$_SyntaxError(t,["cannot assign to lambda"]),this.type="assign","expression"==e&&(this.expression=!0,console.log("parent of assign expr",t.parent)),t.parent.tree.pop(),t.parent.tree[t.parent.tree.length]=this,this.parent=t.parent,this.tree=[t];var n=$get_scope(this);if("expr"==t.type&&"call"==t.tree[0].type)$_SyntaxError(t,["cannot assign to function call "]);else if("list_or_tuple"==t.type||"expr"==t.type&&"list_or_tuple"==t.tree[0].type)"expr"==t.type&&(t=t.tree[0]),t.bind_ids(n);else if("assign"==t.type)t.tree.forEach((function(t){var e=t.tree[0];"id"==e.type&&$bind(e.value,n,this)}),this);else{var r=t.tree[0];if(r&&"id"==r.type)if(!0===noassign[r.value]&&$_SyntaxError(t,["cannot assign to keyword"]),r.bound=!0,n.globals&&n.globals.has(r.value)){var i=$get_module(t);r.global_module=i.module,$bind(r.value,i,this)}else $get_node(this).bound_before=Object.keys(n.binding),$bind(r.value,n,this);else["str","int","float","complex"].indexOf(r.type)>-1?$_SyntaxError(t,["cannot assign to literal"]):"unary"==r.type&&$_SyntaxError(t,["cannot assign to operator"])}};$AssignCtx.prototype.guess_type=function(){},$AssignCtx.prototype.toString=function(){return"(assign) "+this.tree[0]+"="+this.tree[1]},$AssignCtx.prototype.transition=function(t,e){var n=this;if("eol"==t)return"abstract_expr"==n.tree[1].type&&$_SyntaxError(n,"token "+t+" after "+n),n.guess_type(),$transition(n.parent,"eol");$_SyntaxError(n,"token "+t+" after "+n)},$AssignCtx.prototype.transform=function(t,e){for(var n=$get_scope(this),r=this.tree[0],i=this.tree[1],s=[];"assign"==r.type;)s.push(r.tree[1]),r=r.tree[0];if(s.length>0){s.push(r);var o=t.C;o.tree=[];var a=new $RawJSCtx(o,"var $temp"+$loop_num);return a.tree=o.tree,new $AssignCtx(a).tree[1]=i,s.forEach((function(n){"expr"==n.type&&"list_or_tuple"==n.tree[0].type&&"tuple"==n.tree[0].real&&1==n.tree[0].tree.length&&(n=n.tree[0].tree[0]);var r=new $Node,i=new $NodeCtx(r);r.locals=t.locals,r.line_num=t.line_num,t.parent.insert(e+1,r),n.parent=i;var s=new $AssignCtx(n);new $RawJSCtx(s,"$temp"+$loop_num)})),$loop_num++,void(this.tree[0]=r)}var l=null;switch(r.type){case"expr":if(r.tree.length>1)l=r.tree;else if("list_or_tuple"==r.tree[0].type||"target_list"==r.tree[0].type)l=r.tree[0].tree;else if("id"==r.tree[0].type){var c=r.tree[0].value;n.globals&&n.globals.has(c)||(r.tree[0].bound=!0)}break;case"target_list":case"list_or_tuple":l=r.tree}if(i=this.tree[1],null!==l){var u=null;if(("list"==i.type||"tuple"==i.type||"expr"==i.type&&i.tree.length>1)&&(u=i.tree),null!==u){if(u.length>l.length)throw Error("ValueError : too many values to unpack (expected "+l.length+")");if(u.length<l.length)throw Error("ValueError : need more than "+u.length+" to unpack");var h=[],p=0;(_=new $Node).line_num=t.line_num,new $NodeJSCtx(_,"void(0)"),h[p++]=_;var d="$temp"+$loop_num;(_=new $Node).line_num=t.line_num,new $NodeJSCtx(_,"var "+d+" = [], $pos = 0"),h[p++]=_,u.forEach((function(e){var n=d+"[$pos++] = "+e.to_js(),r=new $Node;r.line_num=t.line_num,new $NodeJSCtx(r,n),h[p++]=r}));var f=$get_node(this);l.forEach((function(e){var n=new $Node;n.id=f.module,n.locals=f.locals,n.line_num=t.line_num;var r=new $NodeCtx(n);e.parent=r,new $AssignCtx(e,!1).tree[1]=new $JSCode(d+"["+m+"]"),h[p++]=n}),this),t.parent.children.splice(e,1);for(var m=h.length-1;m>=0;m--)t.parent.insert(e,h[m]);$loop_num++}else{t.parent.children.splice(e,1);var _,g=create_temp_name("$right"),y=create_temp_name("$rlist");(_=$NodeJS("var "+g+" = $B.$getattr($B.$iter("+i.to_js()+'), "__next__");')).line_num=t.line_num,t.parent.insert(e++,_),t.parent.insert(e++,$NodeJS("var "+y+"=[], $pos=0;while(1){try{"+y+"[$pos++] = "+g+"()}catch(err){break}}"));var v=null,b=l.length;for(m=0;m<l.length;m++){var x=l[m];if("packed"==x.type||"expr"==x.type&&"packed"==x.tree[0].type){v=m,b--;break}}t.parent.insert(e++,$NodeJS("if("+y+".length<"+b+'){throw _b_.ValueError.$factory("need more than " +'+y+'.length + " value" + ('+y+'.length > 1 ? "s" : "") + " to unpack")}')),null==v&&t.parent.insert(e++,$NodeJS("if("+y+".length>"+b+'){throw _b_.ValueError.$factory("too many values to unpack (expected '+l.length+')")}')),l.forEach((function(r,i){var s=new $Node;s.id=n.id,s.line_num=t.line_num,t.parent.insert(e++,s);var o=new $NodeCtx(s);r.parent=o;var a=new $AssignCtx(r,!1),c=y;c+=null==v||i<v?"["+i+"]":i==v?".slice("+i+","+y+".length-"+(l.length-i-1)+")":"["+y+".length-"+(l.length-i)+"]",a.tree[1]=new $JSCode(c)})),$loop_num++}}else r.tree[0].bound&&"expr"==i.type&&"int"==i.name&&(t.bindings=t.bindings||{},t.bindings[r.tree[0].value]="int")},$AssignCtx.prototype.to_js=function(){if(this.js_processed=!0,"call"==this.parent.type)return'{$nat:"kw",name:'+this.tree[0].to_js()+",value:"+this.tree[1].to_js()+"}";for(var t=this.tree[0];"expr"==t.type&&!t.assign;)t=t.tree[0];var e=this.tree[1];if("attribute"==t.type||"sub"==t.type){var n=e.to_js(),r="",i="",s="$temp"+$loop_num;if("expr"!=e.type||void 0===e.tree[0]||"call"!=e.tree[0].type||"eval"!=e.tree[0].func.value&&"exec"!=e.tree[0].func.value?"expr"==e.type&&void 0!==e.tree[0]&&"sub"==e.tree[0].type?(r+="var "+s+" = "+n+";\n",i=s):i=n:(r+="var "+s+" = "+n+";\n",i=s),"attribute"==t.type){$loop_num++,t.func="setattr";var o=t.to_js();return t.func="getattr",t.assign_self?r+o[0]+i+o[1]+i+")":(r=(r+=o).substr(0,r.length-1))+","+i+");_b_.None;"}if("sub"==t.type){var a,l=t.value.to_js(),c="$temp"+$loop_num;return"id"==t.value.type&&(a=$get_node(this).locals[t.value.value]),$loop_num++,r="var "+c+" = "+l+"\n","list"!==a&&(r+="if(Array.isArray("+c+") && !"+c+".__class__){"),1==t.tree.length?r+="$B.set_list_key("+c+","+(t.tree[0].to_js()+""||"null")+","+e.to_js()+")":2==t.tree.length?r+="$B.set_list_slice("+c+","+(t.tree[0].to_js()+""||"null")+","+(t.tree[1].to_js()+""||"null")+","+e.to_js()+")":3==t.tree.length&&(r+="$B.set_list_slice_step("+c+","+(t.tree[0].to_js()+""||"null")+","+(t.tree[1].to_js()+""||"null")+","+(t.tree[2].to_js()+""||"null")+","+e.to_js()+")"),"list"==a||(r+="\n}else{",1==t.tree.length?r+="$B.$setitem("+t.value.to_js()+","+t.tree[0].to_js()+","+n+")};_b_.None;":(t.func="setitem",r=(r+=t.to_js()).substr(0,r.length-1),t.func="getitem",r+=","+n+")};_b_.None;")),r}}return t.to_js()+" = "+e.to_js()};var $AsyncCtx=$B.parser.$AsyncCtx=function(t){this.type="async",this.parent=t,t.async=!0};$AsyncCtx.prototype.toString=function(){return"(async)"},$AsyncCtx.prototype.transition=function(t,e){var n=this;if("def"==t)return $transition(n.parent,t,e);if("for"==t||"with"==t){var r=$get_scope(n).ntype;"def"!==r&&"generator"!=r&&$_SyntaxError(n,["'async "+t+"' outside async function"]);var i=$transition(n.parent,t,e);return i.parent.async=!0,i}$_SyntaxError(n,"token "+t+" after "+n)};var $AttrCtx=$B.parser.$AttrCtx=function(t){this.type="attribute",this.value=t.tree[0],this.parent=t,t.tree.pop(),t.tree[t.tree.length]=this,this.tree=[],this.func="getattr"};$AttrCtx.prototype.toString=function(){return"(attr) "+this.value+"."+this.name},$AttrCtx.prototype.transition=function(t,e){var n=this;if("id"===t){var r=e;return!0===noassign[r]&&$_SyntaxError(n,["cannot assign to "+r]),r=$mangle(r,n),n.name=r,n.parent}$_SyntaxError(n,t)},$AttrCtx.prototype.to_js=function(){this.js_processed=!0;var t=this.value.to_js();if("setattr"==this.func&&"id"==this.value.type){var e=$get_scope(this),n=e.parent;if("def"==e.ntype&&"class"==n.ntype){var r=e.C.tree[0].positional_list;if(this.value.value==r[0]&&n.C&&void 0===n.C.tree[0].args)return this.assign_self=!0,[t+".__class__ && "+t+".__dict__ && !"+t+".__class__.$has_setattr && ! "+t+".$is_class ? _b_.dict.$setitem("+t+".__dict__, '"+this.name+"', ",") : $B.$setattr("+t+', "'+this.name+'", ']}}return"setattr"==this.func?"$B.$setattr("+t+',"'+this.name+'")':"$B.$getattr("+t+',"'+this.name+'")'};var $AugmentedAssignCtx=$B.parser.$AugmentedAssignCtx=function(t,e){check_assignment(t),this.type="augm_assign",this.C=t,this.parent=t.parent,t.parent.tree.pop(),t.parent.tree[t.parent.tree.length]=this,this.op=e,this.tree=[t];var n=this.scope=$get_scope(this);if("expr"==t.type){var r=t.tree[0];if("id"==r.type){var i=r.value;!0===noassign[i]?$_SyntaxError(t,["cannot assign to keyword"]):"def"!=n.ntype&&"generator"!=n.ntype||void 0!==n.binding[i]||void 0!==n.globals&&n.globals.has(i)||(r.unbound=!0)}else["str","int","float","complex"].indexOf(r.type)>-1&&$_SyntaxError(t,["cannot assign to literal"])}$get_node(this).bound_before=Object.keys(n.binding),this.module=n.module};$AugmentedAssignCtx.prototype.toString=function(){return"(augm assign) "+this.tree},$AugmentedAssignCtx.prototype.transition=function(t,e){var n=this;if("eol"==t)return"abstract_expr"==n.tree[1].type&&$_SyntaxError(n,"token "+t+" after "+n),$transition(n.parent,"eol");$_SyntaxError(n,"token "+t+" after "+n)},$AugmentedAssignCtx.prototype.transform=function(t,e){var n=this.C,r=this.op,i="__"+$operators[r]+"__",s=0,o=t.parent,a=t.line_num,l=!1;o.children.splice(e,1);var c="expr"==this.tree[0].type&&"id"==this.tree[0].tree[0].type;if(c){var u="int"==this.tree[0].tree[0].bindingType(this.scope);if(this.tree[0].tree[0].augm_assign=!0,$B.debug>0){var h=$NodeJS("if("+this.tree[0].to_js()+" === undefined){throw _b_.NameError.$factory(\"name '"+this.tree[0].tree[0].value+"' is not defined\")}");t.parent.insert(e,h),s++}var p=this.tree[0].tree[0].value,d=void 0!==this.scope.binding[p],f=this.tree[0].tree[0].unbound}var m="expr"==this.tree[1].type&&"int"==this.tree[1].tree[0].type;if(m){var _=this.tree[1].tree[0].value,g=parseInt(_[1],_[0]);m=g>$B.min_int&&g<$B.max_int}var y=m?this.tree[1].tree[0].to_js():"$temp";if(!m){(A=new $Node).line_num=a,l=!0,new $NodeJSCtx(A,"var $temp,$left;"),o.insert(e,A),s++,(A=new $Node).id=this.scope.id;var v=new $NodeCtx(A),b=new $ExprCtx(v,"js",!1),x=new $RawJSCtx(b,"$temp"),w=new $AssignCtx(b);w.tree[1]=this.tree[1],x.parent=w,o.insert(e+s,A),s++}var S="",M=!1;switch(r){case"+=":case"-=":case"*=":case"/=":if(c){var T=this.scope,E="$local_"+T.module.replace(/\./g,"_");switch(T.ntype){case"module":S=E;break;case"def":case"generator":S=T.globals&&T.globals.has(n.tree[0].value)?E:"$locals";break;case"class":var A=new $Node;l||(A.line_num=a,l=!0),new $NodeJSCtx(A,"var $left = "+n.to_js()),o.insert(e+s,A),M=!0,s++}}}var $=n.tree[0].to_js();if("id"==n.tree[0].type){var C=n.tree[0].firstBindingScopeId(),B=n.tree[0].value;$=C?"$locals_"+C.replace(/\./g,"_")+'["'+B+'"]':'$locals["'+B+'"]'}if(u&&m&&"//="!=r)return o.insert(e+s,$NodeJS($+" "+r+" "+y)),s++;S=S&&!n.tree[0].unknown_binding&&!f;var L=r.charAt(0);if(S){var R=M?"$left":$;A=new $Node,l||(A.line_num=a,l=!0),P=m?"if(":'if(typeof $temp.valueOf() == "number" && ',P+=R+".constructor === Number",P+=" && Number.isSafeInteger("+$+L+y+")){"+(m?"(":'(typeof $temp == "number" && ')+"typeof "+R+' == "number") ? ',P+=$+r+y,new $NodeJSCtx(A,P+=" : "+$+" = new Number("+$+L+(m?y:y+".valueOf()")+")}"),o.insert(e+s,A),s++}if("sub"==n.tree[0].type&&("+="==r||"-="==r||"*="==r)&&1==n.tree[0].tree.length){var N="$B.augm_item_"+{"+=":"add","-=":"sub","*=":"mul"}[r]+"("+n.tree[0].value.to_js()+","+n.tree[0].tree[0].to_js()+","+y+");_b_.None;";return A=new $Node,l||(A.line_num=a,l=!0),new $NodeJSCtx(A,N),o.insert(e+s,A),void s++}A=new $Node,l||(A.line_num=a,l=!0);var P="";S&&(P+="else "),P+="if(! _b_.hasattr("+n.to_js()+',"'+i+'"))',new $NodeJSCtx(A,P),o.insert(e+s,A),s++;var I=new $Node;I.id=this.scope.id,I.line_num=t.line_num,A.add(I);var O=new $NodeCtx(I),F=new $ExprCtx(O,"clone",!1);f?new $RawJSCtx(F,$):(F.tree=n.tree,F.tree.forEach((function(t){t.parent=F})));var k=new $AssignCtx(F),D=new $OpCtx(F,r.substr(0,r.length-1));D.parent=k,new $RawJSCtx(D,y),k.tree.push(D),F.parent.tree.pop(),F.parent.tree.push(k);var U=$NodeJS("else");o.insert(e+s,U);var z=new $Node;z.line_num=t.line_num,U.add(z);var j=new $NodeCtx(z),G=new $ExprCtx(j,"clone",!1);f?(P=$,C||(P='$B.$local_search("'+B+'");'+$),new $RawJSCtx(G,P)):(G.tree=n.tree,G.tree.forEach((function(t){t.parent=G})));var H=new $AssignCtx(G);return H.tree.push($NodeJS("$B.$getattr("+n.to_js()+',"'+i+'")('+y+")")),G.parent.tree.pop(),G.parent.tree.push(H),!c||d||this.scope.blurred||(this.scope.binding[p]=void 0),s},$AugmentedAssignCtx.prototype.to_js=function(){return""};var $AwaitCtx=$B.parser.$AwaitCtx=function(t){this.type="await",this.parent=t,this.tree=[],t.tree.push(this);for(var e=t;e;)"list_or_tuple"==e.type&&(e.is_await=!0),e=e.parent};$AwaitCtx.prototype.transition=function(t,e){return this.parent.is_await=!0,$transition(this.parent,t,e)},$AwaitCtx.prototype.to_js=function(){return"var save_stack = $B.save_stack();await ($B.promise("+$to_js(this.tree)+"));$B.restore_stack(save_stack, $locals); "};var $BodyCtx=$B.parser.$BodyCtx=function(t){for(var e=t.parent;"node"!==e.type;)e=e.parent;var n=e.node,r=new $Node;return r.is_body_node=!0,r.line_num=n.line_num,n.insert(0,r),new $NodeCtx(r)},set_loop_context=$B.parser.set_loop_context=function(t,e){for(var n=t;"node"!==n.type;)n=n.parent;for(var r=n.node.parent,i=!1;;)if("module"==r.type)$_SyntaxError(t,e+" outside of a loop");else{var s=r.C.tree[0];if("condition"==s.type&&"while"==s.token){this.loop_ctx=s,s["has_"+e]=!0;break}switch(s.type){case"for":this.loop_ctx=s,s["has_"+e]=!0,i=!0;break;case"def":case"generator":case"class":$_SyntaxError(t,e+" outside of a loop");default:r=r.parent}if(i)break}},$BreakCtx=$B.parser.$BreakCtx=function(t){this.type="break",this.parent=t,t.tree[t.tree.length]=this,set_loop_context.apply(this,[t,"break"])};$BreakCtx.prototype.toString=function(){return"break "},$BreakCtx.prototype.transition=function(t,e){if("eol"==t)return $transition(this.parent,"eol");$_SyntaxError(this,t)},$BreakCtx.prototype.to_js=function(){this.js_processed=!0;var t=";$locals_"+$get_scope(this).id.replace(/\./g,"_")+'["$no_break'+this.loop_ctx.loop_num+'"] = false';return"asyncfor"!=this.loop_ctx.type?t+=";break":t+=";throw _b_.StopIteration.$factory("+this.loop_ctx.loop_num+")",t};var $CallArgCtx=$B.parser.$CallArgCtx=function(t){this.type="call_arg",this.parent=t,this.start=$pos,this.tree=[],t.tree.push(this),this.expect="id"};$CallArgCtx.prototype.toString=function(){return"call_arg "+this.tree},$CallArgCtx.prototype.transition=function(t,e){var n=this;switch(t){case"await":case"id":case"imaginary":case"int":case"float":case"str":case"bytes":case"[":case"(":case"{":case".":case"not":case"lambda":if("id"==n.expect){n.expect=",";var r=new $AbstractExprCtx(n,!1);return $transition(r,t,e)}break;case"=":if(","==n.expect)return new $ExprCtx(new $KwArgCtx(n),"kw_value",!1);break;case"for":this.parent.tree.length>1&&$_SyntaxError(n,"non-parenthesized generator expression");var i=new $ListOrTupleCtx(n,"gen_expr");i.vars=n.vars,i.locals=n.locals,i.intervals=[n.start],n.tree.pop(),i.expression=n.tree,n.tree=[i],i.tree=[];var s=new $ComprehensionCtx(i);return new $TargetListCtx(new $CompForCtx(s));case"op":if("id"==n.expect){var o=e;switch(n.expect=",",o){case"+":case"-":case"~":return $transition(new $AbstractExprCtx(n,!1),t,o);case"*":return new $StarArgCtx(n);case"**":return new $DoubleStarArgCtx(n)}}$_SyntaxError(n,"token "+t+" after "+n);case")":if(n.parent.kwargs&&$B.last(n.parent.tree).tree[0]&&-1==["kwarg","star_arg","double_star_arg"].indexOf($B.last(n.parent.tree).tree[0].type)&&$_SyntaxError(n,["non-keyword argument after keyword argument"]),n.tree.length>0){var a=n.tree[n.tree.length-1];"list_or_tuple"==a.type&&"gen_expr"==a.real&&a.intervals.push($pos)}return $transition(n.parent,t);case":":if(","==n.expect&&"lambda"==n.parent.parent.type)return $transition(n.parent.parent,t);break;case",":if(","==n.expect)return n.parent.kwargs&&-1==["kwarg","star_arg","double_star_arg"].indexOf($B.last(n.parent.tree).tree[0].type)&&$_SyntaxError(n,["non-keyword argument after keyword argument"]),$transition(n.parent,t,e)}console.log("token ",t," after ",n),$_SyntaxError(n,"token "+t+" after "+n)},$CallArgCtx.prototype.to_js=function(){return this.js_processed=!0,$to_js(this.tree)};var $CallCtx=$B.parser.$CallCtx=function(t){this.type="call",this.func=t.tree[0],void 0!==this.func&&(this.func.parent=this),this.parent=t,"class"!=t.type?(t.tree.pop(),t.tree[t.tree.length]=this):t.args=this,this.expect="id",this.tree=[],this.start=$pos,this.func&&"attribute"==this.func.type&&"wait"==this.func.name&&"id"==this.func.value.type&&"time"==this.func.value.value&&(console.log("call",this.func),$get_node(this).blocking={type:"wait",call:this}),this.func&&"input"==this.func.value&&($get_node(this).blocking={type:"input"})};$CallCtx.prototype.toString=function(){return"(call) "+this.func+"("+this.tree+")"},$CallCtx.prototype.transition=function(t,e){var n=this;switch(t){case",":return"id"==n.expect&&$_SyntaxError(n,t),n.expect="id",n;case"await":case"id":case"imaginary":case"int":case"float":case"str":case"bytes":case"[":case"(":case"{":case".":case"not":case"lambda":return n.expect=",",$transition(new $CallArgCtx(n),t,e);case")":return n.end=$pos,n.parent;case"op":switch(n.expect=",",e){case"-":case"~":case"+":return n.expect=",",$transition(new $CallArgCtx(n),t,e);case"*":return n.has_star=!0,new $StarArgCtx(n);case"**":return n.has_dstar=!0,new $DoubleStarArgCtx(n)}$_SyntaxError(n,t);case"yield":$_SyntaxError(n,t)}return $transition(n.parent,t,e)},$CallCtx.prototype.to_js=function(){this.js_processed=!0,this.tree.length>0&&0==this.tree[this.tree.length-1].tree.length&&this.tree.pop();var t=this.func.to_js();if(void 0!==this.func){if("classmethod"===this.func.value)return"_b_.classmethod.$factory("+$to_js(this.tree)+")";if("unary"==this.func.type){var e="$B.$getattr("+$to_js(this.tree);switch(this.func.op){case"+":return e+',"__pos__")()';case"-":return e+',"__neg__")()';case"~":return e+',"__invert__")()'}}var n,r=[],i=[],s=!1,o=[];if(this.tree.forEach((function(t){switch(t.type){case"star_arg":s=!0,r.push([t.tree[0].tree[0].to_js(),"*"]);break;case"double_star_arg":o.push(t.tree[0].tree[0].to_js());break;case"id":r.push([t.to_js(),"s"]);break;default:switch(t.tree[0].type){case"expr":case"list_or_tuple":case"op":default:r.push([t.to_js(),"s"]);break;case"kwarg":i.push(t.tree[0].tree[0].value+":"+t.tree[0].tree[1].to_js());break;case"star_arg":s=!0,r.push([t.tree[0].tree[0].to_js(),"*"]);break;case"double_star_arg":o.push(t.tree[0].tree[0].to_js())}}})),s){for(var a=[],l=0,c=r.length;l<c;l++)if(arg=r[l],"*"==arg[1])a.push("_b_.list.$factory("+arg[0]+")");else{var u=[r[l][0]];for(l++;l<c&&"s"==r[l][1];)u.push(r[l][0]),l++;l--,a.push("["+u.join(",")+"]")}for(n=a[0],l=1;l<a.length;l++)n+=".concat("+a[l]+")"}else{for(l=0,c=r.length;l<c;l++)r[l]=r[l][0];n=r.join(", ")}var h="{"+i.join(", ")+"}";h=o.length?'{$nat:"kw",kw:['+h+","+o.join(", ")+"]}":"{}"!=h?'{$nat:"kw",kw:'+h+"}":"",s&&h?n+=".concat(["+h+"])":n&&h?n+=","+h:n||(n=h);var p="$B.$call("+t+")"+(n=s?".apply(null,"+n+")":"("+n+")");return this.tree.length>-1&&"id"==this.func.type&&this.func.is_builtin&&void 0!==$B.builtin_funcs[this.func.value]?-1==["complex","bytes","bytearray","object","memoryview","int","float","str","list","tuple","dict","set","frozenset","range","slice","zip","bool","type","classmethod","staticmethod","enumerate","reversed","property","$$super","zip","map","filter"].indexOf(this.func.value)?t+n:t+".$factory"+n:p}};var $ClassCtx=$B.parser.$ClassCtx=function(t){this.type="class",this.parent=t,this.tree=[],t.tree[t.tree.length]=this,this.expect="id";var e=this.scope=$get_scope(this);this.parent.node.parent_block=e,this.parent.node.bound={},this.parent.node.binding={__annotations__:!0}};$ClassCtx.prototype.toString=function(){return"(class) "+this.name+" "+this.tree+" args "+this.args},$ClassCtx.prototype.transition=function(t,e){var n=this;switch(t){case"id":if("id"==n.expect)return n.set_name(e),n.expect="(:",n;break;case"(":return new $CallCtx(n);case":":return $BodyCtx(n)}$_SyntaxError(n,"token "+t+" after "+n)},$ClassCtx.prototype.set_name=function(t){var e=this.parent;this.random=$B.UUID(),this.name=t,this.id=e.node.module+"_"+t+"_"+this.random,this.binding={},this.parent.node.id=this.id;for(var n=this.scope,r=n,i=n,s=[];"class"==i.ntype;)s.splice(0,0,i.C.tree[0].name),i=i.parent;for(this.qualname=s.concat([t]).join(".");r.C&&"class"==r.C.tree[0].type;)r=r.parent;for(;r.C&&"def"!=r.C.tree[0].type&&"generator"!=r.C.tree[0].type;)r=r.parent;this.parent.node.parent_block=r,$bind(t,n,this),n.is_function&&-1==n.C.tree[0].locals.indexOf(t)&&n.C.tree[0].locals.push(t)},$ClassCtx.prototype.transform=function(t,e){this.doc_string=$get_docstring(t),this.module=$get_module(this).module.replace(/\./g,"_");var n="\n"+" ".repeat(t.indent+12),r=new $Node,i="$locals_"+this.id.replace(/\./g,"_");new $NodeJSCtx(r,a="var "+i+" = {__annotations__: $B.empty_dict()}, "+n+"$locals = "+i),t.insert(0,r);for(var s=this.scope;"__builtins__"!==s.parent_block.id;)s=s.parent_block;var o="$locals_"+s.id.replace(/\./g,"_"),a=" ".repeat(t.indent+4)+'$locals.$name = "'+this.name+'"'+n+'$locals.$qualname = "'+this.qualname+'"'+n+"$locals.$is_class = true; "+n+'$locals.$line_info = "'+t.line_num+","+this.module+'";'+n+'var $top_frame = ["'+i+'", $locals,"'+s.id+'", '+o+"]"+n+"$locals.$f_trace = $B.enter_frame($top_frame);"+n+"if($locals.$f_trace !== _b_.None){$locals.$f_trace = $B.trace_line()}";t.insert(1,$NodeJS(a)),t.add($NodeJS("if($locals.$f_trace !== _b_.None){$B.trace_return(_b_.None)}")),t.add($NodeJS("$B.leave_frame({$locals})"));var l=new $Node;new $NodeJSCtx(l,"return "+i+";"),t.insert(t.children.length,l);var c=new $Node;new $NodeJSCtx(c,")();"),t.parent.insert(e+1,c);var u="$locals_"+this.module+".__name__";e++,t.parent.insert(e+1,$NodeJS("$"+this.name+"_"+this.random+".__module__ = "+u));var h=$get_scope(this),p=";$locals_"+h.id.replace(/\./g,"_"),d=1;if((a=[(p+='["'+this.name+'"]')+' = $B.$class_constructor("'+this.name])[d++]='", $'+this.name+"_"+this.random,void 0!==this.args){var f=this.args.tree,m=[],_=[];f.forEach((function(t){"kwarg"==t.tree[0].type?_.push(t.tree[0]):m.push(t.to_js())})),a[d++]=", _b_.tuple.$factory(["+m.join(",")+"]),[";var g=new RegExp('"',"g"),y=[],v=0;m.forEach((function(t){y[v++]='"'+t.replace(g,'\\"')+'"'})),a[d++]=y.join(",")+"]",y=[],v=0,_.forEach((function(t){y[v++]='["'+t.tree[0].value+'",'+t.tree[1].to_js()+"]"})),a[d++]=",["+y.join(",")+"]"}else a[d++]=", _b_.tuple.$factory([]),[],[]";a[d++]=")";var b=new $Node;new $NodeJSCtx(b,a.join("")),e++,t.parent.insert(e+1,b),e++;var x=new $Node;if(a=p+".__doc__ = "+(this.doc_string||"_b_.None")+";",new $NodeJSCtx(x,a),t.parent.insert(e+1,x),"module"==h.ntype){var w=new $Node;new $NodeJSCtx(w,'$locals["'+this.name+'"] = '+this.name)}t.parent.insert(e+2,$NodeJS("_b_.None;")),this.transformed=!0},$ClassCtx.prototype.to_js=function(){return this.js_processed=!0,"var $"+this.name+"_"+this.random+" = (function()"};var $CompIfCtx=$B.parser.$CompIfCtx=function(t){this.type="comp_if",t.parent.intervals.push($pos),this.parent=t,this.tree=[],t.tree[t.tree.length]=this};$CompIfCtx.prototype.toString=function(){return"(comp if) "+this.tree},$CompIfCtx.prototype.transition=function(t,e){return $transition(this.parent,t,e)},$CompIfCtx.prototype.to_js=function(){return this.js_processed=!0,$to_js(this.tree)};var $ComprehensionCtx=$B.parser.$ComprehensionCtx=function(t){this.type="comprehension",this.parent=t,this.tree=[],t.tree[t.tree.length]=this};$ComprehensionCtx.prototype.toString=function(){return"(comprehension) "+this.tree},$ComprehensionCtx.prototype.transition=function(t,e){var n=this;switch(t){case"if":return new $AbstractExprCtx(new $CompIfCtx(n),!1);case"for":return new $TargetListCtx(new $CompForCtx(n))}return $transition(n.parent,t,e)},$ComprehensionCtx.prototype.to_js=function(){this.js_processed=!0;var t=[];return this.tree.forEach((function(e){t.push(e.start)})),t};var $CompForCtx=$B.parser.$CompForCtx=function(t){this.type="comp_for",t.parent.intervals.push($pos),this.parent=t,this.tree=[],this.expect="in",t.tree[t.tree.length]=this};$CompForCtx.prototype.toString=function(){return"(comp for) "+this.tree},$CompForCtx.prototype.transition=function(t,e){var n=this;return"in"==t&&"in"==n.expect?(n.expect=null,new $AbstractExprCtx(new $CompIterableCtx(n),!0)):null===n.expect?$transition(n.parent,t,e):void $_SyntaxError(n,"token "+t+" after "+n)},$CompForCtx.prototype.to_js=function(){return this.js_processed=!0,$to_js(this.tree)};var $CompIterableCtx=$B.parser.$CompIterableCtx=function(t){this.type="comp_iterable",this.parent=t,this.tree=[],t.tree[t.tree.length]=this};$CompIterableCtx.prototype.toString=function(){return"(comp iter) "+this.tree},$CompIterableCtx.prototype.transition=function(t,e){return $transition(this.parent,t,e)},$CompIterableCtx.prototype.to_js=function(){return this.js_processed=!0,$to_js(this.tree)};var $ConditionCtx=$B.parser.$ConditionCtx=function(t,e){this.type="condition",this.token=e,this.parent=t,this.tree=[],this.scope=$get_scope(this),"while"==e&&(this.loop_num=$loop_num++),t.tree[t.tree.length]=this};$ConditionCtx.prototype.toString=function(){return this.token+" "+this.tree},$ConditionCtx.prototype.transition=function(t,e){var n=this;if(":"==t)return"abstract_expr"==n.tree[0].type&&0==n.tree[0].tree.length&&$_SyntaxError(n,"token "+t+" after "+n),$BodyCtx(n);$_SyntaxError(n,"token "+t+" after "+n)},$ConditionCtx.prototype.transform=function(t,e){if($get_scope(this),"while"==this.token){t.parent.insert(e,$NodeJS('$locals["$no_break'+this.loop_num+'"] = true'));var n=$get_module(this).module;if("return"!=$B.last(t.children).C.tree[0].type){var r='$locals.$line_info = "'+t.line_num+","+n+'";if($locals.$f_trace !== _b_.None){$B.trace_line()};_b_.None;';t.add($NodeJS(r))}return 2}},$ConditionCtx.prototype.to_js=function(){this.js_processed=!0;var t=this.token;"elif"==t&&(t="else if");var e=[t+"($B.$bool("];if("while"==t)e.push('$locals["$no_break'+this.loop_num+'"] && ');else if("else if"==t){var n=$get_node(this).line_num+","+$get_scope(this).id;e.push('($B.set_line("'+n+'")) && ')}return 1==this.tree.length?e.push($to_js(this.tree)+"))"):(e.push(this.tree[0].to_js()+"))"),this.tree[1].tree.length>0&&e.push("{"+this.tree[1].to_js()+"}")),e.join("")};var $ContinueCtx=$B.parser.$ContinueCtx=function(t){this.type="continue",this.parent=t,$get_node(this).is_continue=!0,t.tree[t.tree.length]=this,set_loop_context.apply(this,[t,"continue"])};$ContinueCtx.prototype.toString=function(){return"(continue)"},$ContinueCtx.prototype.transition=function(t,e){var n=this;if("eol"==t)return n.parent;$_SyntaxError(n,"token "+t+" after "+n)},$ContinueCtx.prototype.to_js=function(){this.js_processed=!0;var t="continue";return this.loop_ctx.has_break&&(t=`$locals["$no_break${this.loop_ctx.loop_num}"]=true;${t}`),t};var $DebuggerCtx=$B.parser.$DebuggerCtx=function(t){this.type="continue",this.parent=t,t.tree[t.tree.length]=this};$DebuggerCtx.prototype.toString=function(){return"(debugger)"},$DebuggerCtx.prototype.transition=function(t,e){},$DebuggerCtx.prototype.to_js=function(){return this.js_processed=!0,"debugger"};var $DecoratorCtx=$B.parser.$DecoratorCtx=function(t){this.type="decorator",this.parent=t,t.tree[t.tree.length]=this,this.tree=[]};$DecoratorCtx.prototype.toString=function(){return"(decorator) "+this.tree},$DecoratorCtx.prototype.transition=function(t,e){var n=this;return"id"==t&&0==n.tree.length?$transition(new $AbstractExprCtx(n,!1),t,e):"eol"==t?$transition(n.parent,t):void $_SyntaxError(n,"token "+t+" after "+n)},$DecoratorCtx.prototype.transform=function(t,e){for(var n=e+1,r=t.parent.children,i=[this.tree];;)if(n>=r.length)$_SyntaxError(C,["decorator expects function"]);else if("node_js"==r[n].C.type)n++;else{if("decorator"!=r[n].C.tree[0].type)break;i.push(r[n].C.tree[0].tree),r.splice(n,1)}this.dec_ids=[],i.forEach((function(){this.dec_ids.push("$id"+$B.UUID())}),this);var s=r[n].C.tree[0];"def"==s.type&&(s.decorated=!0,s.alias="$dec"+$B.UUID());var o="",a=$get_scope(this),l='$locals["';a.globals&&a.globals.has(s.name)&&(l="$locals_"+$get_module(this).id+'["');var c=(l+=s.name+'"]')+" = ";i.forEach((function(t,e){c+="$B.$call("+this.dec_ids[e]+")(",o+=")"}),this),c+=(s.decorated?s.alias:l)+o+";",$bind(s.name,a,this),t.parent.insert(n+1,$NodeJS(c)),this.decorators=i},$DecoratorCtx.prototype.to_js=function(){this.js_processed=!0;var t=[];return this.decorators.forEach((function(e,n){t.push("var "+this.dec_ids[n]+" = "+$to_js(e)+";")}),this),t.join("")};var $DefCtx=$B.parser.$DefCtx=function(t){this.type="def",this.name=null,this.parent=t,this.tree=[],this.async=t.async,this.locals=[],t.tree[t.tree.length]=this,this.enclosing=[];var e=this.scope=$get_scope(this);e.C&&"class"==e.C.tree[0].type&&(this.class_name=e.C.tree[0].name),t.node.binding={};for(var n=e;n.C&&"class"==n.C.tree[0].type;)n=n.parent;for(;n.C&&"def"!=n.C.tree[0].type;)n=n.parent;this.parent.node.parent_block=n;var r=n;for(this.is_comp=r.is_comp;r&&r.C;){if("def"==r.C.tree[0].type){this.inside_function=!0;break}r=r.parent_block}this.module=e.module,this.root=$get_module(this),this.num=$loop_num,$loop_num++,this.positional_list=[],this.default_list=[],this.other_args=null,this.other_kw=null,this.after_star=[]};$DefCtx.prototype.set_name=function(t){try{t=$mangle(t,this.parent.tree[0])}catch(t){throw console.log(t),console.log("parent",this.parent),t}var e=new $IdCtx(this,t);this.name=t,this.id=this.scope.id+"_"+t,this.id=this.id.replace(/\./g,"_"),this.id+="_"+$B.UUID(),this.parent.node.id=this.id,this.parent.node.module=this.module,this.binding={};var n=this.scope;void 0!==n.globals&&n.globals.has(t)?$bind(t,this.root,this):$bind(t,n,this),e.bound=!0,n.is_function&&-1==n.C.tree[0].locals.indexOf(t)&&n.C.tree[0].locals.push(t)},$DefCtx.prototype.toString=function(){return"def "+this.name+"("+this.tree+")"},$DefCtx.prototype.transition=function(t,e){var n=this;switch(t){case"id":return n.name&&$_SyntaxError(n,"token "+t+" after "+n),n.set_name(e),n;case"(":return null==n.name&&$_SyntaxError(n,"missing name in function definition"),n.has_args=!0,new $FuncArgs(n);case"annotation":return new $AbstractExprCtx(new $AnnotationCtx(n),!0);case":":if(n.has_args)return $BodyCtx(n);$_SyntaxError(n,"missing function parameters");case"eol":n.has_args&&$_SyntaxError(n,"missing colon")}$_SyntaxError(n,"token "+t+" after "+n)},$DefCtx.prototype.transform=function(t,e){if(this.is_comp&&($get_node(this).is_comp=!0),void 0===this.transformed){var n=this.scope;this.doc_string=$get_docstring(t),this.rank=e;var r=t.indent+12;if(this.name.substr(0,15)=="lambda_"+$B.lambda_magic){var i=n.parent_block;i.C&&"def"==i.C.tree[0].type&&this.enclosing.push(i)}for(var s=this.parent.node;s.parent&&s.parent.is_def_func;)this.enclosing.push(s.parent.parent),s=s.parent.parent;var o=[],a=[],l=!1;this.argcount=0,this.kwonlyargcount=0,this.kwonlyargsdefaults=[],this.otherdefaults=[],this.varnames={},this.args=[],this.__defaults__=[],this.slots=[];var c=[],u=[],h=[];this.annotation&&h.push('"return":'+this.annotation.to_js()),this.func_name=this.tree[0].to_js();var p=this.func_name;this.decorated&&(this.func_name="var "+this.alias,p=this.alias),this.tree[1].tree.forEach((function(t){if("end_positional"==t.type?(this.args.push("/"),c.push('"/"'),l=!0):(this.args.push(t.name),this.varnames[t.name]=!0),"func_arg_id"==t.type?(this.star_arg?(this.kwonlyargcount++,t.has_default&&this.kwonlyargsdefaults.push(t.name)):(this.argcount++,t.has_default&&this.otherdefaults.push(t.name)),this.slots.push(t.name+":null"),c.push('"'+t.name+'"'),u.push(t.name+":"+t.name),t.tree.length>0&&(o.push('"'+t.name+'"'),a.push(t.name+":"+$to_js(t.tree)),this.__defaults__.push($to_js(t.tree)))):"func_star_arg"==t.type&&("*"==t.op?this.star_arg=t.name:"**"==t.op&&(this.kw_arg=t.name)),t.annotation){var e=$mangle(t.name,this);h.push(e+": "+t.annotation.to_js())}}),this),u="{"+u.join(", ")+"}";var d=67;this.star_arg&&(d|=4),this.kw_arg&&(d|=8),"generator"==this.type&&(d|=32),this.async&&(d|=128);for(var f=[],m=n;m.parent_block&&"__builtins__"!==m.parent_block.id;)m=m.parent_block;var _="$locals_"+m.id.replace(/\./g,"_"),g=this.name+this.num,y="$locals_"+this.id;x="var "+y+" = {},"+(F="\n"+" ".repeat(r))+"$locals = "+y+";",(w=new $Node).locals_def=!0,w.func_node=t,new $NodeJSCtx(w,x),f.push(w);var v=[$NodeJS('$locals.$line_info = "'+t.line_num+","+this.module+'"'),$NodeJS(`var $top_frame=["${this.id}",$locals,"`+m.id+'", '+_+", "+(this.is_comp?this.name:g)+"]"),$NodeJS("$locals.$f_trace = $B.enter_frame($top_frame)"),$NodeJS("var $stack_length = $B.frames_stack.length;")];"generator"==this.type&&v.push($NodeJS("$locals.$is_generator = true")),this.async&&v.splice(1,0,$NodeJS(`$locals.$async="${this.id}"`)),v.forEach((function(t){t.enter_frame=!0})),this.is_comp&&f.push($NodeJS("var $defaults = {}")),this.env=[];var b=[],x=y+' = $locals = $B.args("'+this.name+'", '+this.argcount+", {"+this.slots.join(", ")+"}, ["+c.join(", ")+"], arguments, $defaults, "+this.other_args+", "+this.other_kw+");",w=new $Node;new $NodeJSCtx(w,x),b.push(w);var S=!1;if(null!==this.other_args||null!==this.other_kw||0!=this.after_star.length||l)f.push(b[0]),b.length>1&&f.push(b[1]);else{S=!0,f.push($NodeJS("var $len = arguments.length;")),w=new $Node,new $NodeJSCtx(w,x="if($len > 0 && arguments[$len - 1].$nat !== undefined)"),f.push(w),b.forEach((function(t){w.add(t)}));var M=new $Node;new $NodeJSCtx(M,"else"),f.push(M);var T=this.slots.length,E=$NodeJS("if($len == "+T+")");M.add(E),E.add($NodeJS(y+" = $locals = "+u)),M.add($NodeJS("else if($len > "+T+'){$B.wrong_nb_args("'+this.name+'", $len, '+T+", ["+c+"])}")),T>0&&(M.add($NodeJS("else if($len + Object.keys($defaults).length < "+T+'){$B.wrong_nb_args("'+this.name+'", $len, '+T+", ["+c+"])}")),subelse_node=$NodeJS("else"),M.add(subelse_node),subelse_node.add($NodeJS(y+" = $locals = "+u)),subelse_node.add($NodeJS("var defparams = ["+c+"]")),subelse_node.add($NodeJS("for(var i = $len; i < defparams.length; i++){$locals[defparams[i]] = $defaults[defparams[i]]}")))}f=f.concat(v),"class"==n.ntype&&(class_ref="$locals_"+n.parent_block.id.replace(/\./g,"_")+"."+n.C.tree[0].qualname,this.parent.node.binding.__class__=!0,f.push($NodeJS("$locals.__class__ = "+class_ref))),f.push($NodeJS("$B.js_this = this;"));for(var A=f.length-1;A>=0;A--)t.children.splice(0,0,f[A]);var $=new $Node;this.params="",S&&(this.params=Object.keys(this.varnames).join(", ")),new $NodeJSCtx($,""),$.is_def_func=!0,$.module=this.module;var C=t.children[t.children.length-1];r=C.indent,"return"!=C.C.tree[0].type&&(x="if($locals.$f_trace !== _b_.None){\n"+"    ".repeat(r)+"$B.trace_return(_b_.None)\n"+"    ".repeat(r)+"}\n"+"    ".repeat(r),x+="$B.leave_frame","$exec"==this.id.substr(0,5)&&(x+="_exec"),x+="({$locals});return _b_.None",t.add($NodeJS(x)));var B=[];if(this.parent.node.referenced)for(var L in this.parent.node.referenced)this.parent.node.binding[L]||B.push('"'+L+'"');t.add($);var R=1;if(r=t.indent,!this.is_comp){t.parent.insert(e+R++,$NodeJS(g+".$is_func = true")),this.$has_yield_in_cm&&t.parent.insert(e+R++,$NodeJS(g+".$has_yield_in_cm = true")),t.parent.insert(e+R++,$NodeJS(g+".$infos = {"));var N=this.name;"$$"==this.name.substr(0,2)&&(N=N.substr(2)),N.substr(0,15)=="lambda_"+$B.lambda_magic&&(N="<lambda>"),x='    __name__:"'+N+'",',t.parent.insert(e+R++,$NodeJS(x));var P=N;if(this.class_name&&(P=this.class_name+"."+N),x='    __qualname__:"'+P+'",',t.parent.insert(e+R++,$NodeJS(x)),this.otherdefaults.length>0){var I=[];this.otherdefaults.forEach((function(t){I.push("$defaults."+t)})),t.parent.insert(e+R++,$NodeJS("    __defaults__ : $B.fast_tuple(["+I.join(", ")+"]),"))}else t.parent.insert(e+R++,$NodeJS("    __defaults__ : _b_.None,"));this.kwonlyargsdefaults.lengh>0?(I=[],this.kwonlyargsdefaults.forEach((function(t){I.push("$defaults."+t)})),t.parent.insert(e+R++,$NodeJS("    __kwdefaults__ : $B.fast_tuple(["+I.join(", ")+"]),"))):t.parent.insert(e+R++,$NodeJS("    __kwdefaults__ : _b_.None,")),t.parent.insert(e+R++,$NodeJS("    __annotations__: {"+h.join(",")+"},")),t.parent.insert(e+R++,$NodeJS("    __dict__: $B.empty_dict(),")),t.parent.insert(e+R++,$NodeJS("    __doc__: "+(this.doc_string||"_b_.None")+","));var O=$get_module(this);for(var L in t.parent.insert(e+R++,$NodeJS('    __module__ : "'+O.module+'",')),this.binding)this.varnames[L]=!0;var F,k=[];for(var L in this.varnames)k.push('"'+$B.from_alias(L)+'"');this.name,this.num,x="    __code__:{"+(F="\n"+" ".repeat(r+8))+"    co_argcount:"+this.argcount;var D=","+F+" ".repeat(4);x+=D+"co_filename:$locals_"+$get_module(this).module.replace(/\./g,"_")+'["__file__"] || "<string>"'+D+"co_firstlineno:"+t.line_num+D+"co_flags:"+d+D+"co_freevars: ["+B+"]"+D+"co_kwonlyargcount:"+this.kwonlyargcount+D+'co_name: "'+this.name+'"'+D+"co_nlocals: "+k.length+D+"co_posonlyargcount: "+(this.pos_only||0)+D+"co_varnames: $B.fast_tuple(["+k.join(", ")+"])"+F+"}\n"+" ".repeat(r+4)+"};",x+="_b_.None;",t.parent.insert(e+R++,$NodeJS(x))}if(this.default_str="{"+a.join(", ")+"}",!this.is_comp){var U=g;"generator"==this.type&&(U=`$B.generator.$factory(${g})`);var z="return "+U;this.async&&(z="generator"==this.type?`return $B.async_generator.$factory(${g})`:"return $B.make_async("+U+")"),t.parent.insert(e+R++,$NodeJS(z+"}")),t.parent.insert(e+R++,$NodeJS(this.func_name+" = "+this.name+"$"+this.num+"("+this.default_str+")")),t.parent.insert(e+R++,$NodeJS(p+".$set_defaults = function(value){return "+p+" = "+this.name+"$"+this.num+"(value)}")),this.$has_yield_in_cm&&t.parent.insert(e+R++,$NodeJS(`${p}.$has_yield_in_cm=true`))}for(var j=t,G=0;G<j.children.length&&j.children[G]!==$B.last(v);G++);var H=$NodeJS("try"),V=j.children.slice(G+1);j.insert(G+1,H),V.forEach((function(t){t.is_def_func?t.children.forEach((function(t){H.add(t)})):H.add(t)})),j.children.splice(G+2,j.children.length);var W=$NodeJS("catch(err)");return W.add($NodeJS("$B.set_exc(err)")),W.add($NodeJS("if($locals.$f_trace !== _b_.None){$locals.$f_trace = $B.trace_exception()}")),W.add($NodeJS("$B.leave_frame({$locals});throw err")),j.add(W),this.transformed=!0,R}},$DefCtx.prototype.to_js=function(t){return this.js_processed=!0,this.is_comp?"var "+this.name+" = "+(this.async?" async ":"")+"function* (expr)":(t=t||this.tree[0].to_js(),this.decorated&&(t="var "+this.alias),"var "+this.name+"$"+this.num+" = function($defaults){"+(this.async?"async ":"")+"function"+("generator"==this.type?"* ":" ")+this.name+this.num+"("+this.params+")")};var $DelCtx=$B.parser.$DelCtx=function(t){this.type="del",this.parent=t,t.tree[t.tree.length]=this,this.tree=[]};$DelCtx.prototype.toString=function(){return"del "+this.tree},$DelCtx.prototype.transition=function(t,e){var n=this;if("eol"==t)return $transition(n.parent,t);$_SyntaxError(n,"token "+t+" after "+n)},$DelCtx.prototype.to_js=function(){this.js_processed=!0;var t=this.parent;if("list_or_tuple"==this.tree[0].type){var e=[];return this.tree[0].tree.forEach((function(n){var r=new $DelCtx(t);r.tree=[n],e.push(r.to_js()),t.tree.pop()})),this.tree=[],e.join(";")}if("expr"==this.tree[0].type&&"list_or_tuple"==this.tree[0].tree[0].type)return this.tree[0]=this.tree[0].tree[0],this.to_js();var n=this.tree[0].tree[0];switch(n.type){case"id":var r=$get_scope(this),i=!1;if(("def"==r.ntype||"generator"==r.ntype)&&r.globals&&r.globals.has(n.value)){for(r=r.parent;r.parent&&"__builtins__"!==r.parent.id;)r=r.parent;i=!0}return e='$B.$delete("'+n.value+'"'+(i?', "global"':"")+");",delete r.binding[n.value],e;case"list_or_tuple":return e=[],n.tree.forEach((function(t){e.push("delete "+t.to_js())})),e.join(";");case"sub":return n.func="delitem",js=n.to_js(),n.func="getitem",js;case"op":$_SyntaxError(this,["cannot delete operator"]);case"call":$_SyntaxError(this,["cannot delete function call"]);case"attribute":return"_b_.delattr("+n.value.to_js()+',"'+n.name+'")';default:$_SyntaxError(this,["cannot delete "+n.type])}};var $DictOrSetCtx=$B.parser.$DictOrSetCtx=function(t){this.type="dict_or_set",this.real="dict_or_set",this.expect="id",this.closed=!1,this.start=$pos,this.parent=t,this.tree=[],t.tree[t.tree.length]=this};$DictOrSetCtx.prototype.toString=function(){switch(this.real){case"dict":return"(dict) {"+this.items+"}";case"set":return"(set) {"+this.tree+"}"}return"(dict_or_set) {"+this.tree+"}"},$DictOrSetCtx.prototype.transition=function(t,e){var n=this;if(n.closed){switch(t){case"[":return new $AbstractExprCtx(new $SubCtx(n.parent),!1);case"(":return new $CallArgCtx(new $CallCtx(n.parent))}return $transition(n.parent,t,e)}if(","==n.expect){switch(t){case"}":switch(n.real){case"dict_or_set":if(1!=n.tree.length)break;n.real="set";case"set":case"set_comp":case"dict_comp":return n.items=n.tree,n.tree=[],n.closed=!0,n;case"dict":if(n.nb_dict_items()%2==0)return n.items=n.tree,n.tree=[],n.closed=!0,n}$_SyntaxError(n,"token "+t+" after "+n);case",":return"dict_or_set"==n.real&&(n.real="set"),"dict"==n.real&&n.nb_dict_items()%2&&$_SyntaxError(n,"token "+t+" after "+n),n.expect="id",n;case":":if("dict_or_set"==n.real&&(n.real="dict"),"dict"==n.real)return n.expect=",",new $AbstractExprCtx(n,!1);$_SyntaxError(n,"token "+t+" after "+n);case"for":"dict_or_set"==n.real?n.real="set_comp":n.real="dict_comp";var r=new $ListOrTupleCtx(n,"dict_or_set_comp");r.intervals=[n.start+1],r.vars=n.vars,n.tree.pop(),r.expression=n.tree,n.yields&&(r.expression.yields=n.yields,delete n.yields),n.tree=[r],r.tree=[];var i=new $ComprehensionCtx(r);return new $TargetListCtx(new $CompForCtx(i))}$_SyntaxError(n,"token "+t+" after "+n)}else if("id"==n.expect){switch(t){case"}":return 0==n.tree.length?(n.items=[],n.real="dict"):n.items=n.tree,n.tree=[],n.closed=!0,n;case"id":case"imaginary":case"int":case"float":case"str":case"bytes":case"[":case"(":case"{":case".":case"not":case"lambda":n.expect=",";var s=new $AbstractExprCtx(n,!1);return $transition(s,t,e);case"op":switch(e){case"*":case"**":return n.expect=",",(s=new $AbstractExprCtx(n,!1)).packed=e.length,"dict_or_set"==n.real?n.real="*"==e?"set":"dict":("set"==n.real&&"**"==e||"dict"==n.real&&"*"==e)&&$_SyntaxError(n,"token "+t+" after "+n),s;case"+":return n;case"-":case"~":n.expect=",";var o=new $UnaryCtx(n,e);if("-"==e)var a=new $OpCtx(o,"unary_neg");else a=new $OpCtx(o,"+"==e?"unary_pos":"unary_inv");return new $AbstractExprCtx(a,!1)}$_SyntaxError(n,"token "+t+" after "+n)}$_SyntaxError(n,"token "+t+" after "+n)}return $transition(n.parent,t,e)},$DictOrSetCtx.prototype.nb_dict_items=function(){var t=0;return this.tree.forEach((function(e){e.packed?t+=2:t++})),t},$DictOrSetCtx.prototype.packed_indices=function(){var t=[];return this.items.forEach((function(e,n){"expr"==e.type&&e.packed&&t.push(n)})),t},$DictOrSetCtx.prototype.unpack_dict=function(t){for(var e,n,r,i="",s=0;s<this.items.length;)n=0==s,"expr"==(r=this.items[s]).type&&r.packed?(e="_b_.list.$factory(_b_.dict.items("+r.to_js()+"))",s++):(e="[["+r.to_js()+","+this.items[s+1].to_js()+"]]",s+=2),n||(e=".concat("+e+")"),i+=e;return i},$DictOrSetCtx.prototype.unpack_set=function(t){var e,n="";return this.items.forEach((function(r,i){e=t.indexOf(i)>-1?"_b_.list.$factory("+r.to_js()+")":"["+r.to_js()+"]",i>0&&(e=".concat("+e+")"),n+=e})),n},$DictOrSetCtx.prototype.to_js=function(){switch(this.js_processed=!0,this.real){case"dict":if((n=this.packed_indices()).length>0)return"_b_.dict.$factory("+this.unpack_dict(n)+")"+$to_js(this.tree);for(var t=[],e=0;e<this.items.length;e+=2)t.push("["+this.items[e].to_js()+","+this.items[e+1].to_js()+"]");return"_b_.dict.$factory(["+t.join(",")+"])"+$to_js(this.tree);case"set_comp":return"_b_.set.$factory("+$to_js(this.items)+")"+$to_js(this.tree);case"dict_comp":return"_b_.dict.$factory("+$to_js(this.items)+")"+$to_js(this.tree)}var n;return(n=this.packed_indices()).length>0?"_b_.set.$factory("+this.unpack_set(n)+")":"_b_.set.$factory(["+$to_js(this.items)+"])"+$to_js(this.tree)};var $DoubleStarArgCtx=$B.parser.$DoubleStarArgCtx=function(t){this.type="double_star_arg",this.parent=t,this.tree=[],t.tree[t.tree.length]=this};$DoubleStarArgCtx.prototype.toString=function(){return"**"+this.tree},$DoubleStarArgCtx.prototype.transition=function(t,e){var n=this;switch(t){case"id":case"imaginary":case"int":case"float":case"str":case"bytes":case"[":case"(":case"{":case".":case"not":case"lambda":return $transition(new $AbstractExprCtx(n,!1),t,e);case",":case")":return $transition(n.parent,t);case":":if("lambda"==n.parent.parent.type)return $transition(n.parent.parent,t)}$_SyntaxError(n,"token "+t+" after "+n)},$DoubleStarArgCtx.prototype.to_js=function(){return this.js_processed=!0,'{$nat:"pdict",arg:'+$to_js(this.tree)+"}"};var $EllipsisCtx=$B.parser.$EllipsisCtx=function(t){this.type="ellipsis",this.parent=t,this.nbdots=1,this.start=$pos,t.tree[t.tree.length]=this};$EllipsisCtx.prototype.toString=function(){return"ellipsis"},$EllipsisCtx.prototype.transition=function(t,e){var n=this;return"."==t?(n.nbdots++,3==n.nbdots&&$pos-n.start==2&&(n.$complete=!0),n):n.$complete?$transition(n.parent,t,e):($pos--,void $_SyntaxError(n,"token "+t+" after "+n))},$EllipsisCtx.prototype.to_js=function(){return this.js_processed=!0,'$B.builtins["Ellipsis"]'};var $EndOfPositionalCtx=$B.parser.$EndOfConditionalCtx=function(t){this.type="end_positional",this.parent=t,t.has_end_positional=!0,t.parent.pos_only=t.tree.length,t.tree.push(this)};$EndOfPositionalCtx.prototype.transition=function(t,e){var n=this;if(","==t||")"==t)return $transition(n.parent,t,e);$_SyntaxError(n,"token "+t+" after "+n)},$EndOfPositionalCtx.prototype.to_js=function(){return"/"};var $ExceptCtx=$B.parser.$ExceptCtx=function(t){this.type="except",this.parent=t,t.tree[t.tree.length]=this,this.tree=[],this.expect="id",this.scope=$get_scope(this)};$ExceptCtx.prototype.toString=function(){return"(except) "},$ExceptCtx.prototype.transition=function(t,e){var n=this;switch(t){case"id":case"imaginary":case"int":case"float":case"str":case"bytes":case"[":case"(":case"{":case"not":case"lambda":if("id"==n.expect)return n.expect="as",$transition(new $AbstractExprCtx(n,!1),t,e);case"as":if("as"==n.expect&&void 0===n.has_alias)return n.expect="alias",n.has_alias=!0,n;case"id":if("alias"==n.expect)return n.expect=":",n.set_alias(e),n;break;case":":var r=n.expect;if("id"==r||"as"==r||":"==r)return $BodyCtx(n);break;case"(":if("id"==n.expect&&0==n.tree.length)return n.parenth=!0,n;break;case")":if(","==n.expect||"as"==n.expect)return n.expect="as",n;case",":if(void 0!==n.parenth&&void 0===n.has_alias&&("as"==n.expect||","==n.expect))return n.expect="id",n}$_SyntaxError(n,"token "+t+" after "+n.expect)},$ExceptCtx.prototype.set_alias=function(t){this.tree[0].alias=$mangle(t,this),$bind(t,this.scope,this)},$ExceptCtx.prototype.transform=function(t,e){var n=$NodeJS("void(0)");n.line_num=t.line_num,t.insert(0,n);var r=$B.last(t.children);r.C.tree&&r.C.tree[0]&&"return"==r.C.tree[0].type||t.add($NodeJS("$B.del_exc()"))},$ExceptCtx.prototype.to_js=function(){switch(this.js_processed=!0,this.tree.length){case 0:return"else";case 1:if("Exception"==this.tree[0].name)return"else if(1)"}var t=[];this.tree.forEach((function(e){t.push(e.to_js())}));var e="";if($B.debug>0){var n=$get_module(this);e='($locals.$line_info = "'+$get_node(this).line_num+","+n.id+'") && '}return"else if("+e+"$B.is_exc("+this.error_name+",["+t.join(",")+"]))"};var $ExprCtx=$B.parser.$ExprCtx=function(t,e,n){if(this.type="expr",this.name=e,this.with_commas=n,this.expect=",",this.parent=t,t.packed&&(this.packed=t.packed),t.is_await){var r=$get_node(this);r.has_await=r.has_await||[],this.is_await=t.is_await,r.has_await.push(this)}t.assign&&(this.assign=t.assign),this.tree=[],t.tree[t.tree.length]=this};$ExprCtx.prototype.toString=function(){return"(expr "+this.with_commas+") "+this.tree},$ExprCtx.prototype.transition=function(t,e){var n=this;switch(t){case"bytes":case"float":case"id":case"imaginary":case"int":case"lambda":case"pass":case"str":$_SyntaxError(n,"token "+t+" after "+n);break;case"{":return"id"==n.tree[0].type&&-1!=["print","exec"].indexOf(n.tree[0].value)||$_SyntaxError(n,"token "+t+" after "+n),new $DictOrSetCtx(n);case"[":case"(":case".":case"not":if("expr"==n.expect)return n.expect=",",$transition(new $AbstractExprCtx(n,!1),t,e)}switch(t){case"not":if(","==n.expect)return new $ExprNot(n);break;case"in":if("target_list"==n.parent.type)return $transition(n.parent,t);if(","==n.expect)return $transition(n,"op","in");break;case",":if(","==n.expect&&(n.with_commas||["assign","return"].indexOf(n.parent.type)>-1)){$parent_match(n,{type:"yield",from:!0})&&$_SyntaxError(n,"no implicit tuple for yield from"),n.parent.tree.pop();var r=new $ListOrTupleCtx(n.parent,"tuple");return r.implicit=!0,r.has_comma=!0,r.tree=[n],n.parent=r,r}return $transition(n.parent,t);case".":return new $AttrCtx(n);case"[":return new $AbstractExprCtx(new $SubCtx(n),!0);case"(":return new $CallCtx(n);case"op":var i=n.parent,s=e;if("ternary"==i.type&&i.in_else){var o=new $OpCtx(n,s);return new $AbstractExprCtx(o,!1)}for(var a=n.parent,l=null;;)if("expr"==a.type)a=a.parent;else if("op"==a.type&&$op_weight[a.op]>=$op_weight[s]&&("**"!=a.op||"**"!=s))l=a,a=a.parent;else{if(!("not"==a.type&&$op_weight.not>$op_weight[s]))break;l=a,a=a.parent}if(null===l){for(;n.parent!==a;)i=(n=n.parent).parent;var c;return n.parent.tree.pop(),(c=new $ExprCtx(i,"operand",n.with_commas)).expect=",",n.parent=c,o=new $OpCtx(n,s),new $AbstractExprCtx(o,!1)}if("and"===s||"or"===s)for(;"not"==l.parent.type||"expr"==l.parent.type&&"not"==l.parent.parent.type;)i=(l=l.parent).parent;if("op"==l.type){var u=!1;switch(l.op){case"<":case"<=":case"==":case"!=":case"is":case">=":case">":u=!0}if(u)switch(s){case"<":case"<=":case"==":case"!=":case"is":case">=":case">":var h=l.tree[1],p=h.to_js(),d=new Object;for(var f in h)d[f]=h[f];var m="$c"+chained_comp_num;for(h.to_js=function(){return m},d.to_js=function(){return m},chained_comp_num++;l.parent&&"op"==l.parent.type&&$op_weight[l.parent.op]<$op_weight[l.op];)l=l.parent;l.parent.tree.pop();var _=new $OpCtx(l,"and");return _.wrap={name:m,js:p},d.parent=_,_.tree.push("xxx"),o=new $OpCtx(d,s),new $AbstractExprCtx(o,!1)}}return l.parent.tree.pop(),(c=new $ExprCtx(l.parent,"operand",!1)).tree=[a],l.parent=c,o=new $OpCtx(l,s),new $AbstractExprCtx(o,!1);case"augm_assign":for(var g=n.parent;g;)"assign"==g.type||"augm_assign"==g.type?$_SyntaxError(n,"augmented assignment inside assignment"):"op"==g.type&&$_SyntaxError(n,["cannot assign to operator"]),g=g.parent;return","==n.expect?new $AbstractExprCtx(new $AugmentedAssignCtx(n,e),!0):$transition(n.parent,t,e);case":":if("sub"==n.parent.type||"list_or_tuple"==n.parent.type&&"sub"==n.parent.parent.type)return new $AbstractExprCtx(new $SliceCtx(n.parent),!1);if("slice"==n.parent.type)return $transition(n.parent,t,e);if("node"==n.parent.type){if(1==n.tree.length){var y=n.tree[0];if(["id","sub","attribute"].indexOf(y.type)>-1)return new $AbstractExprCtx(new $AnnotationCtx(n),!1);if("tuple"==y.real&&","==y.expect&&1==y.tree.length)return new $AbstractExprCtx(new $AnnotationCtx(y.tree[0]),!1)}$_SyntaxError(n,"invalid target for annotation")}break;case"=":var v;if(","==n.expect){if("call_arg"==n.parent.type)return"id"!=n.tree[0].type&&$_SyntaxError(n,['expression cannot contain assignment, perhaps you meant "=="?']),new $AbstractExprCtx(new $KwArgCtx(n),!0);if(v=function(t,e){for(;t.parent;){if("annotation"==t.parent.type)return t.parent;t=t.parent}return!1}(n))return $transition(v,t,e);if("op"==n.parent.type)$_SyntaxError(n,["cannot assign to operator"]);else if("not"==n.parent.type)$_SyntaxError(n,["cannot assign to operator"]);else if("list_or_tuple"==n.parent.type)for(var b=0;b<n.parent.tree.length;b++){var x=n.parent.tree[b];"expr"==x.type&&"operand"==x.name&&$_SyntaxError(n,["cannot assign to operator"])}else n.tree.length>0&&n.tree[0].assign?$_SyntaxError(n,["cannot assign to named expression"]):"expr"==n.parent.type&&"target list"==n.parent.name?$_SyntaxError(n,"token "+t+" after "+n):"lambda"==n.parent.type&&"node"!=n.parent.parent.parent.type&&$_SyntaxError(n,['expression cannot contain assignment, perhaps you meant "=="?']);for(;void 0!==n.parent;)"condition"==(n=n.parent).type?$_SyntaxError(n,"token "+t+" after "+n):"augm_assign"==n.type&&$_SyntaxError(n,"assignment inside augmented assignment");return n=n.tree[0],new $AbstractExprCtx(new $AssignCtx(n),!0)}break;case":=":var w=n.parent.type;if(["node","assign","kwarg","annotation"].indexOf(w)>-1||"func_arg_id"==w&&n.parent.tree.length>0?$_SyntaxError(n,":= invalid, parent "+w):"call_arg"==w&&"call"==n.parent.parent.type&&"lambda"==n.parent.parent.parent.type&&$_SyntaxError(n,":= invalid inside function arguments"),1==n.tree.length&&"id"==n.tree[0].type){for(var S=$get_scope(n),M=n.tree[0].value;S.is_comp;)S=S.parent_block;$bind(M,S,n),(g=n.parent).tree.pop();var T=new $AbstractExprCtx(g,!1);return T.assign=n.tree[0],T}$_SyntaxError(n,"token "+t+" after "+n);case"if":for(var E=!1,A=n.parent;"list_or_tuple"!=A.type;){if("comp_for"==A.type||"comp_if"==A.type){E=!0;break}if("call_arg"==A.type)break;if(void 0===A.parent)break;A=A.parent}if(E)break;for(A=n;A.parent&&("op"==A.parent.type||"expr"==A.parent.type&&"operand"==A.parent.name);)A=A.parent;return new $AbstractExprCtx(new $TernaryCtx(A),!0);case"eol":if(2==n.tree.length&&"id"==n.tree[0].type&&["print","exec"].indexOf(n.tree[0].value)>-1&&$_SyntaxError(n,["Missing parentheses in call to '"+n.tree[0].value+"'."]),-1==["dict_or_set","list_or_tuple"].indexOf(n.parent.type)){var $=n.tree[0];("packed"==$.type||"call"==$.type&&"packed"==$.func.type)&&$_SyntaxError(n,["can't use starred expression here"])}}return $transition(n.parent,t)},$ExprCtx.prototype.to_js=function(t){var e;if(this.js_processed=!0,e="list"==this.type?"["+$to_js(this.tree)+"]":1==this.tree.length?this.tree[0].to_js(t):"_b_.tuple.$factory(["+$to_js(this.tree)+"])",this.is_await&&(e="await ($B.promise("+e+"))"),this.assign){for(var n=$get_scope(this);n.is_comp;)n=n.parent_block;if(n.globals&&n.globals.has(this.assign.value))for(;n.parent_block&&"__builtins__"!==n.parent_block.id;)n=n.parent_block;else n.nonlocals&&n.nonlocals[this.assign.value]&&(n=n.parent_block);e="($locals_"+n.id.replace(/\./g,"_")+'["'+this.assign.value+'"] = '+e+")"}return e};var $ExprNot=$B.parser.$ExprNot=function(t){this.type="expr_not",this.parent=t,this.tree=[],t.tree[t.tree.length]=this};$ExprNot.prototype.transition=function(t,e){var n=this;if("in"==t)return n.parent.tree.pop(),new $AbstractExprCtx(new $OpCtx(n.parent,"not_in"),!1);$_SyntaxError(n,"token "+t+" after "+n)},$ExprNot.prototype.toString=function(){return"(expr_not)"};var $ForExpr=$B.parser.$ForExpr=function(t){t.node.parent.is_comp&&(t.node.parent.first_for=this),this.type="for",this.parent=t,this.tree=[],t.tree[t.tree.length]=this,this.loop_num=$loop_num,this.scope=$get_scope(this),this.scope.is_comp,this.module=this.scope.module,$loop_num++};$ForExpr.prototype.toString=function(){return"(for) "+this.tree},$ForExpr.prototype.transition=function(t,e){var n=this;switch(t){case"in":return 0==n.tree[0].tree.length&&$_SyntaxError(n,"missing target between 'for' and 'in'"),new $AbstractExprCtx(new $ExprCtx(n,"target list",!0),!1);case":":return(n.tree.length<2||"abstract_expr"==n.tree[1].tree[0].type)&&$_SyntaxError(n,"token "+t+" after "+n),$BodyCtx(n)}$_SyntaxError(n,"token "+t+" after "+n)},$ForExpr.prototype.transform=function(t,e){for(var n=this.parent.node.parent;n;){if(n.is_comp){var r=$get_module(this);void 0===r.outermost_expr&&(n.outermost_expr=this.tree[1],r.outermost_expr=this.tree[1],this.tree.pop(),new $RawJSCtx(this,"expr"));break}n=n.parent}if(this.async)return this.transform_async(t,e);var i=$get_scope(this),s=this.tree[0],o=1==s.tree.length&&"id"==s.expect,a=this.tree[1],l=this.loop_num,c="$locals_"+i.id.replace(/\./g,"_"),u="\n"+" ".repeat(t.indent+4),h=!1;if(1==s.tree.length&&!i.blurred&&"id"!=s.expct&&"expr"==a.type&&"expr"==a.tree[0].type&&"call"==a.tree[0].tree[0].type){var p=a.tree[0].tree[0];"id"==p.func.type&&"range"==p.func.value&&p.tree.length<3&&p.tree.length>0&&(h=p)}var d=[],f=0,m=t.children;if(h){this.has_break&&(R=new $Node,new $NodeJSCtx(R,c+'["$no_break'+l+'"] = true'),d[f++]=R);for(var _,g=$get_scope(this),y=[];g.binding.range&&y.push(g.id),g.parent_block;)g=g.parent_block;_=1==y.length&&"__builtins__"==y[0];var v=new $Node;v.module=t.parent.module,new $NodeJSCtx(v,_?"if(1)":"if("+p.func.to_js()+" === _b_.range)"),d[f++]=v;var b=s.to_js(),x=!1;if(1==h.tree.length){if("int"==(M=h.tree[0].tree[0]).tree[0].type&&0<(M=parseInt(M.to_js()))<$B.max_int){x=!0;var w="$i"+$B.UUID();(E=$NodeJS("for (var "+w+" = 0; "+w+" < "+M+"; "+w+"++)")).add($NodeJS(b+" = "+w))}var S=0,M=h.tree[0].to_js()}else S=h.tree[0].to_js(),M=h.tree[1].to_js();if(!x){var T="var $stop_"+l+" = $B.int_or_bool("+M+"),"+u+"        $next"+l+" = "+S+","+u+"        $safe"+l+" = typeof $next"+l+' == "number" && typeof $stop_'+l+' == "number";'+u+"    while(true)",E=new $Node;new $NodeJSCtx(E,T),E.add($NodeJS("if($safe"+l+" && $next"+l+">= $stop_"+l+"){break}")),E.add($NodeJS("else if(!$safe"+l+" && $B.ge($next"+l+", $stop_"+l+")){break}")),E.add($NodeJS(b+" = $next"+l)),E.add($NodeJS("if($safe"+l+"){$next"+l+" += 1}")),E.add($NodeJS("else{$next"+l+" = $B.add($next"+l+",1)}"))}m.forEach((function(t){E.add(t.clone_tree())})),"return"!=$B.last(t.children).C.tree[0].type&&(T='$locals.$line_info = "'+t.line_num+","+this.module+'";if($locals.$f_trace !== _b_.None){$B.trace_line()};_b_.None;',E.add($NodeJS(T)));var A=!1;if("module"==i.ntype)for(n=t.parent;n;){if(n.for_wrapper){A=!0;break}n=n.parent}if("module"!=i.ntype||A)v.add(E);else{var $=new $Node;$.for_wrapper=!0,T="function $f"+l+"(",this.has_break&&(T+="$no_break"+l),new $NodeJSCtx($,T+=")"),v.add($),$.add(E),this.has_break&&$.add($NodeJS("return $no_break"+l)),v.add($NodeJS("var $res"+l+" = $f"+l+"();")),this.has_break&&v.add($NodeJS("var $no_break"+l+" = $res"+l))}if(_){t.parent.children.splice(e,1);var C=0;return this.has_break&&(t.parent.insert(e,d[0]),C++),d[C].children.forEach((function(n){t.parent.insert(e+C,n)})),t.parent.children[e].line_num=t.line_num,t.parent.children[e].bindings=t.bindings,t.children=[],0}var B=$NodeJS("else");d[f++]=B;for(var L=d.length-1;L>=0;L--)t.parent.insert(e+1,d[L]);this.test_range=!0,d=[],f=0}var R=new $Node;R.line_num=$get_node(this).line_num;var N=a.to_js(),P="$iter"+l;new $NodeJSCtx(R,T="var "+P+" = "+N+';$locals["$next'+l+'"] = $B.$getattr($B.$iter('+P+'),"__next__")'),d[f++]=R,this.has_break&&(d[f++]=$NodeJS(c+'["$no_break'+l+'"] = true;'));var I=new $Node;if(T=this.has_break?"while("+c+'["$no_break'+l+'"])':"while(true)",new $NodeJSCtx(I,T),I.C.loop_num=l,I.C.type="for",d[f++]=I,t.parent.children.splice(e,1),this.test_range)for(L=d.length-1;L>=0;L--)B.insert(0,d[L]);else for(L=d.length-1;L>=0;L--)t.parent.insert(e,d[L]),d.length;var O=$NodeJS("try");O.bindings=t.bindings,I.add(O);var F=new $Node;F.id=this.module;var k=new $NodeCtx(F),D=new $ExprCtx(k,"left",!0);if(o){var U=new $ListOrTupleCtx(D);U.real="tuple",U.tree=s.tree}else D.tree=s.tree;return new $AssignCtx(D).tree[1]=new $JSCode('$locals["$next'+l+'"]()'),O.add(F),I.add($NodeJS("catch($err){if($B.is_exc($err, [_b_.StopIteration])){break;}else{throw($err)}}")),m.forEach((function(t){I.add(t.clone())})),0==t.children.length&&console.log("bizarre",this),"return"!=$B.last(t.children).C.tree[0].type&&(T='$locals.$line_info = "'+t.line_num+","+this.module+'";if($locals.$f_trace !== _b_.None){$B.trace_line()};_b_.None;',I.add($NodeJS(T))),t.children=[],0},$ForExpr.prototype.transform_async=function(t,e){var n=$get_scope(this),r=this.tree[0],i=(1==r.tree.length&&r.expect,this.tree[1]),s=this.loop_num,o=(n.id.replace(/\./g,"_")," ".repeat(t.indent+4),[]),a="$iter"+s,l="$type"+s,c="$running"+s,u="$anext"+s,h="var "+a+" = "+i.to_js();o.push($NodeJS(h)),o.push($NodeJS("var "+l+" = _b_.type.$factory( "+a+")")),h=a+" = $B.$call($B.$getattr("+l+', "__aiter__"))('+a+")",o.push($NodeJS(h)),o.push($NodeJS("var "+c+" = true")),o.push($NodeJS("var "+u+" = $B.$call($B.$getattr("+l+', "__anext__"))'));var p=$NodeJS("while("+c+")");o.push(p);var d=$NodeJS("try");if(p.add(d),1==r.tree.length)h=r.to_js()+" = await ($B.promise("+u+"("+a+")))",d.add($NodeJS(h));else{var f=new $Node,m=new $NodeCtx(f),_=new $ExprCtx(m,"left",!1);_.tree.push(r),r.parent=_;var g=new $AssignCtx(_);new $RawJSCtx(g,"await ($B.promise("+u+"("+a+")))"),d.add(f)}var y=$NodeJS("catch(err)");p.add(y),h="if(err.__class__ === _b_.StopAsyncIteration){"+c+" = false; continue}else{throw err}",y.add($NodeJS(h)),t.children.forEach((function(t){p.add(t)})),t.parent.children.splice(e,1);for(var v=o.length-1;v>=0;v--)t.parent.insert(e,o[v]);return t.children=[],0},$ForExpr.prototype.to_js=function(){this.js_processed=!0;var t=this.tree.pop();return"for ("+$to_js(this.tree)+" in "+t.to_js()+")"};var $FromCtx=$B.parser.$FromCtx=function(t){this.type="from",this.parent=t,this.module="",this.names=[],t.tree[t.tree.length]=this,this.expect="module",this.scope=$get_scope(this)};$FromCtx.prototype.add_name=function(t){this.names[this.names.length]=t,"*"==t&&(this.scope.blurred=!0)},$FromCtx.prototype.bind_names=function(){var t=$get_scope(this);this.names.forEach((function(e){Array.isArray(e)&&(e=e[1]),$bind(e,t,this)}),this)},$FromCtx.prototype.transition=function(t,e){var n=this;switch(t){case"id":if("id"==n.expect)return n.add_name(e),n.expect=",",n;if("alias"==n.expect)return n.names[n.names.length-1]=[$B.last(n.names),e],n.expect=",",n;case".":if("module"==n.expect)return n.module+="id"==t?e:".",n;case"import":if("module"==n.expect)return n.expect="id",n;case"op":if("*"==e&&"id"==n.expect&&0==n.names.length)return"module"!==$get_scope(n).ntype&&$_SyntaxError(n,["import * only allowed at module level"]),n.add_name("*"),n.expect="eol",n;case",":if(","==n.expect)return n.expect="id",n;case"eol":switch(n.expect){case",":case"eol":return n.bind_names(),$transition(n.parent,t);case"id":$_SyntaxError(n,["trailing comma not allowed without surrounding parentheses"]);default:$_SyntaxError(n,["invalid syntax"])}case"as":if(","==n.expect||"eol"==n.expect)return n.expect="alias",n;case"(":if("id"==n.expect)return n.expect="id",n;case")":if(","==n.expect||"id"==n.expect)return n.expect="eol",n}$_SyntaxError(n,"token "+t+" after "+n)},$FromCtx.prototype.toString=function(){return"(from) "+this.module+" (import) "+this.names},$FromCtx.prototype.to_js=function(){this.js_processed=!0;var t=$get_scope(this),e=$get_module(this),n=e.module,r=[],i=0,s=$get_node(this).indent,o=" ".repeat(s);if(n.startsWith("$exec")){var a=$B.last($B.frames_stack)[1];a.module&&a.module.__name__&&(n=a.module.__name__)}for(var l=this.module.split("."),c=0;c<l.length;c++)e.imports[l.slice(0,c+1).join(".")]=!0;for(var u,h=this.module.replace(/\$/g,""),p=[];h.length>0&&"."==h.charAt(0);){if(void 0===u?void 0!==$B.imported[n]&&(p=(u=$B.imported[n].__package__).split(".")):(u=$B.imported[u],p.pop()),void 0===u)return"throw _b_.SystemError.$factory(\"Parent module '' not loaded, cannot perform relative import\")";"None"==u&&console.log("package is None !"),h=h.substr(1)}h&&p.push(h),this.module=p.join(".");var d=this.module.replace(/\$/g,"");r[i++]='var module = $B.$import("',r[i++]=d+'",["';for(var f=[],m=(c=0,this.names.length);c<m;c++)Array.isArray(this.names[c])?f.push(this.names[c][0]):f.push(this.names[c]);r[i++]=f.join('","')+'"], {';var _="";for(var g in this.aliases)r[i++]=_+'"'+g+'": "'+this.aliases[g]+'"',_=",";return r[i++]="}, {}, true);","*"==this.names[0]?(t.blurred=!0,r[i++]="\n"+o+"$B.import_all($locals, module);"):this.names.forEach((function(t){var n=t;Array.isArray(t)&&(n=t[1],t=t[0]),e.imports[this.module+"."+t]=!0,r[i++]="\n"+o+'$locals["'+n+'"] = $B.$getattr($B.imported["'+d+'"], "'+t+'");'}),this),r[i++]="\n"+o+"_b_.None;",r.join("")};var $FuncArgs=$B.parser.$FuncArgs=function(t){this.type="func_args",this.parent=t,this.tree=[],this.names=[],t.tree[t.tree.length]=this,this.expect="id",this.has_default=!1,this.has_star_arg=!1,this.has_kw_arg=!1};$FuncArgs.prototype.toString=function(){return"func args "+this.tree},$FuncArgs.prototype.transition=function(t,e){var n=this;switch(t){case"id":return n.has_kw_arg&&$_SyntaxError(n,"duplicate keyword argument"),"id"==n.expect&&(n.expect=",",n.names.indexOf(e)>-1&&$_SyntaxError(n,["duplicate argument "+e+" in function definition"])),new $FuncArgIdCtx(n,e);case",":if(","==n.expect)return n.expect="id",n;$_SyntaxError(n,"token "+t+" after "+n);case")":var r=$B.last(n.tree);return r&&"func_star_arg"==r.type&&"*"==r.name&&("*"==n.op?$_SyntaxError(n,["named arguments must follow bare *"]):$_SyntaxError(n,"invalid syntax")),n.parent;case"op":n.has_kw_arg&&$_SyntaxError(n,"duplicate keyword argument");var i=e;if(n.expect=",","*"==i)return n.has_star_arg&&$_SyntaxError(n,"duplicate star argument"),new $FuncStarArgCtx(n,"*");if("**"==i)return new $FuncStarArgCtx(n,"**");if("/"==i)return n.has_end_positional?$_SyntaxError(n,["duplicate / in function parameters"]):n.has_star_arg&&$_SyntaxError(n,["/ after * in function parameters"]),new $EndOfPositionalCtx(n);$_SyntaxError(n,"token "+i+" after "+n);case":":if("lambda"==n.parent.type)return $transition(n.parent,t)}$_SyntaxError(n,"token "+t+" after "+n)},$FuncArgs.prototype.to_js=function(){return this.js_processed=!0,$to_js(this.tree)};var $FuncArgIdCtx=$B.parser.$FuncArgIdCtx=function(t,e){this.type="func_arg_id",this.name=e,this.parent=t,t.has_star_arg?t.parent.after_star.push(e):t.parent.positional_list.push(e);var n=$get_node(this);n.binding[e]&&$_SyntaxError(t,["duplicate argument '"+e+"' in function definition"]),$bind(e,n,this),this.tree=[],t.tree[t.tree.length]=this;for(var r=t;void 0!==r.parent;){if("def"==r.type){r.locals.push(e);break}r=r.parent}this.expect="="};$FuncArgIdCtx.prototype.toString=function(){return"func arg id "+this.name+"="+this.tree},$FuncArgIdCtx.prototype.transition=function(t,e){var n=this;switch(t){case"=":if("="==n.expect){n.has_default=!0;var r=n.parent.parent;return n.parent.has_star_arg?r.default_list.push(r.after_star.pop()):r.default_list.push(r.positional_list.pop()),new $AbstractExprCtx(n,!1)}break;case",":case")":if(!n.parent.has_default||0!=n.tree.length||void 0!==n.parent.has_star_arg)return $transition(n.parent,t);$pos-=n.name.length,$_SyntaxError(n,["non-default argument follows default argument"]);case":":return"lambda"==n.parent.parent.type?$transition(n.parent.parent,":"):(n.has_default&&$_SyntaxError(n,"token "+t+" after "+n),new $AbstractExprCtx(new $AnnotationCtx(n),!1))}$_SyntaxError(n,"token "+t+" after "+n)},$FuncArgIdCtx.prototype.to_js=function(){return this.js_processed=!0,this.name+$to_js(this.tree)};var $FuncStarArgCtx=$B.parser.$FuncStarArgCtx=function(t,e){this.type="func_star_arg",this.op=e,this.parent=t,this.node=$get_node(this),t.has_star_arg="*"==e,t.has_kw_arg="**"==e,t.tree[t.tree.length]=this};$FuncStarArgCtx.prototype.toString=function(){return"(func star arg "+this.op+") "+this.name},$FuncStarArgCtx.prototype.transition=function(t,e){var n=this;switch(t){case"id":return void 0===n.name&&n.parent.names.indexOf(e)>-1&&$_SyntaxError(n,["duplicate argument "+e+" in function definition"]),n.set_name(e),n.parent.names.push(e),n;case",":case")":return void 0===n.name&&(n.set_name("*"),n.parent.names.push("*")),$transition(n.parent,t);case":":return"lambda"==n.parent.parent.type?$transition(n.parent.parent,":"):(void 0===n.name&&$_SyntaxError(n,"annotation on an unnamed parameter"),new $AbstractExprCtx(new $AnnotationCtx(n),!1))}$_SyntaxError(n,"token "+t+" after "+n)},$FuncStarArgCtx.prototype.set_name=function(t){this.name=t,this.node.binding[t]&&$_SyntaxError(C,["duplicate argument '"+t+"' in function definition"]),$bind(t,this.node,this);for(var e=this.parent;void 0!==e.parent;){if("def"==e.type){e.locals.push(t);break}e=e.parent}"*"==this.op?e.other_args='"'+t+'"':e.other_kw='"'+t+'"'};var $GlobalCtx=$B.parser.$GlobalCtx=function(t){for(this.type="global",this.parent=t,this.tree=[],t.tree[t.tree.length]=this,this.expect="id",this.scope=$get_scope(this),this.scope.globals=this.scope.globals||new Set,this.module=$get_module(this);this.module.module!=this.module.id;)this.module=this.module.parent_block;this.module.binding=this.module.binding||{}};$GlobalCtx.prototype.toString=function(){return"global "+this.tree},$GlobalCtx.prototype.transition=function(t,e){var n=this;switch(t){case"id":if("id"==n.expect)return new $IdCtx(n,e),n.add(e),n.expect=",",n;break;case",":if(","==n.expect)return n.expect="id",n;break;case"eol":if(","==n.expect)return $transition(n.parent,t)}$_SyntaxError(n,"token "+t+" after "+n)},$GlobalCtx.prototype.add=function(t){this.scope.annotations&&this.scope.annotations.has(t)&&$_SyntaxError(C,["annotated name '"+t+"' can't be global"]),this.scope.globals.add(t);var e=this.scope.parent_block;if(this.module.module.startsWith("$exec"))for(;e&&e.parent_block!==this.module;)e._globals=e._globals||{},e._globals[t]=this.module.id,delete e.binding[t],e=e.parent_block;this.module.binding[t]=!0},$GlobalCtx.prototype.to_js=function(){return this.js_processed=!0,""};var $IdCtx=$B.parser.$IdCtx=function(t,e){this.type="id",this.value=$mangle(e,t),this.parent=t,this.tree=[],t.tree[t.tree.length]=this;var n=this.scope=$get_scope(this);this.blurred_scope=this.scope.blurred,this.env=clone(this.scope.binding),["def","generator"].indexOf(n.ntype)>-1&&(n.referenced=n.referenced||{},$B.builtins[this.value]||(n.referenced[this.value]=!0)),"call_arg"==t.parent.type&&(this.call_arg=!0);for(var r=t;void 0!==r.parent;){switch(r.type){case"ctx_manager_alias":$bind(e,n,this);break;case"list_or_tuple":case"dict_or_set":case"call_arg":case"def":case"lambda":void 0===r.vars?r.vars=[e]:-1==r.vars.indexOf(e)&&r.vars.push(e),this.call_arg&&"lambda"==r.type&&(void 0===r.locals?r.locals=[e]:r.locals.push(e))}r=r.parent}if($parent_match(t,{type:"target_list"})&&(this.no_bindings=!0,$bind(e,n,this),this.bound=!0),["def","generator"].indexOf(n.ntype)>-1){for(var i=this.parent;i;){if("list_or_tuple"==i.type&&i.is_comp()){this.in_comp=!0;break}i=i.parent}"expr"==t.type&&"comp_if"==t.parent.type||"global"==t.type&&(void 0===n.globals?n.globals=new Set([e]):n.globals.add(e))}};$IdCtx.prototype.toString=function(){return"(id) "+this.value+":"+(this.tree||"")},$IdCtx.prototype.transition=function(t,e){var n=this;switch(t){case"=":return"expr"==n.parent.type&&void 0!==n.parent.parent&&"call_arg"==n.parent.parent.type?new $AbstractExprCtx(new $KwArgCtx(n.parent),!1):$transition(n.parent,t,e);case"op":return $transition(n.parent,t,e);case"id":case"str":case"int":case"float":case"imaginary":["print","exec"].indexOf(n.value)>-1&&$_SyntaxError(n,["missing parenthesis in call to '"+n.value+"'"]),$_SyntaxError(n,"token "+t+" after "+n)}return"packed"==this.parent.parent.type&&-1==[".","[","("].indexOf(t)?this.parent.parent.transition(t,e):$transition(n.parent,t,e)},$IdCtx.prototype.firstBindingScopeId=function(){for(var t=this.scope;t;){if(t.globals&&t.globals.has(this.value))return $get_module(this).id;if(t.binding&&t.binding[this.value])return t.id;t=t.parent}},$IdCtx.prototype.boundBefore=function(t){for(var e=$get_node(this);e.parent;){var n=e.parent;if(n.bindings&&n.bindings[this.value])return n.bindings[this.value];for(var r=0;r<n.children.length;r++){var i=n.children[r];if(i===e)break;if(i.bindings&&i.bindings[this.value])return i.bindings[this.value]}if(n===t)break;e=n}return!1},$IdCtx.prototype.bindingType=function(t){for(var e,n,r=0,i=$get_node(this),s=!1;!s&&i.parent&&r++<100;){var o=i.parent;if(o.bindings&&o.bindings[this.value])return o.bindings[this.value];for(var a=0;a<o.children.length;a++){var l=o.children[a];if(l===i)break;l.bindings&&l.bindings[this.value]&&(s=l.bindings[this.value],n=a)}if(s){for(var c=n+1;c<o.children.length;c++){if((l=o.children[c]).children.length>0){e=!0;break}if(l===i)break}return e||s}if(o===t)break;i=o}return s},$IdCtx.prototype.to_js=function(t){if(void 0!==this.result&&"generator"==this.scope.ntype)return this.result;var e=this.value;if("__BRYTHON__"==e||"$B"==e)return e;if(e.startsWith("comp_result_"+$B.lambda_magic))return this.bound?"var "+e:e;if(this.js_processed=!0,this.scope._globals&&this.scope._globals[e]&&(this.global_module=this.scope._globals[e]),this.global_module)return"$locals_"+this.global_module.replace(/\./g,"_")+'["'+e+'"]';var n=void 0!==this.scope.binding[e],r=$get_node(this),i=r.bound_before;if(this.nonlocal=this.scope.nonlocals&&void 0!==this.scope.nonlocals[e],this.unbound=this.unbound||n&&!this.bound&&i&&-1==i.indexOf(e),!this.bound&&this.scope.C&&"class"==this.scope.ntype&&this.scope.C.tree[0].name==e)return'$B.$search("'+e+'")';if(this.unbound&&!this.nonlocal)return"def"==this.scope.ntype||"generator"==this.scope.ntype?'$B.$local_search("'+e+'")':'$B.$search("'+e+'")';for(var s=$get_scope(this),o=s,a=[],l=['"'+s.id+'"'],c=s;;){if(c.parent_block){if(c.parent_block==$B.builtins_scope)break;if(void 0===c.parent_block.id)break;c=c.parent_block}l.push('"'+c.id+'"')}if(l="["+l.join(", ")+"]",s.globals&&s.globals.has(e)&&(l=['"'+c.id+'"'],s=c),this.nonlocal||this.bound){var u=this.firstBindingScopeId();if(void 0!==u)return"$locals_"+u.replace(/\./g,"_")+'["'+e+'"]';if(this.bound)return"$locals_"+s.id.replace(/\./g,"_")+'["'+e+'"]'}for(var h="$locals_"+c.id.replace(/\./g,"_");;){if(void 0!==o.globals&&o.globals.has(e))return this.boundBefore(c)||this.augm_assign?h+'["'+e+'"]':'$B.$global_search("'+e+'", '+l+")";if(o===s){if(i)(i.indexOf(e)>-1||o.C&&"def"==o.C.tree[0].type&&o.C.tree[0].env.indexOf(e)>-1)&&a.push(o);else if(o.binding[e]){if(void 0!==r.locals[e]){a.push(o);break}o.is_comp||o.parent_block&&o.parent_block.is_comp||a.push(o)}}else void 0===o.binding&&console.log("scope",o,e,"no binding",s),o.binding[e]&&a.push(o);if(!o.parent_block)break;o=o.parent_block}if(this.found=a,this.nonlocal&&a[0]===s&&a.shift(),a.length>0){if(a[0].C&&a[0]===s&&"$"!=e.charAt(0)){var p=r.locals||{},d=s.nonlocals;try{if(void 0===p[e]&&!this.augm_assign&&("def"!=s.type||"generator"!=s.type)&&"class"!=s.ntype&&s.C.tree[0].args&&-1==s.C.tree[0].args.indexOf(e)&&(void 0===d||void 0===d[e]))return this.result='$B.$local_search("'+e+'")',this.result}catch(t){throw console.log("error",e,s),t}}if(a.length>1&&a[0].C&&"class"==a[0].C.tree[0].type){var f="$locals_"+a[0].id.replace(/\./g,"_"),m="$locals_"+a[1].id.replace(/\./g,"_");if(i)return i.indexOf(e)>-1?(this.found=a[0].binding[e],_=f):(this.found=a[1].binding[e],_=m),this.result=_+'["'+e+'"]',this.result;this.found=!1;var _=f+'["'+e+'"] !== undefined ? ';return _+=f+'["'+e+'"] : ',this.result="("+_+m+'["'+e+'"])',this.result}o=a[0],this.found=o.binding[e];var g="$locals_"+o.id.replace(/\./g,"_");if(void 0===o.C)if("__builtins__"==o.id)c.blurred?e="("+h+'["'+e+'"] || _b_.'+e+")":(e="_b_."+e,this.is_builtin=!0);else if(this.bound||this.augm_assign)e=g+'["'+e+'"]';else{if(o===s&&void 0===this.env[e])return this.result='$B.$search("'+e+'")',this.result;e=this.boundBefore(o)?g+'["'+e+'"]':'$B.$check_def("'+e+'",'+g+'["'+e+'"])'}else e=o===s?o.globals&&o.globals.has(e)?h+'["'+e+'"]':this.bound||this.augm_assign||this.boundBefore(o)?'$locals["'+e+'"]':'$B.$check_def_local("'+e+'",$locals["'+e+'"])':this.augm_assign?g+'["'+e+'"]':'$B.$check_def_free("'+e+'",'+g+'["'+e+'"])';return this.result=e+$to_js(this.tree,""),this.result}return this.unknown_binding=!0,this.result='$B.$global_search("'+e+'", '+l+")",this.result};var $ImportCtx=$B.parser.$ImportCtx=function(t){this.type="import",this.parent=t,this.tree=[],t.tree[t.tree.length]=this,this.expect="id"};$ImportCtx.prototype.toString=function(){return"import "+this.tree},$ImportCtx.prototype.transition=function(t,e){var n=this;switch(t){case"id":if("id"==n.expect)return new $ImportedModuleCtx(n,e),n.expect=",",n;if("qual"==n.expect)return n.expect=",",n.tree[n.tree.length-1].name+="."+e,n.tree[n.tree.length-1].alias+="."+e,n;if("alias"==n.expect)return n.expect=",",n.tree[n.tree.length-1].alias=e,n;break;case".":if(","==n.expect)return n.expect="qual",n;break;case",":if(","==n.expect)return n.expect="id",n;break;case"as":if(","==n.expect)return n.expect="alias",n;break;case"eol":if(","==n.expect)return n.bind_names(),$transition(n.parent,t)}$_SyntaxError(n,"token "+t+" after "+n)},$ImportCtx.prototype.bind_names=function(){var t=$get_scope(this);this.tree.forEach((function(e){if(e.name==e.alias){var n=e.name,r=n.split("."),i=n;r.length>1&&(i=r[0])}else i=e.alias;$bind(i,t,this)}),this)},$ImportCtx.prototype.to_js=function(){this.js_processed=!0;var t=$get_scope(this),e=[],n=$get_module(this);return this.tree.forEach((function(r){for(var i=r.name,s=r.name==r.alias?"{}":'{"'+i+'" : "'+r.alias+'"}',o="$locals_"+t.id.replace(/\./g,"_"),a=r.name.split("."),l=0;l<a.length;l++)n.imports[a.slice(0,l+1).join(".")]=!0;var c='$B.$import("'+i+'", [],'+s+","+o+", true);";e.push(c)})),e.join("")+"_b_.None;"};var $ImportedModuleCtx=$B.parser.$ImportedModuleCtx=function(t,e){this.type="imported module",this.parent=t,this.name=e,this.alias=e,t.tree[t.tree.length]=this};$ImportedModuleCtx.prototype.toString=function(){return" (imported module) "+this.name},$ImportedModuleCtx.prototype.transition=function(t,e){},$ImportedModuleCtx.prototype.to_js=function(){return this.js_processed=!0,'"'+this.name+'"'};var $JSCode=$B.parser.$JSCode=function(t){this.js=t};$JSCode.prototype.toString=function(){return this.js},$JSCode.prototype.transition=function(t,e){},$JSCode.prototype.to_js=function(){return this.js_processed=!0,this.js};var $KwArgCtx=$B.parser.$KwArgCtx=function(t){this.type="kwarg",this.parent=t.parent,this.tree=[t.tree[0]],t.parent.tree.pop(),t.parent.tree.push(this),t.parent.parent.has_kw=!0;var e=this.tree[0].value,n=t.parent.parent;void 0===n.kwargs?n.kwargs=[e]:-1==n.kwargs.indexOf(e)?n.kwargs.push(e):$_SyntaxError(t,["keyword argument repeated"])};$KwArgCtx.prototype.toString=function(){return"kwarg "+this.tree[0]+"="+this.tree[1]},$KwArgCtx.prototype.transition=function(t,e){return","==t?new $CallArgCtx(this.parent.parent):$transition(this.parent,t)},$KwArgCtx.prototype.to_js=function(){this.js_processed=!0;var t=this.tree[0].value;return"$$"==t.substr(0,2)&&(t=t.substr(2)),'{$nat:"kw",name:"'+t+'",value:'+$to_js(this.tree.slice(1,this.tree.length))+"}"};var $LambdaCtx=$B.parser.$LambdaCtx=function(t){this.type="lambda",this.parent=t,t.tree[t.tree.length]=this,this.tree=[],this.args_start=$pos+6,this.vars=[],this.locals=[],this.node=$get_node(this),this.node.binding={},this.positional_list=[],this.default_list=[],this.other_args=null,this.other_kw=null,this.after_star=[]};$LambdaCtx.prototype.toString=function(){return"(lambda) "+this.args_start+" "+this.body_start},$LambdaCtx.prototype.transition=function(t,e){var n=this;return":"==t&&void 0===n.args?(n.args=n.tree,n.tree=[],n.body_start=$pos,new $AbstractExprCtx(n,!1)):void 0!==n.args?(n.body_end=$pos,$transition(n.parent,t)):void 0===n.args&&"("!=t?$transition(new $FuncArgs(n),t,e):void $_SyntaxError(n,"token "+t+" after "+n)},$LambdaCtx.prototype.to_js=function(){this.js_processed=!0;var t=this.parent,e=this.node,n=$get_module(this),r=$get_src(t),i=r.substring(this.args_start,this.body_start),s=r.substring(this.body_start+1,this.body_end);s=(s=s.replace(/\\\n/g," ")).replace(/\n/g," ");var o=$get_scope(this),a=$B.UUID(),l="lambda_"+$B.lambda_magic+"_"+a,c="def "+l+"("+i+"):";c+="    return "+s;var u="lambda"+a,h=n.id.replace(/\./g,"_"),p=$B.py2js(c,h,u,o,e.line_num).to_js(),d=`$locals_${u}`;return i="{}",n.is_comp&&(d+=`,$locals_${n.id.replace(/\./g,"_")}`,i+=`,typeof $locals_${n.id.replace(/\./g,"_")}==="undefined" ?{}:$locals_${n.id.replace(/\./g,"_")}`),p=`(function(${d}){\n`+p+`\nreturn $locals.${l}})(${i})`,$B.clear_ns(u),$B.$py_src[u]=null,delete $B.$py_src[u],p};var $ListOrTupleCtx=$B.parser.$ListOrTupleCtx=function(t,e){this.type="list_or_tuple",this.start=$pos,this.real=e,this.expect="id",this.closed=!1,this.parent=t,this.tree=[],t.tree[t.tree.length]=this};$ListOrTupleCtx.prototype.toString=function(){switch(this.real){case"list":return"(list) ["+this.tree+"]";case"list_comp":case"gen_expr":return"("+this.real+") ["+this.intervals+"-"+this.tree+"]";default:return"(tuple) ("+this.tree+")"}},$ListOrTupleCtx.prototype.transition=function(t,e){var n=this;if(n.closed)return"["==t?new $AbstractExprCtx(new $SubCtx(n.parent),!1):"("==t?new $CallCtx(n.parent):$transition(n.parent,t,e);if(","==n.expect){switch(n.real){case"tuple":case"gen_expr":if(")"==t){for(var r=!0;"list_or_tuple"==n.type&&"tuple"==n.real&&"expr"==n.parent.type&&"node"==n.parent.parent.type&&1==n.tree.length;){r=!1;var i=n.parent.parent,s=i.tree.indexOf(n.parent);(l=n.tree[0]).parent=i,l.$in_parens=!0,i.tree.splice(s,1,l),n=l.tree[0]}if(r&&n.close(),"gen_expr"==n.real){if(n.expression.yields)for(const t of n.expression.yields)$pos=t[1],$_SyntaxError(n,["'yield' inside generator expression"]);n.intervals.push($pos)}return"packed"==n.parent.type?n.parent.parent:"abstract_expr"==n.parent.type&&n.parent.assign?(n.parent.parent.tree.pop(),(l=new $ExprCtx(n.parent.parent,"assign",!1)).tree=n.parent.tree,l.tree[0].parent=l,l.assign=n.parent.assign,l):n.parent}break;case"list":case"list_comp":if("]"==t){if(n.close(),"list_comp"==n.real){if(n.expression.yields)for(const t of n.expression.yields)$pos=t[1],$_SyntaxError(n,["'yield' inside list comprehension"]);n.intervals.push($pos)}return"packed"==n.parent.type?n.parent.tree.length>0?n.parent.tree[0]:n.parent.parent:n.parent}break;case"dict_or_set_comp":if("}"==t){if(n.expression.yields)for(const t of n.expression.yields){$pos=t[1];var o="set_comp"==n.parent.real?"set":"dict";$_SyntaxError(n,[`'yield' inside ${o}comprehension`])}return n.intervals.push($pos),$transition(n.parent,t)}}switch(t){case",":return"tuple"==n.real&&(n.has_comma=!0),n.expect="id",n;case"for":"list"==n.real?(this.tree.length>1&&$_SyntaxError(n,"unparenthesized expression before 'for'"),n.real="list_comp"):n.real="gen_expr",n.intervals=[n.start+1],n.expression=n.tree,n.yields&&(n.expression.yields=n.yields,delete n.yields),n.tree=[];var a=new $ComprehensionCtx(n);return new $TargetListCtx(new $CompForCtx(a))}return $transition(n.parent,t,e)}if("id"!=n.expect)return $transition(n.parent,t,e);switch(n.real){case"tuple":if(")"==t)return n.close(),n.parent;if("eol"==t&&!0===n.implicit)return n.close(),$transition(n.parent,t);break;case"gen_expr":if(")"==t)return n.close(),$transition(n.parent,t);break;case"list":if("]"==t)return n.close(),n}switch(t){case"=":if("tuple"==n.real&&!0===n.implicit)return n.close(),n.parent.tree.pop(),(l=new $ExprCtx(n.parent,"tuple",!1)).tree=[n],n.parent=l,$transition(n.parent,t);break;case")":break;case"]":if("tuple"==n.real&&!0===n.implicit)return $transition(n.parent,t,e);break;case",":$_SyntaxError(n,"unexpected comma inside list");default:n.expect=",";var l=new $AbstractExprCtx(n,!1);return $transition(l,t,e)}},$ListOrTupleCtx.prototype.close=function(){this.closed=!0;for(var t=0,e=this.tree.length;t<e;t++){var n=this.tree[t];"expr"==n.type&&"list_or_tuple"==n.tree[0].type&&"tuple"==n.tree[0].real&&1==n.tree[0].tree.length&&","==n.tree[0].expect&&(this.tree[t]=n.tree[0].tree[0],this.tree[t].parent=this)}},$ListOrTupleCtx.prototype.is_comp=function(){switch(this.real){case"list_comp":case"gen_expr":case"dict_or_set_comp":return!0}return!1},$ListOrTupleCtx.prototype.get_src=function(){var t=$get_module(this).src,e=$get_scope(this);return void 0===e.comments||e.comments.forEach((function(e){var n=e[0],r=e[1];t=t.substr(0,n)+" ".repeat(r+1)+t.substr(n+r+1)})),t},$ListOrTupleCtx.prototype.bind_ids=function(t){this.tree.forEach((function(e){if("id"==e.type)$bind(e.value,t,this),e.bound=!0;else if("expr"==e.type&&"id"==e.tree[0].type)$bind(e.tree[0].value,t,this),e.tree[0].bound=!0;else if("expr"==e.type&&"packed"==e.tree[0].type){var n=e.tree[0].tree[0];"expr"==n.type&&"id"==n.tree[0].type&&($bind(n.tree[0].value,t,this),n.tree[0].bound=!0)}else("list_or_tuple"==e.type||"expr"==e.type&&"list_or_tuple"==e.tree[0].type)&&("expr"==e.type&&(e=e.tree[0]),e.bind_ids(t))}),this)},$ListOrTupleCtx.prototype.packed_indices=function(){for(var t=[],e=0;e<this.tree.length;e++){var n=this.tree[e];"expr"==n.type&&("packed"==(n=n.tree[0]).type||"call"==n.type&&"packed"==n.func.type)&&t.push(e)}return t},$ListOrTupleCtx.prototype.unpack=function(t){for(var e,n="",r=0;r<this.tree.length;r++)e=t.indexOf(r)>-1?"_b_.list.$factory("+this.tree[r].to_js()+")":"["+this.tree[r].to_js()+"]",r>0&&(e=".concat("+e+")"),n+=e;return n},$ListOrTupleCtx.prototype.to_js=function(){this.js_processed=!0;var t=$get_scope(this),e=(t.id.replace(/\//g,"_"),0),n=(g=$get_module(this)).module;switch(this.real){case"list":return(A=this.packed_indices()).length>0?"$B.$list("+this.unpack(A)+")":"$B.$list(["+$to_js(this.tree)+"])";case"list_comp":case"gen_expr":case"dict_or_set_comp":for(var r=this.get_src(),i=[],s=[],o=new RegExp('"',"g"),a=g.comments,l=1;l<this.intervals.length;l++){for(var c=this.intervals[l-1],u=this.intervals[l],h=r.substring(c,u),p=a.length-1;p>=0;p--){var d=a[p];d[0]>c&&d[0]<u&&(e=d[0]-c,h=h.substr(0,e)+" ".repeat(d[1])+h.substr(e+d[1]+1))}h=h.replace(/\\\n/g," "),s.push(h);var f=h.split("\n"),m=[];f.forEach((function(t){0!=t.replace(/ /g,"").length&&(t=(t=(t=t.replace(/\n/g," ")).replace(/\\/g,"\\\\")).replace(o,'\\"'),m.push('"'+t+'"'))})),i.push("["+m.join(",")+"]")}var _=$get_node(this).line_num;switch(this.real){case"list_comp":var g,y=$B.$list_comp(s),v=y[0],b=y[1],x="lc"+$B.lambda_magic+b,w=$pos,S=_+","+n,M=(g=$B.py2js({src:v,is_comp:!0,line_info:S},n,x,t,1)).outermost_expr;$get_node(this).has_yield&&(M=this.tree[0].tree[0].tree[1]),void 0===M&&(M=g.first_for.tree[1]);var T=M.to_js();$pos=w;var E=g.to_js();return g=null,$B.clear_ns(x),delete $B.$py_src[x],E=`function(expr){${E+="return $locals_"+x+'["x'+b+'"]'}})(${T})`,this.is_await&&(E="async "+E),"("+E;case"dict_or_set_comp":return 1==this.expression.length?$B.$gen_expr(n,t,s,_,!0):$B.$dict_comp(n,t,s,_)}return $B.$gen_expr(n,t,s,_);case"tuple":var A;return(A=this.packed_indices()).length>0?"$B.fast_tuple("+this.unpack(A)+")":1==this.tree.length&&void 0===this.has_comma?this.tree[0].to_js():"$B.fast_tuple(["+$to_js(this.tree)+"])"}};var $NodeCtx=$B.parser.$NodeCtx=function(t){this.node=t,t.C=this,this.tree=[],this.type="node";for(var e=null,n=t;n.parent&&"module"!=n.parent.type;){var r=!1;switch(n.parent.C.tree[0].type){case"def":case"class":case"generator":e=n.parent,r=!0}if(r)break;n=n.parent}null===e&&(e=n.parent||n),this.node.locals=clone(e.binding),this.scope=e};$NodeCtx.prototype.toString=function(){return"node "+this.tree},$NodeCtx.prototype.transition=function(t,e){var n=this;switch(t){case"id":case"imaginary":case"int":case"float":case"str":case"bytes":case"[":case"(":case"{":case"not":case"lambda":case".":var r=new $AbstractExprCtx(n,!0);return $transition(r,t,e);case"op":switch(e){case"*":case"+":case"-":case"~":return r=new $AbstractExprCtx(n,!0),$transition(r,t,e)}break;case"async":return new $AsyncCtx(n);case"await":return new $AbstractExprCtx(new $AwaitCtx(n),!0);case"class":return new $ClassCtx(n);case"continue":return new $ContinueCtx(n);case"__debugger__":return new $DebuggerCtx(n);case"break":return new $BreakCtx(n);case"def":return new $DefCtx(n);case"for":return new $TargetListCtx(new $ForExpr(n));case"if":case"while":return new $AbstractExprCtx(new $ConditionCtx(n,t),!1);case"elif":var i=$previous(n);return-1!=["condition"].indexOf(i.type)&&"while"!=i.token||$_SyntaxError(n,"elif after "+i.type),new $AbstractExprCtx(new $ConditionCtx(n,t),!1);case"else":return i=$previous(n),-1==["condition","except","for"].indexOf(i.type)&&$_SyntaxError(n,"else after "+i.type),new $SingleKwCtx(n,t);case"finally":return i=$previous(n),-1!=["try","except"].indexOf(i.type)||"single_kw"==i.type&&"else"==i.token||$_SyntaxError(n,"finally after "+i.type),new $SingleKwCtx(n,t);case"try":return new $TryCtx(n);case"except":return i=$previous(n),-1==["try","except"].indexOf(i.type)&&$_SyntaxError(n,"except after "+i.type),new $ExceptCtx(n);case"assert":return new $AbstractExprCtx(new $AssertCtx(n),!1,!0);case"from":return new $FromCtx(n);case"import":return new $ImportCtx(n);case"global":return new $GlobalCtx(n);case"nonlocal":return new $NonlocalCtx(n);case"lambda":return new $LambdaCtx(n);case"pass":return new $PassCtx(n);case"raise":return new $AbstractExprCtx(new $RaiseCtx(n),!0);case"return":return new $AbstractExprCtx(new $ReturnCtx(n),!0);case"with":return new $AbstractExprCtx(new $WithCtx(n),!1);case"yield":return new $AbstractExprCtx(new $YieldCtx(n),!0);case"del":return new $AbstractExprCtx(new $DelCtx(n),!0);case"@":return new $DecoratorCtx(n);case",":n.tree&&0==n.tree.length&&$_SyntaxError(n,"token "+t+" after "+n);var s=n.tree[0];n.tree=[];var o=new $ListOrTupleCtx(n);return o.real="tuple",o.implicit=0,o.tree.push(s),s.parent=o,o;case"eol":return 0==n.tree.length?(n.node.parent.children.pop(),n.node.parent.C):n}$_SyntaxError(n,"token "+t+" after "+n)},$NodeCtx.prototype.to_js=function(){if(void 0!==this.js)return this.js;if(this.js_processed=!0,this.tree.length>1){var t=new $Node;new $NodeCtx(t).tree=[this.tree[1]],t.indent=node.indent+4,this.tree.pop(),node.add(t)}if(this.js="",this.tree[0]){var e="def"!=this.scope.ntype;if(this.tree[0].annotation)if(e){if("expr"==this.tree[0].type&&!this.tree[0].$in_parens&&"id"==this.tree[0].tree[0].type){var n="";return this.create_annotations&&(n+="$locals.__annotations__ = $B.empty_dict();"),n+"_b_.dict.$setitem($locals.__annotations__, '"+this.tree[0].tree[0].value+"', "+this.tree[0].annotation.to_js()+");"}"def"==this.tree[0].type?this.js=this.tree[0].annotation.to_js()+";":(this.js="",this.tree=[])}else"def"!=this.tree[0].type&&(this.tree=[]);else if("assign"==this.tree[0].type&&!this.tree[0].tree[0].$in_parens&&this.tree[0].tree[0].annotation){var r=this.tree[0].tree[0],i=this.tree[0].tree[1];if(this.create_annotations&&(this.js+="$locals.__annotations__ = $B.empty_dict();"),this.js+="var $value = "+i.to_js()+";",this.tree[0].tree.splice(1,1),new $RawJSCtx(this.tree[0],"$value"),!r.tree[0]||"id"!=r.tree[0].type||!e)return this.js+=$to_js(this.tree)+";",e&&(this.js+=r.annotation.to_js()),this.js;this.js+="_b_.dict.$setitem($locals.__annotations__, '"+r.tree[0].value+"', "+r.annotation.to_js()+");"}}return 0==this.node.children.length?this.js+=$to_js(this.tree)+";":this.js+=$to_js(this.tree),this.js};var $NodeJS=$B.parser.$NodeJS=function(t){var e=new $Node;return new $NodeJSCtx(e,t),e},$NodeJSCtx=$B.parser.$NodeJSCtx=function(t,e){this.node=t,t.C=this,this.type="node_js",this.tree=[e]};$NodeJSCtx.prototype.toString=function(){return"js "+js},$NodeJSCtx.prototype.to_js=function(){return this.js_processed=!0,this.tree[0]};var $NonlocalCtx=$B.parser.$NonlocalCtx=function(t){this.type="nonlocal",this.parent=t,this.tree=[],this.names={},t.tree[t.tree.length]=this,this.expect="id",this.scope=$get_scope(this),this.scope.nonlocals=this.scope.nonlocals||{},void 0===this.scope.C&&$_SyntaxError(t,["nonlocal declaration not allowed at module level"])};$NonlocalCtx.prototype.toString=function(){return"nonlocal "+this.tree},$NonlocalCtx.prototype.add=function(t){"arg"==this.scope.binding[t]&&$_SyntaxError(C,["name '"+t+"' is parameter and nonlocal"]),this.names[t]=[!1,$pos],this.scope.nonlocals[t]=!0},$NonlocalCtx.prototype.transition=function(t,e){var n=this;switch(t){case"id":if("id"==n.expect)return new $IdCtx(n,e),n.add(e),n.expect=",",n;break;case",":if(","==n.expect)return n.expect="id",n;break;case"eol":if(","==n.expect)return $transition(n.parent,t)}$_SyntaxError(n,"token "+t+" after "+n)},$NonlocalCtx.prototype.transform=function(t,e){var n=this.parent,r=this.scope.parent_block;if(void 0===r.C)$_SyntaxError(n,["no binding for nonlocal '"+$B.last(Object.keys(this.names))+"' found"]);else{for(;void 0!==r&&void 0!==r.C;){for(var i in this.names)void 0!==r.binding[i]&&(this.names[i]=[!0]);r=r.parent_block}for(var i in this.names)this.names[i][0]||(console.log("nonlocal error, C "+n),$pos=this.names[i][1],$_SyntaxError(n,["no binding for nonlocal '"+i+"' found"]))}},$NonlocalCtx.prototype.to_js=function(){return this.js_processed=!0,""};var $NotCtx=$B.parser.$NotCtx=function(t){this.type="not",this.parent=t,this.tree=[],t.tree[t.tree.length]=this};$NotCtx.prototype.toString=function(){return"not ("+this.tree+")"},$NotCtx.prototype.transition=function(t,e){var n=this;switch(t){case"in":return n.parent.parent.tree.pop(),new $ExprCtx(new $OpCtx(n.parent,"not_in"),"op",!1);case"id":case"imaginary":case"int":case"float":case"str":case"bytes":case"[":case"(":case"{":case".":case"not":case"lambda":var r=new $AbstractExprCtx(n,!1);return $transition(r,t,e);case"op":if("+"==e||"-"==e||"~"==e)return r=new $AbstractExprCtx(n,!1),$transition(r,t,e)}return $transition(n.parent,t)},$NotCtx.prototype.to_js=function(){return this.js_processed=!0,"!$B.$bool("+$to_js(this.tree)+")"};var $NumberCtx=$B.parser.$NumberCtx=function(t,e,n){this.type=t,this.value=n,this.parent=e,this.tree=[],e.tree[e.tree.length]=this};$NumberCtx.prototype.toString=function(){return this.type+" "+this.value},$NumberCtx.prototype.transition=function(t,e){var n=this;switch(t){case"id":case"imaginary":case"int":case"float":case"str":case"bytes":case"[":case"(":case"{":case"not":case"lambda":$_SyntaxError(n,"token "+t+" after "+n)}return $transition(n.parent,t,e)},$NumberCtx.prototype.to_js=function(){this.js_processed=!0;var type=this.type,value=this.value;if("int"==type){var v=parseInt(value[1],value[0]);if(v>$B.min_int&&v<$B.max_int)return this.unary_op&&(v=eval(this.unary_op+v)),v;var v=$B.long_int.$factory(value[1],value[0]);switch(this.unary_op){case"-":v=$B.long_int.__neg__(v);break;case"~":v=$B.long_int.__invert__(v)}return'{__class__: $B.long_int, value: "'+v.value+'", pos: '+v.pos+"}"}return"float"==type?/^\d+$/.exec(value)||/^\d+\.\d*$/.exec(value)?"(new Number("+this.value+"))":"_b_.float.$factory("+value+")":"imaginary"==type?"$B.make_complex(0,"+value+")":void 0};var $OpCtx=$B.parser.$OpCtx=function(t,e){if(this.type="op",this.op=e,this.parent=t.parent,this.tree=[t],this.scope=$get_scope(this),"expr"==t.type)if(["int","float","str"].indexOf(t.tree[0].type)>-1)this.left_type=t.tree[0].type;else if("id"==t.tree[0].type){var n=this.scope.binding[t.tree[0].value];n&&(this.left_type=n.type)}t.parent.tree.pop(),t.parent.tree.push(this)};$OpCtx.prototype.toString=function(){return"(op "+this.op+") ["+this.tree+"]"},$OpCtx.prototype.transition=function(t,e){var n=this;if(void 0===n.op&&$_SyntaxError(n,["C op undefined "+n]),"unary"==n.op.substr(0,5)){if("eol"!=t&&("assign"==n.parent.type||"return"==n.parent.type)){n.parent.tree.pop();var r=new $ListOrTupleCtx(n.parent,"tuple");return r.tree.push(n),n.parent=r,r}2==n.tree.length&&"expr"==n.tree[1].type&&"int"==n.tree[1].tree[0].type&&(n.parent.tree.pop(),n.parent.tree.push(n.tree[1]),n.tree[1].parent=n.parent,n.tree[1].tree[0].unary_op=n.tree[0].op)}switch(t){case"id":case"imaginary":case"int":case"float":case"str":case"bytes":case"[":case"(":case"{":case".":case"not":case"lambda":return $transition(new $AbstractExprCtx(n,!1),t,e);case"op":switch(e){case"+":case"-":case"~":return new $UnaryCtx(n,e)}default:"abstract_expr"==n.tree[n.tree.length-1].type&&$_SyntaxError(n,"token "+t+" after "+n)}return $transition(n.parent,t)},$OpCtx.prototype.to_js=function(){this.js_processed=!0;var t={"==":"eq","!=":"ne",">=":"ge","<=":"le","<":"lt",">":"gt"};if(void 0!==t[this.op]){var e=t[this.op];if("expr"==this.tree[0].type&&"expr"==this.tree[1].type){var n=this.tree[0].tree[0],r=this.tree[1].tree[0],i=n.to_js(),s=r.to_js();switch(r.type){case"int":switch(n.type){case"int":return Number.isSafeInteger(n.value)&&Number.isSafeInteger(r.value)?i+this.op+s:"$B.$getattr("+this.tree[0].to_js()+',"__'+e+'__")('+this.tree[1].to_js()+")";case"str":switch(this.op){case"==":return"false";case"!=":return"true";default:return'$B.$TypeError("unorderable types:  int() '+this.op+' str()")'}case"id":return"(typeof "+i+' == "number" ? '+i+this.op+s+' : $B.rich_comp("__'+e+'__",'+this.tree[0].to_js()+","+this.tree[1].to_js()+"))"}break;case"str":switch(n.type){case"str":return i+this.op+s;case"int":switch(this.op){case"==":return"false";case"!=":return"true";default:return'$B.$TypeError("unorderable types:  str() '+this.op+' int()")'}case"id":return"(typeof "+i+' == "string" ? '+i+this.op+s+' : $B.rich_comp("__'+e+'__",'+this.tree[0].to_js()+","+this.tree[1].to_js()+"))"}break;case"id":if("id"==n.type)return"typeof "+i+'!="object" && typeof '+i+'!="function" && typeof '+i+" == typeof "+s+" ? "+i+this.op+s+' : $B.rich_comp("__'+e+'__",'+this.tree[0].to_js()+","+this.tree[1].to_js()+")"}}}switch(this.op){case"and":var o=this.tree[0].to_js(),a=this.tree[1].to_js();return void 0!==this.wrap?"(function(){var "+this.wrap.name+" = "+this.wrap.js+";return $B.$test_expr($B.$test_item("+o+") && $B.$test_item("+a+"))})()":"$B.$test_expr($B.$test_item("+o+")&&$B.$test_item("+a+"))";case"or":return(b="$B.$test_expr($B.$test_item("+this.tree[0].to_js()+")||")+"$B.$test_item("+this.tree[1].to_js()+"))";case"in":return"$B.$is_member("+$to_js(this.tree)+")";case"not_in":return"!$B.$is_member("+$to_js(this.tree)+")";case"unary_neg":case"unary_pos":case"unary_inv":if("unary_neg"==this.op?(u="-",e="__neg__"):"unary_pos"==this.op?(u="+",e="__pos__"):(u="~",e="__invert__"),"expr"==this.tree[1].type){var l=this.tree[1].tree[0];switch(l.type){case"int":var c=parseInt(l.value[1],l.value[0]);return Number.isSafeInteger(c)?u+c:"$B.$getattr("+l.to_js()+', "'+e+'")()';case"float":return"_b_.float.$factory("+u+l.value+")";case"imaginary":return"$B.make_complex(0,"+u+l.value+")"}}return"$B.$getattr("+this.tree[1].to_js()+',"'+e+'")()';case"is":return"$B.$is("+this.tree[0].to_js()+", "+this.tree[1].to_js()+")";case"is_not":return this.tree[0].to_js()+"!=="+this.tree[1].to_js();case"+":return"$B.add("+this.tree[0].to_js()+", "+this.tree[1].to_js()+")";case"*":case"-":var u=this.op,h=[],p=!1,d=$get_scope(this);function f(t,e){var n;return["int","float","str"].indexOf(e.type)>-1?n=e.type:"id"==e.type&&t[e.value]&&(n=t[e.value].type),n}var m=this.tree[0],_=this.tree[1];if(function t(e){if("expr"==e.type&&"int"==e.tree[0].type)return!0;if("expr"==e.type&&"float"==e.tree[0].type)return p=!0,!0;if("expr"==e.type&&"list_or_tuple"==e.tree[0].type&&"tuple"==e.tree[0].real&&1==e.tree[0].tree.length&&"expr"==e.tree[0].tree[0].type)return t(e.tree[0].tree[0].tree[0]);if("expr"==e.type&&"id"==e.tree[0].type){var n=e.tree[0].to_js();return-1==h.indexOf(n)&&h.push(n),!0}if("op"==e.type&&["*","+","-"].indexOf(e.op)>-1){for(var r=0;r<e.tree.length;r++)if(!t(e.tree[r]))return!1;return!0}return!1}(this)){var g=this.tree[0].tree[0],y=this.tree[1].tree[0];if(0!=h.length||p){if(0==h.length)return"new Number("+this.simple_js()+")";var v=d.binding;if(n=f(v,g),r=f(v,y),"float"==n&&"float"==r||"+"==this.op&&"str"==n&&"str"==r)return this.result_type=n,g.to_js()+this.op+y.to_js();if(["int","float"].indexOf(n)>-1&&["int","float"].indexOf(r)>-1)switch(this.result_type="int"==n&&"int"==r?"int":"float",this.op){case"-":return"$B.sub("+g.to_js()+","+y.to_js()+")";case"*":return"$B.mul("+g.to_js()+","+y.to_js()+")"}var b,x=[],w=[];return h.forEach((function(t){x.push("typeof "+t+'.valueOf() == "number"'),w.push("typeof "+t+' == "number"')})),(b=[x.join(" && ")+" ? "]).push("("+w.join(" && ")+" ? "),b.push(this.simple_js()),b.push(" : new Number("+this.simple_js()+")"),b.push(")"),n=this.tree[0].to_js(),r=this.tree[1].to_js(),"+"==this.op&&b.push(" : (typeof "+n+' == "string" && typeof '+r+' == "string") ? '+n+"+"+r),b.push(': $B.rich_op("'+$operators[this.op]+'",'+n+","+r+")"),"("+b.join("")+")"}return this.simple_js()}return void 0!==t[this.op]?'$B.rich_comp("__'+$operators[this.op]+'__",'+m.to_js()+","+_.to_js()+")":'$B.rich_op("'+$operators[this.op]+'", '+m.to_js()+", "+_.to_js()+")";default:return void 0!==t[this.op]?'$B.rich_comp("__'+$operators[this.op]+'__",'+this.tree[0].to_js()+","+this.tree[1].to_js()+")":'$B.rich_op("'+$operators[this.op]+'", '+this.tree[0].to_js()+", "+this.tree[1].to_js()+")"}},$OpCtx.prototype.simple_js=function(){var t=this.op;function e(t){return"op"==t.type?t.simple_js():"expr"==t.type&&"list_or_tuple"==t.tree[0].type&&"tuple"==t.tree[0].real&&1==t.tree[0].tree.length&&"expr"==t.tree[0].tree[0].type?"("+t.tree[0].tree[0].tree[0].simple_js()+")":t.tree[0].to_js()}return"+"==t?"$B.add("+e(this.tree[0])+","+e(this.tree[1])+")":"-"==t?"$B.sub("+e(this.tree[0])+","+e(this.tree[1])+")":"*"==t?"$B.mul("+e(this.tree[0])+","+e(this.tree[1])+")":"/"==t?"$B.div("+e(this.tree[0])+","+e(this.tree[1])+")":e(this.tree[0])+t+e(this.tree[1])};var $PackedCtx=$B.parser.$PackedCtx=function(t){if(this.type="packed","list_or_tuple"==t.parent.type&&"node"==t.parent.parent.type)for(var e=0;e<t.parent.tree.length;e++){var n=t.parent.tree[e];"expr"==n.type&&n.tree.length>0&&"packed"==n.tree[0].type&&$_SyntaxError(t,["two starred expressions in assignment"])}this.parent=t,this.tree=[],t.tree[t.tree.length]=this};$PackedCtx.prototype.toString=function(){return"(packed) "+this.tree},$PackedCtx.prototype.transition=function(t,e){var n=this;if(n.tree.length>0&&"["==t)return $transition(n.tree[0],t,e);if("id"==t){var r=new $AbstractExprCtx(n,!1);return r.packed=!0,n.parent.expect=",",$transition(r,t,e)}return"["==t?(n.parent.expect=",",new $ListOrTupleCtx(n,"list")):"("==t?(n.parent.expect=",",new $ListOrTupleCtx(n,"tuple")):"]"==t?$transition(n.parent,t,e):"{"==t?(n.parent.expect=",",new $DictOrSetCtx(n)):n.parent.transition(t,n)},$PackedCtx.prototype.to_js=function(){return this.js_processed=!0,$to_js(this.tree)};var $PassCtx=$B.parser.$PassCtx=function(t){this.type="pass",this.parent=t,this.tree=[],t.tree[t.tree.length]=this};$PassCtx.prototype.toString=function(){return"(pass)"},$PassCtx.prototype.transition=function(t,e){var n=this;if("eol"==t)return n.parent;$_SyntaxError(n,"token "+t+" after "+n)},$PassCtx.prototype.to_js=function(){return this.js_processed=!0,"void(0)"};var $RaiseCtx=$B.parser.$RaiseCtx=function(t){this.type="raise",this.parent=t,this.tree=[],t.tree[t.tree.length]=this,this.scope_type=$get_scope(this).ntype};$RaiseCtx.prototype.toString=function(){return" (raise) "+this.tree},$RaiseCtx.prototype.transition=function(t,e){var n=this;switch(t){case"id":if(0==n.tree.length)return new $IdCtx(new $ExprCtx(n,"exc",!1),e);break;case"from":if(n.tree.length>0)return new $AbstractExprCtx(n,!1);break;case"eol":return $transition(n.parent,t)}$_SyntaxError(n,"token "+t+" after "+n)},$RaiseCtx.prototype.to_js=function(){return this.js_processed=!0,"$B.$raise("+(0==this.tree.length?"":this.tree[0].to_js())+")"};var $RawJSCtx=$B.parser.$RawJSCtx=function(t,e){this.type="raw_js",t.tree[t.tree.length]=this,this.parent=t,this.js=e};$RawJSCtx.prototype.toString=function(){return"(js) "+this.js},$RawJSCtx.prototype.transition=function(t,e){},$RawJSCtx.prototype.to_js=function(){return this.js_processed=!0,this.js};var $ReturnCtx=$B.parser.$ReturnCtx=function(t){this.type="return",this.parent=t,this.tree=[],t.tree[t.tree.length]=this,this.scope=$get_scope(this),-1==["def","generator"].indexOf(this.scope.ntype)&&$_SyntaxError(t,["'return' outside function"]);for(var e=this.node=$get_node(this);e.parent;){if(e.parent.C){var n=e.parent.C.tree[0];if("for"==n.type){n.has_return=!0;break}("try"==n.type||"single_kw"==n.type&&"finally"==n.token)&&(n.has_return=!0)}e=e.parent}};$ReturnCtx.prototype.toString=function(){return"return "+this.tree},$ReturnCtx.prototype.transition=function(t,e){return $transition(this.parent,t)},$ReturnCtx.prototype.to_js=function(){this.js_processed=!0,1==this.tree.length&&"abstract_expr"==this.tree[0].type&&(this.tree.pop(),new $IdCtx(new $ExprCtx(this,"rvalue",!1),"None"));var t=this.scope;if("generator"==t.ntype)return"var $res = "+$to_js(this.tree)+"; $B.leave_frame({$locals});return $B.generator_return($res)";var e="    ".repeat(this.node.indent-1),n="var $res = "+$to_js(this.tree)+";\n"+e+"if($locals.$f_trace !== _b_.None){$B.trace_return($res)}\n"+e+"$B.leave_frame";return"$exec_"==t.id.substr(0,6)&&(n+="_exec"),n+"({$locals});\n"+e+"return $res"};var $SingleKwCtx=$B.parser.$SingleKwCtx=function(t,e){if(this.type="single_kw",this.token=e,this.parent=t,this.tree=[],t.tree[t.tree.length]=this,"else"==e){for(var n=t.node,r=n.parent,i=0;i<r.children.length&&r.children[i]!==n;i++);var s=r.children[i-1].C;if(s.tree.length>0){var o=s.tree[0];("for"==o.type||"asyncfor"==o.type||"condition"==o.type&&"while"==o.token)&&(o.has_break=!0,o.else_node=$get_node(this),this.loop_num=o.loop_num)}}};$SingleKwCtx.prototype.toString=function(){return this.token},$SingleKwCtx.prototype.transition=function(t,e){var n=this;if(":"==t)return $BodyCtx(n);$_SyntaxError(n,"token "+t+" after "+n)},$SingleKwCtx.prototype.transform=function(t,e){if("finally"==this.token){var n=$get_scope(this);t.insert(0,$NodeJS("var $exit;if($B.frames_stack.length < $stack_length){$exit = true;$B.frames_stack.push($top_frame)}")),n.id.replace(/\./g,"_"),"return"!=t.children[t.children.length-1].C.tree[0].type&&t.add($NodeJS("if($exit){$B.leave_frame({$locals})}"))}},$SingleKwCtx.prototype.to_js=function(){return this.js_processed=!0,"finally"==this.token?this.token:void 0!==this.loop_num?"if($locals_"+$get_scope(this).id.replace(/\./g,"_")+'["$no_break'+this.loop_num+'"])':this.token};var $SliceCtx=$B.parser.$SliceCtx=function(t){this.type="slice",this.parent=t,this.tree=t.tree.length>0?[t.tree.pop()]:[],t.tree.push(this)};$SliceCtx.prototype.transition=function(t,e){return":"==t?new $AbstractExprCtx(this,!1):$transition(this.parent,t,e)},$SliceCtx.prototype.to_js=function(){for(var t=0;t<this.tree.length;t++)"abstract_expr"==this.tree[t].type&&(this.tree[t].to_js=function(){return"_b_.None"});return"_b_.slice.$factory("+$to_js(this.tree)+")"};var $StarArgCtx=$B.parser.$StarArgCtx=function(t){this.type="star_arg",this.parent=t,this.tree=[],t.tree[t.tree.length]=this};$StarArgCtx.prototype.toString=function(){return"(star arg) "+this.tree},$StarArgCtx.prototype.transition=function(t,e){var n=this;switch(t){case"id":return"target_list"==n.parent.type?(n.tree.push(e),n.parent.expect=",",n.parent):$transition(new $AbstractExprCtx(n,!1),t,e);case"imaginary":case"int":case"float":case"str":case"bytes":case"[":case"(":case"{":case"not":case"lambda":return $transition(new $AbstractExprCtx(n,!1),t,e);case",":case")":return 0==n.tree.length&&$_SyntaxError(n,"unnamed star argument"),$transition(n.parent,t);case":":if("lambda"==n.parent.parent.type)return $transition(n.parent.parent,t)}$_SyntaxError(n,"token "+t+" after "+n)},$StarArgCtx.prototype.to_js=function(){return this.js_processed=!0,'{$nat:"ptuple",arg:'+$to_js(this.tree)+"}"};var $StringCtx=$B.parser.$StringCtx=function(t,e){this.type="str",this.parent=t,this.tree=[e],t.tree[t.tree.length]=this,this.raw=!1};$StringCtx.prototype.toString=function(){return"string "+(this.tree||"")},$StringCtx.prototype.transition=function(t,e){var n=this;switch(t){case"[":return new $AbstractExprCtx(new $SubCtx(n.parent),!1);case"(":return n.parent.tree[0]=n,new $CallCtx(n.parent);case"str":return n.tree.push(e),n}return $transition(n.parent,t,e)},$StringCtx.prototype.to_js=function(){this.js_processed=!0;var t="",e=null,n=$get_scope(this),r=!1;function i(t){for(var e=0;e<t.length;e++){try{code=t.charCodeAt(e)}catch(e){throw console.log("err for s",t),e}if(code>=55296&&code<=56319)return!0}return!1}function s(t){for(var e=[],o=0;o<t.length;o++)if("expression"==t[o].type){for(var a=t[o].expression,l=0,c=[],u=[a];l<a.length;){var h=a.charAt(l);if(":"==h&&0==c.length){u=[a.substr(0,l),a.substr(l+1)];break}"{[(".indexOf(h)>-1?c.push(h):")]}".indexOf(h)>-1&&c.pop(),l++}a=u[0];var p=$pos,d=$B.py2js(a,n.module,n.id,n);d.to_js(),$pos=p;for(var f=0;f<d.children.length;f++){var m=d.children[f];if(m.C.tree&&1==m.C.tree.length&&"try"==m.C.tree[0]){for(var _=0;_<m.children.length;_++)if(!m.children[_].is_line_num){for(var g=m.children[_].js;"\n;".indexOf(g.charAt(g.length-1))>-1;)g=g.substr(0,g.length-1);break}break}}switch(t[o].conversion){case"a":g="_b_.ascii("+g+")";break;case"r":g="_b_.repr("+g+")";break;case"s":g="_b_.str.$factory("+g+")"}var y=u[1];if(void 0!==y){var v=$B.parse_fstring(y),b="_b_.str.format('{0:' + "+(y=v.length>1?s(v):"'"+y+"'")+" + '}', "+g+")";e.push(b)}else null===t[o].conversion&&(g="_b_.str.$factory("+g+")"),e.push(g)}else{var x=new RegExp("'","g"),w=t[o].replace(x,"\\'").replace(/\n/g,"\\n");r=r||i(w),e.push("'"+w+"'")}return e.join(" + ")}function o(t){return(t=t.replace(/\n/g,"\\n\\\n")).replace(/\\U([A-Fa-f0-9]{8})/gm,(function(t){return String.fromCharCode("0x"+t.slice(2))}))}for(var a=0;a<this.tree.length;a++){if("call"==this.tree[a].type)return"(function(){throw _b_.TypeError.$factory(\"'str' object is not callable\")}())";var l=this.tree[a],c=Array.isArray(l),u=!1;if(c||(u="b"==l.charAt(0)),null==e)e=u,u&&(t+="_b_.bytes.$new(_b_.bytes, ");else if(e!=u)return'$B.$TypeError("can\'t concat bytes to str")';u?t+=o(l.substr(1)):c?t+=s(l):(r=r||i(l),t+=o(l)),a<this.tree.length-1&&(t+="+")}return u&&(t+=',"ISO-8859-1")'),0==t.length&&(t='""'),r&&(t="_b_.str.$surrogate.$factory("+t+")"),t};var $SubCtx=$B.parser.$SubCtx=function(t){this.type="sub",this.func="getitem",this.value=t.tree[0],t.tree.pop(),t.tree[t.tree.length]=this,this.parent=t,this.tree=[]};$SubCtx.prototype.toString=function(){return"(sub) (value) "+this.value+" (tree) "+this.tree},$SubCtx.prototype.transition=function(t,e){var n=this;switch(t){case"id":case"imaginary":case"int":case"float":case"str":case"bytes":case"[":case"(":case"{":case".":case"not":case"lambda":var r=new $AbstractExprCtx(n,!1);return $transition(r,t,e);case"]":if(n.parent.packed)return n.parent.tree[0];if(n.tree[0].tree.length>0)return n.parent;break;case":":return new $AbstractExprCtx(new $SliceCtx(n),!1);case",":return new $AbstractExprCtx(n,!1)}$_SyntaxError(n,"token "+t+" after "+n)},$SubCtx.prototype.to_js=function(){if(this.js_processed=!0,"getitem"==this.func&&"id"==this.value.type){var t=$get_node(this).locals[this.value.value],e=this.value.to_js();if("list"==t||"tuple"==t){if(1==this.tree.length)return"$B.list_key("+e+", "+this.tree[0].to_js()+")";if(2==this.tree.length)return"$B.list_slice("+e+", "+(this.tree[0].to_js()||"null")+","+(this.tree[1].to_js()||"null")+")";if(3==this.tree.length)return"$B.list_slice_step("+e+", "+(this.tree[0].to_js()||"null")+","+(this.tree[1].to_js()||"null")+","+(this.tree[2].to_js()||"null")+")"}}if("getitem"==this.func&&1==this.tree.length)return"slice"==this.tree[0].type?`$B.getitem_slice(${this.value.to_js()},${this.tree[0].to_js()})`:"$B.$getitem("+this.value.to_js()+","+this.tree[0].to_js()+")";var n="",r=!1;if("delitem"!==this.func&&1==this.tree.length&&!this.in_sub){var i="",s=this;for(r=!0;"sub"==s.value.type;)i+="["+s.tree[0].to_js()+"]",s.value.in_sub=!0,s=s.value;var o=s.value.to_js()+"["+s.tree[0].to_js()+"]((Array.isArray("+s.value.to_js()+") || typeof "+s.value.to_js()+' == "string") && '+o+" !== undefined ?"+o+i+" : "}if(n+="$B.$getattr("+(e=this.value.to_js())+',"__'+this.func+'__")(',1==this.tree.length)n+=this.tree[0].to_js()+")";else{var a=[];this.tree.forEach((function(t){"abstract_expr"==t.type?a.push("_b_.None"):a.push(t.to_js())})),n+="_b_.tuple.$factory(["+a.join(",")+"]))"}return r?n+")":n};var $TargetListCtx=$B.parser.$TargetListCtx=function(t){this.type="target_list",this.parent=t,this.tree=[],this.expect="id",t.tree[t.tree.length]=this};$TargetListCtx.prototype.toString=function(){return"(target list) "+this.tree},$TargetListCtx.prototype.transition=function(t,e){var n=this;switch(t){case"id":if("id"==n.expect)return n.expect=",",new $IdCtx(new $ExprCtx(n,"target",!1),e);case"op":if("id"==n.expect&&"*"==e)return new $PackedCtx(n);case"(":case"[":if("id"==n.expect)return n.expect=",",new $ListOrTupleCtx(n,"("==t?"tuple":"list");case")":case"]":if(","==n.expect)return n.parent;case",":if(","==n.expect)return n.expect="id",n}return","==n.expect||"in"==t?$transition(n.parent,t,e):void $_SyntaxError(n,"token "+t+" after "+n)},$TargetListCtx.prototype.to_js=function(){return this.js_processed=!0,$to_js(this.tree)};var $TernaryCtx=$B.parser.$TernaryCtx=function(t){this.type="ternary",this.parent=t.parent,t.parent.tree.pop(),t.parent.tree.push(this),t.parent=this,this.tree=[t]};$TernaryCtx.prototype.toString=function(){return"(ternary) "+this.tree},$TernaryCtx.prototype.transition=function(t,e){var n=this;if("else"==t)return n.in_else=!0,new $AbstractExprCtx(n,!1);if(n.in_else){if(","==t&&["assign","augm_assign","node","return"].indexOf(n.parent.type)>-1){n.parent.tree.pop();var r=new $ListOrTupleCtx(n.parent,"tuple");return r.implicit=!0,r.tree[0]=n,n.parent=r,r.expect="id",r}}else $_SyntaxError(n,"token "+t+" after "+n);return $transition(n.parent,t,e)},$TernaryCtx.prototype.to_js=function(){this.js_processed=!0;var t="$B.$bool("+this.tree[1].to_js()+") ? ";return(t+=this.tree[0].to_js()+" : ")+this.tree[2].to_js()};var $TryCtx=$B.parser.$TryCtx=function(t){this.type="try",this.parent=t,t.tree[t.tree.length]=this};$TryCtx.prototype.toString=function(){return"(try) "},$TryCtx.prototype.transition=function(t,e){var n=this;if(":"==t)return $BodyCtx(n);$_SyntaxError(n,"token "+t+" after "+n)},$TryCtx.prototype.transform=function(t,e){if(t.parent.children.length==e+1)$_SyntaxError(C,["unexpected EOF while parsing"]);else switch(t.parent.children[e+1].C.tree[0].type){case"except":case"finally":case"single_kw":break;default:$_SyntaxError(C,"no clause after try")}var n=$get_scope(this),r=create_temp_name("$err"),i="$locals."+create_temp_name("$failed"),s=i+" = false;\n"+" ".repeat(t.indent+4)+"try";new $NodeJSCtx(t,s),t.has_return=this.has_return;var o=$NodeJS("catch("+r+")");t.parent.insert(e+1,o),o.add($NodeJS("$B.set_exc("+r+")")),o.add($NodeJS("if($locals.$f_trace !== _b_.None){$locals.$f_trace = $B.trace_exception()}")),o.add($NodeJS(i+" = true;$B.pmframe = $B.last($B.frames_stack);if(false){}"));for(var a=e+2,l=!1,c=!1,u=!1;a!=t.parent.children.length&&void 0!==(m=t.parent.children[a].C.tree[0]);)if("except"==m.type){if(c&&$_SyntaxError(C,"'except' or 'finally' after 'else'"),u&&$_SyntaxError(C,"'except' after 'finally'"),m.error_name=r,m.tree.length>0&&null!==m.tree[0].alias&&void 0!==m.tree[0].alias){var h=m.tree[0].alias;t.parent.children[a].insert(0,$NodeJS('$locals["'+h+'"] = $B.exception('+r+")"))}o.insert(o.children.length,t.parent.children[a]),0==m.tree.length&&(l&&$_SyntaxError(C,"more than one except: line"),l=!0),t.parent.children.splice(a,1)}else if("single_kw"==m.type&&"finally"==m.token){u=!0;var p=t.parent.children[a];a++}else{if("single_kw"!=m.type||"else"!=m.token)break;c&&$_SyntaxError(C,"more than one 'else'"),u&&$_SyntaxError(C,"'else' after 'finally'"),c=!0;var d=t.parent.children[a];t.parent.children.splice(a,1)}if(!l){var f=new $Node,m=new $NodeCtx(f);o.insert(o.children.length,f),new $SingleKwCtx(m,"else"),f.add($NodeJS("throw "+r))}if(c){var _=new $Node;_.module=n.module,new $NodeJSCtx(_,"if(!"+i+")"),d.children.forEach((function(t){_.add(t)})),u?p.insert(0,_):t.parent.insert(a,_),a++}$loop_num++},$TryCtx.prototype.to_js=function(){return this.js_processed=!0,"try"};var $UnaryCtx=$B.parser.$UnaryCtx=function(t,e){this.type="unary",this.op=e,this.parent=t,t.tree[t.tree.length]=this};$UnaryCtx.prototype.toString=function(){return"(unary) "+this.op},$UnaryCtx.prototype.transition=function(t,e){var n=this;switch(t){case"int":case"float":case"imaginary":var r=n.parent;return n.parent.parent.tree.pop(),"-"==n.op?e="-"+e:"~"==n.op&&(e=~e),$transition(n.parent.parent,t,e);case"id":n.parent.parent.tree.pop(),r=new $ExprCtx(n.parent.parent,"call",!1);var i=new $ExprCtx(r,"id",!1);new $IdCtx(i,e);var s=new $AttrCtx(r);return"+"==n.op?s.name="__pos__":"-"==n.op?s.name="__neg__":s.name="__invert__",i;case"op":if("+"==e||"-"==e)return n.op===e?n.op="+":n.op="-",n}return $transition(n.parent,t,e)},this.to_js=function(){return this.js_processed=!0,this.op};var $WithCtx=$B.parser.$WithCtx=function(t){this.type="with",this.parent=t,t.tree[t.tree.length]=this,this.tree=[],this.expect="as",this.scope=$get_scope(this)};$WithCtx.prototype.toString=function(){return"(with) "+this.tree},$WithCtx.prototype.transition=function(t,e){var n=this;switch(t){case"id":if("id"==n.expect)return n.expect="as",$transition(new $AbstractExprCtx(n,!1),t,e);$_SyntaxError(n,"token "+t+" after "+n);case"as":return new $AbstractExprCtx(new $AliasCtx(n));case":":switch(n.expect){case"id":case"as":case":":return $BodyCtx(n)}break;case"(":if("id"==n.expect&&0==n.tree.length)return n.parenth=!0,n;if("alias"==n.expect)return n.expect=":",new $TargetListCtx(n,!1);break;case")":if(","==n.expect||"as"==n.expect)return n.expect=":",n;break;case",":if(void 0!==n.parenth&&void 0===n.has_alias&&(","==n.expect||"as"==n.expect))return n.expect="id",n;if("as"==n.expect)return n.expect="id",n;if(":"==n.expect)return n.expect="id",n}$_SyntaxError(n,"token "+t+" after "+n.expect)},$WithCtx.prototype.set_alias=function(t){var e=[];"id"==t.type?e=[t]:"list_or_tuple"==t.type&&t.tree.forEach((function(t){"expr"==t.type&&"id"==t.tree[0].type&&e.push(t.tree[0])}));for(var n=0,r=e.length;n<r;n++){var i=e[n];$bind(i.value,this.scope,this),i.bound=!0,"module"!==this.scope.ntype&&this.scope.C.tree[0].locals.push(i.value)}},$WithCtx.prototype.transform=function(t,e){for(;this.tree.length>1;){var n=t.children,r=this.tree.pop(),i=new $Node,s=new $NodeCtx(i),o=new $WithCtx(s);r.parent=o,o.tree=[r],o.async=this.async,n.forEach((function(t){i.add(t)})),t.children=[i]}if(!this.transformed){if(this.prefix="",this.tree.length>1){var a=new $Node;s=new $NodeCtx(a),a.parent=t,a.module=t.module,a.indent=t.indent+4;var l=new $WithCtx(s);return l.async=this.async,l.tree=this.tree.slice(1),t.children.forEach((function(t){a.add(t)})),t.children=[a],void(this.transformed=!0)}if(this.async)return this.transform_async(t,e);var c=$NodeJS("try");t.parent.insert(e+1,c);var u=this.num=$loop_num++;if(c.ctx_manager_num=u,this.cm_name=this.prefix+"$ctx_manager"+u,this.cmexit_name=this.prefix+"$ctx_manager_exit"+u,this.exc_name=this.prefix+"$exc"+u,this.err_name="$err"+u,this.val_name="$value"+u,this.yield_name=this.prefix+"$yield"+u,null===this.tree[0].alias&&(this.tree[0].alias="$temp"),"expr"==this.tree[0].type&&"list_or_tuple"==this.tree[0].tree[0].type){"expr"==this.tree[1].type&&"list_or_tuple"==this.tree[1].tree[0].type||$_SyntaxError(C),this.tree[0].tree[0].tree.length!=this.tree[1].tree[0].tree.length&&$_SyntaxError(C,["wrong number of alias"]);var h=this.tree[0].tree[0].tree,p=this.tree[1].tree[0].tree;this.tree.shift(),this.tree.shift();for(var d=h.length-1;d>=0;d--)h[d].alias=p[d].value,this.tree.splice(0,0,h[d])}var f=t.children;t.children=[];var m=new $Node;new $NodeJSCtx(m,"try"),c.add(m),this.tree[0].alias&&(p=this.tree[0].alias.tree[0].tree[0].value,m.add($NodeJS('$locals["'+p+'"] = '+this.val_name))),f.forEach((function(t){m.add(t)}));var _=new $Node;new $NodeJSCtx(_,"catch("+this.err_name+")");var g=this.exc_name+" = false;"+this.err_name+" = $B.exception("+this.err_name+", true)\n"+" ".repeat(t.indent+4)+"var $b = "+this.cmexit_name+"("+this.err_name+".__class__,"+this.err_name+",$B.$getattr("+this.err_name+', "__traceback__"));';"generator"==this.scope.ntype&&(g+="$B.set_cm_in_generator("+this.cmexit_name+");"),g+="if(!$B.$bool($b)){throw "+this.err_name+"}",_.add($NodeJS(g)),c.add(_);var y=new $Node;new $NodeJSCtx(y,"finally"),y.C.type="single_kw",y.C.token="finally",y.C.in_ctx_manager=!0,y.is_except=!0,y.in_ctx_manager=!0,g="if("+this.exc_name,g+="){"+this.cmexit_name+"(_b_.None, _b_.None, _b_.None);","generator"==this.scope.ntype&&(g+="delete "+this.cmexit_name),g+="};",y.add($NodeJS(g)),t.parent.insert(e+2,y),this.transformed=!0}},$WithCtx.prototype.transform_async=function(t,e){$get_scope(this);var n=this.tree[0],r=this.tree[0].alias,i=[],s=this.num=$loop_num++;this.cm_name="$ctx_manager"+s,this.cmexit_name="$ctx_manager_exit"+s,this.exc_name="$exc"+s;var o="$ctx_mgr_type"+s,a="$ctx_manager_enter"+s,l="$err"+s,c="var "+this.cm_name+" = "+n.to_js()+",";if(i.push($NodeJS(c)),i.push($NodeJS("    "+o+" = _b_.type.$factory("+this.cm_name+"),")),i.push($NodeJS("    "+this.cmexit_name+" = $B.$call($B.$getattr("+o+', "__aexit__")),')),i.push($NodeJS("    "+a+" = $B.$call($B.$getattr("+o+', "__aenter__"))('+this.cm_name+"),")),i.push($NodeJS("    "+this.exc_name+" = false")),c="",r)if("list_or_tuple"!=r.tree[0].tree[0].type)c=r.tree[0].to_js()+" = await ($B.promise("+a+"))",i.push($NodeJS(c));else{var u=new $Node,h=new $NodeCtx(u);(n=new $ExprCtx(h,"left",!1)).tree.push(r.tree[0].tree[0]),r.tree[0].tree[0].parent=n;var p=new $AssignCtx(n);new $RawJSCtx(p,"await ($B.promise("+a+"))"),i.push(u)}else i.push($NodeJS("await ($B.promise("+a+"))"));var d=new $NodeJS("try");t.children.forEach((function(t){d.add(t)})),i.push(d);var f=new $NodeJS("catch(err)");i.push(f),f.add($NodeJS(this.exc_name+" = true")),f.add($NodeJS("var "+l+' = $B.imported["_sys"].exc_info()'));var m=$NodeJS("if(! await ($B.promise("+this.cmexit_name+"("+this.cm_name+", "+l+"[0], "+l+"[1], "+l+"[2]))))");f.add(m),m.add($NodeJS("$B.$raise()"));var _=$NodeJS("if(! "+this.exc_name+")");i.push(_),_.add($NodeJS("await ($B.promise("+this.cmexit_name+"("+this.cm_name+", _b_.None, _b_.None, _b_.None)))")),t.parent.children.splice(e,1);for(var g=i.length-1;g>=0;g--)t.parent.insert(e,i[g]);return t.children=[],0},$WithCtx.prototype.to_js=function(){this.js_processed=!0;var t=$get_node(this).indent,e=" ".repeat(t),n=this.num,r=""==this.prefix?"var ":this.prefix,i="$ctx_manager"+n,s=r+"$ctx_manager_exit"+n,o=r+"$exc"+n,a="$value"+n;return"var "+i+" = "+this.tree[0].to_js()+"\n"+e+s+" = $B.$getattr("+i+',"__exit__")\n'+e+"var "+a+" = $B.$getattr("+i+',"__enter__")()\n'+e+o+" = true\n"};var $YieldCtx=$B.parser.$YieldCtx=function(t,e){this.type="yield",this.parent=t,this.tree=[],this.is_await=e,t.tree[t.tree.length]=this,"list_or_tuple"==t.type&&t.tree.length>1&&$_SyntaxError(t,"non-parenthesized yield"),$parent_match(t,{type:"annotation"})&&$_SyntaxError(t,["'yield' outside function"]);for(var n=this;;){var r=$parent_match(n,{type:"list_or_tuple"});if(!r)break;r.yields=r.yields||[],r.yields.push([this,$pos]),n=r}for(n=this;;){var i=$parent_match(n,{type:"dict_or_set"});if(!i)break;i.yields=i.yields||[],i.yields.push([this,$pos]),n=i}var s=$get_module(this);s.yields_func_check=s.yields_func_check||[],s.yields_func_check.push([this,$pos]);var o=this.scope=$get_scope(this,!0),a=$get_node(this);a.has_yield=this;var l=$parent_match(this,{type:"comprehension"});if($get_scope(this).id.startsWith("lc"+$B.lambda_magic)&&delete a.has_yield,l){var c=l.tree[0].tree[1];for(n=t;n&&n!==c;)n=n.parent;n||$_SyntaxError(t,["'yield' inside list comprehension"])}var u=!1;for(n=t;n;){if("lambda"==n.type){u=!0,this.in_lambda=!0;break}n=n.parent}for(n=a.parent;n;){if(n.C&&n.C.tree.length>0&&"with"==n.C.tree[0].type){o.C.tree[0].$has_yield_in_cm=!0;break}n=n.parent}if(!u)switch(t.type){case"node":case"assign":case"list_or_tuple":break;default:$_SyntaxError(t,"yield atom must be inside ()")}};$YieldCtx.prototype.toString=function(){return"(yield) "+(this.from?"(from) ":"")+this.tree},$YieldCtx.prototype.transition=function(t,e){var n=this;return"from"==t?("abstract_expr"!=n.tree[0].type&&$_SyntaxError(n,"'from' must follow 'yield'"),n.from=!0,n.from_num=$B.UUID(),n.tree[0]):$transition(n.parent,t)},$YieldCtx.prototype.transform=function(t,e){for(var n=t.parent;n;){if(void 0!==n.ctx_manager_num){t.parent.insert(e+1,$NodeJS("$top_frame[1].$has_yield_in_cm = true"));break}n=n.parent}},$YieldCtx.prototype.to_js=function(){return this.from?`_r${this.from_num}`:"yield "+$to_js(this.tree)},$YieldCtx.prototype.check_in_function=function(){if(!this.in_lambda){var t=$get_scope(this),e=t.is_function,n=t;if(!e&&t.is_comp){for(var r=t.parent_block;r.is_comp;)r=parent_block;e=r.is_function,n=r}if(e){var i=n.C.tree[0];this.is_await||(i.type="generator")}else $_SyntaxError(this.parent,["'yield' outside function"])}};var $add_line_num=$B.parser.$add_line_num=function(t,e,n){if("module"!=t.type){if("marker"!==t.type){for(var r=t.C.tree[0],i=1,s=!0,o=t;void 0!==o.parent;)o=o.parent;var a=o.id,l=t.line_num;if(void 0===l&&(s=!1),("condition"==r.type&&"elif"==r.token||"except"==r.type||"single_kw"==r.type)&&(s=!1),s){var c=';$locals.$line_info = "'+(void 0===n?l+","+a:n)+'";if($locals.$f_trace !== _b_.None){$B.trace_line()};_b_.None;',u=new $Node;u.is_line_num=!0,new $NodeJSCtx(u,c),t.parent.insert(e,u),i=2}for(h=0;h<t.children.length;)h+=$add_line_num(t.children[h],h,n);return i}return 1}for(var h=0;h<t.children.length;)h+=$add_line_num(t.children[h],h,n)},$bind=$B.parser.$bind=function(t,e,n){if(!e.nonlocals||!e.nonlocals[t])if(e.globals&&e.globals.has(t))$get_module(n).binding[t]=!0;else{if(!n.no_bindings){var r=$get_node(n);r.bindings=r.bindings||{},r.bindings[t]=!0}e.binding=e.binding||{},void 0===e.binding[t]&&(e.binding[t]=!0)}};function $parent_match(t,e){for(var n;t.parent;){for(var r in n=!0,e)if(t.parent[r]!=e[r]){n=!1;break}if(n)return t.parent;t=t.parent}return!1}var $previous=$B.parser.$previous=function(t){var e=t.node.parent.children[t.node.parent.children.length-2];return e&&e.C||$_SyntaxError(t,"keyword not following correct keyword"),e.C.tree[0]},$get_docstring=$B.parser.$get_docstring=function(t){var e="";if(t.children.length>0){var n=t.children[0];if(n.C.tree&&n.C.tree.length>0&&"expr"==n.C.tree[0].type){var r=n.C.tree[0].tree[0];"str"!=r.type||Array.isArray(r.tree[0])||(e=n.C.tree[0].tree[0].to_js())}}return e},$get_scope=$B.parser.$get_scope=function(t,e){for(var n=t.parent;"node"!==n.type;)n=n.parent;for(var r=n.node,i=null;r.parent&&"module"!==r.parent.type;){var s=r.parent.C.tree[0].type;switch(s){case"def":case"class":case"generator":return(i=r.parent).ntype=s,i.is_function="class"!=s,i}r=r.parent}return(i=r.parent||r).ntype="module",i},$get_line_num=$B.parser.$get_line_num=function(t){var e=$get_node(t),n=e.line_num;if(void 0===e.line_num){for(e=e.parent;e&&void 0===e.line_num;)e=e.parent;e&&e.line_num&&(n=e.line_num)}return n},$get_module=$B.parser.$get_module=function(t){for(var e=t.parent;"node"!==e.type;)e=e.parent;var n=e.node;if("module"==n.ntype)return n;for(var r=null;"module"!=n.parent.type;)n=n.parent;return(r=n.parent).ntype="module",r},$get_src=$B.parser.$get_src=function(t){for(var e=$get_node(t);void 0!==e.parent;)e=e.parent;return e.src},$get_node=$B.parser.$get_node=function(t){for(var e=t;e.parent;)e=e.parent;return e.node},$to_js_map=$B.parser.$to_js_map=function(t){if(void 0!==t.to_js)return t.to_js();throw Error("no to_js() for "+t)},$to_js=$B.parser.$to_js=function(t,e){return void 0===e&&(e=","),t.map($to_js_map).join(e)},$mangle=$B.parser.$mangle=function(t,e){if("__"!=t.substr(0,2)||"__"===t.substr(t.length-2))return t;for(var n=$get_scope(e);;){if("module"==n.ntype)return t;if("class"==n.ntype){for(var r=n.C.tree[0].name;"_"==r.charAt(0);)r=r.substr(1);return"_"+r+t}if(!n.parent||!n.parent.C)return t;n=$get_scope(n.C.tree[0])}},$transition=$B.parser.$transition=function(t,e,n){return t.transition(e,n)};$B.forbidden=["alert","arguments","case","catch","const","constructor","Date","debugger","delete","default","do","document","enum","export","eval","extends","Error","history","function","instanceof","keys","length","location","Math","message","new","null","Number","RegExp","String","super","switch","this","throw","typeof","var","window","toLocaleString","toString","void"],$B.aliased_names=$B.list2obj($B.forbidden);for(var s_escaped="abfnrtvxuU\"0123456789'\\",is_escaped={},i=0;i<s_escaped.length;i++)is_escaped[s_escaped.charAt(i)]=!0;var $tokenize=$B.parser.$tokenize=function(root,src){for(var br_close={")":"(","]":"[","}":"{"},br_stack="",br_pos=[],kwdict=["class","return","break","for","lambda","try","finally","raise","def","from","nonlocal","while","del","global","with","as","elif","else","if","yield","assert","import","except","raise","in","pass","with","continue","__debugger__","async","await"],unsupported=[],$indented=["class","def","for","condition","single_kw","try","except","with"],int_pattern=/^(\d[0-9_]*)(j|J)?/,float_pattern1=/^(\d[\d_]*)\.(\d+(_\d+)*)?([eE][+-]?\d+(_\d+)*)?(j|J)?/,float_pattern2=/^(\d[\d_]*)([eE][+-]?\d+(_\d+)*)(j|J)?/,hex_pattern=/^0[xX]([\da-fA-F_]+)/,octal_pattern=/^0[oO]([0-7_]+)/,binary_pattern=/^0[bB]([01_]+)/,C=null,new_node=new $Node,current=root,name="",_type=null,pos=0,indent=null,string_modifier=!1,module=root.module,lnum=root.line_num||1;pos<src.length;){var car=src.charAt(pos);if(null!==indent)if("#"!=car)if('"'!=car&&"'"!=car){if(""==name&&"$"!=car){if($B.unicode_tables.XID_Start[car.charCodeAt(0)]){name=car;var p0=pos;for(pos++;pos<src.length&&$B.unicode_tables.XID_Continue[src.charCodeAt(pos)];)name+=src.charAt(pos),pos++}if(name){if(kwdict.indexOf(name)>-1)$pos=pos-name.length,unsupported.indexOf(name)>-1&&$_SyntaxError(C,"Unsupported Python keyword '"+name+"'"),C=$transition(C,name);else if("string"==typeof $operators[name]&&-1==["is_not","not_in"].indexOf(name))if("is"==name){var re=/^\s+not\s+/,res=re.exec(src.substr(pos));null!==res?(pos+=res[0].length,$pos=pos-name.length,C=$transition(C,"op","is_not")):($pos=pos-name.length,C=$transition(C,"op",name))}else if("not"==name){var re=/^\s+in\s+/,res=re.exec(src.substr(pos));null!==res?(pos+=res[0].length,$pos=pos-name.length,C=$transition(C,"op","not_in")):($pos=pos-name.length,C=$transition(C,name))}else $pos=pos-name.length,C=$transition(C,"op",name);else{if(('"'==src.charAt(pos)||"'"==src.charAt(pos))&&-1!==["r","b","u","rb","br","f","fr","rf"].indexOf(name.toLowerCase())){string_modifier=name.toLowerCase(),name="";continue}$B.forbidden.indexOf(name)>-1&&(name="$$"+name),$pos=pos-name.length,C=$transition(C,"id",name)}name="";continue}}switch(car){case" ":case"\t":pos++;break;case".":if(pos<src.length-1&&/^\d$/.test(src.charAt(pos+1))){for(var j=pos+1;j<src.length&&src.charAt(j).search(/\d|e|E|_/)>-1;)j++;"j"==src.charAt(j)?(C=$transition(C,"imaginary","0"+rmu(src.substr(pos,j-pos))),j++):C=$transition(C,"float","0"+rmu(src.substr(pos,j-pos))),pos=j;break}$pos=pos,C=$transition(C,"."),pos++;break;case"0":var res=hex_pattern.exec(src.substr(pos));if(res){rmuf(res[1]),C=$transition(C,"int",[16,rmu(res[1])]),pos+=res[0].length;break}var res=octal_pattern.exec(src.substr(pos));if(res){C=$transition(C,"int",[8,rmuf(res[1])]),pos+=res[0].length;break}var res=binary_pattern.exec(src.substr(pos));if(res){C=$transition(C,"int",[2,rmuf(res[1])]),pos+=res[0].length;break}if(src.charAt(pos+1).search(/\d/)>-1){if(0===parseInt(src.substr(pos))){res=int_pattern.exec(src.substr(pos)),$pos=pos,check_int(res[0]),C=$transition(C,"int",[10,rmu(res[0])]),pos+=res[0].length;break}$_SyntaxError(C,"invalid literal starting with 0")}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":var res=float_pattern1.exec(src.substr(pos));res?(check_int(res[1]),res[2]&&rmuf(res[2]),$pos=pos,C=void 0!==$B.last(res)?$transition(C,"imaginary",rmuf(res[0].substr(0,res[0].length-1))):$transition(C,"float",rmuf(res[0]))):(res=float_pattern2.exec(src.substr(pos)),res?(check_int(res[1]),$pos=pos,C=void 0!==$B.last(res)?$transition(C,"imaginary",rmuf(res[0].substr(0,res[0].length-1))):$transition(C,"float",rmuf(res[0]))):(res=int_pattern.exec(src.substr(pos)),check_int(res[1]),$pos=pos,C=void 0!==res[2]?$transition(C,"imaginary",rmu(res[1])):$transition(C,"int",[10,rmu(res[0])]))),pos+=res[0].length;break;case"\n":lnum++,br_stack.length>0||(current.C.tree.length>0||current.C.async?($pos=pos,C=$transition(C,"eol"),indent=null,new_node=new $Node):new_node.line_num=lnum),pos++;break;case"(":case"[":case"{":br_stack+=car,br_pos[br_stack.length-1]=[C,pos],$pos=pos,C=$transition(C,car),pos++;break;case")":case"]":case"}":""==br_stack?($pos=pos,$_SyntaxError(C,"Unexpected closing bracket")):br_close[car]!=br_stack.charAt(br_stack.length-1)?($pos=pos,$_SyntaxError(C,"Unbalanced bracket")):(br_stack=br_stack.substr(0,br_stack.length-1),$pos=pos,C=$transition(C,car),pos++);break;case"=":"="!=src.charAt(pos+1)?($pos=pos,C=$transition(C,"="),pos++):($pos=pos,C=$transition(C,"op","=="),pos+=2);break;case",":case":":$pos=pos,":="==src.substr(pos,2)?(C=$transition(C,":="),pos++):C=$transition(C,car),pos++;break;case";":$transition(C,"eol"),0==current.C.tree.length&&($pos=pos,$_SyntaxError(C,"invalid syntax"));for(var pos1=pos+1,ends_line=!1;pos1<src.length;){var _s=src.charAt(pos1);if("\n"==_s||"#"==_s){ends_line=!0;break}if(" "!=_s)break;pos1++}if(ends_line){pos++;break}new_node=new $Node,new_node.indent=$get_node(C).indent,new_node.line_num=lnum,new_node.module=module,$get_node(C).parent.add(new_node),current=new_node,C=new $NodeCtx(new_node),pos++;break;case"/":case"%":case"&":case">":case"<":case"-":case"+":case"*":case"@":case"/":case"^":case"=":case"|":case"~":case"!":if("-"==car&&">"==src.charAt(pos+1)){C=$transition(C,"annotation"),pos+=2;continue}if("@"==car&&"node"==C.type){$pos=pos,C=$transition(C,car),pos++;break}var op_match="";for(var op_sign in $operators)op_sign==src.substr(pos,op_sign.length)&&op_sign.length>op_match.length&&(op_match=op_sign);$pos=pos,op_match.length>0?(C=$transition(C,op_match in $augmented_assigns?"augm_assign":"op",op_match),pos+=op_match.length):$_SyntaxError(C,"invalid character: "+car);break;case"\\":if("\n"==src.charAt(pos+1)){lnum++,pos+=2,pos==src.length?$_SyntaxError(C,["unexpected EOF while parsing"]):"node"==C.type&&$_SyntaxError(C,"nothing before \\");break}$pos=pos,$_SyntaxError(C,["unexpected character after line continuation character"]);case String.fromCharCode(12):pos+=1;break;default:$pos=pos,$_SyntaxError(C,"unknown token ["+car+"]")}}else{var raw="str"==C.type&&C.raw,bytes=!1,fstring=!1,sm_length,end=null;if(string_modifier){switch(string_modifier){case"r":raw=!0;break;case"u":break;case"b":bytes=!0;break;case"rb":case"br":bytes=!0,raw=!0;break;case"f":fstring=!0,sm_length=1;break;case"rf":fstring=!0,sm_length=2,raw=!0}string_modifier=!1}src.substr(pos,3)==car+car+car?(_type="triple_string",end=pos+3):(_type="string",end=pos+1);for(var escaped=!1,zone=car,found=!1;end<src.length;)if(escaped)"a"==src.charAt(end)?zone=zone.substr(0,zone.length-1)+"":(zone+=src.charAt(end),raw&&"\\"==src.charAt(end)&&(zone+="\\")),escaped=!1,end++;else if("\\"==src.charAt(end))if(raw)end<src.length-1&&src.charAt(end+1)==car?(zone+="\\\\"+car,end+=2):(zone+="\\\\",end++),escaped=!0;else if("\n"==src.charAt(end+1))end+=2,lnum++;else if("N{"==src.substr(end+1,2)){var end_lit=end+3,re=new RegExp("[-a-zA-Z0-9 ]+"),search=re.exec(src.substr(end_lit));null===search&&$_SyntaxError(C,"(unicode error) malformed \\N character escape",pos);var end_lit=end_lit+search[0].length;"}"!=src.charAt(end_lit)&&$_SyntaxError(C,"(unicode error) malformed \\N character escape");var description=search[0].toUpperCase();if(void 0===$B.unicodedb){var xhr=new XMLHttpRequest;xhr.open("GET",$B.brython_path+"unicode.txt",!1),xhr.onreadystatechange=function(){4==this.readyState&&(200==this.status?$B.unicodedb=this.responseText:console.log("Warning - could not load unicode.txt"))},xhr.send()}if(void 0!==$B.unicodedb){var re=new RegExp("^([0-9A-F]+);"+description+";.*$","m");search=re.exec($B.unicodedb),null===search&&$_SyntaxError(C,"(unicode error) unknown Unicode character name");var cp="0x"+search[1];zone+=String.fromCodePoint(eval(cp)),end=end_lit+1}else end++}else end<src.length-1&&void 0===is_escaped[src.charAt(end+1)]&&(zone+="\\"),zone+="\\",escaped=!0,end++;else if("\n"==src.charAt(end)&&"triple_string"!=_type)console.log(pos,end,src.substring(pos,end)),$pos=end,$_SyntaxError(C,["EOL while scanning string literal"]);else if(src.charAt(end)==car){if("triple_string"!=_type||src.substr(end,3)==car+car+car){found=!0,$pos=pos;for(var $string=zone.substr(1),string="",i=0;i<$string.length;i++){var $car=$string.charAt(i);$car!=car||!raw&&0!=i&&"\\"==$string.charAt(i-1)||(string+="\\"),string+=$car}if(fstring)try{var re=new RegExp("\\\\"+car,"g"),string_no_bs=string.replace(re,car),elts=$B.parse_fstring(string_no_bs)}catch(t){$_SyntaxError(C,[t.toString()])}bytes?C=$transition(C,"str","b"+car+string+car):fstring?($pos-=sm_length,C=$transition(C,"str",elts),$pos+=sm_length):C=$transition(C,"str",car+string+car),C.raw=raw,pos=end+1,"triple_string"==_type&&(pos=end+3);break}zone+=src.charAt(end),end++}else zone+=src.charAt(end),"\n"==src.charAt(end)&&lnum++,end++;found||$_SyntaxError(C,"triple_string"===_type?"Triple string end not found":"String end not found")}else{var end=src.substr(pos+1).search("\n");-1==end&&(end=src.length-1),root.comments.push([pos,end]),pos+=end+1}else{for(var indent=0;pos<src.length;){var _s=src.charAt(pos);if(" "==_s)indent++,pos++;else{if("\t"!=_s)break;indent++,pos++,indent%8>0&&(indent+=8-indent%8)}}var _s=src.charAt(pos);if("\n"==_s){pos++,lnum++,indent=null;continue}if("#"==_s){var offset=src.substr(pos).search(/\n/);if(-1==offset)break;pos+=offset+1,lnum++,indent=null;continue}if(new_node.indent=indent,new_node.line_num=lnum,new_node.module=module,current.is_body_node&&(current.indent=indent),indent>current.indent)null!==C&&-1==$indented.indexOf(C.tree[0].type)&&($pos=pos,$_SyntaxError(C,"unexpected indent",pos)),current.add(new_node);else if(indent<=current.indent&&C&&C.tree[0]&&$indented.indexOf(C.tree[0].type)>-1&&C.tree.length<2)$pos=pos,$_SyntaxError(C,"expected an indented block",pos);else{for(;indent!==current.indent;)current=current.parent,(void 0===current||indent>current.indent)&&($pos=pos,$_SyntaxError(C,"unexpected indent",pos));current.parent.add(new_node)}current=new_node,C=new $NodeCtx(new_node)}function rmuf(t){return(t.search("__")>-1||t.endsWith("_"))&&$_SyntaxError(C,"invalid literal"),t.replace(/_/g,"")}function check_int(t){if(rmuf(t),t.startsWith("0")){if(!(t.substr(1).search(/[^0_]/)>-1))return"0";$_SyntaxError(C,"invalid literal")}}function rmu(t){return t.replace(/_/g,"")}}if(0!=br_stack.length){var br_err=br_pos[0];$pos=br_err[1];var lines=src.split("\n"),id=root.id,fname=id.startsWith("$")?"<string>":id;$_SyntaxError(br_err[0],["unexpected EOF while parsing ("+fname+", line "+(lines.length-1)+")"])}if(null!==C){if("async"==C.type)throw console.log("error with async",pos,src,src.substr(pos)),$pos=pos-7,$_SyntaxError(C,"car "+car+"after async",pos);if(C.tree[0]&&$indented.indexOf(C.tree[0].type)>-1)$pos=pos-1,$_SyntaxError(C,"expected an indented block",pos);else{var parent=current.parent;if(parent.C&&parent.C.tree&&parent.C.tree[0]&&"try"==parent.C.tree[0].type&&($pos=pos-1,$_SyntaxError(C,["unexpected EOF while parsing"])),root.yields_func_check){var save_pos=$pos;for(const e of root.yields_func_check)$pos=e[1],e[0].check_in_function();$pos=save_pos}}}},$create_root_node=$B.parser.$create_root_node=function(t,e,n,r,i){var s=new $Node("module");return s.module=e,s.id=n,s.binding={__doc__:!0,__name__:!0,__file__:!0,__package__:!0},s.parent_block=r,s.line_num=i,s.indent=-1,s.comments=[],s.imports={},"object"==typeof t&&(s.is_comp=t.is_comp,t.has_annotations&&(s.binding.__annotations__=!0),t=t.src),s.src=t,s};$B.py2js=function(t,e,n,r,i){if($pos=0,"object"==typeof e){var s=e.__package__;e=e.__name__}else s="";r=r||$B.builtins_scope;var o=(new Date).getTime(),a=!1,l=!0;if("object"==typeof t){a=t.is_comp,l=t.has_annotations;var c=t.line_info,u=t.ix;void 0!==c&&(i=parseInt(c.split(",")[0])),t=t.src}(t=t.replace(/\r\n/gm,"\n")).endsWith("\\")&&!t.endsWith("\\\\")&&(t=t.substr(0,t.length-1)),"\n"!=t.charAt(t.length-1)&&(t+="\n"),Array.isArray(n)&&(n=n[0]),n.charAt(0);var h="$locals_"+n.replace(/\./g,"_"),p="$locals_"+e.replace(/\./g,"_"),d=$create_root_node({src:t,is_comp:a,has_annotations:l},e,n,r,i);$tokenize(d,t),d.is_comp=a,null!=u&&(d.ix=u),d.transform();var f=1;(g=["var $B = __BRYTHON__;\n"])[f++]="var _b_ = __BRYTHON__.builtins;\n",g[2]="var $locals = "+h,a&&(g[2]+=" = {}");var m=0;d.insert(0,$NodeJS(g.join(""))),m++,d.insert(m++,$NodeJS(h+'.__package__ = "'+s+'"')),d.binding.__annotations__&&d.insert(m++,$NodeJS("$locals.__annotations__ = $B.empty_dict()"));var _=m,g='var $top_frame = ["'+n.replace(/\./g,"_")+'", '+h+', "'+e.replace(/\./g,"_")+'", '+p+"]\n$locals.$f_trace = $B.enter_frame($top_frame)\nvar $stack_length = $B.frames_stack.length;";d.insert(m++,$NodeJS(g));var y=new $NodeJS("try"),v=d.children.slice(_+1,d.children.length);d.insert(_+1,y),0==v.length&&(v=[$NodeJS("")]),v.forEach((function(t){y.add(t)})),y.add($NodeJS("$B.leave_frame({$locals, value: _b_.None})")),d.children.splice(_+2,d.children.length);var b=$NodeJS("catch(err)");b.add($NodeJS("$B.leave_frame({$locals, value: _b_.None})")),b.add($NodeJS("throw err")),d.add(b),$add_line_num(d,null,c);var x=(new Date).getTime();return $B.debug>2&&e==n&&console.log("module "+e+" translated in "+(x-o)+" ms"),$B.compile_time+=x-o,d},$B.set_import_paths=function(){var t=[],e=[];$B.use_VFS&&t.push($B.finders.VFS),!1!==$B.$options.static_stdlib_import&&"file"!=$B.protocol&&(t.push($B.finders.stdlib_static),$B.path.length>3&&($B.path.shift(),$B.path.shift())),"file"!==$B.protocol&&(t.push($B.finders.path),e.push($B.$path_hooks[0])),$B.$options.cpython_import&&("replace"==$B.$options.cpython_import&&$B.path.pop(),t.push($B.finders.CPython)),$B.meta_path=t,$B.path_hooks=e};var brython=$B.parser.brython=function(t){void 0===t&&(t={debug:1}),"number"==typeof t&&(t={debug:t}),void 0===t.debug&&(t.debug=1),$B.debug=t.debug,_b_.__debug__=$B.debug>0,$B.compile_time=0,void 0===t.profile&&(t.profile=0),$B.profile=t.profile,void 0===t.indexedDB&&(t.indexedDB=!0),void 0===t.static_stdlib_import&&(t.static_stdlib_import=!0),$B.static_stdlib_import=t.static_stdlib_import,$B.$options=t,$B.set_import_paths();var e=($B.script_path=_window.location.href).split("/");if(e.pop(),($B.isWebWorker||$B.isNode)&&e.pop(),$B.curdir=e.join("/"),void 0!==t.pythonpath&&($B.path=t.pythonpath,$B.$options.static_stdlib_import=!1),t.python_paths&&t.python_paths.forEach((function(t){var e,n;"string"!=typeof t&&(e=t.lang,n=t.prefetch,t=t.path),$B.path.push(t),".vfs.js"!=t.slice(-7).toLowerCase()||void 0!==n&&!0!==n||($B.path_importer_cache[t+"/"]=$B.imported._importlib.VFSPathFinder(t)),e&&i.optimize_import_for_path(t,e)})),!$B.isWebWorker&&!$B.isNode)for(var n,r=document.querySelectorAll("head link[rel~=pythonpath]"),i=$B.imported._importlib,s=0;n=r[s];++s){var o=n.href;-1!=(" "+n.rel+" ").indexOf(" prepend ")?$B.path.unshift(o):$B.path.push(o);var a=n.hreflang;a&&("x-"==a.slice(0,2)&&(a=a.slice(2)),i.optimize_import_for_path(n.href,a))}$B.$options.args?$B.__ARGV=$B.$options.args:$B.__ARGV=_b_.list.$factory([]),$B.isWebWorker||$B.isNode||_run_scripts(t)};$B.run_script=function(t,e,n){$B.$py_module_path[e]=$B.script_path;try{var r=$B.py2js(t,e,e),i=r.to_js(),s={__doc__:r.__doc__,js:i,__name__:e,$src:t,__file__:$B.script_path+($B.script_path.endsWith("/")?"":"/")+e};$B.file_cache[s.__file__]=t,$B.debug>1&&console.log(i)}catch(t){$B.handle_error(t)}if($B.hasOwnProperty("VFS")&&$B.has_indexedDB){var o=Object.keys(r.imports).slice().filter((function(t){return $B.VFS.hasOwnProperty(t)}));Object.keys(o).forEach((function(t){if($B.VFS.hasOwnProperty(t)){var e=$B.VFS[t],n=e[0];if(".py"==n){e[1];var r=e[2];e.length,".py"==n&&required_stdlib_imports(r),r.forEach((function(t){-1==o.indexOf(t)&&o.push(t)}))}}}));for(var a=0;a<o.length;a++)$B.tasks.push([$B.inImported,o[a]]);r=null}$B.tasks.push(["execute",s]),n&&$B.loop()};var $log=$B.$log=function(t){t.split("\n").forEach((function(t,e){console.log(e+1,":",t)}))},_run_scripts=$B.parser._run_scripts=function(options){var kk=Object.keys(_window),defined_ids={};if(void 0!==options.ipy_id){var $elts=[];options.ipy_id.forEach((function(t){$elts.push(document.getElementById(t))}))}else for(var scripts=document.getElementsByTagName("script"),$elts=[],webworkers=[],i=0;i<scripts.length;i++){var script=scripts[i];if("text/python"==script.type||"text/python3"==script.type)if("webworker"==script.className){if(void 0===script.id)throw _b_.AttributeError.$factory("webworker script has no attribute 'id'");webworkers.push(script)}else $elts.push(script)}var first_script=!0,module_name;if(void 0!==options.ipy_id){module_name="__main__";var $src="",js,root;$B.$py_module_path[module_name]=$B.script_path,$elts.forEach((function(t){$src+=t.innerHTML||t.textContent}));try{root=$B.py2js($src,module_name,module_name),js=root.to_js(),$B.debug>1&&$log(js),eval(js),$B.clear_ns(module_name),root=null,js=null}catch(t){if(root=null,js=null,console.log(t),$B.debug>1)for(var attr in console.log(t),t)console.log(attr+" : ",t[attr]);void 0===t.$py_error&&(console.log("Javascript error",t),t=_b_.RuntimeError.$factory(t+""));var $trace=$B.$getattr(t,"info")+"\n"+t.__name__+": "+t.args;try{$B.$getattr($B.stderr,"write")($trace)}catch(t){console.log($trace)}throw t}}else{$elts.length>0&&options.indexedDB&&$B.has_indexedDB&&$B.hasOwnProperty("VFS")&&$B.tasks.push([$B.idb_open]);for(var i=0;i<$elts.length;i++){var elt=$elts[i];if(elt.id){if(defined_ids[elt.id])throw Error("Brython error : Found 2 scripts with the same id '"+elt.id+"'");defined_ids[elt.id]=!0}}for(var src,i=0,len=webworkers.length;i<len;i++){var worker=webworkers[i];worker.src?$B.tasks.push([$B.ajax_load_script,{name:worker.id,url:worker.src,is_ww:!0}]):(src=worker.innerHTML||worker.textContent,src=src.replace(/^\n/,""),$B.webworkers[worker.id]=src)}for(var i=0;i<$elts.length;i++){var elt=$elts[i];if("text/python"==elt.type||"text/python3"==elt.type){if(elt.id)module_name=elt.id;else for(first_script?(module_name="__main__",first_script=!1):module_name="__main__"+$B.UUID();void 0!==defined_ids[module_name];)module_name="__main__"+$B.UUID();elt.src?$B.tasks.push([$B.ajax_load_script,{name:module_name,url:elt.src}]):(src=elt.innerHTML||elt.textContent,src=src.replace(/^\n/,""),$B.run_script(src,module_name))}}}void 0===options.ipy_id&&$B.loop()};$B.$operators=$operators,$B.$Node=$Node,$B.$NodeJSCtx=$NodeJSCtx,$B.brython=brython}(__BRYTHON__);var brython=__BRYTHON__.brython;__BRYTHON__.isNode&&(__webpack_require__.g.__BRYTHON__=__BRYTHON__,module.exports={__BRYTHON__}),function(t){var e=t.builtins;function n(e,n,i,o,a){var l=t.idb_cx.result.transaction("modules","readwrite").objectStore("modules"),c=(l.openCursor(),{name:e,content:n,imports:o,origin,timestamp:__BRYTHON__.timestamp,source_ts:i,is_package:a}),u=l.put(c);t.debug>1&&console.log("store precompiled",e,"package",a),document.dispatchEvent(new CustomEvent("precompile",{detail:"cache module "+e}));var h=t.outdated.indexOf(e);h>-1&&t.outdated.splice(h,1),u.onsuccess=function(n){t.tasks.splice(0,0,[r,e]),s()}}function r(e){var o=t.idb_cx.result.transaction("modules","readonly");try{var a=o.objectStore("modules");req=a.get(e),req.onsuccess=function(o){!function(e,o){var a=e.target.result;if(t.timestamp,void 0===a||a.timestamp!=t.timestamp||t.VFS[o]&&a.source_ts!==t.VFS[o].timestamp){if(void 0!==t.VFS[o]){var l=(x=t.VFS[o])[0],c=x[1];if(".py"==l){var u,h,p=x[2],d=4==x.length,f=x.timestamp;d?u=o:((h=o.split(".")).pop(),u=h.join(".")),t.imported[o]=t.module.$factory(o,"",u);try{var m=t.py2js(c,o,o).to_js()}catch(e){t.handle_error(e)}delete t.imported[o],t.debug>1&&console.log("precompile",o),(h=o.split(".")).length>1&&h.pop(),t.stdlib.hasOwnProperty(h.join("."))&&(p=(p=x[2]).join(","),t.tasks.splice(0,0,[n,o,m,f,p,d]))}else console.log("bizarre",o,l)}}else if(a.is_package?t.precompiled[o]=[a.content]:t.precompiled[o]=a.content,a.imports.length>0){t.debug>1&&console.log(o,"imports",a.imports);for(var _=a.imports.split(","),g=0;g<_.length;g++){var y=_[g];if(y.startsWith(".")){for(var v=o.split("."),b=0;y.startsWith(".");)b++,y=y.substr(1);var x=v.slice(0,b);y&&(x=x.concat([y])),y=x.join(".")}if(!t.imported.hasOwnProperty(y)&&!t.precompiled.hasOwnProperty(y)&&t.VFS.hasOwnProperty(y)){var w=t.VFS[y];l=w[0],c=w[1],".py"==w[0]?t.tasks.splice(0,0,[r,y]):i(y,c)}}}s()}(o,e)}}catch(t){console.info("error",t)}}function i(e,n){n+="\nvar $locals_"+e.replace(/\./g,"_")+" = $module",t.precompiled[e]=n}t.VFS_timestamp&&t.VFS_timestamp>t.timestamp&&(t.timestamp=t.VFS_timestamp),t.idb_open=function(e){t.idb_name="brython-cache";var n=t.idb_cx=indexedDB.open(t.idb_name);n.onsuccess=function(){var e=n.result;if(e.objectStoreNames.contains("modules")){t.debug>1&&console.info("using indexedDB for stdlib modules cache");var r,i=e.transaction("modules","readwrite").objectStore("modules"),o=[],a=i.openCursor();a.onerror=function(t){console.log("open cursor error",t)},a.onsuccess=function(e){cursor=e.target.result,cursor?((r=cursor.value).timestamp==t.timestamp?t.VFS&&t.VFS[r.name]&&t.VFS[r.name].timestamp!=r.source_ts?o.push(r.name):(r.is_package?t.precompiled[r.name]=[r.content]:t.precompiled[r.name]=r.content,t.debug>1&&console.info("load from cache",r.name)):o.push(r.name),cursor.continue()):(t.debug>1&&console.log("done"),t.outdated=o,s())}}else{var l=e.version;e.close(),console.info("create object store",l),(n=indexedDB.open(t.idb_name,l+1)).onupgradeneeded=function(){console.info("upgrade needed"),t.idb_cx.result.createObjectStore("modules",{keyPath:"name"}).onsuccess=s},n.onversionchanged=function(){console.log("version changed")},n.onsuccess=function(){console.info("db opened",n),n.result.createObjectStore("modules",{keyPath:"name"}).onsuccess=s}}},n.onupgradeneeded=function(){console.info("upgrade needed"),n.result.createObjectStore("modules",{keyPath:"name"}).onsuccess=s},n.onerror=function(){console.info("could not open indexedDB database"),t.idb_cx=null,t.idb_name=null,t.$options.indexedDB=!1,s()}},t.ajax_load_script=function(n){var r=n.url,i=n.name;if(t.files&&t.files.hasOwnProperty(i))t.tasks.splice(0,0,[t.run_script,t.files[i],i,!0]);else{if("file"==t.protocol)throw e.IOError.$factory("can't load external script at "+n.url+" (Ajax calls not supported with protocol file:///)");var o=new XMLHttpRequest,a=t.$options.cache?"":(r.search(/\?/)>-1?"&":"?")+Date.now();o.open("GET",r+a,!0),o.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){var e=this.responseText;n.is_ww?t.webworkers[i]=e:t.tasks.splice(0,0,[t.run_script,e,i,!0]),s()}else if(404==this.status)throw Error(r+" not found")},o.send()}},t.inImported=function(e){if(t.imported.hasOwnProperty(e));else if(__BRYTHON__.VFS&&__BRYTHON__.VFS.hasOwnProperty(e)){var n=__BRYTHON__.VFS[e];void 0===n&&console.log("bizarre",e);var o=n[0],a=n[1];n.length,".py"==o?t.idb_cx&&!t.idb_cx.$closed&&t.tasks.splice(0,0,[r,e]):i(e,a)}else console.log("bizarre",e);s()};var s=t.loop=function(){if(0!=t.tasks.length){var n=t.tasks.shift(),r=n[0],i=n.slice(1);if("execute"==r){try{var o=n[1],a=o.__name__.replace(/\./g,"_");(c=t.module.$factory(o.__name__)).$src=o.$src,c.__file__=o.__file__,t.imported[a]=c,new Function("$locals_"+a,o.js)(c)}catch(n){void 0===n.__class__&&(console.log("Javascript error",n),t.is_recursion_error(n)?n=e.RecursionError.$factory("too much recursion"):(t.print_stack(),n=e.RuntimeError.$factory(n+""))),t.debug>1&&(console.log("handle error",n.__class__,n.args,n.$stack),console.log(t.frames_stack.slice())),t.handle_error(n)}s()}else try{r.apply(null,i)}catch(e){t.handle_error(e)}}else if(t.idb_cx&&!t.idb_cx.$closed){for(var l=t.idb_cx.result.transaction("modules","readwrite").objectStore("modules");t.outdated.length>0;){var c=t.outdated.pop();l.delete(c).onsuccess=function(e){t.debug>1&&console.info("delete outdated",c),document.dispatchEvent(new CustomEvent("precompile",{detail:"remove outdated "+c+" from cache"}))}}document.dispatchEvent(new CustomEvent("precompile",{detail:"close"})),t.idb_cx.result.close(),t.idb_cx.$closed=!0}};t.tasks=[],t.has_indexedDB=void 0!==self.indexedDB,t.handle_error=function(n){if(t.debug>1&&console.log("handle error",n.__class__,n.args),void 0!==n.__class__){var r=t.class_name(n),i=t.$getattr(n,"info");if("SyntaxError"==r||"IndentationError"==r){var s=n.args[3];i+="\n    "+" ".repeat(s)+"^\n"+r+": "+n.args[0]}else i+="\n"+r,n.args[0]&&n.args[0]!==e.None&&(i+=": "+e.str.$factory(n.args[0]))}else console.log(n),i=n+"";try{t.$getattr(t.stderr,"write")(i);try{t.$getattr(t.stderr,"flush")()}catch(n){console.log(n)}}catch(t){console.log(i)}throw n}}(__BRYTHON__),__BRYTHON__.builtins.object=function(t){var e=t.builtins,n={$infos:{__name__:"object"},$is_class:!0,$native:!0};function r(e){return t.$getattr(e,"__new__").apply(null,arguments)}return n.__delattr__=function(n,r){if(r=t.from_alias(r),n.__dict__&&n.__dict__.$string_dict&&void 0!==n.__dict__.$string_dict[r])return delete n.__dict__.$string_dict[r],e.None;if(void 0===n.__dict__&&void 0!==n[r])return delete n[r],e.None;var i=n.__class__;if(i){var s=t.$getattr(i,r);if(s.__class__===e.property&&void 0!==s.__delete__)return s.__delete__(n),e.None}throw e.AttributeError.$factory(r)},n.__dir__=function(n){var r;if(n.$is_class)r=[n].concat(n.__mro__);else{var i=n.__class__||t.get_class(n);r=[n,i].concat(i.__mro__)}for(var s=[],o=0,a=r.length;o<a;o++)for(var l in r[o])"$"!=l.charAt(0)?isNaN(parseInt(l.charAt(0)))&&"__mro__"!=l&&s.push(l):"$"==l.charAt(1)&&s.push(l.substr(2));if(n.__dict__)for(var l in n.__dict__.$string_dict)"$$"==l.substr(0,2)?s.push(l.substr(2)):"$"!=l.charAt(0)&&s.push(l);return s=e.list.$factory(e.set.$factory(s)),e.list.sort(s),s},n.__eq__=function(t,n){return t===n||e.NotImplemented},n.__format__=function(){var n=t.args("__format__",2,{self:null,spec:null},["self","spec"],arguments,{},null,null);if(""!==n.spec)throw e.TypeError.$factory("non-empty format string passed to object.__format__");return e.getattr(n.self,"__str__")()},n.__ge__=function(){return e.NotImplemented},n.__getattribute__=function(n,r){var i=n.__class__||t.get_class(n),s=!1;if("__class__"===r)return i;var o=n[r];if(Array.isArray(n)&&void 0!==Array.prototype[r]&&(o=void 0),void 0===o&&n.__dict__){var a=n.__dict__;if(a.$string_dict.hasOwnProperty(r))return a.$string_dict[r][0]}if(void 0===o){function l(t,e,n){var r=e[n];if(void 0!==r)return r}if(void 0===(o=l(0,i,r)))for(var c=0,u=(_=i.__mro__).length;c<u&&void 0===(o=l(0,_[c],r));c++);else o.__class__!==t.method&&void 0===o.__get__&&(s=!0)}else if(void 0===o.__set__)return o;if(void 0!==o){if(o.__class__===e.property)return o.__get__(o,n,i);if(o.__class__===t.method)return void 0===o.__get__&&console.log("bizarre",n,r,o),o.__get__(n,i);if(void 0===(h=o.__get__)&&o.__class__){var h=o.__class__.__get__;for(c=0;c<o.__class__.__mro__.length&&void 0===h;c++)h=o.__class__.__mro__[c].__get__}var p=void 0===h?null:t.$getattr(o,"__get__",null);if(null!==p)try{return p.apply(null,[n,i])}catch(y){throw console.log("error in get.apply",y),console.log("get attr",r,"of",n),console.log(p+""),y}if("object"==typeof o&&p&&"function"==typeof p&&(get_func=function(t,e){return p.apply(t,[e,i.$factory])}),null===p&&"function"==typeof o&&(p=function(t){return t}),null!==p){o.__name__=r,"__new__"==r&&(o.$type="staticmethod");var d=p.apply(null,[o,n,i]);if("function"==typeof d){if(d.__class__===t.method)return o;if("staticmethod"==o.$type)return o;var f=o.__class__===t.method?i:n,m=function(){for(var t=[f],e=0,n=arguments.length;e<n;e++)t.push(arguments[e]);return o.apply(this,t)};return m.__class__=t.method,(m.__get__=function(e,n){var r=o.bind(null,n);return r.__class__=t.method,r.$infos={__self__:n,__func__:o,__name__:o.$infos.__name__,__qualname__:n.$infos.__name__+"."+o.$infos.__name__},r}).__class__=t.method_wrapper,m.__get__.$infos=o.$infos,void 0===i.$infos&&(console.log("no $infos",i),console.log(t.last(t.frames_stack))),m.$infos={__self__:f,__func__:o,__name__:r,__qualname__:i.$infos.__name__+"."+r},s&&(n.$method_cache=n.$method_cache||{},n.$method_cache[r]=[m,o]),m}return d}return o}var _,g=n.__getattr__;if(void 0===g&&void 0===(g=i.__getattr__))for(c=0,u=(_=i.__mro__).length;c<u&&void 0===(g=_[c].__getattr__);c++);if(void 0!==g)return i===t.module?g(r):g(n,r);throw e.AttributeError.$factory(r)},n.__gt__=function(){return e.NotImplemented},n.__hash__=function(e){var n=e.__hashvalue__;return void 0!==n?n:e.__hashvalue__=t.$py_next_hash--},n.__init__=function(){if(0==arguments.length)throw e.TypeError.$factory("descriptor '__init__' of 'object' object needs an argument");return e.None},n.__init_subclass__=function(){return t.args("__init_subclass__",0,{},[],arguments,{},null,null),e.None},n.__init_subclass__.$type="staticmethod",n.__le__=function(){return e.NotImplemented},n.__lt__=function(){return e.NotImplemented},n.__mro__=[],n.__new__=function(r,...i){if(void 0===r)throw e.TypeError.$factory("object.__new__(): not enough arguments");if(t.$getattr(r,"__init__")===n.__init__&&i.length>0)throw e.TypeError.$factory("object() takes no parameters");return{__class__:r,__dict__:t.empty_dict()}},n.__ne__=function(n,r){if(n===r)return!1;var i=t.$getattr(n,"__eq__",null);if(null!==i){var s=t.$call(i)(r);return s===e.NotImplemented?s:!t.$bool(s)}return e.NotImplemented},n.__reduce__=function(n){function r(e){return t.$call(e)()}r.$infos={__qualname__:"_reconstructor"};var i=[r];i.push(e.tuple.$factory([n.__class__].concat(n.__class__.__mro__)));var s=t.empty_dict();for(var o in n.__dict__.$string_dict)e.dict.$setitem(s.$string_dict,o,n.__dict__.$string_dict[o][0]);return console.log("object.__reduce__, d",s),i.push(s),e.tuple.$factory(i)},r.$infos={__name__:"__newobj__",__qualname__:"__newobj__"},e.__newobj__=r,n.__reduce_ex__=function(n){var i=[r],s=e.tuple.$factory([n.__class__]);Array.isArray(n)&&n.forEach((function(t){s.push(t)})),i.push(s);var o=t.empty_dict(),a=0;if(void 0===n.__dict__)throw e.TypeError.$factory("cannot pickle '"+t.class_name(n)+"' object");for(var l in n.__dict__.$string_dict)"__class__"==l||l.startsWith("$")||(e.dict.$setitem(o,l,n.__dict__.$string_dict[l][0]),a++);return 0==a&&(o=e.None),i.push(o),i.push(e.None),e.tuple.$factory(i)},n.__repr__=function(r){if(r===n)return"<class 'object'>";if(r.__class__===e.type)return"<class '"+r.__name__+"'>";var i=r.__class__.$infos.__module__;return void 0===i||i.startsWith("$")||"builtins"===i?"<"+t.class_name(r)+" object>":"<"+r.__class__.$infos.__module__+"."+t.class_name(r)+" object>"},n.__setattr__=function(r,i,s){if(void 0===s)throw e.TypeError.$factory("can't set attributes of built-in/extension type 'object'");if(r.__class__===n)throw void 0===n[i]?e.AttributeError.$factory("'object' object has no attribute '"+i+"'"):e.AttributeError.$factory("'object' object attribute '"+i+"' is read-only");return t.aliased_names[i]&&(i="$$"+i),r.__dict__?e.dict.$setitem(r.__dict__,i,s):r[i]=s,e.None},n.__setattr__.__get__=function(t){return function(e,r){n.__setattr__(t,e,r)}},n.__setattr__.__str__=function(){return"method object.setattr"},n.__str__=function(e){var n=t.$getattr(e,"__repr__");return t.$call(n)()},n.__subclasshook__=function(){return e.NotImplemented},n.$factory=function(){var t={__class__:n},e=[t].concat(Array.prototype.slice.call(arguments));return n.__init__.apply(null,e),t},t.set_func_names(n,"builtins"),t.make_class=function(t,r){var i={__class__:e.type,__mro__:[n],$infos:{__name__:t},$is_class:!0};return i.$factory=r,i},n}(__BRYTHON__),function(t){var e=t.builtins;t.$class_constructor=function(n,r,i,s,o){var a;i=i||[];var l=r.__module__;void 0===l&&(l=r.__module__=t.last(t.frames_stack)[2]);for(var c=0;c<i.length;c++)if(void 0===i[c])throw t.line_info=r.$def_line,e.NameError.$factory("name '"+s[c]+"' is not defined");var u={},h={};if(o)for(c=0;c<o.length;c++){var p=o[c][0],d=o[c][1];"metaclass"==p?a=d:u[p]=d,h[p]=d}var f=r;void 0!==r.__eq__&&void 0===r.__hash__&&(r.__hash__=e.None);var m=i.slice(),_=!1;for(c=0;c<i.length;c++)if(void 0===i[c]||void 0===i[c].__mro__){var g=t.$getattr(i[c],"__mro_entries__",e.None);if(g!==e.None){var y=e.list.$factory(g(i));i.splice(c,1,...y),_=!0,c--;continue}}if(void 0===a)if(i&&i.length>0){if(void 0===(a=i[0].__class__)){if("function"!=typeof i[0])throw e.TypeError.$factory("Argument of "+n+"is not a class (type '"+t.class_name(i[0])+"')");if(1!=i.length)throw e.TypeError.$factory("A Brython class can inherit at most 1 Javascript constructor");a=i[0].__class__=t.JSMeta,t.set_func_names(i[0],l)}for(c=1;c<i.length;c++){var v=i[c].__class__;if(v===a||e.issubclass(a,v));else if(e.issubclass(v,a))a=v;else if(a.__bases__&&-1==a.__bases__.indexOf(v))throw e.TypeError.$factory("metaclass conflict: the metaclass of a derived class must be a (non-strict) subclass of the metaclasses of all its bases")}}else a=e.type;var b=t.$getattr(a,"__prepare__",e.None),x=t.$call(b)(n,i);for(var w in x.__class__!==e.dict?set_class_item=t.$getattr(x,"__setitem__"):set_class_item=function(t,e){x.$string_dict[t]=[e,x.$order++]},r)if("__annotations__"==w)for(var p in void 0===x.$string_dict[w]&&(x.$string_dict[w]=[t.empty_dict(),x.$order++]),r[w].$string_dict)t.$setitem(x.$string_dict[w][0],p,r[w].$string_dict[p][0]);else"$"==w.charAt(0)&&"$$"!=w.substr(0,2)||set_class_item(w,r[w]);_&&set_class_item("__orig_bases__",e.tuple.$factory(m));var S={__bases__:i,__class__:a,__dict__:x};if(x.__class__===e.dict)for(var p in x.$string_dict)S[p]=x.$string_dict[p][0];else for(var M=t.$getattr(x,"__getitem__"),T=e.iter(x);;)try{S[p=e.next(T)]=M(p)}catch(t){break}S.__mro__=e.type.mro(S).slice(1);var E=!0,A={},$={},C=[S].concat(S.__mro__);for(c=0;c<C.length;c++){var B=0==c?f:C[c];for(var w in B)if(!A[w]){var L=B[w];"function"==typeof L&&(!0===L.__isabstractmethod__||L.$attrs&&L.$attrs.__isabstractmethod__?(E=!1,$[w]=!0):A[w]=!0)}}var R=r.__slots__;for(void 0!==R&&(R="string"==typeof R?[R]:e.list.$factory(R),x.__slots__=R),c=0;c<C.length-1;c++)for(var w in C[c]){if("__setattr__"==w){x.$has_setattr=!0;break}if(C[c][w]&&(C[c][w].__get__||C[c][w].__class__&&C[c][w].__class__.__get__)){x.$has_setattr=!0;break}}var N=e.type.__getattribute__(a,"__new__")(a,n,i,x);for(var w in N.__module__=l,N.$infos={__module__:l,__name__:t.from_alias(n),__qualname__:r.$qualname},N.$subclasses=[],r)"$"==w.charAt(0)&&"$$"!=w.substr(0,2)||"function"==typeof r[w]&&(r[w].$infos.$class=N);for(N.__class__===a&&e.type.__getattribute__(a,"__init__")(N,n,i,x),c=0;c<i.length;c++)i[c].$subclasses=i[c].$subclasses||[],i[c].$subclasses.push(N);var P=e.$$super.$factory(N,N);return e.$$super.__getattribute__(P,"__init_subclass__")({$nat:"kw",kw:u}),E||(N.$factory=function(){throw e.TypeError.$factory("Can't instantiate abstract class interface with abstract methods "+Object.keys($).join(", "))}),N.__qualname__=n.replace("$$",""),N};var n=t.make_class("type",(function(e,r,i){return 1==arguments.length?void 0===e?t.UndefinedClass:e.__class__||t.get_class(e):n.__new__(n,e,r,i)}));n.__call__=function(){for(var t=[],n=arguments[0],r=1,i=arguments.length;r<i;r++)t.push(arguments[r]);var s=e.type.__getattribute__(n,"__new__").apply(null,arguments);if(s.__class__===n){var o=e.type.__getattribute__(n,"__init__");if(o!==e.object.__init__){var a=[s].concat(t);o.apply(null,a)}}return s},n.__class__=n,n.__format__=function(t,n){return e.str.$factory(t)},n.__getattribute__=function(n,r){switch(r){case"__annotations__":for(var a=0,l=(p=[n].concat(n.__mro__)).length;a<l;a++)if(p[a].__dict__){var c=p[a].__dict__.$string_dict.__annotations__[0];if(c)if(void 0===_)_=c;else if(_.__class__===e.dict&&c.__class__===e.dict)for(var u in c.$string_dict)_.$string_dict[u]=c.$string_dict[u]}return void 0===_&&(_=t.empty_dict()),_;case"__bases__":return(_=n.__bases__||e.tuple.$factory()).__class__=e.tuple,0==_.length&&_.push(e.object),_;case"__class__":return n.__class__;case"__doc__":return n.__doc__||e.None;case"__setattr__":if(void 0!==n.__setattr__)var h=n.__setattr__;else h=function(t,e,n){t[e]=n};return i.$factory(r,n,h);case"__delattr__":return void 0!==n.__delattr__?n.__delattr__:i.$factory(r,n,(function(t){delete n[t]}))}if(void 0===(_=n[r])&&n.__slots__&&n.__slots__.indexOf(r)>-1)return s.$factory(r,n);if(n.__class__&&n.__class__[r]&&n.__class__[r].__get__&&n.__class__[r].__set__)return n.__class__[r].__get__(n);if(void 0===_){var p;if(void 0===(d=n[r]))for(void 0===(p=n.__mro__)&&console.log("pas de mro pour",n),a=0;a<p.length;a++){var d;if(void 0!==(d=p[a][r])){_=d;break}}else _=d;if(void 0===_){var f=n.__class__||t.get_class(n);if(void 0===(_=f[r])){var m=f.__mro__;for(a=0;a<m.length;a++){var _;if(void 0!==(_=m[a][r]))break}}if(void 0!==_){if(_.__class__===e.property)return _.fget(n);if("function"==typeof _){var g=_.bind(null,n);return g.__class__=t.method,g.$infos={__self__:n,__func__:_,__name__:r,__qualname__:n.$infos.__name__+"."+r,__module__:_.$infos?_.$infos.__module__:""},g}}if(void 0===_){var y=f.__getattr__;if(void 0===y)for(a=0;a<m.length;a++)if(void 0!==m[a].__getattr__){y=m[a].__getattr__;break}if(void 0!==y)return y(n,r)}}}if(void 0!==_){if(_.__class__===e.property)return _;if(_.__get__){if(_.__class__===o){var v=_.__get__(_.__func__,n);v.$infos={__func__:_,__name__:_.$infos.__name__,__qualname__:n.$infos.__name__+"."+_.$infos.__name__,__self__:n}}else v=_.__get__(n);return v}return!_.__class__||!_.__class__.__get__||r.startsWith("__")&&r.endsWith("__")?"function"==typeof _?(void 0===_.$infos&&t.debug>1&&console.log("warning: no attribute $infos for",_,"klass",n,"attr",r),"__new__"==r&&(_.$type="staticmethod"),"__class_getitem__"==r&&_.__class__!==t.method&&(_=e.classmethod.$factory(_)),"__init_subclass__"==r&&(_=e.classmethod.$factory(_)),_.__class__===t.method?_.__get__(null,n):_):_:_.__class__.__get__(_,e.None,n)}},n.__hash__=function(t){return e.hash(t)},n.__init__=function(){},n.__init_subclass__=function(){var n=t.args("__init_subclass__",1,{},[],arguments,{},"args","kwargs");if(void 0!==n.kwargs&&(n.kwargs.__class__!==e.dict||Object.keys(n.kwargs.$string_dict).length>0))throw e.TypeError.$factory("__init_subclass__() takes no keyword arguments");return e.None},n.__instancecheck__=function(e,n){var r=n.__class__||t.get_class(n);if(r===e)return!0;for(var i=0;i<r.__mro__.length;i++)if(r.__mro__[i]===e)return!0;return!1},n.__instancecheck__.$type="staticmethod",n.__name__={__get__:function(t){return t.$infos.__name__},__set__:function(t,e){t.$infos.__name__=e},__str__:function(t){return"type"},__eq__:function(t,e){return t.$infos.__name__==e}},n.__new__=function(r,i,s,o){var a=o.$string_dict.__module__;a&&(a=a[0]);var l={__class__:r,__bases__:s,__dict__:o,$infos:{__name__:i.replace("$$",""),__module__:a},$is_class:!0,$has_setattr:o.$has_setattr};l.__mro__=n.mro(l).slice(1);for(var c=t.dict_to_list(o),u=0;u<c.length;u++){var h=t.to_alias(c[u][0]),p=c[u][1];if("__module__"!==h&&void 0!==p){if(l[h]=p,p.__class__){var d=t.$getattr(p.__class__,"__set_name__",e.None);d!==e.None&&d(p,l,h)}if("function"==typeof p&&(void 0===p.$infos&&(console.log("type new",p,p+""),console.log(t.frames_stack.slice())),p.$infos.$class=l,p.$infos.__qualname__=i+"."+p.$infos.__name__,p.$infos.$defaults)){var f=p.$infos.$defaults;t.Function.__setattr__(p,"__defaults__",f)}}}return l},n.__repr__=n.__str__=function(t){void 0===t.$infos&&console.log("no $infos",t);var e=t.$infos.__qualname__;return t.$infos.__module__&&"builtins"!=t.$infos.__module__&&!t.$infos.__module__.startsWith("$")&&(e=t.$infos.__module__+"."+e),"<class '"+e+"'>"},n.__prepare__=function(){return t.empty_dict()},n.__qualname__={__get__:function(t){return t.$infos.__qualname__||t.$infos.__name__},__set__:function(t,e){t.$infos.__qualname__=e},__str__:function(t){console.log("type.__qualname__")},__eq__:function(t,e){return t.$infos.__qualname__==e}},n.mro=function(n){for(var r=n.__bases__,i=[],s=0,o=0;o<r.length;o++){r[o]===e.str&&(r[o]=t.StringSubclass);var a=[],l=0;if(void 0===r[o]||void 0===r[o].__mro__){if(void 0===r[o].__class__)return[e.object];throw e.TypeError.$factory("Object passed as base class is not a class")}a[l++]=r[o];var c=r[o].__mro__;c[0]===r[o]&&c.splice(0,1);for(var u=0;u<c.length;u++)a[l++]=c[u];i[s++]=a}-1==r.indexOf(e.object)&&(r=r.concat(e.tuple.$factory([e.object]))),i[s++]=r.slice();for(var h=[n],p=1;;){var d=[];for(l=0,o=0;o<i.length;o++)i[o].length>0&&(d[l++]=i[o]);if(0==d.length)break;for(o=0;o<d.length;o++){for(var f=d[o][0],m=[],_=(l=0,0);_<d.length;_++){var g=d[_];g.slice(1).indexOf(f)>-1&&(m[l++]=g)}if(!(m.length>0))break;f=null}if(null===f)throw e.TypeError.$factory("inconsistent hierarchy, no C3 MRO is possible");for(h[p++]=f,o=0;o<i.length;o++)i[o][0]===f&&i[o].shift()}return h[h.length-1]!==e.object&&(h[p++]=e.object),h},n.__subclasscheck__=function(n,r){var i=n;return i===e.str?i=t.StringSubclass:i===e.float&&(i=t.FloatSubclass),void 0===r.__bases__?n===e.object:r.__bases__.indexOf(i)>-1},t.set_func_names(n,"builtins"),e.type=n;var r=t.make_class("wrapper_descriptor");t.set_func_names(r,"builtins"),n.__call__.__class__=r,t.$instance_creator=function(n){if(void 0!==n.$instanciable)return function(){throw e.TypeError.$factory("Can't instantiate abstract class interface with abstract methods")};var r,i=n.__class__;if(i!==e.type||n.__bases__&&0!=n.__bases__.length){r=e.type.__getattribute__(i,"__call__");var s=function(){return r.bind(null,n).apply(null,arguments)}}else s=n.hasOwnProperty("__new__")?n.hasOwnProperty("__init__")?function(){var t=n.__new__.bind(null,n).apply(null,arguments);return n.__init__.bind(null,t).apply(null,arguments),t}:function(){return n.__new__.bind(null,n).apply(null,arguments)}:n.hasOwnProperty("__init__")?function(){var e={__class__:n,__dict__:t.empty_dict()};return n.__init__.bind(null,e).apply(null,arguments),e}:function(){if(arguments.length>0&&(1!=arguments.length||!arguments[0].$nat||0!=Object.keys(arguments[0].kw).length))throw e.TypeError.$factory("object() takes no parameters");return{__class__:n,__dict__:t.empty_dict()}};return s.__class__=t.Function,s.$infos={__name__:n.$infos.__name__,__module__:n.$infos.__module__},s};var i=t.method_wrapper=t.make_class("method_wrapper",(function(t,e,n){var r=function(){return n.apply(null,arguments)};return r.$infos={__name__:t,__module__:e.__module__},r}));i.__str__=i.__repr__=function(t){return"<method '"+t.$infos.__name__+"' of function object>"};var s=t.make_class("member_descriptor",(function(t,e){return{__class__:s,cls:e,attr:t}}));s.__str__=s.__repr__=function(t){return"<member '"+t.attr+"' of '"+t.cls.$infos.__name__+"' objects>"},t.set_func_names(s,"builtins");var o=t.method=t.make_class("method",(function(e,n){var r=function(){return t.$call(e).bind(null,n).apply(null,arguments)};return r.__class__=o,r.$infos=e.$infos,r}));o.__eq__=function(t,e){return void 0!==t.$infos&&void 0!==e.$infos&&t.$infos.__func__===e.$infos.__func__&&t.$infos.__self__===e.$infos.__self__},o.__ne__=function(e,n){return!t.method.__eq__(e,n)},o.__get__=function(e){var n=function(){return e(arguments)};return n.__class__=t.method_wrapper,n.$infos=o.$infos,n},o.__getattribute__=function(n,r){var i=n.$infos;if(i&&i[r]){if("__code__"==r){var s={__class__:t.Code};for(var r in i.__code__)s[r]=i.__code__[r];return s}return i[r]}return o.hasOwnProperty(r)?e.object.__getattribute__(n,r):t.Function.__getattribute__(n.$infos.__func__,r)},o.__repr__=o.__str__=function(t){return"<bound method "+t.$infos.__qualname__+" of "+e.str.$factory(t.$infos.__self__)+">"},o.__setattr__=function(t,n,r){if("__class__"==n)throw e.TypeError.$factory("__class__ assignment only supported for heap types or ModuleType subclasses");throw e.AttributeError.$factory("'method' object has no attribute '"+n+"'")},t.set_func_names(o,"builtins"),t.method_descriptor=t.make_class("method_descriptor"),t.classmethod_descriptor=t.make_class("classmethod_descriptor"),t.GenericAlias=t.make_class("GenericAlias",(function(e,n){return{__class__:t.GenericAlias,origin_class:e,items:n}})),t.GenericAlias.__args__={__get__:function(e){return t.fast_tuple(e.items)}},t.GenericAlias.__call__=function(t,...e){return t.origin_class.$factory.apply(null,e)},t.GenericAlias.__eq__=function(e,n){return t.rich_comp("__eq__",e.origin_class,n.origin_class)&&t.rich_comp("__eq__",e.items,n.items)},t.GenericAlias.__getitem__=function(n,r){throw e.TypeError.$factory("descriptor '__getitem__' for '"+n.origin_class.$infos.__name__+"' objects doesn't apply to a '"+t.class_name(r)+"' object")},t.GenericAlias.__origin__={__get__:function(t){return t.origin_class}},t.GenericAlias.__parameters__={__get__:function(e){return t.fast_tuple([])}},t.GenericAlias.__repr__=function(t){for(var n=t.items,r=0,i=n.length;r<i;r++)n[r]===e.Ellipsis?n[r]="...":n[r]=n[r].$infos.__name__;return t.origin_class.$infos.__qualname__+"["+n.join(", ")+"]"},e.object.__class__=n}(__BRYTHON__),function($B){var _b_=$B.builtins,_window=self,isWebWorker="undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator;function index_error(t){var e="string"==typeof t?"string":"list";throw _b_.IndexError.$factory(e+" index out of range")}$B.args=function(t,e,n,r,i,s,o,a){t.startsWith("lambda_"+$B.lambda_magic)&&(t="<lambda>");var l,c,u=!1,h=i.length,p=0,d=r.indexOf("/");if(-1!=d&&(r.splice(d,1),c=r.slice(0,d)),h>0&&i[h-1].$nat&&(h--,Object.keys(i[h].kw).length>0)){u=!0;var f=i[h].kw;if(Array.isArray(f)){for(var m=f[0],_=1,g=f.length;_<g;_++){var y=f[_];if(y.__class__===_b_.dict){for(var v in y.$numeric_dict)throw _b_.TypeError.$factory(t+"() keywords must be strings");for(var v in y.$object_dict)throw _b_.TypeError.$factory(t+"() keywords must be strings");for(var v in y.$string_dict){if(void 0!==m[v])throw _b_.TypeError.$factory(t+"() got multiple values for argument '"+v+"'");m[v]=y.$string_dict[v][0]}}else for(var b=_b_.iter(y),x=$B.$getattr(y,"__getitem__");;)try{if("string"!=typeof(v=_b_.next(b)))throw _b_.TypeError.$factory(t+"() keywords must be strings");if(void 0!==m[v])throw _b_.TypeError.$factory(t+"() got multiple values for argument '"+v+"'");m[v]=x(v)}catch(t){if($B.is_exc(t,[_b_.StopIteration]))break;throw t}}f=m}}if(o&&(n[o]=[],n[o].__class__=_b_.tuple),a&&(l=$B.empty_dict()),h>e){if(null===o||"*"==o)throw A=t+"() takes "+e+" positional argument"+(e>1?"s":"")+" but more were given",_b_.TypeError.$factory(A);for(_=e;_<h;_++)n[o].push(i[_]);h=e}for(_=0;_<h;_++)n[r[_]]=i[_],p++;if(p==e&&e===r.length&&!u)return a&&(n[a]=l),n;if(u)for(var w in f){var S=f[w],M=$B.to_alias(w);if(void 0===n[M]){if(!a)throw _b_.TypeError.$factory(t+"() got an unexpected keyword argument '"+w+"'");"$$"==w.substr(0,2)&&(w=w.substr(2)),l.$string_dict[w]=[S,l.$order++]}else{if(null!==n[M])throw _b_.TypeError.$factory(t+"() got multiple values for argument '"+w+"'");if(c&&c.indexOf(M)>-1)throw _b_.TypeError.$factory(t+"() got an unexpected keyword argument '"+w+"'");n[M]=S}}var T=[];for(var E in n)null===n[E]&&(void 0!==s[E]?n[E]=s[E]:T.push("'"+E+"'"));if(T.length>0){if(1==T.length)throw _b_.TypeError.$factory(t+" missing 1 positional argument: "+T[0]);var A=t+" missing "+T.length+" positional arguments: ";throw A+=T.join(" and "),_b_.TypeError.$factory(A)}return a&&(n[a]=l),n},$B.wrong_nb_args=function(t,e,n,r){if(e<n){var i=n-e;throw _b_.TypeError.$factory(t+"() missing "+i+" positional argument"+(i>1?"s":"")+": "+r.slice(e))}throw _b_.TypeError.$factory(t+"() takes "+n+" positional argument"+(n>1?"s":"")+" but more were given")},$B.get_class=function(t){if(null===t)return $B.$NoneDict;if(void 0===t)return $B.UndefinedClass;var e=t.__class__;if(void 0===e)switch(typeof t){case"number":return t%1==0?_b_.int:_b_.float;case"string":return _b_.str;case"boolean":return _b_.bool;case"function":return t.$is_js_func?$B.JSObj:(t.__class__=$B.Function,$B.Function);case"object":if(Array.isArray(t)){if(Object.getPrototypeOf(t)===Array.prototype)return t.__class__=_b_.list,_b_.list}else{if(t.constructor===Number)return _b_.float;if("undefined"!=typeof Node&&t instanceof Node)return $B.DOMNode}}return void 0===e?$B.JSObj:e},$B.class_name=function(t){var e=$B.get_class(t);return e===$B.JSObj?"Javascript "+t.constructor.name:e.$infos.__name__},$B.$list_comp=function(t){for(var e=$B.UUID(),n="x"+e+" = []\n",r=0,i=1,s=t.length;i<s;i++){var o=t[i].replace(/\s+$/,"").replace(/\n/g,"");n+=" ".repeat(r)+o+":\n",r+=4}return n+=" ".repeat(r),[n+="x"+e+".append("+t[0]+")\n",e]},$B.$dict_comp=function(t,e,n,r){for(var i=$B.UUID(),s="comp_result_"+$B.lambda_magic+i,o=s+" = {}\n",a=0,l=1,c=n.length;l<c;l++){var u=n[l].replace(/\s+$/,"").replace(/\n/g,"");o+="    ".repeat(a)+u+":\n",a++}o+="    ".repeat(a)+s+".update({"+n[0]+"})";var h=r+","+t,p="dc"+i,d=$B.py2js({src:o,is_comp:!0,line_info:h},t,p,e,r),f=d.outermost_expr.to_js(),m=d.to_js();return m="(function(expr){"+(m+="\nreturn "+s+"\n")+"})("+f+")",$B.clear_ns(p),delete $B.$py_src[p],m},$B.$gen_expr=function(t,e,n,r,i){for(var s=$B.UUID(),o=(i?"set_comp"+$B.lambda_magic:"__ge")+s,a=`def ${o}(expr):\n`,l=1,c=1,u=n.length;c<u;c++){var h=n[c].replace(/\s+$/,"").replace(/\n/g,"");a+=" ".repeat(l)+h+":\n",l+=4}a+=" ".repeat(l),a+="yield ("+n[0]+")";var p=r+","+t,d=$B.py2js({src:a,is_comp:!0,line_info:p,ix:s},o,o,e,r),f=d.to_js(),m=f.split("\n");void 0===d.outermost_expr&&console.log("no outermost",t,e);var _=d.outermost_expr.to_js();return f=m.join("\n"),"(function($locals_"+o+"){"+(f+="\nvar $res = $B.generator.$factory("+o+")("+_+");\nreturn $res\n")+"})($locals)\n"},$B.copy_namespace=function(){var t={};for(const n of $B.frames_stack)for(const r of[n[1],n[3]])for(var e in r)!e.startsWith("$$")&&e.startsWith("$")||(t[e]=r[e]);return t},$B.clear_ns=function(t){t.startsWith("__ge")&&console.log("clear ns",t);var e=t.length;for(var n in $B.$py_module_path)n.substr(0,e)==t&&($B.$py_module_path[n]=null,delete $B.$py_module_path[n]);$B.$py_src[t]=null,delete $B.$py_src[t];var r=t.replace(/\./g,"_");r!=t&&$B.clear_ns(r)},$B.from_alias=function(t){return"$$"==t.substr(0,2)&&$B.aliased_names[t.substr(2)]?t.substr(2):t},$B.$search=function(t,e){var n=$B.last($B.frames_stack);if(void 0!==n[1][t])return n[1][t];if(void 0!==n[3][t])return n[3][t];if(void 0!==_b_[t])return _b_[t];throw n[0]==n[2]||"class"==n[1].$type||n[1].$exec_locals?_b_.NameError.$factory("name '"+t+"' is not defined"):_b_.UnboundLocalError.$factory("local variable '"+t+"' referenced before assignment")},$B.$global_search=function(t,e){for(var n=0;n<$B.frames_stack.length;n++){var r=$B.frames_stack[n];if(e.indexOf(r[0])>-1&&void 0!==r[1][t])return r[1][t];if(e.indexOf(r[2])>-1&&void 0!==r[3][t])return r[3][t]}for(n=0;n<e.length;n++){var i=e[n];if($B.imported[i]&&$B.imported[i][t])return $B.imported[i][t]}throw _b_.NameError.$factory("name '"+$B.from_alias(t)+"' is not defined")},$B.$local_search=function(t){var e=$B.last($B.frames_stack);if(void 0!==e[1][t])return e[1][t];throw _b_.UnboundLocalError.$factory("local variable '"+$B.from_alias(t)+"' referenced before assignment")},$B.$check_def=function(t,e){if(void 0!==e)return e;if(void 0!==_b_[t])return _b_[t];var n=$B.last($B.frames_stack);if(void 0!==n[3][t])return n[3][t];throw _b_.NameError.$factory("name '"+$B.from_alias(t)+"' is not defined")},$B.$check_def_local=function(t,e){if(void 0!==e)return e;throw _b_.UnboundLocalError.$factory("local variable '"+$B.from_alias(t)+"' referenced before assignment")},$B.$check_def_free=function(t,e){if(void 0!==e)return e;for(var n,r=$B.frames_stack.length-1;r>=0;r--){if(void 0!==(n=$B.frames_stack[r][1][t]))return n;if(void 0!==(n=$B.frames_stack[r][3][t]))return n}throw _b_.NameError.$factory("free variable '"+$B.from_alias(t)+"' referenced before assignment in enclosing scope")},$B.$check_def_free1=function(t,e){for(var n,r=$B.frames_stack.length-1;r>=0;r--){var i=$B.frames_stack[r];if(void 0!==(n=i[1][t]))return n;if(i[1].$parent&&void 0!==(n=i[1].$parent[t]))return n;if(i[2]==e&&void 0!==(n=i[3][t]))return n}throw _b_.NameError.$factory("free variable '"+$B.from_alias(t)+"' referenced before assignment in enclosing scope")},$B.$JS2Py=function(t){return"number"==typeof t?t%1==0?t:_b_.float.$factory(t):null==t?_b_.None:(Array.isArray(t)&&Object.getPrototypeOf(t)===Array.prototype&&(t.$brython_class="js"),t)},$B.list_key=function(t,e){(e=$B.$GetInt(e))<0&&(e+=t.length);var n=t[e];if(void 0===n)throw _b_.IndexError.$factory("list index out of range");return n},$B.list_slice=function(t,e,n){return null===e?e=0:(e=$B.$GetInt(e))<0&&(e=Math.max(0,e+t.length)),null===n?t.slice(e):((n=$B.$GetInt(n))<0&&(n=Math.max(0,n+t.length)),t.slice(e,n))},$B.list_slice_step=function(t,e,n,r){if(null===r||1==r)return $B.list_slice(t,e,n);if(0==r)throw _b_.ValueError.$factory("slice step cannot be zero");r=$B.$GetInt(r),null===e?e=r>=0?0:t.length-1:(e=$B.$GetInt(e))<0&&(e=Math.min(0,e+t.length)),null===n?n=r>=0?t.length:-1:(n=$B.$GetInt(n))<0&&(n=Math.max(0,n+t.length));var i=[];if(r>0)for(var s=e;s<n;s+=r)i.push(t[s]);else for(s=e;s>n;s+=r)i.push(t[s]);return i},$B.$getitem=function(t,e){var n=Array.isArray(t)&&t.__class__===_b_.list;if("number"==typeof e&&(n||"string"==typeof t)){if(void 0!==t[e=e>=0?e:t.length+e])return t[e];index_error(t)}try{e=$B.$GetInt(e)}catch(t){}if((n||"string"==typeof t)&&"number"==typeof e){if(void 0!==t[e=e>=0?e:t.length+e])return t[e];index_error(t)}if(t.$is_class){var r=$B.$getattr(t,"__class_getitem__",_b_.None);if(r!==_b_.None)return r(e);if(t.__class__&&(r=$B.$getattr(t.__class__,"__getitem__",_b_.None))!==_b_.None)return r(t,e)}if(n)return _b_.list.$getitem(t,e);var i=$B.$getattr(t,"__getitem__",_b_.None);if(i!==_b_.None)return i(e);throw _b_.TypeError.$factory("'"+$B.class_name(t)+"' object is not subscriptable")},$B.getitem_slice=function(t,e){var n;return Array.isArray(t)?(e.start===_b_.None&&e.stop===_b_.None?e.step===_b_.None||1==e.step?n=t.slice():-1==e.step&&(n=t.slice().reverse()):e.step===_b_.None&&(e.start===_b_.None&&(e.start=0),e.stop===_b_.None&&(e.stop=t.length),"number"==typeof e.start&&"number"==typeof e.stop&&(e.start<0&&(e.start+=t.length),e.stop<0&&(e.stop+=t.length),n=t.slice(e.start,e.stop))),n?(n.__class__=t.__class__,n):_b_.list.$getitem(t,e)):$B.$getattr(t,"__getitem__")(e)},$B.set_list_key=function(t,e,n){try{e=$B.$GetInt(e)}catch(i){if(_b_.isinstance(e,_b_.slice)){var r=_b_.slice.$conv_for_seq(e,t.length);return $B.set_list_slice_step(t,r.start,r.stop,r.step,n)}}if(e<0&&(e+=t.length),void 0===t[e])throw console.log(t,e),_b_.IndexError.$factory("list assignment index out of range");t[e]=n},$B.set_list_slice=function(t,e,n,r){null===e?e=0:(e=$B.$GetInt(e))<0&&(e=Math.max(0,e+t.length)),null===n&&(n=t.length),(n=$B.$GetInt(n))<0&&(n=Math.max(0,n+t.length));var i=_b_.list.$factory(r);t.splice.apply(t,[e,n-e].concat(i))},$B.set_list_slice_step=function(t,e,n,r,i){if(null===r||1==r)return $B.set_list_slice(t,e,n,i);if(0==r)throw _b_.ValueError.$factory("slice step cannot be zero");r=$B.$GetInt(r),e=null===e?r>0?0:t.length-1:$B.$GetInt(e),n=null===n?r>0?t.length:-1:$B.$GetInt(n);var s,o=_b_.list.$factory(i),a=0,l=0;s=r>0?function(t){return t<n}:function(t){return t>n};for(var c=e;s(c);c+=r)l++;if(l!=o.length)throw _b_.ValueError.$factory("attempt to assign sequence of size "+o.length+" to extended slice of size "+l);for(c=e;s(c);c+=r)t[c]=o[a],a++},$B.$setitem=function(t,e,n){if(!Array.isArray(t)||void 0!==t.__class__||"number"!=typeof e||_b_.isinstance(t,_b_.tuple)){if(t.__class__!==_b_.dict)return t.__class__===_b_.list?_b_.list.$setitem(t,e,n):void $B.$getattr(t,"__setitem__")(e,n);_b_.dict.$setitem(t,e,n)}else{if(e<0&&(e+=t.length),void 0===t[e])throw _b_.IndexError.$factory("list assignment index out of range");t[e]=n}},$B.augm_item_add=function(t,e,n){if(Array.isArray(t)&&"number"==typeof e&&void 0!==t[e]){if(Array.isArray(t[e])&&Array.isArray(n)){for(var r=0,i=n.length;r<i;r++)t[e].push(n[r]);return}if("string"==typeof t[e]&&"string"==typeof n)return void(t[e]+=n)}var s=$B.$getattr;try{var o=s(s(t,"__getitem__")(e),"__iadd__")}catch(r){return void s(t,"__setitem__")(e,s(s(t,"__getitem__")(e),"__add__")(n))}o(n)};for(var augm_item_src=""+$B.augm_item_add,augm_ops=[["-=","sub"],["*=","mul"]],i=0,len=augm_ops.length;i<len;i++){var augm_code=augm_item_src.replace(/add/g,augm_ops[i][1]);augm_code=augm_code.replace(/\+=/g,augm_ops[i][0]),eval("$B.augm_item_"+augm_ops[i][1]+"="+augm_code)}$B.extend=function(t,e){for(var n=2;n<arguments.length;n++)for(var r=arguments[n],i=_b_.iter(r),s=$B.$getattr(r,"__getitem__");;)try{var o=_b_.next(i);if("string"!=typeof o)throw _b_.TypeError.$factory(t+"() keywords must be strings");if(void 0!==e[o])throw _b_.TypeError.$factory(t+"() got multiple values for argument '"+o+"'");e[o]=s(o)}catch(t){if(_b_.isinstance(t,[_b_.StopIteration]))break;throw t}return e},$B.extend_list=function(){for(var t=Array.prototype.slice.call(arguments,0,arguments.length-1),e=$B.last(arguments),n=_b_.iter(e);;)try{t.push(_b_.next(n))}catch(t){if(_b_.isinstance(t,[_b_.StopIteration]))break;throw t}return t},$B.$test_item=function(t){return $B.$test_result=t,_b_.bool.$factory(t)},$B.$test_expr=function(){return $B.$test_result},$B.$is=function(t,e){return t instanceof Number&&e instanceof Number?t.valueOf()==e.valueOf():t===_b_.int&&e==$B.long_int||t===$B.long_int&&e===_b_.int||t===e},$B.$is_member=function(t,e){var n,r,i;try{i=$B.$getattr(e.__class__||$B.get_class(e),"__contains__")}catch(t){}if(i)return $B.$call(i)(e,t);try{r=_b_.iter(e)}catch(t){}if(r)for(;;)try{var s=_b_.next(r);if($B.rich_comp("__eq__",s,t))return!0}catch(t){return!1}try{n=$B.$getattr(e,"__getitem__")}catch(t){throw _b_.TypeError.$factory("'"+$B.class_name(e)+"' object is not iterable")}if(n)for(var o=-1;;){o++;try{if(s=n(o),$B.rich_comp("__eq__",s,t))return!0}catch(t){if(t.__class__===_b_.IndexError)return!1;throw t}}},$B.$call=function(t){if(t.__class__===$B.method)return t;if(t.$is_func||"function"==typeof t)return t;if(t.$factory)return t.$factory;if(t.$is_class)return t.$factory=$B.$instance_creator(t);try{return $B.$getattr(t,"__call__")}catch(e){throw _b_.TypeError.$factory("'"+$B.class_name(t)+"' object is not callable")}};var $io=$B.make_class("io",(function(t){return{__class__:$io,out:t}}));function $err(t,e,n){var r="unsupported operand type(s) for "+t+" : '"+e.$infos.__name__+"' and '"+$B.class_name(n)+"'";throw _b_.TypeError.$factory(r)}$io.flush=function(){},$io.write=function(t,e){return console[t.out](e),_b_.None},void 0!==console.error?$B.stderr=$io.$factory("error"):$B.stderr=$io.$factory("log"),$B.stdout=$io.$factory("log"),$B.stdin={__class__:$io,__original__:!0,closed:!1,len:1,pos:0,read:function(){return""},readline:function(){return""}},$B.make_iterator_class=function(t){var e={__class__:_b_.type,__mro__:[_b_.object],$factory:function(t){return{__class__:e,__dict__:$B.empty_dict(),counter:-1,items:t,len:t.length}},$infos:{__name__:t},$is_class:!0,__iter__:function(t){return t.counter=void 0===t.counter?-1:t.counter,t.len=t.items.length,t},__len__:function(t){return t.items.length},__next__:function(t){if("function"==typeof t.len_func&&t.len_func()!=t.len)throw _b_.RuntimeError.$factory("dictionary changed size during iteration");if(t.counter++,t.counter<t.items.length){var e=t.items[t.counter];return"js"==t.items.$brython_class&&(e=$B.$JS2Py(e)),e}throw _b_.StopIteration.$factory("StopIteration")},__reduce_ex__:function(t,e){return $B.fast_tuple([_b_.iter,_b_.tuple.$factory([t.items])])}};return $B.set_func_names(e,"builtins"),e};var ropnames=["add","sub","mul","truediv","floordiv","mod","pow","lshift","rshift","and","xor","or"],ropsigns=["+","-","*","/","//","%","**","<<",">>","&","^","|"];function exit_ctx_managers_in_generators(t){for(key in t[1])t[1][key]&&t[1][key].__class__==$B.generator&&t[1][key].return()}$B.make_rmethods=function(t){for(var e=0,n=ropnames.length;e<n;e++)void 0===t["__"+ropnames[e]+"__"]&&(t["__"+ropnames[e]+"__"]=function(e,n){return function(r,i){try{return $B.$getattr(i,"__r"+e+"__")(r)}catch(e){$err(n,t,i)}}}(ropnames[e],ropsigns[e]))},$B.UUID=function(){return $B.$py_UUID++},$B.InjectBuiltins=function(){var t=["var _b_ = $B.builtins"],e=1;for(var n in $B.builtins)t[e++]="var "+n+'=_b_["'+n+'"]';return t.join(";")},$B.$GetInt=function(t){if("number"==typeof t||t.constructor===Number)return t;if("boolean"==typeof t)return t?1:0;if(_b_.isinstance(t,_b_.int))return t;if(_b_.isinstance(t,_b_.float))return t.valueOf();if(!t.$is_class){try{return $B.$getattr(t,"__int__")()}catch(t){}try{return $B.$getattr(t,"__index__")()}catch(t){}}throw _b_.TypeError.$factory("'"+$B.class_name(t)+"' object cannot be interpreted as an integer")},$B.to_num=function(t,e){for(var n={__complex__:_b_.complex,__float__:_b_.float,__index__:_b_.int,__int__:_b_.int},r=t.__class__||$B.get_class(t),i=0;i<e.length;i++){var s={},o=$B.$getattr(r,e[i],s);if(o!==s){var a=o(t);if(!_b_.isinstance(a,n[e[i]]))throw console.log(a,e[i],n[e[i]]),_b_.TypeError.$factory(e[i]+"returned non-"+n[e[i]].$infos.__name__+"(type "+$B.get_class(a)+")");return a}}return null},$B.PyNumber_Index=function(t){switch(typeof t){case"boolean":return t?1:0;case"number":return t;case"object":if(t.__class__===$B.long_int)return t;if(_b_.isinstance(t,_b_.int))return t.$brython_value;var e=$B.$getattr(t,"__index__",_b_.None);if(e!==_b_.None)return e="function"==typeof e?e:$B.$getattr(e,"__call__"),$B.int_or_bool(e());default:throw _b_.TypeError.$factory("'"+$B.class_name(t)+"' object cannot be interpreted as an integer")}},$B.int_or_bool=function(t){switch(typeof t){case"boolean":return t?1:0;case"number":return t;case"object":if(t.__class__===$B.long_int)return t;throw _b_.TypeError.$factory("'"+$B.class_name(t)+"' object cannot be interpreted as an integer");default:throw _b_.TypeError.$factory("'"+$B.class_name(t)+"' object cannot be interpreted as an integer")}},$B.enter_frame=function(t){if($B.frames_stack.push(t),$B.tracefunc&&$B.tracefunc!==_b_.None){if(t[4]===$B.tracefunc||$B.tracefunc.$infos&&t[4]&&t[4]===$B.tracefunc.$infos.__func__)return $B.tracefunc.$frame_id=t[0],_b_.None;for(var e=$B.frames_stack.length-1;e>=0;e--)if($B.frames_stack[e][0]==$B.tracefunc.$frame_id)return _b_.None;return $B.tracefunc($B._frame.$factory($B.frames_stack,$B.frames_stack.length-1),"call",_b_.None)}return _b_.None},$B.trace_exception=function(){var t=$B.last($B.frames_stack);if(t[0]==$B.tracefunc.$current_frame_id)return _b_.None;var e=t[1].$f_trace,n=t[1].$current_exception;return e($B._frame.$factory($B.frames_stack,$B.frames_stack.length-1),"exception",$B.fast_tuple([n.__class__,n,$B.traceback.$factory(n)]))},$B.trace_line=function(){var t=$B.last($B.frames_stack);return t[0]==$B.tracefunc.$current_frame_id?_b_.None:(0,t[1].$f_trace)($B._frame.$factory($B.frames_stack,$B.frames_stack.length-1),"line",_b_.None)},$B.set_line=function(t){var e=$B.last($B.frames_stack);if($B.tracefunc&&e[0]==$B.tracefunc.$current_frame_id)return _b_.None;e[1].$line_info=t;var n=e[1].$f_trace;if(n!==_b_.None){var r=$B._frame.$factory($B.frames_stack,$B.frames_stack.length-1);e[1].$ftrace=n(r,"line",_b_.None)}return!0},$B.trace_return=function(t){var e=$B.last($B.frames_stack),n=e[1].$f_trace,r=$B._frame.$factory($B.frames_stack,$B.frames_stack.length-1);if(e[0]==$B.tracefunc.$current_frame_id)return _b_.None;n(r,"return",t)},$B.set_cm_in_generator=function(t){void 0!==t&&$B.frames_stack.forEach((function(e){e[1].$cm_in_gen=e[1].$cm_in_gen||new Set,e[1].$cm_in_gen.add(t)}))},$B.leave_frame=function(t){if(0!=$B.frames_stack.length){t&&void 0!==t.value&&$B.tracefunc&&(void 0===$B.last($B.frames_stack)[1].$f_trace&&($B.last($B.frames_stack)[1].$f_trace=$B.tracefunc),$B.last($B.frames_stack)[1].$f_trace!==_b_.None&&$B.trace_return(t.value));var e=$B.frames_stack.pop();if(e[1].$current_exception=void 0,e[1].$close_generators)for(var n=0,r=e[1].$close_generators.length;n<r;n++){var i=e[1].$close_generators[n];i.$has_run&&i.return()}return _b_.None}console.log("empty stack")},$B.leave_frame_exec=function(t){if($B.profile>0&&$B.$profile.return(),0!=$B.frames_stack.length){var e=$B.frames_stack.pop();exit_ctx_managers_in_generators(e);for(var n=$B.frames_stack.length-1;n>=0;n--)$B.frames_stack[n][2]==e[2]&&($B.frames_stack[n][3]=e[3])}else console.log("empty stack")};var min_int=Math.pow(-2,53),max_int=Math.pow(2,53)-1;$B.is_safe_int=function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];if(e<min_int||e>max_int)return!1}return!0},$B.add=function(t,e){if("number"==typeof t.valueOf()&&"number"==typeof e.valueOf()){if("number"==typeof t&&"number"==typeof e){var n=t+e;return n<$B.max_int&&n>$B.min_int?n:n===1/0?_b_.float.$factory("inf"):n===-1/0?_b_.float.$factory("-inf"):isNaN(n)?_b_.float.$factory("nan"):$B.long_int.__add__($B.long_int.$factory(t),$B.long_int.$factory(e))}return new Number(t+e)}if("string"==typeof t&&"string"==typeof e)return t+e;try{var r=$B.$getattr(t.__class__||$B.get_class(t),"__add__")}catch(n){if(n.__class__===_b_.AttributeError)throw _b_.TypeError.$factory("unsupported operand type(s) for +: '"+$B.class_name(t)+"' and '"+$B.class_name(e)+"'");throw n}var i=$B.$call(r)(t,e);return i===_b_.NotImplemented?$B.rich_op("add",t,e):i},$B.div=function(t,e){var n=t/e;return t>min_int&&t<max_int&&e>min_int&&e<max_int&&n>min_int&&n<max_int?n:$B.long_int.__truediv__($B.long_int.$factory(t),$B.long_int.$factory(e))},$B.eq=function(t,e){return t>min_int&&t<max_int&&e>min_int&&e<max_int?t==e:$B.long_int.__eq__($B.long_int.$factory(t),$B.long_int.$factory(e))},$B.floordiv=function(t,e){var n=t/e;return t>min_int&&t<max_int&&e>min_int&&e<max_int&&n>min_int&&n<max_int?Math.floor(n):$B.long_int.__floordiv__($B.long_int.$factory(t),$B.long_int.$factory(e))},$B.mul=function(t,e){var n="number"!=typeof t||"number"!=typeof e?new Number(t*e):t*e;if(t>min_int&&t<max_int&&e>min_int&&e<max_int&&n>min_int&&n<max_int)return n;if("number"!=typeof t&&t.__class__!==$B.long_int||"number"!=typeof e&&e.__class__!==$B.long_int)return n;if("number"==typeof t&&isNaN(t)||"number"==typeof e&&isNaN(e))return _b_.float.$factory("nan");switch(t){case 1/0:case-1/0:return 0==e?_b_.float.$factory("nan"):e>0?t:-t}return $B.long_int.__mul__($B.long_int.$factory(t),$B.long_int.$factory(e))},$B.sub=function(t,e){var n="number"!=typeof t||"number"!=typeof e?new Number(t-e):t-e;return t>min_int&&t<max_int&&e>min_int&&e<max_int&&n>min_int&&n<max_int||"number"!=typeof t&&t.__class__!==$B.long_int||"number"!=typeof e&&e.__class__!==$B.long_int?n:"number"==typeof t&&isNaN(t)||"number"==typeof e&&isNaN(e)?_b_.float.$factory("nan"):$B.long_int.__sub__($B.long_int.$factory(t),$B.long_int.$factory(e))},$B.ge=function(t,e){return"number"==typeof t&&"number"==typeof e?t>=e:"number"==typeof t&&"number"!=typeof e?!e.pos:"number"!=typeof t&&"number"==typeof e?!0===t.pos:$B.long_int.__ge__(t,e)},$B.gt=function(t,e){return"number"==typeof t&&"number"==typeof e?t>e:"number"==typeof t&&"number"!=typeof e?!e.pos:"number"!=typeof t&&"number"==typeof e?!0===t.pos:$B.long_int.__gt__(t,e)};var reversed_op={__lt__:"__gt__",__le__:"__ge__",__gt__:"__lt__",__ge__:"__le__"},method2comp={__lt__:"<",__le__:"<=",__gt__:">",__ge__:">="};$B.rich_comp=function(t,e,n){var r,i,s=e.valueOf(),o=n.valueOf();if("number"==typeof s&&"number"==typeof o&&void 0===e.__class__&&void 0===n.__class__)switch(t){case"__eq__":return s==o;case"__ne__":return s!=o;case"__le__":return s<=o;case"__lt__":return s<o;case"__ge__":return s>=o;case"__gt__":return s>o}if(e.$is_class||e.$factory){if("__eq__"==t)return e===n;if("__ne__"==t)return!(e===n);throw _b_.TypeError.$factory("'"+method2comp[t]+"' not supported between instances of '"+$B.class_name(e)+"' and '"+$B.class_name(n)+"'")}if(e.__class__&&n.__class__&&n.__class__.__mro__.indexOf(e.__class__)>-1&&(i=reversed_op[t]||t,$B.$getattr(n,i),(r=$B.$call($B.$getattr(n,i))(e))!==_b_.NotImplemented))return r;if((r=$B.$call($B.$getattr(e,t))(n))!==_b_.NotImplemented)return r;if(i=reversed_op[t]||t,(r=$B.$call($B.$getattr(n,i))(e))!==_b_.NotImplemented)return r;if("__eq__"==t)return _b_.False;if("__ne__"==t)return _b_.True;throw _b_.TypeError.$factory("'"+method2comp[t]+"' not supported between instances of '"+$B.class_name(e)+"' and '"+$B.class_name(n)+"'")};var opname2opsign={sub:"-",xor:"^",mul:"*"};$B.rich_op=function(t,e,n){var r,i,s=e.__class__||$B.get_class(e);if(s===(n.__class__||$B.get_class(n))){if(s===_b_.int)return _b_.int["__"+t+"__"](e,n);try{r=$B.$call($B.$getattr(e,"__"+t+"__"))}catch(n){if(n.__class__===_b_.AttributeError){var o=$B.class_name(e);throw _b_.TypeError.$factory("unsupported operand type(s) for "+opname2opsign[t]+" : '"+o+"' and '"+o+"'")}throw n}return r(n)}try{r=$B.$call($B.$getattr(e,"__"+t+"__"))}catch(r){if(r.__class__!==_b_.AttributeError)throw r;if((i=$B.$call($B.$getattr(n,"__r"+t+"__"))(e))!==_b_.NotImplemented)return i;throw _b_.TypeError.$factory("'"+(opname2opsign[t]||t)+"' not supported between instances of '"+$B.class_name(e)+"' and '"+$B.class_name(n)+"'")}if((i=r(n))===_b_.NotImplemented){if((i=$B.$call($B.$getattr(n,"__r"+t+"__"))(e))!==_b_.NotImplemented)return i;throw _b_.TypeError.$factory("'"+(opname2opsign[t]||t)+"' not supported between instances of '"+$B.class_name(e)+"' and '"+$B.class_name(n)+"'")}return i},$B.is_none=function(t){return null==t||t==_b_.None};var repr_stack=new Set;$B.repr={enter:function(t){if(repr_stack.has(t))return!0;repr_stack.add(t)},leave:function(t){repr_stack.delete(t)}}}(__BRYTHON__),function($B){var _b_=$B.builtins;_b_.__debug__=!1,$B.$comps={">":"gt",">=":"ge","<":"lt","<=":"le"},$B.$inv_comps={">":"lt",">=":"le","<":"gt","<=":"ge"};var check_nb_args=$B.check_nb_args=function(t,e,n){var r=n.length,i=n[r-1];if(i&&"kw"==i.$nat){var s=i.kw;Array.isArray(s)&&s[1]&&s[1].__class__===_b_.dict&&0==Object.keys(s[1].$string_dict).length&&r--}if(r!=e)throw 0==e?_b_.TypeError.$factory(t+"() takes no argument ("+r+" given)"):_b_.TypeError.$factory(t+"() takes exactly "+e+" argument"+(e<2?"":"s")+" ("+r+" given)")},check_no_kw=$B.check_no_kw=function(t,e,n){if(void 0===e&&console.log("x undef",t,e,n),e.$nat&&e.kw&&e.kw[0]&&e.kw[0].length>0||void 0!==n&&n.$nat)throw _b_.TypeError.$factory(t+"() takes no keyword arguments")},NoneType={$factory:function(){return None},$infos:{__name__:"NoneType",__module__:"builtins"},__bool__:function(t){return False},__class__:_b_.type,__hash__:function(t){return 0},__mro__:[_b_.object],__repr__:function(t){return"None"},__str__:function(t){return"None"},$is_class:!0,__setattr__:function(t,e){return no_set_attr(NoneType,e)}},None={__class__:NoneType};for(var $op in $B.$comps){var key=$B.$comps[$op];switch(key){case"ge":case"gt":case"le":case"lt":NoneType["__"+key+"__"]=function(t){return _b_.NotImplemented}}}for(var $func in None)"function"==typeof None[$func]&&(None[$func].__str__=function(t){return function(){return"<method-wrapper "+t+" of NoneType object>"}}($func));function abs(t){if(check_nb_args("abs",1,arguments),check_no_kw("abs",t),isinstance(t,_b_.int))return t.__class__===$B.long_int?{__class__:$B.long_int,value:t.value,pos:!0}:_b_.int.$factory(Math.abs(t));if(isinstance(t,_b_.float))return _b_.float.$factory(Math.abs(_b_.float.numerator(t)));var e=t.__class__||$B.get_class(t);try{var n=$B.$getattr(e,"__abs__")}catch(e){if(e.__class__===_b_.AttributeError)throw _b_.TypeError.$factory("Bad operand type for abs(): '"+$B.class_name(t)+"'");throw e}return $B.$call(n)(t)}function all(t){check_nb_args("all",1,arguments),check_no_kw("all",t);for(var e=iter(t);;)try{var n=next(e);if(!$B.$bool(n))return!1}catch(t){return!0}}function any(t){check_nb_args("any",1,arguments),check_no_kw("any",t);for(var e=iter(t);;)try{var n=next(e);if($B.$bool(n))return!0}catch(t){return!1}}function ascii(t){check_nb_args("ascii",1,arguments),check_no_kw("ascii",t);for(var e,n=repr(t),r="",i=0;i<n.length;i++)if((e=n.charCodeAt(i))<128)r+=n.charAt(i);else if(e<256)r+="\\x"+e.toString(16);else{var s=e.toString(16);s.length%2==1&&(s="0"+s),r+="\\u"+s}return r}function $builtin_base_convert_helper(t,e){var n="";switch(e){case 2:n="0b";break;case 8:n="0o";break;case 16:n="0x";break;default:console.log("invalid base:"+e)}if(t.__class__===$B.long_int){var r=n+$B.long_int.to_base(t,e);return t.pos||(r="-"+r),r}var i=$B.$GetInt(t);if(void 0===i)throw _b_.TypeError.$factory("Error, argument must be an integer or contains an __index__ function");return i>=0?n+i.toString(e):"-"+n+(-i).toString(e)}function bin_hex_oct(t,e){if(isinstance(e,_b_.int))return $builtin_base_convert_helper(e,t);try{var n=e.__class__||$B.get_class(e),r=$B.$getattr(n,"__index__")}catch(t){if(t.__class__===_b_.AttributeError)throw _b_.TypeError.$factory("'"+$B.class_name(e)+"' object cannot be interpreted as an integer");throw t}return $builtin_base_convert_helper($B.$call(r)(e),t)}function bin(t){return check_nb_args("bin",1,arguments),check_no_kw("bin",t),bin_hex_oct(2,t)}function breakpoint(){$B.$import("sys",[]);var t={},e=$B.$getattr($B.imported.sys,"breakpointhook",t);if(e===t)throw _b_.RuntimeError.$factory("lost sys.breakpointhook");return $B.$call(e).apply(null,arguments)}function callable(t){return check_nb_args("callable",1,arguments),check_no_kw("callable",t),hasattr(t,"__call__")}function chr(t){if(check_nb_args("chr",1,arguments),check_no_kw("chr",t),t<0||t>1114111)throw _b_.ValueError.$factory("Outside valid range");return String.fromCodePoint(t)}$B.set_func_names(NoneType,"builtins");var classmethod=$B.make_class("classmethod",(function(t){check_nb_args("classmethod",1,arguments),check_no_kw("classmethod",t);var e=function(){return t.apply(null,arguments)};if(e.__class__=$B.method,t.$attrs)for(var n in t.$attrs)e[n]=t.$attrs[n];return e.$infos={__func__:t,__name__:t.$infos.__name__},e.__get__=function(n,r){var i=function(){return e(r,...arguments)};return i.__class__=$B.method,i.$infos={__self__:r,__func__:e,__name__:t.$infos.__name__,__qualname__:r.$infos.__name__+"."+t.$infos.__name__},i},e.__get__.__class__=$B.method_wrapper,e.__get__.$infos=t.$infos,e}));$B.set_func_names(classmethod,"builtins");var code=$B.code=$B.make_class("code");function compile(){var t=$B.args("compile",6,{source:null,filename:null,mode:null,flags:null,dont_inherit:null,optimize:null,_feature_version:null},["source","filename","mode","flags","dont_inherit","optimize","_feature_version"],arguments,{flags:0,dont_inherit:!1,optimize:-1,_feature_version:0},null,null),e="$exec_"+$B.UUID();if($B.clear_ns(e),t.__class__=code,t.co_flags=t.flags,t.name="<module>","single"==t.mode&&512&t.flags&&!t.source.endsWith("\n")){var n=t.source.split("\n");if($B.last(n).startsWith(" "))throw _b_.SyntaxError.$factory("unexpected EOF while parsing")}return $B.py2js(t.source,e,e),t}code.__repr__=code.__str__=function(t){return"<code object "+t.co_name+", file "+t.co_filename+">"},code.__getattribute__=function(t,e){return t[e]},$B.set_func_names(code,"builtins");var __debug__=$B.debug>0;function delattr(t,e){if(check_no_kw("delattr",t,e),check_nb_args("delattr",2,arguments),"string"!=typeof e)throw _b_.TypeError.$factory("attribute name must be string, not '"+$B.class_name(e)+"'");return $B.$getattr(t,"__delattr__")(e)}function dir(t){if(void 0===t){var e=$B.last($B.frames_stack);for(var n in locals_obj=e[1],i=_b_.list.$factory(),s=0,locals_obj)"$"==n.charAt(0)&&"$"!=n.charAt(1)||(i[s++]=n);return _b_.list.sort(i),i}if(check_nb_args("dir",1,arguments),check_no_kw("dir",t),t.__class__||$B.get_class(t),t.$is_class){var r=$B.$getattr(t.__class__,"__dir__");return $B.$call(r)(t)}try{var i=$B.$call($B.$getattr(t,"__dir__"))();return _b_.list.$factory(i)}catch(t){}i=[];var s=0;for(var n in t)"$"!==n.charAt(0)&&"__class__"!==n&&void 0!==t[n]&&(i[s++]=n);return i.sort(),i}function divmod(t,e){check_no_kw("divmod",t,e),check_nb_args("divmod",2,arguments);var n=t.__class__||$B.get_class(t),r=$B.$getattr(n,"__divmod__",_b_.None);return r!==_b_.None?r(t,e):_b_.tuple.$factory([$B.$getattr(n,"__floordiv__")(t,e),$B.$getattr(n,"__mod__")(t,e)])}$B.$delete=function(t,e){function n(t){t.__class__===$B.generator&&t.return()}var r=!1,i=$B.last($B.frames_stack);if(e?i[2]!=i[0]&&void 0!==i[3][t]&&(r=!0,n(i[3][t]),delete i[3][t]):void 0!==i[1][t]&&(r=!0,n(i[1][t]),delete i[1][t]),!r)throw _b_.NameError.$factory(t)};var enumerate=$B.make_class("enumerate",(function(){var t=$B.args("enumerate",2,{iterable:null,start:null},["iterable","start"],arguments,{start:0},null,null),e=iter(t.iterable),n=t.start;return{__class__:enumerate,__name__:"enumerate iterator",counter:n-1,iter:e,start:n}}));function $$eval(src,_globals,_locals){var $=$B.args("eval",4,{src:null,globals:null,locals:null,mode:null},["src","globals","locals","mode"],arguments,{globals:_b_.None,locals:_b_.None,mode:"eval"},null,null),src=$.src,_globals=$.globals,_locals=$.locals,mode=$.mode;$.src.mode&&"single"==$.src.mode&&["<console>","<stdin>"].indexOf($.src.filename)>-1&&_b_.print(">",$.src.source.trim());var current_frame=$B.frames_stack[$B.frames_stack.length-1];if(void 0!==current_frame)var current_locals_id=current_frame[0].replace(/\./g,"_"),current_globals_id=current_frame[2].replace(/\./g,"_");var stack_len=$B.frames_stack.length;if(src.__class__===code)mode=src.mode,src=src.source;else if("string"!=typeof src)throw _b_.TypeError.$factory("eval() arg 1 must be a string, bytes or code object");var globals_id="$exec_"+$B.UUID(),globals_name=globals_id,locals_id="$exec_"+$B.UUID(),parent_scope;if(_globals===_b_.None){current_locals_id==current_globals_id&&(locals_id=globals_id);var local_scope={module:globals_id,id:locals_id,binding:{},bindings:{}};for(var attr in current_frame[1])local_scope.binding[attr]=!0,local_scope.bindings[attr]=!0;var global_scope={module:globals_id,id:globals_id,binding:{},bindings:{}};for(var attr in current_frame[3])global_scope.binding[attr]=!0,global_scope.bindings[attr]=!0;local_scope.parent_block=global_scope,global_scope.parent_block=$B.builtins_scope,parent_scope=local_scope,eval("$locals_"+parent_scope.id+" = current_frame[1]")}else{if(_globals.__class__!=_b_.dict)throw _b_.TypeError.$factory("exec() globals must be a dict, not "+$B.class_name(_globals));if(_globals.globals_id&&(globals_id=globals_name=_globals.globals_id),_globals.globals_id=globals_id,_locals===_globals||_locals===_b_.None)locals_id=globals_id,parent_scope=$B.builtins_scope;else{var grandparent_scope={id:globals_id,parent_block:$B.builtins_scope,binding:{}};for(var attr in parent_scope={id:locals_id,parent_block:grandparent_scope,binding:{}},_globals.$string_dict)grandparent_scope.binding[attr]=!0;for(var attr in _locals.$string_dict)parent_scope.binding[attr]=!0}}if($B.$py_module_path[globals_id]=$B.$py_module_path[current_globals_id],eval("var $locals_"+globals_id+" = {}\nvar $locals_"+locals_id+" = {}"),_globals===_b_.None){var gobj=current_frame[3],ex="var $locals_"+globals_id+" = gobj;",obj={};for(var attr in eval(ex),gobj)attr.startsWith("$")&&!attr.startsWith("$$")||(obj[attr]=gobj[attr]);eval("$locals_"+globals_id+" = obj")}else{var globals_is_dict=!1;if(_globals.$jsobj)var items=_globals.$jsobj;else{var items=_b_.dict.$to_obj(_globals);_globals.$jsobj=items,globals_is_dict=!0}for(var item in eval("$locals_"+globals_id+" = _globals.$jsobj"),items){var item1=$B.to_alias(item);try{eval("$locals_"+globals_id+'["'+item+'"] = items.'+item)}catch(t){console.log(t),console.log("error setting",item);break}}}if(_globals.$is_namespace=!0,_locals===_b_.None)if(_globals!==_b_.None)eval("var $locals_"+locals_id+" = $locals_"+globals_id);else{var lobj=current_frame[1],ex="",obj={};for(var attr in current_frame[1])attr.startsWith("$")&&!attr.startsWith("$$")||(obj[attr]=lobj[attr]);eval("$locals_"+locals_id+" = obj")}else{var locals_is_dict=!1;if(_locals.$jsobj)var items=_locals.$jsobj;else{locals_id_dict=!0;var items=_b_.dict.$to_obj(_locals);_locals.$jsobj=items}for(var item in items){var item1=$B.to_alias(item);try{eval("$locals_"+locals_id+'["'+item+'"] = items.'+item)}catch(t){console.log(t),console.log("error setting",item);break}}eval("$locals_"+locals_id+".$exec_locals = true")}_locals.$is_namespace=!0,_globals===_b_.None&&_locals===_b_.None&&current_frame[0]==current_frame[2]||eval("$locals_"+locals_id+".$src = src");var root=$B.py2js(src,globals_id,locals_id,parent_scope),js,gns,lns;if(_globals!==_b_.None&&_locals==_b_.None)for(var attr in _globals.$string_dict)root.binding[attr]=!0;try{var try_node=root.children[root.children.length-2],instr=try_node.children[try_node.children.length-2],type=instr.C.tree[0].type;switch(type){case"expr":case"list_or_tuple":case"op":case"ternary":var children=try_node.children;root.children.splice(root.children.length-2,2);for(var i=0;i<children.length-1;i++)root.add(children[i]);break;default:if("eval"==mode)throw _b_.SyntaxError.$factory("eval() argument must be an expression","<string>",1,1,src)}if("eval"!=mode){var last=$B.last(root.children),js=last.to_js();-1==["node_js"].indexOf(last.C.type)&&(last.to_js=function(){for(;js.endsWith("\n");)js=js.substr(0,js.length-1);for(;js.endsWith(";");)js=js.substr(0,js.length-1);return"return ("+js+")"}),js=root.to_js();var locals_obj=eval("$locals_"+locals_id),globals_obj=eval("$locals_"+globals_id);if(_globals===_b_.None)var res=new Function("$locals_"+globals_id,"$locals_"+locals_id,js)(globals_obj,locals_obj);else{current_globals_obj=current_frame[3],current_locals_obj=current_frame[1];var res=new Function("$locals_"+globals_id,"$locals_"+locals_id,"$locals_"+current_globals_id,"$locals_"+current_locals_id,js)(globals_obj,locals_obj,current_globals_obj,current_locals_obj)}$.src.mode&&"single"==$.src.mode&&"<stdin>"==$.src.filename&&res!==_b_.None&&void 0!==res&&_b_.print(_b_.repr(res))}else{js=root.to_js();var res=eval(js)}if("<console>"==$.src.filename&&"single"==$.src.mode&&void 0!==res&&res!==_b_.None&&_b_.print(res),gns=eval("$locals_"+globals_id),$B.frames_stack[$B.frames_stack.length-1][2]==globals_id&&(gns=$B.frames_stack[$B.frames_stack.length-1][3]),_locals!==_b_.None)for(var attr in lns=eval("$locals_"+locals_id),lns){var attr1=$B.from_alias(attr);"$"!=attr1.charAt(0)&&(_locals.$jsobj?_locals.$jsobj[attr]=lns[attr]:_b_.dict.$setitem(_locals,attr1,lns[attr]))}else for(var attr in lns)"$src"!==attr&&(current_frame[1][attr]=lns[attr]);if(_globals!==_b_.None){if(globals_is_dict){var jsobj=_globals.$jsobj;delete _globals.$jsobj}for(var attr in gns)attr1=$B.from_alias(attr),"$"!=attr1.charAt(0)&&(globals_is_dict?_b_.dict.$setitem(_globals,attr,gns[attr]):_globals.$jsobj[attr1]=gns[attr]);for(var attr in _globals.$string_dict)attr.startsWith("$")&&!attr.startsWith("$$")&&delete _globals.$string_dict[attr]}else for(var attr in gns)"$src"!==attr&&(current_frame[3][attr]=gns[attr]);return void 0===res?_b_.None:res}catch(t){if(t.src=src,t.module=globals_id,void 0===t.$py_error)throw $B.exception(t);throw t}finally{$B.frames_stack.length==stack_len+1&&$B.frames_stack.pop(),root=null,js=null,gns=null,lns=null,$B.clear_ns(globals_id),$B.clear_ns(locals_id)}}function exec(t,e,n){var r=$B.args("exec",3,{src:null,globals:null,locals:null},["src","globals","locals"],arguments,{globals:_b_.None,locals:_b_.None},null,null);return $$eval(r.src,r.globals,r.locals,"exec")||_b_.None}function exit(){throw _b_.SystemExit}enumerate.__iter__=function(t){return t.counter=t.start-1,t},enumerate.__next__=function(t){return t.counter++,$B.fast_tuple([t.counter,next(t.iter)])},$B.set_func_names(enumerate,"builtins"),$B.from_alias=function(t){return"$$"==t.substr(0,2)&&$B.aliased_names[t.substr(2)]?t.substr(2):t},$B.to_alias=function(t){return $B.aliased_names[t]?"$$"+t:t},$$eval.$is_func=!0,exec.$is_func=!0,exit.__repr__=exit.__str__=function(){return"Use exit() or Ctrl-Z plus Return to exit"};var filter=$B.make_class("filter",(function(t,e){return check_no_kw("filter",t,e),check_nb_args("filter",2,arguments),e=iter(e),t===_b_.None&&(t=$B.$bool),{__class__:filter,func:t,iterable:e}}));function format(t,e){var n=$B.args("format",2,{value:null,format_spec:null},["value","format_spec"],arguments,{format_spec:""},null,null),r=t.__class__||$B.get_class(t);try{var i=$B.$getattr(r,"__format__")}catch(e){if(e.__class__===_b_.AttributeError)throw _b_.NotImplementedError("__format__ is not implemented for object '"+_b_.str.$factory(t)+"'");throw e}return $B.$call(i)(t,n.format_spec)}function attr_error(t,e){var n="bad operand type for unary #: '"+e+"'";switch(t){case"__neg__":throw _b_.TypeError.$factory(n.replace("#","-"));case"__pos__":throw _b_.TypeError.$factory(n.replace("#","+"));case"__invert__":throw _b_.TypeError.$factory(n.replace("#","~"));case"__call__":throw _b_.TypeError.$factory("'"+e+"' object is not callable");default:for(;"$"==t.charAt(0);)t=t.substr(1);throw _b_.AttributeError.$factory("'"+e+"' object has no attribute '"+t+"'")}}function getattr(){var t={},e=$B.args("getattr",3,{obj:null,attr:null,_default:null},["obj","attr","_default"],arguments,{_default:t},null,null);return $B.$getattr(e.obj,e.attr,e._default===t?void 0:e._default)}function in_mro(t,e){if(void 0===t)return!1;if(t.hasOwnProperty(e))return t[e];for(var n=t.__mro__,r=0,i=n.length;r<i;r++)if(n[r].hasOwnProperty(e))return n[r][e];return!1}function globals(){check_nb_args("globals",0,arguments);var t=$B.obj_dict($B.last($B.frames_stack)[3]);return t.$jsobj.__BRYTHON__=$B.JSObj.$factory($B),t.$is_namespace=!0,t}function hasattr(t,e){check_no_kw("hasattr",t,e),check_nb_args("hasattr",2,arguments);try{return $B.$getattr(t,e),!0}catch(t){return!1}}filter.__iter__=function(t){return t},filter.__next__=function(t){for(;;){var e=next(t.iterable);if(t.func(e))return e}},$B.set_func_names(filter,"builtins"),$B.$getattr=function(t,e,n){if(e=$B.to_alias(e),t.$method_cache&&t.$method_cache[e]&&t.__class__&&t.__class__[e]==t.$method_cache[e][1])return t.$method_cache[e][0];var r=e;void 0===t&&console.log("get attr",e,"of undefined");var i,s=t.$is_class||t.$factory,o=t.__class__;if(void 0!==o&&o.__bases__&&(0==o.__bases__.length||1==o.__bases__.length&&o.__bases__[0]===_b_.object)){if(t.hasOwnProperty(e))return t[e];if(t.__dict__&&t.__dict__.$string_dict.hasOwnProperty(e)&&(!o.hasOwnProperty(e)||!o[e].__get__))return t.__dict__.$string_dict[e][0];if(o.hasOwnProperty(e)&&"function"!=typeof o[e]&&"__dict__"!=e&&void 0===o[e].__get__&&!in_mro(o[e].__class__,"__get__"))return o[e]}if(void 0===o)if("string"==typeof t)o=_b_.str;else if("number"==typeof t)o=t%1==0?_b_.int:_b_.float;else if(t instanceof Number)o=_b_.float;else if(void 0===(o=$B.get_class(t))){if(void 0!==(l=t[e])){if("function"==typeof l){var a=function(){return l.apply(t,arguments)};return a.$infos={__name__:e,__qualname__:e},a}return $B.$JS2Py(l)}if(void 0!==n)return n;throw _b_.AttributeError.$factory("object has no attribute "+r)}switch(e){case"__call__":if("function"==typeof t){var l=function(){return t.apply(null,arguments)};return l.__class__=method_wrapper,l.$infos={__name__:"__call__"},l}break;case"__class__":return o;case"__dict__":if(s){var c={};for(var u in t){var h=$B.from_alias(u);h.startsWith("$")||(c[h]=t[u])}return c.__dict__=$B.getset_descriptor.$factory(t,"__dict__"),$B.mappingproxy.$factory(c)}if(t.hasOwnProperty(e))return t[e];if(t.$infos){if(t.$infos.hasOwnProperty("__dict__"))return t.$infos.__dict__;if(t.$infos.hasOwnProperty("__func__"))return t.$infos.__func__.$infos.__dict__}return $B.obj_dict(t);case"__doc__":for(var p=0;p<builtin_names.length;p++)if(t===_b_[builtin_names[p]])return _get_builtins_doc(),$B.builtins_doc[builtin_names[p]];break;case"__mro__":if(t.$is_class)return _b_.tuple.$factory([t].concat(t.__mro__));if(t.__dict__&&void 0!==t.__dict__.$string_dict.__mro__)return t.__dict__.$string_dict.__mro__;throw _b_.AttributeError.$factory(e);case"__subclasses__":if(o.$factory||o.$is_class){var d=t.$subclasses||[];return function(){return d}}}if("function"==typeof t){var f=t[e];if(void 0!==f&&"__module__"==e)return f}if(!s&&o.$native){if(t.$method_cache&&t.$method_cache[e])return t.$method_cache[e];if("__doc__"==e&&void 0===o[e]&&o.$infos&&(_get_builtins_doc(),o[e]=$B.builtins_doc[o.$infos.__name__]),void 0===o[e]){var m=_b_.object[e];if(void 0===m){var _=t.__dict__;return _&&void 0!==(m=_.$string_dict[e])?m[0]:(void 0===n&&attr_error(e,o.$infos.__name__),n)}o[e]=m}if(o.$descriptors&&void 0!==o.$descriptors[e])return o[e](t);if("function"==typeof o[e]){var g=o[e];if("__new__"==e&&(g.$type="staticmethod"),"staticmethod"==g.$type)return g;var y=o[e].__class__==$B.method?o:t,v=o[e].bind(null,y);return v.__class__=$B.method,v.$infos={__func__:g,__name__:e,__self__:y,__qualname__:o.$infos.__name__+"."+e},"object"==typeof t&&(t.__class__=o,t.$method_cache=t.$method_cache||{},t.$method_cache[e]=v),v}if(void 0!==o[e])return o[e];attr_error(r,o.$infos.__name__)}if(s)i=_b_.type.__getattribute__;else if(void 0===(i=o.__getattribute__)){var b;void 0===(b=o.__mro__)&&console.log(t,e,"no mro, klass",o),p=0;for(var x=b.length;p<x&&void 0===(i=b[p].__getattribute__);p++);}if("function"!=typeof i&&console.log(e+" is not a function "+i,o),i===_b_.object.__getattribute__){if(l=t[e],Array.isArray(t)&&void 0!==Array.prototype[e]&&(l=void 0),null===l)return null;if(void 0===l&&t.hasOwnProperty(e))return l;if(void 0!==l&&(void 0===l.__set__||l.$is_class))return l}try{l=i(t,e)}catch(t){if(void 0!==n)return n;throw t}if(void 0!==l)return l;if(void 0!==n)return n;var w=o.$infos.__name__;s&&(w=t.$infos.__name__),attr_error(r,w)};var hash_cache={};function hash(t){if(check_no_kw("hash",t),check_nb_args("hash",1,arguments),void 0!==t.__hashvalue__)return t.__hashvalue__;if(isinstance(t,_b_.bool))return _b_.int.$factory(t);if(isinstance(t,_b_.int))return void 0===t.$brython_value?t.valueOf():t.__hashvalue__=t.$brython_value;if(t.$is_class||t.__class__===_b_.type||t.__class__===$B.Function)return t.__hashvalue__=$B.$py_next_hash--;if("string"==typeof t){var e=hash_cache[t];return void 0!==e?e:hash_cache[t]=_b_.str.__hash__(t)}var n=t.__class__||$B.get_class(t);if(void 0===n)throw _b_.TypeError.$factory("unhashable type: '"+_b_.str.$factory($B.JSObj.$factory(t))+"'");var r=$B.$getattr(n,"__hash__",_b_.None);if(r===_b_.None)throw _b_.TypeError.$factory("unhashable type: '"+$B.class_name(t)+"'");if(r.$infos.__func__===_b_.object.__hash__){if($B.$getattr(t,"__eq__").$infos.__func__!==_b_.object.__eq__)throw _b_.TypeError.$factory("unhashable type: '"+$B.class_name(t)+"'","hash");return t.__hashvalue__=_b_.object.__hash__(t)}return $B.$call(r)(t)}function _get_builtins_doc(){if(void 0===$B.builtins_doc){var url=$B.brython_path;"/"==url.charAt(url.length-1)&&(url=url.substr(0,url.length-1)),url+="/builtins_docstrings.js";var f=_b_.open(url);eval(f.$string),$B.builtins_doc=docs}}function help(t){if(void 0===t&&(t="help"),"string"==typeof t&&void 0!==_b_[t]){_get_builtins_doc();var e=$B.builtins_doc[t];if(void 0!==e&&""!=e)return void _b_.print(e)}for(var n=0;n<builtin_names.length;n++)t===_b_[builtin_names[n]]&&(_get_builtins_doc(),_b_.print(e=$B.builtins_doc[builtin_names[n]]));if("string"!=typeof t)try{return $B.$getattr(t,"__doc__")}catch(t){return""}else{$B.$import("pydoc");var r=$B.imported.pydoc;$B.$getattr($B.$getattr(r,"help"),"__call__")(t)}}function hex(t){return check_no_kw("hex",t),check_nb_args("hex",1,arguments),bin_hex_oct(16,t)}function id(t){return check_no_kw("id",t),check_nb_args("id",1,arguments),isinstance(t,[_b_.str,_b_.int,_b_.float])&&!isinstance(t,$B.long_int)?$B.$getattr(_b_.str.$factory(t),"__hash__")():void 0!==t.$id?t.$id:t.$id=$B.UUID()}function __import__(t,e,n,r,i){var s=$B.args("__import__",5,{name:null,globals:null,locals:null,fromlist:null,level:null},["name","globals","locals","fromlist","level"],arguments,{globals:None,locals:None,fromlist:_b_.tuple.$factory(),level:0},null,null);return $B.$__import__(s.name,s.globals,s.locals,s.fromlist)}function input(t){var e=prompt(t||"")||"";if($B.imported.sys&&$B.imported.sys.ps1){var n=$B.imported.sys.ps1,r=$B.imported.sys.ps2;t!=n&&t!=r||console.log(t,e)}return e}function isinstance(t,e){if(check_no_kw("isinstance",t,e),check_nb_args("isinstance",2,arguments),null===t)return e===None;if(void 0===t)return!1;if(e.constructor===Array){for(var n=0;n<e.length;n++)if(isinstance(t,e[n]))return!0;return!1}if(e.__class__===$B.GenericAlias)throw _b_.TypeError.$factory("isinstance() arg 2 cannot be a parameterized generic");if(!e.__class__||void 0===e.$factory&&void 0===e.$is_class)throw _b_.TypeError.$factory("isinstance() arg 2 must be a type or tuple of types");if(e===_b_.int&&(t===True||t===False))return True;if(e===_b_.bool)switch(typeof t){case"string":case"number":return!1;case"boolean":return!0}var r=t.__class__;if(null==r){if("string"==typeof t){if(e==_b_.str)return!0;if($B.builtin_classes.indexOf(e)>-1)return!1}else if(t.contructor===Number&&Number.isFinite(t)){if(e==_b_.float)return!0}else if("number"==typeof t&&Number.isFinite(t)&&Number.isFinite(t)&&e==_b_.int)return!0;r=$B.get_class(t)}if(void 0===r)return!1;function i(t,e){return t===e||e===_b_.str&&t===$B.StringSubclass||e===_b_.int&&t===$B.IntSubclass||void 0}if(i(r,e))return!0;var s=r.__mro__;for(n=0;n<s.length;n++)if(i(s[n],e))return!0;var o=$B.$getattr(e.__class__||$B.get_class(e),"__instancecheck__",_b_.None);return o!==_b_.None&&o(e,t)}function issubclass(t,e){if(check_no_kw("issubclass",t,e),check_nb_args("issubclass",2,arguments),!t.__class__||void 0===t.$factory&&void 0===t.$is_class)throw _b_.TypeError.$factory("issubclass() arg 1 must be a class");if(isinstance(e,_b_.tuple)){for(var n=0;n<e.length;n++)if(issubclass(t,e[n]))return!0;return!1}if(e.__class__===$B.GenericAlias)throw _b_.TypeError.$factory("issubclass() arg 2 cannot be a parameterized generic");if((e.$factory||e.$is_class)&&(t===e||t.__mro__.indexOf(e)>-1))return!0;var r=$B.$getattr(e.__class__||$B.get_class(e),"__subclasscheck__",_b_.None);return r!=_b_.None&&r(e,t)}help.__repr__=help.__str__=function(){return"Type help() for interactive help, or help(object) for help about object."};var iterator_class=$B.make_class("iterator",(function(t,e){return{__class__:iterator_class,getitem:t,len:e,counter:-1}}));function iter(){var t=$B.args("iter",1,{obj:null},["obj"],arguments,{},"args","kw");if(t.args.length>0)var e=t.args[0];return $B.$iter(t.obj,e)}function len(t){check_no_kw("len",t),check_nb_args("len",1,arguments);var e=t.__class__||$B.get_class(t);try{var n=$B.$getattr(e,"__len__")}catch(e){throw _b_.TypeError.$factory("object of type '"+$B.class_name(t)+"' has no len()")}return $B.$call(n)(t)}function locals(){check_nb_args("locals",0,arguments);var t=$B.obj_dict($B.last($B.frames_stack)[1]);return t.$is_namespace=!0,delete t.$jsobj.__annotations__,t}iterator_class.__next__=function(t){if(t.counter++,null!==t.len&&t.counter==t.len)throw _b_.StopIteration.$factory("");try{return t.getitem(t.counter)}catch(t){throw _b_.StopIteration.$factory("")}},callable_iterator=$B.make_class("callable_iterator",(function(t,e){return{__class__:callable_iterator,func:t,sentinel:e}})),callable_iterator.__iter__=function(t){return t},callable_iterator.__next__=function(t){var e=t.func();if($B.rich_comp("__eq__",e,t.sentinel))throw _b_.StopIteration.$factory();return e},$B.$iter=function(t,e){if(void 0===e){var n=t.__class__||$B.get_class(t);try{var r=$B.$call($B.$getattr(n,"__iter__"))}catch(e){if(e.__class__===_b_.AttributeError)try{var i=$B.$call($B.$getattr(n,"__getitem__"));return len(t),iterator_class.$factory((function(e){return i(t,e)}),len)}catch(e){throw _b_.TypeError.$factory("'"+$B.class_name(t)+"' object is not iterable")}throw e}var s=$B.$call(r)(t);try{$B.$getattr(s,"__next__")}catch(t){if(isinstance(t,_b_.AttributeError))throw _b_.TypeError.$factory("iter() returned non-iterator of type '"+$B.class_name(s)+"'")}return s}return callable_iterator.$factory(t,e)};var map=$B.make_class("map",(function(){var t=$B.args("map",2,{func:null,it1:null},["func","it1"],arguments,{},"args",null),e=$B.$call(t.func),n=[$B.$iter(t.it1)];return t.args.forEach((function(t){n.push($B.$iter(t))})),{__class__:map,args:n,func:e}}));function $extreme(t,e){var n="min";if("__gt__"===e&&(n="max"),0==t.length)throw _b_.TypeError.$factory(n+" expected 1 arguments, got 0");var r=t[t.length-1],i=t.length,s=!1,o=!1;if("kw"==r.$nat)for(var a in i--,r=r.kw)switch(a){case"key":o=r[a];break;case"$$default":var l=r[a];s=!0;break;default:throw _b_.TypeError.$factory("'"+a+"' is an invalid keyword argument for this function")}if(o||(o=function(t){return t}),0==i)throw _b_.TypeError.$factory(n+" expected 1 argument, got 0");if(1!=i){if(s)throw _b_.TypeError.$factory("Cannot specify a default for "+n+"() with multiple positional arguments");h=null;for(var c=0;c<i;c++)p=t[c],(null===h||$B.$bool($B.$getattr(o(p),e)(o(h))))&&(h=p);return h}for(var u=iter(t[0]),h=null;;)try{var p=next(u);(null===h||$B.$bool($B.$getattr(o(p),e)(o(h))))&&(h=p)}catch(t){if(t.__class__==_b_.StopIteration){if(null===h){if(s)return l;throw _b_.ValueError.$factory(n+"() arg is an empty sequence")}return h}throw t}}function max(){return $extreme(arguments,"__gt__")}map.__iter__=function(t){return t},map.__next__=function(t){for(var e=[],n=0;n<t.args.length;n++)e.push(next(t.args[n]));return t.func.apply(null,e)},$B.set_func_names(map,"builtins");var memoryview=$B.make_class("memoryview",(function(t){if(check_no_kw("memoryview",t),check_nb_args("memoryview",1,arguments),t.__class__===memoryview)return t;if($B.get_class(t).$buffer_protocol)return{__class__:memoryview,obj:t,format:"B",itemsize:1,ndim:1,shape:_b_.tuple.$factory([_b_.len(t)]),strides:_b_.tuple.$factory([1]),suboffsets:_b_.tuple.$factory([]),c_contiguous:!0,f_contiguous:!0,contiguous:!0};throw _b_.TypeError.$factory("memoryview: a bytes-like object is required, not '"+$B.class_name(t)+"'")}));function min(){return $extreme(arguments,"__lt__")}function next(t){check_no_kw("next",t);var e={},n=$B.args("next",2,{obj:null,def:null},["obj","def"],arguments,{def:e},null,null),r=t.__class__||$B.get_class(t),i=$B.$call($B.$getattr(r,"__next__"));if(void 0!==i)try{return $B.$call(i)(t)}catch(t){if(t.__class__===_b_.StopIteration&&n.def!==e)return n.def;throw t}throw _b_.TypeError.$factory("'"+$B.class_name(t)+"' object is not an iterator")}memoryview.__eq__=function(t,e){return e.__class__===memoryview&&$B.$getattr(t.obj,"__eq__")(e.obj)},memoryview.__getitem__=function(t,e){if(isinstance(e,_b_.int)){var n=e*t.itemsize;if("I"==t.format){for(var r=t.obj.source[n],i=256,s=1;s<4;s++)r+=t.obj.source[n+s]*i,i*=256;return r}if("B".indexOf(t.format)>-1){if(e>t.obj.source.length-1)throw _b_.KeyError.$factory(e);return t.obj.source[e]}return t.obj.source[e]}if(r=t.obj.__class__.__getitem__(t.obj,e),e.__class__===_b_.slice)return memoryview.$factory(r)},memoryview.__len__=function(t){return len(t.obj)/t.itemsize},memoryview.cast=function(t,e){switch(e){case"B":return memoryview.$factory(t.obj);case"I":var n=memoryview.$factory(t.obj),r=len(t.obj);if(n.itemsize=4,n.format="I",r%4!=0)throw _b_.TypeError.$factory("memoryview: length is not a multiple of itemsize");return n}},memoryview.hex=function(t){var e="";return _b_.bytes.$factory(t).source.forEach((function(t){e+=t.toString(16)})),e},memoryview.tobytes=function(t){return _b_.bytes.$factory(t.obj)},memoryview.tolist=function(t){if(1==t.itemsize)return _b_.list.$factory(_b_.bytes.$factory(t.obj));if(4==t.itemsize&&"I"==t.format){for(var e=[],n=0;n<t.obj.source.length;n+=4){for(var r=t.obj.source[n],i=256,s=1;s<4;s++)r+=i*t.obj.source[n+s],i*=256;e.push(r)}return e}},$B.set_func_names(memoryview,"builtins");var NotImplementedType=$B.make_class("NotImplementedType",(function(){return NotImplemented}));NotImplementedType.__repr__=NotImplementedType.__str__=function(t){return"NotImplemented"};var NotImplemented={__class__:NotImplementedType};function $not(t){return!$B.$bool(t)}function oct(t){return check_no_kw("oct",t),check_nb_args("oct",1,arguments),bin_hex_oct(8,t)}function ord(t){if(check_no_kw("ord",t),check_nb_args("ord",1,arguments),"string"==typeof t){if(1==t.length)return t.charCodeAt(0);throw _b_.TypeError.$factory("ord() expected a character, but string of length "+t.length+" found")}switch($B.get_class(t)){case _b_.str:if(1==t.length)return t.charCodeAt(0);throw _b_.TypeError.$factory("ord() expected a character, but string of length "+t.length+" found");case _b_.str.$surrogate:if(1==t.items.length)return t.items[0].codePointAt(0);throw _b_.TypeError.$factory("ord() expected a character, but string of length "+t.items.length+" found");case _b_.bytes:case _b_.bytearray:if(1==t.source.length)return t.source[0];throw _b_.TypeError.$factory("ord() expected a character, but string of length "+t.source.length+" found");default:throw _b_.TypeError.$factory("ord() expected a character, but "+$B.class_name(t)+" was found")}}function pow(){var t=$B.args("pow",3,{x:null,y:null,mod:null},["x","y","mod"],arguments,{mod:None},null,null),e=t.x,n=t.y,r=t.mod,i=e.__class__||$B.get_class(e);if(r===_b_.None)return $B.$call($B.$getattr(i,"__pow__"))(e,n);if(e!=_b_.int.$factory(e)||n!=_b_.int.$factory(n))throw _b_.TypeError.$factory("pow() 3rd argument not allowed unless all arguments are integers");return $B.$call($B.$getattr(i,"__pow__"))(e,n,r)}function $print(){var t=$B.args("print",0,{},[],arguments,{},"args","kw"),e=t.kw.$string_dict,n=void 0===e.end||e.end===None?"\n":e.end[0],r=void 0===e.sep||e.sep===None?" ":e.sep[0],i=void 0===e.file?$B.stdout:e.file[0],s=t.args,o=[];s.forEach((function(t){o.push(_b_.str.$factory(t))}));var a=o.join(r)+n;a=a.replace(new RegExp("","g"),"").replace(new RegExp("(.)\b","g"),""),$B.$getattr(i,"write")(a);var l=$B.$getattr(i,"flush",None);return l!==None&&l(),None}$print.__name__="print",$print.is_func=!0;var property=$B.make_class("property",(function(t,e,n,r){var i={__class__:property};return property.__init__(i,t,e,n,r),i}));function quit(){throw _b_.SystemExit}function repr(t){check_no_kw("repr",t),check_nb_args("repr",1,arguments);var e=t.__class__||$B.get_class(t);return $B.$call($B.$getattr(e,"__repr__"))(t)}property.__init__=function(t,e,n,r,i){if(t.__doc__=i||"",t.$type=e.$type,t.fget=e,t.fset=n,t.fdel=r,e&&e.$attrs)for(var s in e.$attrs)t[s]=e.$attrs[s];t.__get__=function(t,e,n){if(void 0===e)return t;if(void 0===t.fget)throw _b_.AttributeError.$factory("unreadable attribute");return $B.$call(t.fget)(e)},void 0!==n&&(t.__set__=function(t,e,n){if(void 0===t.fset)throw _b_.AttributeError.$factory("can't set attribute");$B.$getattr(t.fset,"__call__")(e,n)}),t.__delete__=r,t.getter=function(e){return property.$factory(e,t.fset,t.fdel,t.__doc__)},t.setter=function(e){return property.$factory(t.fget,e,t.fdel,t.__doc__)},t.deleter=function(e){return property.$factory(t.fget,t.fset,e,t.__doc__)}},property.__repr__=function(t){return _b_.repr(t.fget(t))},property.__str__=function(t){return _b_.str.$factory(t.fget(t))},$B.set_func_names(property,"builtins"),quit.__repr__=quit.__str__=function(){return"Use quit() or Ctrl-Z plus Return to exit"};var reversed=$B.make_class("reversed",(function(t){check_no_kw("reversed",t),check_nb_args("reversed",1,arguments);var e=t.__class__||$B.get_class(t),n=$B.$getattr(e,"__reversed__",null);if(null!==n)return $B.$call(n)(t);try{var r=$B.$getattr(e,"__getitem__")}catch(t){throw _b_.TypeError.$factory("argument to reversed() must be a sequence")}var i={__class__:reversed,$counter:_b_.len(t),getter:function(e){return $B.$call(r)(t,e)}};return i}));function round(){var t=$B.args("round",2,{number:null,ndigits:null},["number","ndigits"],arguments,{ndigits:None},null,null),e=t.number,n=t.ndigits===None?0:t.ndigits;if(!isinstance(e,[_b_.int,_b_.float])){var r=e.__class__||$B.get_class(e);try{return $B.$call($B.$getattr(r,"__round__")).apply(null,arguments)}catch(t){throw t.__class__===_b_.AttributeError?_b_.TypeError.$factory("type "+$B.class_name(e)+" doesn't define __round__ method"):t}}if(isinstance(e,_b_.float)&&(e.value===1/0||e.value===-1/0))throw _b_.OverflowError.$factory("cannot convert float infinity to integer");if(!isinstance(n,_b_.int))throw _b_.TypeError.$factory("'"+$B.class_name(n)+"' object cannot be interpreted as an integer");var i,s=Math.pow(10,n),o=e*s,a=Math.floor(o);return.5==Math.abs(o-a)?(a%2&&(a+=1),i=_b_.int.__truediv__(a,s)):i=_b_.int.__truediv__(Math.round(o),s),t.ndigits===None?i.valueOf():e instanceof Number?new Number(i):i.valueOf()}function setattr(){var t=$B.args("setattr",3,{obj:null,attr:null,value:null},["obj","attr","value"],arguments,{},null,null),e=t.obj,n=t.attr,r=t.value;if("string"!=typeof n)throw _b_.TypeError.$factory("setattr(): attribute name must be string");return $B.$setattr(e,n,r)}function sorted(){for(var t=$B.args("sorted",1,{iterable:null},["iterable"],arguments,{},null,"kw"),e=_b_.list.$factory(iter(t.iterable)),n=[e],r=1;r<arguments.length;r++)n.push(arguments[r]);return _b_.list.sort.apply(null,n),e}reversed.__iter__=function(t){return t},reversed.__next__=function(t){if(t.$counter--,t.$counter<0)throw _b_.StopIteration.$factory("");return t.getter(t.$counter)},$B.set_func_names(reversed,"builtins"),$B.$setattr=function(t,e,n){if($B.aliased_names[e])e="$$"+e;else{if("__dict__"==e){if(!isinstance(n,_b_.dict))throw _b_.TypeError.$factory("__dict__ must be set to a dictionary, not a '"+$B.class_name(n)+"'");return t.$infos?(t.$infos.__dict__=n,None):(t.__dict__=n,None)}if("__class__"==e){function r(t){throw _b_.TypeError.$factory(t)}if(n.__class__)if("builtins"==n.__module__)r("__class__ assignement only supported for heap types or ModuleType subclasses");else if(Array.isArray(n.__bases__))for(var i=0;i<n.__bases__.length;i++)"builtins"==n.__bases__[i].__module__&&r("__class__ assignment: '"+$B.class_name(t)+"' object layout differs from '"+$B.class_name(n)+"'");return t.__class__=n,None}"__doc__"==e&&t.__class__===_b_.property&&(t[e]=n)}if(t.$factory||t.$is_class){var s=t.__class__;return s&&s[e]&&s[e].__get__&&s[e].__set__?(s[e].__set__(t,n),None):(t[e]=n,"__init__"==e||"__new__"==e?t.$factory=$B.$instance_creator(t):"__bases__"==e&&(t.__mro__=_b_.type.mro(t)),None)}var o=t[e],a=t.__class__||$B.get_class(t);if(void 0===o&&a&&void 0===(o=a[e])){var l=(d=a.__mro__).length;for(i=0;i<l&&void 0===(o=d[i][e]);i++);}if(null!=o){if(void 0!==o.__set__)return o.__set__(o,t,n),None;var c,u=o.__class__;if(void 0!==u&&void 0===(c=u.__set__))for(i=0,l=(d=u.__mro__).length;i<l&&!(c=d[i].__set__);i++);if(void 0!==c){var h=$B.$getattr(o,"__set__",null);if(h&&"function"==typeof h)return h.apply(o,[t,n]),None}else if(a&&void 0!==a.$descriptors&&void 0!==a[e]){var p=a[e].setter;if("function"==typeof p)return p(t,n),None;throw _b_.AttributeError.$factory("readonly attribute")}}var d,f=!1;if(void 0!==a&&void 0===(f=a.__setattr__))for(i=0,l=(d=a.__mro__).length-1;i<l&&!(f=d[i].__setattr__);i++);if(a&&a.__slots__&&-1==["__module__"].indexOf(e)&&!f){function m(t){return t.__slots__?Array.isArray(t.__slots__)?t.__slots__.map((function(e){return e.startsWith("__")&&!e.endsWith("_")?"_"+t.$infos.__name__+e:e})):t.__slots__:[]}var _=!1;if(m(a).indexOf(e)>-1)_=!0;else for(i=0;i<a.__mro__.length;i++)if(m(a.__mro__[i]).indexOf(e)>-1){_=!0;break}if(!_)throw _b_.AttributeError.$factory("'"+a.$infos.__name__+"' object has no attribute '"+e+"'")}return f?f(t,e,n):void 0===t.__dict__?t[e]=n:_b_.dict.$setitem(t.__dict__,e,n),None};var staticmethod=$B.make_class("staticmethod",(function(t){var e={$infos:t.$infos,__get__:function(){return t}};return e.__get__.__class__=$B.method_wrapper,e.__get__.$infos=t.$infos,e}));function sum(t,e){var n=$B.args("sum",2,{iterable:null,start:null},["iterable","start"],arguments,{start:0},null,null);if(t=n.iterable,e=n.start,_b_.isinstance(e,[_b_.str,_b_.bytes]))throw _b_.TypeError.$factory("TypeError: sum() can't sum bytes [use b''.join(seq) instead]");var r=e;for(t=iter(t);;)try{var i=next(t);r=$B.$getattr(r,"__add__")(i)}catch(t){if(t.__class__===_b_.StopIteration)break;throw t}return r}$B.set_func_names(staticmethod,"builtins"),$B.missing_super2=function(t){return t.$missing=!0,t};var $$super=$B.make_class("super",(function(t,e){if(void 0===t&&void 0===e){var n=$B.last($B.frames_stack),r=$B.imported._sys.Getframe();if(!r.f_code||!r.f_code.co_varnames)throw _b_.RuntimeError.$factory("super(): no arguments");if(void 0===(t=n[1].__class__))throw _b_.RuntimeError.$factory("super(): no arguments");e=n[1][r.f_code.co_varnames[0]]}return Array.isArray(e)&&(e=e[0]),{__class__:$$super,__thisclass__:t,__self_class__:e}}));function vars(){var t={},e=$B.args("vars",1,{obj:null},["obj"],arguments,{obj:t},null,null);if(e.obj===t)return _b_.locals();try{return $B.$getattr(e.obj,"__dict__")}catch(t){if(t.__class__===_b_.AttributeError)throw _b_.TypeError.$factory("vars() argument must have __dict__ attribute");throw t}}$$super.__get__=function(t,e,n){return $$super.$factory(t.__thisclass__,e)},$$super.__getattribute__=function(t,e){var n=t.__thisclass__.__mro__,r=t.__self_class__;if(void 0!==r){r.$is_class||(r=r.__class__||$B.get_class(r));for(var i=[r].concat(r.__mro__),s=0;s<i.length;s++)if(i[s]===t.__thisclass__){n=i.slice(s+1);break}}s=0;for(var o,a,l=n.length;s<l;s++)if(void 0!==n[s][e]){o=n[s][e];break}if(void 0===o){if(void 0!==$$super[e])return a=t,function(){for(var t=[a],n=0,r=arguments.length;n<r;n++)t.push(arguments[n]);return $$super[e].apply(null,t)};throw _b_.AttributeError.$factory(e)}if("staticmethod"==o.$type||"__new__"==e)return o;if("function"!=typeof o)return o;o.__class__===$B.method&&(o=o.$infos.__func__);var c,u=$B.$call(o),h=function(){return u(t.__self_class__,...arguments)};return h.__class__=$B.method,void 0!==o.$infos?c=o.$infos.__module__:o.__class__===property?c=o.fget.$infos.__module:o.$is_class&&(c=o.__module__),h.$infos={__self__:t.__self_class__,__func__:o,__name__:e,__module__:c,__qualname__:t.__thisclass__.$infos.__name__+"."+e},h},$$super.__repr__=$$super.__str__=function(t){var e="<super: <class '"+t.__thisclass__.$infos.__name__+"'>";return void 0!==t.__self_class__?e+=", <"+t.__self_class__.__class__.$infos.__name__+" object>":e+=", NULL",e+">"},$B.set_func_names($$super,"builtins");var $Reader=$B.make_class("Reader");function make_content(t){t.$binary&&void 0===t.$bytes?t.$bytes=_b_.str.encode(t.$string,t.encoding):t.$binary||void 0!==t.$string||(t.$string=_b_.bytes.decode(t.$bytes,t.encoding))}function make_lines(t){if(void 0===t.$lines)if(make_content(t),t.$binary){console.log("make lines, binary");for(var e=[],n=t.$bytes.source;;){var r=n.indexOf(10);if(-1==r){e.push({__class__:_b_.bytes,source:n});break}e.push({__class__:_b_.bytes,source:n.slice(0,r+1)}),n=n.slice(r+1)}t.$lines=e}else t.$lines=t.$string.split("\n")}$Reader.__enter__=function(t){return t},$Reader.__exit__=function(t){return!1},$Reader.__iter__=function(t){return iter($Reader.readlines(t))},$Reader.__len__=function(t){return t.lines.length},$Reader.close=function(t){t.closed=!0},$Reader.flush=function(t){return None},$Reader.read=function(){var t=$B.args("read",2,{self:null,size:null},["self","size"],arguments,{size:-1},null,null),e=t.self,n=$B.$GetInt(t.size);if(!0===e.closed)throw _b_.ValueError.$factory("I/O operation on closed file");make_content(e);var r=e.$binary?e.$bytes.source.length:e.$string.length;return n<0&&(n=r-e.$counter),e.$binary?res=_b_.bytes.$factory(e.$bytes.source.slice(e.$counter,e.$counter+n)):res=e.$string.substr(e.$counter,n),e.$counter+=n,res},$Reader.readable=function(t){return!0},$Reader.readline=function(t,e){var n=$B.args("readline",2,{self:null,size:null},["self","size"],arguments,{size:-1},null,null);if(t=n.self,e=$B.$GetInt(n.size),t.$lc=void 0===t.$lc?-1:t.$lc,!0===t.closed)throw _b_.ValueError.$factory("I/O operation on closed file");if(make_content(t),t.$binary){var r;if(-1==(r=t.$bytes.source.indexOf(10,t.$counter)))return _b_.bytes.$factory();var i={__class__:_b_.bytes,source:t.$bytes.source.slice(t.$counter,r+1)};return t.$counter=r+1,i}return-1==(r=t.$string.indexOf("\n",t.$counter))?"":(i=t.$string.substring(t.$counter,r+1),t.$counter=r+1,t.$lc+=1,i)},$Reader.readlines=function(){var t=$B.args("readlines",2,{self:null,hint:null},["self","hint"],arguments,{hint:-1},null,null),e=t.self,n=$B.$GetInt(t.hint);if(!0===e.closed)throw _b_.ValueError.$factory("I/O operation on closed file");if(e.$lc=void 0===e.$lc?-1:e.$lc,make_lines(e),n<0)var r=e.$lines.slice(e.$lc+1);else for(r=[];e.$lc<e.$lines.length&&0<n;)e.$lc++,r.push(e.$lines[e.$lc]);for(;""==r[r.length-1];)r.pop();return r},$Reader.seek=function(t,e,n){if(t.closed===True)throw _b_.ValueError.$factory("I/O operation on closed file");void 0===n&&(n=0),0===n?t.$counter=e:1===n?t.$counter+=e:2===n&&(t.$counter=t.$content.length+e)},$Reader.seekable=function(t){return!0},$Reader.tell=function(t){return t.$counter},$Reader.writable=function(t){return!1},$B.set_func_names($Reader,"builtins");var $BufferedReader=$B.make_class("_io.BufferedReader");$BufferedReader.__mro__=[$Reader,_b_.object];var $TextIOWrapper=$B.make_class("_io.TextIOWrapper",(function(){var t=$B.args("TextIOWrapper",6,{buffer:null,encoding:null,errors:null,newline:null,line_buffering:null,write_through:null},["buffer","encoding","errors","newline","line_buffering","write_through"],arguments,{encoding:"utf-8",errors:_b_.None,newline:_b_.None,line_buffering:_b_.False,write_through:_b_.False},null,null);return{__class__:$TextIOWrapper,$bytes:t.buffer.$bytes,encoding:t.encoding,errors:t.errors,newline:t.newline}}));function $url_open(){var $ns=$B.args("open",3,{file:null,mode:null,encoding:null},["file","mode","encoding"],arguments,{mode:"r",encoding:"utf-8"},"args","kw"),$bytes,$string,$res;for(var attr in $ns)eval("var "+attr+'=$ns["'+attr+'"]');if(args.length>0)var mode=args[0];if(args.length>1)var encoding=args[1];if(mode.search("w")>-1)throw _b_.IOError.$factory("Browsers cannot write on disk");if(-1==["r","rb"].indexOf(mode))throw _b_.ValueError.$factory("Invalid mode '"+mode+"'");if(isinstance(file,_b_.str)){var is_binary=mode.search("b")>-1;if($B.file_cache.hasOwnProperty($ns.file))$string=$B.file_cache[$ns.file];else if($B.files&&$B.files.hasOwnProperty($ns.file)){$res=atob($B.files[$ns.file].content);var source=[];for(const t of $res)source.push(t.charCodeAt(0));$bytes=_b_.bytes.$factory(),$bytes.source=source}else{if("file"==$B.protocol)throw _b_.FileNotFoundError.$factory("cannot use 'open()' with protocol 'file'");if(is_binary)throw _b_.IOError.$factory("open() in binary mode is not supported");var req=new XMLHttpRequest;req.onreadystatechange=function(){try{var t=this.status;$res=404==t?_b_.FileNotFoundError.$factory(file):200!=t?_b_.IOError.$factory("Could not open file "+file+" : status "+t):this.responseText}catch(t){$res=_b_.IOError.$factory("Could not open file "+file+" : error "+t)}};var fake_qs=$B.$options.cache?"":"?foo="+(new Date).getTime();if(req.open("GET",file+fake_qs,!1),req.overrideMimeType("text/plain; charset=utf-8"),req.send(),$res.constructor===Error)throw $res;$string=$res}if(void 0===$string&&void 0===$bytes)throw _b_.FileNotFoundError.$factory($ns.file);var res={$binary:is_binary,$string,$bytes,$counter:0,closed:False,encoding,mode,name:file};return res.__class__=is_binary?$BufferedReader:$TextIOWrapper,res}throw _b_.TypeError.$factory("invalid argument for open(): "+_b_.str.$factory(file))}$TextIOWrapper.__mro__=[$Reader,_b_.object],$B.set_func_names($TextIOWrapper,"builtins"),$B.Reader=$Reader,$B.TextIOWrapper=$TextIOWrapper,$B.BufferedReader=$BufferedReader;var zip=$B.make_class("zip",(function(){var t={__class__:zip,items:[]};if(0==arguments.length)return t;for(var e=$B.args("zip",0,{},[],arguments,{},"args","kw").args,n=[],r=0;r<e.length;r++)n.push(iter(e[r]));for(var i=0,s=[];;){var o=[],a=!0;for(r=0;r<n.length;r++)try{o.push(next(n[r]))}catch(t){if(t.__class__==_b_.StopIteration){a=!1;break}throw t}if(!a)break;s[i++]=_b_.tuple.$factory(o)}return t.items=s,t})),zip_iterator=$B.make_iterator_class("zip_iterator");function no_set_attr(t,e){throw void 0!==t[e]?_b_.AttributeError.$factory("'"+t.$infos.__name__+"' object attribute '"+e+"' is read-only"):_b_.AttributeError.$factory("'"+t.$infos.__name__+"' object has no attribute '"+e+"'")}zip.__iter__=function(t){return zip_iterator.$factory(t.items)},$B.set_func_names(zip,"builtins");var True=!0,False=!1,ellipsis=$B.make_class("ellipsis",(function(){return Ellipsis})),Ellipsis={__class__:ellipsis,__bool__:function(){return True}};for(var $key in $B.$comps)switch($B.$comps[$key]){case"ge":case"gt":case"le":case"lt":ellipsis["__"+$B.$comps[$key]+"__"]=function(t){return function(e){throw _b_.TypeError.$factory("unorderable types: ellipsis() "+t+" "+$B.class_name(e))}}($key)}for(var $func in Ellipsis)"function"==typeof Ellipsis[$func]&&(Ellipsis[$func].__str__=function(t){return function(){return"<method-wrapper "+t+" of Ellipsis object>"}}($func));$B.set_func_names(ellipsis);var FunctionCode=$B.make_class("function code"),FunctionGlobals=$B.make_class("function globals");$B.Function={__class__:_b_.type,__code__:{__class__:FunctionCode,__name__:"function code"},__globals__:{__class__:FunctionGlobals,__name__:"function globals"},__mro__:[_b_.object],$infos:{__name__:"function",__module__:"builtins"},$is_class:!0},$B.Function.__delattr__=function(t,e){if("__dict__"==e)throw _b_.TypeError.$factory("can't deleted function __dict__")},$B.Function.__dir__=function(t){var e=t.$infos||{},n=t.$attrs||{};return Object.keys(e).concat(Object.keys(n))},$B.Function.__eq__=function(t,e){return t===e},$B.Function.__get__=function(t,e){if(e===_b_.None)return t;var n=function(){return t(e,...arguments)};return n.__class__=$B.method,void 0===t.$infos&&(console.log("no $infos",t),console.log($B.last($B.frames_stack))),n.$infos={__name__:t.$infos.__name__,__qualname__:$B.class_name(e)+"."+t.$infos.__name__,__self__:e,__func__:t},n},$B.Function.__getattribute__=function(t,e){if(!t.$infos||void 0===t.$infos[e]){if(t.$infos&&t.$infos.__dict__&&void 0!==t.$infos.__dict__.$string_dict[e])return t.$infos.__dict__.$string_dict[e][0];if("__closure__"==e){var n=t.$infos.__code__.co_freevars;if(0==n.length)return None;for(var r=[],i=0;i<n.length;i++)try{r.push($B.cell.$factory($B.$check_def_free(n[i])))}catch(t){r.push($B.cell.$factory(None))}return _b_.tuple.$factory(r)}return"__globals__"==e?$B.obj_dict($B.imported[t.$infos.__module__]):t.$attrs&&void 0!==t.$attrs[e]?t.$attrs[e]:_b_.object.__getattribute__(t,e)}if("__code__"==e){var s={__class__:code};for(var e in t.$infos.__code__)s[e]=t.$infos.__code__[e];return s.name=t.$infos.__name__,s.filename=t.$infos.__code__.co_filename,s.co_code=t+"",s}return"__annotations__"==e?$B.obj_dict(t.$infos[e]):t.$infos.hasOwnProperty(e)?t.$infos[e]:void 0},$B.Function.__repr__=$B.Function.__str__=function(t){return void 0===t.$infos?"<function "+t.name+">":"<function "+t.$infos.__qualname__+">"},$B.Function.__mro__=[_b_.object],$B.Function.__setattr__=function(t,e,n){if("__closure__"==e)throw _b_.AttributeError.$factory("readonly attribute");if("__defaults__"==e){if(n===_b_.None)n=[];else if(!isinstance(n,_b_.tuple))throw _b_.TypeError.$factory("__defaults__ must be set to a tuple object");var r=t.$set_defaults;if(void 0===r)throw _b_.AttributeError.$factory("cannot set attribute "+e+" of "+_b_.str.$factory(t));if(!t.$infos||!t.$infos.__code__)throw _b_.AttributeError.$factory("cannot set attribute "+e+" of "+_b_.str.$factory(t));for(var i=t.$infos.__code__.co_argcount,s=t.$infos.__code__.co_varnames.slice(0,i),o={},a=n.length-1;a>=0;a--){var l=s.length-n.length+a;if(l<0)break;o[s[l]]=n[a]}var c=t.$infos.$class,u=r(o);return u.$set_defaults=r,c?(c[t.$infos.__name__]=u,u.$infos.$class=c,u.$infos.__defaults__=n):(t.$infos.$defaults=n,t.$infos.__defaults__=n),_b_.None}void 0!==t.$infos[e]?t.$infos[e]=n:(t.$attrs=t.$attrs||{},t.$attrs[e]=n)},$B.Function.$factory=function(){},$B.set_func_names($B.Function,"builtins"),_b_.__BRYTHON__=__BRYTHON__,$B.builtin_funcs=["abs","all","any","ascii","bin","breakpoint","callable","chr","compile","delattr","dir","divmod","eval","exec","exit","format","getattr","globals","hasattr","hash","help","hex","id","input","isinstance","issubclass","iter","len","locals","max","min","next","oct","open","ord","pow","print","quit","repr","round","setattr","sorted","sum","vars"];var builtin_function=$B.builtin_function=$B.make_class("builtin_function_or_method");builtin_function.__getattribute__=$B.Function.__getattribute__,builtin_function.__reduce_ex__=builtin_function.__reduce__=function(t){return t.$infos.__name__},builtin_function.__repr__=builtin_function.__str__=function(t){return"<built-in function "+t.$infos.__name__+">"},$B.set_func_names(builtin_function,"builtins");var method_wrapper=$B.make_class("method_wrapper");method_wrapper.__repr__=method_wrapper.__str__=function(t){return"<method wrapper '"+t.$infos.__name__+"' of function object>"},$B.set_func_names(method_wrapper,"builtins");var wrapper_descriptor=$B.wrapper_descriptor=$B.make_class("wrapper_descriptor");wrapper_descriptor.__getattribute__=$B.Function.__getattribute__,wrapper_descriptor.__repr__=wrapper_descriptor.__str__=function(t){return"<slot wrapper '"+t.$infos.__name__+"' of '"+t.__objclass__.$infos.__name__+"' object>"},$B.set_func_names(wrapper_descriptor,"builtins"),$B.builtin_classes=["bool","bytearray","bytes","classmethod","complex","dict","enumerate","filter","float","frozenset","int","list","map","memoryview","object","property","range","reversed","set","slice","staticmethod","str","super","tuple","type","zip"];for(var other_builtins=["Ellipsis","False","None","True","__debug__","__import__","copyright","credits","license","NotImplemented"],builtin_names=$B.builtin_funcs.concat($B.builtin_classes).concat(other_builtins),i=0;i<builtin_names.length;i++){var name=builtin_names[i],orig_name=name,name1=name;"open"==name&&(name1="$url_open"),"super"==name&&(name=name1="$$super"),"eval"==name&&(name=name1="$$eval"),"print"==name&&(name1="$print");try{_b_[name]=eval(name1),$B.builtin_funcs.indexOf(orig_name)>-1&&(_b_[name].__class__=builtin_function,_b_[name].$infos={__module__:"builtins",__name__:orig_name,__qualname__:orig_name})}catch(t){}}_b_.open=$url_open,_b_.print=$print,_b_.$$super=$$super,_b_.object.__init__.__class__=wrapper_descriptor,_b_.object.__new__.__class__=builtin_function}(__BRYTHON__),function($B){var bltns=$B.InjectBuiltins();eval(bltns),$B.del_exc=function(){$B.last($B.frames_stack)[1].$current_exception=void 0},$B.set_exc=function(t){var e=$B.last($B.frames_stack);void 0===e&&console.log("no frame",t),e[1].$current_exception=$B.exception(t)},$B.get_exc=function(){return $B.last($B.frames_stack)[1].$current_exception},$B.$raise=function(t){if(void 0===t){var e=$B.get_exc();if(void 0!==e)throw e;throw _b_.RuntimeError.$factory("No active exception to reraise")}if(isinstance(t,BaseException))throw t.__class__===_b_.StopIteration&&$B.last($B.frames_stack)[1].$is_generator&&(t=_b_.RuntimeError.$factory("generator raised StopIteration")),t;if(t.$is_class&&issubclass(t,BaseException)){if(t===_b_.StopIteration&&$B.last($B.frames_stack)[1].$is_generator)throw _b_.RuntimeError.$factory("generator raised StopIteration");throw $B.$call(t)()}throw _b_.TypeError.$factory("exceptions must derive from BaseException")},$B.$syntax_err_line=function(t,e,n,r,i){var s={},o=1;if(e="$"==e.charAt(0)?"<string>":e,void 0===n)t.$line_info=i+","+e,t.args=_b_.tuple.$factory([$B.$getitem(t.args,0),e,i,0,0]);else{for(var a={1:0},l=0,c=n.length;l<c;l++)s[l]=o,"\n"==n.charAt(l)&&(a[++o]=l);for(;void 0===i;)i=s[r],r--;t.$line_info=i+","+e;var u=n.split("\n")[i-1],h=r-a[i];for(c=u.length,t.text=u,(h-=c-u.length)<0&&(h=0);" "==u.charAt(0);)u=u.substr(1),h>0&&h--;t.offset=h,t.args=_b_.tuple.$factory([$B.$getitem(t.args,0),e,i,h,u])}t.lineno=i,t.msg=t.args[0],t.filename=e},$B.$SyntaxError=function(t,e,n,r,i,s){void 0!==s&&void 0!==s.line_info&&(i=s.line_info);var o=_b_.SyntaxError.$factory(e);throw $B.$syntax_err_line(o,t,n,r,i),o},$B.$IndentationError=function(t,e,n,r,i,s){$B.frames_stack.push([t,{$line_info:i+","+t},t,{$src:n}]),void 0!==s&&void 0!==s.line_info&&(i=s.line_info);var o=_b_.IndentationError.$factory(e);throw $B.$syntax_err_line(o,t,n,r,i),o},$B.print_stack=function(t){t=t||$B.frames_stack;var e=[];return t.forEach((function(t){var n=t[1].$line_info;if(void 0!==n){var r=n.split(",");r[1].startsWith("$exec")&&(r[1]="<module>"),e.push(r[1]+" line "+r[0]);var i=$B.file_cache[t[3].__file__];if(i){var s=i.split("\n")[parseInt(r[0])-1];e.push("  "+s.trim())}}})),console.log("print stack ok",e),e.join("\n")};var traceback=$B.traceback=$B.make_class("traceback",(function(t,e){return $B.last($B.frames_stack),void 0===e&&(e=t.$stack),{__class__:traceback,$stack:e,exc:t}}));traceback.__getattribute__=function(t,e){var n;if("tb_frame"===e||"tb_lineno"===e||"tb_lasti"===e||"tb_next"===e){0==t.$stack.length&&console.log("no stack",e);var r=t.$stack[0];n=t.exc.$line_infos[t.exc.$line_infos.length-t.$stack.length]}switch(e){case"tb_frame":return frame.$factory(t.$stack);case"tb_lineno":return void 0===n||r[0].startsWith($B.lambda_magic)?r[4]&&r[4].$infos&&r[4].$infos.__code__?r[4].$infos.__code__.co_firstlineno:-1:parseInt(n.split(",")[0]);case"tb_lasti":if(void 0===n)return console.log("no line info",t.$stack),"";for(var i,s,o=n.split(","),a=t.$stack.length-1;a>=0;a--){var l=t.$stack[a];if(l[2]==o[1].replace(/\./g,"_")){s=l[3].__file__;break}}if(void 0===i&&($B.file_cache.hasOwnProperty(s)?i=$B.file_cache[s]:$B.imported[o[1]]&&$B.imported[o[1]].__file__&&(i=$B.file_cache[$B.imported[o[1]].__file__],console.log("from filecache",n,$B.imported[o[1]].__file__))),void 0===i)return console.log(s),console.log("no src for",o),"";try{return i.split("\n")[parseInt(o[0]-1)].trim()}catch(e){throw console.log("error in attr tb_lasti of",t),console.log(i,o),e}case"tb_next":return t.$stack.length<=1?None:traceback.$factory(t.exc,t.$stack.slice(1));default:return _b_.object.__getattribute__(t,e)}},$B.set_func_names(traceback,"builtins");var frame=$B.make_class("frame",(function(t,e){var n=t,r={__class__:frame,f_builtins:{},$stack:t.slice()};if(void 0===e&&(e=0),r.$pos=e,n.length){var i,s=n[e],o=s[0];try{r.f_locals=$B.obj_dict(s[1])}catch(t){throw console.log("err "+t),t}if(r.f_globals=$B.obj_dict(s[3]),void 0!==s[3].__file__&&(i=s[3].__file__),o.startsWith("$exec")&&(i="<string>"),void 0===s[1].$line_info)r.f_lineno=-1;else{var a=s[1].$line_info.split(",");r.f_lineno=parseInt(a[0]);var l=a[1];$B.imported.hasOwnProperty(l)&&(i=$B.imported[l].__file__),r.f_lineno=parseInt(s[1].$line_info.split(",")[0])}var c=o.startsWith("$exec")?"<module>":o;o==s[2]?c="<module>":o.startsWith("lc"+$B.lambda_magic)?c="<listcomp>":s[1].$name?c=s[1].$name:s[1].$dict_comp?c="<dictcomp>":s[1].$list_comp?c="<listcomp>":s.length>4&&(c=s[4].$infos?s[4].$infos.__name__:s[4].name,void 0===s[4].$infos?s[4].name.startsWith("__ge")?c="<genexpr>":s[4].name.startsWith("set_comp"+$B.lambda_magic)?c="<setcomp>":s[4].name.startsWith("lambda"+$B.lambda_magic)&&(c="<lambda>"):void 0===i&&s[4].$infos.__code__&&(void 0===(i=s[4].$infos.__code__.co_filename)&&(i=s[4].$infos.__module__),r.f_lineno=s[4].$infos.__code__.co_firstlineno)),s.length>4&&void 0!==s[4].$infos?r.f_code=s[4].$infos.__code__:r.f_code={co_name:c,co_filename:i},r.f_code.__class__=$B.code,r.f_code.co_code=_b_.None,void 0===i&&(r.f_code.co_filename="<string>")}return r}));frame.__delattr__=function(t,e){"f_trace"==e&&($B.last(t.$stack)[1].$f_trace=_b_.None)},frame.__getattr__=function(t,e){if("f_back"==e)return t.$pos>0?frame.$factory(t.$stack.slice(0,t.$stack.length-1),t.$pos-1):_b_.None;if("clear"==e)return function(){};if("f_trace"==e){var n=$B.last(t.$stack)[1];return void 0===n.$f_trace?_b_.None:n.$f_trace}},frame.__setattr__=function(t,e,n){"f_trace"==e&&($B.last(t.$stack)[1].$f_trace=n)},frame.__str__=frame.__repr__=function(t){return"<frame object, file "+t.f_code.co_filename+", line "+t.f_lineno+", code "+t.f_code.co_name+">"},$B.set_func_names(frame,"builtins"),$B._frame=frame;var BaseException=_b_.BaseException={__class__:_b_.type,__bases__:[_b_.object],__mro__:[_b_.object],args:[],$infos:{__name__:"BaseException",__module__:"builtins"},$is_class:!0};BaseException.__init__=function(t){var e=void 0===arguments[1]?[]:[arguments[1]];t.args=_b_.tuple.$factory(e)},BaseException.__repr__=function(t){var e=t.__class__.$infos.__name__;return t.args[0]&&(e+="("+repr(t.args[0])),t.args.length>1&&(e+=", "+repr($B.fast_tuple(t.args.slice(1)))),e+")"},BaseException.__str__=function(t){return t.args.length>0?_b_.str.$factory(t.args[0]):t.__class__.$infos.__name__},BaseException.__new__=function(t){var e=_b_.BaseException.$factory();return e.__class__=t,e.__dict__=$B.empty_dict(),e};var getExceptionTrace=function(t,e){if(void 0===t.__class__)return $B.debug>1&&console.log("no class",t),t+"";var n="";void 0!==t.$js_exc&&e&&(n+="\nJS stack:\n"+t.$js_exc.stack+"\n"),n+="Traceback (most recent call last):";for(var r=t.$line_info,i=0;i<t.$stack.length;i++){var s=t.$stack[i];if(s[1]&&s[1].$line_info){var o;if(r=s[1].$line_info.split(","),t.module==r[1]&&(o=t.src),!e&&void 0===(o=s[3].$src))if($B.VFS&&$B.VFS.hasOwnProperty(s[2]))o=$B.VFS[s[2]][1];else if(!(o=$B.file_cache[s[3].__file__]))continue;var a=s[3].__file__||"<string>",l=r[1],c="$"==l.charAt(0);if(c&&(l="<module>"),n+="\n  File "+a+" line "+r[0],s.length>4)if(s[4].$infos){var u=s[4].$infos.__name__;u.startsWith("lc"+$B.lambda_magic)?n+=",in <listcomp>":n+=", in "+u}else s[4].name.startsWith("__ge")?n+=", in <genexpr>":s[4].name.startsWith("set_comp"+$B.lambda_magic)?n+=", in <setcomp>":s[4].name.startsWith("lc"+$B.lambda_magic)?n+=", in <listcomp>":console.log("frame[4]",s[4]);else s[1].$list_comp?n+=", in <listcomp>":s[1].$dict_comp?n+=", in <dictcomp>":n+=", in <module>";if(void 0!==o&&!c){var h=o.split("\n")[parseInt(r[0])-1];h&&(h=h.replace(/^[ ]+/g,"")),n+="\n    "+h}}}return t.__class__===_b_.SyntaxError&&(n+="\n  File "+t.args[1]+", line "+t.args[2]+"\n    "+t.args[4]),n};BaseException.__getattr__=function(t,e){if("info"==e)return getExceptionTrace(t,!1);if("infoWithInternal"==e)return getExceptionTrace(t,!0);if("__traceback__"==e)return void 0!==t.$traceback?t.$traceback:traceback.$factory(t);throw _b_.AttributeError.$factory(t.__class__.$infos.__name__+" has no attribute '"+e+"'")},BaseException.with_traceback=function(t,e){return t.$traceback=e,t},$B.deep_copy=function(t){var e=[];for(const i of t){var n=[i[0],{},i[2],{}];void 0!==i[4]&&n.push(i[4]);for(const t of[1,3])for(var r in i[t])n[t][r]=i[t][r];e.push(n)}return e},$B.save_stack=function(){return $B.deep_copy($B.frames_stack)},$B.restore_stack=function(t,e){$B.frames_stack=t,$B.frames_stack[$B.frames_stack.length-1][1]=e},$B.freeze=function(t){if(void 0===t.$stack){t.$line_infos=[];for(var e=0,n=$B.frames_stack.length;e<n;e++)t.$line_infos.push($B.frames_stack[e][1].$line_info);t.$stack=$B.frames_stack.slice(),$B.frames_stack.length&&(t.$line_info=$B.last($B.frames_stack)[1].$line_info)}};var show_stack=$B.show_stack=function(t){t=t||$B.frames_stack;for(const e of t)console.log(e[0],e[1].$line_info)};function $make_exc(names,parent){for(var _str=[],pos=0,i=0;i<names.length;i++){var name=names[i],code="";if(Array.isArray(name))var code=name[1],name=name[0];$B.builtins_scope[name]=!0;var $exc=(BaseException.$factory+"").replace(/BaseException/g,name);$exc=$exc.replace("//placeholder//",code),_str[pos++]="_b_."+name+" = {__class__:_b_.type, __mro__: [_b_."+parent.$infos.__name__+"].concat(parent.__mro__), $is_class: true,$infos: {__name__:'"+name+"'}}",_str[pos++]="_b_."+name+".$factory = "+$exc,_str[pos++]="_b_."+name+'.$factory.$infos = {__name__: "'+name+'", __qualname__: "'+name+'"}',_str[pos++]="$B.set_func_names(_b_."+name+", 'builtins')"}try{eval(_str.join(";"))}catch(t){throw console.log("--err"+t),t}}BaseException.$factory=function(){var err=Error();return err.args=$B.fast_tuple(Array.prototype.slice.call(arguments)),err.__class__=_b_.BaseException,err.$py_error=!0,$B.freeze(err),eval("//placeholder//"),err.__cause__=_b_.None,err.__context__=_b_.None,err.__suppress_context__=!1,err},BaseException.$factory.$infos={__name__:"BaseException",__qualname__:"BaseException"},$B.set_func_names(BaseException),_b_.BaseException=BaseException,$B.exception=function(t,e){if(t.__class__){if(s=t,$B.freeze(s),e)for(var n=$B.last($B.frames_stack)[0],r=0,i=s.$stack.length;r<i;r++)if(s.$stack[r][0]==n){s.$stack=s.$stack.slice(r),s.$traceback=traceback.$factory(s);break}}else{var s;if(console.log("Javascript exception:",t),console.log($B.last($B.frames_stack)),console.log("recursion error ?",$B.is_recursion_error(t)),(s=Error()).__name__="Internal Javascript error: "+(t.__name__||t.name),s.__class__=_b_.Exception,s.$js_exc=t,$B.is_recursion_error(t))return _b_.RecursionError.$factory("too much recursion");"ReferenceError"==t.name?(s.__name__="NameError",s.__class__=_b_.NameError,t.message=t.message.replace("$$","")):"InternalError"==t.name&&(s.__name__="RuntimeError",s.__class__=_b_.RuntimeError),s.__cause__=_b_.None,s.__context__=_b_.None,s.__suppress_context__=!1;var o="<Javascript "+t.name+">: "+(t.message||"<"+t+">");s.args=_b_.tuple.$factory([o]),s.$py_error=!0,$B.freeze(s)}return s},$B.is_exc=function(t,e){void 0===t.__class__&&(t=$B.exception(t));for(var n=t.$is_class?t:t.__class__,r=0;r<e.length;r++){var i=e[r];if(void 0===n&&console.log("exc class undefined",t),issubclass(n,i))return!0}return!1},$B.is_recursion_error=function(t){console.log("test is js exc is recursion error",t,t+"");var e=(t+"").split(":"),n=e[0].trim(),r=e[1].trim();return"InternalError"==n&&"too much recursion"==r||"Error"==n&&"Out of stack space"==r||"RangeError"==n&&"Maximum call stack size exceeded"==r},$make_exc(["SystemExit","KeyboardInterrupt","GeneratorExit","Exception"],BaseException),$make_exc([["StopIteration","err.value = arguments[0]"],["StopAsyncIteration","err.value = arguments[0]"],"ArithmeticError","AssertionError","AttributeError","BufferError","EOFError",["ImportError","err.name = arguments[0]"],"LookupError","MemoryError","NameError","OSError","ReferenceError","RuntimeError",["SyntaxError","err.msg = arguments[0]"],"SystemError","TypeError","ValueError","Warning"],_b_.Exception),$make_exc(["FloatingPointError","OverflowError","ZeroDivisionError"],_b_.ArithmeticError),$make_exc([["ModuleNotFoundError","err.name = arguments[0]"]],_b_.ImportError),$make_exc(["IndexError","KeyError"],_b_.LookupError),$make_exc(["UnboundLocalError"],_b_.NameError),$make_exc(["BlockingIOError","ChildProcessError","ConnectionError","FileExistsError","FileNotFoundError","InterruptedError","IsADirectoryError","NotADirectoryError","PermissionError","ProcessLookupError","TimeoutError"],_b_.OSError),$make_exc(["BrokenPipeError","ConnectionAbortedError","ConnectionRefusedError","ConnectionResetError"],_b_.ConnectionError),$make_exc(["NotImplementedError","RecursionError"],_b_.RuntimeError),$make_exc(["IndentationError"],_b_.SyntaxError),$make_exc(["TabError"],_b_.IndentationError),$make_exc(["UnicodeError"],_b_.ValueError),$make_exc(["UnicodeDecodeError","UnicodeEncodeError","UnicodeTranslateError"],_b_.UnicodeError),$make_exc(["DeprecationWarning","PendingDeprecationWarning","RuntimeWarning","SyntaxWarning","UserWarning","FutureWarning","ImportWarning","UnicodeWarning","BytesWarning","ResourceWarning"],_b_.Warning),$make_exc(["EnvironmentError","IOError","VMSError","WindowsError"],_b_.OSError),$B.$TypeError=function(t){throw _b_.TypeError.$factory(t)};var se=_b_.SyntaxError.$factory;_b_.SyntaxError.$factory=function(){var t=arguments[0];if(t.__class__===_b_.SyntaxError)return t;var e=se.apply(null,arguments),n=$B.last($B.frames_stack);if(n){line_info=n[1].$line_info,e.filename=n[3].__file__,e.lineno=parseInt(line_info.split(",")[0]);var r=$B.file_cache[n[3].__file__];r&&(lines=r.split("\n"),e.text=lines[e.lineno-1]),e.offset=t.offset}return e},_b_.SyntaxError}(__BRYTHON__),function(t){var e=t.builtins,n=e.None,r={__class__:e.type,__mro__:[e.object],$infos:{__module__:"builtins",__name__:"range"},$is_class:!0,$native:!0,$descriptors:{start:!0,step:!0,stop:!0}};function i(e,n){var i=r.__len__(e);return 0==i?e.start:n>i?e.stop:t.add(e.start,t.mul(e.step,n))}r.__contains__=function(e,n){if(0==r.__len__(e))return!1;try{n=t.int_or_bool(n)}catch(t){try{return r.index(e,n),!0}catch(t){return!1}}var i=t.sub(n,e.start),s=t.floordiv(i,e.step),o=t.mul(e.step,s);return!!t.eq(o,i)&&(t.gt(e.stop,e.start)?t.ge(n,e.start)&&t.gt(e.stop,n):t.ge(e.start,n)&&t.gt(n,e.stop))},r.__delattr__=function(t,n,r){throw e.AttributeError.$factory("readonly attribute")},r.__eq__=function(n,i){if(e.isinstance(i,r)){var s=r.__len__(n);return!!t.eq(s,r.__len__(i))&&(0==s||!!t.eq(n.start,i.start)&&(1==s||t.eq(n.step,i.step)))}return!1},r.__getitem__=function(n,s){if(e.isinstance(s,e.slice)){var o=e.slice.$conv_for_seq(s,r.__len__(n)),a=t.mul(n.step,o.step),l=i(n,o.start),c=i(n,o.stop);return r.$factory(l,c,a)}"number"!=typeof s&&(s=t.$GetInt(s)),t.gt(0,s)&&(s=t.add(s,r.__len__(n)));var u=t.add(n.start,t.mul(s,n.step));if(t.gt(n.step,0)&&(t.ge(u,n.stop)||t.gt(n.start,u))||t.gt(0,n.step)&&(t.ge(n.stop,u)||t.gt(u,n.start)))throw e.IndexError.$factory("range object index out of range");return u},r.__hash__=function(t){var i=r.__len__(t);return 0==i?e.hash(e.tuple.$factory([0,n,n])):1==i?e.hash(e.tuple.$factory([1,t.start,n])):e.hash(e.tuple.$factory([i,t.start,t.step]))};var s={__class__:e.type,__mro__:[e.object],__iter__:function(t){return t},__next__:function(t){return e.next(t.obj)},$infos:{__name__:"range_iterator",__module__:"builtins"},$is_class:!0,$factory:function(t){return{__class__:s,obj:t}}};t.set_func_names(s,"builtins"),r.__iter__=function(e){var n={__class__:r,start:e.start,stop:e.stop,step:e.step};return e.$safe?n.$counter=e.start-e.step:n.$counter=t.sub(e.start,e.step),s.$factory(n)},r.__len__=function(e){var n;if(t.gt(e.step,0)){if(t.ge(e.start,e.stop))return 0;var r=t.sub(e.stop,t.add(1,e.start)),i=t.floordiv(r,e.step);n=t.add(1,i)}else{if(t.ge(e.stop,e.start))return 0;r=t.sub(e.start,t.add(1,e.stop)),i=t.floordiv(r,t.mul(-1,e.step)),n=t.add(1,i)}return void 0===t.maxsize&&(t.maxsize=t.long_int.__pow__(t.long_int.$factory(2),63),t.maxsize=t.long_int.__sub__(t.maxsize,1)),n},r.__next__=function(n){if(n.$safe){if(n.$counter+=n.step,n.step>0&&n.$counter>=n.stop||n.step<0&&n.$counter<=n.stop)throw e.StopIteration.$factory("")}else if(n.$counter=t.add(n.$counter,n.step),t.gt(n.step,0)&&t.ge(n.$counter,n.stop)||t.gt(0,n.step)&&t.ge(n.stop,n.$counter))throw e.StopIteration.$factory("");return n.$counter},r.__reversed__=function(e){var n=t.sub(r.__len__(e),1);return r.$factory(t.add(e.start,t.mul(n,e.step)),t.sub(e.start,e.step),t.mul(-1,e.step))},r.__repr__=r.__str__=function(t){var n="range("+e.str.$factory(t.start)+", "+e.str.$factory(t.stop);return 1!=t.step&&(n+=", "+e.str.$factory(t.step)),n+")"},r.__setattr__=function(t,n,r){throw e.AttributeError.$factory("readonly attribute")},r.start=function(t){return t.start},r.step=function(t){return t.step},r.stop=function(t){return t.stop},r.count=function(n,i){if(e.isinstance(i,[e.int,e.float,e.bool]))return e.int.$factory(r.__contains__(n,i));for(var o=r.__iter__(n),a=s.__next__,l=0;;)try{c=a(o),t.rich_comp("__eq__",i,c)&&l++}catch(t){if(e.isinstance(t,e.StopIteration))return l;throw t}var c},r.index=function(n,i){var o,a=t.args("index",2,{self:null,other:null},["self","other"],arguments,{},null,null);n=a.self,i=a.other;try{i=t.int_or_bool(i)}catch(a){for(var l=r.__iter__(n),c=s.__next__,u=0;;)try{if(o=c(l),t.rich_comp("__eq__",i,o))return u;u++}catch(t){if(e.isinstance(t,e.StopIteration))throw e.ValueError.$factory(e.str.$factory(i)+" not in range");throw t}}var h=t.sub(i,n.start),p=t.floordiv(h,n.step),d=t.mul(n.step,p);if(t.eq(d,h)){if(t.gt(n.stop,n.start)&&t.ge(i,n.start)&&t.gt(n.stop,i)||t.ge(n.start,n.stop)&&t.ge(n.start,i)&&t.gt(i,n.stop))return p;throw e.ValueError.$factory(e.str.$factory(i)+" not in range")}throw e.ValueError.$factory(e.str.$factory(i)+" not in range")},r.$factory=function(){var n=t.args("range",3,{start:null,stop:null,step:null},["start","stop","step"],arguments,{start:null,stop:null,step:null},null,null),i=n.start,s=n.stop,o=n.step;if(null===s&&null===o){if(null==i)throw e.TypeError.$factory("range expected 1 arguments, got 0");return s=t.PyNumber_Index(i),{__class__:r,start:0,stop:s,step:1,$is_range:!0,$safe:"number"==typeof s}}if(null===o&&(o=1),i=t.PyNumber_Index(i),s=t.PyNumber_Index(s),0==(o=t.PyNumber_Index(o)))throw e.ValueError.$factory("range arg 3 must not be zero");return{__class__:r,start:i,stop:s,step:o,$is_range:!0,$safe:"number"==typeof i&&"number"==typeof s&&"number"==typeof o}},t.set_func_names(r,"builtins");var o={__class__:e.type,__mro__:[e.object],$infos:{__module__:"builtins",__name__:"slice"},$is_class:!0,$native:!0,$descriptors:{start:!0,step:!0,stop:!0}};function a(n){for(var r=["start","stop","step"],i=[],s=0;s<r.length;s++){var o=n[r[s]];if(o===e.None)i.push(o);else try{i.push(t.PyNumber_Index(o))}catch(t){throw e.TypeError.$factory("slice indices must be integers or None or have an __index__ method")}}return i}o.__eq__=function(t,e){var n=a(t),r=a(e);return n[0]==r[0]&&n[1]==r[1]&&n[2]==r[2]},o.__repr__=o.__str__=function(t){return"slice("+e.str.$factory(t.start)+", "+e.str.$factory(t.stop)+", "+e.str.$factory(t.step)+")"},o.__setattr__=function(t,n,r){throw e.AttributeError.$factory("readonly attribute")},o.$conv_for_seq=function(r,i){var s,o=r.step===n?1:t.PyNumber_Index(r.step),a=t.gt(0,o),l=t.sub(i,1);if(0==o)throw e.ValueError.$factory("slice step cannot be zero");return r.start===n?s=a?l:0:(s=t.PyNumber_Index(r.start),t.gt(0,s)&&(s=t.add(s,i),t.gt(0,s)&&(s=0)),t.ge(s,i)&&(s=o<0?l:i)),r.stop===n?stop=a?-1:i:(stop=t.PyNumber_Index(r.stop),t.gt(0,stop)&&(stop=t.add(stop,i)),t.ge(stop,i)&&(stop=a?l:i)),{start:s,stop,step:o}},o.start=function(t){return t.start},o.step=function(t){return t.step},o.stop=function(t){return t.stop},o.indices=function(n,r){var i=t.args("indices",2,{self:null,length:null},["self","length"],arguments,{},null,null),s=t.$GetInt(i.length);s<0&&e.ValueError.$factory("length should not be negative");var o=n.step==e.None?1:n.step;if(o<0){var a=n.start,l=n.stop;a=a==e.None?s-1:a<0?e.max(-1,a+s):e.min(s-1,n.start),l=n.stop==e.None?-1:l<0?e.max(-1,l+s):e.min(s-1,n.stop)}else a=n.start==e.None?0:e.min(s,n.start),l=n.stop==e.None?s:e.min(s,n.stop),a<0&&(a=e.max(0,a+s)),l<0&&(l=e.max(0,l+s));return e.tuple.$factory([a,l,o])},o.$factory=function(){var n,r,i,s=t.args("slice",3,{start:null,stop:null,step:null},["start","stop","step"],arguments,{stop:null,step:null},null,null);null===s.stop&&null===s.step?(n=e.None,r=s.start,i=e.None):(n=s.start,r=s.stop,i=null===s.step?e.None:s.step);var l={__class__:o,start:n,stop:r,step:i};return a(l),l},t.set_func_names(o,"builtins"),e.range=r,e.slice=o}(__BRYTHON__),function(t){var e=t.builtins,n={},r={};function i(t,n,r){if(void 0===n){n=[];for(var i="\r\n \t",s=0,o=i.length;s<o;s++)n.push(i.charCodeAt(s))}else{if(!e.isinstance(n,l))throw e.TypeError.$factory("Type str doesn't support the buffer API");n=n.source}if("l"==r){for(s=0,o=t.source.length;s<o&&-1!=n.indexOf(t.source[s]);s++);return l.$factory(t.source.slice(s))}for(s=t.source.length-1;s>=0&&-1!=n.indexOf(t.source[s]);s--);return l.$factory(t.source.slice(0,s+1))}function s(t){return!e.isinstance(t,[l,o])}t.to_bytes=function(n){var r;if(e.isinstance(n,[l,o]))r=n.source;else{var i=t.$getattr(n,"tobytes",null);if(null===i)throw e.TypeError.$factory("object doesn't support the buffer protocol");r=t.$call(i)().source}return r};var o={__class__:e.type,__mro__:[e.object],$buffer_protocol:!0,$infos:{__module__:"builtins",__name__:"bytearray"},$is_class:!0};["__delitem__","clear","copy","count","index","pop","remove","reverse","sort"].forEach((function(t){var n;o[t]=(n=t,function(t){for(var r=[t.source],i=1,s=1,o=arguments.length;s<o;s++)r[i++]=arguments[s];return e.list[n].apply(null,r)})}));var a=t.make_iterator_class("bytearray_iterator");o.__iter__=function(t){return a.$factory(t.source)},o.__mro__=[e.object],o.__repr__=o.__str__=function(t){return"bytearray("+l.__repr__(t)+")"},o.__setitem__=function(n,r,i){if(e.isinstance(r,e.int)){if(!e.isinstance(i,e.int))throw e.TypeError.$factory("an integer is required");if(i>255)throw e.ValueError.$factory("byte must be in range(0, 256)");var s=r;if(r<0&&(s=n.source.length+s),!(s>=0&&s<n.source.length))throw e.IndexError.$factory("list index out of range");n.source[s]=i}else{if(!e.isinstance(r,e.slice))throw e.TypeError.$factory("list indices must be integer, not "+t.class_name(r));var o=r.start===e.None?0:r.start,a=r.stop===e.None?n.source.length:r.stop;o<0&&(o=n.source.length+o),a<0&&(a=n.source.length+a),n.source.splice(o,a-o);try{for(var l=e.list.$factory(i),c=l.length-1;c>=0;c--){if(!e.isinstance(l[c],e.int))throw e.TypeError.$factory("an integer is required");if(l[c]>255)throw ValueError.$factory("byte must be in range(0, 256)");n.source.splice(o,0,l[c])}}catch(t){throw e.TypeError.$factory("can only assign an iterable")}}},o.append=function(t,n){if(2!=arguments.length)throw e.TypeError.$factory("append takes exactly one argument ("+(arguments.length-1)+" given)");if(!e.isinstance(n,e.int))throw e.TypeError.$factory("an integer is required");if(n>255)throw ValueError.$factory("byte must be in range(0, 256)");t.source[t.source.length]=n},o.extend=function(t,n){if(n.__class__===o||n.__class__===l)return n.source.forEach((function(e){t.source.push(e)})),e.None;for(var r=e.iter(n);;)try{o.__add__(t,e.next(r))}catch(t){if(t===e.StopIteration)break;throw t}return e.None},o.insert=function(t,n,r){if(3!=arguments.length)throw e.TypeError.$factory("insert takes exactly 2 arguments ("+(arguments.length-1)+" given)");if(!e.isinstance(r,e.int))throw e.TypeError.$factory("an integer is required");if(r>255)throw ValueError.$factory("byte must be in range(0, 256)");e.list.insert(t.source,n,r)},o.$factory=function(){for(var t=[o],e=0,n=arguments.length;e<n;e++)t.push(arguments[e]);return o.__new__.apply(null,t)};var l={__class__:e.type,__mro__:[e.object],$buffer_protocol:!0,$infos:{__module__:"builtins",__name__:"bytes"},$is_class:!0,__add__:function(t,n){if(e.isinstance(n,l))return t.__class__.$factory(t.source.concat(n.source));if(e.isinstance(n,o))return t.__class__.$factory(l.__add__(t,l.$factory(n)));if(e.isinstance(n,e.memoryview))return t.__class__.$factory(l.__add__(t,e.memoryview.tobytes(n)));throw e.TypeError.$factory("can't concat bytes to "+e.str.$factory(n))},__contains__:function(t,e){if("number"==typeof e)return t.source.indexOf(e)>-1;if(t.source.length<e.source.length)return!1;for(var n=e.source.length,r=0;r<t.source.length-e.source.length+1;r++){for(var i=!0,s=0;s<n;s++)if(e.source[r+s]!=t.source[s]){i=!1;break}if(i)return!0}return!1}},c=t.make_iterator_class("bytes_iterator");function u(t,n,r){throw e.UnicodeEncodeError.$factory("'"+t+"' codec can't encode character "+e.hex(n)+" in position "+r)}function h(t){var e=t.toLowerCase();return"windows"==e.substr(0,7)&&(e="cp"+e.substr(7)),(e.startsWith("cp")||e.startsWith("iso"))&&(e=e.replace("-","")),e.replace(/-/g,"_")}l.__iter__=function(t){return c.$factory(t.source)},l.__eq__=function(e,n){return!s(n)&&t.$getattr(e.source,"__eq__")(n.source)},l.__ge__=function(t,n){return s(n)?e.NotImplemented:e.list.__ge__(t.source,n.source)},l.__getitem__=function(t,n){if(e.isinstance(n,e.int)){var r=n;if(n<0&&(r=t.source.length+r),r>=0&&r<t.source.length)return t.source[r];throw e.IndexError.$factory("index out of range")}if(e.isinstance(n,e.slice)){var i=e.slice.$conv_for_seq(n,t.source.length),s=i.start,o=i.stop,a=i.step,c=[],u=null;if(r=0,a>0){if((o=Math.min(o,t.source.length))<=s)return l.$factory([]);for(u=s;u<o;u+=a)c[r++]=t.source[u]}else{if(o>=s)return l.$factory([]);for(o=Math.max(0,o),u=s;u>=o;u+=a)c[r++]=t.source[u]}return l.$factory(c)}if(e.isinstance(n,e.bool))return t.source.__getitem__(e.int.$factory(n))},l.__gt__=function(t,n){return s(n)?e.NotImplemented:e.list.__gt__(t.source,n.source)},l.__hash__=function(e){if(void 0===e)return l.__hashvalue__||t.$py_next_hash--;for(var n=1,r=0,i=e.source.length;r<i;r++)n=101*n+e.source[r]&4294967295;return n},l.__init__=function(){return e.None},l.__le__=function(t,n){return s(n)?e.NotImplemented:e.list.__le__(t.source,n.source)},l.__len__=function(t){return t.source.length},l.__lt__=function(t,n){return s(n)?e.NotImplemented:e.list.__lt__(t.source,n.source)},l.__mod__=function(t,n){var r=p(t,"ascii","strict"),i=e.str.__mod__(r,n);return e.str.encode(i,"ascii")},l.__mul__=function(){for(var e=t.args("__mul__",2,{self:null,other:null},["self","other"],arguments,{},null,null),n=t.PyNumber_Index(e.other),r=[],i=e.self.source,s=i.length,o=0;o<n;o++)for(var a=0;a<s;a++)r.push(i[a]);var c=l.$factory();return c.source=r,c},l.__ne__=function(t,e){return!l.__eq__(t,e)},l.__new__=function(e,n,r,i){var s=t.args("__new__",4,{cls:null,source:null,encoding:null,errors:null},["cls","source","encoding","errors"],arguments,{source:[],encoding:"utf-8",errors:"strict"},null,null);return l.$new(s.cls,s.source,s.encoding,s.errors)},l.$new=function(n,r,i,s){var o={__class__:n},a=[],l=0;if(void 0===r);else if("number"==typeof r||e.isinstance(r,e.int))for(var c=r;c--;)a[l++]=0;else if("string"==typeof r||e.isinstance(r,e.str)){if(void 0===i)throw e.TypeError.$factory("string argument without an encoding");a=d(r,i||"utf-8",s||"strict")}else for(a=e.list.$factory(r),c=0;c<a.length;c++){try{var u=e.int.$factory(a[c])}catch(n){throw e.TypeError.$factory("'"+t.class_name(a[c])+"' object cannot be interpreted as an integer")}if(u<0||u>255)throw e.ValueError.$factory("bytes must be in range(0, 256)")}return o.source=a,o.encoding=i,o.errors=s,o},l.__repr__=l.__str__=function(t){for(var e="",n=0,r=t.source.length;n<r;n++){var i=t.source[n];if(10==i)e+="\\n";else if(i<32||i>=128){var s=i.toString(16);e+="\\x"+(s=(1==s.length?"0":"")+s)}else i=="\\".charCodeAt(0)?e+="\\\\":e+=String.fromCharCode(i)}return e.indexOf("'")>-1&&-1==e.indexOf('"')?'b"'+e+'"':"b'"+e.replace(new RegExp("'","g"),"\\'")+"'"},l.__reduce_ex__=function(t){return l.__repr__(t)},l.capitalize=function(t){var e=t.source,n=e.length,r=e.slice();r[0]>96&&r[0]<123&&(r[0]-=32);for(var i=1;i<n;++i)r[i]>64&&r[i]<91&&(r[i]+=32);return l.$factory(r)},l.center=function(){var e=t.args("center",3,{self:null,width:null,fillbyte:null},["self","width","fillbyte"],arguments,{fillbyte:l.$factory([32])},null,null),n=e.width-e.self.source.length;if(n<=0)return l.$factory(e.self.source);var r=l.ljust(e.self,e.self.source.length+Math.floor(n/2),e.fillbyte);return l.rjust(r,e.width,e.fillbyte)},l.count=function(){var n=t.args("count",4,{self:null,sub:null,start:null,end:null},["self","sub","start","end"],arguments,{start:0,end:-1},null,null),r=0,i=-1,s=0;if("number"==typeof n.sub){if(n.sub<0||n.sub>255)throw e.ValueError.$factory("byte must be in range(0, 256)");s=1}else{if(!n.sub.__class__)throw e.TypeError.$factory("first argument must be a bytes-like object, not '"+t.class_name(n.sub)+"'");if(!n.sub.__class__.$buffer_protocol)throw e.TypeError.$factory("first argument must be a bytes-like object, not '"+t.class_name(n.sub)+"'");s=n.sub.source.length}do{-1!=(i=l.find(n.self,n.sub,Math.max(i+s,n.start),n.end))&&r++}while(-1!=i);return r},l.decode=function(e,n,r){var i=t.args("decode",3,{self:null,encoding:null,errors:null},["self","encoding","errors"],arguments,{encoding:"utf-8",errors:"strict"},null,null);switch(i.errors){case"strict":case"ignore":case"replace":case"surrogateescape":case"surrogatepass":case"xmlcharrefreplace":case"backslashreplace":return p(i.self,i.encoding,i.errors)}},l.endswith=function(){var n=t.args("endswith",4,{self:null,suffix:null,start:null,end:null},["self","suffix","start","end"],arguments,{start:-1,end:-1},null,null);if(e.isinstance(n.suffix,l)){for(var r=-1==n.start?n.self.source.length-n.suffix.source.length:Math.min(n.self.source.length-n.suffix.source.length,n.start),i=-1==n.end?-1==n.start?n.self.source.length:r+n.suffix.source.length:Math.min(n.self.source.length-1,n.end),s=!0,o=n.suffix.source.length-1,a=n.suffix.source.length;o>=0&&s;--o)s=n.self.source[i-a+o]==n.suffix.source[o];return s}if(e.isinstance(n.suffix,e.tuple)){for(o=0;o<n.suffix.length;++o){if(!e.isinstance(n.suffix[o],l))throw e.TypeError.$factory("endswith first arg must be bytes or a tuple of bytes, not "+t.class_name(n.suffix));if(l.endswith(n.self,n.suffix[o],n.start,n.end))return!0}return!1}throw e.TypeError.$factory("endswith first arg must be bytes or a tuple of bytes, not "+t.class_name(n.suffix))},l.expandtabs=function(){var n=t.args("expandtabs",2,{self:null,tabsize:null},["self","tabsize"],arguments,{tabsize:8},null,null),r=[];for(let t=0;t<n.tabsize;++t)r.push(32);var i=n.self.source.slice();for(let t=0;t<i.length;++t)9===i[t]&&i.splice.apply(i,[t,1].concat(r));return e.bytes.$factory(i)},l.find=function(n,r){if(2!=arguments.length)var i=t.args("find",4,{self:null,sub:null,start:null,end:null},["self","sub","start","end"],arguments,{start:0,end:-1},null,null),s=(r=i.sub,i.start),o=i.end;else s=0,o=-1;if("number"==typeof r){if(r<0||r>255)throw e.ValueError.$factory("byte must be in range(0, 256)");return n.source.slice(0,-1==o?void 0:o).indexOf(r,s)}if(!r.__class__)throw e.TypeError.$factory("first argument must be a bytes-like object, not '"+t.class_name(r)+"'");if(!r.__class__.$buffer_protocol)throw e.TypeError.$factory("first argument must be a bytes-like object, not '"+t.class_name(r)+"'");o=-1==o?n.source.length:Math.min(n.source.length,o);for(var a=r.source.length,l=s;l<=o-a;l++){for(var c=n.source.slice(l,l+a),u=!0,h=0;h<a;h++)if(c[h]!=r.source[h]){u=!1;break}if(u)return l}return-1},l.fromhex=function(){for(var n=t.args("fromhex",2,{cls:null,string:null},["cls","string"],arguments,{},null,null),r=n.string.replace(/\s/g,""),i=[],s=0;s<r.length;s+=2){if(s+2>r.length)throw e.ValueError.$factory("non-hexadecimal number found in fromhex() arg");i.push(e.int.$factory(r.substr(s,2),16))}return n.cls.$factory(i)},l.hex=function(){for(var e=t.args("hex",1,{self:null},["self"],arguments,{},null,null).self,n="",r=0,i=e.source.length;r<i;r++){var s=e.source[r].toString(16);s.length<2&&(s="0"+s),n+=s}return n},l.index=function(){var n=t.args("rfind",4,{self:null,sub:null,start:null,end:null},["self","sub","start","end"],arguments,{start:0,end:-1},null,null),r=l.find(n.self,n.sub,n.start,n.end);if(-1==r)throw e.ValueError.$factory("subsection not found");return r},l.isalnum=function(t){for(var e=t.source,n=e.length,r=n>0,i=0;i<n&&r;++i)r=e[i]>96&&e[i]<123||e[i]>64&&e[i]<91||e[i]>47&&e[i]<58;return r},l.isalpha=function(t){for(var e=t.source,n=e.length,r=n>0,i=0;i<n&&r;++i)r=e[i]>96&&e[i]<123||e[i]>64&&e[i]<91;return r},l.isdigit=function(t){var e=t.source,n=e.length,r=n>0;for(let t=0;t<n&&r;++t)r=e[t]>47&&e[t]<58;return r},l.islower=function(t){var e=t.source,n=e.length,r=!1;for(let t=0;t<n;++t)if(r=r||e[t]>96&&e[t]<123,e[t]>64&&e[t]<91)return!1;return r},l.isspace=function(t){var e=t.source,n=e.length;for(let t=0;t<n;++t)switch(e[t]){case 9:case 10:case 11:case 12:case 13:case 32:break;default:return!1}return!0},l.isupper=function(t){var e=t.source,n=e.length,r=!1;for(let t=0;t<n;++t)if(r=r||e[t]>64&&e[t]<91,e[t]>96&&e[t]<123)return!1;return r},l.istitle=function(t){for(var e=t.source,n=e.length,r=!1,i=!1,s=!1,o=!1,a=0;a<n;++a){if(o=e[a]>96&&e[a]<123,s=e[a]>64&&e[a]<91,(r=o||s)&&i&&s||!i&&o)return!1;i=r}return!0},l.join=function(){for(var n=t.args("join",2,{self:null,iterable:null},["self","iterable"],arguments,{}),r=n.self,i=n.iterable,s=t.$getattr(e.iter(i),"__next__"),o=r.__class__.$factory(),a=!0;;)try{var c=s();a?a=!1:o=l.__add__(o,r),o=l.__add__(o,c)}catch(t){if(e.isinstance(t,e.StopIteration))break;throw t}return o},l.lower=function(t){for(var e,n=[],r=0,i=0,s=t.source.length;i<s;i++)t.source[i]&&(n[r++]=(e=t.source[i])>=65&&e<=90?e+32:e);return l.$factory(n)},l.ljust=function(){var n=t.args("ljust",3,{self:null,width:null,fillbyte:null},["self","width","fillbyte"],arguments,{fillbyte:l.$factory([32])},null,null);if(!n.fillbyte.__class__)throw e.TypeError.$factory("argument 2 must be a byte string of length 1, not '"+t.class_name(n.fillbyte)+"'");if(!n.fillbyte.__class__.$buffer_protocol)throw e.TypeError.$factory("argument 2 must be a byte string of length 1, not '"+t.class_name(n.fillbyte)+"'");for(var r=[],i=n.width-n.self.source.length,s=0;s<i;++s)r.push(n.fillbyte.source[0]);return l.$factory(n.self.source.concat(r))},l.lstrip=function(t,e){return i(t,e,"l")},l.maketrans=function(e,n){for(var r=[],i=(n=t.to_bytes(n),0);i<256;i++)r[i]=i;i=0;for(var s=e.source.length;i<s;i++)r[e.source[i]]=n[i];return l.$factory(r)},l.partition=function(){var n=t.args("partition",2,{self:null,sep:null},["self","sep"],arguments,{},null,null);if(!n.sep.__class__)throw e.TypeError.$factory("a bytes-like object is required, not '"+t.class_name(n.sep)+"'");if(!n.sep.__class__.$buffer_protocol)throw e.TypeError.$factory("a bytes-like object is required, not '"+t.class_name(n.sep)+"'");var r=n.sep.source.length,i=n.self.source,s=l.find(n.self,n.sep);return e.tuple.$factory([l.$factory(i.slice(0,s)),l.$factory(i.slice(s,s+r)),l.$factory(i.slice(s+r))])},l.removeprefix=function(){var n=t.args("removeprefix",2,{self:null,prefix:null},["self","prefix"],arguments,{},null,null);if(!e.isinstance(n.prefix,[l,o]))throw e.ValueError.$factory(`prefix should be bytes, not '${t.class_name(n.prefix)}'`);return l.startswith(n.self,n.prefix)?l.__getitem__(n.self,e.slice.$factory(n.prefix.source.length,e.None)):l.__getitem__(n.self,e.slice.$factory(0,e.None))},l.removesuffix=function(){var n=t.args("removesuffix",2,{self:null,prefix:null},["self","suffix"],arguments,{},null,null);if(!e.isinstance(n.suffix,[l,o]))throw e.ValueError.$factory(`suffix should be bytes, not '${t.class_name(n.suffix)}'`);return l.endswith(n.self,n.suffix)?l.__getitem__(n.self,e.slice.$factory(0,n.suffix.source.length+1)):l.__getitem__(n.self,e.slice.$factory(0,e.None))},l.replace=function(){var n=t.args("replace",4,{self:null,old:null,new:null,count:null},["self","old","new","count"],arguments,{count:-1},null,null),r=[],i=n.self,s=i.source,o=s.length,a=n.old,c=n.new,u=n.count>=0?n.count:s.length;if(!n.old.__class__)throw e.TypeError.$factory("first argument must be a bytes-like object, not '"+t.class_name(n.old)+"'");if(!n.old.__class__.$buffer_protocol)throw e.TypeError.$factory("first argument must be a bytes-like object, not '"+t.class_name(n.sep)+"'");if(!n.new.__class__)throw e.TypeError.$factory("second argument must be a bytes-like object, not '"+t.class_name(n.old)+"'");if(!n.new.__class__.$buffer_protocol)throw e.TypeError.$factory("second argument must be a bytes-like object, not '"+t.class_name(n.sep)+"'");for(var h=0;h<o;h++)if(l.startswith(i,a,h)&&u){for(var p=0;p<c.source.length;p++)r.push(c.source[p]);h+=a.source.length-1,u--}else r.push(s[h]);return l.$factory(r)},l.rfind=function(n,r){if(2==arguments.length&&r.__class__===l)var i=r,s=0,o=-1;else{var a=t.args("rfind",4,{self:null,sub:null,start:null,end:null},["self","sub","start","end"],arguments,{start:0,end:-1},null,null);n=a.self,i=a.sub,s=a.start,o=a.end}if("number"==typeof i){if(i<0||i>255)throw e.ValueError.$factory("byte must be in range(0, 256)");return a.self.source.slice(s,-1==a.end?void 0:a.end).lastIndexOf(i)+s}if(!i.__class__)throw e.TypeError.$factory("first argument must be a bytes-like object, not '"+t.class_name(a.sub)+"'");if(!i.__class__.$buffer_protocol)throw e.TypeError.$factory("first argument must be a bytes-like object, not '"+t.class_name(i)+"'");o=-1==o?n.source.length:Math.min(n.source.length,o);for(var c=i.source.length,u=o-c;u>=s;--u){for(var h=n.source.slice(u,u+c),p=!0,d=0;d<c;d++)if(h[d]!=i.source[d]){p=!1;break}if(p)return u}return-1},l.rindex=function(){var n=t.args("rfind",4,{self:null,sub:null,start:null,end:null},["self","sub","start","end"],arguments,{start:0,end:-1},null,null),r=l.rfind(n.self,n.sub,n.start,n.end);if(-1==r)throw e.ValueError.$factory("subsection not found");return r},l.rjust=function(){var n=t.args("rjust",3,{self:null,width:null,fillbyte:null},["self","width","fillbyte"],arguments,{fillbyte:l.$factory([32])},null,null);if(!n.fillbyte.__class__)throw e.TypeError.$factory("argument 2 must be a byte string of length 1, not '"+t.class_name(n.fillbyte)+"'");if(!n.fillbyte.__class__.$buffer_protocol)throw e.TypeError.$factory("argument 2 must be a byte string of length 1, not '"+t.class_name(n.fillbyte)+"'");for(var r=[],i=n.width-n.self.source.length,s=0;s<i;++s)r.push(n.fillbyte.source[0]);return l.$factory(r.concat(n.self.source))},l.rpartition=function(){var n=t.args("rpartition",2,{self:null,sep:null},["self","sep"],arguments,{},null,null);if(!n.sep.__class__)throw e.TypeError.$factory("a bytes-like object is required, not '"+t.class_name(n.sep)+"'");if(!n.sep.__class__.$buffer_protocol)throw e.TypeError.$factory("a bytes-like object is required, not '"+t.class_name(n.sep)+"'");var r=n.sep.source.length,i=n.self.source,s=l.rfind(n.self,n.sep);return e.tuple.$factory([l.$factory(i.slice(0,s)),l.$factory(i.slice(s,s+r)),l.$factory(i.slice(s+r))])},l.rstrip=function(t,e){return i(t,e,"r")},l.split=function(){var n=t.args("split",2,{self:null,sep:null},["self","sep"],arguments,{},null,null),r=[],i=0,s=0;if(!n.sep.__class__)throw e.TypeError.$factory("a bytes-like object is required, not '"+t.class_name(n.sep)+"'");if(!n.sep.__class__.$buffer_protocol)throw e.TypeError.$factory("a bytes-like object is required, not '"+t.class_name(n.sep)+"'");for(var o=n.sep.source,a=o.length,c=n.self.source,u=c.length;s<u;){for(var h=!0,p=0;p<a&&h;p++)c[s+p]!=o[p]&&(h=!1);h?(r.push(l.$factory(c.slice(i,s))),s=i=s+a):s++}return(h||s>i)&&r.push(l.$factory(c.slice(i,s))),r},l.splitlines=function(n){var r=t.args("splitlines",2,{self:null,keepends:null},["self","keepends"],arguments,{keepends:!1},null,null);if(!e.isinstance(r.keepends,[e.bool,e.int]))throw e.TypeError("integer argument expected, got "+t.get_class(r.keepends).__name);var i=e.int.$factory(r.keepends),s=[],o=r.self.source,a=0,c=0;if(!o.length)return s;for(;c<o.length;)c<o.length-1&&13==o[c]&&10==o[c+1]?(s.push(l.$factory(o.slice(a,i?c+2:c))),a=c+=2):13==o[c]||10==o[c]?(s.push(l.$factory(o.slice(a,i?c+1:c))),a=c+=1):c++;return a<o.length&&s.push(l.$factory(o.slice(a))),s},l.startswith=function(){var n=t.args("startswith",3,{self:null,prefix:null,start:null},["self","prefix","start"],arguments,{start:0},null,null),r=n.start;if(e.isinstance(n.prefix,l)){for(var i=!0,s=0;s<n.prefix.source.length&&i;s++)i=n.self.source[r+s]==n.prefix.source[s];return i}if(e.isinstance(n.prefix,e.tuple)){var o=[];for(s=0;s<n.prefix.length;s++){if(!e.isinstance(n.prefix[s],l))throw e.TypeError.$factory("startswith first arg must be bytes or a tuple of bytes, not "+t.class_name(n.prefix));o=o.concat(n.prefix[s].source)}var a=l.$factory(o);return l.startswith(n.self,a,r)}throw e.TypeError.$factory("startswith first arg must be bytes or a tuple of bytes, not "+t.class_name(n.prefix))},l.strip=function(t,e){var n=l.lstrip(t,e);return l.rstrip(n,e)},l.swapcase=function(t){for(var e=t.source,n=e.length,r=e.slice(),i=0;i<n;++i)r[i]>96&&r[i]<123?r[i]-=32:r[i]>64&&r[i]<91&&(r[i]+=32);return l.$factory(r)},l.title=function(t){var e=t.source,n=e.length;buffer=e.slice(),current_char_is_letter=!1,prev_char_was_letter=!1,is_uppercase=!1,is_lowercase=!1;for(var r=0;r<n;++r)is_lowercase=buffer[r]>96&&buffer[r]<123,is_uppercase=buffer[r]>64&&buffer[r]<91,current_char_is_letter=is_lowercase||is_uppercase,current_char_is_letter&&(prev_char_was_letter&&is_uppercase?buffer[r]+=32:!prev_char_was_letter&&is_lowercase&&(buffer[r]-=32)),prev_char_was_letter=current_char_is_letter;return l.$factory(buffer)},l.translate=function(n,r,i){if(void 0===i)i=[];else{if(!e.isinstance(i,l))throw e.TypeError.$factory("Type "+t.get_class(i).__name+" doesn't support the buffer API");i=i.source}var s=[],o=0;if(e.isinstance(r,l)&&256==r.source.length)for(var a=0,c=n.source.length;a<c;a++)i.indexOf(n.source[a])>-1||(s[o++]=r.source[n.source[a]]);return l.$factory(s)},l.upper=function(t){for(var e,n=[],r=0,i=0,s=t.source.length;i<s;i++)t.source[i]&&(n[r++]=(e=t.source[i])>=97&&e<=122?e-32:e);return l.$factory(n)},l.zfill=function(t,e){for(var n=t.source.slice(),r=43==n[0]||45==n[0]?1:0,i=e-t.source.length,s=[],o=0;o<i;++o)s.push(48);return n.splice.apply(n,[r,0].concat(s)),l.$factory(n)};var p=t.decode=function(n,i,s){var a="",c=n.source,u=h(i),d=!1;switch(u){case"utf_8":case"utf-8":case"utf8":case"U8":case"UTF":var f,m=0;for(a="";m<c.length;){var _=c[m];if(f=null,128&_)if(_>>5==6)if(void 0===c[m+1]?f=[_,m,"end"]:128!=(192&c[m+1])&&(f=[_,m,"continuation"]),null!==f){if("ignore"!=s)throw e.UnicodeDecodeError.$factory("'utf-8' codec can't decode byte 0x"+f[0].toString(16)+"  in position "+f[1]+("end"==f[2]?": unexpected end of data":": invalid continuation byte"));m++}else{var g=31&_;g<<=6,g+=63&c[m+1],a+=String.fromCodePoint(g),m+=2}else if(_>>4==14)if(void 0===c[m+1]?f=[_,m,"end",m+1]:128!=(192&c[m+1])?f=[_,m,"continuation",m+2]:void 0===c[m+2]?f=[_,m+"-"+(m+1),"end",m+2]:128!=(192&c[m+2])&&(f=[_,m,"continuation",m+3]),null!==f)if("ignore"==s)m=f[3];else{if("surrogateescape"!=s)throw e.UnicodeDecodeError.$factory("'utf-8' codec can't decode byte 0x"+f[0].toString(16)+"  in position "+f[1]+("end"==f[2]?": unexpected end of data":": invalid continuation byte"));for(var y=m;y<f[3];y++)a+=String.fromCodePoint(56448+c[y]-128);m=f[3]}else g=15&_,g<<=12,g+=(63&c[m+1])<<6,g+=63&c[m+2],a+=String.fromCodePoint(g),m+=3;else if(_>>3==30)if(d=!0,void 0===c[m+1]?f=[_,m,"end",m+1]:128!=(192&c[m+1])?f=[_,m,"continuation",m+2]:void 0===c[m+2]?f=[_,m+"-"+(m+1),"end",m+2]:128!=(192&c[m+2])?f=[_,m,"continuation",m+3]:void 0===c[m+3]?f=[_,m+"-"+(m+1)+"-"+(m+2),"end",m+3]:128!=(192&c[m+2])&&(f=[_,m,"continuation",m+3]),null!==f)if("ignore"==s)m=f[3];else{if("surrogateescape"!=s)throw e.UnicodeDecodeError.$factory("'utf-8' codec can't decode byte 0x"+f[0].toString(16)+"  in position "+f[1]+("end"==f[2]?": unexpected end of data":": invalid continuation byte"));for(y=m;y<f[3];y++)a+=String.fromCodePoint(56448+c[y]-128);m=f[3]}else g=15&_,g<<=18,g+=(63&c[m+1])<<12,g+=(63&c[m+2])<<6,g+=63&c[m+3],a+=String.fromCodePoint(g),m+=4;else if("ignore"==s)m++;else{if("surrogateescape"!=s)throw e.UnicodeDecodeError.$factory("'utf-8' codec can't decode byte 0x"+_.toString(16)+" in position "+m+": invalid start byte");a+=String.fromCodePoint(56448+c[m]-128),m++}else a+=String.fromCodePoint(_),m++}return d?e.str.$surrogate.$factory(a):a;case"latin_1":case"windows1252":case"iso-8859-1":case"iso8859-1":case"8859":case"cp819":case"latin":case"latin1":case"L1":c.forEach((function(t){a+=String.fromCharCode(t)}));break;case"unicode_escape":return n.__class__!==l&&n.__class__!==o||(n=p(n,"latin-1","strict")),n.replace(/\\n/g,"\n").replace(/\\a/g,"").replace(/\\b/g,"\b").replace(/\\f/g,"\f").replace(/\\t/g,"\t").replace(/\\'/g,"'").replace(/\\"/g,'"');case"raw_unicode_escape":return n.__class__!==l&&n.__class__!==o||(n=p(n,"latin-1","strict")),n.replace(/\\u([a-fA-F0-9]{4})/g,(function(t){var e=parseInt(t.substr(2),16);return String.fromCharCode(e)}));case"ascii":y=0;for(var v=c.length;y<v;y++)if((g=c[y])<=127)a+=String.fromCharCode(g);else if("ignore"!=s){var b="'ascii' codec can't decode byte 0x"+g.toString(16)+" in position "+y+": ordinal not in range(128)";throw e.UnicodeDecodeError.$factory(b)}break;default:try{!function(n){if(void 0===r[n]){var i=e.__import__("encodings."+n);i[n].getregentry&&(r[n]=t.$getattr(i[n].getregentry(),"decode"))}}(u)}catch(t){throw console.log(c,i,"error load_decoder",t),e.LookupError.$factory("unknown encoding: "+u)}return r[u](n)[0]}return a},d=t.encode=function(){var r=t.args("encode",3,{s:null,encoding:null,errors:null},["s","encoding","errors"],arguments,{encoding:"utf-8",errors:"strict"},null,null),i=r.s,s=r.encoding,o=r.errors,a=[],l=0,c=h(s);switch(c){case"utf-8":case"utf_8":case"utf8":for(var p=[],d=0,f=i.length;d<f;d++)(m=i.charCodeAt(d))<127?p.push(m):m<2047?p.push(192+(m>>6),128+(63&m)):m<65535?p.push(224+(m>>12),128+((4095&m)>>6),128+(63&m)):console.log("4 bytes");return p;case"latin":case"latin1":case"latin-1":case"latin_1":case"L1":case"iso8859_1":case"iso_8859_1":case"8859":case"cp819":case"windows1252":for(d=0,f=i.length;d<f;d++)(m=i.charCodeAt(d))<=255?a[l++]=m:"ignore"!=o&&u(s,d);break;case"ascii":for(d=0,f=i.length;d<f;d++)(m=i.charCodeAt(d))<=127?a[l++]=m:"ignore"!=o&&u(s,d);break;case"raw_unicode_escape":for(d=0,f=i.length;d<f;d++){var m;if((m=i.charCodeAt(d))<256)a[l++]=m;else{var _=m.toString(16);_.length%2&&(_="0"+_),_="\\u"+_;for(var g=0;g<_.length;g++)a[l++]=_.charCodeAt(g)}}break;default:try{!function(r){if(void 0===n[r]){var i=e.__import__("encodings."+r);i[r].getregentry&&(n[r]=t.$getattr(i[r].getregentry(),"encode"))}}(c)}catch(t){throw e.LookupError.$factory("unknown encoding: "+s)}a=n[c](i)[0].source}return a};for(var f in l.$factory=function(e,n,r){var i=t.args("bytes",3,{source:null,encoding:null,errors:null},["source","encoding","errors"],arguments,{source:[],encoding:"utf-8",errors:"strict"},null,null);return l.$new(l,i.source,i.encoding,i.errors)},l.__class__=e.type,l.$is_class=!0,l)void 0===o[f]&&"function"==typeof l[f]&&(o[f]=function(t){return function(){return l[t].apply(null,arguments)}}(f));t.set_func_names(l,"builtins"),l.fromhex=e.classmethod.$factory(l.fromhex),t.set_func_names(o,"builtins"),o.fromhex=e.classmethod.$factory(o.fromhex),e.bytes=l,e.bytearray=o}(__BRYTHON__),function($B){var _b_=$B.builtins,object=_b_.object,$N=_b_.None;function create_type(t){return $B.get_class(t).$factory()}function clone(t){var e=create_type(t);for(key in e.$items=t.$items.slice(),t.$hashes)e.$hashes[key]=t.$hashes[key];return e}var set={__class__:_b_.type,$infos:{__module__:"builtins",__name__:"set"},$is_class:!0,$native:!0,__add__:function(t,e){throw _b_.TypeError.$factory("unsupported operand type(s) for +: 'set' and "+typeof e)},__and__:function(t,e,n){try{$test(n,e)}catch(t){return _b_.NotImplemented}for(var r=create_type(t),i=0,s=t.$items.length;i<s;i++)_b_.getattr(e,"__contains__")(t.$items[i])&&set.add(r,t.$items[i]);return r},__class_getitem__:function(t,e){return Array.isArray(e)||(e=[e]),$B.GenericAlias.$factory(t,e)},__contains__:function(t,e){if(t.$simple){if("number"==typeof e||e instanceof Number){if(isNaN(e)){for(var n=t.$items.length-1;n>=0;n--)if(isNaN(t.$items[n]))return!0;return!1}return e instanceof Number?t.$numbers.indexOf(e.valueOf())>-1:t.$items.indexOf(e)>-1}if("string"==typeof e)return t.$items.indexOf(e)>-1}_b_.isinstance(e,set)||$B.$getattr(e,"__hash__");var r=_b_.hash(e);if(t.$hashes[r]){n=0;for(var i=t.$hashes[r].length;n<i;n++)if($B.rich_comp("__eq__",t.$hashes[r][n],e))return!0}return!1},__eq__:function(t,e){if(void 0===e)return t===set;if(_b_.isinstance(e,[_b_.set,_b_.frozenset])){if(e.$items.length==t.$items.length){for(var n=0,r=t.$items.length;n<r;n++)if(!1===set.__contains__(t,e.$items[n]))return!1;return!0}return!1}return _b_.NotImplemented},__format__:function(t,e){return set.__str__(t)},__ge__:function(t,e){return _b_.isinstance(e,[set,frozenset])?set.__le__(e,t):_b_.NotImplemented},__gt__:function(t,e){return _b_.isinstance(e,[set,frozenset])?set.__lt__(e,t):_b_.NotImplemented}};set.__hash__=_b_.None,set.__init__=function(t,e,n){if(void 0===n&&Array.isArray(e)){for(var r=0,i=e.length;r<i;r++)$add(t,e[r]);return $N}var s=$B.args("__init__",2,{self:null,iterable:null},["self","iterable"],arguments,{iterable:[]},null,null);if(t=s.self,e=s.iterable,_b_.isinstance(e,[set,frozenset])){for(var o in t.$items=e.$items.slice(),t.$hashes={},e.$hashes)t.$hashes[o]=e.$hashes[o];return $N}for(var a=$B.$iter(e);;)try{$add(t,_b_.next(a))}catch(t){if(_b_.isinstance(t,_b_.StopIteration))break;throw t}return $N};var set_iterator=$B.make_iterator_class("set iterator");function $test(t,e,n){if(void 0===t&&!_b_.isinstance(e,[set,frozenset]))throw _b_.TypeError.$factory("unsupported operand type(s) for "+n+": 'set' and '"+$B.class_name(e)+"'")}function $add(t,e){var n,r=!1;if(("string"==typeof e||"number"==typeof e||e instanceof Number)&&(r=!0),r){var i=t.$items.indexOf(e);if(-1==i)if(e instanceof Number&&t.$numbers.indexOf(e.valueOf())>-1);else if("number"==typeof e&&t.$numbers.indexOf(e)>-1);else{t.$items.push(e);var s=e.valueOf();"number"==typeof s&&t.$numbers.push(s)}else e!==t.$items[i]&&t.$items.push(e)}else{var o=_b_.hash(e);if(void 0===(a=t.$hashes[o]))t.$hashes[o]=[e],t.$items.push(e);else{for(var a,l=0,c=(a=t.$hashes[o]).length;l<c;l++)if(n=a[l],$B.rich_comp("__eq__",e,n))return $N;t.$hashes[o].push(e),t.$items.push(e)}}return $N}set.__iter__=function(t){return t.$items.sort(),set_iterator.$factory(t.$items)},set.__le__=function(t,e){if(_b_.isinstance(e,[set,frozenset])){for(var n=_b_.getattr(e,"__contains__"),r=0,i=t.$items.length;r<i;r++)if(!n(t.$items[r]))return!1;return!0}return _b_.NotImplemented},set.__len__=function(t){return t.$items.length},set.__lt__=function(t,e){return _b_.isinstance(e,[set,frozenset])?set.__le__(t,e)&&set.__len__(t)<_b_.getattr(e,"__len__")():_b_.NotImplemented},set.__mro__=[_b_.object],set.__new__=function(t){if(void 0===t)throw _b_.TypeError.$factory("set.__new__(): not enough arguments");return{__class__:t,$simple:!0,$items:[],$numbers:[],$hashes:{}}},set.__or__=function(t,e,n){for(var r=clone(t),i=_b_.getattr($B.$iter(e),"__next__");;)try{set.add(r,i())}catch(t){if(_b_.isinstance(t,_b_.StopIteration))break;throw t}return r.__class__=t.__class__,r},set.__rand__=function(t,e){return set.__and__(t,e)},set.__reduce__=function(t){return _b_.tuple.$factory([t.__class__,_b_.tuple.$factory([t.$items]),$N])},set.__reduce_ex__=function(t,e){return set.__reduce__(t)},set.__rsub__=function(t,e){return set.__sub__(t,e)},set.__rxor__=function(t,e){return set.__xor__(t,e)},set.__str__=set.__repr__=function(t){var e=$B.class_name(t);if(0===t.$items.length)return e+"()";var n=e+"({",r="})";"set({"==n&&(n="{",r="}");var i=[];if($B.repr.enter(t))return e+"(...)";t.$items.sort();for(var s=0,o=t.$items.length;s<o;s++){var a=_b_.repr(t.$items[s]);a===t||a===t.$items[s]?i.push("{...}"):i.push(a)}return i=i.join(", "),$B.repr.leave(t),n+i+r},set.__sub__=function(t,e,n){try{$test(n,e,"-")}catch(t){return _b_.NotImplemented}for(var r=create_type(t),i=_b_.getattr(e,"__contains__"),s=[],o=0,a=t.$items.length;o<a;o++)i(t.$items[o])||s.push(t.$items[o]);return set.__init__.call(null,r,s),r},set.__xor__=function(t,e,n){try{$test(n,e,"^")}catch(t){return _b_.NotImplemented}for(var r=create_type(t),i=_b_.getattr(e,"__contains__"),s=0,o=t.$items.length;s<o;s++)i(t.$items[s])||set.add(r,t.$items[s]);for(s=0,o=e.$items.length;s<o;s++)set.__contains__(t,e.$items[s])||set.add(r,e.$items[s]);return r},$B.make_rmethods(set),set.add=function(){var t=$B.args("add",2,{self:null,item:null},["self","item"],arguments,{},null,null);return $add(t.self,t.item)},set.clear=function(){var t=$B.args("clear",1,{self:null},["self"],arguments,{},null,null);return t.self.$items=[],t.self.$hashes={},$N},set.copy=function(){var t=$B.args("copy",1,{self:null},["self"],arguments,{},null,null);if(_b_.isinstance(t.self,frozenset))return t.self;var e=set.$factory();for(key in t.self.$items.forEach((function(t){e.$items.push(t)})),t.self.$numbers.forEach((function(t){e.$numbers.push(t)})),self.$hashes)e.$hashes[key]=self.$hashes[key];return e},set.difference_update=function(t){for(var e=$B.args("difference_update",1,{self:null},["self"],arguments,{},"args",null),n=0;n<e.args.length;n++)for(var r,i=set.$factory(e.args[n]),s=_b_.getattr($B.$iter(i),"__next__");;)try{var o=typeof(r=s());if("string"==o||"number"==o){var a=t.$items.indexOf(r);a>-1&&t.$items.splice(a,1)}else for(var l=0;l<t.$items.length;l++)if($B.rich_comp("__eq__",t.$items[l],r)){t.$items.splice(l,1);var c=_b_.hash(r);if(t.$hashes[c])for(var u=0;u<t.$hashes[c].length;u++)if($B.rich_comp("__eq__",t.$hashes[c][u],r)){t.$hashes[c].splice(u,1);break}}}catch(t){if(_b_.isinstance(t,_b_.StopIteration))break;throw t}return $N},set.discard=function(){var t=$B.args("discard",2,{self:null,item:null},["self","item"],arguments,{},null,null);try{set.remove(t.self,t.item)}catch(t){if(!_b_.isinstance(t,[_b_.KeyError,_b_.LookupError]))throw t}return $N},set.intersection_update=function(){for(var t=$B.args("intersection_update",1,{self:null},["self"],arguments,{},"args",null),e=t.self,n=0;n<t.args.length;n++){for(var r=[],i=set.$factory(t.args[n]),s=0;s<e.$items.length;s++){var o=e.$items[s],a=typeof o;if("string"==a||"number"==a)-1==i.$items.indexOf(o)&&r.push(s);else{var l=!1,c=_b_.hash(o);if(i.$hashes[c]){for(var u=i.$hashes[c],h=0;!l&&h<u.length;h++)$B.rich_comp("__eq__",u[h],o)&&(l=!0);if(!l)for(r.push(s),u=e.$hashes[c],h=0;!l&&h<u.length;h++)$B.rich_comp("__eq__",u[h],o)&&e.$hashes.splice(h,1)}}}for(r.sort((function(t,e){return t-e})).reverse(),s=0;s<r.length;s++)e.$items.splice(r[s],1)}return $N},set.isdisjoint=function(){for(var t=$B.args("is_disjoint",2,{self:null,other:null},["self","other"],arguments,{},null,null),e=0,n=t.self.$items.length;e<n;e++)if(_b_.getattr(t.other,"__contains__")(t.self.$items[e]))return!1;return!0},set.pop=function(t){if(0===t.$items.length)throw _b_.KeyError.$factory("pop from an empty set");var e=t.$items.pop();if("string"!=typeof e&&"number"!=typeof e)for(var n=_b_.hash(e),r=t.$hashes[n],i=0;i<r.length;i++)if($B.rich_comp("__eq__",r[i],e)){t.$hashes[n].splice(i,1);break}return e},set.remove=function(t,e){var n=$B.args("remove",2,{self:null,item:null},["self","item"],arguments,{},null,null);if(t=n.self,e=n.item,_b_.isinstance(e,set)||_b_.hash(e),"string"==typeof e||"number"==typeof e){var r=t.$items.indexOf(e);if(-1==r)throw _b_.KeyError.$factory(e);return t.$items.splice(r,1),"number"==typeof e&&t.$numbers.splice(t.$numbers.indexOf(e),1),$N}var i=_b_.hash(e);if(t.$hashes[i]){for(var s=0,o=t.$items.length;s<o;s++)if($B.rich_comp("__eq__",t.$items[s],e)){t.$items.splice(s,1),e instanceof Number&&t.$numbers.splice(t.$numbers.indexOf(e.valueOf()),1);break}for(s=0,o=t.$hashes[i].length;s<o;s++)if($B.rich_comp("__eq__",t.$hashes[i][s],e)){t.$hashes[i].splice(s,1);break}return $N}throw _b_.KeyError.$factory(e)},set.symmetric_difference_update=function(t,e){for(var n,r=$B.args("symmetric_difference_update",2,{self:null,s:null},["self","s"],arguments,{},null,null),i=(t=r.self,e=r.s,_b_.getattr($B.$iter(e),"__next__")),s=[],o=[];;)try{var a=typeof(n=i());if("string"==a||"number"==a){var l=t.$items.indexOf(n);l>-1?s.push(l):o.push(n)}else{for(var c=!1,u=0;!c&&u<t.$items.length;u++)$B.rich_comp("__eq__",t.$items[u],n)&&(s.push(u),c=!0);c||o.push(n)}}catch(t){if(_b_.isinstance(t,_b_.StopIteration))break;throw t}s.sort((function(t,e){return t-e})).reverse();for(var h=0;h<s.length;h++)s[h]!=s[h-1]&&t.$items.splice(s[h],1);for(h=0;h<o.length;h++)set.add(t,o[h]);return $N},set.update=function(t){for(var e=$B.args("update",1,{self:null},["self"],arguments,{},"args",null),n=0;n<e.args.length;n++)for(var r=set.$factory(e.args[n]),i=0,s=r.$items.length;i<s;i++)$add(t,r.$items[i]);return $N},set.difference=function(){var t=$B.args("difference",1,{self:null},["self"],arguments,{},"args",null);if(0==t.args.length)return set.copy(t.self);for(var e=clone(t.self),n=0;n<t.args.length;n++)e=set.__sub__(e,set.$factory(t.args[n]),!0);return e};var fc=set.difference+"";function $accept_only_set(t,e){return function(n,r,i){return $test(i,r,e),t(n,r),n}}eval("set.intersection = "+fc.replace(/difference/g,"intersection").replace("__sub__","__and__")),eval("set.symmetric_difference = "+fc.replace(/difference/g,"symmetric_difference").replace("__sub__","__xor__")),eval("set.union = "+fc.replace(/difference/g,"union").replace("__sub__","__or__")),set.issubset=function(){for(var t=$B.args("issubset",2,{self:null,other:null},["self","other"],arguments,{},"args",null),e=_b_.getattr(t.other,"__contains__"),n=0,r=t.self.$items.length;n<r;n++)if(!e(t.self.$items[n]))return!1;return!0},set.issuperset=function(){for(var t=$B.args("issuperset",2,{self:null,other:null},["self","other"],arguments,{},"args",null),e=_b_.getattr(t.self,"__contains__"),n=$B.$iter(t.other);;)try{if(!e(_b_.next(n)))return!1}catch(t){if(_b_.isinstance(t,_b_.StopIteration))return!0;throw t}return!0},set.__iand__=$accept_only_set(set.intersection_update,"&="),set.__isub__=$accept_only_set(set.difference_update,"-="),set.__ixor__=$accept_only_set(set.symmetric_difference_update,"^="),set.__ior__=$accept_only_set(set.update,"|="),set.$factory=function(){var t={__class__:set,$simple:!0,$items:[],$numbers:[],$hashes:{}},e=[t].concat(Array.prototype.slice.call(arguments));return set.__init__.apply(null,e),t},$B.set_func_names(set,"builtins"),set.__class_getitem__=_b_.classmethod.$factory(set.__class_getitem__);var frozenset={__class__:_b_.type,__mro__:[object],$infos:{__module__:"builtins",__name__:"frozenset"},$is_class:!0,$native:!0};for(var attr in set)switch(attr){case"add":case"clear":case"discard":case"pop":case"remove":case"update":break;default:null==frozenset[attr]&&("function"==typeof set[attr]?frozenset[attr]=function(t){return function(){return set[t].apply(null,arguments)}}(attr):frozenset[attr]=set[attr])}frozenset.__hash__=function(t){if(void 0===t)return frozenset.__hashvalue__||$B.$py_next_hash--;if(void 0!==t.__hashvalue__)return t.__hashvalue__;var e=1927868237;e*=t.$items.length;for(var n=0,r=t.$items.length;n<r;n++){var i=_b_.hash(t.$items[n]);e^=3644798167*(89869747^i^i<<16)}return-1==(e=69069*e+907133923)&&(e=590923713),t.__hashvalue__=e},frozenset.__init__=function(){return $N},frozenset.__new__=function(t){if(void 0===t)throw _b_.TypeError.$factory("frozenset.__new__(): not enough arguments");return{__class__:t,$simple:!0,$items:[],$numbers:[],$hashes:{}}};var singleton_id=Math.floor(Math.random()*Math.pow(2,40));function empty_frozenset(){var t=frozenset.__new__(frozenset);return t.$id=singleton_id,t}frozenset.$factory=function(){var t=$B.args("frozenset",1,{iterable:null},["iterable"],arguments,{iterable:null},null,null);if(null===t.iterable)return empty_frozenset();if(t.iterable.__class__==frozenset)return t.iterable;var e=set.$factory(t.iterable);return 0==e.$items.length?empty_frozenset():(e.__class__=frozenset,e)},$B.set_func_names(frozenset,"builtins"),_b_.set=set,_b_.frozenset=frozenset}(__BRYTHON__),function($B){var _b_=$B.builtins,object=_b_.object,_window=self;function to_simple(t){switch(typeof t){case"string":case"number":return t;case"boolean":return t?"true":"false";case"object":if(t===_b_.None)return"null";if(t instanceof Number)return t.valueOf();default:throw console.log("erreur",t),_b_.TypeError.$factory("keys must be str, int, float, bool or None, not "+$B.class_name(t))}}$B.pyobj2structuredclone=function(t,e){if(e=void 0===e||e,"boolean"==typeof t||"number"==typeof t||"string"==typeof t)return t;if(t instanceof Number)return t.valueOf();if(t===_b_.None)return null;if(Array.isArray(t)||t.__class__===_b_.list||t.__class__===_b_.tuple){for(var n=[],r=0,i=t.length;r<i;r++)n.push($B.pyobj2structuredclone(t[r]));return n}if(_b_.isinstance(t,_b_.dict)){if(e&&(Object.keys(t.$numeric_dict).length>0||Object.keys(t.$object_dict).length>0))throw _b_.TypeError.$factory("a dictionary with non-string keys does not support structured clone");var s=$B.dict_to_list(t);for(n={},r=0,i=s.length;r<i;r++)n[to_simple(s[r][0])]=$B.pyobj2structuredclone(s[r][1]);return n}return t},$B.structuredclone2pyobj=function(t){if(null===t)return _b_.None;if(void 0===t)return $B.Undefined;if("boolean"==typeof t||"number"==typeof t||"string"==typeof t)return t;if(t instanceof Number)return t.valueOf();if(Array.isArray(t)||t.__class__===_b_.list||t.__class__===_b_.tuple){for(var e=_b_.list.$factory(),n=0,r=t.length;n<r;n++)e.push($B.structuredclone2pyobj(t[n]));return e}if("object"==typeof t){for(var i in e=$B.empty_dict(),t)_b_.dict.$setitem(e,i,$B.structuredclone2pyobj(t[i]));return e}throw console.log(t,Array.isArray(t),t.__class__,_b_.list,t.__class__===_b_.list),_b_.TypeError.$factory(_b_.str.$factory(t)+" does not support the structured clone algorithm")};var JSConstructor={__class__:_b_.type,__mro__:[object],$infos:{__module__:"<javascript>",__name__:"JSConstructor"},$is_class:!0,__call__:function(t){return function(){for(var e=[null],n=0,r=arguments.length;n<r;n++)e.push(pyobj2jsobj(arguments[n]));var i=new(t.func.bind.apply(t.func,e));return $B.$JS2Py(i)}},__getattribute__:function(t,e){return"__call__"==e?function(){for(var e=[null],n=0,r=arguments.length;n<r;n++)e.push(pyobj2jsobj(arguments[n]));var i=new(t.func.bind.apply(t.func,e));return $B.$JS2Py(i)}:JSObject.__getattribute__(t,e)},$factory:function(t){return{__class__:JSConstructor,js:t,func:t.js_func}}},jsobj2pyobj=$B.jsobj2pyobj=function(t){switch(t){case!0:case!1:return t}return void 0===t?$B.Undefined:null===t?_b_.None:Array.isArray(t)?_b_.list.$factory(t.map(jsobj2pyobj)):"number"==typeof t?-1==t.toString().indexOf(".")?_b_.int.$factory(t):_b_.float.$factory(t):"kw"===t.$nat?t:$B.$isNode(t)?$B.DOMNode.$factory(t):$B.JSObj.$factory(t)},pyobj2jsobj=$B.pyobj2jsobj=function(t){if(!0===t||!1===t)return t;if(t===_b_.None)return null;if(t!==$B.Undefined){var e=$B.get_class(t);if(void 0===e)return t;if(e===JSConstructor)return void 0!==t.js_func?t.js_func:t.js;if(e===$B.DOMNode||e.__mro__.indexOf($B.DOMNode)>-1)return t;if([_b_.list,_b_.tuple].indexOf(e)>-1){var n=[];return t.forEach((function(t){n.push(pyobj2jsobj(t))})),n}if(e===_b_.dict||_b_.issubclass(e,_b_.dict)){var r={};return _b_.list.$factory(_b_.dict.items(t)).forEach((function(t){"function"==typeof t[1]&&t[1].bind(r),r[t[0]]=pyobj2jsobj(t[1])})),r}return e===_b_.float?t.valueOf():e===$B.Function||e===$B.method?function(){try{for(var e=[],n=0;n<arguments.length;n++)void 0===arguments[n]?e.push(_b_.None):e.push(jsobj2pyobj(arguments[n]));return pyobj2jsobj(t.apply(this,e))}catch(t){throw console.log(t),console.log($B.$getattr(t,"info")),console.log($B.class_name(t)+":",t.args.length>0?t.args[0]:""),t}}:t}};function pyargs2jsargs(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];if(null!=i&&void 0!==i.$nat){var s=i.kw;if(Array.isArray(s)&&(s=$B.extend(js_attr.name,...s)),Object.keys(s).length>0)throw _b_.TypeError.$factory("A Javascript function can't take keyword arguments")}else e.push($B.pyobj2jsobj(i))}return e}$B.JSConstructor=JSConstructor,$B.JSObj=$B.make_class("JSObj",(function(t){if(Array.isArray(t));else if("function"==typeof t)t.$is_js_func=!0;else if("number"==typeof t&&!Number.isInteger(t))return new Number(t);return t})),$B.JSObj.__sub__=function(t,e){if("bigint"==typeof t&&"bigint"==typeof e)return t-e;throw _b_.TypeError.$factory("unsupported operand type(s) for - : '"+$B.class_name(t)+"' and '"+$B.class_name(e)+"'")};var ops={"+":"__add__","*":"__mul__","**":"__pow__","%":"__mod__"};for(var op in ops)eval("$B.JSObj."+ops[op]+" = "+($B.JSObj.__sub__+"").replace(/-/g,op));$B.JSObj.__eq__=function(t,e){if("object"==typeof t){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var n in t)if(!$B.JSObj.__eq__(t[n],e[n]))return!1}return t===e},$B.JSObj.__ne__=function(t,e){return!$B.JSObj.__eq__(t,e)},$B.JSObj.__getattribute__=function(t,e){if("$$new"==e&&"function"==typeof t)return t.$js_func?function(){var e=pyargs2jsargs(arguments);return $B.JSObj.$factory(new t.$js_func(...e))}:function(){var e=pyargs2jsargs(arguments);return $B.JSObj.$factory(new t(...e))};"string"==typeof e&&(e=$B.from_alias(e));var n=t[e];if(null==n&&"function"==typeof t&&t.$js_func&&(n=t.$js_func[e]),void 0===n){if("function"==typeof t.getNamedItem&&void 0!==(s=t.getNamedItem(e)))return $B.JSObj.$factory(s);var r=$B.get_class(t);if(r&&r[e]){var i=r[e];return"function"==typeof i?function(){for(var e=[t],n=0,r=arguments.length;n<r;n++)e.push(arguments[n]);return $B.JSObj.$factory(i.apply(null,e))}:i}if("bind"==e&&"function"==typeof t.addEventListener)return function(e,n){return t.addEventListener(e,n)};throw _b_.AttributeError.$factory(e)}if("function"==typeof n){var s=function(){var r=pyargs2jsargs(arguments),i=t.$js_func||t;try{var s=n.apply(i,r)}catch(i){throw console.log("error",i),console.log("attribute",e,"of self",t,n,r,arguments),i}return void 0===s?$B.Undefined:null===s?_b_.None:$B.JSObj.$factory(s)};return s.prototype=n.prototype,s.$js_func=n,s.__mro__=[_b_.object],s.$infos={__name__:n.name,__qualname__:n.name},$B.frames_stack.length>0&&(s.$infos.__module__=$B.last($B.frames_stack)[3].__name__),$B.JSObj.$factory(s)}return $B.JSObj.$factory(n)},$B.JSObj.__setattr__=function(t,e,n){return"string"==typeof e&&(e=$B.from_alias(e)),t[e]=$B.pyobj2structuredclone(n),_b_.None},$B.JSObj.__getitem__=function(t,e){if("string"==typeof e)return $B.JSObj.__getattribute__(t,e);if("number"==typeof e){if(void 0!==t[e])return $B.JSObj.$factory(t[e]);if("number"==typeof t.length&&("number"==typeof e||"boolean"==typeof e)&&"function"==typeof t.item){var n=_b_.int.$factory(e);n<0&&(n+=t.length);var r=t.item(n);if(null===r)throw _b_.IndexError.$factory(n);return $B.JSObj.$factory(r)}}throw _b_.KeyError.$factory(n)},$B.JSObj.__setitem__=$B.JSObj.__setattr__;var JSObj_iterator=$B.make_iterator_class("JS object iterator");$B.JSObj.__iter__=function(t){var e=[];if(_window.Symbol&&void 0!==t[Symbol.iterator]){if(e=[],void 0!==t.next)for(;;){var n=t.next();if(n.done)break;e.push($B.JSObj.$factory(n.value))}else if(void 0!==t.length&&void 0!==t.item)for(var r=0;r<t.length;r++)e.push($B.JSObj.$factory(t.item(r)));return JSObj_iterator.$factory(e)}if(void 0!==t.length&&void 0!==t.item){for(r=0;r<t.length;r++)e.push($B.JSObj.$factory(t.js.item(r)));return JSObj_iterator.$factory(e)}var i=$B.JSObj.to_dict(t);return _b_.dict.__iter__(i)},$B.JSObj.__len__=function(t){if("number"==typeof t.length)return t.length;throw _b_.AttributeError.$factory(t+" has no attribute __len__")},$B.JSObj.__repr__=$B.JSObj.__str__=function(t){return"<Javascript "+t.constructor.name+" object: "+t.toString()+">"},$B.JSObj.bind=function(t,e,n){return t.addEventListener(e,(function(t){return n(jsobj2pyobj(t))})),_b_.None},$B.JSObj.to_dict=function(t){return $B.structuredclone2pyobj(t)},$B.set_func_names($B.JSObj,"builtins"),$B.JSMeta=$B.make_class("JSMeta"),$B.JSMeta.__call__=function(t){for(var e=[],n=1,r=arguments.length;n<r;n++)e.push(arguments[n]);return new t.__mro__[0].$js_func(...e)},$B.JSMeta.__mro__=[_b_.type,_b_.object],$B.JSMeta.__getattribute__=function(t,e){return void 0!==t[e]?t[e]:void 0!==$B.JSMeta[e]?$B.JSMeta[e]:_b_.type.__getattribute__(t,e)},$B.JSMeta.__init_subclass__=function(){},$B.set_func_names($B.JSMeta,"builtins")}(__BRYTHON__),function(t){t.stdlib={};for(var e=["VFS_import","__future__","_abcoll","_codecs","_collections","_collections_abc","_compat_pickle","_contextvars","_csv","_dummy_thread","_frozen_importlib","_functools","_imp","_io","_markupbase","_operator","_py_abc","_pydecimal","_queue","_random","_socket","_sre","_struct","_sysconfigdata","_sysconfigdata_0_brython_","_testcapi","_thread","_threading_local","_weakref","_weakrefset","abc","antigravity","argparse","atexit","base64","bdb","binascii","bisect","browser.aio","browser.ajax","browser.highlight","browser.html","browser.indexed_db","browser.local_storage","browser.markdown","browser.object_storage","browser.session_storage","browser.svg","browser.template","browser.timer","browser.webcomponent","browser.websocket","browser.webworker","browser.worker","calendar","cmath","cmd","code","codecs","codeop","colorsys","configparser","contextlib","contextvars","copy","copyreg","csv","dataclasses","datetime","decimal","difflib","doctest","enum","errno","external_import","faulthandler","fnmatch","formatter","fractions","functools","gc","genericpath","getopt","gettext","glob","heapq","hmac","imp","inspect","interpreter","io","ipaddress","itertools","json","keyword","linecache","locale","mimetypes","nntplib","ntpath","numbers","opcode","operator","optparse","os","pathlib","pdb","pickle","pkgutil","platform","posixpath","pprint","profile","pwd","py_compile","pydoc","queue","quopri","re","reprlib","select","selectors","shlex","shutil","signal","site","site-packages.__future__","site-packages.docs","site-packages.header","site-packages.test","site-packages.test_sp","socket","sre_compile","sre_constants","sre_parse","stat","string","stringprep","struct","subprocess","sys","sysconfig","tarfile","tb","tempfile","test.namespace_pkgs.module_and_namespace_package.a_test","textwrap","this","threading","time","timeit","token","tokenize","traceback","turtle","types","typing","uu","uuid","warnings","weakref","webbrowser","zipfile","zipimport","zlib"],n=0;n<e.length;n++)t.stdlib[e[n]]=["py"];var r=["_aio","_ajax","_base64","_binascii","_io_classes","_json","_jsre","_locale","_multiprocessing","_posixsubprocess","_profile","_sre_utils","_string","_strptime","_svg","_warnings","_webcomponent","_webworker","_zlib_utils","aes","array","builtins","dis","hashlib","hmac-md5","hmac-ripemd160","hmac-sha1","hmac-sha224","hmac-sha256","hmac-sha3","hmac-sha384","hmac-sha512","long_int","marshal","math","math1","md5","modulefinder","pbkdf2","posix","rabbit","rabbit-legacy","random","rc4","ripemd160","sha1","sha224","sha256","sha3","sha384","sha512","tripledes","unicodedata"];for(n=0;n<r.length;n++)t.stdlib[r[n]]=["js"];var i=["browser.widgets","collections","concurrent","concurrent.futures","email","email.mime","encodings","html","http","importlib","logging","multiprocessing","multiprocessing.dummy","pydoc_data","site-packages.foobar","site-packages.simpleaio","site-packages.simpy","site-packages.simpy.resources","site-packages.ui","test","test.encoded_modules","test.leakers","test.namespace_pkgs.not_a_namespace_pkg.foo","test.support","test.test_email","test.test_importlib","test.test_importlib.builtin","test.test_importlib.extension","test.test_importlib.frozen","test.test_importlib.import_","test.test_importlib.source","test.test_json","test.tracedmodules","unittest","unittest.test","unittest.test.testmock","urllib"];for(n=0;n<i.length;n++)t.stdlib[i[n]]=["py",!0]}(__BRYTHON__),function($B){var _b_=$B.builtins,_window=self,module=$B.module={__class__:_b_.type,__mro__:[_b_.object],$infos:{__module__:"builtins",__name__:"module"},$is_class:!0};function parent_package(t){var e=t.split(".");return e.pop(),e.join(".")}function $download_module(t,e,n){var r=new XMLHttpRequest,i="?v="+(new Date).getTime(),s=null,o=t.__name__,a=_window.setTimeout((function(){r.abort()}),5e3);if($B.$options.cache?r.open("GET",e,!1):r.open("GET",e+i,!1),r.send(),$B.$CORS?s=200==r.status||0==r.status?r.responseText:_b_.ModuleNotFoundError.$factory("No module named '"+o+"'"):4==r.readyState&&(200==r.status?(s=r.responseText,t.$last_modified=r.getResponseHeader("Last-Modified")):(console.info("Error "+r.status+" means that Python module "+o+" was not found at url "+e),s=_b_.ModuleNotFoundError.$factory("No module named '"+o+"'"))),_window.clearTimeout(a),null==s)throw _b_.ModuleNotFoundError.$factory("No module named '"+o+"' (res is null)");if(s.constructor===Error)throw s;return s}function import_js(t,e){try{var n=$download_module(t,e,void 0)}catch(t){return null}return run_js(n,e,t),!0}function run_js(t,e,n){try{var r=new Function(t+";\nreturn $module")();$B.$options.store&&(n.$js=t)}catch(t){throw console.log(t),console.log(e,n),t}for(var i in r.__name__=n.__name__,r)"function"==typeof r[i]&&(r[i].$infos={__module__:n.__name__,__name__:i,__qualname__:i});if(void 0!==n){for(var i in r)n[i]=r[i];(r=n).__class__=module}else r.__class__=module,r.__name__=n.__name__,r.__repr__=r.__str__=function(){return $B.builtin_module_names.indexOf(n.name)>-1?"<module '"+n.__name__+"' (built-in)>":"<module '"+n.__name__+"' from "+e+" >"},"builtins"!=n.name&&(r.__file__=e);return $B.imported[n.__name__]=r,!0}function show_ns(){for(var kk=Object.keys(_window),i=0,len=kk.length;i<len;i++)console.log(kk[i]),"$"==kk[i].charAt(0)&&console.log(eval(kk[i]));console.log("---")}function import_py(t,e,n){var r=t.__name__,i=$download_module(t,e,n);if(t.$src=i,$B.imported[r].$is_package=t.$is_package,$B.imported[r].$last_modified=t.$last_modified,"/__init__.py"==e.substr(e.length-12))$B.imported[r].__package__=r,$B.imported[r].__path__=e,$B.imported[r].$is_package=t.$is_package=!0;else if(n)$B.imported[r].__package__=n;else{var s=r.split(".");s.pop(),$B.imported[r].__package__=s.join(".")}return $B.imported[r].__file__=e,run_py(i,e,t)}function run_py(module_contents,path,module,compiled){$B.file_cache[path]=module_contents;var root,js,mod_name=module.__name__;if(!compiled){var $Node=$B.$Node,$NodeJSCtx=$B.$NodeJSCtx;$B.$py_module_path[module.__name__]=path;var src={src:module_contents,has_annotations:!1};root=$B.py2js(src,module,module.__name__,$B.builtins_scope),void 0!==module.__package__&&(root.binding.__package__=!0)}try{js=compiled?module_contents:root.to_js(),10==$B.$options.debug&&(console.log("code for module "+module.__name__),console.log(js));var src=js;js="var $module = (function(){\n"+js+"return $locals_"+module.__name__.replace(/\./g,"_")+"})(__BRYTHON__)\nreturn $module";var module_id="$locals_"+module.__name__.replace(/\./g,"_"),$module=new Function(module_id,js)(module)}catch(t){for(var attr in console.log(t+" for module "+module.__name__),console.log("module",module),console.log(root),$B.debug>1&&console.log(js),t)console.log(attr,t[attr]);throw console.log(_b_.getattr(t,"info","[no info]")),console.log("message: "+t.$message),console.log("filename: "+t.fileName),console.log("linenum: "+t.lineNumber),$B.debug>0&&console.log("line info "+$B.line_info),t}finally{$B.clear_ns(module.__name__)}try{var mod=eval("$module");for(var attr in mod)module[attr]=mod[attr];return module.__initializing__=!1,$B.imported[module.__name__]=module,{content:src,name:mod_name,imports:Object.keys(root.imports).join(",")}}catch(t){for(var attr in console.log(t+"  for module "+module.__name__),t)console.log(attr+" "+t[attr]);throw $B.debug>0&&console.log("line info "+__BRYTHON__.line_info),t}}function new_spec(t){return t.__class__=module,t}module.__init__=function(){},module.__new__=function(t,e,n,r){return{__class__:t,__name__:e,__doc__:n||_b_.None,__package__:r||_b_.None}},module.__repr__=module.__str__=function(t){var e="<module "+t.__name__;return void 0===t.__file__&&(e+=" (built-in)"),e+">"},module.__setattr__=function(t,e,n){"__builtins__"==t.__name__?$B.builtins[e]=n:t[e]=n},module.$factory=function(t,e,n){return{__class__:module,__name__:t,__doc__:e||_b_.None,__package__:n||_b_.None}},$B.set_func_names(module,"builtins"),$B.$download_module=$download_module,$B.run_py=run_py;var finder_VFS={__class__:_b_.type,__mro__:[_b_.object],$infos:{__module__:"builtins",__name__:"VFSFinder"},create_module:function(t,e){return _b_.None},exec_module:function(t,e){var n=e.__spec__.loader_state.stored,r=e.__spec__.loader_state.timestamp;delete e.__spec__.loader_state;var i=n[0],s=n[1];n[2],e.$is_package=n[3]||!1;var o="VFS."+e.__name__;if(o+=e.$is_package?"/__init__.py":i,e.__file__=o,$B.file_cache[e.__file__]=$B.VFS[e.__name__][1],".js"==i)run_js(s,e.__path__,e);else{if($B.precompiled.hasOwnProperty(e.__name__)){$B.debug>1&&console.info("load",e.__name__,"from precompiled");for(var a=e.__name__.split("."),l=0;l<a.length;l++){var c=a.slice(0,l+1).join(".");if(!$B.imported.hasOwnProperty(c)||!$B.imported[c].__initialized__){var u=$B.precompiled[c],h=e.$is_package;Array.isArray(u)&&(u=u[0]);var p=$B.imported[c]=module.$factory(c,void 0,h);p.__initialized__=!0,h?(p.__path__="<stdlib>",p.__package__=c):((y=c.split(".")).pop(),p.__package__=y.join(".")),p.__file__=o;try{var d=c.replace(/\./g,"_");u+="return $locals_"+d;var f=new Function("$locals_"+d,u)(p)}catch(t){if($B.debug>1){for(var m in console.log(t),t)console.log(m,t[m]);console.log(Object.keys($B.imported)),$B.debug>2&&console.log(e,"mod_js",u)}throw t}for(var _ in f)p[_]=f[_];f.__file__=o,l>0&&$B.builtins.setattr($B.imported[a.slice(0,l).join(".")],a[l],f)}}return f}var g=e.__name__;$B.debug>1&&console.log("run Python code from VFS",g);var y,v=run_py(s,e.__path__,e);v.is_package=e.$is_package,v.timestamp=$B.timestamp,v.source_ts=r,$B.precompiled[g]=v.is_package?[v.content]:v.content,(y=g.split(".")).length>1&&y.pop(),$B.$options.indexedDB&&self.indexedDB&&$B.idb_name&&(indexedDB.open($B.idb_name).onsuccess=function(t){var n=t.target.result.transaction("modules","readwrite").objectStore("modules"),r=(n.openCursor(),n.put(v));r.onsuccess=function(){$B.debug>1&&console.info(e.__name__,"stored in db")},r.onerror=function(){console.info("could not store "+e.__name__)}})}},find_module:function(t,e,n){return{__class__:Loader,load_module:function(e,n){var r=t.find_spec(t,e,n),i=module.$factory(e);$B.imported[e]=i,i.__spec__=r,t.exec_module(t,i)}}},find_spec:function(t,e,n,r){var i,s,o;return $B.use_VFS?void 0===(i=$B.VFS[e])?_b_.None:(s=i[3]||!1,o=i.timestamp,i?new_spec({name:e,loader:t,origin:$B.builtin_module_names.indexOf(e)>-1?"built-in":"brython_stdlib",submodule_search_locations:s?[]:_b_.None,loader_state:{stored:i,timestamp:o},cached:_b_.None,parent:s?e:parent_package(e),has_location:_b_.False}):void 0):_b_.None}};for(var method in $B.set_func_names(finder_VFS,"<import>"),finder_VFS)"function"==typeof finder_VFS[method]&&(finder_VFS[method]=_b_.classmethod.$factory(finder_VFS[method]));finder_VFS.$factory=function(){return{__class__:finder_VFS}};var finder_cpython={__class__:_b_.type,__mro__:[_b_.object],$infos:{__module__:"builtins",__name__:"CPythonFinder"},create_module:function(t,e){return _b_.None},exec_module:function(t,e){console.log("exec PYthon module",e);var n=e.__spec__.loader_state,r=n.content;delete e.__spec__.loader_state,e.$is_package=n.is_package,e.__file__=n.__file__,$B.file_cache[e.__file__]=r;var i=e.__name__;$B.debug>1&&console.log("run Python code from CPython",i),run_py(r,e.__path__,e)},find_module:function(t,e,n){return{__class__:Loader,load_module:function(e,n){var r=t.find_spec(t,e,n),i=module.$factory(e);$B.imported[e]=i,i.__spec__=r,t.exec_module(t,i)}}},find_spec:function(t,e,n,r){console.log("finder cpython",e);var i,s=new XMLHttpRequest,o="/cpython_import?module="+e;return s.open("GET",o,!1),s.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var n=JSON.parse(this.responseText);i=new_spec({name:e,loader:t,origin:"CPython",submodule_search_locations:n.is_package?[]:_b_.None,loader_state:{content:n.content},cached:_b_.None,parent:n.is_package?e:parent_package(e),has_location:_b_.False})}},s.send(),i}};for(var method in $B.set_func_names(finder_cpython,"<import>"),finder_cpython)"function"==typeof finder_cpython[method]&&(finder_cpython[method]=_b_.classmethod.$factory(finder_cpython[method]));finder_cpython.$factory=function(){return{__class__:finder_cpython}};var finder_stdlib_static={$factory:finder_stdlib_static,__class__:_b_.type,__mro__:[_b_.object],$infos:{__module__:"builtins",__name__:"StdlibStatic"},create_module:function(t,e){return _b_.None},exec_module:function(t,e){var n=e.__spec__.loader_state;e.$is_package=n.is_package,"py"==n.ext?import_py(e,n.path,e.__package__):import_js(e,n.path),delete e.__spec__.loader_state},find_module:function(t,e,n){var r=t.find_spec(t,e,n);return r===_b_.None?_b_.None:{__class__:Loader,load_module:function(e,n){var i=module.$factory(e);$B.imported[e]=i,i.__spec__=r,i.__package__=r.parent,t.exec_module(t,i)}}},find_spec:function(t,e,n,r){if($B.stdlib&&$B.$options.static_stdlib_import){var i=$B.stdlib[e];if(void 0===i){var s=e.split(".");if(s.length>1){s.pop();var o=$B.stdlib[s.join(".")];o&&o[1]&&(i=["py"])}}if(void 0!==i){var a=i[0],l=void 0!==i[1],c={ext:a,is_package:l,path:(n=$B.brython_path+("py"==a?"Lib/":"libs/")+e.replace(/\./g,"/"))+(l?"/__init__.py":"py"==a?".py":".js"),address:i};return new_spec({name:e,loader:t,origin:c.path,submodule_search_locations:l?[n]:_b_.None,loader_state:c,cached:_b_.None,parent:l?e:parent_package(e),has_location:_b_.True})}}return _b_.None}};for(var method in $B.set_func_names(finder_stdlib_static,"<import>"),finder_stdlib_static)"function"==typeof finder_stdlib_static[method]&&(finder_stdlib_static[method]=_b_.classmethod.$factory(finder_stdlib_static[method]));finder_stdlib_static.$factory=function(){return{__class__:finder_stdlib_static}};var finder_path={__class__:_b_.type,__mro__:[_b_.object],$infos:{__module__:"builtins",__name__:"ImporterPath"},create_module:function(t,e){return _b_.None},exec_module:function(t,e){var n=$B.$getattr(e,"__spec__"),r=n.loader_state.code;e.$is_package=n.loader_state.is_package,delete n.loader_state.code;var i=n.loader_state.type;"py"==i||"pyc.js"==i?run_py(r,n.origin,e,"pyc.js"==i):"js"==n.loader_state.type&&run_js(r,n.origin,e)},find_module:function(t,e,n){return finder_path.find_spec(t,e,n)},find_spec:function(t,e,n,r){var i=$B.last($B.frames_stack)[2];if($B.VFS&&$B.VFS[i])return _b_.None;$B.is_none(n)&&(n=$B.path);for(var s=0,o=n.length;s<o;++s){var a=n[s];"/"!=a[a.length-1]&&(a+="/");var l=$B.path_importer_cache[a];if(void 0===l){for(var c=!0,u=0,h=$B.path_hooks.length;u<h&&c;++u){var p=$B.path_hooks[u].$factory;try{l=("function"==typeof p?p:$B.$getattr(p,"__call__"))(a),c=!1}catch(t){if(t.__class__!==_b_.ImportError)throw t}}c&&($B.path_importer_cache[a]=_b_.None)}if(!$B.is_none(l)){var d=$B.$getattr(l,"find_spec"),f=("function"==typeof d?d:$B.$getattr(d,"__call__"))(e,r);if(!$B.is_none(f))return f}}return _b_.None}};for(var method in $B.set_func_names(finder_path,"<import>"),finder_path)"function"==typeof finder_path[method]&&(finder_path[method]=_b_.classmethod.$factory(finder_path[method]));finder_path.$factory=function(){return{__class__:finder_path}};var url_hook={__class__:_b_.type,__mro__:[_b_.object],__repr__:function(t){return"<UrlPathFinder"+(t.hint?" for '"+t.hint+"'":"(unbound)")+" at "+t.path_entry+">"},$infos:{__module__:"builtins",__name__:"UrlPathFinder"},find_spec:function(t,e,n){var r={},i=!0,s=t.hint,o=t.path_entry+e.match(/[^.]+$/g)[0],a=[];(void 0===s||"py"==s)&&(a=a.concat([[o+".py","py",!1],[o+"/__init__.py","py",!0]]));for(var l=0;i&&l<a.length;++l)try{var c=a[l];n={__name__:e,$is_package:!1},r.code=$download_module(n,c[0],void 0),i=!1,r.type=c[1],r.is_package=c[2],void 0===s&&(t.hint=c[1],$B.path_importer_cache[t.path_entry]=t),r.is_package&&($B.path_importer_cache[o+"/"]=url_hook.$factory(o+"/",t.hint)),r.path=c[0]}catch(t){}return i?_b_.None:new_spec({name:e,loader:finder_path,origin:r.path,submodule_search_locations:r.is_package?[o]:_b_.None,loader_state:r,cached:_b_.None,parent:r.is_package?e:parent_package(e),has_location:_b_.True})},invalidate_caches:function(t){},$factory:function(t,e){return{__class__:url_hook,path_entry:t.endsWith("/")?t:t+"/",hint:e}}};$B.set_func_names(url_hook,"<import>"),$B.path_importer_cache={};for(var _sys_paths=[[$B.script_dir+"/","py"],[$B.brython_path+"Lib/","py"],[$B.brython_path+"Lib/site-packages/","py"],[$B.brython_path+"libs/","js"]],i=0;i<_sys_paths.length;++i){var _path=_sys_paths[i],_type=_path[1];_path=_path[0],$B.path_importer_cache[_path]=url_hook.$factory(_path,_type)}function import_error(t){var e=_b_.ImportError.$factory(t);throw e.name=t,e}function optimize_import_for_path(t,e){"/"!=t.slice(-1)&&(t+="/");var n="none"==e?_b_.None:url_hook.$factory(t,e);$B.path_importer_cache[t]=n}$B.$__import__=function(t,e,n,r,i){var s=!1;if(e.$jsobj&&e.$jsobj.__file__){var o=e.$jsobj.__file__;(o.startsWith($B.brython_path+"Lib/")&&!o.startsWith($B.brython_path+"Lib/site-packages/")||o.startsWith($B.brython_path+"libs/")||o.startsWith("VFS."))&&(s=!0)}var a=$B.imported[t],l=t.split("."),c=r.length>0;if(a==_b_.None&&import_error(t),void 0===a){$B.is_none(r)&&(r=[]);for(var u=0,h="",p="",d=l.length-1,f=_b_.None;u<=d;++u){var m=p;if(p+=h+l[u],h=".",(a=$B.imported[p])==_b_.None)import_error(p);else if(void 0===a){try{$B.import_hooks(p,f,s)}catch(t){throw delete $B.imported[p],t}$B.is_none($B.imported[p])?import_error(p):m&&_b_.setattr($B.imported[m],l[u],$B.imported[p])}else $B.imported[m]&&void 0===$B.imported[m][l[u]]&&_b_.setattr($B.imported[m],l[u],$B.imported[p]);if(u<d)try{f=$B.$getattr($B.imported[p],"__path__")}catch(e){if(u==d-1&&$B.imported[p][l[d]]&&$B.imported[p][l[d]].__class__===module)return $B.imported[p][l[d]];if(!c){var _=_b_.ModuleNotFoundError.$factory();throw _.msg="No module named '"+t+"'; '"+p+"' is not a package",_.args=$B.fast_tuple([_.msg]),_.name=t,_.path=_b_.None,_}import_error(t)}}}else if($B.imported[l[0]]&&2==l.length)try{void 0===$B.imported[l[0]][l[1]]&&$B.$setattr($B.imported[l[0]],l[1],a)}catch(t){throw console.log("error",l,a),t}return r.length>0?$B.imported[t]:$B.imported[l[0]]},$B.$import=function(t,e,n,r){e=void 0===e?[]:e,n=void 0===n?{}:n,r=void 0===r?{}:r;var i=t.split(".");"."==t[t.length-1]&&i.pop();for(var s=[],o=!0,a=0,l=i.length;a<l;a++){var c=i[a];if(o&&""==c){if(elt=s.pop(),void 0===elt)throw _b_.ImportError.$factory("Parent module '' not loaded, cannot perform relative import")}else o=!1,s.push("$$"==c.substr(0,2)?c.substr(2):c)}t=s.join("."),10==$B.$options.debug&&(console.log("$import "+t),console.log("use VFS ? "+$B.use_VFS),console.log("use static stdlib paths ? "+$B.static_stdlib_import));var u=$B.frames_stack[$B.frames_stack.length-1],h=u[3],p=h.__import__,d=$B.obj_dict(h);void 0===p&&(p=$B.$__import__);var f=("function"==typeof p?p:$B.$getattr(p,"__call__"))(t,d,void 0,e,0);if(e&&0!=e.length){var m=e,_={};if(e&&"*"==e[0]&&(m=$B.$getattr(f,"__all__",_))!==_&&(n={}),m===_)for(var g in f)"_"!==g[0]&&(r[g]=f[g]);else{a=0;for(var y=m.length;a<y;++a){var v=m[a],b=n[v]||v;try{r[b]=$B.$getattr(f,v)}catch(e){try{var x=$B.from_alias(v);$B.$getattr(p,"__call__")(t+"."+x,d,void 0,[],0),r[b]=$B.$getattr(f,x)}catch(e){if("__future__"===t){var w=$B.last($B.frames_stack),S=w[3].$line_info.split(","),M=parseInt(S[0]);$B.$SyntaxError(w[2],"future feature "+v+" is not defined",u[3].src,void 0,M)}if(e.$py_error)throw e.__class__.$infos.__name__,e.__class__!==_b_.ImportError&&e.__class__!==_b_.ModuleNotFoundError&&$B.handle_error(e),_b_.ImportError.$factory("cannot import name '"+v+"'");throw $B.debug>1&&(console.log(e),console.log($B.last($B.frames_stack))),_b_.ImportError.$factory("cannot import name '"+v+"'")}}}}return r}(b=n[t])?r[b]=$B.imported[t]:r[$B.to_alias(s[0])]=f},$B.import_all=function(t,e){for(var n in e)(n.startsWith("$$")||-1=="_$".indexOf(n.charAt(0)))&&(t[n]=e[n])},$B.$path_hooks=[url_hook],$B.$meta_path=[finder_VFS,finder_stdlib_static,finder_path],$B.finders={VFS:finder_VFS,stdlib_static:finder_stdlib_static,path:finder_path,CPython:finder_cpython};var Loader={__class__:$B.$type,__mro__:[_b_.object],__name__:"Loader"},_importlib_module={__class__:module,__name__:"_importlib",Loader,VFSFinder:finder_VFS,StdlibStatic:finder_stdlib_static,ImporterPath:finder_path,UrlPathFinder:url_hook,optimize_import_for_path};_importlib_module.__repr__=_importlib_module.__str__=function(){return"<module '_importlib' (built-in)>"},$B.imported._importlib=_importlib_module}(__BRYTHON__),function($B){var bltns=$B.InjectBuiltins();eval(bltns);var object=_b_.object;function $err(t,e){var n="unsupported operand type(s) for "+t+": 'float' and '"+$B.class_name(e)+"'";throw _b_.TypeError.$factory(n)}function float_value(t){return void 0!==t.$brython_value?t.$brython_value:t}var float={__class__:_b_.type,__dir__:object.__dir__,$infos:{__module__:"builtins",__name__:"float"},$is_class:!0,$native:!0,$descriptors:{numerator:!0,denominator:!0,imag:!0,real:!0}};function preformat(t,e){if(e.empty)return _b_.str.$factory(t);if(e.type&&-1=="eEfFgGn%".indexOf(e.type))throw _b_.ValueError.$factory("Unknown format code '"+e.type+"' for object of type 'float'");if(isNaN(t))return"f"==e.type||"g"==e.type?"nan":"NAN";if(t==Number.POSITIVE_INFINITY)return"f"==e.type||"g"==e.type?"inf":"INF";if(void 0===e.precision&&void 0!==e.type&&(e.precision=6),"%"==e.type&&(t*=100),"e"==e.type){var n=t.toExponential(e.precision),r=parseInt(n.substr(n.search("e")+1));return Math.abs(r)<10&&(n=n.substr(0,n.length-1)+"0"+n.charAt(n.length-1)),n}if(void 0!==e.precision){var i=e.precision;if(0==i)return Math.round(t)+"";var s=(n=t.toFixed(i)).indexOf(".");if(void 0===e.type||"%"!=e.type&&"f"!=e.type.toLowerCase()){if(e.type&&"g"==e.type.toLowerCase()){var o=preformat(t,{type:"e"}).split("e"),a=(n=-4<=(r=parseInt(o[1]))&&r<e.precision?preformat(t,{type:"f",precision:e.precision-1-r}):preformat(t,{type:"e",precision:e.precision-1})).split("e");if(e.alternate)-1==a[0].search(/\./)&&(a[0]+=".");else if(a[1]){for(var l=a[0];l.endsWith("0");)l=l.substr(0,l.length-1);l.endsWith(".")&&(l=l.substr(0,l.length-1)),a[0]=l}return n=a.join("e"),"G"==e.type&&(n=n.toUpperCase()),n}if(void 0===e.type)e.type="g",n=preformat(t,e),e.type=void 0;else{var c=t.toExponential(e.precision-1);if((r=parseInt(c.substr(c.search("e")+1)))<-4||r>=e.precision-1){for(var u=c.split("e");u[0].endsWith("0");)u[0]=u[0].substr(0,u[0].length-1);n=u.join("e")}}}else if(-1==s)n+="."+"0".repeat(e.precision);else{var h=e.precision-n.length+s+1;h>0&&(n+="0".repeat(h))}}else n=_b_.str.$factory(t);if(void 0===e.type||-1!="gGn".indexOf(e.type)){if(-1==n.search("e"))for(;"0"==n.charAt(n.length-1);)n=n.substr(0,n.length-1);"."==n.charAt(n.length-1)&&(void 0===e.type?n+="0":n=n.substr(0,n.length-1))}return void 0!==e.sign&&(" "==e.sign||"+"==e.sign)&&t>0&&(n=e.sign+n),"%"==e.type&&(n+="%"),n}float.numerator=function(t){return float_value(t)},float.denominator=function(t){return _b_.int.$factory(1)},float.imag=function(t){return _b_.int.$factory(0)},float.real=function(t){return float_value(t)},float.__float__=function(t){return float_value(t)},float.as_integer_ratio=function(t){if((t=float_value(t)).valueOf()==Number.POSITIVE_INFINITY||t.valueOf()==Number.NEGATIVE_INFINITY)throw _b_.OverflowError.$factory("Cannot pass infinity to float.as_integer_ratio.");if(!Number.isFinite(t.valueOf()))throw _b_.ValueError.$factory("Cannot pass NaN to float.as_integer_ratio.");for(var e=_b_.$frexp(t.valueOf()),n=e[0],r=e[1],i=0;i<300&&n!=Math.floor(n);i++)n*=2,r--;return numerator=float.$factory(n),py_exponent=abs(r),denominator=1,py_exponent=_b_.getattr(_b_.int.$factory(denominator),"__lshift__")(py_exponent),r>0?numerator*=py_exponent:denominator=py_exponent,_b_.tuple.$factory([_b_.int.$factory(numerator),_b_.int.$factory(denominator)])},float.__bool__=function(t){return t=float_value(t),_b_.bool.$factory(t.valueOf())},float.__eq__=function(t,e){return t=float_value(t),e=float_value(e),(!isNaN(t)||!isNaN(e))&&(isinstance(e,_b_.int)?t==e:isinstance(e,float)?t.valueOf()==e.valueOf():isinstance(e,_b_.complex)?0==e.$imag&&t==e.$real:_b_.NotImplemented)},float.__floordiv__=function(t,e){if(t=float_value(t),e=float_value(e),isinstance(e,[_b_.int,float])){if(0==e.valueOf())throw ZeroDivisionError.$factory("division by zero");return float.$factory(Math.floor(t/e))}if(hasattr(e,"__rfloordiv__"))return getattr(e,"__rfloordiv__")(t);$err("//",e)},float.fromhex=function(t){if(!isinstance(t,_b_.str))throw _b_.ValueError.$factory("argument must be a string");var e,n=t.trim();switch(n.toLowerCase()){case"+inf":case"inf":case"+infinity":case"infinity":return $FloatClass(1/0);case"-inf":case"-infinity":return $FloatClass(-1/0);case"+nan":case"nan":return $FloatClass(Number.NaN);case"-nan":return $FloatClass(-Number.NaN);case"":throw _b_.ValueError.$factory("could not convert string to float")}if(null!==(e=/^(\d*\.?\d*)$/.exec(n)))return $FloatClass(parseFloat(e[1]));if(null==(e=/^(\+|-)?(0x)?([0-9A-F]+\.?)?(\.[0-9A-F]+)?(p(\+|-)?\d+)?$/i.exec(n)))throw _b_.ValueError.$factory("invalid hexadecimal floating-point string");var r=e[1],i=parseInt(e[3]||"0",16),s=e[4]||".0",o=e[5]||"p0";r="-"==r?-1:1;for(var a=i,l=1,c=s.length;l<c;l++)a+=parseInt(s.charAt(l),16)/Math.pow(16,l);return new Number(r*a*Math.pow(2,parseInt(o.substring(1))))},float.__getformat__=function(t){if("double"==t||"float"==t)return"IEEE, little-endian";throw _b_.ValueError.$factory("__getformat__() argument 1 must be 'double' or 'float'")},float.__format__=function(t,e){t=float_value(t);var n=new $B.parse_format_spec(e);n.align=n.align||">";var r=preformat(t,n).split("."),i=r[0];if(n.comma){for(var s=i.length,o=Math.ceil(i.length/3),a=[],l=0;l<o;l++)a.push(i.substring(s-3*l-3,s-3*l));a.reverse(),r[0]=a.join(",")}return $B.format_width(r.join("."),n)},float.__hash__=function(t){if(void 0===t)return float.__hashvalue__||$B.$py_next_hash--;var e=t.valueOf();if(e===1/0)return 314159;if(e===-1/0)return-271828;if(isNaN(e))return 0;if(e==Math.round(e))return Math.round(e);var n=_b_.$frexp(e);n[0]*=Math.pow(2,31);var r=_b_.int.$factory(n[0]);return n[0]=(n[0]-r)*Math.pow(2,31),4294967295&r+_b_.int.$factory(n[0])+(n[1]<<15)},_b_.$isninf=function(t){var e=t;return isinstance(t,float)&&(e=t.valueOf()),e==-1/0||e==Number.NEGATIVE_INFINITY},_b_.$isinf=function(t){var e=t;return isinstance(t,float)&&(e=t.valueOf()),e==1/0||e==-1/0||e==Number.POSITIVE_INFINITY||e==Number.NEGATIVE_INFINITY},_b_.$fabs=function(t){return t>0?float.$factory(t):float.$factory(-t)},_b_.$frexp=function(t){var e=t;if(isinstance(t,float)&&(e=t.valueOf()),isNaN(e)||_b_.$isinf(e))return[e,-1];if(0==e)return[0,0];var n=1,r=0,i=e;for(i<0&&(n=-n,i=-i);i<.5;)i*=2,r--;for(;i>=1;)i*=.5,r++;return[i*=n,r]},_b_.$ldexp=function(t,e){if(_b_.$isninf(t))return float.$factory("-inf");if(_b_.$isinf(t))return float.$factory("inf");var n=t;if(isinstance(t,float)&&(n=t.valueOf()),0==n)return n;var r=e;return isinstance(e,float)&&(r=e.valueOf()),n*Math.pow(2,r)},float.hex=function(t){switch((t=float_value(t)).valueOf()){case 1/0:case-1/0:case Number.NaN:case-Number.NaN:return t;case-0:return"-0x0.0p0";case 0:return"0x0.0p0"}var e=_b_.$frexp(_b_.$fabs(t.valueOf())),n=e[0],r=e[1],i=1-Math.max(-1021-r,0);n=_b_.$ldexp(n,i),r-=i;var s="0123456789ABCDEF".split(""),o=s[Math.floor(n)];o+=".",n-=Math.floor(n);for(var a=0;a<13;a++)n*=16,o+=s[Math.floor(n)],n-=Math.floor(n);var l="+";return r<0&&(l="-",r=-r),t.value<0?"-0x"+o+"p"+l+r:"0x"+o+"p"+l+r},float.__init__=function(t,e){return _b_.None},float.__int__=function(t){return parseInt(t)},float.is_integer=function(t){return _b_.int.$factory(t)==t},float.__mod__=function(t,e){if(t=float_value(t),0==(e=float_value(e)))throw ZeroDivisionError.$factory("float modulo");if(isinstance(e,_b_.int))return new Number((t%e+e)%e);if(isinstance(e,float)){var n=Math.floor(t/e);return new Number(t-e*n)}if(isinstance(e,_b_.bool)){var r=0;return e.valueOf()&&(r=1),new Number((t%r+r)%r)}if(hasattr(e,"__rmod__"))return getattr(e,"__rmod__")(t);$err("%",e)},float.__mro__=[object],float.__mul__=function(t,e){if(t=float_value(t),e=float_value(e),isinstance(e,_b_.int))return e.__class__==$B.long_int?new Number(t*parseFloat(e.value)):new Number(t*e);if(isinstance(e,float))return new Number(t*float_value(e));if(isinstance(e,_b_.bool)){var n=0;return e.valueOf()&&(n=1),new Number(t*n)}return isinstance(e,_b_.complex)?$B.make_complex(float.$factory(t*e.$real),float.$factory(t*e.$imag)):hasattr(e,"__rmul__")?getattr(e,"__rmul__")(t):void $err("*",e)},float.__ne__=function(t,e){var n=float.__eq__(t,e);return n===_b_.NotImplemented?n:!n},float.__neg__=function(t,e){return float.$factory(-float_value(t))},float.__new__=function(t,e){if(void 0===t)throw _b_.TypeError.$factory("float.__new__(): not enough arguments");if(!_b_.isinstance(t,_b_.type))throw _b_.TypeError.$factory("float.__new__(X): X is not a type object");return t===float?float.$factory(e):{__class__:t,__dict__:$B.empty_dict(),$brython_value:e||0}},float.__pos__=function(t){return float_value(t)},float.__pow__=function(t,e){if(t=float_value(t),e=float_value(e),isinstance(e,_b_.int)||isinstance(e,float)){if(1==t)return t;if(0==e)return new Number(1);if(!(-1!=t||isFinite(e)&&e.__class__!==$B.long_int&&$B.is_safe_int(e)||isNaN(e)))return new Number(1);if(0==t&&isFinite(e)&&e<0)throw _b_.ZeroDivisionError.$factory("0.0 cannot be raised to a negative power");return t!=Number.NEGATIVE_INFINITY||isNaN(e)?t!=Number.POSITIVE_INFINITY||isNaN(e)?e!=Number.NEGATIVE_INFINITY||isNaN(t)?e!=Number.POSITIVE_INFINITY||isNaN(t)?t<0&&!_b_.getattr(e,"__eq__")(_b_.int.$factory(e))?_b_.complex.__pow__($B.make_complex(t,0),e):float.$factory(Math.pow(t,e)):Math.abs(t)<1?new Number(0):Number.POSITIVE_INFINITY:Math.abs(t)<1?Number.POSITIVE_INFINITY:new Number(0):e>0?t:new Number(0):e<0&&e%2==1?new Number(-0):e<0?new Number(0):e>0&&e%2==1?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY}if(isinstance(e,_b_.complex)){var n=Math.pow(t,e.$real),r=Math.log(t);return $B.make_complex(n*Math.cos(r),n*Math.sin(r))}if(hasattr(e,"__rpow__"))return getattr(e,"__rpow__")(t);$err("** or pow()",e)},float.__repr__=float.__str__=function(t){if((t=float_value(t)).valueOf()==1/0)return"inf";if(t.valueOf()==-1/0)return"-inf";if(isNaN(t.valueOf()))return"nan";var e,n,r=t.valueOf()+"";if(-1==r.indexOf(".")&&(r+=".0"),[e,n]=r.split("."),e.length>16){for(var i=e.length-1,s=e[0],o=e.substr(1)+n;o.endsWith("0");)o=o.substr(0,o.length-1);var a=s;return o.length>0&&(a+="."+o),a+"e+"+i}if("0"==e){for(i=0;i<n.length&&"0"==n.charAt(i);)i++;if(i>3){var l=n.substr(i);for(i=(i+1).toString();l.endsWith("0");)l=l.substr(0,r.length-1);return a=l[0],l.length>1&&(a+="."+l.substr(1)),1==i.length&&(i="0"+i),a+"e-"+i}}return _b_.str.$factory(r)},float.__setattr__=function(t,e,n){if(t.constructor===Number)throw void 0===float[e]?_b_.AttributeError.$factory("'float' object has no attribute '"+e+"'"):_b_.AttributeError.$factory("'float' object attribute '"+e+"' is read-only");return t[e]=n,_b_.None},float.__truediv__=function(t,e){if(t=float_value(t),e=float_value(e),isinstance(e,[_b_.int,float])){if(0==e.valueOf())throw ZeroDivisionError.$factory("division by zero");return float.$factory(t/e)}if(isinstance(e,_b_.complex)){var n=e.$real*e.$real+e.$imag*e.$imag;if(0==n)throw ZeroDivisionError.$factory("division by zero");return $B.make_complex(float.$factory(t*e.$real/n),float.$factory(-t*e.$imag/n))}if(hasattr(e,"__rtruediv__"))return getattr(e,"__rtruediv__")(t);$err("/",e)};var $op_func=function(t,e){if(t=float_value(t),e=float_value(e),isinstance(e,_b_.int))return"boolean"==typeof e?e?t-1:t:e.__class__===$B.long_int?float.$factory(t-parseInt(e.value)):float.$factory(t-e);if(isinstance(e,float))return float.$factory(t-e);if(isinstance(e,_b_.bool)){var n=0;return e.valueOf()&&(n=1),float.$factory(t-n)}return isinstance(e,_b_.complex)?$B.make_complex(t-e.$real,-e.$imag):hasattr(e,"__rsub__")?getattr(e,"__rsub__")(t):void $err("-",e)};$op_func+="";var $ops={"+":"add","-":"sub"};for(var $op in $ops){var $opf=$op_func.replace(/-/gm,$op);$opf=$opf.replace(/__rsub__/gm,"__r"+$ops[$op]+"__"),eval("float.__"+$ops[$op]+"__ = "+$opf)}var $comp_func=function(t,e){if(t=float_value(t),e=float_value(e),isinstance(e,_b_.int))return e.__class__===$B.long_int?t>parseInt(e.value):t>e.valueOf();if(isinstance(e,float))return t>e;if(isinstance(e,_b_.bool))return t.valueOf()>_b_.bool.__hash__(e);if(hasattr(e,"__int__")||hasattr(e,"__index__"))return _b_.int.__gt__(t,$B.$GetInt(e));var n=getattr(e,"__le__",None);if(n!==None)return n(t);throw _b_.TypeError.$factory("unorderable types: float() > "+$B.class_name(e)+"()")};for(var $op in $comp_func+="",$B.$comps)eval("float.__"+$B.$comps[$op]+"__ = "+$comp_func.replace(/>/gm,$op).replace(/__gt__/gm,"__"+$B.$comps[$op]+"__").replace(/__le__/,"__"+$B.$inv_comps[$op]+"__"));$B.make_rmethods(float);var $notimplemented=function(t,e){throw _b_.TypeError.$factory("unsupported operand types for OPERATOR: 'float' and '"+$B.class_name(e)+"'")};for(var $op in $notimplemented+="",$B.$operators)if(void 0===$B.augmented_assigns[$op]){var $opfunc="__"+$B.$operators[$op]+"__";void 0===float[$opfunc]&&eval("float."+$opfunc+"="+$notimplemented.replace(/OPERATOR/gm,$op))}function $FloatClass(t){return new Number(t)}function to_digits(t){for(var e="",n=0;n<t.length;n++){var r="".indexOf(t[n]);e+=r>-1?r:t[n]}return e}float.$factory=function(value){switch(value){case void 0:return $FloatClass(0);case Number.MAX_VALUE:return $FloatClass(1/0);case-Number.MAX_VALUE:return $FloatClass(-1/0);case!0:return new Number(1);case!1:return new Number(0)}if("number"==typeof value)return new Number(value);if(isinstance(value,float))return float_value(value);if(isinstance(value,bytes)){var s=getattr(value,"decode")("latin-1");return float.$factory(getattr(value,"decode")("latin-1"))}if("string"==typeof value)switch(value=value.trim(),value.toLowerCase()){case"+inf":case"inf":case"+infinity":case"infinity":return Number.POSITIVE_INFINITY;case"-inf":case"-infinity":return Number.NEGATIVE_INFINITY;case"+nan":case"nan":return Number.NaN;case"-nan":return-Number.NaN;case"":throw _b_.ValueError.$factory("count not convert string to float");default:if(value=value.charAt(0)+value.substr(1).replace(/_/g,""),value=to_digits(value),isFinite(value))return $FloatClass(eval(value));throw _b_.str.encode(value,"latin-1"),_b_.ValueError.$factory("Could not convert to float(): '"+_b_.str.$factory(value)+"'")}var klass=value.__class__||$B.get_class(value),num_value=$B.to_num(value,["__float__","__index__"]);if(null!==num_value)return num_value;throw _b_.TypeError.$factory("float() argument must be a string or a number, not '"+$B.class_name(value)+"'")},$B.$FloatClass=$FloatClass,$B.set_func_names(float,"builtins");var FloatSubclass=$B.FloatSubclass={__class__:_b_.type,__mro__:[object],$infos:{__module__:"builtins",__name__:"float"},$is_class:!0};for(var $attr in float)"function"==typeof float[$attr]&&(FloatSubclass[$attr]=function(t){return function(){var e=[],n=0;if(arguments.length>0){e=[arguments[0].valueOf()],n=1;for(var r=1,i=arguments.length;r<i;r++)e[n++]=arguments[r]}return float[t].apply(null,e)}}($attr));$B.set_func_names(FloatSubclass,"builtins"),_b_.float=float}(__BRYTHON__),function($B){var _b_=$B.builtins;function $err(t,e){var n="unsupported operand type(s) for "+t+" : 'int' and '"+$B.class_name(e)+"'";throw _b_.TypeError.$factory(n)}function int_value(t){return void 0!==t.$brython_value?t.$brython_value:t}var int={__class__:_b_.type,__dir__:_b_.object.__dir__,$infos:{__module__:"builtins",__name__:"int"},$is_class:!0,$native:!0,$descriptors:{numerator:!0,denominator:!0,imag:!0,real:!0}};function preformat(t,e){if(e.empty)return _b_.str.$factory(t);if(e.type&&-1=="bcdoxXn".indexOf(e.type))throw _b_.ValueError.$factory("Unknown format code '"+e.type+"' for object of type 'int'");var n;switch(e.type){case void 0:case"d":n=t.toString();break;case"b":n=(e.alternate?"0b":"")+t.toString(2);break;case"c":n=_b_.chr(t);break;case"o":n=(e.alternate?"0o":"")+t.toString(8);break;case"x":n=(e.alternate?"0x":"")+t.toString(16);break;case"X":n=(e.alternate?"0X":"")+t.toString(16).toUpperCase();break;case"n":return t}return void 0!==e.sign&&(" "==e.sign||"+"==e.sign)&&t>=0&&(n=e.sign+n),n}function extended_euclidean(t,e){var n,r,i;return 0==e?[t,1,0]:([n,r,i]=extended_euclidean(e,t%e),[n,i,r-Math.floor(t/e)*i])}int.as_integer_ratio=function(){var t=$B.args("as_integer_ratio",1,{self:null},["self"],arguments,{},null,null);return $B.$list([t.self,1])},int.from_bytes=function(){var t,e,n=$B.args("from_bytes",3,{bytes:null,byteorder:null,signed:null},["bytes","byteorder","signed"],arguments,{signed:!1},null,null),r=n.bytes,i=n.byteorder,s=n.signed;if(_b_.isinstance(r,[_b_.bytes,_b_.bytearray]))t=r.source,e=r.source.length;else{e=(t=_b_.list.$factory(r)).length;for(var o=0;o<e;o++)_b_.bytes.$factory([t[o]])}switch(i){case"big":var a=t[e-1],l=256;for(o=e-2;o>=0;o--)a=$B.add($B.mul(l,t[o]),a),l=$B.mul(l,256);return s?t[0]<128?a:$B.sub(a,l):a;case"little":for((a=t[0])>=128&&(a-=256),l=256,o=1;o<e;o++)a=$B.add($B.mul(l,t[o]),a),l=$B.mul(l,256);return s?t[e-1]<128?a:$B.sub(a,l):a}throw _b_.ValueError.$factory("byteorder must be either 'little' or 'big'")},int.to_bytes=function(){var t=$B.args("to_bytes",3,{self:null,len:null,byteorder:null},["self","len","byteorder"],arguments,{},"args","kw"),e=t.self,n=t.len,r=t.byteorder,i=t.kw;if(!_b_.isinstance(n,_b_.int))throw _b_.TypeError.$factory("integer argument expected, got "+$B.class_name(n));if(-1==["little","big"].indexOf(r))throw _b_.ValueError.$factory("byteorder must be either 'little' or 'big'");var s=i.$string_dict.signed||!1,o=[];if(e<0){if(!s)throw _b_.OverflowError.$factory("can't convert negative int to unsigned");e=Math.pow(256,n)+e}for(var a=e;;){var l=Math.floor(a/256),c=a-256*l;if(o.push(c),0==l)break;a=l}if(o.length>n)throw _b_.OverflowError.$factory("int too big to convert");for(;o.length<n;)o=o.concat([0]);return"big"==r&&(o=o.reverse()),{__class__:_b_.bytes,source:o}},int.__abs__=function(t){return _b_.abs(t)},int.__bool__=function(t){return 0!=int_value(t).valueOf()},int.__ceil__=function(t){return Math.ceil(int_value(t))},int.__divmod__=function(t,e){return $B.fast_tuple([int.__floordiv__(t,e),int.__mod__(t,e)])},int.__eq__=function(t,e){return void 0===e?t===int:_b_.isinstance(e,int)?t.valueOf()==int_value(e).valueOf():_b_.isinstance(e,_b_.float)?t.valueOf()==e.valueOf():_b_.isinstance(e,_b_.complex)?0!=e.$imag?False:t.valueOf()==e.$real:_b_.NotImplemented},int.__float__=function(t){return new Number(t)},int.__format__=function(t,e){var n=new $B.parse_format_spec(e);if(n.type&&-1!="eEfFgG%".indexOf(n.type))return _b_.float.__format__(t,e);n.align=n.align||">";var r=preformat(t,n);if(n.comma){for(var i="-"==r[0]?"-":"",s=r.substr(i.length),o=s.length,a=Math.ceil(s.length/3),l=[],c=0;c<a;c++)l.push(s.substring(o-3*c-3,o-3*c));l.reverse(),r=i+l.join(",")}return $B.format_width(r,n)},int.__floordiv__=function(t,e){if(e.__class__===$B.long_int)return $B.long_int.__floordiv__($B.long_int.$factory(t),e);if(_b_.isinstance(e,int)){if(0==(e=int_value(e)))throw _b_.ZeroDivisionError.$factory("division by zero");return Math.floor(t/e)}if(_b_.isinstance(e,_b_.float)){if(!e.valueOf())throw _b_.ZeroDivisionError.$factory("division by zero");return Math.floor(t/e)}if(_b_.hasattr(e,"__rfloordiv__"))return $B.$getattr(e,"__rfloordiv__")(t);$err("//",e)},int.__hash__=function(t){return void 0===t?int.__hashvalue__||$B.$py_next_hash--:t.valueOf()},int.__index__=function(t){return int_value(t)},int.__init__=function(t,e){return void 0===e&&(e=0),t.toString=function(){return e},_b_.None},int.__int__=function(t){return t},int.__invert__=function(t){return~t},int.__lshift__=function(t,e){if(_b_.isinstance(e,int))return e=int_value(e),int.$factory($B.long_int.__lshift__($B.long_int.$factory(t),$B.long_int.$factory(e)));var n=$B.$getattr(e,"__rlshift__",_b_.None);if(n!==_b_.None)return n(t);$err("<<",e)},int.__mod__=function(t,e){if(_b_.isinstance(e,_b_.tuple)&&1==e.length&&(e=e[0]),e.__class__===$B.long_int)return $B.long_int.__mod__($B.long_int.$factory(t),e);if(_b_.isinstance(e,[int,_b_.float,bool])){if(!1===(e=int_value(e))?e=0:!0===e&&(e=1),0==e)throw _b_.ZeroDivisionError.$factory("integer division or modulo by zero");return(t%e+e)%e}if(_b_.hasattr(e,"__rmod__"))return $B.$getattr(e,"__rmod__")(t);$err("%",e)},int.__mro__=[_b_.object],int.__mul__=function(t,e){var n=t.valueOf();if("string"==typeof e)return e.repeat(n);if(_b_.isinstance(e,int))return(r=t*(e=int_value(e)))>$B.min_int&&r<$B.max_int?r:int.$factory($B.long_int.__mul__($B.long_int.$factory(t),$B.long_int.$factory(e)));if(_b_.isinstance(e,_b_.float))return new Number(t*e);if(_b_.isinstance(e,_b_.bool))return e.valueOf()?t:int.$factory(0);if(_b_.isinstance(e,_b_.complex))return $B.make_complex(int.__mul__(t,e.$real),int.__mul__(t,e.$imag));if(_b_.isinstance(e,[_b_.list,_b_.tuple])){for(var r=[],i=e.slice(0,e.length),s=0;s<n;s++)r=r.concat(i);return _b_.isinstance(e,_b_.tuple)&&(r=_b_.tuple.$factory(r)),r}if(_b_.hasattr(e,"__rmul__"))return $B.$getattr(e,"__rmul__")(t);$err("*",e)},int.__ne__=function(t,e){var n=int.__eq__(t,e);return n===_b_.NotImplemented?n:!n},int.__neg__=function(t){return-t},int.__new__=function(t,e){if(void 0===t)throw _b_.TypeError.$factory("int.__new__(): not enough arguments");if(!_b_.isinstance(t,_b_.type))throw _b_.TypeError.$factory("int.__new__(X): X is not a type object");return t===int?int.$factory(e):{__class__:t,__dict__:$B.empty_dict(),$brython_value:e||0}},int.__pos__=function(t){return t},$B.use_bigint=0,int.__pow__=function(t,e,n){if("number"==typeof e||_b_.isinstance(e,int)){switch((e=int_value(e)).valueOf()){case 0:return int.$factory(1);case 1:return int.$factory(t.valueOf())}if(void 0!==n&&n!==_b_.None){if(1==n)return 0;var r=1,i=t%n,s=e,o=$B.long_int;if(s<0){var a,l,c;if([a,l,c]=extended_euclidean(t,n),1!==a)throw _b_.ValueError.$factory("not relative primes: "+t+" and "+n);return int.__pow__(l,-s,n)}for(;s>0;)s%2==1&&(r*i>$B.max_int?(r=o.__mul__(o.$factory(r),o.$factory(i)),r=o.__mod__(r,n)):r=r*i%n),s>>=1,i*i>$B.max_int?(i=o.__mul__(o.$factory(i),o.$factory(i)),i=o.__mod__(i,n)):i=i*i%n;return r}var u=Math.pow(t.valueOf(),e.valueOf());return u>$B.min_int&&u<$B.max_int?u:u===1/0||isFinite(u)?$B.BigInt?($B.use_bigint++,{__class__:$B.long_int,value:($B.BigInt(t)**$B.BigInt(e)).toString(),pos:!0}):$B.long_int.__pow__($B.long_int.$from_int(t),$B.long_int.$from_int(e)):u}if(_b_.isinstance(e,_b_.float))return t>=0?new Number(Math.pow(t,e.valueOf())):_b_.complex.__pow__($B.make_complex(t,0),e);if(_b_.isinstance(e,_b_.complex)){var h=Math.pow(t,e.$real),p=Math.log(t);return $B.make_complex(h*Math.cos(p),h*Math.sin(p))}var d=$B.$getattr(e,"__rpow__",_b_.None);if(d!==_b_.None)return d(t);$err("**",e)},int.__repr__=function(t){return t===int?"<class 'int'>":t.toString()},int.__rshift__=function(t,e){if(_b_.isinstance(e,int))return e=int_value(e),int.$factory($B.long_int.__rshift__($B.long_int.$factory(t),$B.long_int.$factory(e)));var n=$B.$getattr(e,"__rrshift__",_b_.None);if(n!==_b_.None)return n(t);$err(">>",e)},int.__setattr__=function(t,e,n){if("number"==typeof t)throw void 0===int.$factory[e]?_b_.AttributeError.$factory("'int' object has no attribute '"+e+"'"):_b_.AttributeError.$factory("'int' object attribute '"+e+"' is read-only");return _b_.dict.$setitem(t.__dict__,e,n),_b_.None},int.__str__=int.__repr__,int.__truediv__=function(t,e){if(_b_.isinstance(e,int)){if(0==(e=int_value(e)))throw _b_.ZeroDivisionError.$factory("division by zero");return e.__class__===$B.long_int?new Number(t/parseInt(e.value)):new Number(t/e)}if(_b_.isinstance(e,_b_.float)){if(!e.valueOf())throw _b_.ZeroDivisionError.$factory("division by zero");return new Number(t/e)}if(_b_.isinstance(e,_b_.complex)){var n=e.$real*e.$real+e.$imag*e.$imag;if(0==n)throw _b_.ZeroDivisionError.$factory("division by zero");return $B.make_complex(t*e.$real/n,-t*e.$imag/n)}if(_b_.hasattr(e,"__rtruediv__"))return $B.$getattr(e,"__rtruediv__")(t);$err("/",e)},int.bit_length=function(t){return s=_b_.bin(t),s=$B.$getattr(s,"lstrip")("-0b"),s.length},int.numerator=function(t){return t},int.denominator=function(t){return int.$factory(1)},int.imag=function(t){return int.$factory(0)},int.real=function(t){return t},$B.max_int32=2147483647,$B.min_int32=-$B.max_int32;var $op_func=function(t,e){if(_b_.isinstance(e,int))return e.__class__===$B.long_int?$B.long_int.__sub__($B.long_int.$factory(t),$B.long_int.$factory(e)):(e=int_value(e),t>$B.max_int32||t<$B.min_int32||e>$B.max_int32||e<$B.min_int32?$B.long_int.__sub__($B.long_int.$factory(t),$B.long_int.$factory(e)):t-e);if(_b_.isinstance(e,_b_.bool))return t-e;var n=$B.$getattr(e,"__rsub__",_b_.None);if(n!==_b_.None)return n(t);$err("-",e)};$op_func+="";var $ops={"&":"and","|":"or","^":"xor"};for(var $op in $ops){var opf=$op_func.replace(/-/gm,$op);opf=opf.replace(new RegExp("sub","gm"),$ops[$op]),eval("int.__"+$ops[$op]+"__ = "+opf)}var $op_func=function(t,e){if(_b_.isinstance(e,int)){if("number"==typeof(e=int_value(e))){var n=t.valueOf()-e.valueOf();return n>$B.min_int&&n<$B.max_int?n:$B.long_int.__sub__($B.long_int.$factory(t),$B.long_int.$factory(e))}return"boolean"==typeof e?e?t-1:t:$B.long_int.__sub__($B.long_int.$factory(t),$B.long_int.$factory(e))}if(_b_.isinstance(e,_b_.float))return new Number(t-e);if(_b_.isinstance(e,_b_.complex))return $B.make_complex(t-e.$real,-e.$imag);if(_b_.isinstance(e,_b_.bool)){var r=0;return e.valueOf()&&(r=1),t-r}if(_b_.isinstance(e,_b_.complex))return $B.make_complex(t.valueOf()-e.$real,e.$imag);var i=$B.$getattr(e,"__rsub__",_b_.None);if(i!==_b_.None)return i(t);throw console.log("err",t,e),console.log($B.frames_stack.slice()),$err("-",e)};$op_func+="";var $ops={"+":"add","-":"sub"};for(var $op in $ops){var opf=$op_func.replace(/-/gm,$op);opf=opf.replace(new RegExp("sub","gm"),$ops[$op]),eval("int.__"+$ops[$op]+"__ = "+opf)}var $comp_func=function(t,e){return e.__class__===$B.long_int?$B.long_int.__lt__(e,$B.long_int.$factory(t)):_b_.isinstance(e,int)?(e=int_value(e),t.valueOf()>e.valueOf()):_b_.isinstance(e,_b_.float)?t.valueOf()>e.valueOf():_b_.isinstance(e,_b_.bool)?t.valueOf()>_b_.bool.__hash__(e):_b_.hasattr(e,"__int__")||_b_.hasattr(e,"__index__")?int.__gt__(t,$B.$GetInt(e)):_b_.NotImplemented};for(var $op in $comp_func+="",$B.$comps)eval("int.__"+$B.$comps[$op]+"__ = "+$comp_func.replace(/>/gm,$op).replace(/__gt__/gm,"__"+$B.$comps[$op]+"__").replace(/__lt__/,"__"+$B.$inv_comps[$op]+"__"));$B.make_rmethods(int);var $valid_digits=function(t){var e="";if(0===t)return"0";if(t<10){for(var n=0;n<t;n++)e+=String.fromCharCode(n+48);return e}for(e="0123456789",n=10;n<t;n++)e+=String.fromCharCode(n+55);return e};int.$factory=function(t,e){if(void 0===t)return 0;if("number"==typeof t&&(void 0===e||10==e))return parseInt(t);if(_b_.isinstance(t,_b_.complex))throw _b_.TypeError.$factory("can't convert complex to int");var n=$B.args("int",2,{x:null,base:null},["x","base"],arguments,{base:10},null,null);if(t=n.x,e=n.base,_b_.isinstance(t,_b_.float)&&10==e)return(t=_b_.float.numerator(t))<$B.min_int||t>$B.max_int?$B.long_int.$from_float(t):t>0?Math.floor(t):Math.ceil(t);if(!(e>=2&&e<=36)&&0!=e)throw _b_.ValueError.$factory("invalid base");if("number"==typeof t){if(10==e)return t<$B.min_int||t>$B.max_int?$B.long_int.$factory(t):t;if(t.toString().search("e")>-1)throw _b_.OverflowError.$factory("can't convert to base "+e);var r=parseInt(t,e);return t<$B.min_int||t>$B.max_int?$B.long_int.$factory(t,e):r}if(!0===t)return Number(1);if(!1===t)return Number(0);if(t.__class__===$B.long_int){var i=parseInt(t.value);return i>$B.min_int&&i<$B.max_int?i:t}function s(t,e){throw _b_.ValueError.$factory("invalid literal for int() with base "+e+": '"+_b_.str.$factory(t)+"'")}if(e=$B.$GetInt(e),_b_.isinstance(t,_b_.str)&&(t=t.valueOf()),"string"==typeof t){var o=t.trim();if(2==o.length&&0==e&&("0b"==o||"0o"==o||"0x"==o))throw _b_.ValueError.$factory("invalid value");if(o.length>2){var a=o.substr(0,2).toUpperCase();if(0==e?("0B"==a&&(e=2),"0O"==a&&(e=8),"0X"==a&&(e=16)):("0X"==a&&16!=e||"0O"==a&&8!=e)&&s(o,e),"0B"==a&&2==e||"0O"==a||"0X"==a)for(o=o.substr(2);o.startsWith("_");)o=o.substr(1)}else 0==e&&(e=10);var l=$valid_digits(e);return null===new RegExp("^[+-]?["+l+"]["+l+"_]*$","i").exec(o)?s(t,e):t=o.replace(/_/g,""),e<=10&&!isFinite(t)&&s(o,e),(r=parseInt(t,e))<$B.min_int||r>$B.max_int?$B.long_int.$factory(t,e):r}if(_b_.isinstance(t,[_b_.bytes,_b_.bytearray]))return int.$factory($B.$getattr(t,"decode")("latin-1"),e);var c=$B.to_num(t,["__int__","__index__","__trunc__"]);if(null===c)throw _b_.TypeError.$factory("int() argument must be a string, a bytes-like object or a number, not '"+$B.class_name(t)+"'");return c},$B.set_func_names(int,"builtins"),_b_.int=int,$B.$bool=function(t){if(null==t)return!1;switch(typeof t){case"boolean":return t;case"number":case"string":return!!t;default:if(t.$is_class)return!0;var e=t.__class__||$B.get_class(t),n={},r=$B.$getattr(e,"__bool__",n);if(r!==n){var i=$B.$call(r)(t);if(!0!==i&&!1!==i)throw _b_.TypeError.$factory("__bool__ should return bool, returned "+$B.class_name(i));return i}try{return _b_.len(t)>0}catch(t){return!0}}};var bool={__bases__:[int],__class__:_b_.type,__mro__:[int,_b_.object],$infos:{__name__:"bool",__module__:"builtins"},$is_class:!0,$native:!0},methods=$B.op2method.subset("operations","binary","comparisons","boolean");for(var op in methods){var method="__"+methods[op]+"__";bool[method]=function(t){return function(e,n){var r=e?1:0;if(void 0!==int[t])return int[t](r,n)}}(method)}bool.__and__=function(t,e){return _b_.isinstance(e,bool)?t&&e:_b_.isinstance(e,int)?int.__and__(bool.__index__(t),int.__index__(e)):_b_.NotImplemented},bool.__hash__=bool.__index__=bool.__int__=function(t){return t.valueOf()?1:0},bool.__neg__=function(t){return-$B.int_or_bool(t)},bool.__or__=function(t,e){return _b_.isinstance(e,bool)?t||e:_b_.isinstance(e,int)?int.__or__(bool.__index__(t),int.__index__(e)):_b_.NotImplemented},bool.__pos__=$B.int_or_bool,bool.__repr__=bool.__str__=function(t){return t?"True":"False"},bool.__setattr__=function(t,e){if(_b_.dir(t).indexOf(e)>-1)var n="attribute '"+e+"' of 'int' objects is not writable";else n="'bool' object has no attribute '"+e+"'";throw _b_.AttributeError.$factory(n)},bool.__xor__=function(t,e){return _b_.isinstance(e,bool)?!!(t^e):_b_.isinstance(e,int)?int.__xor__(bool.__index__(t),int.__index__(e)):_b_.NotImplemented},bool.$factory=function(){var t=$B.args("bool",1,{x:null},["x"],arguments,{x:!1},null,null);return $B.$bool(t.x)},_b_.bool=bool,$B.set_func_names(bool,"builtins")}(__BRYTHON__),function($B){var bltns=$B.InjectBuiltins();eval(bltns);try{eval("window")}catch(t){window=self}var long_int={__class__:_b_.type,__mro__:[int,object],$infos:{__module__:"builtins",__name__:"int"},$is_class:!0,$native:!0,$descriptors:{numerator:!0,denominator:!0,imag:!0,real:!0}};function add_pos(t,e){if(window.BigInt)return{__class__:long_int,value:(BigInt(t)+BigInt(e)).toString(),pos:!0};for(var n,r="",i=0,s=t.length,o=e.length-1;o>=0;o--)2==(n=(i+(--s<0?0:parseInt(t.charAt(s)))+parseInt(e.charAt(o))).toString()).length?(r=n.charAt(1)+r,i=parseInt(n.charAt(0))):(r=n+r,i=0);for(;s>0;)s--,2==(n=(i+parseInt(t.charAt(s))).toString()).length?(r=n.charAt(1)+r,i=parseInt(n.charAt(0))):(r=n+r,i=0);return i&&(r=i+r),{__class__:long_int,value:r,pos:!0}}var len=(Math.pow(2,53)-1+"").length-1;function binary_pos(t){for(var e,n,r,i,s=Math.ceil(t.length/len),o=[],a=[],l=0;l<s;l++)r=(e=t.length-(l+1)*len)-(n=Math.max(0,e)),o.push(t.substr(n,len+r));(o=o.reverse()).forEach((function(t,e){o[e]=parseInt(t)}));for(var c=Math.pow(10,15);o[o.length-1]>0;)o.forEach((function(t,e){i=t%2,o[e]=Math.floor(t/2),i&&e<o.length-1&&(o[e+1]+=c)})),a.push(i),0==o[0]&&o.shift();return a.reverse().join("")}function binary(t){var e=binary_pos(t.value);if(t.pos)return e;for(var n="",r=0,i=e.length;r<i;r++)n+="0"==e.charAt(r)?"1":"0";var s=add_pos(n,"1").value;return n.substr(0,n.length-s.length)+s}function check_shift(t){if(!isinstance(t,long_int))throw TypeError.$factory("shift must be int, not '"+$B.class_name(t)+"'");if(!t.pos)throw ValueError.$factory("negative shift count")}function clone(t){var e={};for(var n in t)e[n]=t[n];return e}function comp_pos(t,e){return t.length>e.length?1:t.length<e.length?-1:t>e?1:t<e?-1:0}function divmod_by_safe_int(t,e){if(1==e)return[t,0];for(var n,r,i,s=(Math.floor((Math.pow(2,53)-1)/e)+"").length-1,o=Math.ceil(t.length/s),a=[],l=0;l<o;l++)i=(n=t.length-(l+1)*s)-(r=Math.max(0,n)),a.push(t.substr(r,s+i));(a=a.reverse()).forEach((function(t,e){a[e]=parseInt(t)}));var c,u,h=Math.pow(10,s);for(a.forEach((function(t,n){c=t%e,a[n]=Math.floor(t/e),n<a.length-1&&(a[n+1]+=h*c)}));0==a[0];)if(a.shift(),0==a.length)return[0,c];return u=a[0]+"",a.forEach((function(t,e){e>0&&(u+="0".repeat(s-t.toString().length)+t)})),[u,c]}function divmod_pos(t,e){if(window.BigInt)return[{__class__:long_int,value:(BigInt(t)/BigInt(e)).toString(),pos:!0},{__class__:long_int,value:(BigInt(t)%BigInt(e)).toString(),pos:!0}];var n,r=parseInt(t),i=parseInt(e);if(r<$B.max_int&&i<$B.max_int){var s=r%i,o=Math.floor(r/i).toString();return[{__class__:long_int,value:o.toString(),pos:!0},{__class__:long_int,value:s.toString(),pos:!0}]}if(i<$B.max_int){var a=divmod_by_safe_int(t,i);return[long_int.$factory(a[0]),long_int.$factory(a[1])]}if(-1==comp_pos(t,e))l="0",n=long_int.$factory(t);else if(e==t)l="1",n=long_int.$factory("0");else{var l="",c=t.substr(0,e.length);t<e&&(c=t.substr(0,e.length+1));for(var u=t.substr(c.length),h={};;){var p=Math.floor(parseInt(c)/parseInt(e))+"";if("10"==p&&(p="9"),void 0===h[p]&&(h[p]=mul_pos(e,p).value),-1==comp_pos(c,h[p])&&void 0===h[--p]&&(h[p]=mul_pos(e,p).value),l+=p,c=sub_pos(c,h[p]).value,0==u.length)break;c+=u.charAt(0),u=u.substr(1)}n=sub_pos(t,mul_pos(l,e).value)}return[long_int.$factory(l),n]}function split_chunks(t,e){for(var n=Math.ceil(t.length/e),r=[],i=t.length,s=0;s<n;s++){var o=i-e*(s+1);o<0&&(e+=o,o=0),r.push(parseInt(t.substr(o,e)))}return r}function mul_pos(t,e){if(window.BigInt)return{__class__:long_int,value:(BigInt(t)*BigInt(e)).toString(),pos:!0};var n,r=parseInt(t)*parseInt(e);if(r<$B.max_int)return{__class__:long_int,value:r.toString(),pos:!0};for(var i=split_chunks(t,6),s=split_chunks(e,6),o={},a=i.length+s.length,l=0;l<a-1;l++)o[l]=0;for(l=0;l<i.length;l++)for(var c=0;c<s.length;c++)o[l+c]+=i[l]*s[c];for(l=0;l<a-1;l++){var u=split_chunks(o[l].toString(),6);for(c=1;c<u.length;c++)void 0===o[n=l+c]?o[n]=parseInt(u[c]):o[n]+=parseInt(u[c]);o[l]=u[0]}var h,p="";for(l=0;void 0!==o[l];)h=o[l].toString(),void 0!==o[l+1]&&(h="0".repeat(6-h.length)+h),p=h+p,l++;try{return long_int.$factory(p)}catch(n){throw console.log(t,e,o,p),n}}function sub_pos(t,e){if(window.BigInt)return{__class__:long_int,value:(BigInt(t)-BigInt(e)).toString(),pos:!0};for(var n,r="",i=0,s=t.length,o=0,a=e.length-1;a>=0;a--)s--,n=(o=parseInt(t.charAt(s)))-i-parseInt(e.charAt(a)),isNaN(n)&&console.log("x is NaN",t.length,e.length,a,s,o,i,a,e.charAt(a)),n<0?(r=10+n+r,i=1):(r=n+r,i=0);for(r.startsWith("NaN")&&alert(r);s>0;)s--,(n=parseInt(t.charAt(s))-i)<0?(r=10+n+r,i=1):(r=n+r,i=0);for(;"0"==r.charAt(0)&&r.length>1;)r=r.substr(1);return r.startsWith("NaN")&&console.log("hoho !!",t,e,t>=e,r),{__class__:long_int,value:r,pos:!0}}function to_BigInt(t){var e=$B.BigInt(t.value);return t.pos?e:-e}function from_BigInt(t){var e=t>=0;return t=(t=(t=t.toString()).endsWith("n")?t.substr(0,t.length-1):t).startsWith("-")?t.substr(1):t,intOrLong({__class__:long_int,value:t,pos:e})}function digits(t){for(var e={},n=0;n<t&&10!=n;n++)e[n]=!0;if(t>10)for(n=0;n<t-10;n++)e[String.fromCharCode(65+n)]=!0,e[String.fromCharCode(97+n)]=!0;return e}long_int.$from_float=function(t){var e=Math.abs(t).toString(),n=e;if(e.search("e")>-1){var r=/-?(\d)(\.\d+)?e([+-])(\d*)/.exec(e),i=r[1],s=r[2],o=r[3],a=r[4];"+"==o&&(n=void 0===s?i+"0".repeat(a-1):i+s+"0".repeat(a-1-s.length))}return{__class__:long_int,value:n,pos:t>=0}},long_int.__abs__=function(t){return{__class__:long_int,value:t.value,pos:!0}},long_int.__add__=function(t,e){if(isinstance(e,_b_.float))return _b_.float.$factory(parseInt(t.value)+e.value);if("number"==typeof e)e=long_int.$factory(_b_.str.$factory(e));else if(e.__class__!==long_int)if(isinstance(e,_b_.bool))e=long_int.$factory(e?1:0);else{if(!isinstance(e,int))return _b_.NotImplemented;e=long_int.$factory(_b_.str.$factory(_b_.int.__index__(e)))}var n;if($B.BigInt,t.pos&&e.pos)return add_pos(t.value,e.value);if(t.pos||e.pos){if(t.pos&&!e.pos){switch(comp_pos(t.value,e.value)){case 1:n=sub_pos(t.value,e.value);break;case 0:n={__class__:long_int,value:0,pos:!0};break;case-1:(n=sub_pos(e.value,t.value)).pos=!1}return intOrLong(n)}switch(comp_pos(t.value,e.value)){case 1:(n=sub_pos(t.value,e.value)).pos=!1;break;case 0:n={__class__:long_int,value:0,pos:!0};break;case-1:n=sub_pos(e.value,t.value)}return intOrLong(n)}return(n=add_pos(t.value,e.value)).pos=!1,intOrLong(n)},long_int.__and__=function(t,e){if("number"==typeof e&&(e=long_int.$factory(_b_.str.$factory(e))),$B.BigInt)return from_BigInt(to_BigInt(t)&to_BigInt(e));t.value,e.value;var n="",r=!t.pos&&!e.pos;r&&(t=long_int.__neg__(t),e=long_int.__neg__(e));var i,s,o=binary(t),a=o.length,l=binary(e),c=l.length,u=1;for(n="";!(u>a&&u>c);)i=u>a?t.pos?"0":"1":o.charAt(a-u),s=u>c?e.pos?"0":"1":l.charAt(c-u),n="1"==i&&"1"==s?"1"+n:"0"+n,u++;for(;"0"==n.charAt(0);)n=n.substr(1);return n=$B.long_int.$factory(n,2),r&&(n.pos=!1),intOrLong(n)},long_int.__divmod__=function(t,e){"number"==typeof e&&(e=long_int.$factory(_b_.str.$factory(e)));var n=divmod_pos(t.value,e.value);return t.pos!==e.pos&&("0"!=n[0].value&&(n[0].pos=!1),"0"!=n[1].value&&(n[0]=long_int.__sub__(n[0],long_int.$factory("1")),n[1]=long_int.__sub__(t,long_int.__mul__(e,long_int.$factory(n[0]))))),$B.fast_tuple([intOrLong(n[0]),intOrLong(n[1])])},long_int.__eq__=function(t,e){return"number"==typeof e&&(e=long_int.$factory(_b_.str.$factory(e))),t.value==e.value&&t.pos==e.pos},long_int.__float__=function(t){return new Number(parseFloat(t.value))},long_int.__floordiv__=function(t,e){if(isinstance(e,_b_.float))return _b_.float.$factory(parseInt(t.value)/e);if("number"==typeof e){var n=divmod_by_safe_int(t.value,e),r=e>0?t.pos:!t.pos;return{__class__:long_int,value:n[0],pos:r}}return intOrLong(long_int.__divmod__(t,e)[0])},long_int.__ge__=function(t,e){return"number"==typeof e&&(e=long_int.$factory(_b_.str.$factory(e))),t.pos!=e.pos?!e.pos:t.value.length>e.value.length?t.pos:t.value.length<e.value.length?!t.pos:t.pos?t.value>=e.value:t.value<=e.value},long_int.__gt__=function(t,e){return!long_int.__le__(t,e)},long_int.__index__=function(t){for(var e,n="",r=t.value;n=(e=divmod_pos(r,"2"))[1].value+n,"0"!=(r=e[0].value););if(t.pos)n="0"+n;else{for(var i="",s=!1,o=n.length-1;o>=0;o--)"0"==n.charAt(o)?i=s?"1"+i:"0"+i:s?i="0"+i:(s=!0,i="1"+i);n=i="1"+i}return intOrLong(n)},long_int.__invert__=function(t){return long_int.__sub__(long_int.$factory("-1"),t)},long_int.__le__=function(t,e){return"number"==typeof e&&(e=long_int.$factory(_b_.str.$factory(e))),t.pos!==e.pos||t.value.length>e.value.length?!t.pos:t.value.length<e.value.length?t.pos:t.pos?t.value<=e.value:t.value>=e.value},long_int.__lt__=function(t,e){return!long_int.__ge__(t,e)},long_int.__lshift__=function(t,e){if(window.BigInt)return e.__class__==long_int&&(e=e.value),intOrLong({__class__:long_int,value:(BigInt(t.value)<<BigInt(e)).toString(),pos:t.pos});var n;if(e.__class__===long_int){var r=parseInt(e.value);if(r<0)throw _b_.ValueError.$factory("negative shift count");r<$B.max_int&&(n=!0,e=r)}if(n){if(0==r)return t}else if("0"==(e=long_int.$factory(e)).value)return t;for(var i=t.value;;){for(var s,o=0,a="",l=i.length-1;l>=0;l--)2==(s=(o+2*parseInt(i.charAt(l))).toString()).length?(a=s.charAt(1)+a,o=parseInt(s.charAt(0))):(a=s+a,o=0);if(o&&(a=o+a),i=a,n){if(0==--e)break}else if("0"==(e=sub_pos(e.value,"1")).value)break}return intOrLong({__class__:long_int,value:i,pos:t.pos})},long_int.__mod__=function(t,e){return intOrLong(long_int.__divmod__(t,e)[1])},long_int.__mro__=[_b_.int,_b_.object],long_int.__mul__=function(t,e){switch(t){case Number.NEGATIVE_INFINITY:case Number.POSITIVE_INFINITY:return $B.rich_comp("__eq__",e,0)?NaN:_b_.getattr(e,"__gt__")(0)?t:-t}if(isinstance(e,_b_.float))return _b_.float.$factory(parseInt(t.value)*e);if("number"==typeof e&&(e=long_int.$factory(e)),other_value=e.value,other_pos=e.pos,e.__class__!==long_int&&isinstance(e,int)){var n=int.__index__(e);other_value=_b_.str.$factory(n),other_pos=n>0}if($B.BigInt)return from_BigInt(to_BigInt(t)*to_BigInt(e));var r=mul_pos(t.value,other_value);return t.pos==other_pos||(r.pos=!1),intOrLong(r)},long_int.__neg__=function(t){return{__class__:long_int,value:t.value,pos:!t.pos}},long_int.__or__=function(t,e){e=long_int.$factory(e);var n=long_int.__index__(t),r=long_int.__index__(e);if(n.length<r.length){var i=r;r=n,n=i}for(var s=n.length-r.length,o=n.substr(0,s),a=0;a<r.length;a++)"1"==n.charAt(s+a)||"1"==r.charAt(a)?o+="1":o+="0";return intOrLong(long_int.$factory(o,2))},long_int.__pos__=function(t){return t},long_int.__pow__=function(t,e,n){if("number"==typeof e)e=long_int.$from_int(e);else if(isinstance(e,int))e=long_int.$factory(_b_.str.$factory(_b_.int.__index__(e)));else if(!isinstance(e,long_int))throw TypeError.$factory("power must be an integer, not '"+$B.class_name(e)+"'");if(!e.pos)return"1"==t.value?t:long_int.$factory("0");if("0"==e.value)return long_int.$factory("1");if($B.BigInt){var r=$B.BigInt(t.value),i=$B.BigInt(1),s=$B.BigInt(e.value);if(void 0===(n=void 0===n?n:"number"==typeof n?$B.BigInt(n):$B.BigInt(n.value)))return{__class__:long_int,value:(r**s).toString(),pos:!0};for(;s>0;)s%$B.BigInt(2)==1&&(i*=r),(s/=$B.BigInt(2))>0&&(r*=r),void 0!==n&&(i%=n);return{__class__:long_int,value:i.toString(),pos:!0}}i={__class__:long_int,value:"1",pos:!0},r=t;for(var o,a=e.value;"string"==typeof a&&parseInt(a)<$B.max_int&&(a=parseInt(a)),0!=a;)"string"==typeof a?(parseInt(a.charAt(a.length-1))%2==1&&(i=long_int.__mul__(i,r)),a=long_int.__floordiv__(a,2)):(a%2==1&&(i="number"==typeof i&&"number"==typeof r&&(o=i*r)<$B.max_int?o:long_int.__mul__(long_int.$factory(i),long_int.$factory(r))),a=Math.floor(a/2)),a>0&&("number"==typeof r&&(o=r*r)<$B.max_int?r=o:(r=long_int.$factory(r),r=long_int.__mul__(r,r))),void 0!==n&&(i=long_int.__mod__(i,n));return intOrLong(i)},long_int.__rshift__=function(t,e){if(window.BigInt)return e.__class__===long_int&&(e=e.value),intOrLong({__class__:long_int,value:(BigInt(t.value)>>BigInt(e)).toString(),pos:t.pos});if("number"==typeof e){var n=Math.pow(2,e);if(n<$B.max_int){var r=divmod_by_safe_int(t.value,n);return intOrLong({__class__:long_int,value:r[0],pos:t.pos})}}if("0"==(e=long_int.$factory(e)).value)return t;for(r=t.value;"0"!=(r=divmod_pos(r,"2")[0].value).value&&"0"!=(e=sub_pos(e.value,"1")).value;);return intOrLong({__class__:long_int,value:r,pos:t.pos})},long_int.__str__=long_int.__repr__=function(t){var e="";return t.pos||(e+="-"),e+t.value},long_int.__sub__=function(t,e){if(isinstance(e,_b_.float))return e=e instanceof Number?e:e.$brython_value,_b_.float.$factory(parseInt(t.value)-e);var n;if("number"==typeof e&&(e=long_int.$factory(_b_.str.$factory(e))),$B.BigInt,t.pos&&e.pos){switch(comp_pos(t.value,e.value)){case 1:n=sub_pos(t.value,e.value);break;case 0:n={__class__:long_int,value:"0",pos:!0};break;case-1:(n=sub_pos(e.value,t.value)).pos=!1}return intOrLong(n)}if(t.pos||e.pos)return t.pos&&!e.pos?intOrLong(add_pos(t.value,e.value)):((n=add_pos(t.value,e.value)).pos=!1,intOrLong(n));switch(comp_pos(t.value,e.value)){case 1:(n=sub_pos(t.value,e.value)).pos=!1;break;case 0:n={__class__:long_int,value:"0",pos:!0};break;case-1:n=sub_pos(e.value,t.value)}return intOrLong(n)},long_int.__truediv__=function(t,e){if(isinstance(e,long_int))return _b_.float.$factory(parseInt(t.value)/parseInt(e.value));if(isinstance(e,_b_.int))return _b_.float.$factory(parseInt(t.value)/e);if(isinstance(e,_b_.float))return _b_.float.$factory(parseInt(t.value)/e);throw TypeError.$factory("unsupported operand type(s) for /: 'int' and '"+$B.class_name(e)+"'")},long_int.__xor__=function(t,e){e=long_int.$factory(e);var n=long_int.__index__(t),r=long_int.__index__(e);if(n.length<r.length){var i=r;r=n,n=i}for(var s=n.length-r.length,o=n.substr(0,s),a=0;a<r.length;a++)"1"==n.charAt(s+a)&&"0"==r.charAt(a)||"0"==n.charAt(s+a)&&"1"==r.charAt(a)?o+="1":o+="0";return intOrLong(long_int.$factory(o,2))},long_int.numerator=function(t){return t},long_int.denominator=function(t){return _b_.int.$factory(1)},long_int.imag=function(t){return _b_.int.$factory(0)},long_int.real=function(t){return t},long_int.to_base=function(t,e){if(2==e)return binary_pos(t.value);for(var n="",r=t.value;r>0;){var i=divmod_pos(r,e.toString());if(n=parseInt(i[1].value).toString(e)+n,0==(r=i[0].value))break}return n};var MAX_SAFE_INTEGER=Math.pow(2,53)-1,MIN_SAFE_INTEGER=-MAX_SAFE_INTEGER;function isSafeInteger(t){return"number"==typeof t&&Math.round(t)===t&&MIN_SAFE_INTEGER<=t&&t<=MAX_SAFE_INTEGER}function intOrLong(t){var e=parseInt(t.value)*(t.pos?1:-1);return e>MIN_SAFE_INTEGER&&e<MAX_SAFE_INTEGER?e:t}long_int.$from_int=function(t){return{__class__:long_int,value:t.toString(),pos:t>0}},long_int.$factory=function(t,e){if(arguments.length>2)throw _b_.TypeError.$factory("long_int takes at most 2 arguments ("+arguments.length+" given)");if(void 0===e)e=10;else if(!isinstance(e,int))throw TypeError.$factory("'"+$B.class_name(e)+"' object cannot be interpreted as an integer");if(e<0||1==e||e>36)throw ValueError.$factory("long_int.$factory() base must be >= 2 and <= 36");if("number"==typeof t){var n=t>0;if(isSafeInteger(t=Math.abs(t)))l=long_int.$from_int(t);else{if(t.constructor!=Number)throw ValueError.$factory("argument of long_int is not a safe integer");var r=t.toString(),i=r.search("e");if(i>-1){var s=r.substr(0,i),o=parseInt(r.substr(i+1));if((p=s.search(/\./))>-1){var a=s.substr(p+1).length;if(a>o){var l=s.substr(0,p)+s.substr(p+1).substr(0,o);l=long_int.$from_int(l)}else l=s.substr(0,p)+s.substr(p+1)+"0".repeat(o-a),l=long_int.$from_int(l)}else l=long_int.$from_int(s+"0".repeat(o))}else l=(p=r.search(/\./))>-1?long_int.$from_int(r.substr(0,p)):long_int.$from_int(r)}return l.pos=n,l}if(isinstance(t,_b_.float)){if(t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)return t;t=new Number(t>=0?Math.round(t.value):Math.ceil(t.value))}else{if(isinstance(t,_b_.bool))return t.valueOf()?int.$factory(1):int.$factory(0);if(t.__class__===long_int)return t;if(isinstance(t,int))t=t.$brython_value+"";else if(isinstance(t,_b_.bool))t=_b_.bool.__int__(t)+"";else if("string"!=typeof t)throw ValueError.$factory("argument of long_int must be a string, not "+$B.class_name(t))}for(var c=!1,u=(n=!0,0);" "==t.charAt(0)&&t.length;)t=t.substr(1);for(;" "==t.charAt(t.length-1)&&t.length;)t=t.substr(0,t.length-1);if("+"==t.charAt(0)?c=!0:"-"==t.charAt(0)&&(c=!0,n=!1),c){if(1==t.length)throw ValueError.$factory('long_int argument is not a valid number: "'+t+'"');t=t.substr(1)}for(;u<t.length-1&&"0"==t.charAt(u);)u++;t=t.substr(u);for(var h=digits(e),p=-1,d=0;d<t.length;d++)if("."==t.charAt(d)&&-1==p)p=d;else if(!h[t.charAt(d)])throw ValueError.$factory('long_int argument is not a valid number: "'+t+'"');if(-1!=p&&(t=t.substr(0,p)),10!=e){for(var f="1",m=long_int.$factory(0),_=t.length;_--;){var g=mul_pos(f,parseInt(t.charAt(_),e).toString()).value;m=add_pos(m.value,g),f=mul_pos(f,e.toString()).value}return m}return{__class__:long_int,value:t,pos:n}},$B.set_func_names(long_int,"builtins"),$B.long_int=long_int}(__BRYTHON__),function($B){var _b_=$B.builtins;function $UnsupportedOpType(t,e,n){throw _b_.TypeError.$factory("unsupported operand type(s) for "+t+": '"+e+"' and '"+n+"'")}var complex={__class__:_b_.type,__dir__:_b_.object.__dir__,$infos:{__module__:"builtins",__name__:"complex"},$is_class:!0,$native:!0,$descriptors:{real:!0,imag:!0}};function complex2expo(t){var e=Math.sqrt(t.$real*t.$real+t.$imag*t.$imag),n=t.$imag/e,r=t.$real/e;return{norm:e,angle:0==r?1==n?Math.PI/2:3*Math.PI/2:0==n?1==r?0:Math.PI:Math.atan(n/r)}}complex.__abs__=function(t){var e=isFinite(t.$real),n=isFinite(t.$imag);if(e&&isNaN(t.$imag)||n&&isNaN(t.$real)||isNaN(t.$imag)&&isNaN(t.$real))return NaN;if(!e||!n)return 1/0;var r=Math.sqrt(Math.pow(t.$real,2)+Math.pow(t.$imag,2));if(!isFinite(r)&&e&&n)throw _b_.OverflowError.$factory("absolute value too large");return r},complex.__bool__=function(t){return 0!=t.$real||0!=t.$imag},complex.__eq__=function(t,e){return _b_.isinstance(e,complex)?t.$real.valueOf()==e.$real.valueOf()&&t.$imag.valueOf()==e.$imag.valueOf():_b_.isinstance(e,_b_.int)||_b_.isinstance(e,_b_.float)?0==t.$imag&&t.$real==e.valueOf():_b_.NotImplemented},complex.__floordiv__=function(t,e){$UnsupportedOpType("//","complex",$B.get_class(e))},complex.__hash__=function(t){return 1000003*t.$imag+t.$real},complex.__init__=function(){return _b_.None},complex.__invert__=function(t){return~t},complex.__mod__=function(t,e){throw _b_.TypeError.$factory("TypeError: can't mod complex numbers.")},complex.__mro__=[_b_.object],complex.__mul__=function(t,e){return _b_.isinstance(e,complex)?make_complex(t.$real*e.$real-t.$imag*e.$imag,t.$imag*e.$real+t.$real*e.$imag):_b_.isinstance(e,_b_.int)?make_complex(t.$real*e.valueOf(),t.$imag*e.valueOf()):_b_.isinstance(e,_b_.float)?make_complex(t.$real*e,t.$imag*e):_b_.isinstance(e,_b_.bool)?e.valueOf()?t:make_complex(0,0):void $UnsupportedOpType("*",complex,e)},complex.__ne__=function(t,e){var n=complex.__eq__(t,e);return n===_b_.NotImplemented?n:!n},complex.__neg__=function(t){return make_complex(-t.$real,-t.$imag)},complex.__new__=function(t){if(void 0===t)throw _b_.TypeError.$factory("complex.__new__(): not enough arguments");var e={},n=$B.args("complex",3,{cls:null,real:null,imag:null},["cls","real","imag"],arguments,{real:0,imag:e},null,null),r=n.real,i=n.imag;if("string"==typeof r){if(i!==e)throw _b_.TypeError.$factory("complex() can't take second arg if first is a string");{var s=r;(r=r.trim()).startsWith("(")&&r.endsWith(")")&&(r=(r=r.substr(1)).substr(0,r.length-1));var o=/^\s*([\+\-]*[0-9_]*\.?[0-9_]*(e[\+\-]*[0-9_]*)?)([\+\-]?)([0-9_]*\.?[0-9_]*(e[\+\-]*[0-9_]*)?)(j?)\s*$/i.exec(r);function a(t){var e=parseFloat(t.charAt(0)+t.substr(1).replace(/_/g,""));if(isNaN(e))throw _b_.ValueError.$factory("could not convert string to complex: '"+s+"'");return e}if(null===o)throw _b_.ValueError.$factory("complex() arg is a malformed string");if("."==o[_real]||"."==o[_imag]||".e"==o[_real]||".e"==o[_imag]||"e"==o[_real]||"e"==o[_imag])throw _b_.ValueError.$factory("complex() arg is a malformed string");return""!=o[_j]?""==o[_sign]?(r=0,i="+"==o[_real]||""==o[_real]?1:"-"==o[_real]?-1:a(o[_real])):(r=a(o[_real]),i=""==o[_imag]?1:a(o[_imag]),i="-"==o[_sign]?-i:i):(r=a(o[_real]),i=0),{__class__:complex,$real:r||0,$imag:i||0}}}if(i=i===e?0:i,1==arguments.length&&r.__class__===complex&&0==i)return r;if(_b_.isinstance(r,[_b_.float,_b_.int])&&_b_.isinstance(i,[_b_.float,_b_.int]))return{__class__:complex,$real:r,$imag:i};var l=$B.to_num(r,["__complex__","__float__","__index__"]);if(null===l)throw _b_.TypeError.$factory("complex() first argument must be a  string or a number, not '"+$B.class_name(r)+"'");if(r=l,i=_convert(i),!_b_.isinstance(r,_b_.float)&&!_b_.isinstance(r,_b_.int)&&!_b_.isinstance(r,_b_.complex))throw _b_.TypeError.$factory("complex() argument must be a string or a number");if("string"==typeof i)throw _b_.TypeError.$factory("complex() second arg can't be a string");if(!_b_.isinstance(i,_b_.float)&&!_b_.isinstance(i,_b_.int)&&!_b_.isinstance(i,_b_.complex)&&i!==e)throw _b_.TypeError.$factory("complex() argument must be a string or a number");return i=complex.__mul__(complex.$factory("1j"),i),complex.__add__(i,r)},complex.__pos__=function(t){return t},complex.__pow__=function(t,e){var n=complex2expo(t),r=n.angle,i=Math.pow(n.norm,e);if(_b_.isinstance(e,[_b_.int,_b_.float]))return make_complex(i*Math.cos(r*e),i*Math.sin(r*e));if(_b_.isinstance(e,complex)){var s=e.$real,o=e.$imag,a=Math.pow(n.norm,s)*Math.pow(Math.E,-o*r),l=o*Math.log(n.norm)-s*r;return make_complex(a*Math.cos(l),a*Math.sin(l))}throw _b_.TypeError.$factory("unsupported operand type(s) for ** or pow(): 'complex' and '"+$B.class_name(e)+"'")},complex.__str__=complex.__repr__=function(t){return 0==t.$real?1/t.$real<0?t.$imag<0?"(-0"+t.$imag+"j)":0==t.$imag&&1/t.$imag<0?"(-0-"+t.$imag+"j)":"(-0+"+t.$imag+"j)":0==t.$imag&&1/t.$imag<0?"-"+t.$imag+"j":t.$imag+"j":t.$imag>0?"("+t.$real+"+"+t.$imag+"j)":0==t.$imag?1/t.$imag<0?"("+t.$real+"-"+t.$imag+"j)":"("+t.$real+"+"+t.$imag+"j)":"("+t.$real+"-"+-t.$imag+"j)"},complex.__sqrt__=function(t){if(0==t.$imag)return complex(Math.sqrt(t.$real));var e=t.$real,n=t.$imag,r=Math.sqrt((e+sqrt)/2),i=Number.sign(n)*Math.sqrt((-e+sqrt)/2);return make_complex(r,i)},complex.__truediv__=function(t,e){if(_b_.isinstance(e,complex)){if(0==e.$real&&0==e.$imag)throw _b_.ZeroDivisionError.$factory("division by zero");var n=t.$real*e.$real+t.$imag*e.$imag,r=e.$real*e.$real+e.$imag*e.$imag,i=t.$imag*e.$real-t.$real*e.$imag;return make_complex(n/r,i/r)}if(_b_.isinstance(e,_b_.int)){if(!e.valueOf())throw _b_.ZeroDivisionError.$factory("division by zero");return complex.__truediv__(t,complex.$factory(e.valueOf()))}if(_b_.isinstance(e,_b_.float)){if(!e.valueOf())throw _b_.ZeroDivisionError.$factory("division by zero");return complex.__truediv__(t,complex.$factory(e.valueOf()))}$UnsupportedOpType("//","complex",e.__class__)},complex.conjugate=function(t){return make_complex(t.$real,-t.$imag)};var $op_func=function(t,e){throw _b_.TypeError.$factory("TypeError: unsupported operand type(s) for -: 'complex' and '"+$B.class_name(e)+"'")};$op_func+="";var $ops={"&":"and","|":"ior","<<":"lshift",">>":"rshift","^":"xor"};for(var $op in $ops)eval("complex.__"+$ops[$op]+"__ = "+$op_func.replace(/-/gm,$op));complex.__ior__=complex.__or__;var $op_func=function(t,e){if(_b_.isinstance(e,complex))return make_complex(t.$real-e.$real,t.$imag-e.$imag);if(_b_.isinstance(e,_b_.int))return make_complex($B.sub(t.$real,e.valueOf()),t.$imag);if(_b_.isinstance(e,_b_.float))return make_complex(t.$real-e.valueOf(),t.$imag);if(_b_.isinstance(e,_b_.bool)){var n=0;return e.valueOf()&&(n=1),make_complex(t.$real-n,t.$imag)}throw _b_.TypeError.$factory("unsupported operand type(s) for -: "+t.__repr__()+" and '"+$B.class_name(e)+"'")};complex.__sub__=$op_func,$op_func+="",$op_func=$op_func.replace(/-/gm,"+").replace(/sub/gm,"add"),eval("complex.__add__ = "+$op_func);var $comp_func=function(t,e){if(void 0===e||e==_b_.None)return _b_.NotImplemented;throw _b_.TypeError.$factory("TypeError: no ordering relation is defined for complex numbers")};for(var $op in $comp_func+="",$B.$comps)eval("complex.__"+$B.$comps[$op]+"__ = "+$comp_func.replace(/>/gm,$op));$B.make_rmethods(complex),complex.real=function(t){return new Number(t.$real)},complex.real.setter=function(){throw _b_.AttributeError.$factory("readonly attribute")},complex.imag=function(t){return new Number(t.$imag)},complex.imag.setter=function(){throw _b_.AttributeError.$factory("readonly attribute")};var _real=1,_real_mantissa=2,_sign=3,_imag=4,_imag_mantissa=5,_j=6,type_conversions=["__complex__","__float__","__index__"],_convert=function(t){for(var e=t.__class__||$B.get_class(t),n=0;n<type_conversions.length;n++){var r={},i=$B.$getattr(e,type_conversions[n],r);if(i!==r)return i(t)}return null},make_complex=$B.make_complex=function(t,e){return{__class__:complex,$real:t,$imag:e}};complex.$factory=function(){return complex.__new__(complex,...arguments)},$B.set_func_names(complex,"builtins"),_b_.complex=complex}(__BRYTHON__),function(t){var e=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function n(t){return t<1e5?t<100?t<10?0:1:t<1e4?t<1e3?2:3:4:t<1e7?t<1e6?5:6:t<1e9?t<1e8?7:8:9}function r(t,r){if(t===r)return 0;if(~~t===t&&~~r===r){if(0===t||0===r)return t<r?-1:1;if(t<0||r<0){if(r>=0)return-1;if(t>=0)return 1;t=-t,r=-r}al=n(t),bl=n(r);var i=0;return al<bl?(t*=e[bl-al-1],r/=10,i=-1):al>bl&&(r*=e[al-bl-1],t/=10,i=1),t===r?i:t<r?-1:1}var s=String(t),o=String(r);return s===o?0:s<o?-1:1}function i(t,e,n,r){var i=e+1;if(i===n)return 1;if(r(t[i++],t[e])<0){for(;i<n&&r(t[i],t[i-1])<0;)i++;!function(t,e,n){for(n--;e<n;){var r=t[e];t[e++]=t[n],t[n--]=r}}(t,e,i)}else for(;i<n&&r(t[i],t[i-1])>=0;)i++;return i-e}function s(t,e,n,r,i){for(r===e&&r++;r<n;r++){for(var s=t[r],o=e,a=r;o<a;){var l=o+a>>>1;i(s,t[l])<0?a=l:o=l+1}var c=r-o;switch(c){case 3:t[o+3]=t[o+2];case 2:t[o+2]=t[o+1];case 1:t[o+1]=t[o];break;default:for(;c>0;)t[o+c]=t[o+c-1],c--}t[o]=s}}function o(t,e,n,r,i,s){var o=0,a=0,l=1;if(s(t,e[n+i])>0){for(a=r-i;l<a&&s(t,e[n+i+l])>0;)o=l,(l=1+(l<<1))<=0&&(l=a);l>a&&(l=a),o+=i,l+=i}else{for(a=i+1;l<a&&s(t,e[n+i-l])<=0;)o=l,(l=1+(l<<1))<=0&&(l=a);l>a&&(l=a);var c=o;o=i-l,l=i-c}for(o++;o<l;){var u=o+(l-o>>>1);s(t,e[n+u])>0?o=u+1:l=u}return l}function a(t,e,n,r,i,s){var o=0,a=0,l=1;if(s(t,e[n+i])<0){for(a=i+1;l<a&&s(t,e[n+i-l])<0;)o=l,(l=1+(l<<1))<=0&&(l=a);l>a&&(l=a);var c=o;o=i-l,l=i-c}else{for(a=r-i;l<a&&s(t,e[n+i+l])>=0;)o=l,(l=1+(l<<1))<=0&&(l=a);l>a&&(l=a),o+=i,l+=i}for(o++;o<l;){var u=o+(l-o>>>1);s(t,e[n+u])<0?l=u:o=u+1}return l}var l="TimSortAssertion",c=function(t){this.name=l,this.message=t},u=function(t,e){var n={array:t,compare:e,minGallop:7,length:t.length,tmpStorageLength:256,stackLength:0,runStart:null,runLength:null,stackSize:0,pushRun:function(t,e){this.runStart[this.stackSize]=t,this.runLength[this.stackSize]=e,this.stackSize+=1},mergeRuns:function(){for(;this.stackSize>1;){var t=this.stackSize-2;if(t>=1&&this.runLength[t-1]<=this.runLength[t]+this.runLength[t+1]||t>=2&&this.runLength[t-2]<=this.runLength[t]+this.runLength[t-1])this.runLength[t-1]<this.runLength[t+1]&&t--;else if(this.runLength[t]>this.runLength[t+1])break;this.mergeAt(t)}},forceMergeRuns:function(){for(;this.stackSize>1;){var t=this.stackSize-2;t>0&&this.runLength[t-1]<this.runLength[t+1]&&t--,this.mergeAt(t)}},mergeAt:function(t){var e=this.compare,n=this.array,r=this.runStart[t],i=this.runLength[t],s=this.runStart[t+1],l=this.runLength[t+1];this.runLength[t]=i+l,t===this.stackSize-3&&(this.runStart[t+1]=this.runStart[t+2],this.runLength[t+1]=this.runLength[t+2]),this.stackSize--;var c=a(n[s],n,r,i,0,e);r+=c,0!=(i-=c)&&0!==(l=o(n[r+i-1],n,s,l,l-1,e))&&(i<=l?this.mergeLow(r,i,s,l):this.mergeHigh(r,i,s,l))},mergeLow:function(t,e,n,r){var i=this.compare,s=this.array,l=this.tmp,u=0;for(u=0;u<e;u++)l[u]=s[t+u];var h=0,p=n,d=t;if(s[d++]=s[p++],0!=--r)if(1!==e){for(var f=this.minGallop;;){var m=0,_=0,g=!1;do{if(i(s[p],l[h])<0){if(s[d++]=s[p++],_++,m=0,0==--r){g=!0;break}}else if(s[d++]=l[h++],m++,_=0,1==--e){g=!0;break}}while((m|_)<f);if(g)break;do{if(0!==(m=a(s[p],l,h,e,0,i))){for(u=0;u<m;u++)s[d+u]=l[h+u];if(d+=m,h+=m,(e-=m)<=1){g=!0;break}}if(s[d++]=s[p++],0==--r){g=!0;break}if(0!==(_=o(l[h],s,p,r,0,i))){for(u=0;u<_;u++)s[d+u]=s[p+u];if(d+=_,p+=_,0==(r-=_)){g=!0;break}}if(s[d++]=l[h++],1==--e){g=!0;break}f--}while(m>=7||_>=7);if(g)break;f<0&&(f=0),f+=2}if(this.minGallop=f,f<1&&(this.minGallop=1),1===e){for(u=0;u<r;u++)s[d+u]=s[p+u];s[d+r]=l[h]}else{if(0===e)throw new c("mergeLow preconditions were not respected");for(u=0;u<e;u++)s[d+u]=l[h+u]}}else{for(u=0;u<r;u++)s[d+u]=s[p+u];s[d+r]=l[h]}else for(u=0;u<e;u++)s[d+u]=l[h+u]},mergeHigh:function(t,e,n,r){var i=this.compare,s=this.array,l=this.tmp,u=0;for(u=0;u<r;u++)l[u]=s[n+u];var h=t+e-1,p=r-1,d=n+r-1,f=0,m=0;if(s[d--]=s[h--],0!=--e)if(1!==r){for(var _=this.minGallop;;){var g=0,y=0,v=!1;do{if(i(l[p],s[h])<0){if(s[d--]=s[h--],g++,y=0,0==--e){v=!0;break}}else if(s[d--]=l[p--],y++,g=0,1==--r){v=!0;break}}while((g|y)<_);if(v)break;do{if(0!=(g=e-a(l[p],s,t,e,e-1,i))){for(e-=g,m=1+(d-=g),f=1+(h-=g),u=g-1;u>=0;u--)s[m+u]=s[f+u];if(0===e){v=!0;break}}if(s[d--]=l[p--],1==--r){v=!0;break}if(0!=(y=r-o(s[h],l,0,r,r-1,i))){for(r-=y,m=1+(d-=y),f=1+(p-=y),u=0;u<y;u++)s[m+u]=l[f+u];if(r<=1){v=!0;break}}if(s[d--]=s[h--],0==--e){v=!0;break}_--}while(g>=7||y>=7);if(v)break;_<0&&(_=0),_+=2}if(this.minGallop=_,_<1&&(this.minGallop=1),1===r){for(m=1+(d-=e),f=1+(h-=e),u=e-1;u>=0;u--)s[m+u]=s[f+u];s[d]=l[p]}else{if(0==r)throw new c("mergeHigh preconditions were not respected");for(f=d-(r-1),u=0;u<r;u++)s[f+u]=l[u]}}else{m=1+(d-=e),f=1+(h-=e);for(u=e-1;u>=0;u--)s[m+u]=s[f+u];s[d]=l[p]}else{f=d-(r-1);for(u=0;u<r;u++)s[f+u]=l[u]}}};return n.length<512&&(n.tmpStorageLength=n.length>>>1),n.tmp=new Array(n.tmpStorageLength),n.stackLength=n.length<120?5:n.length<1542?10:n.length<119151?19:40,n.runStart=new Array(n.stackLength),n.runLength=new Array(n.stackLength),n};t.$TimSort=function(t,e){try{!function(t,e,n,o){if(!Array.isArray(t))throw TypeError.$factory("Can only sort arrays");e?"function"!=typeof e&&(o=n,n=e,e=r):e=r,n||(n=0),o||(o=t.length);var a=o-n;if(!(a<2)){var l=0;if(a<32)s(t,n,o,n+(l=i(t,n,o,e)),e);else{var c=new u(t,e),h=function(t){for(var e=0;t>=32;)e|=1&t,t>>=1;return t+e}(a);do{if((l=i(t,n,o,e))<h){var p=a;p>h&&(p=h),s(t,n,n+p,n+l,e),l=p}c.pushRun(n,l),c.mergeRuns(),a-=l,n+=l}while(0!==a);c.forceMergeRuns()}}}(t,e,0,t.length)}catch(n){if(n.name!=l)throw n;t.sort(e)}},t.$AlphabeticalCompare=r}(__BRYTHON__),function(t){var e=t.builtins,n=e.object,r=t.$getattr,i=e.isinstance,o=e.None;function a(t,n){if(t.__class__===d)throw e.AttributeError.$factory("'tuple' object has no attribute '"+n+"'")}var l={__class__:e.type,__mro__:[n],$infos:{__module__:"builtins",__name__:"list"},$is_class:!0,$native:!0,__dir__:n.__dir__,__add__:function(n,s){if(t.get_class(n)!==t.get_class(s)){var o=r(s,"__radd__",e.NotImplemented);if(o!==e.NotImplemented)return o(n);throw e.TypeError.$factory('can only concatenate list (not "'+t.class_name(s)+'") to list')}var a=n.slice(),l="js"==s.$brython_class;for(const e of s)a.push(l?t.$JS2Py(e):e);return a.__brython__=!0,i(n,d)&&(a=d.$factory(a)),a},__class_getitem__:function(e,n){return Array.isArray(n)||(n=[n]),t.GenericAlias.$factory(e,n)},__contains__:function(e,n){for(var r,i=t.args("__contains__",2,{self:null,item:null},["self","item"],arguments,{},null,null),s=(e=i.self,n=i.item,0);s<e.length;){if(r=e[s],t.rich_comp("__eq__",n,r))return!0;s++}return!1},__delitem__:function(n,r){if(i(r,e.int)){var s=r;if(r<0&&(s=n.length+s),s>=0&&s<n.length)return n.splice(s,1),o;throw e.IndexError.$factory(t.class_name(n)+" index out of range")}if(i(r,e.slice)){var a=r.step;a===o&&(a=1);var c=r.start;c===o&&(c=a>0?0:n.length);var u=r.stop;u===o&&(u=a>0?n.length:0),c<0&&(c=n.length+c),u<0&&(u=n.length+u);var h=[],p=null;if(s=0,a>0){if(u>c)for(p=c;p<u;p+=a)void 0!==n[p]&&(h[s++]=p)}else if(u<c){for(p=c;p>u;p+=a)void 0!==n[p]&&(h[s++]=p);h.reverse()}for(p=h.length;p--;)n.splice(h[p],1);return o}if(e.hasattr(r,"__int__")||e.hasattr(r,"__index__"))return l.__delitem__(n,e.int.$factory(r)),o;throw e.TypeError.$factory(t.class_name(n)+" indices must be integer, not "+t.class_name(r))},__eq__:function(n,r){if(i(n,l))var s=l;else s=d;if(i(r,s)&&r.length==n.length){for(var o=n.length;o--;)if(!t.rich_comp("__eq__",n[o],r[o]))return!1;return!0}return e.NotImplemented},__getitem__:function(e,n){return t.check_no_kw("__getitem__",e,n),t.check_nb_args("__getitem__",2,arguments),l.$getitem(e,n)},$getitem:function(n,r){var s=(n.__class__||t.get_class(n)).$factory;if(i(r,e.int)){var o=n.valueOf(),a=r;if(r<0&&(a=o.length+a),a>=0&&a<o.length)return o[a];throw e.IndexError.$factory(t.class_name(n)+" index out of range")}if(r.__class__===e.slice||i(r,e.slice)){if(r.start===e.None&&r.stop===e.None&&r.step===e.None)return n.slice();var c=e.slice.$conv_for_seq(r,n.length),u=[],h=null,p=(o=n.valueOf(),a=0,c.start),d=c.stop,f=c.step;if(f>0){if(d<=p)return s(u);for(h=p;h<d;h+=f)u[a++]=o[h];return s(u)}if(d>p)return s(u);for(h=p;h>d;h+=f)u[a++]=o[h];return s(u)}if(e.hasattr(r,"__int__")||e.hasattr(r,"__index__"))return l.__getitem__(n,e.int.$factory(r));throw e.TypeError.$factory(t.class_name(n)+" indices must be integer, not "+t.class_name(r))},__ge__:function(n,s){if(!i(s,[l,e.tuple]))return e.NotImplemented;for(var o=0;o<n.length;){if(o>=s.length)return!0;if(!t.rich_comp("__eq__",n[o],s[o])){if(res=r(n[o],"__ge__")(s[o]),res===e.NotImplemented)throw e.TypeError.$factory("unorderable types: "+t.class_name(n[o])+"() >= "+t.class_name(s[o])+"()");return res}o++}return s.length==n.length},__gt__:function(n,s){if(!i(s,[l,e.tuple]))return e.NotImplemented;for(var o=0;o<n.length;){if(o>=s.length)return!0;if(!t.rich_comp("__eq__",n[o],s[o])){if(res=r(n[o],"__gt__")(s[o]),res===e.NotImplemented)throw e.TypeError.$factory("unorderable types: "+t.class_name(n[o])+"() > "+t.class_name(s[o])+"()");return res}o++}return!1}};l.__hash__=o,l.__iadd__=function(){var n=t.args("__iadd__",2,{self:null,x:null},["self","x"],arguments,{},null,null),i=r(n.x,"__radd__",e.NotImplemented);if(i!==e.NotImplemented)return i(n.self);for(var s=l.$factory(t.$iter(n.x)),o=0;o<s.length;o++)n.self.push(s[o]);return n.self},l.__imul__=function(){var e=t.args("__imul__",2,{self:null,x:null},["self","x"],arguments,{},null,null),n=t.$GetInt(e.x),r=e.self.length,i=r;if(0==n)return l.clear(e.self),e.self;for(var s=1;s<n;s++)for(j=0;j<r;j++)e.self[i++]=e.self[j];return e.self},l.__init__=function(n,i){var s=t.$call(r(n,"__len__")),a=r(n,"pop",o);if(a!==o)for(a=t.$call(a);s();)a();if(void 0===i)return o;i=t.$iter(i);for(var l=t.$call(r(i,"__next__")),c=s();;)try{var u=l();n[c++]=u}catch(t){if(t.__class__===e.StopIteration)break;throw t}return o};var c=t.make_iterator_class("list_iterator");c.__reduce__=c.__reduce_ex__=function(n){return t.fast_tuple([e.iter,t.fast_tuple([l.$factory(n)]),0])},l.__iter__=function(t){return c.$factory(t)},l.__le__=function(t,n){var r=l.__ge__(t,n);return r===e.NotImplemented?r:!r},l.__len__=function(t){return t.length},l.__lt__=function(n,s){if(!i(s,[l,e.tuple]))return e.NotImplemented;for(var o=0;o<n.length;){if(o>=s.length)return!1;if(!t.rich_comp("__eq__",n[o],s[o])){if(res=r(n[o],"__lt__")(s[o]),res===e.NotImplemented)throw e.TypeError.$factory("unorderable types: "+t.class_name(n[o])+"() >= "+t.class_name(s[o])+"()");return res}o++}return s.length>n.length},l.__mul__=function(n,r){if(i(r,e.int)){for(var s=[],o=n.slice(),a=o.length,c=0;c<r;c++)for(var u=0;u<a;u++)s.push(o[u]);return s.__class__=n.__class__,s}if(e.hasattr(r,"__int__")||e.hasattr(r,"__index__"))return l.__mul__(n,e.int.$factory(r));var h=t.$getattr(r,"__rmul__",e.NotImplemented);if(h!==e.NotImplemented)return h(n);throw e.TypeError.$factory("can't multiply sequence by non-int of type '"+t.class_name(r)+"'")},l.__new__=function(n,...r){if(void 0===n)throw e.TypeError.$factory("list.__new__(): not enough arguments");var i=[];return i.__class__=n,i.__brython__=!0,i.__dict__=t.empty_dict(),i},l.__repr__=function(n){if(t.repr.enter(n))return"[...]";for(var r,i=[],s=0;s<n.length;s++)i.push(e.repr(n[s]));return r=n.__class__===d?1==n.length?"("+i[0]+",)":"("+i.join(", ")+")":"["+i.join(", ")+"]",t.repr.leave(n),r},l.__setattr__=function(t,n,r){if(t.__class__===l)throw l.hasOwnProperty(n)?e.AttributeError.$factory("'list' object attribute '"+n+"' is read-only"):e.AttributeError.$factory("'list' object has no attribute '"+n+"'");return e.dict.$setitem(t.__dict__,n,r),o},l.__setitem__=function(){var e=t.args("__setitem__",3,{self:null,key:null,value:null},["self","key","value"],arguments,{},null,null),n=e.self,r=e.key,i=e.value;l.$setitem(n,r,i)},l.$setitem=function(n,r,s){if("number"==typeof r||i(r,e.int)){var a=r;if(r<0&&(a=n.length+a),!(a>=0&&a<n.length))throw e.IndexError.$factory("list index out of range");return n[a]=s,o}if(i(r,e.slice)){var c=e.slice.$conv_for_seq(r,n.length);return null===r.step?t.set_list_slice(n,c.start,c.stop,s):t.set_list_slice_step(n,c.start,c.stop,c.step,s),o}if(e.hasattr(r,"__int__")||e.hasattr(r,"__index__"))return l.__setitem__(n,e.int.$factory(r),s),o;throw e.TypeError.$factory("list indices must be integer, not "+t.class_name(r))},t.make_rmethods(l),l.append=function(e,n){return t.check_no_kw("append",e,n),t.check_nb_args("append",2,arguments),e.push(n),o},l.clear=function(){for(var e=t.args("clear",1,{self:null},["self"],arguments,{},null,null);e.self.length;)e.self.pop();return o},l.copy=function(){return t.args("copy",1,{self:null},["self"],arguments,{},null,null).self.slice()},l.count=function(){for(var e,n=t.args("count",2,{self:null,x:null},["self","x"],arguments,{},null,null),r=0,i=n.self.length;i--;)e=n.self[i],t.rich_comp("__eq__",n.x,e)&&r++;return r},l.extend=function(){for(var e=t.args("extend",2,{self:null,t:null},["self","t"],arguments,{},null,null),n=l.$factory(t.$iter(e.t)),r=0;r<n.length;r++)e.self.push(n[r]);return o},l.index=function(){var n,r={},i=t.args("index",4,{self:null,x:null,start:null,stop:null},["self","x","start","stop"],arguments,{start:0,stop:r},null,null),s=i.self,o=i.start,a=i.stop;o.__class__===t.long_int&&(o=parseInt(o.value)*(o.pos?1:-1)),o<0&&(o=Math.max(0,o+s.length)),a===r?a=s.length:(a.__class__===t.long_int&&(a=parseInt(a.value)*(a.pos?1:-1)),a<0&&(a=Math.min(s.length,a+s.length)),a=Math.min(a,s.length));for(var l=o;l<a;l++)if(n=s[l],t.rich_comp("__eq__",i.x,n))return l;throw e.ValueError.$factory(e.repr(i.x)+" is not in "+t.class_name(s))},l.insert=function(){var e=t.args("insert",3,{self:null,i:null,item:null},["self","i","item"],arguments,{},null,null);return e.self.splice(e.i,0,e.item),o},l.pop=function(){var n={},r=t.args("pop",2,{self:null,pos:null},["self","pos"],arguments,{pos:n},null,null),i=r.self,s=r.pos;a(i,"pop"),s===n&&(s=i.length-1),(s=t.$GetInt(s))<0&&(s+=i.length);var o=i[s];if(void 0===o)throw e.IndexError.$factory("pop index out of range");return i.splice(s,1),o},l.remove=function(){for(var n=t.args("remove",2,{self:null,x:null},["self","x"],arguments,{},null,null),r=0,i=n.self.length;r<i;r++)if(t.rich_comp("__eq__",n.self[r],n.x))return n.self.splice(r,1),o;throw e.ValueError.$factory(e.str.$factory(n.x)+" is not in list")},l.reverse=function(e){for(var n=t.args("reverse",1,{self:null},["self"],arguments,{},null,null),r=n.self.length-1,i=parseInt(n.self.length/2);i--;){var s=n.self[i];n.self[i]=n.self[r-i],n.self[r-i]=s}return o},l.sort=function(n){var i=t.args("sort",1,{self:null},["self"],arguments,{},null,"kw");a(n,"sort");for(var s=o,l=!1,c=i.kw,u=e.list.$factory(e.dict.$$keys(c)),h=0;h<u.length;h++)if("key"==u[h])s=c.$string_dict[u[h]][0];else{if("reverse"!=u[h])throw e.TypeError.$factory("'"+u[h]+"' is an invalid keyword argument for this function");l=c.$string_dict[u[h]][0]}if(0!=n.length){s!==o&&(s=t.$call(s)),n.$cl=function(e){if(0==e.length)return null;for(var n=t.get_class(e[0]),r=e.length;r--;)if(t.get_class(e[r])!==n)return!1;return n}(n);var p;return p=s===o&&n.$cl===e.str?l?function(e,n){return t.$AlphabeticalCompare(n,e)}:function(e,n){return t.$AlphabeticalCompare(e,n)}:s===o&&n.$cl===e.int?l?function(t,e){return e-t}:function(t,e){return t-e}:s===o?l?function(n,i){if(res=r(i,"__lt__")(n),res===e.NotImplemented)throw e.TypeError.$factory("unorderable types: "+t.class_name(n)+"() < "+t.class_name(i)+"()");return res?i==n?0:-1:1}:function(n,i){if(res=r(n,"__lt__")(i),res===e.NotImplemented)throw e.TypeError.$factory("unorderable types: "+t.class_name(n)+"() < "+t.class_name(i)+"()");return res?n==i?0:-1:1}:l?function(n,i){var o=s(i),a=s(n);if(res=r(o,"__lt__")(a),res===e.NotImplemented)throw e.TypeError.$factory("unorderable types: "+t.class_name(n)+"() < "+t.class_name(i)+"()");return res?o==a?0:-1:1}:function(n,r){var i=s(n),o=s(r);if(res=t.$getattr(i,"__lt__")(o),res===e.NotImplemented)throw e.TypeError.$factory("unorderable types: "+t.class_name(n)+"() < "+t.class_name(r)+"()");return res?i==o?0:-1:1},t.$TimSort(n,p),n.__brython__?o:n}},t.$list=function(t){return t.__brython__=!0,t},l.$factory=function(){if(0==arguments.length)return[];var n=t.args("list",1,{obj:null},["obj"],arguments,{},null,null).obj;if(Array.isArray(n))return(n=n.slice()).__brython__=!0,n.__class__==d?((s=n.slice()).__class__=l,s):n;for(var s=[],o=0,a=t.$iter(n),c=t.$call(r(a,"__next__"));;)try{s[o++]=c()}catch(t){if(!i(t,e.StopIteration))throw t;break}return s.__brython__=!0,s},t.set_func_names(l,"builtins"),l.__class_getitem__=e.classmethod.$factory(l.__class_getitem__);var u=t.JSArray=t.make_class("JSArray",(function(t){return{__class__:u,js:t}}));function h(t){for(var e=[t[0].js],n=1,r=t.length;n<r;n++)e.push(t[n]);return e}for(var p in u.__repr__=u.__str__=function(){return"<JSArray object>"},l)void 0===t.JSArray[p]&&"function"==typeof l[p]&&(t.JSArray[p]=function(e){return function(){return t.$JS2Py(l[e].apply(null,h(arguments)))}}(p));t.set_func_names(t.JSArray,"builtins");var d={__class__:e.type,__mro__:[n],$infos:{__module__:"builtins",__name__:"tuple"},$is_class:!0,$native:!0},f=t.make_iterator_class("tuple_iterator");for(var p in d.__iter__=function(t){return f.$factory(t)},d.$factory=function(){var t=l.$factory(...arguments);return t.__class__=d,t},t.fast_tuple=function(e){return e.__class__=d,e.__brython__=!0,e.__dict__=t.empty_dict(),e},l)switch(p){case"__delitem__":case"__iadd__":case"__imul__":case"__setitem__":case"append":case"extend":case"insert":case"remove":case"reverse":break;default:void 0===d[p]&&"function"==typeof l[p]&&(d[p]=function(t){return function(){return l[t].apply(null,arguments)}}(p))}d.__eq__=function(t,e){return void 0===e?t===d:l.__eq__(t,e)},d.__hash__=function(t){for(var n,r=54880137,i=0,o=t.length;i<o;i++){var a=e.hash(t[i]);n=r,s=(parseInt(1000003)*n&4294967295).toString(16),r=parseInt(s.substr(0,s.length-1),16)^4294967295&a}return r},d.__init__=function(){return o},d.__new__=function(n,...i){if(void 0===n)throw e.TypeError.$factory("list.__new__(): not enough arguments");var s=[];s.__class__=n,s.__brython__=!0,s.__dict__=t.empty_dict();for(var o=t.$iter(i[0]),a=t.$call(r(o,"__next__"));;)try{var l=a();s.push(l)}catch(t){if(t.__class__===e.StopIteration)break;throw t}return s},t.set_func_names(d,"builtins"),e.list=l,e.tuple=d,e.object.__bases__=d.$factory()}(__BRYTHON__);var $B=__BRYTHON__;for(var gc in $B.unicode={Cc:[[0,32],[127,33]],Zs:[32,160,5760,6158,[8192,11],8239,8287,12288],Po:[[33,3],[37,3],[42,3,2],47,58,59,63,64,92,161,183,191,894,903,[1370,6],1417,[1472,3,3],1523,1524,1545,1546,1548,1549,1563,1566,1567,[1642,4],1748,[1792,14],[2039,3],[2096,15],2404,2405,2416,3572,3663,3674,3675,[3844,15],3973,[4048,5],[4170,6],4347,[4961,8],5741,5742,[5867,3],5941,5942,[6100,3],[6104,3],[6144,6],[6151,4],6468,6469,6622,6623,6686,6687,[6816,7],[6824,6],[7002,7],[7227,5],7294,7295,7379,8214,8215,[8224,8],[8240,9],[8251,4],[8257,3],[8263,11],8275,[8277,10],[11513,4],11518,11519,11776,11777,[11782,3],11787,[11790,9],11800,11801,11803,11806,11807,[11818,5],11824,11825,[12289,3],12349,12539,42238,42239,[42509,3],42611,42622,[42738,6],[43124,4],43214,43215,[43256,3],43310,43311,43359,[43457,13],43486,43487,[43612,4],43742,43743,44011,[65040,7],65049,65072,65093,65094,[65097,4],[65104,3],[65108,4],[65119,3],65128,65130,65131,[65281,3],[65285,3],[65290,3,2],65295,65306,65307,65311,65312,65340,65377,65380,65381,65792,65793,66463,66512,67671,67871,67903,[68176,9],68223,[68409,7],69819,69820,[69822,4],[74864,4]],Sc:[36,[162,4],1547,2546,2547,2555,2801,3065,3647,6107,[8352,25],43064,65020,65129,65284,65504,65505,65509,65510],Ps:[40,91,123,3898,3900,5787,8218,8222,8261,8317,8333,9001,[10088,7,2],10181,[10214,5,2],[10627,11,2],10712,10714,10748,[11810,4,2],[12296,5,2],[12308,4,2],12317,64830,65047,[65077,8,2],65095,[65113,3,2],65288,65339,65371,65375,65378],Pe:[41,93,125,3899,3901,5788,8262,8318,8334,9002,[10089,7,2],10182,[10215,5,2],[10628,11,2],10713,10715,10749,[11811,4,2],[12297,5,2],[12309,4,2],12318,12319,64831,65048,[65078,8,2],65096,[65114,3,2],65289,65341,[65373,3,3]],Sm:[43,[60,3],124,126,172,177,215,247,1014,[1542,3],8260,8274,[8314,3],[8330,3],[8512,5],8523,[8592,5],8602,8603,[8608,3,3],8622,8654,8655,8658,8660,[8692,268],[8968,4],8992,8993,9084,[9115,25],[9180,6],9655,9665,[9720,8],9839,[10176,5],[10183,4],10188,[10192,22],[10224,16],[10496,131],[10649,63],[10716,32],[10750,258],[11056,21],[11079,6],64297,65122,[65124,3],65291,[65308,3],65372,65374,65506,[65513,4],120513,120539,120571,120597,120629,120655,120687,120713,120745,120771],Pd:[45,1418,1470,5120,6150,[8208,6],11799,11802,12316,12336,12448,65073,65074,65112,65123,65293],Nd:[[48,10],[1632,10],[1776,10],[1984,10],[2406,10],[2534,10],[2662,10],[2790,10],[2918,10],[3046,10],[3174,10],[3302,10],[3430,10],[3664,10],[3792,10],[3872,10],[4160,10],[4240,10],[6112,10],[6160,10],[6470,10],[6608,11],[6784,10],[6800,10],[6992,10],[7088,10],[7232,10],[7248,10],[42528,10],[43216,10],[43264,10],[43472,10],[43600,10],[44016,10],[65296,10],[66720,10],[120782,50]],Lu:[[65,26],[192,23],[216,7],[256,28,2],[313,8,2],[330,24,2],[377,3,2],385,[386,3,2],391,[393,3],[398,4],403,404,[406,3],412,413,415,[416,4,2],423,425,428,430,431,[433,3],437,439,440,444,[452,4,3],[463,7,2],[478,9,2],497,500,[502,3],[506,29,2],570,571,573,574,577,[579,4],[584,4,2],880,882,886,902,[904,3],908,910,911,[913,17],[931,9],975,[978,3],[984,12,2],1012,1015,1017,1018,[1021,51],[1120,17,2],[1162,28,2],[1217,7,2],[1232,43,2],[1329,38],[4256,38],[7680,75,2],[7838,49,2],[7944,8],[7960,6],[7976,8],[7992,8],[8008,6],[8025,4,2],[8040,8],[8120,4],[8136,4],[8152,4],[8168,5],[8184,4],8450,8455,[8459,3],[8464,3],8469,[8473,5],[8484,4,2],[8491,3],[8496,4],8510,8511,8517,8579,[11264,47],11360,[11362,3],[11367,4,2],[11374,3],11378,11381,[11390,3],[11394,49,2],11499,11501,[42560,16,2],[42594,6,2],[42624,12,2],[42786,7,2],[42802,31,2],[42873,3,2],[42878,5,2],42891,[65313,26],[66560,40],[119808,26],[119860,26],[119912,26],119964,119966,[119967,3,3],119974,[119977,4],[119982,8],[120016,26],120068,120069,[120071,4],[120077,8],[120086,7],120120,120121,[120123,4],[120128,5],120134,[120138,7],[120172,26],[120224,26],[120276,26],[120328,26],[120380,26],[120432,26],[120488,25],[120546,25],[120604,25],[120662,25],[120720,25],120778],Sk:[94,96,168,175,180,184,[706,4],[722,14],[741,7],749,[751,17],885,900,901,8125,[8127,3],[8141,3],[8157,3],[8173,3],8189,8190,12443,12444,[42752,23],42784,42785,42889,42890,65342,65344,65507],Pc:[95,8255,8256,8276,65075,65076,[65101,3],65343],Ll:[[97,26],170,181,186,[223,24],[248,8],[257,28,2],[312,9,2],[329,24,2],[378,3,2],383,384,387,389,392,396,397,402,405,[409,3],414,[417,3,2],424,426,427,429,432,436,438,441,442,[445,3],[454,3,3],[462,8,2],[477,10,2],496,499,501,[505,30,2],[564,6],572,575,576,578,[583,5,2],[592,68],[661,27],881,[883,3,4],892,893,912,[940,35],976,977,[981,3],[985,12,2],[1008,4],[1013,3,3],1020,[1072,48],[1121,17,2],[1163,27,2],[1218,7,2],[1231,44,2],[1377,39],[7424,44],[7522,22],[7545,34],[7681,75,2],[7830,8],[7839,49,2],[7936,8],[7952,6],[7968,8],[7984,8],[8e3,6],[8016,8],[8032,8],[8048,14],[8064,8],[8080,8],[8096,8],[8112,5],8118,8119,8126,[8130,3],8134,8135,[8144,4],8150,8151,[8160,8],[8178,3],8182,8183,8458,8462,8463,8467,[8495,3,5],8508,8509,[8518,4],8526,8580,[11312,47],11361,11365,[11366,4,2],11377,11379,11380,[11382,7],[11393,50,2],11492,11500,11502,[11520,38],[42561,16,2],[42595,6,2],[42625,12,2],[42787,7,2],42800,[42801,33,2],[42866,7],42874,42876,[42879,5,2],42892,[64256,7],[64275,5],[65345,26],[66600,40],[119834,26],[119886,7],[119894,18],[119938,26],[119990,4],119995,[119997,7],[120005,11],[120042,26],[120094,26],[120146,26],[120198,26],[120250,26],[120302,26],[120354,26],[120406,26],[120458,28],[120514,25],[120540,6],[120572,25],[120598,6],[120630,25],[120656,6],[120688,25],[120714,6],[120746,25],[120772,6],120779],So:[166,167,169,174,176,182,1154,1550,1551,1769,1789,1790,2038,2554,2928,[3059,6],3066,3199,3313,3314,3449,[3841,3],[3859,5],[3866,6],[3892,3,2],[4030,8],[4039,6],4046,4047,[4053,4],4254,4255,4960,[5008,10],6464,[6624,32],[7009,10],[7028,9],8448,8449,[8451,4],8456,8457,8468,[8470,3],[8478,6],[8485,3,2],8494,8506,8507,8522,8524,8525,8527,[8597,5],[8604,4],8609,8610,8612,8613,[8615,7],[8623,31],8656,[8657,3,2],[8662,30],[8960,8],[8972,20],[8994,7],[9003,81],[9085,30],[9140,40],[9186,7],[9216,39],[9280,11],[9372,78],[9472,183],[9656,9],[9666,54],[9728,111],[9840,94],[9935,19],9955,[9960,24],[9985,4],[9990,4],[9996,28],[10025,35],10061,[10063,4],[10070,9],[10081,7],10132,[10136,24],[10161,14],[10240,256],[11008,48],11077,11078,[11088,10],[11493,6],[11904,26],[11931,89],[12032,214],[12272,12],12292,12306,12307,12320,12342,12343,12350,12351,12688,12689,[12694,10],[12736,36],[12800,31],[12842,39],[12896,32],[12938,39],[12992,63],[13056,256],[19904,64],[42128,55],[43048,4],43062,43063,43065,[43639,3],65021,65508,65512,65517,65518,65532,65533,65794,[65847,9],[65913,17],[65936,12],[66e3,45],[118784,246],[119040,39],[119081,60],[119146,3],119171,119172,[119180,30],[119214,48],[119296,66],119365,[119552,87],[126976,44],[127024,100],[127248,31],127281,127293,127295,[127298,3,4],[127307,4],127319,127327,127353,127355,127356,127359,[127370,4],127376,127488,[127504,34],[127552,9]],Pi:[171,8216,8219,8220,8223,8249,11778,11780,11785,11788,11804,11808],Cf:[173,[1536,4],1757,1807,6068,6069,[8203,5],[8234,5],[8288,5],[8298,6],65279,[65529,3],69821,[119155,8],917505,[917536,96]],No:[178,179,185,[188,3],[2548,6],[3056,3],[3192,7],[3440,6],[3882,10],[4969,20],[6128,10],8304,[8308,6],[8320,10],[8528,16],8585,[9312,60],[9450,22],[10102,30],11517,[12690,4],[12832,10],[12881,15],[12928,10],[12977,15],[43056,6],[65799,45],[65909,4],65930,[66336,4],[67672,8],[67862,6],[68160,8],68221,68222,[68440,8],[68472,8],[69216,31],[119648,18],[127232,11]],Pf:[187,8217,8221,8250,11779,11781,11786,11789,11805,11809],Lo:[443,[448,4],660,[1488,27],[1520,3],[1569,31],[1601,10],1646,1647,[1649,99],1749,1774,1775,[1786,3],1791,1808,[1810,30],[1869,89],1969,[1994,33],[2048,22],[2308,54],2365,2384,[2392,10],2418,[2425,7],[2437,8],2447,2448,[2451,22],[2474,7],2482,[2486,4],2493,2510,2524,2525,[2527,3],2544,2545,[2565,6],2575,2576,[2579,22],[2602,7],2610,2611,2613,2614,2616,2617,[2649,4],2654,[2674,3],[2693,9],[2703,3],[2707,22],[2730,7],2738,2739,[2741,5],2749,2768,2784,2785,[2821,8],2831,2832,[2835,22],[2858,7],2866,2867,[2869,5],2877,2908,2909,[2911,3],2929,2947,[2949,6],[2958,3],[2962,4],2969,[2970,3,2],2975,2979,2980,[2984,3],[2990,12],3024,[3077,8],[3086,3],[3090,23],[3114,10],[3125,5],3133,3160,3161,3168,3169,[3205,8],[3214,3],[3218,23],[3242,10],[3253,5],3261,3294,3296,3297,[3333,8],[3342,3],[3346,23],[3370,16],3389,3424,3425,[3450,6],[3461,18],[3482,24],[3507,9],3517,[3520,7],[3585,48],3634,3635,[3648,6],3713,3714,3716,3719,3720,3722,3725,[3732,4],[3737,7],[3745,3],3749,3751,3754,3755,[3757,4],3762,3763,3773,[3776,5],3804,3805,3840,[3904,8],[3913,36],[3976,4],[4096,43],4159,[4176,6],[4186,4],4193,4197,4198,[4206,3],[4213,13],4238,[4304,43],[4352,329],[4682,4],[4688,7],4696,[4698,4],[4704,41],[4746,4],[4752,33],[4786,4],[4792,7],4800,[4802,4],[4808,15],[4824,57],[4882,4],[4888,67],[4992,16],[5024,85],[5121,620],[5743,17],[5761,26],[5792,75],[5888,13],[5902,4],[5920,18],[5952,18],[5984,13],[5998,3],[6016,52],6108,[6176,35],[6212,52],[6272,41],6314,[6320,70],[6400,29],[6480,30],[6512,5],[6528,44],[6593,7],[6656,23],[6688,53],[6917,47],[6981,7],[7043,30],7086,7087,[7168,36],[7245,3],[7258,30],[7401,4],[7406,4],[8501,4],[11568,54],[11648,23],[11680,7],[11688,7],[11696,7],[11704,7],[11712,7],[11720,7],[11728,7],[11736,7],12294,12348,[12353,86],12447,[12449,90],12543,[12549,41],[12593,94],[12704,24],[12784,16],13312,19893,19968,40907,[40960,21],[40982,1143],[42192,40],[42240,268],[42512,16],42538,42539,42606,[42656,70],[43003,7],[43011,3],[43015,4],[43020,23],[43072,52],[43138,50],[43250,6],43259,[43274,28],[43312,23],[43360,29],[43396,47],[43520,41],[43584,3],[43588,8],[43616,16],[43633,6],43642,[43648,48],43697,43701,43702,[43705,5],43712,43714,43739,43740,[43968,35],44032,55203,[55216,23],[55243,49],[63744,302],[64048,62],[64112,106],64285,[64287,10],[64298,13],[64312,5],64318,64320,64321,64323,64324,[64326,108],[64467,363],[64848,64],[64914,54],[65008,12],[65136,5],[65142,135],[65382,10],[65393,45],[65440,31],[65474,6],[65482,6],[65490,6],[65498,3],[65536,12],[65549,26],[65576,19],65596,65597,[65599,15],[65616,14],[65664,123],[66176,29],[66208,49],[66304,31],[66352,17],[66370,8],[66432,30],[66464,36],[66504,8],[66640,78],[67584,6],67592,[67594,44],67639,67640,67644,[67647,23],[67840,22],[67872,26],68096,[68112,4],[68117,3],[68121,27],[68192,29],[68352,54],[68416,22],[68448,19],[68608,73],[69763,45],[73728,879],[77824,1071],131072,173782,173824,177972,[194560,542]],Lt:[[453,3,3],498,[8072,8],[8088,8],[8104,8],8124,8140,8188],Lm:[[688,18],[710,12],[736,5],748,750,884,890,1369,1600,1765,1766,2036,2037,2042,2074,2084,2088,2417,3654,3782,4348,6103,6211,6823,[7288,6],[7468,54],7544,[7579,37],8305,8319,[8336,5],11389,11631,11823,12293,[12337,5],12347,12445,12446,[12540,3],40981,[42232,6],42508,42623,[42775,9],42864,42888,43471,43632,43741,65392,65438,65439],Mn:[[768,112],[1155,5],[1425,45],1471,1473,1474,1476,1477,1479,[1552,11],[1611,20],1648,[1750,7],[1759,6],1767,1768,[1770,4],1809,[1840,27],[1958,11],[2027,9],[2070,4],[2075,9],[2085,3],[2089,5],[2304,3],2364,[2369,8],2381,[2385,5],2402,2403,2433,2492,[2497,4],2509,2530,2531,2561,2562,2620,2625,2626,2631,2632,[2635,3],2641,2672,2673,2677,2689,2690,2748,[2753,5],2759,2760,2765,2786,2787,2817,2876,2879,[2881,4],2893,2902,2914,2915,2946,3008,3021,[3134,3],[3142,3],[3146,4],3157,3158,3170,3171,3260,3263,3270,3276,3277,3298,3299,[3393,4],3405,3426,3427,3530,[3538,3],3542,3633,[3636,7],[3655,8],3761,[3764,6],3771,3772,[3784,6],3864,3865,[3893,3,2],[3953,14],[3968,5],3974,3975,[3984,8],[3993,36],4038,[4141,4],[4146,6],4153,4154,4157,4158,4184,4185,[4190,3],[4209,4],4226,4229,4230,4237,4253,4959,[5906,3],[5938,3],5970,5971,6002,6003,[6071,7],6086,[6089,11],6109,[6155,3],6313,[6432,3],6439,6440,6450,[6457,3],6679,6680,6742,[6744,7],6752,6754,[6757,8],[6771,10],6783,[6912,4],6964,[6966,5],6972,6978,[7019,9],7040,7041,[7074,4],7080,7081,[7212,8],7222,7223,[7376,3],[7380,13],[7394,7],7405,[7616,39],[7677,3],[8400,13],8417,[8421,12],[11503,3],[11744,32],[12330,6],12441,12442,42607,42620,42621,42736,42737,43010,43014,43019,43045,43046,43204,[43232,18],[43302,8],[43335,11],[43392,3],43443,[43446,4],43452,[43561,6],43569,43570,43573,43574,43587,43596,43696,[43698,3],43703,43704,43710,43711,43713,44005,44008,44013,64286,[65024,16],[65056,7],66045,[68097,3],68101,68102,[68108,4],[68152,3],68159,69760,69761,[69811,4],69817,69818,[119143,3],[119163,8],[119173,7],[119210,4],[119362,3],[917760,240]],Me:[1160,1161,1758,[8413,4],[8418,3],[42608,3]],Mc:[2307,[2366,3],[2377,4],2382,2434,2435,[2494,3],2503,2504,2507,2508,2519,2563,[2622,3],2691,[2750,3],2761,2763,2764,2818,2819,2878,2880,2887,2888,2891,2892,2903,3006,3007,3009,3010,[3014,3],[3018,3],3031,[3073,3],[3137,4],3202,3203,3262,[3264,5],3271,3272,3274,3275,3285,3286,3330,3331,[3390,3],[3398,3],[3402,3],3415,3458,3459,[3535,3],[3544,8],3570,3571,3902,3903,3967,4139,4140,4145,4152,4155,4156,4182,4183,[4194,3],[4199,7],4227,4228,[4231,6],4239,[4250,3],6070,[6078,8],6087,6088,[6435,4],[6441,3],6448,6449,[6451,6],[6576,17],6600,6601,[6681,3],6741,6743,6753,6755,6756,[6765,6],6916,6965,6971,[6973,5],6979,6980,7042,7073,7078,7079,7082,[7204,8],7220,7221,7393,7410,43043,43044,43047,43136,43137,[43188,16],43346,43347,43395,43444,43445,43450,43451,[43453,4],43567,43568,43571,43572,43597,43643,44003,44004,44006,44007,44009,44010,44012,69762,[69808,3],69815,69816,119141,119142,[119149,6]],Nl:[[5870,3],[8544,35],[8581,4],12295,[12321,9],[12344,3],[42726,10],[65856,53],66369,66378,[66513,5],[74752,99]],Zl:[8232],Zp:[8233],Cs:[55296,56191,56192,56319,56320,57343],Co:[57344,63743,983040,1048573,1048576,1114109],digits:[[48,10],178,179,185,[1632,10],[1776,10],[1984,10],[2406,10],[2534,10],[2662,10],[2790,10],[2918,10],[3046,10],[3174,10],[3302,10],[3430,10],[3558,10],[3664,10],[3792,10],[3872,10],[4160,10],[4240,10],[4969,9],[6112,10],[6160,10],[6470,10],[6608,11],[6784,10],[6800,10],[6992,10],[7088,10],[7232,10],[7248,10],8304,[8308,6],[8320,10],[9312,9],[9332,9],[9352,9],9450,[9461,9],9471,[10102,9],[10112,9],[10122,9],[42528,10],[43216,10],[43264,10],[43472,10],[43504,10],[43600,10],[44016,10],[65296,10],[66720,10],[68160,4],[68912,10],[69216,9],[69714,9],[69734,10],[69872,10],[69942,10],[70096,10],[70384,10],[70736,10],[70864,10],[71248,10],[71360,10],[71472,10],[71904,10],[72784,10],[73040,10],[73120,10],[92768,10],[93008,10],[120782,50],[123200,10],[123632,10],[125264,10],[127232,11]],numeric:[[48,10],178,179,185,[188,3],[1632,10],[1776,10],[1984,10],[2406,10],[2534,10],[2548,6],[2662,10],[2790,10],[2918,10],[2930,6],[3046,13],[3174,10],[3192,7],[3302,10],[3416,7],[3430,19],[3558,10],[3664,10],[3792,10],[3872,20],[4160,10],[4240,10],[4969,20],[5870,3],[6112,10],[6128,10],[6160,10],[6470,10],[6608,11],[6784,10],[6800,10],[6992,10],[7088,10],[7232,10],[7248,10],8304,[8308,6],[8320,10],[8528,51],[8581,5],[9312,60],[9450,22],[10102,30],11517,12295,[12321,9],[12344,3],[12690,4],[12832,10],[12872,8],[12881,15],[12928,10],[12977,15],13317,13443,14378,15181,19968,19971,19975,19977,20061,20108,20116,20118,20159,20160,20191,20200,20237,20336,20740,20806,[20841,3,2],21313,[21315,3],21324,[21441,4],22235,22769,22777,24186,24318,24319,[24332,3],24336,25342,25420,26578,28422,29590,30334,32902,33836,36014,36019,36144,38433,38470,38476,38520,38646,[42528,10],[42726,10],[43056,6],[43216,10],[43264,10],[43472,10],[43504,10],[43600,10],[44016,10],63851,63859,63864,63922,63953,63955,63997,[65296,10],[65799,45],[65856,57],65930,65931,[66273,27],[66336,4],66369,66378,[66513,5],[66720,10],[67672,8],[67705,7],[67751,9],[67835,5],[67862,6],68028,68029,[68032,16],[68050,46],[68160,9],68221,68222,[68253,3],[68331,5],[68440,8],[68472,8],[68521,7],[68858,6],[68912,10],[69216,31],[69405,10],[69457,4],[69714,30],[69872,10],[69942,10],[70096,10],[70113,20],[70384,10],[70736,10],[70864,10],[71248,10],[71360,10],[71472,12],[71904,19],[72784,29],[73040,10],[73120,10],[73664,21],[74752,111],[92768,10],[93008,10],[93019,7],[93824,23],[119520,20],[119648,25],[120782,50],[123200,10],[123632,10],[125127,9],[125264,10],[126065,59],[126125,3],[126129,4],[126209,45],[126255,15],[127232,13],131073,131172,131298,131361,133418,133507,133516,133532,133866,133885,133913,140176,141720,146203,156269,194704],Cn:[[888,2],[896,4],[907,1],[909,1],[930,1],[1328,1],[1367,2],[1419,2],[1424,1],[1480,8],[1515,4],[1525,11],[1565,1],[1806,1],[1867,2],[1970,14],[2043,2],[2094,2],[2111,1],[2140,2],[2143,1],[2155,53],[2229,1],[2238,21],[2436,1],[2445,2],[2449,2],[2473,1],[2481,1],[2483,3],[2490,2],[2501,2],[2505,2],[2511,8],[2520,4],[2526,1],[2532,2],[2559,2],[2564,1],[2571,4],[2577,2],[2601,1],[2609,1],[2612,1],[2615,1],[2618,2],[2621,1],[2627,4],[2633,2],[2638,3],[2642,7],[2653,1],[2655,7],[2679,10],[2692,1],[2702,1],[2706,1],[2729,1],[2737,1],[2740,1],[2746,2],[2758,1],[2762,1],[2766,2],[2769,15],[2788,2],[2802,7],[2816,1],[2820,1],[2829,2],[2833,2],[2857,1],[2865,1],[2868,1],[2874,2],[2885,2],[2889,2],[2894,8],[2904,4],[2910,1],[2916,2],[2936,10],[2948,1],[2955,3],[2961,1],[2966,3],[2971,1],[2973,1],[2976,3],[2981,3],[2987,3],[3002,4],[3011,3],[3017,1],[3022,2],[3025,6],[3032,14],[3067,5],[3085,1],[3089,1],[3113,1],[3130,3],[3141,1],[3145,1],[3150,7],[3159,1],[3163,5],[3172,2],[3184,7],[3213,1],[3217,1],[3241,1],[3252,1],[3258,2],[3269,1],[3273,1],[3278,7],[3287,7],[3295,1],[3300,2],[3312,1],[3315,13],[3332,1],[3341,1],[3345,1],[3397,1],[3401,1],[3408,4],[3428,2],[3456,2],[3460,1],[3479,3],[3506,1],[3516,1],[3518,2],[3527,3],[3531,4],[3541,1],[3543,1],[3552,6],[3568,2],[3573,12],[3643,4],[3676,37],[3715,1],[3717,1],[3723,1],[3748,1],[3750,1],[3774,2],[3781,1],[3783,1],[3790,2],[3802,2],[3808,32],[3912,1],[3949,4],[3992,1],[4029,1],[4045,1],[4059,37],[4294,1],[4296,5],[4302,2],[4681,1],[4686,2],[4695,1],[4697,1],[4702,2],[4745,1],[4750,2],[4785,1],[4790,2],[4799,1],[4801,1],[4806,2],[4823,1],[4881,1],[4886,2],[4955,2],[4989,3],[5018,6],[5110,2],[5118,2],[5789,3],[5881,7],[5901,1],[5909,11],[5943,9],[5972,12],[5997,1],[6001,1],[6004,12],[6110,2],[6122,6],[6138,6],[6159,1],[6170,6],[6265,7],[6315,5],[6390,10],[6431,1],[6444,4],[6460,4],[6465,3],[6510,2],[6517,11],[6572,4],[6602,6],[6619,3],[6684,2],[6751,1],[6781,2],[6794,6],[6810,6],[6830,2],[6847,65],[6988,4],[7037,3],[7156,8],[7224,3],[7242,3],[7305,7],[7355,2],[7368,8],[7419,5],[7674,1],[7958,2],[7966,2],[8006,2],[8014,2],[8024,1],[8026,1],[8028,1],[8030,1],[8062,2],[8117,1],[8133,1],[8148,2],[8156,1],[8176,2],[8181,1],[8191,1],[8293,1],[8306,2],[8335,1],[8349,3],[8384,16],[8433,15],[8588,4],[9255,25],[9291,21],[11124,2],[11158,2],[11311,1],[11359,1],[11508,5],[11558,1],[11560,5],[11566,2],[11624,7],[11633,14],[11671,9],[11687,1],[11695,1],[11703,1],[11711,1],[11719,1],[11727,1],[11735,1],[11743,1],[11856,48],[11930,1],[12020,12],[12246,26],[12284,4],[12352,1],[12439,2],[12544,5],[12592,1],[12687,1],[12731,5],[12772,12],[12831,1],[19894,10],[40944,16],[42125,3],[42183,9],[42540,20],[42744,8],[42944,2],[42951,48],[43052,4],[43066,6],[43128,8],[43206,8],[43226,6],[43348,11],[43389,3],[43470,1],[43482,4],[43519,1],[43575,9],[43598,2],[43610,2],[43715,24],[43767,10],[43783,2],[43791,2],[43799,9],[43815,1],[43823,1],[43880,8],[44014,2],[44026,6],[55204,12],[55239,4],[55292,4],[64110,2],[64218,38],[64263,12],[64280,5],[64311,1],[64317,1],[64319,1],[64322,1],[64325,1],[64450,17],[64832,16],[64912,2],[64968,40],[65022,2],[65050,6],[65107,1],[65127,1],[65132,4],[65141,1],[65277,2],[65280,1],[65471,3],[65480,2],[65488,2],[65496,2],[65501,3],[65511,1],[65519,10],[65534,2],[65548,1],[65575,1],[65595,1],[65598,1],[65614,2],[65630,34],[65787,5],[65795,4],[65844,3],[65935,1],[65948,4],[65953,47],[66046,130],[66205,3],[66257,15],[66300,4],[66340,9],[66379,5],[66427,5],[66462,1],[66500,4],[66518,42],[66718,2],[66730,6],[66772,4],[66812,4],[66856,8],[66916,11],[66928,144],[67383,9],[67414,10],[67432,152],[67590,2],[67593,1],[67638,1],[67641,3],[67645,2],[67670,1],[67743,8],[67760,48],[67827,1],[67830,5],[67868,3],[67898,5],[67904,64],[68024,4],[68048,2],[68100,1],[68103,5],[68116,1],[68120,1],[68150,2],[68155,4],[68169,7],[68185,7],[68256,32],[68327,4],[68343,9],[68406,3],[68438,2],[68467,5],[68498,7],[68509,12],[68528,80],[68681,55],[68787,13],[68851,7],[68904,8],[68922,294],[69247,129],[69416,8],[69466,134],[69623,9],[69710,4],[69744,15],[69826,11],[69838,2],[69865,7],[69882,6],[69941,1],[69959,9],[70007,9],[70094,2],[70112,1],[70133,11],[70162,1],[70207,65],[70279,1],[70281,1],[70286,1],[70302,1],[70314,6],[70379,5],[70394,6],[70404,1],[70413,2],[70417,2],[70441,1],[70449,1],[70452,1],[70458,1],[70469,2],[70473,2],[70478,2],[70481,6],[70488,5],[70500,2],[70509,3],[70517,139],[70746,1],[70748,1],[70752,32],[70856,8],[70874,166],[71094,2],[71134,34],[71237,11],[71258,6],[71277,19],[71353,7],[71370,54],[71451,2],[71468,4],[71488,192],[71740,100],[71923,12],[71936,160],[72104,2],[72152,2],[72165,27],[72264,8],[72355,29],[72441,263],[72713,1],[72759,1],[72774,10],[72813,3],[72848,2],[72872,1],[72887,73],[72967,1],[72970,1],[73015,3],[73019,1],[73022,1],[73032,8],[73050,6],[73062,1],[73065,1],[73103,1],[73106,1],[73113,7],[73130,310],[73465,199],[73714,13],[74650,102],[74863,1],[74869,11],[75076,2748],[78895,1],[78905,4039],[83527,8633],[92729,7],[92767,1],[92778,4],[92784,96],[92910,2],[92918,10],[92998,10],[93018,1],[93026,1],[93048,5],[93072,688],[93851,101],[94027,4],[94088,7],[94112,64],[94180,28],[100344,8],[101107,9485],[110879,49],[110931,17],[110952,8],[111356,2308],[113771,5],[113789,3],[113801,7],[113818,2],[113828,4956],[119030,10],[119079,2],[119273,23],[119366,154],[119540,12],[119639,9],[119673,135],[119893,1],[119965,1],[119968,2],[119971,2],[119975,2],[119981,1],[119994,1],[119996,1],[120004,1],[120070,1],[120075,2],[120085,1],[120093,1],[120122,1],[120127,1],[120133,1],[120135,3],[120145,1],[120486,2],[120780,2],[121484,15],[121504,1],[121520,1360],[122887,1],[122905,2],[122914,1],[122917,1],[122923,213],[123181,3],[123198,2],[123210,4],[123216,368],[123642,5],[123648,1280],[125125,2],[125143,41],[125260,4],[125274,4],[125280,785],[126133,76],[126270,194],[126468,1],[126496,1],[126499,1],[126501,2],[126504,1],[126515,1],[126520,1],[126522,1],[126524,6],[126531,4],[126536,1],[126538,1],[126540,1],[126544,1],[126547,1],[126549,2],[126552,1],[126554,1],[126556,1],[126558,1],[126560,1],[126563,1],[126565,2],[126571,1],[126579,1],[126584,1],[126589,1],[126591,1],[126602,1],[126620,5],[126628,1],[126634,1],[126652,52],[126706,270],[127020,4],[127124,12],[127151,2],[127168,1],[127184,1],[127222,10],[127245,3],[127341,3],[127405,57],[127491,13],[127548,4],[127561,7],[127570,14],[127590,154],[128726,10],[128749,3],[128763,5],[128884,12],[128985,7],[129004,20],[129036,4],[129096,8],[129114,6],[129160,8],[129198,82],[129292,1],[129394,1],[129399,3],[129443,2],[129451,3],[129483,2],[129620,12],[129646,2],[129652,4],[129659,5],[129667,13],[129686,1386],[173783,41],[177973,11],[178206,2],[183970,14],[191457,3103],[195102,722403],[917506,30],[917632,128],[918e3,65040],[1048574,2]]},$B.unicode_casefold={223:[115,115],304:[105,775],329:[700,110],496:[106,780],912:[953,776,769],944:[965,776,769],1415:[1381,1410],7830:[104,817],7831:[116,776],7832:[119,778],7833:[121,778],7834:[97,702],7838:[223],8016:[965,787],8018:[965,787,768],8020:[965,787,769],8022:[965,787,834],8064:[7936,953],8065:[7937,953],8066:[7938,953],8067:[7939,953],8068:[7940,953],8069:[7941,953],8070:[7942,953],8071:[7943,953],8072:[8064],8073:[8065],8074:[8066],8075:[8067],8076:[8068],8077:[8069],8078:[8070],8079:[8071],8080:[7968,953],8081:[7969,953],8082:[7970,953],8083:[7971,953],8084:[7972,953],8085:[7973,953],8086:[7974,953],8087:[7975,953],8088:[8080],8089:[8081],8090:[8082],8091:[8083],8092:[8084],8093:[8085],8094:[8086],8095:[8087],8096:[8032,953],8097:[8033,953],8098:[8034,953],8099:[8035,953],8100:[8036,953],8101:[8037,953],8102:[8038,953],8103:[8039,953],8104:[8096],8105:[8097],8106:[8098],8107:[8099],8108:[8100],8109:[8101],8110:[8102],8111:[8103],8114:[8048,953],8115:[945,953],8116:[940,953],8118:[945,834],8119:[945,834,953],8124:[8115],8130:[8052,953],8131:[951,953],8132:[942,953],8134:[951,834],8135:[951,834,953],8140:[8131],8146:[953,776,768],8147:[953,776,769],8150:[953,834],8151:[953,776,834],8162:[965,776,768],8163:[965,776,769],8164:[961,787],8166:[965,834],8167:[965,776,834],8178:[8060,953],8179:[969,953],8180:[974,953],8182:[969,834],8183:[969,834,953],8188:[8179],64256:[102,102],64257:[102,105],64258:[102,108],64259:[102,102,105],64260:[102,102,108],64261:[115,116],64262:[115,116],64275:[1396,1398],64276:[1396,1381],64277:[1396,1387],64278:[1406,1398],64279:[1396,1389]},$B.unicode_bidi_whitespace=[9,10,11,12,13,28,29,30,31,32,133,5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8287,12288],$B.unicode_identifiers={XID_Start:[95,[65,26],[97,26],170,181,186,[192,23],[216,31],[248,458],[710,12],[736,5],748,750,[880,5],[886,2],[891,3],902,[904,3],908,[910,20],[931,83],[1015,139],[1162,156],[1329,38],1369,[1377,39],[1488,27],[1520,3],[1569,42],[1646,2],[1649,99],1749,[1765,2],[1774,2],[1786,3],1791,1808,[1810,30],[1869,89],1969,[1994,33],[2036,2],2042,[2048,22],2074,2084,2088,[2308,54],2365,2384,[2392,10],2417,2418,[2425,7],[2437,8],[2447,2],[2451,22],[2474,7],2482,[2486,4],2493,2510,[2524,2],[2527,3],[2544,2],[2565,6],[2575,2],[2579,22],[2602,7],[2610,2],[2613,2],[2616,2],[2649,4],2654,[2674,3],[2693,9],[2703,3],[2707,22],[2730,7],[2738,2],[2741,5],2749,2768,[2784,2],[2821,8],[2831,2],[2835,22],[2858,7],[2866,2],[2869,5],2877,[2908,2],[2911,3],2929,2947,[2949,6],[2958,3],[2962,4],[2969,2],2972,[2974,2],[2979,2],[2984,3],[2990,12],3024,[3077,8],[3086,3],[3090,23],[3114,10],[3125,5],3133,[3160,2],[3168,2],[3205,8],[3214,3],[3218,23],[3242,10],[3253,5],3261,3294,[3296,2],[3333,8],[3342,3],[3346,23],[3370,16],3389,[3424,2],[3450,6],[3461,18],[3482,24],[3507,9],3517,[3520,7],[3585,48],3634,[3648,7],[3713,2],3716,[3719,2],3722,3725,[3732,4],[3737,7],[3745,3],3749,3751,[3754,2],[3757,4],3762,3773,[3776,5],3782,[3804,2],3840,[3904,8],[3913,36],[3976,4],[4096,43],4159,[4176,6],[4186,4],4193,[4197,2],[4206,3],[4213,13],4238,[4256,38],[4304,43],4348,[4352,329],[4682,4],[4688,7],4696,[4698,4],[4704,41],[4746,4],[4752,33],[4786,4],[4792,7],4800,[4802,4],[4808,15],[4824,57],[4882,4],[4888,67],[4992,16],[5024,85],[5121,620],[5743,17],[5761,26],[5792,75],[5870,3],[5888,13],[5902,4],[5920,18],[5952,18],[5984,13],[5998,3],[6016,52],6103,6108,[6176,88],[6272,41],6314,[6320,70],[6400,29],[6480,30],[6512,5],[6528,44],[6593,7],[6656,23],[6688,53],6823,[6917,47],[6981,7],[7043,30],[7086,2],[7168,36],[7245,3],[7258,36],[7401,4],[7406,4],[7424,192],[7680,278],[7960,6],[7968,38],[8008,6],[8016,8],8025,8027,8029,[8031,31],[8064,53],[8118,7],8126,[8130,3],[8134,7],[8144,4],[8150,6],[8160,13],[8178,3],[8182,7],8305,8319,[8336,5],8450,8455,[8458,10],8469,8472,[8473,5],8484,8486,8488,[8490,16],[8508,4],[8517,5],8526,[8544,41],[11264,47],[11312,47],[11360,133],[11499,4],[11520,38],[11568,54],11631,[11648,23],[11680,7],[11688,7],[11696,7],[11704,7],[11712,7],[11720,7],[11728,7],[11736,7],12293,12294,12295,[12321,9],[12337,5],[12344,5],[12353,86],[12445,3],[12449,90],[12540,4],[12549,41],[12593,94],[12704,24],[12784,16],[13312,6582],[19968,20940],[40960,1165],[42192,46],[42240,269],[42512,16],[42538,2],[42560,32],[42594,13],42623,[42624,24],[42656,80],[42775,9],[42786,103],[42891,2],[43003,7],[43011,3],[43015,4],[43020,23],[43072,52],[43138,50],[43250,6],43259,[43274,28],[43312,23],[43360,29],[43396,47],43471,[43520,41],[43584,3],[43588,8],[43616,23],43642,[43648,48],43697,[43701,2],[43705,5],43712,43714,[43739,3],[43968,35],[44032,11172],[55216,23],[55243,49],[63744,302],[64048,62],[64112,106],[64256,7],[64275,5],64285,[64287,10],[64298,13],[64312,5],64318,[64320,2],[64323,2],[64326,108],[64467,139],[64612,218],[64848,64],[64914,54],[65008,10],65137,65139,65143,65145,65147,65149,[65151,126],[65313,26],[65345,26],[65382,56],[65440,31],[65474,6],[65482,6],[65490,6],[65498,3],[65536,12],[65549,26],[65576,19],[65596,2],[65599,15],[65616,14],[65664,123],[65856,53],[66176,29],[66208,49],[66304,31],[66352,27],[66432,30],[66464,36],[66504,8],[66513,5],[66560,158],[67584,6],67592,[67594,44],[67639,2],67644,[67647,23],[67840,22],[67872,26],68096,[68112,4],[68117,3],[68121,27],[68192,29],[68352,54],[68416,22],[68448,19],[68608,73],[69763,45],[73728,879],[74752,99],[77824,1071],[119808,85],[119894,71],[119966,2],119970,[119973,2],[119977,4],[119982,12],119995,[119997,7],[120005,65],[120071,4],[120077,8],[120086,7],[120094,28],[120123,4],[120128,5],120134,[120138,7],[120146,340],[120488,25],[120514,25],[120540,31],[120572,25],[120598,31],[120630,25],[120656,31],[120688,25],[120714,31],[120746,25],[120772,8],[131072,42711],[173824,4149],[194560,542]],XID_Continue:[[48,10],[65,26],95,[97,26],170,181,183,186,[192,23],[216,31],[248,458],[710,12],[736,5],748,750,[768,117],[886,2],[891,3],902,903,[904,3],908,[910,20],[931,83],[1015,139],[1155,5],[1162,156],[1329,38],1369,[1377,39],[1425,45],1471,[1473,2],[1476,2],1479,[1488,27],[1520,3],[1552,11],[1569,62],[1632,10],[1646,102],1749,[1750,7],[1759,10],[1770,19],1791,1808,1809,[1810,57],[1869,101],[1984,54],2042,[2048,46],[2304,58],2364,2365,[2366,17],2384,[2385,5],[2392,12],[2406,10],2417,2418,[2425,7],2433,[2434,2],[2437,8],[2447,2],[2451,22],[2474,7],2482,[2486,4],2492,2493,[2494,7],[2503,2],[2507,4],2519,[2524,2],[2527,5],[2534,12],[2561,3],[2565,6],[2575,2],[2579,22],[2602,7],[2610,2],[2613,2],[2616,2],2620,[2622,5],[2631,2],[2635,3],2641,[2649,4],2654,[2662,16],[2689,3],[2693,9],[2703,3],[2707,22],[2730,7],[2738,2],[2741,5],2748,2749,[2750,8],[2759,3],[2763,3],2768,[2784,4],[2790,10],2817,[2818,2],[2821,8],[2831,2],[2835,22],[2858,7],[2866,2],[2869,5],2876,2877,2878,2879,2880,[2881,4],[2887,2],[2891,3],2902,2903,[2908,2],[2911,5],[2918,10],2929,2946,2947,[2949,6],[2958,3],[2962,4],[2969,2],2972,[2974,2],[2979,2],[2984,3],[2990,12],[3006,5],[3014,3],[3018,4],3024,3031,[3046,10],[3073,3],[3077,8],[3086,3],[3090,23],[3114,10],[3125,5],3133,[3134,7],[3142,3],[3146,4],[3157,2],[3160,2],[3168,4],[3174,10],[3202,2],[3205,8],[3214,3],[3218,23],[3242,10],[3253,5],3260,3261,3262,3263,[3264,5],3270,[3271,2],[3274,4],[3285,2],3294,[3296,4],[3302,10],[3330,2],[3333,8],[3342,3],[3346,23],[3370,16],3389,[3390,7],[3398,3],[3402,4],3415,[3424,4],[3430,10],[3450,6],[3458,2],[3461,18],[3482,24],[3507,9],3517,[3520,7],3530,[3535,6],3542,[3544,8],[3570,2],[3585,58],[3648,15],[3664,10],[3713,2],3716,[3719,2],3722,3725,[3732,4],[3737,7],[3745,3],3749,3751,[3754,2],[3757,13],[3771,3],[3776,5],3782,[3784,6],[3792,10],[3804,2],3840,[3864,2],[3872,10],3893,3895,3897,[3902,10],[3913,36],[3953,20],[3974,6],[3984,8],[3993,36],4038,[4096,74],[4176,78],[4256,38],[4304,43],4348,[4352,329],[4682,4],[4688,7],4696,[4698,4],[4704,41],[4746,4],[4752,33],[4786,4],[4792,7],4800,[4802,4],[4808,15],[4824,57],[4882,4],[4888,67],4959,[4969,9],[4992,16],[5024,85],[5121,620],[5743,17],[5761,26],[5792,75],[5870,3],[5888,13],[5902,7],[5920,21],[5952,20],[5984,13],[5998,3],[6002,2],[6016,52],6070,[6071,29],6103,6108,6109,[6112,10],[6155,3],[6160,10],[6176,88],[6272,43],[6320,70],[6400,29],[6432,12],[6448,12],[6470,40],[6512,5],[6528,44],[6576,26],[6608,11],[6656,28],[6688,63],6752,6753,6754,[6755,26],6783,[6784,10],[6800,10],6823,[6912,76],[6992,10],[7019,9],[7040,43],[7086,12],[7168,56],[7232,10],[7245,49],[7376,3],[7380,31],[7424,231],[7677,281],[7960,6],[7968,38],[8008,6],[8016,8],8025,8027,8029,[8031,31],[8064,53],[8118,7],8126,[8130,3],[8134,7],[8144,4],[8150,6],[8160,13],[8178,3],[8182,7],[8255,2],8276,8305,8319,[8336,5],[8400,13],8417,[8421,12],8450,8455,[8458,10],8469,8472,[8473,5],8484,8486,8488,[8490,16],[8508,4],[8517,5],8526,[8544,41],[11264,47],[11312,47],[11360,133],[11499,7],[11520,38],[11568,54],11631,[11648,23],[11680,7],[11688,7],[11696,7],[11704,7],[11712,7],[11720,7],[11728,7],[11736,7],[11744,32],12293,12294,12295,[12321,15],[12337,5],[12344,5],[12353,86],[12441,2],[12445,3],[12449,90],[12540,4],[12549,41],[12593,94],[12704,24],[12784,16],[13312,6582],[19968,20940],[40960,1165],[42192,46],[42240,269],[42512,28],[42560,32],[42594,14],[42620,2],42623,[42624,24],[42656,82],[42775,9],[42786,103],[42891,2],[43003,45],[43072,52],[43136,69],[43216,10],[43232,24],43259,[43264,46],[43312,36],[43360,29],[43392,65],43471,[43472,10],[43520,55],[43584,14],[43600,10],[43616,23],43642,43643,[43648,67],[43739,3],[43968,43],44012,44013,[44016,10],[44032,11172],[55216,23],[55243,49],[63744,302],[64048,62],[64112,106],[64256,7],[64275,5],64285,64286,[64287,10],[64298,13],[64312,5],64318,[64320,2],[64323,2],[64326,108],[64467,139],[64612,218],[64848,64],[64914,54],[65008,10],[65024,16],[65056,7],[65075,2],[65101,3],65137,65139,65143,65145,65147,65149,[65151,126],[65296,10],[65313,26],65343,[65345,26],[65382,89],[65474,6],[65482,6],[65490,6],[65498,3],[65536,12],[65549,26],[65576,19],[65596,2],[65599,15],[65616,14],[65664,123],[65856,53],66045,[66176,29],[66208,49],[66304,31],[66352,27],[66432,30],[66464,36],[66504,8],[66513,5],[66560,158],[66720,10],[67584,6],67592,[67594,44],[67639,2],67644,[67647,23],[67840,22],[67872,26],68096,[68097,3],[68101,2],[68108,8],[68117,3],[68121,27],[68152,3],68159,[68192,29],[68352,54],[68416,22],[68448,19],[68608,73],[69760,59],[73728,879],[74752,99],[77824,1071],[119141,5],[119149,6],[119163,8],[119173,7],[119210,4],[119362,3],[119808,85],[119894,71],[119966,2],119970,[119973,2],[119977,4],[119982,12],119995,[119997,7],[120005,65],[120071,4],[120077,8],[120086,7],[120094,28],[120123,4],[120128,5],120134,[120138,7],[120146,340],[120488,25],[120514,25],[120540,31],[120572,25],[120598,31],[120630,25],[120656,31],[120688,25],[120714,31],[120746,25],[120772,8],[120782,50],[131072,42711],[173824,4149],[194560,542],[917760,240]]},$B.unicode_tables={},$B.unicode)$B.unicode_tables[gc]={},$B.unicode[gc].forEach((function(t){if(Array.isArray(t))for(var e=t[2]||1,n=0,r=t[1];n<r;n+=1)$B.unicode_tables[gc][t[0]+n*e]=!0;else $B.unicode_tables[gc][t]=!0}));for(var key in $B.unicode_identifiers){$B.unicode_tables[key]={};for(const t of $B.unicode_identifiers[key])if(Array.isArray(t))for(var i=0;i<t[1];i++)$B.unicode_tables[key][t[0]+i]=!0;else $B.unicode_tables[key][t]=!0}$B.is_unicode_cn=function(t){for(var e=$B.unicode.Cn,n=0,r=e.length;n<r;n++)return t>=e[n][0]&&t<e[n][0]+e[n][1];return!1},function($B){var bltns=$B.InjectBuiltins();eval(bltns);var unicode_tables=$B.unicode_tables,str={__class__:_b_.type,__dir__:object.__dir__,$infos:{__module__:"builtins",__name__:"str"},$is_class:!0,$native:!0};function normalize_start_end(t){if(null===t.start||t.start===_b_.None?t.start=0:t.start<0&&(t.start+=t.self.length,t.start=Math.max(0,t.start)),null===t.end||t.end===_b_.None?t.end=t.self.length:t.end<0&&(t.end+=t.self.length,t.end=Math.max(0,t.end)),!isinstance(t.start,_b_.int)||!isinstance(t.end,_b_.int))throw _b_.TypeError.$factory("slice indices must be integers or None or have an __index__ method")}function reverse(t){return t.split("").reverse().join("")}function check_str(t){if(!_b_.isinstance(t,str))throw _b_.TypeError.$factory("can't convert '"+$B.class_name(t)+"' object to str implicitly")}function preformat(t,e){if(e.empty)return _b_.str.$factory(t);if(e.type&&"s"!=e.type)throw _b_.ValueError.$factory("Unknown format code '"+e.type+"' for object of type 'str'");return t}str.__add__=function(t,e){if("string"!=typeof e)try{return getattr(e,"__radd__")(t)}catch(t){throw _b_.TypeError.$factory("Can't convert "+$B.class_name(e)+" to str implicitly")}return t+e},str.__contains__=function(t,e){if(!_b_.isinstance(e,str))throw _b_.TypeError.$factory("'in <string>' requires string as left operand, not "+e.__class__);if("string"==typeof e)var n=e.length;else n=_b_.len(e);if(0==n)return!0;if(0==t.length)return 0==n;for(var r=0,i=t.length;r<i;r++)if(t.substr(r,n)==e)return!0;return!1},str.__delitem__=function(){throw _b_.TypeError.$factory("'str' object doesn't support item deletion")},str.__dir__=object.__dir__,str.__eq__=function(t,e){return void 0===e?t===str:_b_.isinstance(e,_b_.str)?e.valueOf()==t.valueOf():_b_.NotImplemented},str.__format__=function(t,e){var n=new $B.parse_format_spec(e);if(void 0!==n.sign)throw _b_.ValueError.$factory("Sign not allowed in string format specifier");return n.precision&&(t=t.substr(0,n.precision)),n.align=n.align||"<",$B.format_width(preformat(t,n),n)},str.__getitem__=function(t,e){if(isinstance(e,_b_.int)){var n=e;if(e<0&&(n+=t.length),n>=0&&n<t.length)return t.charAt(n);throw _b_.IndexError.$factory("string index out of range")}if(isinstance(e,slice)){var r=_b_.slice.$conv_for_seq(e,t.length),i=r.start,s=r.stop,o=r.step,a="",l=null;if(o>0){if(s<=i)return"";for(l=i;l<s;l+=o)a+=t.charAt(l)}else{if(s>=i)return"";for(l=i;l>s;l+=o)a+=t.charAt(l)}return a}if(isinstance(e,_b_.bool))return t.__getitem__(_b_.int.$factory(e));throw _b_.TypeError.$factory("string indices must be integers")};var prefix=2,suffix=3,mask=2**32-1,str_hash_cache={};function fnv(t){if(0==t.length)return 0;var e=prefix;e=(e^t.charCodeAt(0)<<7)&mask;for(var n=0,r=t.length;n<r;n++)e=(1000003*e^t.charCodeAt(n))&mask;return-1==(e=((e=(e^t.length)&mask)^suffix)&mask)&&(e=-2),e}str.$nb_str_hash_cache=0,str.__hash__=function(t){return void 0!==str_hash_cache[t]?str_hash_cache[t]:(str.$nb_str_hash_cache++,str.$nb_str_hash_cache>1e5&&(str.$nb_str_hash_cache=0,str_hash_cache={}),str_hash_cache[t]=fnv(t))},str.__init__=function(t,e){return t.valueOf=function(){return e},t.toString=function(){return e},_b_.None};var str_iterator=$B.make_iterator_class("str_iterator");str.__iter__=function(t){var e=t.split("");return str_iterator.$factory(e)},str.__len__=function(t){return t.length};var kwarg_key=new RegExp("([^\\)]*)\\)"),NotANumber=function(){this.name="NotANumber"},number_check=function(t){if(!isinstance(t,[_b_.int,_b_.float]))throw new NotANumber},get_char_array=function(t,e){return t<=0?"":new Array(t+1).join(e)},format_padding=function(t,e,n){var r=e.padding;return r?(t=t.toString(),r=parseInt(r,10),n&&(r-=1),e.left?t+get_char_array(r-t.length,e.pad_char):get_char_array(r-t.length,e.pad_char)+t):t},format_int_precision=function(t,e){var n,r=e.precision;return r?(r=parseInt(r,10),"-"===(n=t.__class__===$B.long_int?$B.long_int.to_base(t,10):t.toString())[0]?"-"+get_char_array(r-n.length+1,"0")+n.slice(1):get_char_array(r-n.length,"0")+n):t.toString()},format_float_precision=function(t,e,n,r){var i=n.precision;return isFinite(t)?r(t,i,n,e):(t=t===1/0?"inf":t===-1/0?"-inf":"nan",e?t.toUpperCase():t)},format_sign=function(t,e){if(e.sign){if(t>=0)return"+"}else if(e.space&&t>=0)return" ";return""},str_format=function(t,e){return e.pad_char=" ",format_padding(str.$factory(t),e)},num_format=function(t,e){number_check(t),t=t.__class__===$B.long_int?$B.long_int.to_base(t,10):parseInt(t);var n=format_int_precision(t,e);if("0"===e.pad_char){if(t<0)return n=n.substring(1),"-"+format_padding(n,e,!0);var r=format_sign(t,e);if(""!==r)return r+format_padding(n,e,!0)}return format_padding(format_sign(t,e)+n,e)},repr_format=function(t,e){return e.pad_char=" ",format_padding(repr(t),e)},ascii_format=function(t,e){return e.pad_char=" ",format_padding(ascii(t),e)},_float_helper=function(t,e){return number_check(t),e.precision?(e.precision=parseInt(e.precision,10),validate_precision(e.precision)):e.decimal_point?e.precision=0:e.precision=6,parseFloat(t)},trailing_zeros=/(.*?)(0+)([eE].*)/,leading_zeros=/\.(0*)/,trailing_dot=/\.$/,validate_precision=function(t){t>20&&(t=20)},floating_point_format=function(t,e,n){if(t=_float_helper(t,n),v=t.toString(),v_len=v.length,dot_idx=v.indexOf("."),dot_idx<0&&(dot_idx=v_len),t<1&&t>-1){var r,i=leading_zeros.exec(v);return(r=i?i[1].length:0)>=4?(t=format_sign(t,n)+format_float_precision(t,e,n,_floating_g_exp_helper),n.alternate?n.precision<=1&&(t=t[0]+"."+t.substring(1)):(s=trailing_zeros.exec(t))&&(t=s[1].replace(trailing_dot,"")+s[3]),format_padding(t,n)):(n.precision=(n.precision||0)+r,format_padding(format_sign(t,n)+format_float_precision(t,e,n,(function(t,e){return t.toFixed(min(e,v_len-dot_idx)+r)})),n))}var s;return dot_idx>n.precision?(t=format_sign(t,n)+format_float_precision(t,e,n,_floating_g_exp_helper),n.alternate?n.precision<=1&&(t=t[0]+"."+t.substring(1)):(s=trailing_zeros.exec(t))&&(t=s[1].replace(trailing_dot,"")+s[3]),format_padding(t,n)):format_padding(format_sign(t,n)+format_float_precision(t,e,n,(function(t,e){return n.decimal_point?e>v_len&&(n.alternate||(e=v_len)):e=min(v_len-1,6),e<dot_idx&&(e=dot_idx),t.toFixed(e-dot_idx)})),n)},_floating_g_exp_helper=function(t,e,n,r){e&&--e;var i=(t=t.toExponential(e)).lastIndexOf("e");return i>t.length-4&&(t=t.substring(0,i+2)+"0"+t.substring(i+2)),r?t.toUpperCase():t},floating_point_decimal_format=function(t,e,n){return t=_float_helper(t,n),format_padding(format_sign(t,n)+format_float_precision(t,e,n,(function(t,e,n){return t=t.toFixed(e),0===e&&n.alternate&&(t+="."),t})),n)},_floating_exp_helper=function(t,e,n,r){var i=(t=t.toExponential(e)).lastIndexOf("e");return i>t.length-4&&(t=t.substring(0,i+2)+"0"+t.substring(i+2)),r?t.toUpperCase():t},floating_point_exponential_format=function(t,e,n){return t=_float_helper(t,n),format_padding(format_sign(t,n)+format_float_precision(t,e,n,_floating_exp_helper),n)},signed_hex_format=function(t,e,n){var r;if(number_check(t),r=t.__class__===$B.long_int?$B.long_int.to_base(t,16):(r=parseInt(t)).toString(16),r=format_int_precision(r,n),e&&(r=r.toUpperCase()),"0"===n.pad_char){t<0&&(r=r.substring(1),r="-"+format_padding(r,n,!0));var i=format_sign(t,n);""!==i&&(r=i+format_padding(r,n,!0))}return n.alternate&&(r="-"===r.charAt(0)?e?"-0X"+r.slice(1):"-0x"+r.slice(1):e?"0X"+r:"0x"+r),format_padding(format_sign(t,n)+r,n)},octal_format=function(t,e){var n;if(number_check(t),n=t.__class__===$B.long_int?$B.long_int.to_base(8):(n=parseInt(t)).toString(8),n=format_int_precision(n,e),"0"===e.pad_char){t<0&&(n=n.substring(1),n="-"+format_padding(n,e,!0));var r=format_sign(t,e);""!==r&&(n=r+format_padding(n,e,!0))}return e.alternate&&(n="-"===n.charAt(0)?"-0o"+n.slice(1):"0o"+n),format_padding(n,e)};function series_of_bytes(t,e){if(t.__class__&&t.__class__.$buffer_protocol)for(var n=_b_.iter(t),r=[];;)try{r.push(_b_.next(n))}catch(t){if(t.__class__===_b_.StopIteration){var i=_b_.bytes.$factory(r);return format_padding(_b_.bytes.decode(i,"ascii"),e)}throw t}else try{return bytes_obj=$B.$getattr(t,"__bytes__"),format_padding(_b_.bytes.decode(bytes_obj),e)}catch(e){if(e.__class__===_b_.AttributeError)throw _b_.TypeError.$factory("%b does not accept '"+$B.class_name(t)+"'");throw e}}var single_char_format=function(t,e){if(isinstance(t,str)&&1==t.length)return t;if(isinstance(t,bytes)&&1==t.source.length)t=t.source[0];else try{t=_b_.int.$factory(t)}catch(t){throw _b_.TypeError.$factory("%c requires int or char")}return format_padding(chr(t),e)},num_flag=function(t,e){"0"!==t||e.padding||e.decimal_point||e.left?e.decimal_point?e.precision=(e.precision||"")+t:e.padding=(e.padding||"")+t:e.pad_char="0"},decimal_point_flag=function(t,e){if(e.decimal_point)throw new UnsupportedChar;e.decimal_point=!0},neg_flag=function(t,e){e.pad_char=" ",e.left=!0},space_flag=function(t,e){e.space=!0},sign_flag=function(t,e){e.sign=!0},alternate_flag=function(t,e){e.alternate=!0},char_mapping={b:series_of_bytes,s:str_format,d:num_format,i:num_format,u:num_format,o:octal_format,r:repr_format,a:ascii_format,g:function(t,e){return floating_point_format(t,!1,e)},G:function(t,e){return floating_point_format(t,!0,e)},f:function(t,e){return floating_point_decimal_format(t,!1,e)},F:function(t,e){return floating_point_decimal_format(t,!0,e)},e:function(t,e){return floating_point_exponential_format(t,!1,e)},E:function(t,e){return floating_point_exponential_format(t,!0,e)},x:function(t,e){return signed_hex_format(t,!1,e)},X:function(t,e){return signed_hex_format(t,!0,e)},c:single_char_format,0:function(t,e){return num_flag("0",e)},1:function(t,e){return num_flag("1",e)},2:function(t,e){return num_flag("2",e)},3:function(t,e){return num_flag("3",e)},4:function(t,e){return num_flag("4",e)},5:function(t,e){return num_flag("5",e)},6:function(t,e){return num_flag("6",e)},7:function(t,e){return num_flag("7",e)},8:function(t,e){return num_flag("8",e)},9:function(t,e){return num_flag("9",e)},"-":neg_flag," ":space_flag,"+":sign_flag,".":decimal_point_flag,"#":alternate_flag},UnsupportedChar=function(){this.name="UnsupportedChar"};str.__mod__=function(t,e){var n,r=t.length,i=0,s=null;_b_.isinstance(e,_b_.tuple)?s=0:n=_b_.getattr(e,"__getitem__",_b_.None);var o="",a=function(t){++i;var e=kwarg_key.exec(t.substring(h));if(!e)throw _b_.ValueError.$factory("incomplete format key");var r=e[1];h+=e[0].length;try{var s=n(r)}catch(t){if("KeyError"===t.name)throw t;throw _b_.TypeError.$factory("format requires a mapping")}return c(t,s)},l=function(t){var n;if(null===s)n=e;else if(void 0===(n=e[s++]))throw _b_.TypeError.$factory("not enough arguments for format string");return c(t,n)},c=function(t,e){for(var n={pad_char:" "};;){var r=char_mapping[t[h]];try{if(void 0===r)throw new UnsupportedChar;var i=r(e,n);if(void 0!==i)return i;++h}catch(n){if("UnsupportedChar"==n.name){if(invalid_char=t[h],void 0===invalid_char)throw _b_.ValueError.$factory("incomplete format");throw _b_.ValueError.$factory("unsupported format character '"+invalid_char+"' (0x"+invalid_char.charCodeAt(0).toString(16)+") at index "+h)}if("NotANumber"===n.name){var s=t[h],o=e.__class__;throw o=o?o.$infos.__name__:"string"==typeof e?"str":typeof e,_b_.TypeError.$factory("%"+s+" format: a number is required, not "+o)}throw n}}},u=0;do{var h=t.indexOf("%",i);if(h<0){o+=t.substring(i);break}if(o+=t.substring(i,h),!(++h<r))throw _b_.ValueError.$factory("incomplete format");"%"===t[h]?o+="%":(u++,"("===t[h]?(++h,o+=a(t)):o+=l(t)),i=h+1}while(i<r);if(null!==s){if(e.length>s)throw _b_.TypeError.$factory("not enough arguments for format string");if(e.length<s)throw _b_.TypeError.$factory("not all arguments converted during string formatting")}else if(0==u)throw _b_.TypeError.$factory("not all arguments converted during string formatting");return o},str.__mro__=[object],str.__mul__=function(){var t=$B.args("__mul__",2,{self:null,other:null},["self","other"],arguments,{},null,null);if(!isinstance(t.other,_b_.int))throw _b_.TypeError.$factory("Can't multiply sequence by non-int of type '"+$B.class_name(t.other)+"'");for(var e="",n=0;n<t.other;n++)e+=t.self.valueOf();return e},str.__ne__=function(t,e){return e!==t.valueOf()},str.__repr__=function(t){var e=t;e=(e=(e=t.replace(/\\/g,"\\\\")).replace(new RegExp("","g"),"\\x07").replace(new RegExp("\b","g"),"\\x08").replace(new RegExp("\v","g"),"\\x0b").replace(new RegExp("\f","g"),"\\x0c").replace(new RegExp("\n","g"),"\\n").replace(new RegExp("\r","g"),"\\r").replace(new RegExp("\t","g"),"\\t")).replace(combining_re,"$1");for(var n="",r=0;r<e.length;r++)if($B.is_unicode_cn(e.codePointAt(r))){for(var i=e.codePointAt(r).toString(16);i.length<4;)i="0"+i;n+="\\u"+i}else n+=e.charAt(r);if(-1==(e=n).search('"')&&-1==e.search("'"))return"'"+e+"'";if(-1==t.search('"'))return'"'+e+'"';var s=new RegExp("'","g");return"'"+e.replace(s,"\\'")+"'"},str.__setitem__=function(t,e,n){throw _b_.TypeError.$factory("'str' object does not support item assignment")};for(var combining=[],cp=768;cp<=879;cp++)combining.push(String.fromCharCode(cp));var combining_re=new RegExp("("+combining.join("|")+")");str.__str__=function(t){return t.replace(combining_re,"$1")},str.toString=function(){return"string!"};var $comp_func=function(t,e){return"string"!=typeof e?_b_.NotImplemented:t>e};$comp_func+="";var $comps={">":"gt",">=":"ge","<":"lt","<=":"le"};for(var $op in $comps)eval("str.__"+$comps[$op]+"__ = "+$comp_func.replace(/>/gm,$op));$B.make_rmethods(str);var $notimplemented=function(t,e){throw NotImplementedError.$factory("OPERATOR not implemented for class str")};str.capitalize=function(t){return $B.args("capitalize",1,{self:t},["self"],arguments,{},null,null),0==t.length?"":t.charAt(0).toUpperCase()+t.substr(1)},str.casefold=function(t){$B.args("casefold",1,{self:t},["self"],arguments,{},null,null);for(var e,n,r="",i=0,s=t.length;i<s;i++)e=t.charCodeAt(i),(n=$B.unicode_casefold[e])?n.forEach((function(t){r+=String.fromCharCode(t)})):r+=t.charAt(i).toLowerCase();return r},str.center=function(){var t=$B.args("center",3,{self:null,width:null,fillchar:null},["self","width","fillchar"],arguments,{fillchar:" "},null,null),e=t.self;if(t.width<=e.length)return e;var n=parseInt((t.width-e.length)/2),r=t.fillchar.repeat(n);return(r+=e+r).length<t.width&&(r+=t.fillchar),r},str.count=function(){var t=$B.args("count",4,{self:null,sub:null,start:null,stop:null},["self","sub","start","stop"],arguments,{start:null,stop:null},null,null);if("string"!=typeof t.sub)throw _b_.TypeError.$factory("Can't convert '"+$B.class_name(t.sub)+"' object to str implicitly");var e,n=t.self;if(null!==t.start)e=null!==t.stop?_b_.slice.$factory(t.start,t.stop):_b_.slice.$factory(t.start,t.self.length),n=str.__getitem__.apply(null,[t.self].concat(e));else if(t.self.length+t.sub.length==0)return 1;if(0==t.sub.length)return t.start==t.self.length?1:0==n.length?0:n.length+1;for(var r=0,i=0;i<n.length&&(i=n.indexOf(t.sub,i))>=0;)r++,i+=t.sub.length;return r},str.encode=function(){var t=$B.args("encode",3,{self:null,encoding:null,errors:null},["self","encoding","errors"],arguments,{encoding:"utf-8",errors:"strict"},null,null);if("rot13"==t.encoding||"rot_13"==t.encoding){for(var e="",n=0,r=t.self.length;n<r;n++){var i=t.self.charAt(n);e+="a"<=i&&i<="m"||"A"<=i&&i<="M"?String.fromCharCode(String.charCodeAt(i)+13):"m"<i&&i<="z"||"M"<i&&i<="Z"?String.fromCharCode(String.charCodeAt(i)-13):i}return e}return _b_.bytes.__new__(_b_.bytes,t.self,t.encoding,t.errors)},str.endswith=function(){var t=$B.args("endswith",4,{self:null,suffix:null,start:null,end:null},["self","suffix","start","end"],arguments,{start:0,end:null},null,null);normalize_start_end(t);var e=t.suffix;isinstance(e,_b_.tuple)||(e=[e]);for(var n=t.self.substring(t.start,t.end),r=0,i=e.length;r<i;r++){var s=e[r];if(!_b_.isinstance(s,str))throw _b_.TypeError.$factory("endswith first arg must be str or a tuple of str, not int");if(s.length<=n.length&&n.substr(n.length-s.length)==s)return!0}return!1},str.expandtabs=function(t,e){var n=$B.args("expandtabs",2,{self:null,tabsize:null},["self","tabsize"],arguments,{tabsize:8},null,null),r=$B.$GetInt(n.tabsize),i=0,s=0,o="";if(1==r)return t.replace(/\t/g," ");for(;s<t.length;){var a=t.charAt(s);switch(a){case"\t":for(;i%r>0;)o+=" ",i++;break;case"\r":case"\n":o+=a,i=0;break;default:o+=a,i++}s++}return o},str.find=function(){var t=$B.args("str.find",4,{self:null,sub:null,start:null,end:null},["self","sub","start","end"],arguments,{start:0,end:null},null,null);if(check_str(t.sub),normalize_start_end(t),!isinstance(t.start,_b_.int)||!isinstance(t.end,_b_.int))throw _b_.TypeError.$factory("slice indices must be integers or None or have an __index__ method");for(var e="",n=t.start;n<t.end;n++)e+=t.self.charAt(n);if(0==t.sub.length&&t.start==t.self.length)return t.self.length;if(e.length+t.sub.length==0)return-1;var r=e.length-t.sub.length;for(n=0;n<=r;n++)if(e.substr(n,t.sub.length)==t.sub)return t.start+n;return-1},$B.parse_format=function(t){var e,n,r,i=t.split(":"),s=[];return 1==i.length?e=t:(e=i[0],r=i.splice(1).join(":")),(i=e.split("!")).length>1&&(e=i[0],n=i[1]),void 0!==e&&(e=e.replace(/\.[_a-zA-Z][_a-zA-Z0-9]*|\[[_a-zA-Z][_a-zA-Z0-9]*\]|\[[0-9]+\]/g,(function(t){return s.push(t),""}))),{name:e,name_ext:s,conv:n,spec:r||"",string:t}},$B.split_format=function(t){for(var e,n=0,r=t.length,i="",s=[],o=0;n<r;)if("{"==(e=t.charAt(n))&&"{"==t.charAt(n+1))i+="{",n+=2;else if("}"==e&&"}"==t.charAt(n+1))i+="}",n+=2;else if("{"==e){s.push(i);for(var a=n+1,l=1;a<r;)if("{"==t.charAt(a))l++,a++;else if("}"==t.charAt(a)){if(a++,0==--l){var c=t.substring(n+1,a-1),u=$B.parse_format(c);if(u.raw_name=u.name,u.raw_spec=u.spec,u.name||(u.name=o+"",o++),void 0!==u.spec){function h(t,e){return""==e?"{"+o+++"}":"{"+e+"}"}u.spec=u.spec.replace(/\{(.*?)\}/g,h)}s.push(u),i="";break}}else a++;if(l>0)throw ValueError.$factory("wrong format "+t);n=a}else i+=e,n++;return i&&s.push(i),s},str.format=function(t){for(var e,n=$B.args("format",1,{self:null},["self"],arguments,{},"$args","$kw"),r=$B.split_format(n.self),i="",s=0;s<r.length;s++)if("string"!=typeof r[s]){if(void 0!==(e=r[s]).spec){function o(t,e){return/\d+/.exec(e)?_b_.tuple.__getitem__(n.$args,parseInt(e)):_b_.dict.__getitem__(n.$kw,e)}e.spec=e.spec.replace(/\{(.*?)\}/g,o)}if(e.name.charAt(0).search(/\d/)>-1)var a=parseInt(e.name),l=_b_.tuple.__getitem__(n.$args,a);else l=_b_.dict.__getitem__(n.$kw,e.name);for(var c=0;c<e.name_ext.length;c++){var u=e.name_ext[c];if("."==u.charAt(0))l=_b_.getattr(l,u.substr(1));else{var h=u.substr(1,u.length-2);h.charAt(0).search(/\d/)>-1&&(h=parseInt(h)),l=_b_.getattr(l,"__getitem__")(h)}}"a"==e.conv?l=_b_.ascii(l):"r"==e.conv?l=_b_.repr(l):"s"==e.conv&&(l=_b_.str.$factory(l)),l.$is_class||l.$factory?i+=l.__class__.__format__(l,e.spec):i+=$B.$getattr(l,"__format__")(e.spec)}else i+=r[s];return i},str.format_map=function(t){throw NotImplementedError.$factory("function format_map not implemented yet")},str.index=function(t){var e=str.find.apply(null,arguments);if(-1===e)throw _b_.ValueError.$factory("substring not found");return e},str.isascii=function(t){for(var e=0,n=t.length;e<n;e++)if(t.charCodeAt(e)>127)return!1;return!0},str.isalnum=function(t){$B.args("isalnum",1,{self:null},["self"],arguments,{},null,null);for(var e,n=0,r=t.length;n<r;n++)if(e=t.charCodeAt(n),!(unicode_tables.Ll[e]||unicode_tables.Lu[e]||unicode_tables.Lm[e]||unicode_tables.Lt[e]||unicode_tables.Lo[e]||unicode_tables.Nd[e]||unicode_tables.digits[e]||unicode_tables.numeric[e]))return!1;return!0},str.isalpha=function(t){$B.args("isalpha",1,{self:null},["self"],arguments,{},null,null);for(var e,n=0,r=t.length;n<r;n++)if(e=t.charCodeAt(n),!(unicode_tables.Ll[e]||unicode_tables.Lu[e]||unicode_tables.Lm[e]||unicode_tables.Lt[e]||unicode_tables.Lo[e]))return!1;return!0},str.isdecimal=function(t){$B.args("isdecimal",1,{self:null},["self"],arguments,{},null,null);for(var e,n=0,r=t.length;n<r;n++)if(e=t.charCodeAt(n),!unicode_tables.Nd[e])return!1;return t.length>0},str.isdigit=function(t){$B.args("isdigit",1,{self:null},["self"],arguments,{},null,null);for(var e,n=0,r=t.length;n<r;n++)if(e=t.charCodeAt(n),!unicode_tables.digits[e])return!1;return t.length>0},str.isidentifier=function(t){if($B.args("isidentifier",1,{self:null},["self"],arguments,{},null,null),0==t.length)return!1;if(void 0===unicode_tables.XID_Start[t.charCodeAt(0)])return!1;for(var e=1,n=t.length;e<n;e++)if(void 0===unicode_tables.XID_Continue[t.charCodeAt(e)])return!1;return!0},str.islower=function(t){$B.args("islower",1,{self:null},["self"],arguments,{},null,null);for(var e,n=!1,r=0,i=t.length;r<i;r++)if(e=t.charCodeAt(r),unicode_tables.Ll[e])n=!0;else if(unicode_tables.Lu[e]||unicode_tables.Lt[e])return!1;return n},str.isnumeric=function(t){$B.args("isnumeric",1,{self:null},["self"],arguments,{},null,null);for(var e=0,n=t.length;e<n;e++)if(!unicode_tables.numeric[t.charCodeAt(e)])return!1;return t.length>0};var unprintable={},unprintable_gc=["Cc","Cf","Co","Cs","Zl","Zp","Zs"];function $re_escape(t){for(var e="[.*+?|()$^",n=0,r=e.length;n<r;n++){var i=new RegExp("\\"+e.charAt(n),"g");t=t.replace(i,"\\"+e.charAt(n))}return t}str.isprintable=function(t){if(0==Object.keys(unprintable).length){for(var e=0;e<unprintable_gc.length;e++){var n=unicode_tables[unprintable_gc[e]];for(var r in n)unprintable[r]=!0}unprintable[32]=!0}$B.args("isprintable",1,{self:null},["self"],arguments,{},null,null),e=0;for(var i=t.length;e<i;e++)if(unprintable[t.charCodeAt(e)])return!1;return!0},str.isspace=function(t){$B.args("isspace",1,{self:null},["self"],arguments,{},null,null);for(var e,n=0,r=t.length;n<r;n++)if(e=t.charCodeAt(n),!unicode_tables.Zs[e]&&-1==$B.unicode_bidi_whitespace.indexOf(e))return!1;return t.length>0},str.istitle=function(t){return $B.args("istitle",1,{self:null},["self"],arguments,{},null,null),t.length>0&&str.title(t)==t},str.isupper=function(t){$B.args("islower",1,{self:null},["self"],arguments,{},null,null);for(var e,n=!1,r=0,i=t.length;r<i;r++)if(e=t.charCodeAt(r),unicode_tables.Lu[e])n=!0;else if(unicode_tables.Ll[e]||unicode_tables.Lt[e])return!1;return n},str.join=function(){for(var t=$B.args("join",2,{self:null,iterable:null},["self","iterable"],arguments,{},null,null),e=_b_.iter(t.iterable),n=[];;)try{var r=_b_.next(e);if(!isinstance(r,str))throw _b_.TypeError.$factory("sequence item 0: expected str instance, "+$B.class_name(r)+" found");n.push(r)}catch(t){if(_b_.isinstance(t,_b_.StopIteration))break;throw t}return n.join(t.self)},str.ljust=function(t){var e=$B.args("ljust",3,{self:null,width:null,fillchar:null},["self","width","fillchar"],arguments,{fillchar:" "},null,null);return e.width<=t.length?t:t+e.fillchar.repeat(e.width-t.length)},str.lower=function(t){return $B.args("lower",1,{self:null},["self"],arguments,{},null,null),t.toLowerCase()},str.lstrip=function(t,e){var n=$B.args("lstrip",2,{self:null,chars:null},["self","chars"],arguments,{chars:_b_.None},null,null);if(n.chars===_b_.None)return n.self.trimLeft();for(var r=0;r<n.self.length;r++)if(-1===n.chars.indexOf(n.self.charAt(r)))return n.self.substring(r);return""},str.maketrans=function(){var t=$B.args("maketrans",3,{x:null,y:null,z:null},["x","y","z"],arguments,{y:null,z:null},null,null),e=$B.empty_dict();if(null===t.y&&null===t.z){if(!_b_.isinstance(t.x,_b_.dict))throw _b_.TypeError.$factory("maketrans only argument must be a dict");for(var n=_b_.list.$factory(_b_.dict.items(t.x)),r=0,i=n.length;r<i;r++){var s=n[r][0],o=n[r][1];if(!_b_.isinstance(s,_b_.int)){if(!_b_.isinstance(s,_b_.str)||1!=s.length)throw _b_.TypeError.$factory("dictionary key "+s+" is not int or 1-char string");s=_b_.ord(s)}if(o!==_b_.None&&!_b_.isinstance(o,[_b_.int,_b_.str]))throw _b_.TypeError.$factory("dictionary value "+o+" is not None, integer or string");_b_.dict.$setitem(e,s,o)}return e}if(_b_.isinstance(t.x,_b_.str)&&_b_.isinstance(t.y,_b_.str)){if(t.x.length!==t.y.length)throw _b_.TypeError.$factory("maketrans arguments must be strings or same length");var a={};if(null!==t.z){if(!_b_.isinstance(t.z,_b_.str))throw _b_.TypeError.$factory("maketrans third argument must be a string");for(r=0,i=t.z.length;r<i;r++)a[_b_.ord(t.z.charAt(r))]=!0}for(r=0,i=t.x.length;r<i;r++){var l=_b_.ord(t.x.charAt(r)),c=t.y.charCodeAt(r);_b_.dict.$setitem(e,l,c)}for(var s in a)_b_.dict.$setitem(e,parseInt(s),_b_.None);return e}throw _b_.TypeError.$factory("maketrans arguments must be strings")},str.maketrans.$type="staticmethod",str.partition=function(){var t=$B.args("partition",2,{self:null,sep:null},["self","sep"],arguments,{},null,null);if(""==t.sep)throw _b_.ValueError.$factory("empty separator");check_str(t.sep);var e=t.self.indexOf(t.sep);return-1==e?_b_.tuple.$factory([t.self,"",""]):_b_.tuple.$factory([t.self.substring(0,e),t.sep,t.self.substring(e+t.sep.length)])},str.removeprefix=function(){var t=$B.args("removeprefix",2,{self:null,prefix:null},["self","prefix"],arguments,{},null,null);if(!_b_.isinstance(t.prefix,str))throw _b_.ValueError.$factory(`prefix should be str, not '${$B.class_name(t.prefix)}'`);return str.startswith(t.self,t.prefix)?t.self.substr(t.prefix.length):t.self.substr(0)},str.removesuffix=function(){var t=$B.args("removesuffix",2,{self:null,prefix:null},["self","suffix"],arguments,{},null,null);if(!_b_.isinstance(t.suffix,str))throw _b_.ValueError.$factory(`suffix should be str, not '${$B.class_name(t.prefix)}'`);return t.suffix.length>0&&str.endswith(t.self,t.suffix)?t.self.substr(0,t.self.length-t.suffix.length):t.self.substr(0)},str.replace=function(t,e,n,r){var i=$B.args("replace",4,{self:null,old:null,$$new:null,count:null},["self","old","$$new","count"],arguments,{count:-1},null,null);if(r=i.count,t=i.self,e=i.old,n=i.$$new,check_str(e),check_str(n),!isinstance(r,[_b_.int,_b_.float]))throw _b_.TypeError.$factory("'"+$B.class_name(r)+"' object cannot be interpreted as an integer");if(isinstance(r,_b_.float))throw _b_.TypeError.$factory("integer argument expected, got float");if(0==r)return t;if(r.__class__==$B.long_int&&(r=parseInt(r.value)),""==e){if(""==n)return t;if(""==t)return n;var s=t.split("");if(r>-1&&s.length>=r){var o=s.slice(r).join("");return n+s.slice(0,r).join(n)+o}return n+s.join(n)+n}s=str.split(t,e,r);var a=t,l=-1;if(0==e.length){a=n;for(var c=0;c<s.length;c++)a+=s[c]+n;return a+o}for(r<0&&(r=a.length);r>0&&!((l=a.indexOf(e,l))<0);)a=a.substr(0,l)+n+a.substr(l+e.length),l+=n.length,r--;return a},str.rfind=function(t,e){if(2==arguments.length&&"string"==typeof e)return t.lastIndexOf(e);var n=$B.args("rfind",4,{self:null,sub:null,start:null,end:null},["self","sub","start","end"],arguments,{start:0,end:null},null,null);if(normalize_start_end(n),check_str(n.sub),0==n.sub.length)return n.start>n.self.length?-1:n.self.length;for(var r=n.sub.length,i=n.end-r;i>=n.start;i--)if(n.self.substr(i,r)==n.sub)return i;return-1},str.rindex=function(){var t=str.rfind.apply(null,arguments);if(-1==t)throw _b_.ValueError.$factory("substring not found");return t},str.rjust=function(t){var e=$B.args("rjust",3,{self:null,width:null,fillchar:null},["self","width","fillchar"],arguments,{fillchar:" "},null,null);return e.width<=t.length?t:e.fillchar.repeat(e.width-t.length)+t},str.rpartition=function(t,e){var n=$B.args("rpartition",2,{self:null,sep:null},["self","sep"],arguments,{},null,null);check_str(n.sep),t=reverse(n.self),e=reverse(n.sep);for(var r=str.partition(t,e).reverse(),i=0;i<r.length;i++)r[i]=r[i].split("").reverse().join("");return r},str.rsplit=function(t){var e=$B.args("rsplit",3,{self:null,sep:null,maxsplit:null},["self","sep","maxsplit"],arguments,{sep:_b_.None,maxsplit:-1},null,null),n=e.sep,r=reverse(e.self),i=n===_b_.None?n:reverse(e.sep),s=str.split(r,i,e.maxsplit);s.reverse();for(var o=0;o<s.length;o++)s[o]=reverse(s[o]);return s},str.rstrip=function(t,e){var n=$B.args("rstrip",2,{self:null,chars:null},["self","chars"],arguments,{chars:_b_.None},null,null);if(n.chars===_b_.None)return n.self.trimRight();for(var r=n.self.length-1;r>=0;r--)if(-1==n.chars.indexOf(n.self.charAt(r)))return n.self.substring(0,r+1);return""},str.split=function(){var t=$B.args("split",3,{self:null,sep:null,maxsplit:null},["self","sep","maxsplit"],arguments,{sep:_b_.None,maxsplit:-1},null,null),e=t.sep,n=t.maxsplit,r=t.self,i=0;if(n.__class__===$B.long_int&&(n=parseInt(n.value)),""==e)throw _b_.ValueError.$factory("empty separator");if(e===_b_.None){for(var s=[];i<r.length&&r.charAt(i).search(/\s/)>-1;)i++;if(i===r.length-1)return[r];for(var o="";;){if(-1==r.charAt(i).search(/\s/))""==o?o=r.charAt(i):o+=r.charAt(i);else if(""!==o){if(s.push(o),-1!==n&&s.length==n+1)return s.pop(),s.push(o+r.substr(i)),s;o=""}if(++i>r.length-1){o&&s.push(o);break}}return s}s=[];var a="",l=e.length;if(0==n)return[r];for(;i<r.length;)if(r.substr(i,l)==e){if(s.push(a),i+=l,n>-1&&s.length>=n)return s.push(r.substr(i)),s;a=""}else a+=r.charAt(i),i++;return s.push(a),s},str.splitlines=function(t){var e=$B.args("splitlines",2,{self:null,keepends:null},["self","keepends"],arguments,{keepends:!1},null,null);if(!_b_.isinstance(e.keepends,[_b_.bool,_b_.int]))throw _b_.TypeError("integer argument expected, got "+$B.get_class(e.keepends).__name);var n=_b_.int.$factory(e.keepends),r=[],i=0,s=0;if(!(t=e.self).length)return r;for(;s<t.length;)"\r\n"==t.substr(s,2)?(r.push(t.slice(i,n?s+2:s)),i=s+=2):"\r"==t[s]||"\n"==t[s]?(r.push(t.slice(i,n?s+1:s)),i=s+=1):s++;return i<t.length&&r.push(t.slice(i)),r},str.startswith=function(){var t=$B.args("startswith",4,{self:null,prefix:null,start:null,end:null},["self","prefix","start","end"],arguments,{start:0,end:null},null,null);normalize_start_end(t);var e=t.prefix;isinstance(e,_b_.tuple)||(e=[e]);for(var n=t.self.substring(t.start,t.end),r=0,i=e.length;r<i;r++){var s=e[r];if(!_b_.isinstance(s,str))throw _b_.TypeError.$factory("endswith first arg must be str or a tuple of str, not int");if(n.substr(0,s.length)==s)return!0}return!1},str.strip=function(){var t=$B.args("strip",2,{self:null,chars:null},["self","chars"],arguments,{chars:_b_.None},null,null);if(t.chars===_b_.None)return t.self.trim();for(var e=0;e<t.self.length&&-1!=t.chars.indexOf(t.self.charAt(e));e++);for(var n=t.self.length-1;n>=e&&-1!=t.chars.indexOf(t.self.charAt(n));n--);return t.self.substring(e,n+1)},str.swapcase=function(t){$B.args("swapcase",1,{self:t},["self"],arguments,{},null,null);for(var e,n="",r=0,i=t.length;r<i;r++)e=t.charCodeAt(r),unicode_tables.Ll[e]?n+=t.charAt(r).toUpperCase():unicode_tables.Lu[e]?n+=t.charAt(r).toLowerCase():n+=t.charAt(r);return n},str.title=function(t){$B.args("title",1,{self:t},["self"],arguments,{},null,null);for(var e,n,r="",i=0,s=t.length;i<s;i++)n=t.charCodeAt(i),unicode_tables.Ll[n]?e?r+=t.charAt(i):(r+=t.charAt(i).toUpperCase(),e="word"):unicode_tables.Lu[n]||unicode_tables.Lt[n]?(r+=e?t.charAt(i).toLowerCase():t.charAt(i),e="word"):(e=null,r+=t.charAt(i));return r},str.translate=function(t,e){for(var n=[],r=$B.$getattr(e,"__getitem__"),i=0,s=t.length;i<s;i++)try{var o=r(t.charCodeAt(i));o!==_b_.None&&("string"==typeof o?n.push(o):"number"==typeof o&&n.push(String.fromCharCode(o)))}catch(e){n.push(t.charAt(i))}return n.join("")},str.upper=function(t){return $B.args("upper",1,{self:null},["self"],arguments,{},null,null),t.toUpperCase()},str.zfill=function(t,e){var n=$B.args("zfill",2,{self:null,width:null},["self","width"],arguments,{},null,null);if(n.width<=t.length)return t;switch(t.charAt(0)){case"+":case"-":return t.charAt(0)+"0".repeat(n.width-t.length)+t.substr(1);default:return"0".repeat(e-t.length)+t}},str.$factory=function(t,e,n){if(0==arguments.length)return"";if(void 0===t)return $B.UndefinedClass.__str__();if(void 0!==e){var r=$B.args("str",3,{arg:null,encoding:null,errors:null},["arg","encoding","errors"],arguments,{encoding:"utf-8",errors:"strict"},null,null);e=r.encoding,n=r.errors}switch(typeof t){case"string":return str.__str__(t);case"number":if(isFinite(t))return t.toString()}try{if(t.$is_class||t.$factory)return $B.$getattr(t.__class__,"__str__")(t);if(t.__class__&&t.__class__===_b_.bytes&&void 0!==e)return _b_.bytes.decode(t,r.encoding,r.errors);var i=t.__class__||$B.get_class(t);if(void 0===i)return $B.JSObj.__str__($B.JSObj.$factory(t));if(null===(s=$B.$getattr(i,"__str__",null))||t.__class__&&t.__class__!==_b_.object&&s.$infos&&s.$infos.__func__===_b_.object.__str__)var s=$B.$getattr(i,"__repr__")}catch(e){throw console.log("no __str__ for",t),console.log("err ",e),$B.debug>1&&console.log(e),console.log("Warning - no method __str__ or __repr__, default to toString",t),e}return $B.$call(s)(t)},str.__new__=function(t){if(void 0===t)throw _b_.TypeError.$factory("str.__new__(): not enough arguments");return{__class__:t}},$B.set_func_names(str,"builtins");var StringSubclass=$B.StringSubclass={__class__:_b_.type,__mro__:[object],$infos:{__module__:"builtins",__name__:"str"},$is_class:!0};for(var $attr in str)"function"==typeof str[$attr]&&(StringSubclass[$attr]=function(t){return function(){var e=[],n=0;if(arguments.length>0){e=[arguments[0].valueOf()],n=1;for(var r=1,i=arguments.length;r<i;r++)e[n++]=arguments[r]}return str[t].apply(null,e)}}($attr));function fstring_expression(){this.type="expression",this.expression="",this.conversion=null,this.fmt=null}StringSubclass.__new__=function(t){return{__class__:t}},$B.set_func_names(StringSubclass,"builtins"),_b_.str=str,$B.parse_format_spec=function(t){if(""==t)this.empty=!0;else{var e=0,n="<>=^",r="0123456789",i=n.indexOf(t.charAt(0));-1!=i?t.charAt(1)&&-1!=n.indexOf(t.charAt(1))?(this.fill=t.charAt(0),this.align=t.charAt(1),e=2):(this.align=n[i],this.fill=" ",e++):(i=n.indexOf(t.charAt(1)),t.charAt(1)&&-1!=i&&(this.align=n[i],this.fill=t.charAt(0),e=2));var s=t.charAt(e);for("+"!=s&&"-"!=s&&" "!=s||(this.sign=s,e++,s=t.charAt(e)),"#"==s&&(this.alternate=!0,e++,s=t.charAt(e)),"0"==s&&(this.fill="0",-1==i&&(this.align="="),e++,s=t.charAt(e));s&&r.indexOf(s)>-1;)void 0===this.width?this.width=s:this.width+=s,e++,s=t.charAt(e);if(void 0!==this.width&&(this.width=parseInt(this.width)),void 0===this.width&&"{"==s){var o=t.substr(e).search("}");this.width=t.substring(e,o),console.log("width","["+this.width+"]"),e+=o+1}if(","==s&&(this.comma=!0,e++,s=t.charAt(e)),"."==s){if(-1==r.indexOf(t.charAt(e+1)))throw _b_.ValueError.$factory("Missing precision in format spec");for(this.precision=t.charAt(e+1),e+=2,s=t.charAt(e);s&&r.indexOf(s)>-1;)this.precision+=s,e++,s=t.charAt(e);this.precision=parseInt(this.precision)}if(s&&"bcdeEfFgGnosxX%".indexOf(s)>-1&&(this.type=s,e++,s=t.charAt(e)),e!==t.length)throw _b_.ValueError.$factory("Invalid format specifier: "+t)}this.toString=function(){return(void 0===this.fill?"":_b_.str.$factory(this.fill))+(this.align||"")+(this.sign||"")+(this.alternate?"#":"")+(this.sign_aware?"0":"")+(this.width||"")+(this.comma?",":"")+(this.precision?"."+this.precision:"")+(this.type||"")}},$B.format_width=function(t,e){if(e.width&&t.length<e.width){var n=e.fill||" ",r=e.align||"<",i=e.width-t.length;switch(r){case"<":return t+n.repeat(i);case">":return n.repeat(i)+t;case"=":return"+-".indexOf(t.charAt(0))>-1?t.charAt(0)+n.repeat(i)+t.substr(1):n.repeat(i)+t;case"^":var s=parseInt(i/2);return n.repeat(s)+t+n.repeat(i-s)}}return t},$B.parse_fstring=function(t){for(var e,n=[],r=0,i="",s=null,o=0;r<t.length;)if(null===s)if("{"==(e=t.charAt(r)))"{"==t.charAt(r+1)?(s="string",i="{",r+=2):(s="expression",o=1,r++);else if("}"==e){if(t.charAt(r+1)!=e)throw Error(" f-string: single '}' is not allowed");s="string",i="}",r+=2}else s="string",i=e,r++;else if("string"==s){for(var a=r;a<t.length;)if("{"==(e=t.charAt(a))){if("{"!=t.charAt(a+1)){n.push(i),s="expression",r=a+1;break}i+="{",a+=2}else if("}"==e){if(t.charAt(a+1)!=e)throw Error(" f-string: single '}' is not allowed");i+=e,a+=2}else i+=e,a++;r=a+1}else if("debug"==s){for(;" "==t.charAt(a);)a++;"}"==t.charAt(a)&&(n.push(i),s=null,i="",r=a+1)}else{a=r,o=1;var l=0;for(i=new fstring_expression;a<t.length;)if("{"==(e=t.charAt(a))&&0==l)o++,i.expression+=e,a++;else if("}"==e&&0==l){if(0==(o-=1)){n.push(i),s=null,i="",r=a+1;break}i.expression+=e,a++}else{if("\\"==e)throw Error("f-string expression part cannot include a backslash");if(0==l&&"!"==e&&null===i.fmt&&":}".indexOf(t.charAt(a+2))>-1){if(0==i.expression.length)throw Error("f-string: empty expression not allowed");if(-1=="ars".indexOf(t.charAt(a+1)))throw Error("f-string: invalid conversion character: expected 's', 'r', or 'a'");i.conversion=t.charAt(a+1),a+=2}else if("("==e)l++,i.expression+=e,a++;else if(")"==e)l--,i.expression+=e,a++;else if('"'==e)if('"""'==t.substr(a,3)){if(-1==(u=t.indexOf('"""',a+3)))throw Error("f-string: unterminated string");var c=t.substring(a,u+3);c=c.replace("\n","\\n\\"),i.expression+=c,a=u+3}else{var u;if(-1==(u=t.indexOf('"',a+1)))throw Error("f-string: unterminated string");i.expression+=t.substring(a,u+1),a=u+1}else if(0==l&&":"==e)i.fmt=!0,i.expression+=e,a++;else if("="==e){var h=i.expression,p=h.charAt(h.length-1),d=("()".indexOf(p)>-1?"\\":"")+p;if(0==h.length||"="==t.charAt(a+1)||"=!<>:".search(d)>-1)i.expression+=e+t.charAt(a+1),a+=2;else{for(tail=e;t.charAt(a+1).match(/\s/);)tail+=t.charAt(a+1),a++;for(n.push(i.expression+tail);h.match(/\s$/);)h=h.substr(0,h.length-1);i.expression=h,s="debug",a++}}else i.expression+=e,a++}if(o>0)throw Error("f-string: expected '}'")}return i.length>0&&n.push(i),n};var surrogate=str.$surrogate=$B.make_class("surrogate_string",(function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t.charCodeAt(n);i>=55296&&i<=56319&&(n++,i=1024*(i-55296)+(t.charCodeAt(n)-56320)+65536),e.push(String.fromCodePoint(i))}return{__class__:str.$surrogate,items:e}}));surrogate.__mro__=[str,object],surrogate.__contains__=function(t,e){return str.__contains__(t.items.join(""),e)},surrogate.__getitem__=function(t,e){if(isinstance(e,_b_.int)){var n=e;if(e<0&&(n+=t.items.length),n>=0&&n<t.items.length)return 2==t.items[n].length?surrogate.$factory(t.items[n]):t.items[n];throw _b_.IndexError.$factory("string index out of range")}if(isinstance(e,slice)){var r=_b_.slice.$conv_for_seq(e,t.items.length),i=r.start,s=r.stop,o=r.step,a="",l=null;if(o>0){if(s<=i)return"";for(l=i;l<s;l+=o)a+=t.items[l]}else{if(s>=i)return"";for(l=i;l>s;l+=o)a+=t.items[l]}return a}if(isinstance(e,_b_.bool))return surrogate.__getitem__(t,_b_.int.$factory(e));throw _b_.TypeError.$factory("string indices must be integers")},surrogate.__hash__=function(t){return str.__hash__(t.items.join(""))},surrogate.__iter__=function(t){return str_iterator.$factory(t.items)},surrogate.__len__=function(t){return t.items.length},surrogate.__repr__=function(t){return str.__repr__(t.items.join(""))},surrogate.__str__=function(t){return str.__str__(t.items.join(""))},$B.set_func_names(surrogate,"builtins")}(__BRYTHON__),function($B){var bltns=$B.InjectBuiltins();eval(bltns);var str_hash=_b_.str.__hash__,$N=_b_.None,set_ops=["eq","le","lt","ge","gt","sub","rsub","and","or","xor"];function is_sublist(t,e){for(var n=0,r=t.length;n<r;n++){for(var i=t[n],s=!1,o=0,a=e.length;o<a;o++)if($B.rich_comp("__eq__",i,e[o])){e.splice(o,1),s=!0;break}if(!s)return!1}return!0}function dict_iterator_next(t){if(t.len_func()!=t.len)throw _b_.RuntimeError.$factory("dictionary changed size during iteration");if(t.counter++,t.counter<t.items.length)return t.items[t.counter];throw _b_.StopIteration.$factory("StopIteration")}dict_view_op={__eq__:function(t,e){return t.length==e.length&&is_sublist(t,e)},__ne__:function(t,e){return!dict_view_op.__eq__(t,e)},__lt__:function(t,e){return t.length<e.length&&is_sublist(t,e)},__gt__:function(t,e){return dict_view_op.__lt__(e,t)},__le__:function(t,e){return t.length<=e.length&&is_sublist(t,e)},__ge__:function(t,e){return dict_view_op.__le__(e,t)},__and__:function(t,e){for(var n=[],r=0,i=t.length;r<i;r++){var s=t[r];flag=!1;for(var o=0,a=e.length;o<a;o++)if($B.rich_comp("__eq__",s,e[o])){e.splice(o,1),n.push(s);break}}return n},__or__:function(t,e){for(var n=t,r=0,i=e.length;r<i;r++){for(var s=e[r],o=!1,a=0,l=t.length;a<l;a++)if($B.rich_comp("__eq__",s,t[a])){e.splice(r,1),o=!0;break}o||n.push(s)}return n}},$B.make_view=function(t){for(var e=$B.make_class(t,(function(t,n){return{__class__:e,__dict__:$B.empty_dict(),counter:-1,items:t,len:t.length,set_like:n}})),n=0,r=set_ops.length;n<r;n++){var i="__"+set_ops[n]+"__";e[i]=function(t){return function(n,r){if(n.set_like)return _b_.set[t](_b_.set.$factory(n),_b_.set.$factory(r));if(r.__class__!==e)return!1;var i=_b_.list.$factory(r);return dict_view_op[t](n.items,i)}}(i)}return e.__iter__=function(t){var n=e.$iterator.$factory(t.items);return n.len_func=t.len_func,n},e.__len__=function(t){return t.len},e.__repr__=function(t){return e.$infos.__name__+"("+_b_.repr(t.items)+")"},$B.set_func_names(e,"builtins"),e};var dict={__class__:_b_.type,__mro__:[_b_.object],$infos:{__module__:"builtins",__name__:"dict"},$is_class:!0,$native:!0};function to_list(t,e){var n=[];if(t.$jsobj){for(var r in n=[],t.$jsobj)if("$"!=r.charAt(0)){var i=t.$jsobj[r];void 0===i?i=_b_.NotImplemented:null===i&&(i=$N),n.push([r,i])}}else if(_b_.isinstance(t,_b_.dict)){for(var s in t.$numeric_dict)n.push([parseFloat(s),t.$numeric_dict[s]]);for(var s in t.$string_dict)n.push([s,t.$string_dict[s]]);for(var s in t.$object_dict)t.$object_dict[s].forEach((function(t){n.push(t)}));n.sort((function(t,e){return t[1][1]-e[1][1]})),n=n.map((function(t){return[t[0],t[1][0]]}))}return void 0!==e?n.map((function(t){return t[e]})):(n.__class__=_b_.tuple,n.map((function(t){return t.__class__=_b_.tuple,t})))}function dict_iterator_next(t){if(t.len_func()!=t.len)throw _b_.RuntimeError.$factory("dictionary changed size during iteration");if(t.counter++,t.counter<t.items.length)return t.items[t.counter];throw _b_.StopIteration.$factory("StopIteration")}dict.$to_obj=function(t){var e={};for(var n in t.$string_dict)e[n]=t.$string_dict[n][0];return e},$B.dict_to_list=to_list;var $copy_dict=function(t,e){var n=to_list(e),r=dict.$setitem;e.$version=e.$version||0;for(var i=e.$version||0,s=0,o=n.length;s<o;s++)if(r(t,n[s][0],n[s][1]),e.$version!=i)throw _b_.RuntimeError.$factory("dict mutated during update")};function rank(t,e,n){var r=t.$object_dict[e];if(void 0!==r)for(var i=0,s=r.length;i<s;i++)if($B.rich_comp("__eq__",n,r[i][0]))return i;return-1}function init_from_list(t,e){for(var n=-1,r=e.length-1,i=dict.__setitem__;n++<r;){var s=e[n];switch(typeof s[0]){case"string":t.$string_dict[s[0]]=[s[1],t.$order++],t.$str_hash[str_hash(s[0])]=s[0],t.$version++;break;case"number":if(0!=s[0]&&1!=s[0]){t.$numeric_dict[s[0]]=[s[1],t.$order++],t.$version++;break}default:i(t,s[0],s[1])}}}dict.__bool__=function(){var t=$B.args("__bool__",1,{self:null},["self"],arguments,{},null,null);return dict.__len__(t.self)>0},dict.__class_getitem__=function(t,e){return Array.isArray(e)||(e=[e]),$B.GenericAlias.$factory(t,e)},dict.__contains__=function(){var t=$B.args("__contains__",2,{self:null,key:null},["self","key"],arguments,{},null,null),e=t.self,n=t.key;if(e.$is_namespace&&(n=$B.to_alias(n)),e.$jsobj)return void 0!==e.$jsobj[n];switch(typeof n){case"string":return void 0!==e.$string_dict[n];case"number":return void 0!==e.$numeric_dict[n]}var r=_b_.hash(n);return!(void 0===e.$str_hash[r]||!$B.rich_comp("__eq__",n,e.$str_hash[r]))||!(void 0===e.$numeric_dict[r]||!$B.rich_comp("__eq__",n,r))||rank(e,r,n)>-1},dict.__delitem__=function(){var t=$B.args("__eq__",2,{self:null,arg:null},["self","arg"],arguments,{},null,null),e=t.self,n=t.arg;if(e.$jsobj){if(void 0===e.$jsobj[n])throw _b_.KeyError.$factory(n);return delete e.$jsobj[n],$N}switch(typeof n){case"string":if(void 0===e.$string_dict[n])throw _b_.KeyError.$factory(_b_.str.$factory(n));return delete e.$string_dict[n],delete e.$str_hash[str_hash(n)],e.$version++,$N;case"number":if(void 0===e.$numeric_dict[n])throw _b_.KeyError.$factory(_b_.str.$factory(n));return delete e.$numeric_dict[n],e.$version++,$N}var r,i=_b_.hash(n);if(!((r=rank(e,i,n))>-1))throw _b_.KeyError.$factory(_b_.str.$factory(n));return e.$object_dict[i].splice(r,1),e.$version++,$N},dict.__eq__=function(){var t=$B.args("__eq__",2,{self:null,other:null},["self","other"],arguments,{},null,null),e=t.self,n=t.other;if(!_b_.isinstance(n,dict))return!1;if(e.$jsobj&&(e=jsobj2dict(e.$jsobj)),n.$jsobj&&(n=jsobj2dict(n.$jsobj)),dict.__len__(e)!=dict.__len__(n))return!1;if(e.$string_dict.length!=n.$string_dict.length)return!1;for(var r in e.$numeric_dict)if(n.$numeric_dict.hasOwnProperty(r)){if(!$B.rich_comp("__eq__",n.$numeric_dict[r][0],e.$numeric_dict[r][0]))return!1}else{if(!n.$object_dict.hasOwnProperty(r))return!1;for(var i=!1,s=0,o=(l=n.$object_dict[r]).length;s<o;s++)if($B.rich_comp("__eq__",r,l[s][0])&&$B.rich_comp("__eq__",e.$numeric_dict[r],l[s][1])){i=!0;break}if(!i)return!1}for(var r in e.$string_dict)if(!n.$string_dict.hasOwnProperty(r)||!$B.rich_comp("__eq__",n.$string_dict[r][0],e.$string_dict[r][0]))return!1;for(var a in e.$object_dict){var l=e.$object_dict[a],c=[];if(void 0!==n.$numeric_dict[a]&&c.push([a,n.$numeric_dict[a]]),void 0!==n.$object_dict[a]&&(c=c.concat(n.$object_dict[a])),0==c.length)return!1;s=0;for(var u=l.length;s<u;s++){i=!1;for(var h=l[s][0],p=l[s][1][0],d=0,f=c.length;d<f;d++)if($B.rich_comp("__eq__",h,c[d][0])&&$B.rich_comp("__eq__",p,c[d][1][0])){i=!0;break}if(!i)return!1}}return!0},dict.__getitem__=function(){var t=$B.args("__getitem__",2,{self:null,arg:null},["self","arg"],arguments,{},null,null),e=t.self,n=t.arg;return dict.$getitem(e,n)},dict.$getitem=function(t,e){if(t.$jsobj){if(void 0===t.$jsobj[e]){if(t.$jsobj.hasOwnProperty(e))return $B.Undefined;throw _b_.KeyError.$factory(e)}return t.$jsobj[e]}switch(typeof e){case"string":if(void 0!==t.$string_dict[e])return t.$string_dict[e][0];break;case"number":if(void 0!==t.$numeric_dict[e])return t.$numeric_dict[e][0]}var n=_b_.hash(e),r=function(t){return $B.rich_comp("__eq__",e,t)};"object"==typeof e&&(e.$hash=n);var i=t.$str_hash[n];if(void 0!==i&&r(i))return t.$string_dict[i][0];if(void 0!==t.$numeric_dict[n]&&r(n))return t.$numeric_dict[n][0];if(_b_.isinstance(e,_b_.str)){var s=t.$string_dict[e.valueOf()];if(void 0!==s)return s[0]}var o=rank(t,n,e);if(o>-1)return t.$object_dict[n][o][1][0];if(t.__class__!==dict){try{var a=getattr(t.__class__,"__missing__",_b_.None)}catch(t){console.log(t)}if(a!==_b_.None)return a(t,e)}throw _b_.KeyError.$factory(e)},dict.__hash__=_b_.None,dict.__init__=function(t,e,n){var r;if(void 0===e)return $N;if(void 0===n){if("kw"!=e.$nat&&$B.get_class(e)===$B.JSObj){for(var i in e)t.$string_dict[i]=[e[i],t.$order++];return _b_.None}if(e.$jsobj){for(var s in t.$jsobj={},e.$jsobj)t.$jsobj[s]=e.$jsobj[s];return $N}if(Array.isArray(e))return init_from_list(t,e),$N}var o=(r=r||$B.args("dict",1,{self:null},["self"],arguments,{},"first","second")).first;if(o.length>1)throw _b_.TypeError.$factory("dict expected at most 1 argument, got 2");if(1==o.length)if((o=o[0]).__class__===dict)["$string_dict","$str_hash","$numeric_dict","$object_dict"].forEach((function(e){for(i in o[e])t[e][i]=o[e][i]}));else if(_b_.isinstance(o,dict))$copy_dict(t,o);else{var a=$B.$getattr(o,"keys",null);if(null!==a){var l=$B.$getattr(o,"__getitem__",null);if(null!==l){l=$B.$call(l);for(var c=_b_.iter($B.$call(a)());;)try{var u=l(i=_b_.next(c));dict.__setitem__(t,i,u)}catch(t){if(t.__class__===_b_.StopIteration)break;throw t}return $N}}Array.isArray(o)||(o=_b_.list.$factory(o)),init_from_list(t,o)}var h=r.second.$string_dict;for(var s in h)switch(typeof s){case"string":t.$string_dict[s]=[h[s][0],t.$order++],t.$str_hash[str_hash(s)]=s;break;case"number":t.$numeric_dict[s]=[h[s][0],t.$order++];break;default:si(t,s,h[s][0])}return $N},dict.__iter__=function(t){return _b_.iter(dict.$$keys(t))},dict.__ior__=function(t,e){return dict.update(t,e),t},dict.__len__=function(t){var e=0;if(t.$jsobj){for(var n in t.$jsobj)"$"!=n.charAt(0)&&e++;return e}for(var r in t.$numeric_dict)e++;for(var r in t.$string_dict)e++;for(var i in t.$object_dict)e+=t.$object_dict[i].length;return e},dict.__ne__=function(t,e){return!dict.__eq__(t,e)},dict.__new__=function(t){if(void 0===t)throw _b_.TypeError.$factory("int.__new__(): not enough arguments");var e={__class__:t,$numeric_dict:{},$object_dict:{},$string_dict:{},$str_hash:{},$version:0,$order:0};return t!==dict&&(e.__dict__=$B.empty_dict()),e},dict.__or__=function(t,e){if(!_b_.isinstance(e,dict))return _b_.NotImplemented;var n=dict.copy(t);return dict.update(n,e),n},dict.__repr__=function(t){if(t.$jsobj)return dict.__repr__(jsobj2dict(t.$jsobj));if($B.repr.enter(t))return"{...}";var e=[];return to_list(t).forEach((function(t){try{e.push(repr(t[0])+": "+repr(t[1]))}catch(t){throw t}})),$B.repr.leave(t),"{"+e.join(", ")+"}"},dict.__ror__=function(t,e){if(!_b_.isinstance(e,dict))return _b_.NotImplemented;var n=dict.copy(e);return dict.update(n,t),n},dict.__setitem__=function(t,e,n){var r=$B.args("__setitem__",3,{self:null,key:null,value:null},["self","key","value"],arguments,{},null,null);return dict.$setitem(r.self,r.key,r.value)},dict.$setitem=function(t,e,n,r){if(t.$jsobj)return t.$from_js&&(n=$B.pyobj2jsobj(n)),t.$jsobj.__class__===_b_.type?(t.$jsobj[e]=n,"__init__"!=e&&"__new__"!=e||(t.$jsobj.$factory=$B.$instance_creator(t.$jsobj))):t.$jsobj[e]=n,$N;switch(typeof e){case"string":return void 0===t.$string_dict&&console.log("pas de string dict",t,e,n),void 0!==t.$string_dict[e]?t.$string_dict[e][0]=n:(t.$string_dict[e]=[n,t.$order++],t.$str_hash[str_hash(e)]=e,t.$version++),$N;case"number":if(void 0!==t.$numeric_dict[e])t.$numeric_dict[e][0]=n;else{var i=!1;if((0==e||1==e)&&void 0!==t.$object_dict[e])for(const r of t.$object_dict[e])(0==e&&!1===r[0]||1==e&&!0===r[0])&&(r[1][0]=n,i=!0);i||(t.$numeric_dict[e]=[n,t.$order++]),t.$version++}return $N;case"boolean":var s=e?1:0;if(void 0!==t.$numeric_dict[s]){var o=t.$numeric_dict[s][1];return void(t.$numeric_dict[s]=[n,o])}void 0!==t.$object_dict[s]?t.$object_dict[s].push([e,[n,t.$order++]]):t.$object_dict[s]=[[e,[n,t.$order++]]]}var a=void 0===r?_b_.hash(e):r,l=function(t){return $B.rich_comp("__eq__",e,t)};if(void 0!==t.$numeric_dict[a]&&l(a))return t.$numeric_dict[a]=[n,t.$numeric_dict[a][1]],t.$version++,$N;var c=t.$str_hash[a];if(void 0!==c&&l(c))return t.$string_dict[c]=[n,t.$string_dict[c][1]],t.$version++,$N;if(r)return void 0!==t.$object_dict[r]?t.$object_dict[r].push([e,[n,t.$order++]]):t.$object_dict[r]=[[e,[n,t.$order++]]],t.$version++,$N;var u=rank(t,a,e);return u>-1?(t.$object_dict[a][u][1]=[n,t.$object_dict[a][u][1][1]],$N):(t.$object_dict.hasOwnProperty(a)?t.$object_dict[a].push([e,[n,t.$order++]]):t.$object_dict[a]=[[e,[n,t.$order++]]],t.$version++,$N)},dict.__str__=function(){return dict.__repr__.apply(null,arguments)},$B.make_rmethods(dict),dict.clear=function(){var t=$B.args("clear",1,{self:null},["self"],arguments,{},null,null).self;if(t.$numeric_dict={},t.$string_dict={},t.$str_hash={},t.$object_dict={},t.$jsobj)for(var e in t.$jsobj)"$"!==e.charAt(0)&&"__class__"!==e&&delete t.$jsobj[e];return t.$version++,t.$order=0,$N},dict.copy=function(t){t=$B.args("copy",1,{self:null},["self"],arguments,{},null,null).self;var e=$B.empty_dict();return $copy_dict(e,t),e},dict.fromkeys=function(){for(var t=$B.args("fromkeys",3,{cls:null,keys:null,value:null},["cls","keys","value"],arguments,{value:_b_.None},null,null),e=t.keys,n=t.value,r=t.cls,i=$B.$call(r)(),s=$B.$iter(e);;)try{var o=_b_.next(s);r===dict?dict.$setitem(i,o,n):$B.$getattr(i,"__setitem__")(o,n)}catch(t){if($B.is_exc(t,[_b_.StopIteration]))return i;throw t}},dict.get=function(){var t=$B.args("get",3,{self:null,key:null,_default:null},["self","key","_default"],arguments,{_default:$N},null,null);try{return dict.__getitem__(t.self,t.key)}catch(e){if(_b_.isinstance(e,_b_.KeyError))return t._default;throw e}};var dict_items=$B.make_view("dict_items",!0);dict_items.$iterator=$B.make_iterator_class("dict_itemiterator"),dict.items=function(t){if(arguments.length>1){var e="items() takes no arguments ("+(arguments.length-1)+" given)";throw _b_.TypeError.$factory(e)}for(var n=to_list(t),r=!0,i=0,s=n.length;i<s;i++)try{_b_.hash(n[i][1])}catch(t){r=!1;break}var o=dict_items.$factory(to_list(t),r);return o.len_func=function(){return dict.__len__(t)},o};var dict_keys=$B.make_view("dict_keys");dict_keys.$iterator=$B.make_iterator_class("dict_keyiterator"),dict.$$keys=function(t){if(arguments.length>1){var e="keys() takes no arguments ("+(arguments.length-1)+" given)";throw _b_.TypeError.$factory(e)}var n=dict_keys.$factory(to_list(t,0),!0);return n.len_func=function(){return dict.__len__(t)},n},dict.pop=function(){var t={},e=$B.args("pop",3,{self:null,key:null,_default:null},["self","key","_default"],arguments,{_default:t},null,null),n=e.self,r=e.key,i=e._default;try{var s=dict.__getitem__(n,r);return dict.__delitem__(n,r),s}catch(e){if(e.__class__===_b_.KeyError){if(i!==t)return i;throw e}throw e}},dict.popitem=function(t){try{var e=_b_.next(_b_.iter(dict.items(t)));return dict.__delitem__(t,e[0]),_b_.tuple.$factory(e)}catch(t){if(t.__class__==_b_.StopIteration)throw _b_.KeyError.$factory("'popitem(): dictionary is empty'")}},dict.setdefault=function(){var t=$B.args("setdefault",3,{self:null,key:null,_default:null},["self","key","_default"],arguments,{_default:$N},null,null),e=t.self,n=t.key,r=t._default;try{return dict.__getitem__(e,n)}catch(t){if(t.__class__!==_b_.KeyError)throw t;void 0===r&&(r=$N);var i=n.$hash;return n.$hash=void 0,dict.$setitem(e,n,r,i),r}},dict.update=function(t){var e=$B.args("update",1,{self:null},["self"],arguments,{},"args","kw"),n=(t=e.self,e.args),r=e.kw;if(n.length>0){var i=n[0];if(_b_.isinstance(i,dict))i.$jsobj&&(i=jsobj2dict(i.$jsobj)),$copy_dict(t,i);else if(_b_.hasattr(i,"keys"))for(var s=_b_.list.$factory($B.$call($B.$getattr(i,"keys"))()),o=0,a=s.length;o<a;o++){var l=getattr(i,"__getitem__")(s[o]);dict.$setitem(t,s[o],l)}else{var c=_b_.iter(i);for(o=0;;){try{var u=_b_.next(c)}catch(t){if(t.__class__===_b_.StopIteration)break;throw t}try{key_value=_b_.list.$factory(u)}catch(t){throw _b_.TypeError.$factory("cannot convert dictionary update sequence element #"+o+" to a sequence")}if(2!==key_value.length)throw _b_.ValueError.$factory("dictionary update sequence element #"+o+" has length "+key_value.length+"; 2 is required");dict.$setitem(t,key_value[0],key_value[1]),o++}}}return $copy_dict(t,r),t.$version++,$N};var dict_values=$B.make_view("dict_values");dict_values.$iterator=$B.make_iterator_class("dict_valueiterator"),dict.values=function(t){if(arguments.length>1){var e="values() takes no arguments ("+(arguments.length-1)+" given)";throw _b_.TypeError.$factory(e)}to_list(t,1);var n=dict_values.$factory(to_list(t,1),!1);return n.len_func=function(){return dict.__len__(t)},n},dict.$factory=function(){for(var t=dict.__new__(dict),e=[t],n=0,r=arguments.length;n<r;n++)e.push(arguments[n]);return dict.__init__.apply(null,e),t},_b_.dict=dict,$B.set_func_names(dict,"builtins"),dict.__class_getitem__=_b_.classmethod.$factory(dict.__class_getitem__),$B.empty_dict=function(){return{__class__:dict,$numeric_dict:{},$object_dict:{},$string_dict:{},$str_hash:{},$version:0,$order:0}},dict.fromkeys=_b_.classmethod.$factory(dict.fromkeys),$B.getset_descriptor=$B.make_class("getset_descriptor",(function(t,e){return{__class__:$B.getset_descriptor,__doc__:_b_.None,cls:t,attr:e}})),$B.getset_descriptor.__repr__=$B.getset_descriptor.__str__=function(t){return`<attribute '${t.attr}' of '${t.cls.$infos.__name__}' objects>`},$B.set_func_names($B.getset_descriptor,"builtins");var mappingproxy=$B.mappingproxy=$B.make_class("mappingproxy",(function(t){if(_b_.isinstance(t,dict))var e=$B.obj_dict(dict.$to_obj(t));else e=$B.obj_dict(t);return e.__class__=mappingproxy,e}));for(var attr in mappingproxy.__setitem__=function(){throw _b_.TypeError.$factory("'mappingproxy' object does not support item assignment")},dict)void 0!==mappingproxy[attr]||["__class__","__mro__","__new__","__init__","__delitem__","clear","fromkeys","pop","popitem","setdefault","update"].indexOf(attr)>-1||("function"==typeof dict[attr]?mappingproxy[attr]=function(t){return function(){return dict[t].apply(null,arguments)}}(attr):mappingproxy[attr]=dict[attr]);function jsobj2dict(t){var e=$B.empty_dict();for(var n in t)if("$"!=n.charAt(0)&&"__class__"!==n)if(null===t[n])e.$string_dict[n]=[_b_.None,e.$order++];else{if(void 0===t[n])continue;t[n].$jsobj===t?e.$string_dict[n]=[e,e.$order++]:e.$string_dict[n]=[$B.$JS2Py(t[n]),e.$order++]}return e}$B.set_func_names(mappingproxy,"builtins"),$B.obj_dict=function(t,e){var n=t.__class__||$B.get_class(t);if(void 0!==n&&n.$native)throw _b_.AttributeError.$factory(n.__name__+" has no attribute '__dict__'");var r=$B.empty_dict();return r.$jsobj=t,r.$from_js=e,r}}(__BRYTHON__),function(t){var e=t.builtins,n=e.object,r=self;function i(t){var e=0,n=0,r=t.width||t.offsetWidth,s=t.height||t.offsetHeight;for(document.scrollingElement.scrollTop;t.offsetParent;)e+=t.offsetLeft,n+=t.offsetTop,t=t.offsetParent;if(e+=t.offsetLeft||0,n+=t.offsetTop||0,t.parentElement){var o=i(t.parentElement);e+=o.left,n+=o.top}return{left:e,top:n,width:r,height:s}}function s(t){if(t.type.startsWith("touch"))return(n={}).x=e.int.$factory(t.touches[0].screenX),n.y=e.int.$factory(t.touches[0].screenY),n.__getattr__=function(t){return this[t]},n.__class__="MouseCoords",n;var n,i=0,s=0;return t||(t=r.event),t.pageX||t.pageY?(i=t.pageX,s=t.pageY):(t.clientX||t.clientY)&&(i=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,s=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),(n={}).x=e.int.$factory(i),n.y=e.int.$factory(s),n.__getattr__=function(t){return this[t]},n.__class__="MouseCoords",n}t.$isNode=function(t){return"object"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName},t.$isNodeList=function(t){try{var e=Object.prototype.toString.call(t),n=new RegExp("^\\[object (HTMLCollection|NodeList)\\]$");return"object"==typeof t&&null!==n.exec(e)&&void 0!==t.length&&(0==t.length||"object"==typeof t[0]&&t[0].nodeType>0)}catch(t){return!1}};var o=["NONE","CAPTURING_PHASE","AT_TARGET","BUBBLING_PHASE","type","target","currentTarget","eventPhase","bubbles","cancelable","timeStamp","stopPropagation","preventDefault","initEvent"],a=["altKey","altLeft","button","cancelBubble","clientX","clientY","contentOverflow","ctrlKey","ctrlLeft","data","dataFld","dataTransfer","fromElement","keyCode","nextPage","offsetX","offsetY","origin","propertyName","reason","recordset","repeat","screenX","screenY","shiftKey","shiftLeft","source","srcElement","srcFilter","srcUrn","toElement","type","url","wheelDelta","x","y"];t.$isEvent=function(t){for(var e=!0,n=0;n<o.length;n++)if(void 0===t[o[n]]){e=!1;break}if(e)return!0;for(n=0;n<a.length;n++)if(void 0===t[a[n]])return!1;return!0};var l={1:"ELEMENT",2:"ATTRIBUTE",3:"TEXT",4:"CDATA_SECTION",5:"ENTITY_REFERENCE",6:"ENTITY",7:"PROCESSING_INSTRUCTION",8:"COMMENT",9:"DOCUMENT",10:"DOCUMENT_TYPE",11:"DOCUMENT_FRAGMENT",12:"NOTATION"},c=t.make_class("Attributes",(function(t){return{__class__:c,elt:t}}));c.__contains__=function(){var e=t.args("__getitem__",2,{self:null,key:null},["self","key"],arguments,{},null,null);return e.self.elt instanceof SVGElement?e.self.elt.hasAttributeNS(null,e.key):"function"==typeof e.self.elt.hasAttribute&&e.self.elt.hasAttribute(e.key)},c.__delitem__=function(){var n=t.args("__getitem__",2,{self:null,key:null},["self","key"],arguments,{},null,null);if(!c.__contains__(n.self,n.key))throw e.KeyError.$factory(n.key);return n.self.elt instanceof SVGElement?(n.self.elt.removeAttributeNS(null,n.key),e.None):"function"==typeof n.self.elt.hasAttribute?(n.self.elt.removeAttribute(n.key),e.None):void 0},c.__getitem__=function(){var n=t.args("__getitem__",2,{self:null,key:null},["self","key"],arguments,{},null,null);if(n.self.elt instanceof SVGElement&&n.self.elt.hasAttributeNS(null,n.key))return n.self.elt.getAttributeNS(null,n.key);if("function"==typeof n.self.elt.hasAttribute&&n.self.elt.hasAttribute(n.key))return n.self.elt.getAttribute(n.key);throw e.KeyError.$factory(n.key)},c.__iter__=function(t){t.$counter=0;for(var e=t.elt.attributes,n=[],r=0;r<e.length;r++)n.push(e[r].name);return t.$items=n,t},c.__next__=function(){var n=t.args("__next__",1,{self:null},["self"],arguments,{},null,null);if(n.self.$counter<n.self.$items.length){var r=n.self.$items[n.self.$counter];return n.self.$counter++,r}throw e.StopIteration.$factory("")},c.__setitem__=function(){var n=t.args("__setitem__",3,{self:null,key:null,value:null},["self","key","value"],arguments,{},null,null);if(n.self.elt instanceof SVGElement&&"function"==typeof n.self.elt.setAttributeNS)return n.self.elt.setAttributeNS(null,n.key,n.value),e.None;if("function"==typeof n.self.elt.setAttribute)return n.self.elt.setAttribute(n.key,n.value),e.None;throw e.TypeError.$factory("Can't set attributes on element")},c.__repr__=c.__str__=function(t){for(var e=t.elt.attributes,n=[],r=0;r<e.length;r++)n.push(e[r].name+': "'+t.elt.getAttributeNS(null,e[r].name)+'"');return"{"+n.join(", ")+"}"},c.get=function(){var n=t.args("get",3,{self:null,key:null,deflt:null},["self","key","deflt"],arguments,{deflt:e.None},null,null);try{return c.__getitem__(n.self,n.key)}catch(t){if(t.__class__===e.KeyError)return n.deflt;throw t}},c.keys=function(){return c.__iter__.apply(null,arguments)},c.items=function(){for(var n=t.args("values",1,{self:null},["self"],arguments,{},null,null).self.attributes,r=[],i=0;i<n.length;i++)r.push([n[i].name,n[i].value]);return e.list.__iter__(r)},c.values=function(){for(var n=t.args("values",1,{self:null},["self"],arguments,{},null,null).self.attributes,r=[],i=0;i<n.length;i++)r.push(n[i].value);return e.list.__iter__(r)},t.set_func_names(c,"<dom>");var u=t.DOMEvent={__class__:e.type,__mro__:[n],$infos:{__name__:"DOMEvent"}};function h(t,e){var n=t.createSVGPoint();return n.x=e.x,n.y=e.y,n.matrixTransform(t.getScreenCTM().inverse())}u.__new__=function(t,e){var n=new Event(e);return n.__class__=u,void 0===n.preventDefault&&(n.preventDefault=function(){n.returnValue=!1}),void 0===n.stopPropagation&&(n.stopPropagation=function(){n.cancelBubble=!0}),n},u.__getattribute__=function(n,r){switch(r){case"__repr__":case"__str__":return function(){return"<DOMEvent object>"};case"x":return s(n).x;case"y":return s(n).y;case"data":return null!==n.dataTransfer?d.$factory(n.dataTransfer):t.$JS2Py(n.data);case"target":if(void 0!==n.target)return g.$factory(n.target);case"char":return String.fromCharCode(n.which);case"svgX":if(n.target instanceof SVGSVGElement)return Math.floor(h(n.target,s(n)).x);throw e.AttributeError.$factory("event target is not an SVG element");case"svgY":if(n.target instanceof SVGSVGElement)return Math.floor(h(n.target,s(n)).y);throw e.AttributeError.$factory("event target is not an SVG element")}var i=n[r];if(void 0!==i){if("function"==typeof i){var o=function(){for(var e=[],r=0;r<arguments.length;r++)e.push(t.pyobj2jsobj(arguments[r]));return i.apply(n,arguments)};return o.$infos={__name__:i.name,__qualname__:i.name},o}return t.$JS2Py(i)}throw e.AttributeError.$factory("object DOMEvent has no attribute '"+r+"'")},u.$factory=function(t){return u.__new__(u,t)};var p=t.$DOMEvent=function(t){return t.__class__=u,t.$no_dict=!0,void 0===t.preventDefault&&(t.preventDefault=function(){t.returnValue=!1}),void 0===t.stopPropagation&&(t.stopPropagation=function(){t.cancelBubble=!0}),t};t.set_func_names(u,"browser");var d={__class__:e.type,$infos:{__module__:"browser",__name__:"Clipboard"},__getitem__:function(t,e){return t.data.getData(e)}};d.__mro__=[n],d.__setitem__=function(t,e,n){t.data.setData(e,n)},d.$factory=function(e){return{__class__:d,__dict__:t.empty_dict(),data:e}},t.set_func_names(d,"<dom>");var f=t.OpenFile={__class__:e.type,__mro__:[n],$infos:{__module__:"<pydom>",__name__:"OpenFile"}};f.$factory=function(t,e,n){var r={__class__:$OpenFileDict,file:t,reader:new FileReader};return"r"===e?r.reader.readAsText(t,n):"rb"===e&&r.reader.readAsBinaryString(t),r},f.__getattr__=function(t,e){return void 0!==t["get_"+e]?t["get_"+e]:t.reader[e]},f.__setattr__=function(t,e,n){var r=t.reader;if("on"==e.substr(0,2))r.addEventListener(e.substr(2),(function(t){return n(p(t))}));else{if("set_"+e in r)return r["set_"+e](n);e in r?r[e]=n:setattr(r,e,n)}},t.set_func_names(f,"<dom>");var m={File:function(){},FileReader:function(){}};m.File.__class__=e.type,m.File.__str__=function(){return"<class 'File'>"},m.FileReader.__class__=e.type,m.FileReader.__str__=function(){return"<class 'FileReader'>"};var _={__class__:e.type,__delitem__:function(t,e){t.parent.options.remove(e.elt)},__getitem__:function(t,e){return g.$factory(t.parent.options[e])},__len__:function(t){return t.parent.options.length},__mro__:[n],__setattr__:function(t,e,n){t.parent.options[e]=n},__setitem__:function(e,n,r){e.parent.options[n]=t.$JS2Py(r)},__str__:function(t){return"<object Options wraps "+t.parent.options+">"},append:function(t,e){t.parent.options.add(e.elt)},insert:function(t,e,n){void 0===e?t.parent.options.add(n.elt):t.parent.options.add(n.elt,e)},item:function(t,e){return t.parent.options.item(e)},namedItem:function(t,e){return t.parent.options.namedItem(e)},remove:function(t,e){t.parent.options.remove(e.elt)},$infos:{__module__:"<pydom>",__name__:"Options"},$factory:function(t){return{__class__:_,parent:t}}};t.set_func_names(_,"<dom>");var g={__class__:e.type,__mro__:[n],$infos:{__module__:"browser",__name__:"DOMNode"}};function y(t){for(var e=[],n=0;n<t.length;n++)e.push(g.$factory(t[n]));return e}g.$factory=function(e,n){if(e.__class__===g)return e;if("number"==typeof e||"boolean"==typeof e||"string"==typeof e)return e;if(void 0===n&&void 0!==g.tags){var r=g.tags.$string_dict;if(void 0!==r&&r.hasOwnProperty(e.tagName)){try{var i=r[e.tagName][0]}catch(t){throw console.log("tdict",r,"tag name",e.tagName),t}if(void 0!==i)return i.$elt_wrap=e,i.$factory()}}return void 0!==e.$brython_id&&9!=e.nodeType||(e.$brython_id="DOM-"+t.UUID()),e},g.__add__=function(n,r){var i=x.$factory();if(i.children=[n],pos=1,e.isinstance(r,x))i.children=i.children.concat(r.children);else if(e.isinstance(r,[e.str,e.int,e.float,e.list,e.dict,e.set,e.tuple]))i.children[pos++]=g.$factory(document.createTextNode(e.str.$factory(r)));else if(e.isinstance(r,g))i.children[pos++]=r;else try{i.children=i.children.concat(e.list.$factory(r))}catch(n){throw e.TypeError.$factory("can't add '"+t.class_name(r)+"' object to DOMNode instance")}return i},g.__bool__=function(t){return!0},g.__contains__=function(t,e){if(9==t.nodeType&&"string"==typeof e)return null!==document.getElementById(e);if(void 0!==t.length&&"function"==typeof t.item)for(var n=0,r=t.length;n<r;n++)if(t.item(n)===e)return!0;return!1},g.__del__=function(t){if(!t.parentNode)throw e.ValueError.$factory("can't delete "+e.str.$factory(t));t.parentNode.removeChild(t)},g.__delattr__=function(t,n){if(void 0===t[n])throw e.AttributeError.$factory(`cannot delete DOMNode attribute '${n}'`);return delete t[n],e.None},g.__delitem__=function(t,n){if(9==t.nodeType){var r=t.getElementById(n);if(!r)throw e.KeyError.$factory(n);r.parentNode.removeChild(r)}else t.parentNode.removeChild(t)},g.__dir__=function(t){var e=[];for(var n in t)"$"!=n.charAt(0)&&e.push(n);return e.sort(),e},g.__eq__=function(t,e){return t==e},g.__getattribute__=function(r,s){switch("$$"==s.substr(0,2)&&(s=s.substr(2)),s){case"attrs":return c.$factory(r);case"class_name":case"html":case"id":case"parent":case"text":return g[s](r);case"height":case"left":case"top":case"width":if("CANVAS"==r.tagName&&r[s])return r[s];if(r instanceof SVGElement)return r[s].baseVal.value;if(r.style[s])return parseInt(r.style[s]);var o=window.getComputedStyle(r)[s];if(void 0!==o)return Math.floor(parseFloat(o)+.5);throw e.AttributeError.$factory("style."+s+" is not set for "+e.str.$factory(r));case"x":case"y":if(!(r instanceof SVGElement)){var a=i(r);return"x"==s?a.left:a.top}case"clear":case"closest":return function(){return g[s](r,arguments[0])};case"headers":if(9==r.nodeType){var l=new XMLHttpRequest;l.open("GET",document.location,!1),l.send(null);var u=l.getAllResponseHeaders();u=u.split("\r\n");for(var h=t.empty_dict(),p=0;p<u.length;p++){var d=u[p];0!=d.strip().length&&(a=d.search(":"),h.__setitem__(d.substr(0,a),d.substr(a+1).lstrip()))}return h}break;case"$$location":s="location"}if("select"==s&&1==r.nodeType&&["INPUT","TEXTAREA"].indexOf(r.tagName.toUpperCase())>-1)return function(t){return void 0===t?(r.select(),e.None):g.select(r,t)};if("query"==s&&9==r.nodeType){h={__class__:v,_keys:[],_values:{}};var f=location.search.substr(1).split("&");if(""!=location.search)for(p=0;p<f.length;p++){a=f[p].search("=");var m=[f[p].substr(0,a),f[p].substr(a+1)],y=decodeURIComponent(m[0]),b=decodeURIComponent(m[1]);h._keys.indexOf(y)>-1?h._values[y].push(b):(h._keys.push(y),h._values[y]=[b])}return h}var x=r[s];if(void 0===x&&t.aliased_names[s]&&(x=r["$$"+s]),void 0===x){if(r.tagName){var w=customElements.get(r.tagName.toLowerCase());if(void 0!==w&&void 0!==w.$cls){var S=r.__class__;r.__class__=w.$cls;try{h=e.object.__getattribute__(r,s);return r.__class__=S,h}catch(n){if(r.__class__=S,!t.is_exc(n,[e.AttributeError]))throw n}}}return n.__getattribute__(r,s)}if(void 0!==(h=x)){if(null===h)return e.None;if("function"==typeof h){var M=function(n,r){return function(){for(var i=[],s=0,o=0;o<arguments.length;o++){var a=arguments[o];if("function"==typeof a){if(a.$cache)var l=a.$cache;else l=function(e){return function(){try{return e.apply(null,arguments)}catch(e){t.handle_error(e)}}}(a),a.$cache=l;i[s++]=l}else e.isinstance(a,g)?i[s++]=a:a===e.None?i[s++]=null:a.__class__==e.dict?i[s++]=e.dict.$to_obj(a):i[s++]=a}var c=n.apply(r,i);return t.$JS2Py(c)}}(h,r);return M.$infos={__name__:s,__qualname__:s},M.$is_func=!0,M}return"options"==s?_.$factory(r):"style"==s?t.JSObj.$factory(r[s]):Array.isArray(h)?h:t.$JS2Py(h)}return n.__getattribute__(r,s)},g.__getitem__=function(t,n){if(9==t.nodeType){if("string"==typeof n){if(i=t.getElementById(n))return g.$factory(i);throw e.KeyError.$factory(n)}try{for(var r=t.getElementsByTagName(n.$infos.__name__),i=[],s=0;s<r.length;s++)i.push(g.$factory(r[s]));return i}catch(t){throw e.KeyError.$factory(e.str.$factory(n))}}else{if(("number"==typeof n||"boolean"==typeof n)&&"function"==typeof t.item){var o=e.int.$factory(n);if(o<0&&(o+=t.length),void 0===(i=g.$factory(t.item(o))))throw e.KeyError.$factory(n);return i}if("string"==typeof n&&t.attributes&&"function"==typeof t.attributes.getNamedItem){var a=t.attributes.getNamedItem(n);if(a)return a.value;throw e.KeyError.$factory(n)}}},g.__hash__=function(e){return void 0===e.__hashvalue__?e.__hashvalue__=t.$py_next_hash--:e.__hashvalue__},g.__iter__=function(e){if(void 0!==e.length&&"function"==typeof e.item)for(var n=[],r=0,i=e.length;r<i;r++)n.push(g.$factory(e.item(r)));else if(void 0!==e.childNodes)for(n=[],r=0,i=e.childNodes.length;r<i;r++)n.push(g.$factory(e.childNodes[r]));return t.$iter(n)},g.__le__=function(n,r){if(9==n.nodeType&&(n=n.body),e.isinstance(r,x))for(var i=0;i<r.children.length;i++)n.appendChild(r.children[i]);else if("string"==typeof r||"number"==typeof r){var s=document.createTextNode(r.toString());n.appendChild(s)}else if(e.isinstance(r,g))n.appendChild(r);else try{e.list.$factory(r).forEach((function(t){g.__le__(n,t)}))}catch(n){throw e.TypeError.$factory("can't add '"+t.class_name(r)+"' object to DOMNode instance")}return!0},g.__len__=function(t){return t.length},g.__mul__=function(t,n){if(e.isinstance(n,e.int)&&n.valueOf()>0){for(var r=x.$factory(),i=r.children.length,s=0;s<n.valueOf();s++)r.children[i++]=g.clone(t)();return r}throw e.ValueError.$factory("can't multiply "+t.__class__+"by "+n)},g.__ne__=function(t,e){return!g.__eq__(t,e)},g.__next__=function(t){if(t.$counter++,t.$counter<t.childNodes.length)return g.$factory(t.childNodes[t.$counter]);throw e.StopIteration.$factory("StopIteration")},g.__radd__=function(t,e){var n=x.$factory(),r=g.$factory(document.createTextNode(e));return n.children=[r,t],n},g.__str__=g.__repr__=function(t){var e=t.attributes;if(void 0!==e)for(var n=[],r=0;r<e.length;r++)n.push(e[r].name+'="'+t.getAttributeNS(null,e[r].name)+'"');var i=Object.getPrototypeOf(t);if(i){var s=i.constructor.name;if(void 0===s){var o=i.constructor.toString();s=o.substring(8,o.length-1)}return n.splice(0,0,s),"<"+n.join(" ")+">"}return"<DOMNode object type '"+l[t.nodeType]+"' name '"+t.nodeName+"'>"},g.__setattr__=function(n,r,i){if("on"!=r.substr(0,2)){switch(r){case"left":case"top":case"width":case"height":if(e.isinstance(i,e.int)&&1==n.nodeType)return n.style[r]=i+"px",e.None;throw e.ValueError.$factory(r+" value should be an integer, not "+t.class_name(i))}if(void 0!==g["set_"+r])return g["set_"+r](n,i);function s(e){console.log(e);var n=t.last(t.frames_stack);if(t.debug>0){var r=n[1].$line_info.split(",");if(console.log("module",r[1],"line",r[0]),t.$py_src.hasOwnProperty(r[1])){var i=t.$py_src[r[1]];console.log(i.split("\n")[parseInt(r[0])-1])}}else console.log("module",n[2])}for(var o=Object.getPrototypeOf(n),a=0;o&&o!==Object.prototype&&a++<10;){var l=Object.getOwnPropertyDescriptors(o);if(!l||"function"!=typeof l.hasOwnProperty)break;if(l.hasOwnProperty(r)){l[r].writable||void 0!==l[r].set||s("Warning: property '"+r+"' is not writable. Use element.attrs['"+r+"'] instead.");break}o=Object.getPrototypeOf(o)}return n.style&&void 0!==n.style[r]&&s("Warning: '"+r+"' is a property of element.style"),n[r]=i,e.None}t.$bool(i)?g.bind(n,r.substr(2),i):g.unbind(n,r.substr(2))},g.__setitem__=function(t,e,n){"number"==typeof e?t.childNodes[e]=n:"string"==typeof e&&t.attributes&&(t instanceof SVGElement?t.setAttributeNS(null,e,n):"function"==typeof t.setAttribute&&t.setAttribute(e,n))},g.abs_left={__get__:function(t){return i(t).left},__set__:function(){throw e.AttributeError.$factory("'DOMNode' objectattribute 'abs_left' is read-only")}},g.abs_top={__get__:function(t){return i(t).top},__set__:function(){throw e.AttributeError.$factory("'DOMNode' objectattribute 'abs_top' is read-only")}},g.attach=g.__le__,g.bind=function(n,r){var i=t.args("bind",4,{self:null,event:null,func:null,options:null},["self","event","func","options"],arguments,{func:e.None,options:e.None},null,null),s=(n=i.self,r=i.event,i.func),o=i.options;if(s===e.None)return function(t){return g.bind(n,r,t)};var a,l=(a=s,function(e){try{return a(p(e))}catch(e){if(void 0!==e.__class__)t.handle_error(e);else try{t.$getattr(t.stderr,"write")(e)}catch(t){console.log(e)}}});return l.$infos=s.$infos,l.$attrs=s.$attrs||{},l.$func=s,"boolean"==typeof o?n.addEventListener(r,l,o):o.__class__===e.dict?n.addEventListener(r,l,e.dict.$to_obj(o)):o===e.None&&n.addEventListener(r,l,!1),n.$events=n.$events||{},n.$events[r]=n.$events[r]||[],n.$events[r].push([s,l]),n},g.children=function(t){var e=[];return 9==t.nodeType&&(t=t.body),t.childNodes.forEach((function(t){e.push(g.$factory(t))})),e},g.clear=function(t){for(9==t.nodeType&&(t=t.body);t.firstChild;)t.removeChild(t.firstChild)},g.Class=function(t){return void 0!==t.className?t.className:e.None},g.class_name=function(t){return g.Class(t)},g.clone=function(t){var e=g.$factory(t.cloneNode(!0)),n=t.$events||{};for(var r in n)n[r].forEach((function(t){var n=t[0];g.bind(e,r,n)}));return e},g.closest=function(t,n){var r=t.closest(n);if(null===r)throw e.KeyError.$factory("no parent with selector "+n);return g.$factory(r)},g.events=function(t,e){t.$events=t.$events||{};var n=t.$events[e]=t.$events[e]||[],r=[];return n.forEach((function(t){r.push(t[1])})),r},g.focus=function(t){return e=t,function(){setTimeout((function(){e.focus()}),10)};var e},g.get=function(n){for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);var s=t.args("get",0,{},[],r,{},null,"kw"),o={};if(e.list.$factory(e.dict.items(s.kw)).forEach((function(t){o[t[0]]=t[1]})),void 0!==o.name){if(void 0===n.getElementsByName)throw e.TypeError.$factory("DOMNode object doesn't support selection by name");return y(n.getElementsByName(o.name))}if(void 0!==o.tag){if(void 0===n.getElementsByTagName)throw e.TypeError.$factory("DOMNode object doesn't support selection by tag name");return y(n.getElementsByTagName(o.tag))}if(void 0!==o.classname){if(void 0===n.getElementsByClassName)throw e.TypeError.$factory("DOMNode object doesn't support selection by class name");return y(n.getElementsByClassName(o.classname))}if(void 0!==o.id){if(void 0===n.getElementById)throw e.TypeError.$factory("DOMNode object doesn't support selection by id");var a=document.getElementById(o.id);return a?[g.$factory(a)]:[]}if(void 0!==o.selector){if(void 0===n.querySelectorAll)throw e.TypeError.$factory("DOMNode object doesn't support selection by selector");return y(n.querySelectorAll(o.selector))}return res},g.getContext=function(n){if(!("getContext"in n))throw e.AttributeError.$factory("object has no attribute 'getContext'");return function(e){return t.JSObj.$factory(n.getContext(e))}},g.getSelectionRange=function(t){if(void 0!==t.getSelectionRange)return t.getSelectionRange.apply(null,arguments)},g.html=function(t){var n=t.innerHTML;return void 0===n&&(n=9==t.nodeType?t.body.innerHTML:e.None),n},g.id=function(t){return void 0!==t.id?t.id:e.None},g.index=function(t,e){var n;n=void 0===e?t.parentElement.childNodes:t.parentElement.querySelectorAll(e);for(var r=-1,i=0;i<n.length;i++)if(n[i]===t){r=i;break}return r},g.inside=function(t,e){for(var n=t;;){if(e===n)return!0;if(!(n=n.parentElement))return!1}},g.options=function(t){return new $OptionsClass(t)},g.parent=function(t){return t.parentElement?g.$factory(t.parentElement):e.None},g.reset=function(t){return function(){t.reset()}},g.scrolled_left={__get__:function(t){return i(t).left-document.scrollingElement.scrollLeft},__set__:function(){throw e.AttributeError.$factory("'DOMNode' objectattribute 'scrolled_left' is read-only")}},g.scrolled_top={__get__:function(t){return i(t).top-document.scrollingElement.scrollTop},__set__:function(){throw e.AttributeError.$factory("'DOMNode' objectattribute 'scrolled_top' is read-only")}},g.select=function(t,n){if(void 0===t.querySelectorAll)throw e.TypeError.$factory("DOMNode object doesn't support selection by selector");return y(t.querySelectorAll(n))},g.select_one=function(t,n){if(void 0===t.querySelector)throw e.TypeError.$factory("DOMNode object doesn't support selection by selector");var r=t.querySelector(n);return null===r?e.None:g.$factory(r)},g.style=function(e){return e.style.float=e.style.cssFloat||e.styleFloat,t.JSObj.$factory(e.style)},g.setSelectionRange=function(t){return void 0!==this.setSelectionRange?(e=this,function(){return e.setSelectionRange.apply(e,arguments)}):void 0!==this.createTextRange?function(t){return function(e,n){null==n&&(n=e);var r=t.createTextRange();r.collapse(!0),r.moveEnd("character",e),r.moveStart("character",n),r.select()}}(this):void 0;var e},g.set_class_name=function(t,e){t.setAttribute("class",e)},g.set_html=function(t,n){9==t.nodeType&&(t=t.body),t.innerHTML=e.str.$factory(n)},g.set_style=function(n,r){if(!e.isinstance(r,e.dict))throw e.TypeError.$factory("style must be dict, not "+t.class_name(r));for(var i=e.list.$factory(e.dict.items(r)),s=0;s<i.length;s++){var o=i[s][0],a=i[s][1];if("float"==o.toLowerCase())n.style.cssFloat=a,n.style.styleFloat=a;else{switch(o){case"top":case"left":case"width":case"borderWidth":e.isinstance(a,e.int)&&(a+="px")}n.style[o]=a}}},g.set_text=function(t,n){9==t.nodeType&&(t=t.body),t.innerText=e.str.$factory(n),t.textContent=e.str.$factory(n)},g.set_value=function(t,n){t.value=e.str.$factory(n)},g.submit=function(t){return function(){t.submit()}},g.text=function(t){9==t.nodeType&&(t=t.body);var n=t.innerText||t.textContent;return null===n&&(n=e.None),n},g.toString=function(t){return void 0===t?"DOMNode":t.nodeName},g.trigger=function(t,e){if(t.fireEvent)t.fireEvent("on"+e);else{var n=document.createEvent("Events");n.initEvent(e,!0,!1),t.dispatchEvent(n)}},g.unbind=function(n,r){if(n.$events=n.$events||{},n.$events==={})return e.None;if(void 0===r){for(var r in n.$events)g.unbind(n,r);return e.None}if(void 0===n.$events[r]||0==n.$events[r].length)return e.None;var i=n.$events[r];if(2==arguments.length){for(var s=0;s<i.length;s++){var o=i[s][1];n.removeEventListener(r,o,!1)}return n.$events[r]=[],e.None}for(s=2;s<arguments.length;s++){var a=!1;if(void 0===(u=(o=arguments[s]).$func)){for(var l=!1,c=0;c<i.length;c++)if(i[c][0]===o){var u=o;l=!0;break}if(!l)throw e.TypeError.$factory("function is not an event callback")}for(c=0;c<i.length;c++)if(t.$getattr(u,"__eq__")(i[c][0])){o=i[c][1],n.removeEventListener(r,o,!1),i.splice(c,1),a=!0;break}if(!a)throw e.KeyError.$factory("missing callback for event "+r)}},t.set_func_names(g,"browser");var v={__class__:e.type,__mro__:[e.object],$infos:{__name__:"query"},__contains__:function(t,e){return t._keys.indexOf(e)>-1},__getitem__:function(t,n){var r=t._values[n];if(void 0===r)throw e.KeyError.$factory(n);return 1==r.length?r[0]:r}},b=t.make_iterator_class("query string iterator");v.__iter__=function(t){return b.$factory(t._keys)},v.__setitem__=function(t,n,r){return t._values[n]=[r],e.None},v.__str__=v.__repr__=function(t){var e=[];for(var n in t._values)for(const r of t._values[n])e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return 0==e.length?"":"?"+e.join("&")},v.getfirst=function(t,n,r){var i=t._values[n];return void 0===i?void 0===r?e.None:r:i[0]},v.getlist=function(t,e){var n=t._values[e];return void 0===n?[]:n},v.getvalue=function(t,n,r){try{return v.__getitem__(t,n)}catch(t){return void 0===r?e.None:r}},v.keys=function(t){return t._keys},t.set_func_names(v,"<dom>");var x={__class__:e.type,__mro__:[n],$infos:{__module__:"<pydom>",__name__:"TagSum"},appendChild:function(t,e){t.children.push(e)},__add__:function(n,r){return t.get_class(r)===x?n.children=n.children.concat(r.children):e.isinstance(r,[e.str,e.int,e.float,e.dict,e.set,e.list])?n.children=n.children.concat(g.$factory(document.createTextNode(r))):n.children.push(r),n},__radd__:function(t,e){var n=x.$factory();return n.children=t.children.concat(g.$factory(document.createTextNode(e))),n},__repr__:function(t){for(var e="<object TagSum> ",n=0;n<t.children.length;n++)e+=t.children[n],"[object Text]"==t.children[n].toString()&&(e+=" ["+t.children[n].textContent+"]\n");return e}};x.__str__=x.toString=x.__repr__,x.clone=function(t){for(var e=x.$factory(),n=0;n<t.children.length;n++)e.children.push(t.children[n].cloneNode(!0));return e},x.$factory=function(){return{__class__:x,children:[],toString:function(){return"(TagSum)"}}},t.set_func_names(x,"<dom>"),t.TagSum=x;var w=t.JSObj.$factory(r);w.get_postMessage=function(t,n){if(e.isinstance(t,dict)){var i={__class__:"dict"};e.list.$factory(e.dict.items(t)).forEach((function(t){i[t[0]]=t[1]})),t=i}return r.postMessage(t,n)},t.DOMNode=g,t.win=w}(__BRYTHON__),function($B){var _b_=$B.builtins,bltns=$B.InjectBuiltins();eval(bltns);var $GeneratorReturn={};$B.generator_return=function(t){return{__class__:$GeneratorReturn,value:t}},$B.generator=$B.make_class("generator",(function(t){var e=function(){var e=t.apply(null,arguments);if(e.$name=t.name,e.$func=t,e.$has_run=!1,e.__class__=$B.generator,t.$has_yield_in_cm){var n=$B.last($B.frames_stack)[1];n.$close_generators=n.$close_generators||[],n.$close_generators.push(e)}return e};return e.$infos=t.$infos,e.$is_genfunc=!0,e})),$B.generator.__iter__=function(t){return t},$B.generator.__next__=function(t){return $B.generator.send(t,_b_.None)},$B.generator.close=function(t){try{$B.generator.$$throw(t,_b_.GeneratorExit.$factory())}catch(t){if(!$B.is_exc(t,[_b_.GeneratorExit,_b_.StopIteration]))throw _b_.RuntimeError.$factory("generator ignored GeneratorExit")}},$B.generator.send=function(t,e){if(t.$has_run=!0,t.$finished)throw _b_.StopIteration.$factory(e);if(!0===t.gi_running)throw _b_.ValueError.$factory("generator already executing");t.gi_running=!0;try{var n=t.next(e)}catch(e){throw t.$finished=!0,e}if(n.value&&n.value.__class__===$GeneratorReturn)throw t.$finished=!0,_b_.StopIteration.$factory(n.value.value);if(t.gi_running=!1,n.done)throw _b_.StopIteration.$factory(n.value);return n.value},$B.generator.$$throw=function(t,e,n,r){var i=e;if(i.$is_class){if(!_b_.issubclass(e,_b_.BaseException))throw _b_.TypeError.$factory("exception value must be an instance of BaseException");void 0===n?i=$B.$call(i)():_b_.isinstance(n,e)&&(i=n)}else void 0===n?n=i:i=$B.$call(i)(n);void 0!==r&&(i.$traceback=r);var s=t.throw(i);if(s.done)throw _b_.StopIteration.$factory("StopIteration");return s.value},$B.set_func_names($B.generator,"builtins"),$B.async_generator=$B.make_class("async_generator",(function(t){return function(){var e=t.apply(null,arguments);return e.__class__=$B.async_generator,e}}));var ag_closed={};function rstrip(t,e){for(var n=e||" \t\n",r=0,i=t.length;r<i&&n.indexOf(t.charAt(i-1-r))>-1;)r++;return t.substr(0,i-r)}$B.async_generator.__aiter__=function(t){return t},$B.async_generator.__anext__=function(t){return $B.async_generator.asend(t,_b_.None)},$B.async_generator.aclose=function(t){return t.$finished=!0,_b_.None},$B.async_generator.asend=async function(t,e){if(t.$finished)throw _b_.StopAsyncIteration.$factory(e);if(!0===t.ag_running)throw _b_.ValueError.$factory("generator already executing");t.ag_running=!0;try{var n=await t.next(e)}catch(e){throw t.$finished=!0,e}if(n.done)throw _b_.StopAsyncIteration.$factory(e);if(n.value.__class__===$GeneratorReturn)throw t.$finished=!0,_b_.StopAsyncIteration.$factory(n.value.value);return t.ag_running=!1,n.value},$B.async_generator.athrow=async function(t,e,n,r){var i=e;if(i.$is_class){if(!_b_.issubclass(e,_b_.BaseException))throw _b_.TypeError.$factory("exception value must be an instance of BaseException");void 0===n&&(n=$B.$call(i)())}else void 0===n?n=i:i=$B.$call(i)(n);void 0!==r&&(i.$traceback=r),await t.throw(n)},$B.set_func_names($B.async_generator,"builtins")}(__BRYTHON__),function($B){var _b_=$B.builtins,update=function(t,e){for(attr in e)t[attr]=e[attr]},_window=self,modules={},browser={$package:!0,$is_package:!0,__initialized__:!0,__package__:"browser",__file__:$B.brython_path.replace(/\/*$/g,"")+"/Lib/browser/__init__.py",bind:function(){var t=$B.args("bind",3,{elt:null,evt:null,options:null},["elt","evt","options"],arguments,{options:_b_.None},null,null),e=t.options;return"boolean"==typeof e||e.__class__===_b_.dict&&(e=e.$string_dict),function(n){if($B.get_class(t.elt)===$B.JSObj)return t.elt.addEventListener(t.evt,(function(t){try{return n($B.JSObj.$factory(t))}catch(t){$B.handle_error(t)}}),e),n;if(_b_.isinstance(t.elt,$B.DOMNode))return $B.DOMNode.bind(t.elt,t.evt,n,e),n;if(_b_.isinstance(t.elt,_b_.str)){for(var r=document.querySelectorAll(t.elt),i=0;i<r.length;i++)$B.DOMNode.bind($B.DOMNode.$factory(r[i]),t.evt,n,e);return n}try{for(var s=$B.$iter(t.elt);;)try{var o=_b_.next(s);$B.DOMNode.bind(o,t.evt,n)}catch(t){if(_b_.isinstance(t,_b_.StopIteration))break;throw t}}catch(e){throw _b_.isinstance(e,_b_.AttributeError)&&$B.DOMNode.bind(t.elt,t.evt,n),e}return n}},console:self.console&&$B.JSObj.$factory(self.console),self:$B.win,win:$B.win,$$window:$B.win};browser.__path__=browser.__file__,$B.isNode?(delete browser.$$window,delete browser.win):$B.isWebWorker?(browser.is_webworker=!0,delete browser.$$window,delete browser.win,browser.self.send=self.postMessage):(browser.is_webworker=!1,update(browser,{$$alert:function(t){window.alert($B.builtins.str.$factory(t||""))},confirm:$B.JSObj.$factory(window.confirm),$$document:$B.DOMNode.$factory(document),doc:$B.DOMNode.$factory(document),DOMEvent:$B.DOMEvent,DOMNode:$B.DOMNode,load:function(script_url){var file_obj=$B.builtins.open(script_url),content=$B.$getattr(file_obj,"read")();eval(content)},mouseCoords:function(t){return $B.JSObj.$factory($mouseCoords(t))},prompt:function(t,e){return $B.JSObj.$factory(window.prompt(t,e||""))},reload:function(){var t=document.getElementsByTagName("script"),e=[];for(var n in t.forEach((function(t){void 0!==t.type&&"text/javascript"!=t.type||(e.push(t),t.src&&console.log(t.src))})),console.log(e),$B.imported)$B.imported[n].$last_modified?console.log("check",n,$B.imported[n].__file__,$B.imported[n].$last_modified):console.log("no date for mod",n)},run_script:function(){var t=$B.args("run_script",2,{src:null,name:null},["src","name"],arguments,{name:"script_"+$B.UUID()},null,null);$B.run_script(t.src,t.name,!0)},URLParameter:function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return e=null===e?"":decodeURIComponent(e[1].replace(/\+/g," ")),$B.builtins.str.$factory(e)}}),modules["browser.html"]=function($B){var _b_=$B.builtins,TagSum=$B.TagSum;function makeTagDict(tagName){var dict={__class__:_b_.type,$infos:{__name__:tagName,__module__:"browser.html"},__init__:function(){var $ns=$B.args("pow",1,{self:null},["self"],arguments,{},"args","kw"),self=$ns.self,args=$ns.args;if(1==args.length){var first=args[0];if(_b_.isinstance(first,[_b_.str,_b_.int,_b_.float]))self.innerHTML=_b_.str.$factory(first);else if(first.__class__===TagSum)for(var i=0,len=first.children.length;i<len;i++)self.appendChild(first.children[i]);else if(_b_.isinstance(first,$B.DOMNode))self.appendChild(first);else try{var items=_b_.list.$factory(first);items.forEach((function(t){$B.DOMNode.__le__(self,t)}))}catch(t){$B.debug>1&&(console.log(t,t.__class__,t.args),console.log("first",first),console.log(arguments)),$B.handle_error(t)}}for(var items=_b_.list.$factory(_b_.dict.items($ns.kw)),i=0,len=items.length;i<len;i++){var arg=items[i][0],value=items[i][1];if("on"==arg.toLowerCase().substr(0,2)){var js='$B.DOMNode.bind(self,"'+arg.toLowerCase().substr(2);eval(js+'",function(){'+value+"})")}else if("style"==arg.toLowerCase())$B.DOMNode.set_style(self,value);else if(!1!==value)try{arg=$B.imported["browser.html"].attribute_mapper(arg),self.setAttribute(arg,value)}catch(t){throw _b_.ValueError.$factory("can't set attribute "+arg)}}}};return dict.__mro__=[$B.DOMNode,$B.builtins.object],dict.__new__=function(t){if(void 0!==t.$elt_wrap){var e=t.$elt_wrap;t.$elt_wrap=void 0,(n=$B.DOMNode.$factory(e,!0))._wrapped=!0}else{var n;(n=$B.DOMNode.$factory(document.createElement(tagName),!0))._wrapped=!1}return n.__class__=t,n.__dict__=$B.empty_dict(),n},$B.set_func_names(dict,"browser.html"),dict}function makeFactory(t){return function(){if(void 0!==t.$elt_wrap){var e=t.$elt_wrap;t.$elt_wrap=void 0,(n=$B.DOMNode.$factory(e,!0))._wrapped=!0}else{if("SVG"==t.$infos.__name__)var n=$B.DOMNode.$factory(document.createElementNS("http://www.w3.org/2000/svg","svg"),!0);else e=document.createElement(t.$infos.__name__),n=$B.DOMNode.$factory(e,!0);n._wrapped=!1}return n.__class__=t,t.__init__(n,...arguments),n}}var tags=["A","ABBR","ACRONYM","ADDRESS","APPLET","AREA","B","BASE","BASEFONT","BDO","BIG","BLOCKQUOTE","BODY","BR","BUTTON","CAPTION","CENTER","CITE","CODE","COL","COLGROUP","DD","DEL","DFN","DIR","DIV","DL","DT","EM","FIELDSET","FONT","FORM","FRAME","FRAMESET","H1","H2","H3","H4","H5","H6","HEAD","HR","HTML","I","IFRAME","IMG","INPUT","INS","ISINDEX","KBD","LABEL","LEGEND","LI","LINK","MAP","MENU","META","NOFRAMES","NOSCRIPT","OBJECT","OL","OPTGROUP","OPTION","P","PARAM","PRE","Q","S","SAMP","SCRIPT","SELECT","SMALL","SPAN","STRIKE","STRONG","STYLE","SUB","SUP","SVG","TABLE","TBODY","TD","TEXTAREA","TFOOT","TH","THEAD","TITLE","TR","TT","U","UL","VAR","ARTICLE","ASIDE","AUDIO","BDI","CANVAS","COMMAND","DATA","DATALIST","EMBED","FIGCAPTION","FIGURE","FOOTER","HEADER","KEYGEN","MAIN","MARK","MATH","METER","NAV","OUTPUT","PROGRESS","RB","RP","RT","RTC","RUBY","SECTION","SOURCE","TEMPLATE","TIME","TRACK","VIDEO","WBR","DETAILS","DIALOG","MENUITEM","PICTURE","SUMMARY"],obj={tags:$B.empty_dict()},dicts={};function maketag(t){if("string"!=typeof t)throw _b_.TypeError.$factory("html.maketag expects a string as argument");var e=dicts[t]=makeTagDict(t);return e.$factory=makeFactory(e),_b_.dict.$setitem(obj.tags,t,e),e}return $B.DOMNode.tags=obj.tags,tags.forEach((function(t){obj[t]=maketag(t)})),obj.maketag=maketag,obj.attribute_mapper=function(t){return t.replace(/_/g,"-")},obj}(__BRYTHON__)),modules.browser=browser,$B.UndefinedClass=$B.make_class("Undefined",(function(){return $B.Undefined})),$B.UndefinedClass.__mro__=[_b_.object],$B.UndefinedClass.__bool__=function(t){return!1},$B.UndefinedClass.__repr__=$B.UndefinedClass.__str__=function(t){return"<Javascript undefined>"},$B.Undefined={__class__:$B.UndefinedClass},$B.set_func_names($B.UndefinedClass,"javascript"),modules.javascript={$$this:function(){return void 0===$B.js_this?$B.builtins.None:$B.JSObj.$factory($B.js_this)},$$Date:self.Date&&$B.JSObj.$factory(self.Date),$$extends:function(t){return function(e){if("function"==typeof e){var n=function(){t.call(this,...arguments),e.apply(this,arguments)};return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.$is_js_func=!0,n}if(e.$is_class){for(var r in console.log("obj",e),"Named"==t.$js_func.name&&console.log("-- Named"),n=function(){if(console.log("call parent class",e.$parent_class),e.$parent_class.call(this,...arguments),e.$$constructor){for(var t=[this],n=0,r=arguments.length;n<r;n++)t.push(arguments[n]);e.$$constructor.apply(this,t)}},n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.$is_js_func=!0,n.$class=e,e.$parent_class=t,e.__dict__.$string_dict){var i=e.__dict__.$string_dict[r][0];n.prototype[r]="function"==typeof i?function(t){return function(){for(var e=[this],n=0,r=arguments.length;n<r;n++)e.push($B.pyobj2jsobj(arguments[n]));return t.apply(this,e)}}(i):$B.pyobj2jsobj(i)}return n}}},JSON:{__class__:$B.make_class("JSON"),parse:function(){return $B.structuredclone2pyobj(JSON.parse.apply(this,arguments))},stringify:function(t,e,n){return JSON.stringify($B.pyobj2structuredclone(t,!1),$B.JSObj.$factory(e),n)}},jsobj2pyobj:function(t){return $B.jsobj2pyobj(t)},load:function(script_url){console.log('"javascript.load" is deprecrated. Use browser.load instead.');var file_obj=$B.builtins.open(script_url),content=$B.$getattr(file_obj,"read")();eval(content)},$$Math:self.Math&&$B.JSObj.$factory(self.Math),NULL:null,$$Number:self.Number&&$B.JSObj.$factory(self.Number),py2js:function(t,e){return void 0===e&&(e="__main__"+$B.UUID()),$B.py2js(t,e,e,$B.builtins_scope).to_js()},pyobj2jsobj:function(t){return $B.pyobj2jsobj(t)},$$RegExp:self.RegExp&&$B.JSObj.$factory(self.RegExp),$$String:self.String&&$B.JSObj.$factory(self.String),UNDEFINED:$B.Undefined,UndefinedType:$B.UndefinedClass};var arraybuffers=["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];arraybuffers.forEach((function(t){void 0!==self[t]&&(modules.javascript[t]=$B.JSObj.$factory(self[t]))}));var _b_=$B.builtins;function load(t,e){for(var n in e.__class__=$B.module,e.__name__=t,$B.imported[t]=e,e)if("function"==typeof e[n]){var r=$B.from_alias(n);e[n].$infos={__module__:t,__name__:r,__qualname__:t+"."+r}}}for(var attr in modules._sys={Getframe:function(){var t=$B.args("_getframe",1,{depth:null},["depth"],arguments,{depth:0},null,null).depth;return $B._frame.$factory($B.frames_stack,$B.frames_stack.length-t-1)},breakpointhook:function(){var t,e,n,r,i=$B.$options.breakpoint;void 0===i&&(i="pdb.set_trace"),[t,e,n]=_b_.str.rpartition(i,"."),""==e&&(t="builtins");try{$B.$import(t),r=$B.$getattr($B.imported[t],n)}catch(t){return console.warn("cannot import breakpoint",i),_b_.None}return $B.$call(r).apply(null,arguments)},exc_info:function(){for(var t=$B.frames_stack.length-1;t>=0;t--){var e=$B.frames_stack[t][1].$current_exception;if(e)return _b_.tuple.$factory([e.__class__,e,$B.$getattr(e,"__traceback__")])}return _b_.tuple.$factory([_b_.None,_b_.None,_b_.None])},excepthook:function(t,e,n){$B.handle_error(e)},gettrace:function(){return $B.tracefunc||_b_.None},modules:_b_.property.$factory((function(){return $B.obj_dict($B.imported)}),(function(t,e,n){throw _b_.TypeError.$factory("Read only property 'sys.modules'")})),path:_b_.property.$factory((function(){return $B.path}),(function(t,e,n){$B.path=n})),meta_path:_b_.property.$factory((function(){return $B.meta_path}),(function(t,e,n){$B.meta_path=n})),path_hooks:_b_.property.$factory((function(){return $B.path_hooks}),(function(t,e,n){$B.path_hooks=n})),path_importer_cache:_b_.property.$factory((function(){return _b_.dict.$factory($B.JSObj.$factory($B.path_importer_cache))}),(function(t,e,n){throw _b_.TypeError.$factory("Read only property 'sys.path_importer_cache'")})),settrace:function(){var t=$B.args("settrace",1,{tracefunc:null},["tracefunc"],arguments,{},null,null);return $B.tracefunc=t.tracefunc,$B.last($B.frames_stack)[1].$f_trace=$B.tracefunc,$B.tracefunc.$current_frame_id=$B.last($B.frames_stack)[0],_b_.None},stderr:_b_.property.$factory((function(){return $B.stderr}),(function(t,e){$B.stderr=e})),stdout:_b_.property.$factory((function(){return $B.stdout}),(function(t,e){$B.stdout=e})),stdin:_b_.property.$factory((function(){return $B.stdin}),(function(t,e){$B.stdin=e})),vfs:_b_.property.$factory((function(){return $B.hasOwnProperty("VFS")?$B.obj_dict($B.VFS):_b_.None}),(function(){throw _b_.TypeError.$factory("Read only property 'sys.vfs'")}))},modules._sys.__breakpointhook__=modules._sys.breakpointhook,modules._sys.stderr.write=function(t){return $B.$getattr(_sys.stderr.__get__(),"write")(t)},modules._sys.stdout.write=function(t){return $B.$getattr(_sys.stdout.__get__(),"write")(t)},modules)load(attr,modules[attr]);$B.isWebWorker||$B.isNode||(modules.browser.html=modules["browser.html"]);var _b_=$B.builtins;for(var attr in _b_.__builtins__=$B.module.$factory("__builtins__","Python builtins"),_b_)_b_.__builtins__[attr]=_b_[attr],$B.builtins_scope.binding[attr]=!0;for(var name in _b_.__builtins__.__setattr__=function(t,e){_b_[t]=e},$B.method_descriptor.__getattribute__=$B.Function.__getattribute__,$B.wrapper_descriptor.__getattribute__=$B.Function.__getattribute__,_b_)if(_b_[name].__class__===_b_.type)for(var key in $B.builtin_classes.push(_b_[name]),_b_[name]){var value=_b_[name][key];void 0!==value&&(value.__class__||"function"==typeof value&&("__new__"==key?value.__class__=$B.builtin_function:key.startsWith("__")?value.__class__=$B.wrapper_descriptor:value.__class__=$B.method_descriptor,value.__objclass__=_b_[name]))}for(var attr in $B)Array.isArray($B[attr])&&($B[attr].__class__=_b_.list);$B.cell=$B.make_class("cell",(function(t){return{__class__:$B.cell,$cell_contents:t}})),$B.cell.cell_contents=$B.$call(_b_.property)((function(t){if(null===t.$cell_contents)throw _b_.ValueError.$factory("empty cell");return t.$cell_contents}),(function(t,e){t.$cell_contents=e}));var $comps=Object.values($B.$comps).concat(["eq","ne"]);$comps.forEach((function(t){var e="__"+t+"__";$B.cell[e]=function(t){return function(e,n){return _b_.isinstance(n,$B.cell)?null===e.$cell_contents?null===n.$cell_contents?"__eq__"==t:["__ne__","__lt__","__le__"].indexOf(t)>-1:null===n.$cell_contents?["__ne__","__gt__","__ge__"].indexOf(t)>-1:$B.rich_comp(t,e.$cell_contents,n.$cell_contents):NotImplemented}}(e)})),$B.set_func_names($B.cell,"builtins")}(__BRYTHON__);var docs={ArithmeticError:"Base class for arithmetic errors.",AssertionError:"Assertion failed.",AttributeError:"Attribute not found.",BaseException:"Common base class for all exceptions",BlockingIOError:"I/O operation would block.",BrokenPipeError:"Broken pipe.",BufferError:"Buffer error.",BytesWarning:"Base class for warnings about bytes and buffer related problems, mostly\nrelated to conversion from str or comparing to str.",ChildProcessError:"Child process error.",ConnectionAbortedError:"Connection aborted.",ConnectionError:"Connection error.",ConnectionRefusedError:"Connection refused.",ConnectionResetError:"Connection reset.",DeprecationWarning:"Base class for warnings about deprecated features.",EOFError:"Read beyond end of file.",Ellipsis:"",EnvironmentError:"Base class for I/O related errors.",Exception:"Common base class for all non-exit exceptions.",False:"bool(x) -> bool\n\nReturns True when the argument x is true, False otherwise.\nThe builtins True and False are the only two instances of the class bool.\nThe class bool is a subclass of the class int, and cannot be subclassed.",FileExistsError:"File already exists.",FileNotFoundError:"File not found.",FloatingPointError:"Floating point operation failed.",FutureWarning:"Base class for warnings about constructs that will change semantically\nin the future.",GeneratorExit:"Request that a generator exit.",IOError:"Base class for I/O related errors.",ImportError:"Import can't find module, or can't find name in module.",ImportWarning:"Base class for warnings about probable mistakes in module imports",IndentationError:"Improper indentation.",IndexError:"Sequence index out of range.",InterruptedError:"Interrupted by signal.",IsADirectoryError:"Operation doesn't work on directories.",KeyError:"Mapping key not found.",KeyboardInterrupt:"Program interrupted by user.",LookupError:"Base class for lookup errors.",MemoryError:"Out of memory.",NameError:"Name not found globally.",None:"",NotADirectoryError:"Operation only works on directories.",NotImplemented:"",NotImplementedError:"Method or function hasn't been implemented yet.",OSError:"Base class for I/O related errors.",OverflowError:"Result too large to be represented.",PendingDeprecationWarning:"Base class for warnings about features which will be deprecated\nin the future.",PermissionError:"Not enough permissions.",ProcessLookupError:"Process not found.",ReferenceError:"Weak ref proxy used after referent went away.",ResourceWarning:"Base class for warnings about resource usage.",RuntimeError:"Unspecified run-time error.",RuntimeWarning:"Base class for warnings about dubious runtime behavior.",StopIteration:"Signal the end from iterator.__next__().",SyntaxError:"Invalid syntax.",SyntaxWarning:"Base class for warnings about dubious syntax.",SystemError:"Internal error in the Python interpreter.\n\nPlease report this to the Python maintainer, along with the traceback,\nthe Python version, and the hardware/OS platform and version.",SystemExit:"Request to exit from the interpreter.",TabError:"Improper mixture of spaces and tabs.",TimeoutError:"Timeout expired.",True:"bool(x) -> bool\n\nReturns True when the argument x is true, False otherwise.\nThe builtins True and False are the only two instances of the class bool.\nThe class bool is a subclass of the class int, and cannot be subclassed.",TypeError:"Inappropriate argument type.",UnboundLocalError:"Local name referenced but not bound to a value.",UnicodeDecodeError:"Unicode decoding error.",UnicodeEncodeError:"Unicode encoding error.",UnicodeError:"Unicode related error.",UnicodeTranslateError:"Unicode translation error.",UnicodeWarning:"Base class for warnings about Unicode related problems, mostly\nrelated to conversion problems.",UserWarning:"Base class for warnings generated by user code.",ValueError:"Inappropriate argument value (of correct type).",Warning:"Base class for warning categories.",WindowsError:"Base class for I/O related errors.",ZeroDivisionError:"Second argument to a division or modulo operation was zero.",__debug__:"bool(x) -> bool\n\nReturns True when the argument x is true, False otherwise.\nThe builtins True and False are the only two instances of the class bool.\nThe class bool is a subclass of the class int, and cannot be subclassed.",abs:"abs(number) -> number\n\nReturn the absolute value of the argument.",all:"all(iterable) -> bool\n\nReturn True if bool(x) is True for all values x in the iterable.\nIf the iterable is empty, return True.",any:"any(iterable) -> bool\n\nReturn True if bool(x) is True for any x in the iterable.\nIf the iterable is empty, return False.",ascii:"ascii(object) -> string\n\nAs repr(), return a string containing a printable representation of an\nobject, but escape the non-ASCII characters in the string returned by\nrepr() using \\x, \\u or \\U escapes.  This generates a string similar\nto that returned by repr() in Python 2.",bin:"bin(number) -> string\n\nReturn the binary representation of an integer.\n\n   >>> bin(2796202)\n   '0b1010101010101010101010'\n",bool:"bool(x) -> bool\n\nReturns True when the argument x is true, False otherwise.\nThe builtins True and False are the only two instances of the class bool.\nThe class bool is a subclass of the class int, and cannot be subclassed.",bytearray:"bytearray(iterable_of_ints) -> bytearray\nbytearray(string, encoding[, errors]) -> bytearray\nbytearray(bytes_or_buffer) -> mutable copy of bytes_or_buffer\nbytearray(int) -> bytes array of size given by the parameter initialized with null bytes\nbytearray() -> empty bytes array\n\nConstruct an mutable bytearray object from:\n  - an iterable yielding integers in range(256)\n  - a text string encoded using the specified encoding\n  - a bytes or a buffer object\n  - any object implementing the buffer API.\n  - an integer",bytes:"bytes(iterable_of_ints) -> bytes\nbytes(string, encoding[, errors]) -> bytes\nbytes(bytes_or_buffer) -> immutable copy of bytes_or_buffer\nbytes(int) -> bytes object of size given by the parameter initialized with null bytes\nbytes() -> empty bytes object\n\nConstruct an immutable array of bytes from:\n  - an iterable yielding integers in range(256)\n  - a text string encoded using the specified encoding\n  - any object implementing the buffer API.\n  - an integer",callable:"callable(object) -> bool\n\nReturn whether the object is callable (i.e., some kind of function).\nNote that classes are callable, as are instances of classes with a\n__call__() method.",chr:"chr(i) -> Unicode character\n\nReturn a Unicode string of one character with ordinal i; 0 <= i <= 0x10ffff.",classmethod:"classmethod(function) -> method\n\nConvert a function to be a class method.\n\nA class method receives the class as implicit first argument,\njust like an instance method receives the instance.\nTo declare a class method, use this idiom:\n\n  class C:\n      def f(cls, arg1, arg2, ...): ...\n      f = classmethod(f)\n\nIt can be called either on the class (e.g. C.f()) or on an instance\n(e.g. C().f()).  The instance is ignored except for its class.\nIf a class method is called for a derived class, the derived class\nobject is passed as the implied first argument.\n\nClass methods are different than C++ or Java static methods.\nIf you want those, see the staticmethod builtin.",compile:"compile(source, filename, mode[, flags[, dont_inherit]]) -> code object\n\nCompile the source (a Python module, statement or expression)\ninto a code object that can be executed by exec() or eval().\nThe filename will be used for run-time error messages.\nThe mode must be 'exec' to compile a module, 'single' to compile a\nsingle (interactive) statement, or 'eval' to compile an expression.\nThe flags argument, if present, controls which future statements influence\nthe compilation of the code.\nThe dont_inherit argument, if non-zero, stops the compilation inheriting\nthe effects of any future statements in effect in the code calling\ncompile; if absent or zero these statements do influence the compilation,\nin addition to any features explicitly specified.",complex:"complex(real[, imag]) -> complex number\n\nCreate a complex number from a real part and an optional imaginary part.\nThis is equivalent to (real + imag*1j) where imag defaults to 0.",copyright:"interactive prompt objects for printing the license text, a list of\n    contributors and the copyright notice.",credits:"interactive prompt objects for printing the license text, a list of\n    contributors and the copyright notice.",delattr:"delattr(object, name)\n\nDelete a named attribute on an object; delattr(x, 'y') is equivalent to\n``del x.y''.",dict:"dict() -> new empty dictionary\ndict(mapping) -> new dictionary initialized from a mapping object's\n    (key, value) pairs\ndict(iterable) -> new dictionary initialized as if via:\n    d = {}\n    for k, v in iterable:\n        d[k] = v\ndict(**kwargs) -> new dictionary initialized with the name=value pairs\n    in the keyword argument list.  For example:  dict(one=1, two=2)",dir:"dir([object]) -> list of strings\n\nIf called without an argument, return the names in the current scope.\nElse, return an alphabetized list of names comprising (some of) the attributes\nof the given object, and of attributes reachable from it.\nIf the object supplies a method named __dir__, it will be used; otherwise\nthe default dir() logic is used and returns:\n  for a module object: the module's attributes.\n  for a class object:  its attributes, and recursively the attributes\n    of its bases.\n  for any other object: its attributes, its class's attributes, and\n    recursively the attributes of its class's base classes.",divmod:"divmod(x, y) -> (div, mod)\n\nReturn the tuple ((x-x%y)/y, x%y).  Invariant: div*y + mod == x.",enumerate:"enumerate(iterable[, start]) -> iterator for index, value of iterable\n\nReturn an enumerate object.  iterable must be another object that supports\niteration.  The enumerate object yields pairs containing a count (from\nstart, which defaults to zero) and a value yielded by the iterable argument.\nenumerate is useful for obtaining an indexed list:\n    (0, seq[0]), (1, seq[1]), (2, seq[2]), ...",eval:"eval(source[, globals[, locals]]) -> value\n\nEvaluate the source in the C of globals and locals.\nThe source may be a string representing a Python expression\nor a code object as returned by compile().\nThe globals must be a dictionary and locals can be any mapping,\ndefaulting to the current globals and locals.\nIf only globals is given, locals defaults to it.\n",exec:"exec(object[, globals[, locals]])\n\nRead and execute code from an object, which can be a string or a code\nobject.\nThe globals and locals are dictionaries, defaulting to the current\nglobals and locals.  If only globals is given, locals defaults to it.",exit:"",filter:"filter(function or None, iterable) --\x3e filter object\n\nReturn an iterator yielding those items of iterable for which function(item)\nis true. If function is None, return the items that are true.",float:"float(x) -> floating point number\n\nConvert a string or number to a floating point number, if possible.",format:'format(value[, format_spec]) -> string\n\nReturns value.__format__(format_spec)\nformat_spec defaults to ""',frozenset:"frozenset()-> empty frozenset object\nfrozenset(iterable)-> frozenset object\n\nBuild an immutable unordered collection of unique elements.",getattr:"getattr(object,name[,default])-> value\n\nGet a named attribute from an object;getattr(x,'y')is equivalent to x.y.\nWhen a default argument is given,it is returned when the attribute doesn't\nexist; without it, an exception is raised in that case.",globals:"globals() -> dictionary\n\nReturn the dictionary containing the current scope's global variables.",hasattr:"hasattr(object,name)-> bool\n\nReturn whether the object has an attribute with the given name.\n(This is done by calling getattr(object,name)and catching AttributeError.)",hash:"hash(object)-> integer\n\nReturn a hash value for the object. Two objects with the same value have\nthe same hash value. The reverse is not necessarily true,but likely.",help:"Define the builtin 'help'.\n\n This is a wrapper around pydoc.help that provides a helpful message\n when 'help' is typed at the Python interactive prompt.\n\n Calling help()at the Python prompt starts an interactive help session.\n Calling help(thing)prints help for the python object 'thing'.\n ",hex:"hex(number)-> string\n\nReturn the hexadecimal representation of an integer.\n\n >>> hex(3735928559)\n '0xdeadbeef'\n",id:"id(object)-> integer\n\nReturn the identity of an object. This is guaranteed to be unique among\nsimultaneously existing objects.(Hint:it's the object's memory address.)",input:"input([prompt])-> string\n\nRead a string from standard input. The trailing newline is stripped.\nIf the user hits EOF(Unix:Ctl-D,Windows:Ctl-Z+Return),raise EOFError.\nOn Unix,GNU readline is used if enabled. The prompt string,if given,\nis printed without a trailing newline before reading.",int:"int(x=0)-> integer\nint(x,base=10)-> integer\n\nConvert a number or string to an integer,or return 0 if no arguments\nare given. If x is a number,return x.__int__(). For floating point\nnumbers,this truncates towards zero.\n\nIf x is not a number or if base is given,then x must be a string,\nbytes,or bytearray instance representing an integer literal in the\ngiven base. The literal can be preceded by '+' or '-' and be surrounded\nby whitespace. The base defaults to 10. Valid bases are 0 and 2-36.\nBase 0 means to interpret the base from the string as an integer literal.\n>>> int('0b100',base=0)\n4",isinstance:"isinstance(object,class-or-type-or-tuple)-> bool\n\nReturn whether an object is an instance of a class or of a subclass thereof.\nWith a type as second argument,return whether that is the object's type.\nThe form using a tuple, isinstance(x, (A, B, ...)), is a shortcut for\nisinstance(x, A) or isinstance(x, B) or ... (etc.).",issubclass:"issubclass(C, B) -> bool\n\nReturn whether class C is a subclass (i.e., a derived class) of class B.\nWhen using a tuple as the second argument issubclass(X, (A, B, ...)),\nis a shortcut for issubclass(X, A) or issubclass(X, B) or ... (etc.).",iter:"iter(iterable) -> iterator\niter(callable, sentinel) -> iterator\n\nGet an iterator from an object.  In the first form, the argument must\nsupply its own iterator, or be a sequence.\nIn the second form, the callable is called until it returns the sentinel.",len:"len(object)\n\nReturn the number of items of a sequence or collection.",license:"interactive prompt objects for printing the license text, a list of\n    contributors and the copyright notice.",list:"list() -> new empty list\nlist(iterable) -> new list initialized from iterable's items",locals:"locals()-> dictionary\n\nUpdate and return a dictionary containing the current scope's local variables.",map:"map(func, *iterables) --\x3e map object\n\nMake an iterator that computes the function using arguments from\neach of the iterables.  Stops when the shortest iterable is exhausted.",max:"max(iterable, *[, default=obj, key=func]) -> value\nmax(arg1, arg2, *args, *[, key=func]) -> value\n\nWith a single iterable argument, return its biggest item. The\ndefault keyword-only argument specifies an object to return if\nthe provided iterable is empty.\nWith two or more arguments, return the largest argument.",memoryview:"memoryview(object)\n\nCreate a new memoryview object which references the given object.",min:"min(iterable, *[, default=obj, key=func]) -> value\nmin(arg1, arg2, *args, *[, key=func]) -> value\n\nWith a single iterable argument, return its smallest item. The\ndefault keyword-only argument specifies an object to return if\nthe provided iterable is empty.\nWith two or more arguments, return the smallest argument.",next:"next(iterator[, default])\n\nReturn the next item from the iterator. If default is given and the iterator\nis exhausted, it is returned instead of raising StopIteration.",object:"The most base type",oct:"oct(number) -> string\n\nReturn the octal representation of an integer.\n\n   >>> oct(342391)\n   '0o1234567'\n",open:"open(file, mode='r', buffering=-1, encoding=None,\n     errors=None, newline=None, closefd=True, opener=None) -> file object\n\nOpen file and return a stream.  Raise IOError upon failure.\n\nfile is either a text or byte string giving the name (and the path\nif the file isn't in the current working directory)of the file to\nbe opened or an integer file descriptor of the file to be\nwrapped.(If a file descriptor is given,it is closed when the\nreturned I/O object is closed,unless closefd is set to False.)\n\nmode is an optional string that specifies the mode in which the file\nis opened. It defaults to 'r' which means open for reading in text\nmode. Other common values are 'w' for writing(truncating the file if\nit already exists),'x' for creating and writing to a new file,and\n'a' for appending(which on some Unix systems,means that all writes\nappend to the end of the file regardless of the current seek position).\nIn text mode,if encoding is not specified the encoding used is platform\ndependent:locale.getpreferredencoding(False)is called to get the\ncurrent locale encoding.(For reading and writing raw bytes use binary\nmode and leave encoding unspecified.)The available modes are:\n\n========================================================================\nCharacter Meaning\n------------------------------------------------------------------------\n'r' open for reading(default)\n'w' open for writing,truncating the file first\n'x' create a new file and open it for writing\n'a' open for writing,appending to the end of the file if it exists\n'b' binary mode\n't' text mode(default)\n'+' open a disk file for updating(reading and writing)\n'U' universal newline mode(deprecated)\n========================================================================\n\nThe default mode is 'rt'(open for reading text). For binary random\naccess,the mode 'w+b' opens and truncates the file to 0 bytes,while\n'r+b' opens the file without truncation. The 'x' mode implies 'w' and\nraises an `FileExistsError` if the file already exists.\n\nPython distinguishes between files opened in binary and text modes,\neven when the underlying operating system doesn't. Files opened in\nbinary mode (appending 'b' to the mode argument) return contents as\nbytes objects without any decoding. In text mode (the default, or when\n't' is appended to the mode argument), the contents of the file are\nreturned as strings, the bytes having been first decoded using a\nplatform-dependent encoding or using the specified encoding if given.\n\n'U' mode is deprecated and will raise an exception in future versions\nof Python.  It has no effect in Python 3.  Use newline to control\nuniversal newlines mode.\n\nbuffering is an optional integer used to set the buffering policy.\nPass 0 to switch buffering off (only allowed in binary mode), 1 to select\nline buffering (only usable in text mode), and an integer > 1 to indicate\nthe size of a fixed-size chunk buffer.  When no buffering argument is\ngiven, the default buffering policy works as follows:\n\n* Binary files are buffered in fixed-size chunks; the size of the buffer\n  is chosen using a heuristic trying to determine the underlying device's\n \"block size\" and falling back on `io.DEFAULT_BUFFER_SIZE`.\n  On many systems, the buffer will typically be 4096 or 8192 bytes long.\n\n* \"Interactive\" text files (files for which isatty() returns True)\n  use line buffering.  Other text files use the policy described above\n  for binary files.\n\nencoding is the name of the encoding used to decode or encode the\nfile. This should only be used in text mode. The default encoding is\nplatform dependent, but any encoding supported by Python can be\npassed.  See the codecs module for the list of supported encodings.\n\nerrors is an optional string that specifies how encoding errors are to\nbe handled---this argument should not be used in binary mode. Pass\n'strict' to raise a ValueError exception if there is an encoding error\n(the default of None has the same effect), or pass 'ignore' to ignore\nerrors. (Note that ignoring encoding errors can lead to data loss.)\nSee the documentation for codecs.register or run 'help(codecs.Codec)'\nfor a list of the permitted encoding error strings.\n\nnewline controls how universal newlines works (it only applies to text\nmode). It can be None, '', '\\n', '\\r', and '\\r\\n'.  It works as\nfollows:\n\n* On input, if newline is None, universal newlines mode is\n  enabled. Lines in the input can end in '\\n', '\\r', or '\\r\\n', and\n  these are translated into '\\n' before being returned to the\n  caller. If it is '', universal newline mode is enabled, but line\n  endings are returned to the caller untranslated. If it has any of\n  the other legal values, input lines are only terminated by the given\n  string, and the line ending is returned to the caller untranslated.\n\n* On output, if newline is None, any '\\n' characters written are\n  translated to the system default line separator, os.linesep. If\n  newline is '' or '\\n', no translation takes place. If newline is any\n  of the other legal values, any '\\n' characters written are translated\n  to the given string.\n\nIf closefd is False, the underlying file descriptor will be kept open\nwhen the file is closed. This does not work when a file name is given\nand must be True in that case.\n\nA custom opener can be used by passing a callable as *opener*. The\nunderlying file descriptor for the file object is then obtained by\ncalling *opener* with (*file*, *flags*). *opener* must return an open\nfile descriptor (passing os.open as *opener* results in functionality\nsimilar to passing None).\n\nopen() returns a file object whose type depends on the mode, and\nthrough which the standard file operations such as reading and writing\nare performed. When open() is used to open a file in a text mode ('w',\n'r', 'wt', 'rt', etc.), it returns a TextIOWrapper. When used to open\na file in a binary mode, the returned class varies: in read binary\nmode, it returns a BufferedReader; in write binary and append binary\nmodes, it returns a BufferedWriter, and in read/write mode, it returns\na BufferedRandom.\n\nIt is also possible to use a string or bytearray as a file for both\nreading and writing. For strings StringIO can be used like a file\nopened in a text mode, and for bytes a BytesIO can be used like a file\nopened in a binary mode.\n",ord:"ord(c) -> integer\n\nReturn the integer ordinal of a one-character string.",pow:"pow(x, y[, z]) -> number\n\nWith two arguments, equivalent to x**y.  With three arguments,\nequivalent to (x**y) % z, but may be more efficient (e.g. for ints).",print:"print(value, ..., sep=' ', end='\\n', file=sys.stdout, flush=False)\n\nPrints the values to a stream, or to sys.stdout by default.\nOptional keyword arguments:\nfile:  a file-like object (stream); defaults to the current sys.stdout.\nsep:   string inserted between values, default a space.\nend:   string appended after the last value, default a newline.\nflush: whether to forcibly flush the stream.",property:"property(fget=None, fset=None, fdel=None, doc=None) -> property attribute\n\nfget is a function to be used for getting an attribute value, and likewise\nfset is a function for setting, and fdel a function for del'ing, an\nattribute.  Typical use is to define a managed attribute x:\n\nclass C(object):\n    def getx(self): return self._x\n    def setx(self, value): self._x = value\n    def delx(self): del self._x\n    x = property(getx, setx, delx, \"I'm the 'x' property.\")\n\nDecorators make defining new properties or modifying existing ones easy:\n\nclass C(object):\n    @property\n    def x(self):\n        \"I am the 'x' property.\"\n        return self._x\n    @x.setter\n    def x(self, value):\n        self._x = value\n    @x.deleter\n    def x(self):\n        del self._x\n",quit:"",range:"range(stop) -> range object\nrange(start, stop[, step]) -> range object\n\nReturn a virtual sequence of numbers from start to stop by step.",repr:"repr(object) -> string\n\nReturn the canonical string representation of the object.\nFor most object types, eval(repr(object)) == object.",reversed:"reversed(sequence) -> reverse iterator over values of the sequence\n\nReturn a reverse iterator",round:"round(number[, ndigits]) -> number\n\nRound a number to a given precision in decimal digits (default 0 digits).\nThis returns an int when called with one argument, otherwise the\nsame type as the number. ndigits may be negative.",set:"set() -> new empty set object\nset(iterable) -> new set object\n\nBuild an unordered collection of unique elements.",setattr:"setattr(object, name, value)\n\nSet a named attribute on an object; setattr(x, 'y', v) is equivalent to\n``x.y = v''.",slice:"slice(stop)\nslice(start, stop[, step])\n\nCreate a slice object.  This is used for extended slicing (e.g. a[0:10:2]).",sorted:"sorted(iterable, key=None, reverse=False) --\x3e new sorted list",staticmethod:"staticmethod(function) -> method\n\nConvert a function to be a static method.\n\nA static method does not receive an implicit first argument.\nTo declare a static method, use this idiom:\n\n     class C:\n     def f(arg1, arg2, ...): ...\n     f = staticmethod(f)\n\nIt can be called either on the class (e.g. C.f()) or on an instance\n(e.g. C().f()).  The instance is ignored except for its class.\n\nStatic methods in Python are similar to those found in Java or C++.\nFor a more advanced concept, see the classmethod builtin.",str:"str(object='') -> str\nstr(bytes_or_buffer[, encoding[, errors]]) -> str\n\nCreate a new string object from the given object. If encoding or\nerrors is specified, then the object must expose a data buffer\nthat will be decoded using the given encoding and error handler.\nOtherwise, returns the result of object.__str__() (if defined)\nor repr(object).\nencoding defaults to sys.getdefaultencoding().\nerrors defaults to 'strict'.",sum:"sum(iterable[, start]) -> value\n\nReturn the sum of an iterable of numbers (NOT strings) plus the value\nof parameter 'start' (which defaults to 0).  When the iterable is\nempty, return start.",super:"super() -> same as super(__class__, <first argument>)\nsuper(type) -> unbound super object\nsuper(type, obj) -> bound super object; requires isinstance(obj, type)\nsuper(type, type2) -> bound super object; requires issubclass(type2, type)\nTypical use to call a cooperative superclass method:\nclass C(B):\n    def meth(self, arg):\n        super().meth(arg)\nThis works for class methods too:\nclass C(B):\n    @classmethod\n    def cmeth(cls, arg):\n        super().cmeth(arg)\n",tuple:"tuple() -> empty tuple\ntuple(iterable) -> tuple initialized from iterable's items\n\nIf the argument is a tuple, the return value is the same object.",type:"type(object_or_name, bases, dict)\ntype(object) -> the object's type\ntype(name, bases, dict) -> a new type",vars:"vars([object]) -> dictionary\n\nWithout arguments, equivalent to locals().\nWith an argument, equivalent to object.__dict__.",zip:"zip(iter1 [,iter2 [...]]) --\x3e zip object\n\nReturn a zip object whose .__next__() method returns a tuple where\nthe i-th element comes from the i-th iterable argument.  The .__next__()\nmethod continues until the shortest iterable in the argument sequence\nis exhausted and then it raises StopIteration."};return __BRYTHON__.builtins_doc=docs,function(t){var e=t.builtins;t.import_hooks=function(n,r,i){var s,o,a=t.meta_path.slice(),l=t.imported;if(i){var c=a.indexOf(t.finders.path);c>-1&&a.splice(c,1)}for(var u=0,h=a.length;u<h;u++){var p=a[u],d=t.$getattr(p,"find_spec",e.None);if(d==e.None){var f=t.$getattr(p,"find_module",e.None);if(f!==e.None&&(s=f(n,r))!==e.None){var m=t.$getattr(s,"load_module"),_=t.$call(m)(n);return l[n]=_,_}}else if(o=d(n,r),!t.is_none(o)){if(void 0!==(_=t.imported[o.name]))return l[o.name]=_;s=e.getattr(o,"loader",e.None);break}}if(void 0===s){message=n,"file"==t.protocol&&(message+=" (warning: cannot import local files with protocol 'file')");var g=e.ModuleNotFoundError.$factory(message);throw g.name=n,g}if(t.is_none(_)){if(o===e.None)throw e.ModuleNotFoundError.$factory(n);var y=e.getattr(o,"name");if(!t.is_none(s)){var v=e.getattr(s,"create_module",e.None);t.is_none(v)||(_=t.$call(v)(o))}if(void 0===_)throw e.ImportError.$factory(n);if(t.is_none(_)){_=t.module.$factory(n);var b=e.getattr(o,"origin");b=e.getattr(o,"has_location")?"from '"+b+"'":"("+b+")"}}_.__name__=y,_.__loader__=s,_.__package__=e.getattr(o,"parent",""),_.__spec__=o;var x=e.getattr(o,"submodule_search_locations");(_.$is_package=!t.is_none(x))&&(_.__path__=x),e.getattr(o,"has_location")&&(_.__file__=e.getattr(o,"origin"),t.$py_module_path[_.__name__]=_.__file__);var w=e.getattr(o,"cached");if(t.is_none(w)||(_.__cached__=w),t.is_none(s)){if(t.is_none(x))throw e.ImportError.$factory(n);l[y]=_}else{var S=e.getattr(s,"exec_module",e.None);if(t.is_none(S))_=e.getattr(s,"load_module")(y);else{l[y]=_;try{S(_)}catch(t){throw delete l[y],t}}}return l[y]}}(__BRYTHON__),function(t){t.builtins;var e=t.coroutine=t.make_class("coroutine");e.close=function(t){},e.send=function(t){return t.$func.apply(null,t.$args)},e.__repr__=e.__str__=function(t){return t.$func.$infos?"<coroutine "+t.$func.$infos.__name__+">":"<coroutine object>"},t.set_func_names(e,"builtins"),t.make_async=n=>{if(n.$is_genfunc)return n;var r=function(){var r=arguments,i=t.deep_copy(t.frames_stack);return{__class__:e,$args:r,$func:n,$stack:i}};return r.$infos=n.$infos,r},t.promise=function(t){return t.__class__===e?e.send(t):"function"==typeof t?t():t}}(__BRYTHON__),window.__BRYTHON__=__BRYTHON__,__BRYTHON__},__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=factory)?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},561:t=>{var e=Object.prototype.toString;t.exports=function(t){return t.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===e.call(t.buffer)||Array.isArray(t)}},355:t=>{t.exports=function(t,e){return"number"==typeof t?t:"number"==typeof e?e:0}},546:function(t,e,n){var r,i,s;i=[n(734)],r=function(t){"use strict";var e=function(t,n,i){if(void 0===t&&(t=e.DEFAULT_CAPACITY),void 0===n&&(n=e.DEFAULT_ENDIAN),void 0===i&&(i=e.DEFAULT_NOASSERT),!i){if((t|=0)<0)throw RangeError("Illegal capacity");n=!!n,i=!!i}this.buffer=0===t?r:new ArrayBuffer(t),this.view=0===t?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=t,this.littleEndian=n,this.noAssert=i};e.VERSION="5.0.1",e.LITTLE_ENDIAN=!0,e.BIG_ENDIAN=!1,e.DEFAULT_CAPACITY=16,e.DEFAULT_ENDIAN=e.BIG_ENDIAN,e.DEFAULT_NOASSERT=!1,e.Long=t||null;var n=e.prototype;n.__isByteBuffer__,Object.defineProperty(n,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var r=new ArrayBuffer(0),i=String.fromCharCode;function s(t){var e=0;return function(){return e<t.length?t.charCodeAt(e++):null}}function o(){var t=[],e=[];return function(){if(0===arguments.length)return e.join("")+i.apply(String,t);t.length+arguments.length>1024&&(e.push(i.apply(String,t)),t.length=0),Array.prototype.push.apply(t,arguments)}}function a(t,e,n,r,i){var s,o,a=8*i-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?i-1:0,p=n?-1:1,d=t[e+h];for(h+=p,s=d&(1<<-u)-1,d>>=-u,u+=a;u>0;s=256*s+t[e+h],h+=p,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=256*o+t[e+h],h+=p,u-=8);if(0===s)s=1-c;else{if(s===l)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,r),s-=c}return(d?-1:1)*o*Math.pow(2,s-r)}function l(t,e,n,r,i,s){var o,a,l,c=8*s-i-1,u=(1<<c)-1,h=u>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,f=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*l-1)*Math.pow(2,i),o+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[n+d]=255&a,d+=f,a/=256,i-=8);for(o=o<<i|a,c+=i;c>0;t[n+d]=255&o,d+=f,o/=256,c-=8);t[n+d-f]|=128*m}e.accessor=function(){return Uint8Array},e.allocate=function(t,n,r){return new e(t,n,r)},e.concat=function(t,n,r,i){"boolean"!=typeof n&&"string"==typeof n||(i=r,r=n,n=void 0);for(var s,o=0,a=0,l=t.length;a<l;++a)e.isByteBuffer(t[a])||(t[a]=e.wrap(t[a],n)),(s=t[a].limit-t[a].offset)>0&&(o+=s);if(0===o)return new e(0,r,i);var c,u=new e(o,r,i);for(a=0;a<l;)(s=(c=t[a++]).limit-c.offset)<=0||(u.view.set(c.view.subarray(c.offset,c.limit),u.offset),u.offset+=s);return u.limit=u.offset,u.offset=0,u},e.isByteBuffer=function(t){return!0===(t&&t.__isByteBuffer__)},e.type=function(){return ArrayBuffer},e.wrap=function(t,r,i,s){if("string"!=typeof r&&(s=i,i=r,r=void 0),"string"==typeof t)switch(void 0===r&&(r="utf8"),r){case"base64":return e.fromBase64(t,i);case"hex":return e.fromHex(t,i);case"binary":return e.fromBinary(t,i);case"utf8":return e.fromUTF8(t,i);case"debug":return e.fromDebug(t,i);default:throw Error("Unsupported encoding: "+r)}if(null===t||"object"!=typeof t)throw TypeError("Illegal buffer");var o;if(e.isByteBuffer(t))return(o=n.clone.call(t)).markedOffset=-1,o;if(t instanceof Uint8Array)o=new e(0,i,s),t.length>0&&(o.buffer=t.buffer,o.offset=t.byteOffset,o.limit=t.byteOffset+t.byteLength,o.view=new Uint8Array(t.buffer));else if(t instanceof ArrayBuffer)o=new e(0,i,s),t.byteLength>0&&(o.buffer=t,o.offset=0,o.limit=t.byteLength,o.view=t.byteLength>0?new Uint8Array(t):null);else{if("[object Array]"!==Object.prototype.toString.call(t))throw TypeError("Illegal buffer");(o=new e(t.length,i,s)).limit=t.length;for(var a=0;a<t.length;++a)o.view[a]=t[a]}return o},n.writeBitSet=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(!(t instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var r,i=e,s=t.length,o=s>>3,a=0;for(e+=this.writeVarint32(s,e);o--;)r=1&!!t[a++]|(1&!!t[a++])<<1|(1&!!t[a++])<<2|(1&!!t[a++])<<3|(1&!!t[a++])<<4|(1&!!t[a++])<<5|(1&!!t[a++])<<6|(1&!!t[a++])<<7,this.writeByte(r,e++);if(a<s){var l=0;for(r=0;a<s;)r|=(1&!!t[a++])<<l++;this.writeByte(r,e++)}return n?(this.offset=e,this):e-i},n.readBitSet=function(t){var e=void 0===t;e&&(t=this.offset);var n,r=this.readVarint32(t),i=r.value,s=i>>3,o=0,a=[];for(t+=r.length;s--;)n=this.readByte(t++),a[o++]=!!(1&n),a[o++]=!!(2&n),a[o++]=!!(4&n),a[o++]=!!(8&n),a[o++]=!!(16&n),a[o++]=!!(32&n),a[o++]=!!(64&n),a[o++]=!!(128&n);if(o<i){var l=0;for(n=this.readByte(t++);o<i;)a[o++]=!!(n>>l++&1)}return e&&(this.offset=t),a},n.readBytes=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+"+t+") <= "+this.buffer.byteLength)}var r=this.slice(e,e+t);return n&&(this.offset+=t),r},n.writeBytes=n.append,n.writeInt8=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var r=this.buffer.byteLength;return e>r&&this.resize((r*=2)>e?r:e),e-=1,this.view[e]=t,n&&(this.offset+=1),this},n.writeByte=n.writeInt8,n.readInt8=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n=this.view[t];return 128==(128&n)&&(n=-(255-n+1)),e&&(this.offset+=1),n},n.readByte=n.readInt8,n.writeUint8=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var r=this.buffer.byteLength;return e>r&&this.resize((r*=2)>e?r:e),e-=1,this.view[e]=t,n&&(this.offset+=1),this},n.writeUInt8=n.writeUint8,n.readUint8=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n=this.view[t];return e&&(this.offset+=1),n},n.readUInt8=n.readUint8,n.writeInt16=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var r=this.buffer.byteLength;return e>r&&this.resize((r*=2)>e?r:e),e-=2,this.littleEndian?(this.view[e+1]=(65280&t)>>>8,this.view[e]=255&t):(this.view[e]=(65280&t)>>>8,this.view[e+1]=255&t),n&&(this.offset+=2),this},n.writeShort=n.writeInt16,n.readInt16=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var n=0;return this.littleEndian?(n=this.view[t],n|=this.view[t+1]<<8):(n=this.view[t]<<8,n|=this.view[t+1]),32768==(32768&n)&&(n=-(65535-n+1)),e&&(this.offset+=2),n},n.readShort=n.readInt16,n.writeUint16=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var r=this.buffer.byteLength;return e>r&&this.resize((r*=2)>e?r:e),e-=2,this.littleEndian?(this.view[e+1]=(65280&t)>>>8,this.view[e]=255&t):(this.view[e]=(65280&t)>>>8,this.view[e+1]=255&t),n&&(this.offset+=2),this},n.writeUInt16=n.writeUint16,n.readUint16=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var n=0;return this.littleEndian?(n=this.view[t],n|=this.view[t+1]<<8):(n=this.view[t]<<8,n|=this.view[t+1]),e&&(this.offset+=2),n},n.readUInt16=n.readUint16,n.writeInt32=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var r=this.buffer.byteLength;return e>r&&this.resize((r*=2)>e?r:e),e-=4,this.littleEndian?(this.view[e+3]=t>>>24&255,this.view[e+2]=t>>>16&255,this.view[e+1]=t>>>8&255,this.view[e]=255&t):(this.view[e]=t>>>24&255,this.view[e+1]=t>>>16&255,this.view[e+2]=t>>>8&255,this.view[e+3]=255&t),n&&(this.offset+=4),this},n.writeInt=n.writeInt32,n.readInt32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var n=0;return this.littleEndian?(n=this.view[t+2]<<16,n|=this.view[t+1]<<8,n|=this.view[t],n+=this.view[t+3]<<24>>>0):(n=this.view[t+1]<<16,n|=this.view[t+2]<<8,n|=this.view[t+3],n+=this.view[t]<<24>>>0),n|=0,e&&(this.offset+=4),n},n.readInt=n.readInt32,n.writeUint32=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var r=this.buffer.byteLength;return e>r&&this.resize((r*=2)>e?r:e),e-=4,this.littleEndian?(this.view[e+3]=t>>>24&255,this.view[e+2]=t>>>16&255,this.view[e+1]=t>>>8&255,this.view[e]=255&t):(this.view[e]=t>>>24&255,this.view[e+1]=t>>>16&255,this.view[e+2]=t>>>8&255,this.view[e+3]=255&t),n&&(this.offset+=4),this},n.writeUInt32=n.writeUint32,n.readUint32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var n=0;return this.littleEndian?(n=this.view[t+2]<<16,n|=this.view[t+1]<<8,n|=this.view[t],n+=this.view[t+3]<<24>>>0):(n=this.view[t+1]<<16,n|=this.view[t+2]<<8,n|=this.view[t+3],n+=this.view[t]<<24>>>0),e&&(this.offset+=4),n},n.readUInt32=n.readUint32,t&&(n.writeInt64=function(e,n){var r=void 0===n;if(r&&(n=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e)),n+=8;var i=this.buffer.byteLength;n>i&&this.resize((i*=2)>n?i:n),n-=8;var s=e.low,o=e.high;return this.littleEndian?(this.view[n+3]=s>>>24&255,this.view[n+2]=s>>>16&255,this.view[n+1]=s>>>8&255,this.view[n]=255&s,n+=4,this.view[n+3]=o>>>24&255,this.view[n+2]=o>>>16&255,this.view[n+1]=o>>>8&255,this.view[n]=255&o):(this.view[n]=o>>>24&255,this.view[n+1]=o>>>16&255,this.view[n+2]=o>>>8&255,this.view[n+3]=255&o,n+=4,this.view[n]=s>>>24&255,this.view[n+1]=s>>>16&255,this.view[n+2]=s>>>8&255,this.view[n+3]=255&s),r&&(this.offset+=8),this},n.writeLong=n.writeInt64,n.readInt64=function(e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=0,i=0;this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0,e+=4,i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0,e+=4,r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0);var s=new t(r,i,!1);return n&&(this.offset+=8),s},n.readLong=n.readInt64,n.writeUint64=function(e,n){var r=void 0===n;if(r&&(n=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e)),n+=8;var i=this.buffer.byteLength;n>i&&this.resize((i*=2)>n?i:n),n-=8;var s=e.low,o=e.high;return this.littleEndian?(this.view[n+3]=s>>>24&255,this.view[n+2]=s>>>16&255,this.view[n+1]=s>>>8&255,this.view[n]=255&s,n+=4,this.view[n+3]=o>>>24&255,this.view[n+2]=o>>>16&255,this.view[n+1]=o>>>8&255,this.view[n]=255&o):(this.view[n]=o>>>24&255,this.view[n+1]=o>>>16&255,this.view[n+2]=o>>>8&255,this.view[n+3]=255&o,n+=4,this.view[n]=s>>>24&255,this.view[n+1]=s>>>16&255,this.view[n+2]=s>>>8&255,this.view[n+3]=255&s),r&&(this.offset+=8),this},n.writeUInt64=n.writeUint64,n.readUint64=function(e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=0,i=0;this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0,e+=4,i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0,e+=4,r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0);var s=new t(r,i,!0);return n&&(this.offset+=8),s},n.readUInt64=n.readUint64),n.writeFloat32=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var r=this.buffer.byteLength;return e>r&&this.resize((r*=2)>e?r:e),e-=4,l(this.view,t,e,this.littleEndian,23,4),n&&(this.offset+=4),this},n.writeFloat=n.writeFloat32,n.readFloat32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var n=a(this.view,t,this.littleEndian,23,4);return e&&(this.offset+=4),n},n.readFloat=n.readFloat32,n.writeFloat64=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=8;var r=this.buffer.byteLength;return e>r&&this.resize((r*=2)>e?r:e),e-=8,l(this.view,t,e,this.littleEndian,52,8),n&&(this.offset+=8),this},n.writeDouble=n.writeFloat64,n.readFloat64=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var n=a(this.view,t,this.littleEndian,52,8);return e&&(this.offset+=8),n},n.readDouble=n.readFloat64,e.MAX_VARINT32_BYTES=5,e.calculateVarint32=function(t){return(t>>>=0)<128?1:t<16384?2:t<1<<21?3:t<1<<28?4:5},e.zigZagEncode32=function(t){return((t|=0)<<1^t>>31)>>>0},e.zigZagDecode32=function(t){return t>>>1^-(1&t)|0},n.writeVarint32=function(t,n){var r=void 0===n;if(r&&(n=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}var i,s=e.calculateVarint32(t);n+=s;var o=this.buffer.byteLength;for(n>o&&this.resize((o*=2)>n?o:n),n-=s,t>>>=0;t>=128;)i=127&t|128,this.view[n++]=i,t>>>=7;return this.view[n++]=t,r?(this.offset=n,this):s},n.writeVarint32ZigZag=function(t,n){return this.writeVarint32(e.zigZagEncode32(t),n)},n.readVarint32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n,r=0,i=0;do{if(!this.noAssert&&t>this.limit){var s=Error("Truncated");throw s.truncated=!0,s}n=this.view[t++],r<5&&(i|=(127&n)<<7*r),++r}while(0!=(128&n));return i|=0,e?(this.offset=t,i):{value:i,length:r}},n.readVarint32ZigZag=function(t){var n=this.readVarint32(t);return"object"==typeof n?n.value=e.zigZagDecode32(n.value):n=e.zigZagDecode32(n),n},t&&(e.MAX_VARINT64_BYTES=10,e.calculateVarint64=function(e){"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e));var n=e.toInt()>>>0,r=e.shiftRightUnsigned(28).toInt()>>>0,i=e.shiftRightUnsigned(56).toInt()>>>0;return 0==i?0==r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10},e.zigZagEncode64=function(e){return"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftLeft(1).xor(e.shiftRight(63)).toUnsigned()},e.zigZagDecode64=function(e){return"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftRightUnsigned(1).xor(e.and(t.ONE).toSigned().negate()).toSigned()},n.writeVarint64=function(n,r){var i=void 0===r;if(i&&(r=this.offset),!this.noAssert){if("number"==typeof n)n=t.fromNumber(n);else if("string"==typeof n)n=t.fromString(n);else if(!(n&&n instanceof t))throw TypeError("Illegal value: "+n+" (not an integer or Long)");if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof n?n=t.fromNumber(n,!1):"string"==typeof n?n=t.fromString(n,!1):!1!==n.unsigned&&(n=n.toSigned());var s=e.calculateVarint64(n),o=n.toInt()>>>0,a=n.shiftRightUnsigned(28).toInt()>>>0,l=n.shiftRightUnsigned(56).toInt()>>>0;r+=s;var c=this.buffer.byteLength;switch(r>c&&this.resize((c*=2)>r?c:r),r-=s,s){case 10:this.view[r+9]=l>>>7&1;case 9:this.view[r+8]=9!==s?128|l:127&l;case 8:this.view[r+7]=8!==s?a>>>21|128:a>>>21&127;case 7:this.view[r+6]=7!==s?a>>>14|128:a>>>14&127;case 6:this.view[r+5]=6!==s?a>>>7|128:a>>>7&127;case 5:this.view[r+4]=5!==s?128|a:127&a;case 4:this.view[r+3]=4!==s?o>>>21|128:o>>>21&127;case 3:this.view[r+2]=3!==s?o>>>14|128:o>>>14&127;case 2:this.view[r+1]=2!==s?o>>>7|128:o>>>7&127;case 1:this.view[r]=1!==s?128|o:127&o}return i?(this.offset+=s,this):s},n.writeVarint64ZigZag=function(t,n){return this.writeVarint64(e.zigZagEncode64(t),n)},n.readVarint64=function(e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=e,i=0,s=0,o=0,a=0;if(i=127&(a=this.view[e++]),128&a&&(i|=(127&(a=this.view[e++]))<<7,(128&a||this.noAssert&&void 0===a)&&(i|=(127&(a=this.view[e++]))<<14,(128&a||this.noAssert&&void 0===a)&&(i|=(127&(a=this.view[e++]))<<21,(128&a||this.noAssert&&void 0===a)&&(s=127&(a=this.view[e++]),(128&a||this.noAssert&&void 0===a)&&(s|=(127&(a=this.view[e++]))<<7,(128&a||this.noAssert&&void 0===a)&&(s|=(127&(a=this.view[e++]))<<14,(128&a||this.noAssert&&void 0===a)&&(s|=(127&(a=this.view[e++]))<<21,(128&a||this.noAssert&&void 0===a)&&(o=127&(a=this.view[e++]),(128&a||this.noAssert&&void 0===a)&&(o|=(127&(a=this.view[e++]))<<7,128&a||this.noAssert&&void 0===a))))))))))throw Error("Buffer overrun");var l=t.fromBits(i|s<<28,s>>>4|o<<24,!1);return n?(this.offset=e,l):{value:l,length:e-r}},n.readVarint64ZigZag=function(n){var r=this.readVarint64(n);return r&&r.value instanceof t?r.value=e.zigZagDecode64(r.value):r=e.zigZagDecode64(r),r}),n.writeCString=function(t,e){var n=void 0===e;n&&(e=this.offset);var r,i=t.length;if(!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");for(r=0;r<i;++r)if(0===t.charCodeAt(r))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}i=u.calculateUTF16asUTF8(s(t))[1],e+=i+1;var o=this.buffer.byteLength;return e>o&&this.resize((o*=2)>e?o:e),e-=i+1,u.encodeUTF16toUTF8(s(t),function(t){this.view[e++]=t}.bind(this)),this.view[e++]=0,n?(this.offset=e,this):i},n.readCString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n,r=t,i=-1;return u.decodeUTF8toUTF16(function(){if(0===i)return null;if(t>=this.limit)throw RangeError("Illegal range: Truncated data, "+t+" < "+this.limit);return 0===(i=this.view[t++])?null:i}.bind(this),n=o(),!0),e?(this.offset=t,n()):{string:n(),length:t-r}},n.writeIString=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var r,i=e;r=u.calculateUTF16asUTF8(s(t),this.noAssert)[1],e+=4+r;var o=this.buffer.byteLength;if(e>o&&this.resize((o*=2)>e?o:e),e-=4+r,this.littleEndian?(this.view[e+3]=r>>>24&255,this.view[e+2]=r>>>16&255,this.view[e+1]=r>>>8&255,this.view[e]=255&r):(this.view[e]=r>>>24&255,this.view[e+1]=r>>>16&255,this.view[e+2]=r>>>8&255,this.view[e+3]=255&r),e+=4,u.encodeUTF16toUTF8(s(t),function(t){this.view[e++]=t}.bind(this)),e!==i+4+r)throw RangeError("Illegal range: Truncated data, "+e+" == "+(e+4+r));return n?(this.offset=e,this):e-i},n.readIString=function(t){var n=void 0===t;if(n&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var r=t,i=this.readUint32(t),s=this.readUTF8String(i,e.METRICS_BYTES,t+=4);return t+=s.length,n?(this.offset=t,s.string):{string:s.string,length:t-r}},e.METRICS_CHARS="c",e.METRICS_BYTES="b",n.writeUTF8String=function(t,e){var n,r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var i=e;n=u.calculateUTF16asUTF8(s(t))[1],e+=n;var o=this.buffer.byteLength;return e>o&&this.resize((o*=2)>e?o:e),e-=n,u.encodeUTF16toUTF8(s(t),function(t){this.view[e++]=t}.bind(this)),r?(this.offset=e,this):e-i},n.writeString=n.writeUTF8String,e.calculateUTF8Chars=function(t){return u.calculateUTF16asUTF8(s(t))[0]},e.calculateUTF8Bytes=function(t){return u.calculateUTF16asUTF8(s(t))[1]},e.calculateString=e.calculateUTF8Bytes,n.readUTF8String=function(t,n,r){"number"==typeof n&&(r=n,n=void 0);var i=void 0===r;if(i&&(r=this.offset),void 0===n&&(n=e.METRICS_CHARS),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal length: "+t+" (not an integer)");if(t|=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var s,a=0,l=r;if(n===e.METRICS_CHARS){if(s=o(),u.decodeUTF8(function(){return a<t&&r<this.limit?this.view[r++]:null}.bind(this),(function(t){++a,u.UTF8toUTF16(t,s)})),a!==t)throw RangeError("Illegal range: Truncated data, "+a+" == "+t);return i?(this.offset=r,s()):{string:s(),length:r-l}}if(n===e.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+"+t+") <= "+this.buffer.byteLength)}var c=r+t;if(u.decodeUTF8toUTF16(function(){return r<c?this.view[r++]:null}.bind(this),s=o(),this.noAssert),r!==c)throw RangeError("Illegal range: Truncated data, "+r+" == "+c);return i?(this.offset=r,s()):{string:s(),length:r-l}}throw TypeError("Unsupported metrics: "+n)},n.readString=n.readUTF8String,n.writeVString=function(t,n){var r=void 0===n;if(r&&(n=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}var i,o,a=n;i=u.calculateUTF16asUTF8(s(t),this.noAssert)[1],o=e.calculateVarint32(i),n+=o+i;var l=this.buffer.byteLength;if(n>l&&this.resize((l*=2)>n?l:n),n-=o+i,n+=this.writeVarint32(i,n),u.encodeUTF16toUTF8(s(t),function(t){this.view[n++]=t}.bind(this)),n!==a+i+o)throw RangeError("Illegal range: Truncated data, "+n+" == "+(n+i+o));return r?(this.offset=n,this):n-a},n.readVString=function(t){var n=void 0===t;if(n&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r=t,i=this.readVarint32(t),s=this.readUTF8String(i.value,e.METRICS_BYTES,t+=i.length);return t+=s.length,n?(this.offset=t,s.string):{string:s.string,length:t-r}},n.append=function(t,n,r){"number"!=typeof n&&"string"==typeof n||(r=n,n=void 0);var i=void 0===r;if(i&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}t instanceof e||(t=e.wrap(t,n));var s=t.limit-t.offset;if(s<=0)return this;r+=s;var o=this.buffer.byteLength;return r>o&&this.resize((o*=2)>r?o:r),r-=s,this.view.set(t.view.subarray(t.offset,t.limit),r),t.offset+=s,i&&(this.offset+=s),this},n.appendTo=function(t,e){return t.append(this,e),this},n.assert=function(t){return this.noAssert=!t,this},n.capacity=function(){return this.buffer.byteLength},n.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},n.clone=function(t){var n=new e(0,this.littleEndian,this.noAssert);return t?(n.buffer=new ArrayBuffer(this.buffer.byteLength),n.view=new Uint8Array(n.buffer)):(n.buffer=this.buffer,n.view=this.view),n.offset=this.offset,n.markedOffset=this.markedOffset,n.limit=this.limit,n},n.compact=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}if(0===t&&e===this.buffer.byteLength)return this;var n=e-t;if(0===n)return this.buffer=r,this.view=null,this.markedOffset>=0&&(this.markedOffset-=t),this.offset=0,this.limit=0,this;var i=new ArrayBuffer(n),s=new Uint8Array(i);return s.set(this.view.subarray(t,e)),this.buffer=i,this.view=s,this.markedOffset>=0&&(this.markedOffset-=t),this.offset=0,this.limit=n,this},n.copy=function(t,n){if(void 0===t&&(t=this.offset),void 0===n&&(n=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal end: Not an integer");if(n>>>=0,t<0||t>n||n>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+n+" <= "+this.buffer.byteLength)}if(t===n)return new e(0,this.littleEndian,this.noAssert);var r=n-t,i=new e(r,this.littleEndian,this.noAssert);return i.offset=0,i.limit=r,i.markedOffset>=0&&(i.markedOffset-=t),this.copyTo(i,0,t,n),i},n.copyTo=function(t,n,r,i){var s,o;if(!this.noAssert&&!e.isByteBuffer(t))throw TypeError("Illegal target: Not a ByteBuffer");if(n=(o=void 0===n)?t.offset:0|n,r=(s=void 0===r)?this.offset:0|r,i=void 0===i?this.limit:0|i,n<0||n>t.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+n+" <= "+t.buffer.byteLength);if(r<0||i>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+r+" <= "+this.buffer.byteLength);var a=i-r;return 0===a?t:(t.ensureCapacity(n+a),t.view.set(this.view.subarray(r,i),n),s&&(this.offset+=a),o&&(t.offset+=a),this)},n.ensureCapacity=function(t){var e=this.buffer.byteLength;return e<t?this.resize((e*=2)>t?e:t):this},n.fill=function(t,e,n){var r=void 0===e;if(r&&(e=this.offset),"string"==typeof t&&t.length>0&&(t=t.charCodeAt(0)),void 0===e&&(e=this.offset),void 0===n&&(n=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal end: Not an integer");if(n>>>=0,e<0||e>n||n>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+n+" <= "+this.buffer.byteLength)}if(e>=n)return this;for(;e<n;)this.view[e++]=t;return r&&(this.offset=e),this},n.flip=function(){return this.limit=this.offset,this.offset=0,this},n.mark=function(t){if(t=void 0===t?this.offset:t,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=t,this},n.order=function(t){if(!this.noAssert&&"boolean"!=typeof t)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!t,this},n.LE=function(t){return this.littleEndian=void 0===t||!!t,this},n.BE=function(t){return this.littleEndian=void 0!==t&&!t,this},n.prepend=function(t,n,r){"number"!=typeof n&&"string"==typeof n||(r=n,n=void 0);var i=void 0===r;if(i&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}t instanceof e||(t=e.wrap(t,n));var s=t.limit-t.offset;if(s<=0)return this;var o=s-r;if(o>0){var a=new ArrayBuffer(this.buffer.byteLength+o),l=new Uint8Array(a);l.set(this.view.subarray(r,this.buffer.byteLength),s),this.buffer=a,this.view=l,this.offset+=o,this.markedOffset>=0&&(this.markedOffset+=o),this.limit+=o,r+=o}else new Uint8Array(this.buffer);return this.view.set(t.view.subarray(t.offset,t.limit),r-s),t.offset=t.limit,i&&(this.offset-=s),this},n.prependTo=function(t,e){return t.prepend(this,e),this},n.printDebug=function(t){"function"!=typeof t&&(t=console.log.bind(console)),t(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},n.remaining=function(){return this.limit-this.offset},n.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},n.resize=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal capacity: "+t+" (not an integer)");if((t|=0)<0)throw RangeError("Illegal capacity: 0 <= "+t)}if(this.buffer.byteLength<t){var e=new ArrayBuffer(t),n=new Uint8Array(e);n.set(this.view),this.buffer=e,this.view=n}return this},n.reverse=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}return t===e||Array.prototype.reverse.call(this.view.subarray(t,e)),this},n.skip=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal length: "+t+" (not an integer)");t|=0}var e=this.offset+t;if(!this.noAssert&&(e<0||e>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+t+" <= "+this.buffer.byteLength);return this.offset=e,this},n.slice=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var n=this.clone();return n.offset=t,n.limit=e,n},n.toBuffer=function(t){var e=this.offset,n=this.limit;if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: Not an integer");if(e>>>=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal limit: Not an integer");if(n>>>=0,e<0||e>n||n>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+n+" <= "+this.buffer.byteLength)}if(!t&&0===e&&n===this.buffer.byteLength)return this.buffer;if(e===n)return r;var i=new ArrayBuffer(n-e);return new Uint8Array(i).set(new Uint8Array(this.buffer).subarray(e,n),0),i},n.toArrayBuffer=n.toBuffer,n.toString=function(t,e,n){if(void 0===t)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof t&&(n=e=t="utf8"),t){case"utf8":return this.toUTF8(e,n);case"base64":return this.toBase64(e,n);case"hex":return this.toHex(e,n);case"binary":return this.toBinary(e,n);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+t)}};var c=function(){for(var t={},e=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],n=[],r=0,i=e.length;r<i;++r)n[e[r]]=r;return t.encode=function(t,n){for(var r,i;null!==(r=t());)n(e[r>>2&63]),i=(3&r)<<4,null!==(r=t())?(n(e[63&((i|=r>>4&15)|r>>4&15)]),i=(15&r)<<2,null!==(r=t())?(n(e[63&(i|r>>6&3)]),n(e[63&r])):(n(e[63&i]),n(61))):(n(e[63&i]),n(61),n(61))},t.decode=function(t,e){var r,i,s;function o(t){throw Error("Illegal character code: "+t)}for(;null!==(r=t());)if(void 0===(i=n[r])&&o(r),null!==(r=t())&&(void 0===(s=n[r])&&o(r),e(i<<2>>>0|(48&s)>>4),null!==(r=t()))){if(void 0===(i=n[r])){if(61===r)break;o(r)}if(e((15&s)<<4>>>0|(60&i)>>2),null!==(r=t())){if(void 0===(s=n[r])){if(61===r)break;o(r)}e((3&i)<<6>>>0|s)}}},t.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)},t}();n.toBase64=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),e|=0,(t|=0)<0||e>this.capacity||t>e)throw RangeError("begin, end");var n;return c.encode(function(){return t<e?this.view[t++]:null}.bind(this),n=o()),n()},e.fromBase64=function(t,n){if("string"!=typeof t)throw TypeError("str");var r=new e(t.length/4*3,n),i=0;return c.decode(s(t),(function(t){r.view[i++]=t})),r.limit=i,r},e.btoa=function(t){return e.fromBinary(t).toBase64()},e.atob=function(t){return e.fromBase64(t).toBinary()},n.toBinary=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),e|=0,(t|=0)<0||e>this.capacity()||t>e)throw RangeError("begin, end");if(t===e)return"";for(var n=[],r=[];t<e;)n.push(this.view[t++]),n.length>=1024&&(r.push(String.fromCharCode.apply(String,n)),n=[]);return r.join("")+String.fromCharCode.apply(String,n)},e.fromBinary=function(t,n){if("string"!=typeof t)throw TypeError("str");for(var r,i=0,s=t.length,o=new e(s,n);i<s;){if((r=t.charCodeAt(i))>255)throw RangeError("illegal char code: "+r);o.view[i++]=r}return o.limit=s,o},n.toDebug=function(t){for(var e,n=-1,r=this.buffer.byteLength,i="",s="",o="";n<r;){if(-1!==n&&(i+=(e=this.view[n])<16?"0"+e.toString(16).toUpperCase():e.toString(16).toUpperCase(),t&&(s+=e>32&&e<127?String.fromCharCode(e):".")),++n,t&&n>0&&n%16==0&&n!==r){for(;i.length<51;)i+=" ";o+=i+s+"\n",i=s=""}n===this.offset&&n===this.limit?i+=n===this.markedOffset?"!":"|":n===this.offset?i+=n===this.markedOffset?"[":"<":n===this.limit?i+=n===this.markedOffset?"]":">":i+=n===this.markedOffset?"'":t||0!==n&&n!==r?" ":""}if(t&&" "!==i){for(;i.length<51;)i+=" ";o+=i+s+"\n"}return t?o:i},e.fromDebug=function(t,n,r){for(var i,s,o=t.length,a=new e((o+1)/3|0,n,r),l=0,c=0,u=!1,h=!1,p=!1,d=!1,f=!1;l<o;){switch(i=t.charAt(l++)){case"!":if(!r){if(h||p||d){f=!0;break}h=p=d=!0}a.offset=a.markedOffset=a.limit=c,u=!1;break;case"|":if(!r){if(h||d){f=!0;break}h=d=!0}a.offset=a.limit=c,u=!1;break;case"[":if(!r){if(h||p){f=!0;break}h=p=!0}a.offset=a.markedOffset=c,u=!1;break;case"<":if(!r){if(h){f=!0;break}h=!0}a.offset=c,u=!1;break;case"]":if(!r){if(d||p){f=!0;break}d=p=!0}a.limit=a.markedOffset=c,u=!1;break;case">":if(!r){if(d){f=!0;break}d=!0}a.limit=c,u=!1;break;case"'":if(!r){if(p){f=!0;break}p=!0}a.markedOffset=c,u=!1;break;case" ":u=!1;break;default:if(!r&&u){f=!0;break}if(s=parseInt(i+t.charAt(l++),16),!r&&(isNaN(s)||s<0||s>255))throw TypeError("Illegal str: Not a debug encoded string");a.view[c++]=s,u=!0}if(f)throw TypeError("Illegal str: Invalid symbol at "+l)}if(!r){if(!h||!d)throw TypeError("Illegal str: Missing offset or limit");if(c<a.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+c+" < "+o)}return a},n.toHex=function(t,e){if(t=void 0===t?this.offset:t,e=void 0===e?this.limit:e,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}for(var n,r=new Array(e-t);t<e;)(n=this.view[t++])<16?r.push("0",n.toString(16)):r.push(n.toString(16));return r.join("")},e.fromHex=function(t,n,r){if(!r){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if(t.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var i,s=t.length,o=new e(s/2|0,n),a=0,l=0;a<s;a+=2){if(i=parseInt(t.substring(a,a+2),16),!r&&(!isFinite(i)||i<0||i>255))throw TypeError("Illegal str: Contains non-hex characters");o.view[l++]=i}return o.limit=l,o};var u=function(){var t={MAX_CODEPOINT:1114111,encodeUTF8:function(t,e){var n=null;for("number"==typeof t&&(n=t,t=function(){return null});null!==n||null!==(n=t());)n<128?e(127&n):n<2048?(e(n>>6&31|192),e(63&n|128)):n<65536?(e(n>>12&15|224),e(n>>6&63|128),e(63&n|128)):(e(n>>18&7|240),e(n>>12&63|128),e(n>>6&63|128),e(63&n|128)),n=null},decodeUTF8:function(t,e){for(var n,r,i,s,o=function(t){t=t.slice(0,t.indexOf(null));var e=Error(t.toString());throw e.name="TruncatedError",e.bytes=t,e};null!==(n=t());)if(0==(128&n))e(n);else if(192==(224&n))null===(r=t())&&o([n,r]),e((31&n)<<6|63&r);else if(224==(240&n))(null===(r=t())||null===(i=t()))&&o([n,r,i]),e((15&n)<<12|(63&r)<<6|63&i);else{if(240!=(248&n))throw RangeError("Illegal starting byte: "+n);(null===(r=t())||null===(i=t())||null===(s=t()))&&o([n,r,i,s]),e((7&n)<<18|(63&r)<<12|(63&i)<<6|63&s)}},UTF16toUTF8:function(t,e){for(var n,r=null;null!==(n=null!==r?r:t());)n>=55296&&n<=57343&&null!==(r=t())&&r>=56320&&r<=57343?(e(1024*(n-55296)+r-56320+65536),r=null):e(n);null!==r&&e(r)},UTF8toUTF16:function(t,e){var n=null;for("number"==typeof t&&(n=t,t=function(){return null});null!==n||null!==(n=t());)n<=65535?e(n):(e(55296+((n-=65536)>>10)),e(n%1024+56320)),n=null},encodeUTF16toUTF8:function(e,n){t.UTF16toUTF8(e,(function(e){t.encodeUTF8(e,n)}))},decodeUTF8toUTF16:function(e,n){t.decodeUTF8(e,(function(e){t.UTF8toUTF16(e,n)}))},calculateCodePoint:function(t){return t<128?1:t<2048?2:t<65536?3:4},calculateUTF8:function(t){for(var e,n=0;null!==(e=t());)n+=e<128?1:e<2048?2:e<65536?3:4;return n},calculateUTF16asUTF8:function(e){var n=0,r=0;return t.UTF16toUTF8(e,(function(t){++n,r+=t<128?1:t<2048?2:t<65536?3:4})),[n,r]}};return t}();return n.toUTF8=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var n;try{u.decodeUTF8toUTF16(function(){return t<e?this.view[t++]:null}.bind(this),n=o())}catch(n){if(t!==e)throw RangeError("Illegal range: Truncated data, "+t+" != "+e)}return n()},e.fromUTF8=function(t,n,r){if(!r&&"string"!=typeof t)throw TypeError("Illegal str: Not a string");var i=new e(u.calculateUTF16asUTF8(s(t),!0)[1],n,r),o=0;return u.encodeUTF16toUTF8(s(t),(function(t){i.view[o++]=t})),i.limit=o,i},e},void 0===(s=r.apply(e,i))||(t.exports=s)},690:t=>{t.exports=function(t){switch(t){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},87:t=>{"function"==typeof Object.create?t.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}},809:t=>{function e(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}t.exports=function(t){return null!=t&&(e(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&e(t.slice(0,0))}(t)||!!t._isBuffer)}},190:(t,e,n)=>{var r=n(408),i=n(720),s=n(355),o=["x","e","a","o","n","s","r","c","u","m","v","w","z"],a=["m","w"],l=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],c="\t".charCodeAt(0),u=" ".charCodeAt(0);function h(t){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(t)}function p(t){return new Function(["return function "+t+"() {","  return this._"+t,"}"].join("\n"))()}function d(t,e){if(!t.chars||0===t.chars.length)return null;var n=m(t.chars,e);return n>=0?t.chars[n]:null}function f(t,e,n){if(!t.kernings||0===t.kernings.length)return 0;for(var r=t.kernings,i=0;i<r.length;i++){var s=r[i];if(s.first===e&&s.second===n)return s.amount}return 0}function m(t,e,n){for(var r=n=n||0;r<t.length;r++)if(t[r].id===e)return r;return-1}t.exports=function(t){return new h(t)},h.prototype.update=function(t){if(t=i({measure:this._measure},t),this._opt=t,this._opt.tabSize=s(this._opt.tabSize,4),!t.font)throw new Error("must provide a valid bitmap font");var e=this.glyphs,n=t.text||"",a=t.font;this._setupSpaceGlyphs(a);var c=r.lines(n,t),u=t.width||0;e.length=0;var h=c.reduce((function(t,e){return Math.max(t,e.width,u)}),0),p=0,d=0,_=s(t.lineHeight,a.common.lineHeight),g=a.common.base,y=_-g,v=t.letterSpacing||0,b=_*c.length-y,x=function(t){return"center"===t?1:"right"===t?2:0}(this._opt.align);d-=b,this._width=h,this._height=b,this._descender=_-g,this._baseline=g,this._xHeight=function(t){for(var e=0;e<o.length;e++){var n=o[e].charCodeAt(0),r=m(t.chars,n);if(r>=0)return t.chars[r].height}return 0}(a),this._capHeight=function(t){for(var e=0;e<l.length;e++){var n=l[e].charCodeAt(0),r=m(t.chars,n);if(r>=0)return t.chars[r].height}return 0}(a),this._lineHeight=_,this._ascender=_-y-this._xHeight;var w=this;c.forEach((function(t,r){for(var i,s=t.start,o=t.end,l=t.width,c=s;c<o;c++){var u=n.charCodeAt(c),m=w.getGlyph(a,u);if(m){i&&(p+=f(a,i.id,m.id));var g=p;1===x?g+=(h-l)/2:2===x&&(g+=h-l),e.push({position:[g,d],data:m,index:c,line:r}),p+=m.xadvance+v,i=m}}d+=_,p=0})),this._linesTotal=c.length},h.prototype._setupSpaceGlyphs=function(t){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,t.chars&&0!==t.chars.length){var e=d(t,u)||function(t){for(var e=0;e<a.length;e++){var n=a[e].charCodeAt(0),r=m(t.chars,n);if(r>=0)return t.chars[r]}return 0}(t)||t.chars[0],n=this._opt.tabSize*e.xadvance;this._fallbackSpaceGlyph=e,this._fallbackTabGlyph=i(e,{x:0,y:0,xadvance:n,id:c,xoffset:0,yoffset:0,width:0,height:0})}},h.prototype.getGlyph=function(t,e){return d(t,e)||(e===c?this._fallbackTabGlyph:e===u?this._fallbackSpaceGlyph:null)},h.prototype.computeMetrics=function(t,e,n,r){var i,s=this._opt.letterSpacing||0,o=this._opt.font,a=0,l=0,c=0;if(!o.chars||0===o.chars.length)return{start:e,end:e,width:0};n=Math.min(t.length,n);for(var u=e;u<n;u++){var h,p=t.charCodeAt(u);if(h=this.getGlyph(o,p)){h.xoffset;var d=(a+=i?f(o,i.id,h.id):0)+h.xadvance+s,m=a+h.width;if(m>=r||d>=r)break;a=d,l=m,i=h}c++}return i&&(l+=i.xoffset),{start:e,end:e+c,width:l}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach((function(t){Object.defineProperty(h.prototype,t,{get:p(t),configurable:!0})}))},734:function(t,e){var n,r;void 0===(r="function"==typeof(n=function(){"use strict";function t(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function e(t){return!0===(t&&t.__isLong__)}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),t.isLong=e;var n={},r={};function i(t,e){var i,s,a;return e?(a=0<=(t>>>=0)&&t<256)&&(s=r[t])?s:(i=o(t,(0|t)<0?-1:0,!0),a&&(r[t]=i),i):(a=-128<=(t|=0)&&t<128)&&(s=n[t])?s:(i=o(t,t<0?-1:0,!1),a&&(n[t]=i),i)}function s(t,e){if(isNaN(t)||!isFinite(t))return e?m:f;if(e){if(t<0)return m;if(t>=h)return b}else{if(t<=-p)return x;if(t+1>=p)return v}return t<0?s(-t,e).neg():o(t%u|0,t/u|0,e)}function o(e,n,r){return new t(e,n,r)}t.fromInt=i,t.fromNumber=s,t.fromBits=o;var a=Math.pow;function l(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return f;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return l(t.substring(1),e,n).neg();for(var i=s(a(n,8)),o=f,c=0;c<t.length;c+=8){var u=Math.min(8,t.length-c),h=parseInt(t.substring(c,c+u),n);if(u<8){var p=s(a(n,u));o=o.mul(p).add(s(h))}else o=(o=o.mul(i)).add(s(h))}return o.unsigned=e,o}function c(e){return e instanceof t?e:"number"==typeof e?s(e):"string"==typeof e?l(e):o(e.low,e.high,e.unsigned)}t.fromString=l,t.fromValue=c;var u=4294967296,h=u*u,p=h/2,d=i(1<<24),f=i(0);t.ZERO=f;var m=i(0,!0);t.UZERO=m;var _=i(1);t.ONE=_;var g=i(1,!0);t.UONE=g;var y=i(-1);t.NEG_ONE=y;var v=o(-1,2147483647,!1);t.MAX_VALUE=v;var b=o(-1,-1,!0);t.MAX_UNSIGNED_VALUE=b;var x=o(0,-2147483648,!1);t.MIN_VALUE=x;var w=t.prototype;return w.toInt=function(){return this.unsigned?this.low>>>0:this.low},w.toNumber=function(){return this.unsigned?(this.high>>>0)*u+(this.low>>>0):this.high*u+(this.low>>>0)},w.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(x)){var e=s(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=s(a(t,6),this.unsigned),o=this,l="";;){var c=o.div(i),u=(o.sub(c.mul(i)).toInt()>>>0).toString(t);if((o=c).isZero())return u+l;for(;u.length<6;)u="0"+u;l=""+u+l}},w.getHighBits=function(){return this.high},w.getHighBitsUnsigned=function(){return this.high>>>0},w.getLowBits=function(){return this.low},w.getLowBitsUnsigned=function(){return this.low>>>0},w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(x)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},w.isZero=function(){return 0===this.high&&0===this.low},w.isNegative=function(){return!this.unsigned&&this.high<0},w.isPositive=function(){return this.unsigned||this.high>=0},w.isOdd=function(){return 1==(1&this.low)},w.isEven=function(){return 0==(1&this.low)},w.equals=function(t){return e(t)||(t=c(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},w.eq=w.equals,w.notEquals=function(t){return!this.eq(t)},w.neq=w.notEquals,w.lessThan=function(t){return this.comp(t)<0},w.lt=w.lessThan,w.lessThanOrEqual=function(t){return this.comp(t)<=0},w.lte=w.lessThanOrEqual,w.greaterThan=function(t){return this.comp(t)>0},w.gt=w.greaterThan,w.greaterThanOrEqual=function(t){return this.comp(t)>=0},w.gte=w.greaterThanOrEqual,w.compare=function(t){if(e(t)||(t=c(t)),this.eq(t))return 0;var n=this.isNegative(),r=t.isNegative();return n&&!r?-1:!n&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},w.comp=w.compare,w.negate=function(){return!this.unsigned&&this.eq(x)?x:this.not().add(_)},w.neg=w.negate,w.add=function(t){e(t)||(t=c(t));var n=this.high>>>16,r=65535&this.high,i=this.low>>>16,s=65535&this.low,a=t.high>>>16,l=65535&t.high,u=t.low>>>16,h=0,p=0,d=0,f=0;return d+=(f+=s+(65535&t.low))>>>16,p+=(d+=i+u)>>>16,h+=(p+=r+l)>>>16,h+=n+a,o((d&=65535)<<16|(f&=65535),(h&=65535)<<16|(p&=65535),this.unsigned)},w.subtract=function(t){return e(t)||(t=c(t)),this.add(t.neg())},w.sub=w.subtract,w.multiply=function(t){if(this.isZero())return f;if(e(t)||(t=c(t)),t.isZero())return f;if(this.eq(x))return t.isOdd()?x:f;if(t.eq(x))return this.isOdd()?x:f;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(d)&&t.lt(d))return s(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,r=65535&this.high,i=this.low>>>16,a=65535&this.low,l=t.high>>>16,u=65535&t.high,h=t.low>>>16,p=65535&t.low,m=0,_=0,g=0,y=0;return g+=(y+=a*p)>>>16,_+=(g+=i*p)>>>16,g&=65535,_+=(g+=a*h)>>>16,m+=(_+=r*p)>>>16,_&=65535,m+=(_+=i*h)>>>16,_&=65535,m+=(_+=a*u)>>>16,m+=n*p+r*h+i*u+a*l,o((g&=65535)<<16|(y&=65535),(m&=65535)<<16|(_&=65535),this.unsigned)},w.mul=w.multiply,w.divide=function(t){if(e(t)||(t=c(t)),t.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?m:f;var n,r,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return m;if(t.gt(this.shru(1)))return g;i=m}else{if(this.eq(x))return t.eq(_)||t.eq(y)?x:t.eq(x)?_:(n=this.shr(1).div(t).shl(1)).eq(f)?t.isNegative()?_:y:(r=this.sub(t.mul(n)),i=n.add(r.div(t)));if(t.eq(x))return this.unsigned?m:f;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=f}for(r=this;r.gte(t);){n=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),l=o<=48?1:a(2,o-48),u=s(n),h=u.mul(t);h.isNegative()||h.gt(r);)h=(u=s(n-=l,this.unsigned)).mul(t);u.isZero()&&(u=_),i=i.add(u),r=r.sub(h)}return i},w.div=w.divide,w.modulo=function(t){return e(t)||(t=c(t)),this.sub(this.div(t).mul(t))},w.mod=w.modulo,w.not=function(){return o(~this.low,~this.high,this.unsigned)},w.and=function(t){return e(t)||(t=c(t)),o(this.low&t.low,this.high&t.high,this.unsigned)},w.or=function(t){return e(t)||(t=c(t)),o(this.low|t.low,this.high|t.high,this.unsigned)},w.xor=function(t){return e(t)||(t=c(t)),o(this.low^t.low,this.high^t.high,this.unsigned)},w.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?o(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):o(0,this.low<<t-32,this.unsigned)},w.shl=w.shiftLeft,w.shiftRight=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?o(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):o(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},w.shr=w.shiftRight,w.shiftRightUnsigned=function(t){if(e(t)&&(t=t.toInt()),0==(t&=63))return this;var n=this.high;return t<32?o(this.low>>>t|n<<32-t,n>>>t,this.unsigned):o(32===t?n:n>>>t-32,0,this.unsigned)},w.shru=w.shiftRightUnsigned,w.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},w.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},w.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},w.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24&255,255&t,t>>>8&255,t>>>16&255,t>>>24&255]},w.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e]},t})?n.apply(e,[]):n)||(t.exports=r)},166:(t,e,n)=>{var r=n(690),i=n(561),s=n(809),o=[0,2,3],a=[2,1,3];t.exports=function(t,e){t&&(i(t)||s(t))||(e=t||{},t=null);for(var n="string"==typeof(e="number"==typeof e?{count:e}:e||{}).type?e.type:"uint16",l="number"==typeof e.count?e.count:1,c=e.start||0,u=!1!==e.clockwise?o:a,h=u[0],p=u[1],d=u[2],f=6*l,m=t||new(r(n))(f),_=0,g=0;_<f;_+=6,g+=4){var y=_+c;m[y+0]=g+0,m[y+1]=g+1,m[y+2]=g+2,m[y+3]=g+h,m[y+4]=g+p,m[y+5]=g+d}return m}},573:(t,e,n)=>{var r=n(412),i=n(190),s=n(87),o=n(166),a=n(991),l=n(47),c=r.BufferGeometry;function u(t){c.call(this),"string"==typeof t&&(t={text:t}),this._opt=Object.assign({},t),t&&this.update(t)}t.exports=function(t){return new u(t)},s(u,c),u.prototype.update=function(t){if("string"==typeof t&&(t={text:t}),!(t=Object.assign({},this._opt,t)).font)throw new TypeError("must specify a { font } in options");this.layout=i(t);var e=!1!==t.flipY,n=t.font,s=n.common.scaleW,l=n.common.scaleH,c=this.layout.glyphs.filter((function(t){var e=t.data;return e.width*e.height>0}));this.visibleGlyphs=c;var u=a.positions(c),h=a.uvs(c,s,l,e),p=o([],{clockwise:!0,type:"uint16",count:c.length});if(this.setIndex(p),this.setAttribute("position",new r.BufferAttribute(u,2)),this.setAttribute("uv",new r.BufferAttribute(h,2)),!t.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(t.multipage){var d=a.pages(c);this.setAttribute("page",new r.BufferAttribute(d,1))}},u.prototype.computeBoundingSphere=function(){null===this.boundingSphere&&(this.boundingSphere=new r.Sphere);var t=this.attributes.position.array,e=this.attributes.position.itemSize;if(!t||!e||t.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);l.computeSphere(t,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')},u.prototype.computeBoundingBox=function(){null===this.boundingBox&&(this.boundingBox=new r.Box3);var t=this.boundingBox,e=this.attributes.position.array,n=this.attributes.position.itemSize;!e||!n||e.length<2?t.makeEmpty():l.computeBox(e,t)}},47:t=>{var e={min:[0,0],max:[0,0]};function n(t){var n=t.length/2;e.min[0]=t[0],e.min[1]=t[1],e.max[0]=t[0],e.max[1]=t[1];for(var r=0;r<n;r++){var i=t[2*r+0],s=t[2*r+1];e.min[0]=Math.min(i,e.min[0]),e.min[1]=Math.min(s,e.min[1]),e.max[0]=Math.max(i,e.max[0]),e.max[1]=Math.max(s,e.max[1])}}t.exports.computeBox=function(t,r){n(t),r.min.set(e.min[0],e.min[1],0),r.max.set(e.max[0],e.max[1],0)},t.exports.computeSphere=function(t,r){n(t);var i=e.min[0],s=e.min[1],o=e.max[0]-i,a=e.max[1]-s,l=Math.sqrt(o*o+a*a);r.center.set(i+o/2,s+a/2,0),r.radius=l/2}},991:t=>{t.exports.pages=function(t){var e=new Float32Array(4*t.length*1),n=0;return t.forEach((function(t){var r=t.data.page||0;e[n++]=r,e[n++]=r,e[n++]=r,e[n++]=r})),e},t.exports.uvs=function(t,e,n,r){var i=new Float32Array(4*t.length*2),s=0;return t.forEach((function(t){var o=t.data,a=o.x+o.width,l=o.y+o.height,c=o.x/e,u=o.y/n,h=a/e,p=l/n;r&&(u=(n-o.y)/n,p=(n-l)/n),i[s++]=c,i[s++]=u,i[s++]=c,i[s++]=p,i[s++]=h,i[s++]=p,i[s++]=h,i[s++]=u})),i},t.exports.positions=function(t){var e=new Float32Array(4*t.length*2),n=0;return t.forEach((function(t){var r=t.data,i=t.position[0]+r.xoffset,s=t.position[1]+r.yoffset,o=r.width,a=r.height;e[n++]=i,e[n++]=s,e[n++]=i,e[n++]=s+a,e[n++]=i+o,e[n++]=s+a,e[n++]=i+o,e[n++]=s})),e}},412:(t,e,n)=>{"use strict";n.r(e),n.d(e,{ACESFilmicToneMapping:()=>nt,AddEquation:()=>T,AddOperation:()=>Z,AdditiveAnimationBlendMode:()=>We,AdditiveBlending:()=>x,AlphaFormat:()=>Ot,AlwaysDepth:()=>j,AlwaysStencilFunc:()=>Mn,AmbientLight:()=>Mh,AmbientLightProbe:()=>qh,AnimationClip:()=>Lu,AnimationLoader:()=>Du,AnimationMixer:()=>Tp,AnimationObjectGroup:()=>Sp,AnimationUtils:()=>yu,ArcCurve:()=>qu,ArrayCamera:()=>Fa,ArrowHelper:()=>fd,Audio:()=>rp,AudioAnalyser:()=>cp,AudioContext:()=>Hh,AudioListener:()=>np,AudioLoader:()=>Vh,AxesHelper:()=>md,AxisHelper:()=>uf,BackSide:()=>m,BasicDepthPacking:()=>sn,BasicShadowMap:()=>u,BinaryTextureLoader:()=>mf,Bone:()=>yl,BooleanKeyframeTrack:()=>Mu,BoundingBoxHelper:()=>hf,Box2:()=>Pp,Box3:()=>Fr,Box3Helper:()=>cd,BoxBufferGeometry:()=>ms,BoxGeometry:()=>fs,BoxHelper:()=>ld,BufferAttribute:()=>Si,BufferGeometry:()=>ji,BufferGeometryLoader:()=>Rh,ByteType:()=>Tt,Cache:()=>Nu,Camera:()=>ws,CameraHelper:()=>sd,CanvasRenderer:()=>yf,CanvasTexture:()=>Hl,CatmullRomCurve3:()=>Ku,CineonToneMapping:()=>et,CircleBufferGeometry:()=>su,CircleGeometry:()=>iu,ClampToEdgeWrapping:()=>pt,Clock:()=>Zh,ClosedSplineCurve3:()=>af,Color:()=>di,ColorKeyframeTrack:()=>Tu,CompressedTexture:()=>Gl,CompressedTextureLoader:()=>Uu,ConeBufferGeometry:()=>ru,ConeGeometry:()=>nu,CubeCamera:()=>Es,CubeGeometry:()=>fs,CubeReflectionMapping:()=>st,CubeRefractionMapping:()=>ot,CubeTexture:()=>Qs,CubeTextureLoader:()=>Gu,CubeUVReflectionMapping:()=>ct,CubeUVRefractionMapping:()=>ut,CubicBezierCurve:()=>rh,CubicBezierCurve3:()=>ih,CubicInterpolant:()=>bu,CullFaceBack:()=>a,CullFaceFront:()=>l,CullFaceFrontBack:()=>c,CullFaceNone:()=>o,Curve:()=>Vu,CurvePath:()=>hh,CustomBlending:()=>M,CustomToneMapping:()=>rt,CylinderBufferGeometry:()=>eu,CylinderGeometry:()=>tu,Cylindrical:()=>Rp,DataTexture:()=>$s,DataTexture2DArray:()=>Ks,DataTexture3D:()=>to,DataTextureLoader:()=>zu,DecrementStencilOp:()=>dn,DecrementWrapStencilOp:()=>mn,DefaultLoadingManager:()=>Iu,DepthFormat:()=>jt,DepthStencilFormat:()=>Gt,DepthTexture:()=>Vl,DirectionalLight:()=>Sh,DirectionalLightHelper:()=>nd,DirectionalLightShadow:()=>wh,DiscreteInterpolant:()=>wu,DodecahedronBufferGeometry:()=>ic,DodecahedronGeometry:()=>rc,DoubleSide:()=>_,DstAlphaFactor:()=>O,DstColorFactor:()=>k,DynamicBufferAttribute:()=>Jd,DynamicCopyUsage:()=>Rn,DynamicDrawUsage:()=>En,DynamicReadUsage:()=>Cn,EdgesGeometry:()=>Kc,EdgesHelper:()=>pf,EllipseCurve:()=>Wu,EqualDepth:()=>V,EqualStencilFunc:()=>vn,EquirectangularReflectionMapping:()=>at,EquirectangularRefractionMapping:()=>lt,Euler:()=>ar,EventDispatcher:()=>Pn,ExtrudeBufferGeometry:()=>Dc,ExtrudeGeometry:()=>kc,Face3:()=>gi,Face4:()=>Id,FaceColors:()=>Dd,FileLoader:()=>ku,FlatShading:()=>g,Float32Attribute:()=>sf,Float32BufferAttribute:()=>Li,Float64Attribute:()=>of,Float64BufferAttribute:()=>Ri,FloatType:()=>Bt,Fog:()=>Va,FogExp2:()=>Ha,Font:()=>Uh,FontLoader:()=>jh,FrontSide:()=>f,Frustum:()=>Ls,GammaEncoding:()=>Qe,Geometry:()=>ds,GeometryUtils:()=>gf,GreaterDepth:()=>q,GreaterEqualDepth:()=>W,GreaterEqualStencilFunc:()=>Sn,GreaterStencilFunc:()=>xn,GridHelper:()=>Zp,Group:()=>ka,HalfFloatType:()=>Lt,HemisphereLight:()=>mh,HemisphereLightHelper:()=>Jp,HemisphereLightProbe:()=>Wh,IcosahedronBufferGeometry:()=>nc,IcosahedronGeometry:()=>ec,ImageBitmapLoader:()=>kh,ImageLoader:()=>ju,ImageUtils:()=>zn,ImmediateRenderObject:()=>kp,IncrementStencilOp:()=>pn,IncrementWrapStencilOp:()=>fn,InstancedBufferAttribute:()=>Lh,InstancedBufferGeometry:()=>Bh,InstancedInterleavedBuffer:()=>Ap,InstancedMesh:()=>Sl,Int16Attribute:()=>tf,Int16BufferAttribute:()=>Ai,Int32Attribute:()=>nf,Int32BufferAttribute:()=>Ci,Int8Attribute:()=>Zd,Int8BufferAttribute:()=>Mi,IntType:()=>$t,InterleavedBuffer:()=>Wa,InterleavedBufferAttribute:()=>Xa,Interpolant:()=>vu,InterpolateDiscrete:()=>De,InterpolateLinear:()=>Ue,InterpolateSmooth:()=>ze,InvertStencilOp:()=>_n,JSONLoader:()=>vf,KeepStencilOp:()=>un,KeyframeTrack:()=>Su,LOD:()=>dl,LatheBufferGeometry:()=>Yc,LatheGeometry:()=>Xc,Layers:()=>lr,LensFlare:()=>xf,LessDepth:()=>G,LessEqualDepth:()=>H,LessEqualStencilFunc:()=>bn,LessStencilFunc:()=>yn,Light:()=>fh,LightProbe:()=>Ah,LightShadow:()=>_h,Line:()=>Bl,Line3:()=>Fp,LineBasicMaterial:()=>Ml,LineCurve:()=>sh,LineCurve3:()=>oh,LineDashedMaterial:()=>_u,LineLoop:()=>Pl,LinePieces:()=>Fd,LineSegments:()=>Nl,LineStrip:()=>Od,LinearEncoding:()=>Je,LinearFilter:()=>vt,LinearInterpolant:()=>xu,LinearMipMapLinearFilter:()=>St,LinearMipMapNearestFilter:()=>xt,LinearMipmapLinearFilter:()=>wt,LinearMipmapNearestFilter:()=>bt,LinearToneMapping:()=>K,Loader:()=>Ou,LoaderUtils:()=>Ch,LoadingManager:()=>Pu,LogLuvEncoding:()=>tn,LoopOnce:()=>Oe,LoopPingPong:()=>ke,LoopRepeat:()=>Fe,LuminanceAlphaFormat:()=>Ut,LuminanceFormat:()=>Dt,MOUSE:()=>i,Material:()=>vi,MaterialLoader:()=>$h,Math:()=>Fn,MathUtils:()=>Fn,Matrix3:()=>Dn,Matrix4:()=>ir,MaxEquation:()=>C,Mesh:()=>os,MeshBasicMaterial:()=>bi,MeshDepthMaterial:()=>Ca,MeshDistanceMaterial:()=>Ba,MeshFaceMaterial:()=>zd,MeshLambertMaterial:()=>fu,MeshMatcapMaterial:()=>mu,MeshNormalMaterial:()=>du,MeshPhongMaterial:()=>hu,MeshPhysicalMaterial:()=>uu,MeshStandardMaterial:()=>cu,MeshToonMaterial:()=>pu,MinEquation:()=>$,MirroredRepeatWrapping:()=>dt,MixOperation:()=>J,MultiMaterial:()=>jd,MultiplyBlending:()=>S,MultiplyOperation:()=>Y,NearestFilter:()=>ft,NearestMipMapLinearFilter:()=>yt,NearestMipMapNearestFilter:()=>_t,NearestMipmapLinearFilter:()=>gt,NearestMipmapNearestFilter:()=>mt,NeverDepth:()=>z,NeverStencilFunc:()=>gn,NoBlending:()=>v,NoColors:()=>kd,NoToneMapping:()=>Q,NormalAnimationBlendMode:()=>Ve,NormalBlending:()=>b,NotEqualDepth:()=>X,NotEqualStencilFunc:()=>wn,NumberKeyframeTrack:()=>Eu,Object3D:()=>wr,ObjectLoader:()=>Ph,ObjectSpaceNormalMap:()=>ln,OctahedronBufferGeometry:()=>tc,OctahedronGeometry:()=>Kl,OneFactor:()=>L,OneMinusDstAlphaFactor:()=>F,OneMinusDstColorFactor:()=>D,OneMinusSrcAlphaFactor:()=>I,OneMinusSrcColorFactor:()=>N,OrthographicCamera:()=>xh,PCFShadowMap:()=>h,PCFSoftShadowMap:()=>p,PMREMGenerator:()=>Cd,ParametricBufferGeometry:()=>Xl,ParametricGeometry:()=>ql,Particle:()=>Hd,ParticleBasicMaterial:()=>qd,ParticleSystem:()=>Vd,ParticleSystemMaterial:()=>Xd,Path:()=>ph,PerspectiveCamera:()=>Ss,Plane:()=>Qr,PlaneBufferGeometry:()=>Os,PlaneGeometry:()=>Is,PlaneHelper:()=>ud,PointCloud:()=>Gd,PointCloudMaterial:()=>Wd,PointLight:()=>bh,PointLightHelper:()=>Wp,Points:()=>Ul,PointsMaterial:()=>Il,PolarGridHelper:()=>Qp,PolyhedronBufferGeometry:()=>Jl,PolyhedronGeometry:()=>Yl,PositionalAudio:()=>lp,PropertyBinding:()=>wp,PropertyMixer:()=>up,QuadraticBezierCurve:()=>ah,QuadraticBezierCurve3:()=>lh,Quaternion:()=>qn,QuaternionKeyframeTrack:()=>$u,QuaternionLinearInterpolant:()=>Au,REVISION:()=>r,RGBADepthPacking:()=>on,RGBAFormat:()=>kt,RGBAIntegerFormat:()=>Yt,RGBA_ASTC_10x10_Format:()=>ye,RGBA_ASTC_10x5_Format:()=>me,RGBA_ASTC_10x6_Format:()=>_e,RGBA_ASTC_10x8_Format:()=>ge,RGBA_ASTC_12x10_Format:()=>ve,RGBA_ASTC_12x12_Format:()=>be,RGBA_ASTC_4x4_Format:()=>ae,RGBA_ASTC_5x4_Format:()=>le,RGBA_ASTC_5x5_Format:()=>ce,RGBA_ASTC_6x5_Format:()=>ue,RGBA_ASTC_6x6_Format:()=>he,RGBA_ASTC_8x5_Format:()=>pe,RGBA_ASTC_8x6_Format:()=>de,RGBA_ASTC_8x8_Format:()=>fe,RGBA_BPTC_Format:()=>xe,RGBA_ETC2_EAC_Format:()=>oe,RGBA_PVRTC_2BPPV1_Format:()=>re,RGBA_PVRTC_4BPPV1_Format:()=>ne,RGBA_S3TC_DXT1_Format:()=>Zt,RGBA_S3TC_DXT3_Format:()=>Qt,RGBA_S3TC_DXT5_Format:()=>Kt,RGBDEncoding:()=>rn,RGBEEncoding:()=>Ke,RGBEFormat:()=>zt,RGBFormat:()=>Ft,RGBIntegerFormat:()=>Xt,RGBM16Encoding:()=>nn,RGBM7Encoding:()=>en,RGB_ETC1_Format:()=>ie,RGB_ETC2_Format:()=>se,RGB_PVRTC_2BPPV1_Format:()=>ee,RGB_PVRTC_4BPPV1_Format:()=>te,RGB_S3TC_DXT1_Format:()=>Jt,RGFormat:()=>Wt,RGIntegerFormat:()=>qt,RawShaderMaterial:()=>lu,Ray:()=>Xr,Raycaster:()=>$p,RectAreaLight:()=>Th,RedFormat:()=>Ht,RedIntegerFormat:()=>Vt,ReinhardToneMapping:()=>tt,RepeatWrapping:()=>ht,ReplaceStencilOp:()=>hn,ReverseSubtractEquation:()=>A,RingBufferGeometry:()=>qc,RingGeometry:()=>Wc,SRGB8_ALPHA8_ASTC_10x10_Format:()=>Ne,SRGB8_ALPHA8_ASTC_10x5_Format:()=>Be,SRGB8_ALPHA8_ASTC_10x6_Format:()=>Le,SRGB8_ALPHA8_ASTC_10x8_Format:()=>Re,SRGB8_ALPHA8_ASTC_12x10_Format:()=>Pe,SRGB8_ALPHA8_ASTC_12x12_Format:()=>Ie,SRGB8_ALPHA8_ASTC_4x4_Format:()=>we,SRGB8_ALPHA8_ASTC_5x4_Format:()=>Se,SRGB8_ALPHA8_ASTC_5x5_Format:()=>Me,SRGB8_ALPHA8_ASTC_6x5_Format:()=>Te,SRGB8_ALPHA8_ASTC_6x6_Format:()=>Ee,SRGB8_ALPHA8_ASTC_8x5_Format:()=>Ae,SRGB8_ALPHA8_ASTC_8x6_Format:()=>$e,SRGB8_ALPHA8_ASTC_8x8_Format:()=>Ce,Scene:()=>Sr,SceneUtils:()=>bf,ShaderChunk:()=>Fs,ShaderLib:()=>ks,ShaderMaterial:()=>xs,ShadowMaterial:()=>au,Shape:()=>dh,ShapeBufferGeometry:()=>Zc,ShapeGeometry:()=>Jc,ShapePath:()=>Dh,ShapeUtils:()=>Ic,ShortType:()=>Et,Skeleton:()=>gl,SkeletonHelper:()=>Vp,SkinnedMesh:()=>fl,SmoothShading:()=>y,Sphere:()=>Ur,SphereBufferGeometry:()=>Vc,SphereGeometry:()=>Hc,Spherical:()=>Lp,SphericalHarmonics3:()=>Eh,Spline:()=>cf,SplineCurve:()=>ch,SplineCurve3:()=>lf,SpotLight:()=>yh,SpotLightHelper:()=>Up,SpotLightShadow:()=>gh,Sprite:()=>cl,SpriteMaterial:()=>Ya,SrcAlphaFactor:()=>P,SrcAlphaSaturateFactor:()=>U,SrcColorFactor:()=>R,StaticCopyUsage:()=>Ln,StaticDrawUsage:()=>Tn,StaticReadUsage:()=>$n,StereoCamera:()=>Jh,StreamCopyUsage:()=>Nn,StreamDrawUsage:()=>An,StreamReadUsage:()=>Bn,StringKeyframeTrack:()=>Cu,SubtractEquation:()=>E,SubtractiveBlending:()=>w,TOUCH:()=>s,TangentSpaceNormalMap:()=>an,TetrahedronBufferGeometry:()=>Ql,TetrahedronGeometry:()=>Zl,TextBufferGeometry:()=>Gc,TextGeometry:()=>jc,Texture:()=>Gn,TextureLoader:()=>Hu,TorusBufferGeometry:()=>uc,TorusGeometry:()=>cc,TorusKnotBufferGeometry:()=>lc,TorusKnotGeometry:()=>ac,Triangle:()=>ci,TriangleFanDrawMode:()=>Ye,TriangleStripDrawMode:()=>Xe,TrianglesDrawMode:()=>qe,TubeBufferGeometry:()=>oc,TubeGeometry:()=>sc,UVMapping:()=>it,Uint16Attribute:()=>ef,Uint16BufferAttribute:()=>$i,Uint32Attribute:()=>rf,Uint32BufferAttribute:()=>Bi,Uint8Attribute:()=>Qd,Uint8BufferAttribute:()=>Ti,Uint8ClampedAttribute:()=>Kd,Uint8ClampedBufferAttribute:()=>Ei,Uniform:()=>Ep,UniformsLib:()=>Rs,UniformsUtils:()=>ys,UnsignedByteType:()=>Mt,UnsignedInt248Type:()=>It,UnsignedIntType:()=>Ct,UnsignedShort4444Type:()=>Rt,UnsignedShort5551Type:()=>Nt,UnsignedShort565Type:()=>Pt,UnsignedShortType:()=>At,VSMShadowMap:()=>d,Vector2:()=>kn,Vector3:()=>Jn,Vector4:()=>Hn,VectorKeyframeTrack:()=>Bu,Vertex:()=>Yd,VertexColors:()=>Ud,VideoTexture:()=>jl,WebGL1Renderer:()=>Ga,WebGLCubeRenderTarget:()=>As,WebGLMultisampleRenderTarget:()=>Wn,WebGLRenderTarget:()=>Vn,WebGLRenderTargetCube:()=>_f,WebGLRenderer:()=>ja,WebGLUtils:()=>Oa,WireframeGeometry:()=>Wl,WireframeHelper:()=>df,WrapAroundEnding:()=>He,XHRLoader:()=>ff,ZeroCurvatureEnding:()=>je,ZeroFactor:()=>B,ZeroSlopeEnding:()=>Ge,ZeroStencilOp:()=>cn,sRGBEncoding:()=>Ze}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");const e=Object(t);for(let t=1;t<arguments.length;t++){const n=arguments[t];if(null!=n)for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e});const r="119",i={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=0,a=1,l=2,c=3,u=0,h=1,p=2,d=3,f=0,m=1,_=2,g=1,y=2,v=0,b=1,x=2,w=3,S=4,M=5,T=100,E=101,A=102,$=103,C=104,B=200,L=201,R=202,N=203,P=204,I=205,O=206,F=207,k=208,D=209,U=210,z=0,j=1,G=2,H=3,V=4,W=5,q=6,X=7,Y=0,J=1,Z=2,Q=0,K=1,tt=2,et=3,nt=4,rt=5,it=300,st=301,ot=302,at=303,lt=304,ct=306,ut=307,ht=1e3,pt=1001,dt=1002,ft=1003,mt=1004,_t=1004,gt=1005,yt=1005,vt=1006,bt=1007,xt=1007,wt=1008,St=1008,Mt=1009,Tt=1010,Et=1011,At=1012,$t=1013,Ct=1014,Bt=1015,Lt=1016,Rt=1017,Nt=1018,Pt=1019,It=1020,Ot=1021,Ft=1022,kt=1023,Dt=1024,Ut=1025,zt=kt,jt=1026,Gt=1027,Ht=1028,Vt=1029,Wt=1030,qt=1031,Xt=1032,Yt=1033,Jt=33776,Zt=33777,Qt=33778,Kt=33779,te=35840,ee=35841,ne=35842,re=35843,ie=36196,se=37492,oe=37496,ae=37808,le=37809,ce=37810,ue=37811,he=37812,pe=37813,de=37814,fe=37815,me=37816,_e=37817,ge=37818,ye=37819,ve=37820,be=37821,xe=36492,we=37840,Se=37841,Me=37842,Te=37843,Ee=37844,Ae=37845,$e=37846,Ce=37847,Be=37848,Le=37849,Re=37850,Ne=37851,Pe=37852,Ie=37853,Oe=2200,Fe=2201,ke=2202,De=2300,Ue=2301,ze=2302,je=2400,Ge=2401,He=2402,Ve=2500,We=2501,qe=0,Xe=1,Ye=2,Je=3e3,Ze=3001,Qe=3007,Ke=3002,tn=3003,en=3004,nn=3005,rn=3006,sn=3200,on=3201,an=0,ln=1,cn=0,un=7680,hn=7681,pn=7682,dn=7683,fn=34055,mn=34056,_n=5386,gn=512,yn=513,vn=514,bn=515,xn=516,wn=517,Sn=518,Mn=519,Tn=35044,En=35048,An=35040,$n=35045,Cn=35049,Bn=35041,Ln=35046,Rn=35050,Nn=35042;function Pn(){}Object.assign(Pn.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}},dispatchEvent:function(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,r=n.length;e<r;e++)n[e].call(this,t)}}});const In=[];for(let t=0;t<256;t++)In[t]=(t<16?"0":"")+t.toString(16);let On=1234567;const Fn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(In[255&t]+In[t>>8&255]+In[t>>16&255]+In[t>>24&255]+"-"+In[255&e]+In[e>>8&255]+"-"+In[e>>16&15|64]+In[e>>24&255]+"-"+In[63&n|128]+In[n>>8&255]+"-"+In[n>>16&255]+In[n>>24&255]+In[255&r]+In[r>>8&255]+In[r>>16&255]+In[r>>24&255]).toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(On=t%2147483647),On=16807*On%2147483647,(On-1)/2147483646},degToRad:function(t){return t*Fn.DEG2RAD},radToDeg:function(t){return t*Fn.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){const s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),c=s((e+r)/2),u=o((e+r)/2),h=s((e-r)/2),p=o((e-r)/2),d=s((r-e)/2),f=o((r-e)/2);switch(i){case"XYX":t.set(a*u,l*h,l*p,a*c);break;case"YZY":t.set(l*p,a*u,l*h,a*c);break;case"ZXZ":t.set(l*h,l*p,a*u,a*c);break;case"XZX":t.set(a*u,l*f,l*d,a*c);break;case"YXY":t.set(l*d,a*u,l*f,a*c);break;case"ZYZ":t.set(l*f,l*d,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}};function kn(t=0,e=0){this.x=t,this.y=e}function Dn(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}let Un;Object.defineProperties(kn.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(kn.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){const n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y,this},random:function(){return this.x=Math.random(),this.y=Math.random(),this}}),Object.assign(Dn.prototype,{isMatrix3:!0,set:function(t,e,n,r,i,s,o,a,l){const c=this.elements;return c[0]=t,c[1]=r,c[2]=o,c[3]=e,c[4]=i,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},extractBasis:function(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],p=n[5],d=n[8],f=r[0],m=r[3],_=r[6],g=r[1],y=r[4],v=r[7],b=r[2],x=r[5],w=r[8];return i[0]=s*f+o*g+a*b,i[3]=s*m+o*y+a*x,i[6]=s*_+o*v+a*w,i[1]=l*f+c*g+u*b,i[4]=l*m+c*y+u*x,i[7]=l*_+c*v+u*w,i[2]=h*f+p*g+d*b,i[5]=h*m+p*y+d*x,i[8]=h*_+p*v+d*w,this},multiplyScalar:function(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-n*i*c+n*o*a+r*i*l-r*s*a},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");const n=t.elements,r=this.elements,i=n[0],s=n[1],o=n[2],a=n[3],l=n[4],c=n[5],u=n[6],h=n[7],p=n[8],d=p*l-c*h,f=c*u-p*a,m=h*a-l*u,_=i*d+s*f+o*m;if(0===_)return this.set(0,0,0,0,0,0,0,0,0);const g=1/_;return r[0]=d*g,r[1]=(o*h-p*s)*g,r[2]=(c*s-o*l)*g,r[3]=f*g,r[4]=(p*i-o*u)*g,r[5]=(o*a-c*i)*g,r[6]=m*g,r[7]=(s*u-h*i)*g,r[8]=(l*i-s*a)*g,this},transpose:function(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,n,r,i,s,o){const a=Math.cos(i),l=Math.sin(i);this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-r*l,r*a,-r*(-l*s+a*o)+o+e,0,0,1)},scale:function(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},rotate:function(t){const e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],s=r[3],o=r[6],a=r[1],l=r[4],c=r[7];return r[0]=e*i+n*a,r[3]=e*s+n*l,r[6]=e*o+n*c,r[1]=-n*i+e*a,r[4]=-n*s+e*l,r[7]=-n*o+e*c,this},translate:function(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},equals:function(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}});const zn={getDataURL:function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Un&&(Un=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Un.width=t.width,Un.height=t.height;const n=Un.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Un}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}};let jn=0;function Gn(t,e,n,r,i,s,o,a,l,c){Object.defineProperty(this,"id",{value:jn++}),this.uuid=Fn.generateUUID(),this.name="",this.image=void 0!==t?t:Gn.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:Gn.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:pt,this.wrapT=void 0!==r?r:pt,this.magFilter=void 0!==i?i:vt,this.minFilter=void 0!==s?s:wt,this.anisotropy=void 0!==l?l:1,this.format=void 0!==o?o:kt,this.internalFormat=null,this.type=void 0!==a?a:Mt,this.offset=new kn(0,0),this.repeat=new kn(1,1),this.center=new kn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Dn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:Je,this.version=0,this.onUpdate=null}function Hn(t=0,e=0,n=0,r=1){this.x=t,this.y=e,this.z=n,this.w=r}function Vn(t,e,n){this.width=t,this.height=e,this.scissor=new Hn(0,0,t,e),this.scissorTest=!1,this.viewport=new Hn(0,0,t,e),n=n||{},this.texture=new Gn(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:vt,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function Wn(t,e,n){Vn.call(this,t,e,n),this.samples=4}function qn(t=0,e=0,n=0,r=1){this._x=t,this._y=e,this._z=n,this._w=r}Gn.DEFAULT_IMAGE=void 0,Gn.DEFAULT_MAPPING=it,Gn.prototype=Object.assign(Object.create(Pn.prototype),{constructor:Gn,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=Fn.generateUUID()),!e&&void 0===t.images[r.uuid]){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)e.push(zn.getDataURL(r[t]))}else e=zn.getDataURL(r);t.images[r.uuid]={uuid:r.uuid,url:e}}n.image=r.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping!==it)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case ht:t.x=t.x-Math.floor(t.x);break;case pt:t.x=t.x<0?0:1;break;case dt:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case ht:t.y=t.y-Math.floor(t.y);break;case pt:t.y=t.y<0?0:1;break;case dt:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Gn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.defineProperties(Hn.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(Hn.prototype,{isVector4:!0,set:function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){const e=this.x,n=this.y,r=this.z,i=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*e+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*e+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*e+s[7]*n+s[11]*r+s[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){let e,n,r,i;const s=.01,o=.1,a=t.elements,l=a[0],c=a[4],u=a[8],h=a[1],p=a[5],d=a[9],f=a[2],m=a[6],_=a[10];if(Math.abs(c-h)<s&&Math.abs(u-f)<s&&Math.abs(d-m)<s){if(Math.abs(c+h)<o&&Math.abs(u+f)<o&&Math.abs(d+m)<o&&Math.abs(l+p+_-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(p+1)/2,g=(_+1)/2,y=(c+h)/4,v=(u+f)/4,b=(d+m)/4;return t>a&&t>g?t<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=y/n,i=v/n):a>g?a<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=y/r,i=b/r):g<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(g),n=v/i,r=b/i),this.set(n,r,i,e),this}let g=Math.sqrt((m-d)*(m-d)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(g)<.001&&(g=1),this.x=(m-d)/g,this.y=(u-f)/g,this.z=(h-c)/g,this.w=Math.acos((l+p+_-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},clampLength:function(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}),Vn.prototype=Object.assign(Object.create(Pn.prototype),{constructor:Vn,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Wn.prototype=Object.assign(Object.create(Vn.prototype),{constructor:Wn,isWebGLMultisampleRenderTarget:!0,copy:function(t){return Vn.prototype.copy.call(this,t),this.samples=t.samples,this}}),Object.assign(qn,{slerp:function(t,e,n,r){return n.copy(t).slerp(e,r)},slerpFlat:function(t,e,n,r,i,s,o){let a=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const h=i[s+0],p=i[s+1],d=i[s+2],f=i[s+3];if(u!==f||a!==h||l!==p||c!==d){let t=1-o,e=a*h+l*p+c*d+u*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){const i=Math.sqrt(r),s=Math.atan2(i,e*n);t=Math.sin(t*s)/i,o=Math.sin(o*s)/i}const i=o*n;if(a=a*t+h*i,l=l*t+p*i,c=c*t+d*i,u=u*t+f*i,t===1-o){const t=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=t,l*=t,c*=t,u*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=u},multiplyQuaternionsFlat:function(t,e,n,r,i,s){const o=n[r],a=n[r+1],l=n[r+2],c=n[r+3],u=i[s],h=i[s+1],p=i[s+2],d=i[s+3];return t[e]=o*d+c*u+a*p-l*h,t[e+1]=a*d+c*h+l*u-o*p,t[e+2]=l*d+c*p+o*h-a*u,t[e+3]=c*d-o*u-a*h-l*p,t}}),Object.defineProperties(qn.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(qn.prototype,{isQuaternion:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,r=t._y,i=t._z,s=t.order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),h=a(n/2),p=a(r/2),d=a(i/2);switch(s){case"XYZ":this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d;break;case"YXZ":this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d;break;case"ZXY":this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d;break;case"ZYX":this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d;break;case"YZX":this._x=h*c*u+l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u-h*p*d;break;case"XZY":this._x=h*c*u-l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u+h*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(t){const e=t.elements,n=e[0],r=e[4],i=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],u=e[10],h=n+o+u;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(c-a)*t,this._y=(i-l)*t,this._z=(s-r)*t}else if(n>o&&n>u){const t=2*Math.sqrt(1+n-o-u);this._w=(c-a)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(i+l)/t}else if(o>u){const t=2*Math.sqrt(1+o-n-u);this._w=(i-l)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(a+c)/t}else{const t=2*Math.sqrt(1+u-n-o);this._w=(s-r)/t,this._x=(i+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this},setFromUnitVectors:function(t,e){let n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(Fn.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){const n=this.angleTo(t);if(0===n)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this},identity:function(){return this.set(0,0,0,1)},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){const n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=n*c+s*o+r*l-i*a,this._y=r*c+s*a+i*o-n*l,this._z=i*c+s*l+n*a-r*o,this._w=s*c-n*o-r*a-i*l,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,r=this._y,i=this._z,s=this._w;let o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},fromBufferAttribute:function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});const Xn=new Jn,Yn=new qn;function Jn(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}Object.assign(Jn.prototype,{isVector3:!0,set:function(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Yn.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(Yn.setFromAxisAngle(t,e))},applyMatrix3:function(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){const e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this},applyQuaternion:function(t){const e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*r-o*n,c=a*n+o*e-i*r,u=a*r+i*n-s*e,h=-i*e-s*n-o*r;return this.x=l*a+h*-i+c*-o-u*-s,this.y=c*a+h*-s+u*-i-l*-o,this.z=u*a+h*-o+l*-s-c*-i,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){const n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this},projectOnVector:function(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)},projectOnPlane:function(t){return Xn.copy(this).projectOnVector(t),this.sub(Xn)},reflect:function(t){return this.sub(Xn.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Fn.clamp(n,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},setFromMatrix3Column:function(t,e){return this.fromArray(t.elements,3*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}});const Zn=new Jn,Qn=new ir,Kn=new Jn(0,0,0),tr=new Jn(1,1,1),er=new Jn,nr=new Jn,rr=new Jn;function ir(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(ir.prototype,{isMatrix4:!0,set:function(t,e,n,r,i,s,o,a,l,c,u,h,p,d,f,m){const _=this.elements;return _[0]=t,_[4]=e,_[8]=n,_[12]=r,_[1]=i,_[5]=s,_[9]=o,_[13]=a,_[2]=l,_[6]=c,_[10]=u,_[14]=h,_[3]=p,_[7]=d,_[11]=f,_[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new ir).fromArray(this.elements)},copy:function(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},copyPosition:function(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},extractBasis:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},extractRotation:function(t){const e=this.elements,n=t.elements,r=1/Zn.setFromMatrixColumn(t,0).length(),i=1/Zn.setFromMatrixColumn(t,1).length(),s=1/Zn.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,r=t.y,i=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){const t=s*c,n=s*u,r=o*c,i=o*u;e[0]=a*c,e[4]=-a*u,e[8]=l,e[1]=n+r*l,e[5]=t-i*l,e[9]=-o*a,e[2]=i-t*l,e[6]=r+n*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*c,n=a*u,r=l*c,i=l*u;e[0]=t+i*o,e[4]=r*o-n,e[8]=s*l,e[1]=s*u,e[5]=s*c,e[9]=-o,e[2]=n*o-r,e[6]=i+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*c,n=a*u,r=l*c,i=l*u;e[0]=t-i*o,e[4]=-s*u,e[8]=r+n*o,e[1]=n+r*o,e[5]=s*c,e[9]=i-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*c,n=s*u,r=o*c,i=o*u;e[0]=a*c,e[4]=r*l-n,e[8]=t*l+i,e[1]=a*u,e[5]=i*l+t,e[9]=n*l-r,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*c,e[4]=i-t*u,e[8]=r*u+n,e[1]=u,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=n*u+r,e[10]=t-i*u}else if("XZY"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*c,e[4]=-u,e[8]=l*c,e[1]=t*u+i,e[5]=s*c,e[9]=n*u-r,e[2]=r*u-n,e[6]=o*c,e[10]=i*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(Kn,t,tr)},lookAt:function(t,e,n){const r=this.elements;return rr.subVectors(t,e),0===rr.lengthSq()&&(rr.z=1),rr.normalize(),er.crossVectors(n,rr),0===er.lengthSq()&&(1===Math.abs(n.z)?rr.x+=1e-4:rr.z+=1e-4,rr.normalize(),er.crossVectors(n,rr)),er.normalize(),nr.crossVectors(rr,er),r[0]=er.x,r[4]=nr.x,r[8]=rr.x,r[1]=er.y,r[5]=nr.y,r[9]=rr.y,r[2]=er.z,r[6]=nr.z,r[10]=rr.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],p=n[13],d=n[2],f=n[6],m=n[10],_=n[14],g=n[3],y=n[7],v=n[11],b=n[15],x=r[0],w=r[4],S=r[8],M=r[12],T=r[1],E=r[5],A=r[9],$=r[13],C=r[2],B=r[6],L=r[10],R=r[14],N=r[3],P=r[7],I=r[11],O=r[15];return i[0]=s*x+o*T+a*C+l*N,i[4]=s*w+o*E+a*B+l*P,i[8]=s*S+o*A+a*L+l*I,i[12]=s*M+o*$+a*R+l*O,i[1]=c*x+u*T+h*C+p*N,i[5]=c*w+u*E+h*B+p*P,i[9]=c*S+u*A+h*L+p*I,i[13]=c*M+u*$+h*R+p*O,i[2]=d*x+f*T+m*C+_*N,i[6]=d*w+f*E+m*B+_*P,i[10]=d*S+f*A+m*L+_*I,i[14]=d*M+f*$+m*R+_*O,i[3]=g*x+y*T+v*C+b*N,i[7]=g*w+y*E+v*B+b*P,i[11]=g*S+y*A+v*L+b*I,i[15]=g*M+y*$+v*R+b*O,this},multiplyScalar:function(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},determinant:function(){const t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],u=t[6],h=t[10],p=t[14];return t[3]*(+i*a*u-r*l*u-i*o*h+n*l*h+r*o*p-n*a*p)+t[7]*(+e*a*p-e*l*h+i*s*h-r*s*p+r*l*c-i*a*c)+t[11]*(+e*l*u-e*o*p-i*s*u+n*s*p+i*o*c-n*l*c)+t[15]*(-r*o*c-e*a*u+e*o*h+r*s*u-n*s*h+n*a*c)},transpose:function(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");const n=this.elements,r=t.elements,i=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],h=r[7],p=r[8],d=r[9],f=r[10],m=r[11],_=r[12],g=r[13],y=r[14],v=r[15],b=d*y*h-g*f*h+g*u*m-c*y*m-d*u*v+c*f*v,x=_*f*h-p*y*h-_*u*m+l*y*m+p*u*v-l*f*v,w=p*g*h-_*d*h+_*c*m-l*g*m-p*c*v+l*d*v,S=_*d*u-p*g*u-_*c*f+l*g*f+p*c*y-l*d*y,M=i*b+s*x+o*w+a*S;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/M;return n[0]=b*T,n[1]=(g*f*a-d*y*a-g*o*m+s*y*m+d*o*v-s*f*v)*T,n[2]=(c*y*a-g*u*a+g*o*h-s*y*h-c*o*v+s*u*v)*T,n[3]=(d*u*a-c*f*a-d*o*h+s*f*h+c*o*m-s*u*m)*T,n[4]=x*T,n[5]=(p*y*a-_*f*a+_*o*m-i*y*m-p*o*v+i*f*v)*T,n[6]=(_*u*a-l*y*a-_*o*h+i*y*h+l*o*v-i*u*v)*T,n[7]=(l*f*a-p*u*a+p*o*h-i*f*h-l*o*m+i*u*m)*T,n[8]=w*T,n[9]=(_*d*a-p*g*a-_*s*m+i*g*m+p*s*v-i*d*v)*T,n[10]=(l*g*a-_*c*a+_*s*h-i*g*h-l*s*v+i*c*v)*T,n[11]=(p*c*a-l*d*a-p*s*h+i*d*h+l*s*m-i*c*m)*T,n[12]=S*T,n[13]=(p*g*o-_*d*o+_*s*f-i*g*f-p*s*y+i*d*y)*T,n[14]=(_*c*o-l*g*o-_*s*u+i*g*u+l*s*y-i*c*y)*T,n[15]=(l*d*o-p*c*o+p*s*u-i*d*u-l*s*f+i*c*f)*T,this},scale:function(t){const e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this},getMaxScaleOnAxis:function(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},makeRotationY:function(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},makeRotationZ:function(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){const n=Math.cos(e),r=Math.sin(e),i=1-n,s=t.x,o=t.y,a=t.z,l=i*s,c=i*o;return this.set(l*s+n,l*o-r*a,l*a+r*o,0,l*o+r*a,c*o+n,c*a-r*s,0,l*a-r*o,c*a+r*s,i*a*a+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,n){const r=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,l=i+i,c=s+s,u=o+o,h=i*l,p=i*c,d=i*u,f=s*c,m=s*u,_=o*u,g=a*l,y=a*c,v=a*u,b=n.x,x=n.y,w=n.z;return r[0]=(1-(f+_))*b,r[1]=(p+v)*b,r[2]=(d-y)*b,r[3]=0,r[4]=(p-v)*x,r[5]=(1-(h+_))*x,r[6]=(m+g)*x,r[7]=0,r[8]=(d+y)*w,r[9]=(m-g)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},decompose:function(t,e,n){const r=this.elements;let i=Zn.set(r[0],r[1],r[2]).length(),s=Zn.set(r[4],r[5],r[6]).length(),o=Zn.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],Qn.copy(this);const a=1/i,l=1/s,c=1/o;return Qn.elements[0]*=a,Qn.elements[1]*=a,Qn.elements[2]*=a,Qn.elements[4]*=l,Qn.elements[5]*=l,Qn.elements[6]*=l,Qn.elements[8]*=c,Qn.elements[9]*=c,Qn.elements[10]*=c,e.setFromRotationMatrix(Qn),n.x=i,n.y=s,n.z=o,this},makePerspective:function(t,e,n,r,i,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*i/(e-t),l=2*i/(n-r),c=(e+t)/(e-t),u=(n+r)/(n-r),h=-(s+i)/(s-i),p=-2*s*i/(s-i);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(t,e,n,r,i,s){const o=this.elements,a=1/(e-t),l=1/(n-r),c=1/(s-i),u=(e+t)*a,h=(n+r)*l,p=(s+i)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}});const sr=new ir,or=new qn;function ar(t=0,e=0,n=0,r=ar.DefaultOrder){this._x=t,this._y=e,this._z=n,this._order=r}function lr(){this.mask=1}ar.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],ar.DefaultOrder="XYZ",Object.defineProperties(ar.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(ar.prototype,{isEuler:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,n){const r=Fn.clamp,i=t.elements,s=i[0],o=i[4],a=i[8],l=i[1],c=i[5],u=i[9],h=i[2],p=i[6],d=i[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(p,c),this._z=0);break;case"YXZ":this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(r(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(p,d),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(p,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,n){return sr.makeRotationFromQuaternion(t),this.setFromRotationMatrix(sr,e,n)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return or.setFromEuler(this),this.setFromQuaternion(or,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new Jn(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(lr.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}});let cr=0;const ur=new Jn,hr=new qn,pr=new ir,dr=new Jn,fr=new Jn,mr=new Jn,_r=new qn,gr=new Jn(1,0,0),yr=new Jn(0,1,0),vr=new Jn(0,0,1),br={type:"added"},xr={type:"removed"};function wr(){Object.defineProperty(this,"id",{value:cr++}),this.uuid=Fn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=wr.DefaultUp.clone();const t=new Jn,e=new ar,n=new qn,r=new Jn(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new ir},normalMatrix:{value:new Dn}}),this.matrix=new ir,this.matrixWorld=new ir,this.matrixAutoUpdate=wr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new lr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Sr(){wr.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}wr.DefaultUp=new Jn(0,1,0),wr.DefaultMatrixAutoUpdate=!0,wr.prototype=Object.assign(Object.create(Pn.prototype),{constructor:wr,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return hr.setFromAxisAngle(t,e),this.quaternion.multiply(hr),this},rotateOnWorldAxis:function(t,e){return hr.setFromAxisAngle(t,e),this.quaternion.premultiply(hr),this},rotateX:function(t){return this.rotateOnAxis(gr,t)},rotateY:function(t){return this.rotateOnAxis(yr,t)},rotateZ:function(t){return this.rotateOnAxis(vr,t)},translateOnAxis:function(t,e){return ur.copy(t).applyQuaternion(this.quaternion),this.position.add(ur.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(gr,t)},translateY:function(t){return this.translateOnAxis(yr,t)},translateZ:function(t){return this.translateOnAxis(vr,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(pr.getInverse(this.matrixWorld))},lookAt:function(t,e,n){t.isVector3?dr.copy(t):dr.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),fr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?pr.lookAt(fr,dr,this.up):pr.lookAt(dr,fr,this.up),this.quaternion.setFromRotationMatrix(pr),r&&(pr.extractRotation(r.matrixWorld),hr.setFromRotationMatrix(pr),this.quaternion.premultiply(hr.inverse()))},add:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(br)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(xr)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),pr.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),pr.multiply(t.parent.matrixWorld)),t.applyMatrix4(pr),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Jn),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new qn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(fr,t,mr),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Jn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(fr,_r,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Jn),this.updateMatrixWorld(!0);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)},traverseAncestors:function(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}},toJSON:function(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){const r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(e){const e=s(t.geometries),r=s(t.materials),i=s(t.textures),o=s(t.images),a=s(t.shapes);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a)}return n.object=r,n;function s(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}),Sr.prototype=Object.assign(Object.create(wr.prototype),{constructor:Sr,isScene:!0,copy:function(t,e){return wr.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){const e=wr.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e},dispose:function(){this.dispatchEvent({type:"dispose"})}});const Mr=[new Jn,new Jn,new Jn,new Jn,new Jn,new Jn,new Jn,new Jn],Tr=new Jn,Er=new Fr,Ar=new Jn,$r=new Jn,Cr=new Jn,Br=new Jn,Lr=new Jn,Rr=new Jn,Nr=new Jn,Pr=new Jn,Ir=new Jn,Or=new Jn;function Fr(t,e){this.min=void 0!==t?t:new Jn(1/0,1/0,1/0),this.max=void 0!==e?e:new Jn(-1/0,-1/0,-1/0)}function kr(t,e,n,r,i){for(let s=0,o=t.length-3;s<=o;s+=3){Or.fromArray(t,s);const o=i.x*Math.abs(Or.x)+i.y*Math.abs(Or.y)+i.z*Math.abs(Or.z),a=e.dot(Or),l=n.dot(Or),c=r.dot(Or);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}Object.assign(Fr.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){let e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.length;a<l;a+=3){const l=t[a],c=t[a+1],u=t[a+2];l<e&&(e=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(e,n,r),this.max.set(i,s,o),this},setFromBufferAttribute:function(t){let e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.count;a<l;a++){const l=t.getX(a),c=t.getY(a),u=t.getZ(a);l<e&&(e=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(e,n,r),this.max.set(i,s,o),this},setFromPoints:function(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){const n=Tr.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Jn),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Jn),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),Er.copy(e.boundingBox),Er.applyMatrix4(t.matrixWorld),this.union(Er));const n=t.children;for(let t=0,e=n.length;t<e;t++)this.expandByObject(n[t]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Jn),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,Tr),Tr.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant},intersectsTriangle:function(t){if(this.isEmpty())return!1;this.getCenter(Nr),Pr.subVectors(this.max,Nr),Ar.subVectors(t.a,Nr),$r.subVectors(t.b,Nr),Cr.subVectors(t.c,Nr),Br.subVectors($r,Ar),Lr.subVectors(Cr,$r),Rr.subVectors(Ar,Cr);let e=[0,-Br.z,Br.y,0,-Lr.z,Lr.y,0,-Rr.z,Rr.y,Br.z,0,-Br.x,Lr.z,0,-Lr.x,Rr.z,0,-Rr.x,-Br.y,Br.x,0,-Lr.y,Lr.x,0,-Rr.y,Rr.x,0];return!!kr(e,Ar,$r,Cr,Pr)&&(e=[1,0,0,0,1,0,0,0,1],!!kr(e,Ar,$r,Cr,Pr)&&(Ir.crossVectors(Br,Lr),e=[Ir.x,Ir.y,Ir.z],kr(e,Ar,$r,Cr,Pr)))},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Jn),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return Tr.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(Tr).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||(Mr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Mr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Mr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Mr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Mr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Mr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Mr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Mr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Mr)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});const Dr=new Fr;function Ur(t,e){this.center=void 0!==t?t:new Jn,this.radius=void 0!==e?e:-1}Object.assign(Ur.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(t,e){const n=this.center;void 0!==e?n.copy(e):Dr.setFromPoints(t).getCenter(n);let r=0;for(let e=0,i=t.length;e<i;e++)r=Math.max(r,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},isEmpty:function(){return this.radius<0},makeEmpty:function(){return this.center.set(0,0,0),this.radius=-1,this},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){const n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Jn),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Fr),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});const zr=new Jn,jr=new Jn,Gr=new Jn,Hr=new Jn,Vr=new Jn,Wr=new Jn,qr=new Jn;function Xr(t,e){this.origin=void 0!==t?t:new Jn,this.direction=void 0!==e?e:new Jn(0,0,-1)}Object.assign(Xr.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Jn),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,zr)),this},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Jn),e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){const e=zr.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(zr.copy(this.direction).multiplyScalar(e).add(this.origin),zr.distanceToSquared(t))},distanceSqToSegment:function(t,e,n,r){jr.copy(t).add(e).multiplyScalar(.5),Gr.copy(e).sub(t).normalize(),Hr.copy(this.origin).sub(jr);const i=.5*t.distanceTo(e),s=-this.direction.dot(Gr),o=Hr.dot(this.direction),a=-Hr.dot(Gr),l=Hr.lengthSq(),c=Math.abs(1-s*s);let u,h,p,d;if(c>0)if(u=s*a-o,h=s*o-a,d=i*c,u>=0)if(h>=-d)if(h<=d){const t=1/c;u*=t,h*=t,p=u*(u+s*h+2*o)+h*(s*u+h+2*a)+l}else h=i,u=Math.max(0,-(s*h+o)),p=-u*u+h*(h+2*a)+l;else h=-i,u=Math.max(0,-(s*h+o)),p=-u*u+h*(h+2*a)+l;else h<=-d?(u=Math.max(0,-(-s*i+o)),h=u>0?-i:Math.min(Math.max(-i,-a),i),p=-u*u+h*(h+2*a)+l):h<=d?(u=0,h=Math.min(Math.max(-i,-a),i),p=h*(h+2*a)+l):(u=Math.max(0,-(s*i+o)),h=u>0?i:Math.min(Math.max(-i,-a),i),p=-u*u+h*(h+2*a)+l);else h=s>0?-i:i,u=Math.max(0,-(s*h+o)),p=-u*u+h*(h+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(Gr).multiplyScalar(h).add(jr),p},intersectSphere:function(t,e){zr.subVectors(t.center,this.origin);const n=zr.dot(this.direction),r=zr.dot(zr)-n*n,i=t.radius*t.radius;if(r>i)return null;const s=Math.sqrt(i-r),o=n-s,a=n+s;return o<0&&a<0?null:o<0?this.at(a,e):this.at(o,e)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null},intersectPlane:function(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)},intersectsPlane:function(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){let n,r,i,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(t.min.x-h.x)*l,r=(t.max.x-h.x)*l):(n=(t.max.x-h.x)*l,r=(t.min.x-h.x)*l),c>=0?(i=(t.min.y-h.y)*c,s=(t.max.y-h.y)*c):(i=(t.max.y-h.y)*c,s=(t.min.y-h.y)*c),n>s||i>r?null:((i>n||n!=n)&&(n=i),(s<r||r!=r)&&(r=s),u>=0?(o=(t.min.z-h.z)*u,a=(t.max.z-h.z)*u):(o=(t.max.z-h.z)*u,a=(t.min.z-h.z)*u),n>a||o>r?null:((o>n||n!=n)&&(n=o),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,e)))},intersectsBox:function(t){return null!==this.intersectBox(t,zr)},intersectTriangle:function(t,e,n,r,i){Vr.subVectors(e,t),Wr.subVectors(n,t),qr.crossVectors(Vr,Wr);let s,o=this.direction.dot(qr);if(o>0){if(r)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Hr.subVectors(this.origin,t);const a=s*this.direction.dot(Wr.crossVectors(Hr,Wr));if(a<0)return null;const l=s*this.direction.dot(Vr.cross(Hr));if(l<0)return null;if(a+l>o)return null;const c=-s*Hr.dot(qr);return c<0?null:this.at(c/o,i)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});const Yr=new Jn,Jr=new Jn,Zr=new Dn;function Qr(t,e){this.normal=void 0!==t?t:new Jn(1,0,0),this.constant=void 0!==e?e:0}Object.assign(Qr.prototype,{isPlane:!0,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,n){const r=Yr.subVectors(n,e).cross(Jr.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Jn),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new Jn);const n=t.delta(Yr),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):void 0;const i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:e.copy(n).multiplyScalar(i).add(t.start)},intersectsLine:function(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Jn),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,e){const n=e||Zr.getNormalMatrix(t),r=this.coplanarPoint(Yr).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});const Kr=new Jn,ti=new Jn,ei=new Jn,ni=new Jn,ri=new Jn,ii=new Jn,si=new Jn,oi=new Jn,ai=new Jn,li=new Jn;function ci(t,e,n){this.a=void 0!==t?t:new Jn,this.b=void 0!==e?e:new Jn,this.c=void 0!==n?n:new Jn}Object.assign(ci,{getNormal:function(t,e,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new Jn),r.subVectors(n,e),Kr.subVectors(t,e),r.cross(Kr);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)},getBarycoord:function(t,e,n,r,i){Kr.subVectors(r,e),ti.subVectors(n,e),ei.subVectors(t,e);const s=Kr.dot(Kr),o=Kr.dot(ti),a=Kr.dot(ei),l=ti.dot(ti),c=ti.dot(ei),u=s*l-o*o;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new Jn),0===u)return i.set(-2,-1,-1);const h=1/u,p=(l*a-o*c)*h,d=(s*c-o*a)*h;return i.set(1-p-d,d,p)},containsPoint:function(t,e,n,r){return ci.getBarycoord(t,e,n,r,ni),ni.x>=0&&ni.y>=0&&ni.x+ni.y<=1},getUV:function(t,e,n,r,i,s,o,a){return this.getBarycoord(t,e,n,r,ni),a.set(0,0),a.addScaledVector(i,ni.x),a.addScaledVector(s,ni.y),a.addScaledVector(o,ni.z),a},isFrontFacing:function(t,e,n,r){return Kr.subVectors(n,e),ti.subVectors(t,e),Kr.cross(ti).dot(r)<0}}),Object.assign(ci.prototype,{set:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},setFromPointsAndIndices:function(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return Kr.subVectors(this.c,this.b),ti.subVectors(this.a,this.b),.5*Kr.cross(ti).length()},getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Jn),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return ci.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Qr),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return ci.getBarycoord(t,this.a,this.b,this.c,e)},getUV:function(t,e,n,r,i){return ci.getUV(t,this.a,this.b,this.c,e,n,r,i)},containsPoint:function(t){return ci.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return ci.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Jn);const n=this.a,r=this.b,i=this.c;let s,o;ri.subVectors(r,n),ii.subVectors(i,n),oi.subVectors(t,n);const a=ri.dot(oi),l=ii.dot(oi);if(a<=0&&l<=0)return e.copy(n);ai.subVectors(t,r);const c=ri.dot(ai),u=ii.dot(ai);if(c>=0&&u<=c)return e.copy(r);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return s=a/(a-c),e.copy(n).addScaledVector(ri,s);li.subVectors(t,i);const p=ri.dot(li),d=ii.dot(li);if(d>=0&&p<=d)return e.copy(i);const f=p*l-a*d;if(f<=0&&l>=0&&d<=0)return o=l/(l-d),e.copy(n).addScaledVector(ii,o);const m=c*d-p*u;if(m<=0&&u-c>=0&&p-d>=0)return si.subVectors(i,r),o=(u-c)/(u-c+(p-d)),e.copy(r).addScaledVector(si,o);const _=1/(m+f+h);return s=f*_,o=h*_,e.copy(n).addScaledVector(ri,s).addScaledVector(ii,o)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});const ui={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},hi={h:0,s:0,l:0},pi={h:0,s:0,l:0};function di(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}function fi(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function mi(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function _i(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}function gi(t,e,n,r,i,s){this.a=t,this.b=e,this.c=n,this.normal=r&&r.isVector3?r:new Jn,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new di,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==s?s:0}Object.assign(di.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,n){return this.r=t,this.g=e,this.b=n,this},setHSL:function(t,e,n){if(t=Fn.euclideanModulo(t,1),e=Fn.clamp(e,0,1),n=Fn.clamp(n,0,1),0===e)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=fi(i,r,t+1/3),this.g=fi(i,r,t),this.b=fi(i,r,t-1/3)}return this},setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){let t;const r=n[1],i=n[2];switch(r){case"rgb":case"rgba":if(t=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[5]),this;if(t=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[5]),this;break;case"hsl":case"hsla":if(t=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i)){const n=parseFloat(t[1])/360,r=parseInt(t[2],10)/100,i=parseInt(t[3],10)/100;return e(t[5]),this.setHSL(n,r,i)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(t)){const t=n[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this},setColorName:function(t){const e=ui[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);const n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=mi(t.r),this.g=mi(t.g),this.b=mi(t.b),this},copyLinearToSRGB:function(t){return this.r=_i(t.r),this.g=_i(t.g),this.b=_i(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const e=this.r,n=this.g,r=this.b,i=Math.max(e,n,r),s=Math.min(e,n,r);let o,a;const l=(s+i)/2;if(s===i)o=0,a=0;else{const t=i-s;switch(a=l<=.5?t/(i+s):t/(2-i-s),i){case e:o=(n-r)/t+(n<r?6:0);break;case n:o=(r-e)/t+2;break;case r:o=(e-n)/t+4}o/=6}return t.h=o,t.s=a,t.l=l,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,n){return this.getHSL(hi),hi.h+=t,hi.s+=e,hi.l+=n,this.setHSL(hi.h,hi.s,hi.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:function(t,e){this.getHSL(hi),t.getHSL(pi);const n=Fn.lerp(hi.h,pi.h,e),r=Fn.lerp(hi.s,pi.s,e),i=Fn.lerp(hi.l,pi.l,e);return this.setHSL(n,r,i),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},fromBufferAttribute:function(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this},toJSON:function(){return this.getHex()}}),di.NAMES=ui,Object.assign(gi.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(let e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});let yi=0;function vi(){Object.defineProperty(this,"id",{value:yi++}),this.uuid=Fn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=b,this.side=f,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=P,this.blendDst=I,this.blendEquation=T,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=H,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Mn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=un,this.stencilZFail=un,this.stencilZPass=un,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function bi(t){vi.call(this),this.type="MeshBasicMaterial",this.color=new di(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}vi.prototype=Object.assign(Object.create(Pn.prototype),{constructor:vi,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===g;continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}},toJSON:function(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==b&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==f&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(vi.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),bi.prototype=Object.create(vi.prototype),bi.prototype.constructor=bi,bi.prototype.isMeshBasicMaterial=!0,bi.prototype.copy=function(t){return vi.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};const xi=new Jn,wi=new kn;function Si(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=Tn,this.updateRange={offset:0,count:-1},this.version=0}function Mi(t,e,n){Si.call(this,new Int8Array(t),e,n)}function Ti(t,e,n){Si.call(this,new Uint8Array(t),e,n)}function Ei(t,e,n){Si.call(this,new Uint8ClampedArray(t),e,n)}function Ai(t,e,n){Si.call(this,new Int16Array(t),e,n)}function $i(t,e,n){Si.call(this,new Uint16Array(t),e,n)}function Ci(t,e,n){Si.call(this,new Int32Array(t),e,n)}function Bi(t,e,n){Si.call(this,new Uint32Array(t),e,n)}function Li(t,e,n){Si.call(this,new Float32Array(t),e,n)}function Ri(t,e,n){Si.call(this,new Float64Array(t),e,n)}function Ni(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Pi(t){if(0===t.length)return-1/0;let e=t[0];for(let n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}Object.defineProperty(Si.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Si.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new di),e[n++]=i.r,e[n++]=i.g,e[n++]=i.b}return this},copyVector2sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new kn),e[n++]=i.x,e[n++]=i.y}return this},copyVector3sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new Jn),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z}return this},copyVector4sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new Hn),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z,e[n++]=i.w}return this},applyMatrix3:function(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)wi.fromBufferAttribute(this,e),wi.applyMatrix3(t),this.setXY(e,wi.x,wi.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)xi.fromBufferAttribute(this,e),xi.applyMatrix3(t),this.setXYZ(e,xi.x,xi.y,xi.z);return this},applyMatrix4:function(t){for(let e=0,n=this.count;e<n;e++)xi.x=this.getX(e),xi.y=this.getY(e),xi.z=this.getZ(e),xi.applyMatrix4(t),this.setXYZ(e,xi.x,xi.y,xi.z);return this},applyNormalMatrix:function(t){for(let e=0,n=this.count;e<n;e++)xi.x=this.getX(e),xi.y=this.getY(e),xi.z=this.getZ(e),xi.applyNormalMatrix(t),this.setXYZ(e,xi.x,xi.y,xi.z);return this},transformDirection:function(t){for(let e=0,n=this.count;e<n;e++)xi.x=this.getX(e),xi.y=this.getY(e),xi.z=this.getZ(e),xi.transformDirection(t),this.setXYZ(e,xi.x,xi.y,xi.z);return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Mi.prototype=Object.create(Si.prototype),Mi.prototype.constructor=Mi,Ti.prototype=Object.create(Si.prototype),Ti.prototype.constructor=Ti,Ei.prototype=Object.create(Si.prototype),Ei.prototype.constructor=Ei,Ai.prototype=Object.create(Si.prototype),Ai.prototype.constructor=Ai,$i.prototype=Object.create(Si.prototype),$i.prototype.constructor=$i,Ci.prototype=Object.create(Si.prototype),Ci.prototype.constructor=Ci,Bi.prototype=Object.create(Si.prototype),Bi.prototype.constructor=Bi,Li.prototype=Object.create(Si.prototype),Li.prototype.constructor=Li,Ri.prototype=Object.create(Si.prototype),Ri.prototype.constructor=Ri,Object.assign(Ni.prototype,{computeGroups:function(t){const e=[];let n,r,i;const s=t.faces;for(r=0;r<s.length;r++){const t=s[r];t.materialIndex!==i&&(i=t.materialIndex,void 0!==n&&(n.count=3*r-n.start,e.push(n)),n={start:3*r,materialIndex:i})}void 0!==n&&(n.count=3*r-n.start,e.push(n)),this.groups=e},fromGeometry:function(t){const e=t.faces,n=t.vertices,r=t.faceVertexUvs,i=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,o=t.morphTargets,a=o.length;let l;if(a>0){l=[];for(let t=0;t<a;t++)l[t]={name:o[t].name,data:[]};this.morphTargets.position=l}const c=t.morphNormals,u=c.length;let h;if(u>0){h=[];for(let t=0;t<u;t++)h[t]={name:c[t].name,data:[]};this.morphTargets.normal=h}const p=t.skinIndices,d=t.skinWeights,f=p.length===n.length,m=d.length===n.length;n.length>0&&0===e.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let t=0;t<e.length;t++){const _=e[t];this.vertices.push(n[_.a],n[_.b],n[_.c]);const g=_.vertexNormals;if(3===g.length)this.normals.push(g[0],g[1],g[2]);else{const t=_.normal;this.normals.push(t,t,t)}const y=_.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{const t=_.color;this.colors.push(t,t,t)}if(!0===i){const e=r[0][t];void 0!==e?this.uvs.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",t),this.uvs.push(new kn,new kn,new kn))}if(!0===s){const e=r[1][t];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",t),this.uvs2.push(new kn,new kn,new kn))}for(let t=0;t<a;t++){const e=o[t].vertices;l[t].data.push(e[_.a],e[_.b],e[_.c])}for(let e=0;e<u;e++){const n=c[e].vertexNormals[t];h[e].data.push(n.a,n.b,n.c)}f&&this.skinIndices.push(p[_.a],p[_.b],p[_.c]),m&&this.skinWeights.push(d[_.a],d[_.b],d[_.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});let Ii=1;const Oi=new ir,Fi=new wr,ki=new Jn,Di=new Fr,Ui=new Fr,zi=new Jn;function ji(){Object.defineProperty(this,"id",{value:Ii+=2}),this.uuid=Fn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}ji.prototype=Object.assign(Object.create(Pn.prototype),{constructor:ji,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(Pi(t)>65535?Bi:$i)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,n){this.groups.push({start:t,count:e,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new Dn).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return Oi.makeRotationX(t),this.applyMatrix4(Oi),this},rotateY:function(t){return Oi.makeRotationY(t),this.applyMatrix4(Oi),this},rotateZ:function(t){return Oi.makeRotationZ(t),this.applyMatrix4(Oi),this},translate:function(t,e,n){return Oi.makeTranslation(t,e,n),this.applyMatrix4(Oi),this},scale:function(t,e,n){return Oi.makeScale(t,e,n),this.applyMatrix4(Oi),this},lookAt:function(t){return Fi.lookAt(t),Fi.updateMatrix(),this.applyMatrix4(Fi.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ki).negate(),this.translate(ki.x,ki.y,ki.z),this},setFromObject:function(t){const e=t.geometry;if(t.isPoints||t.isLine){const t=new Li(3*e.vertices.length,3),n=new Li(3*e.colors.length,3);if(this.setAttribute("position",t.copyVector3sArray(e.vertices)),this.setAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){const t=new Li(e.lineDistances.length,1);this.setAttribute("lineDistance",t.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Li(e,3)),this},updateFromObject:function(t){let e=t.geometry;if(t.isMesh){let t=e.__directGeometry;if(!0===e.elementsNeedUpdate&&(t=void 0,e.elementsNeedUpdate=!1),void 0===t)return this.fromGeometry(e);t.verticesNeedUpdate=e.verticesNeedUpdate,t.normalsNeedUpdate=e.normalsNeedUpdate,t.colorsNeedUpdate=e.colorsNeedUpdate,t.uvsNeedUpdate=e.uvsNeedUpdate,t.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=t}if(!0===e.verticesNeedUpdate){const t=this.attributes.position;void 0!==t&&(t.copyVector3sArray(e.vertices),t.needsUpdate=!0),e.verticesNeedUpdate=!1}if(!0===e.normalsNeedUpdate){const t=this.attributes.normal;void 0!==t&&(t.copyVector3sArray(e.normals),t.needsUpdate=!0),e.normalsNeedUpdate=!1}if(!0===e.colorsNeedUpdate){const t=this.attributes.color;void 0!==t&&(t.copyColorsArray(e.colors),t.needsUpdate=!0),e.colorsNeedUpdate=!1}if(e.uvsNeedUpdate){const t=this.attributes.uv;void 0!==t&&(t.copyVector2sArray(e.uvs),t.needsUpdate=!0),e.uvsNeedUpdate=!1}if(e.lineDistancesNeedUpdate){const t=this.attributes.lineDistance;void 0!==t&&(t.copyArray(e.lineDistances),t.needsUpdate=!0),e.lineDistancesNeedUpdate=!1}return e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new Ni).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){const e=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new Si(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){const e=new Float32Array(3*t.normals.length);this.setAttribute("normal",new Si(e,3).copyVector3sArray(t.normals))}if(t.colors.length>0){const e=new Float32Array(3*t.colors.length);this.setAttribute("color",new Si(e,3).copyColorsArray(t.colors))}if(t.uvs.length>0){const e=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new Si(e,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){const e=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new Si(e,2).copyVector2sArray(t.uvs2))}this.groups=t.groups;for(const e in t.morphTargets){const n=[],r=t.morphTargets[e];for(let t=0,e=r.length;t<e;t++){const e=r[t],i=new Li(3*e.data.length,3);i.name=e.name,n.push(i.copyVector3sArray(e.data))}this.morphAttributes[e]=n}if(t.skinIndices.length>0){const e=new Li(4*t.skinIndices.length,4);this.setAttribute("skinIndex",e.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){const e=new Li(4*t.skinWeights.length,4);this.setAttribute("skinWeight",e.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Fr);const t=this.attributes.position,e=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Di.setFromBufferAttribute(n),this.morphTargetsRelative?(zi.addVectors(this.boundingBox.min,Di.min),this.boundingBox.expandByPoint(zi),zi.addVectors(this.boundingBox.max,Di.max),this.boundingBox.expandByPoint(zi)):(this.boundingBox.expandByPoint(Di.min),this.boundingBox.expandByPoint(Di.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ur);const t=this.attributes.position,e=this.morphAttributes.position;if(t){const n=this.boundingSphere.center;if(Di.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Ui.setFromBufferAttribute(n),this.morphTargetsRelative?(zi.addVectors(Di.min,Ui.min),Di.expandByPoint(zi),zi.addVectors(Di.max,Ui.max),Di.expandByPoint(zi)):(Di.expandByPoint(Ui.min),Di.expandByPoint(Ui.max))}Di.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)zi.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(zi));if(e)for(let i=0,s=e.length;i<s;i++){const s=e[i],o=this.morphTargetsRelative;for(let e=0,i=s.count;e<i;e++)zi.fromBufferAttribute(s,e),o&&(ki.fromBufferAttribute(t,e),zi.add(ki)),r=Math.max(r,n.distanceToSquared(zi))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new Si(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const r=new Jn,i=new Jn,s=new Jn,o=new Jn,a=new Jn,l=new Jn,c=new Jn,u=new Jn;if(t)for(let h=0,p=t.count;h<p;h+=3){const p=t.getX(h+0),d=t.getX(h+1),f=t.getX(h+2);r.fromBufferAttribute(e,p),i.fromBufferAttribute(e,d),s.fromBufferAttribute(e,f),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),o.fromBufferAttribute(n,p),a.fromBufferAttribute(n,d),l.fromBufferAttribute(n,f),o.add(c),a.add(c),l.add(c),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===t.attributes[r])continue;const i=n[r].array,s=t.attributes[r],o=s.array,a=s.itemSize*e,l=Math.min(o.length,i.length-a);for(let t=0,e=a;t<l;t++,e++)i[e]=o[t]}return this},normalizeNormals:function(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)zi.fromBufferAttribute(t,e),zi.normalize(),t.setXYZ(e,zi.x,zi.y,zi.z)},toNonIndexed:function(){function t(t,e){const n=t.array,r=t.itemSize,i=t.normalized,s=new n.constructor(e.length*r);let o=0,a=0;for(let t=0,i=e.length;t<i;t++){o=e[t]*r;for(let t=0;t<r;t++)s[a++]=n[o++]}return new Si(s,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const e=new ji,n=this.index.array,r=this.attributes;for(const i in r){const s=t(r[i],n);e.setAttribute(i,s)}const i=this.morphAttributes;for(const r in i){const s=[],o=i[r];for(let e=0,r=o.length;e<r;e++){const r=t(o[e],n);s.push(r)}e.morphAttributes[r]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.addGroup(n.start,n.count,n.materialIndex)}return e},toJSON:function(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const r=n[e],i=r.toJSON(t.data);""!==r.name&&(i.name=r.name),t.data.attributes[e]=i}const r={};let i=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,r=n.length;e<r;e++){const r=n[e],i=r.toJSON(t.data);""!==r.name&&(i.name=r.name),s.push(i)}s.length>0&&(r[e]=s,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t},clone:function(){return(new ji).copy(this)},copy:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const r=t.attributes;for(const t in r){const n=r[t];this.setAttribute(t,n.clone(e))}const i=t.morphAttributes;for(const t in i){const n=[],r=i[t];for(let t=0,i=r.length;t<i;t++)n.push(r[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const Gi=new ir,Hi=new Xr,Vi=new Ur,Wi=new Jn,qi=new Jn,Xi=new Jn,Yi=new Jn,Ji=new Jn,Zi=new Jn,Qi=new Jn,Ki=new Jn,ts=new Jn,es=new kn,ns=new kn,rs=new kn,is=new Jn,ss=new Jn;function os(t,e){wr.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new ji,this.material=void 0!==e?e:new bi,this.updateMorphTargets()}function as(t,e,n,r,i,s,o,a){let l;if(l=e.side===m?r.intersectTriangle(o,s,i,!0,a):r.intersectTriangle(i,s,o,e.side!==_,a),null===l)return null;ss.copy(a),ss.applyMatrix4(t.matrixWorld);const c=n.ray.origin.distanceTo(ss);return c<n.near||c>n.far?null:{distance:c,point:ss.clone(),object:t}}function ls(t,e,n,r,i,s,o,a,l,c,u,h){Wi.fromBufferAttribute(i,c),qi.fromBufferAttribute(i,u),Xi.fromBufferAttribute(i,h);const p=t.morphTargetInfluences;if(e.morphTargets&&s&&p){Qi.set(0,0,0),Ki.set(0,0,0),ts.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=p[t],n=s[t];0!==e&&(Yi.fromBufferAttribute(n,c),Ji.fromBufferAttribute(n,u),Zi.fromBufferAttribute(n,h),o?(Qi.addScaledVector(Yi,e),Ki.addScaledVector(Ji,e),ts.addScaledVector(Zi,e)):(Qi.addScaledVector(Yi.sub(Wi),e),Ki.addScaledVector(Ji.sub(qi),e),ts.addScaledVector(Zi.sub(Xi),e)))}Wi.add(Qi),qi.add(Ki),Xi.add(ts)}t.isSkinnedMesh&&(t.boneTransform(c,Wi),t.boneTransform(u,qi),t.boneTransform(h,Xi));const d=as(t,e,n,r,Wi,qi,Xi,is);if(d){a&&(es.fromBufferAttribute(a,c),ns.fromBufferAttribute(a,u),rs.fromBufferAttribute(a,h),d.uv=ci.getUV(is,Wi,qi,Xi,es,ns,rs,new kn)),l&&(es.fromBufferAttribute(l,c),ns.fromBufferAttribute(l,u),rs.fromBufferAttribute(l,h),d.uv2=ci.getUV(is,Wi,qi,Xi,es,ns,rs,new kn));const t=new gi(c,u,h);ci.getNormal(Wi,qi,Xi,t.normal),d.face=t}return d}os.prototype=Object.assign(Object.create(wr.prototype),{constructor:os,isMesh:!0,copy:function(t){return wr.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Vi.copy(n.boundingSphere),Vi.applyMatrix4(i),!1===t.ray.intersectsSphere(Vi))return;if(Gi.getInverse(i),Hi.copy(t.ray).applyMatrix4(Gi),null!==n.boundingBox&&!1===Hi.intersectsBox(n.boundingBox))return;let s;if(n.isBufferGeometry){const i=n.index,o=n.attributes.position,a=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,u=n.attributes.uv2,h=n.groups,p=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,d=h.length;n<d;n++){const d=h[n],f=r[d.materialIndex];for(let n=Math.max(d.start,p.start),r=Math.min(d.start+d.count,p.start+p.count);n<r;n+=3){const r=i.getX(n),h=i.getX(n+1),p=i.getX(n+2);s=ls(this,f,t,Hi,o,a,l,c,u,r,h,p),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=d.materialIndex,e.push(s))}}else for(let n=Math.max(0,p.start),h=Math.min(i.count,p.start+p.count);n<h;n+=3){const h=i.getX(n),p=i.getX(n+1),d=i.getX(n+2);s=ls(this,r,t,Hi,o,a,l,c,u,h,p,d),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}else if(void 0!==o)if(Array.isArray(r))for(let n=0,i=h.length;n<i;n++){const i=h[n],d=r[i.materialIndex];for(let n=Math.max(i.start,p.start),r=Math.min(i.start+i.count,p.start+p.count);n<r;n+=3)s=ls(this,d,t,Hi,o,a,l,c,u,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=i.materialIndex,e.push(s))}else for(let n=Math.max(0,p.start),i=Math.min(o.count,p.start+p.count);n<i;n+=3)s=ls(this,r,t,Hi,o,a,l,c,u,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}else if(n.isGeometry){const i=Array.isArray(r),o=n.vertices,a=n.faces;let l;const c=n.faceVertexUvs[0];c.length>0&&(l=c);for(let n=0,c=a.length;n<c;n++){const c=a[n],u=i?r[c.materialIndex]:r;if(void 0===u)continue;const h=o[c.a],p=o[c.b],d=o[c.c];if(s=as(this,u,t,Hi,h,p,d,is),s){if(l&&l[n]){const t=l[n];es.copy(t[0]),ns.copy(t[1]),rs.copy(t[2]),s.uv=ci.getUV(is,h,p,d,es,ns,rs,new kn)}s.face=c,s.faceIndex=n,e.push(s)}}}}});let cs=0;const us=new ir,hs=new wr,ps=new Jn;function ds(){Object.defineProperty(this,"id",{value:cs+=2}),this.uuid=Fn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}ds.prototype=Object.assign(Object.create(Pn.prototype),{constructor:ds,isGeometry:!0,applyMatrix4:function(t){const e=(new Dn).getNormalMatrix(t);for(let e=0,n=this.vertices.length;e<n;e++)this.vertices[e].applyMatrix4(t);for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t];n.normal.applyMatrix3(e).normalize();for(let t=0,r=n.vertexNormals.length;t<r;t++)n.vertexNormals[t].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return us.makeRotationX(t),this.applyMatrix4(us),this},rotateY:function(t){return us.makeRotationY(t),this.applyMatrix4(us),this},rotateZ:function(t){return us.makeRotationZ(t),this.applyMatrix4(us),this},translate:function(t,e,n){return us.makeTranslation(t,e,n),this.applyMatrix4(us),this},scale:function(t,e,n){return us.makeScale(t,e,n),this.applyMatrix4(us),this},lookAt:function(t){return hs.lookAt(t),hs.updateMatrix(),this.applyMatrix4(hs.matrix),this},fromBufferGeometry:function(t){const e=this,n=null!==t.index?t.index:void 0,r=t.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const i=r.position,s=r.normal,o=r.color,a=r.uv,l=r.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(let t=0;t<i.count;t++)e.vertices.push((new Jn).fromBufferAttribute(i,t)),void 0!==o&&e.colors.push((new di).fromBufferAttribute(o,t));function c(t,n,r,i){const c=void 0===o?[]:[e.colors[t].clone(),e.colors[n].clone(),e.colors[r].clone()],u=new gi(t,n,r,void 0===s?[]:[(new Jn).fromBufferAttribute(s,t),(new Jn).fromBufferAttribute(s,n),(new Jn).fromBufferAttribute(s,r)],c,i);e.faces.push(u),void 0!==a&&e.faceVertexUvs[0].push([(new kn).fromBufferAttribute(a,t),(new kn).fromBufferAttribute(a,n),(new kn).fromBufferAttribute(a,r)]),void 0!==l&&e.faceVertexUvs[1].push([(new kn).fromBufferAttribute(l,t),(new kn).fromBufferAttribute(l,n),(new kn).fromBufferAttribute(l,r)])}const u=t.groups;if(u.length>0)for(let t=0;t<u.length;t++){const e=u[t],r=e.start;for(let t=r,i=r+e.count;t<i;t+=3)void 0!==n?c(n.getX(t),n.getX(t+1),n.getX(t+2),e.materialIndex):c(t,t+1,t+2,e.materialIndex)}else if(void 0!==n)for(let t=0;t<n.count;t+=3)c(n.getX(t),n.getX(t+1),n.getX(t+2));else for(let t=0;t<i.count;t+=3)c(t,t+1,t+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ps).negate(),this.translate(ps.x,ps.y,ps.z),this},normalize:function(){this.computeBoundingSphere();const t=this.boundingSphere.center,e=this.boundingSphere.radius,n=0===e?1:1/e,r=new ir;return r.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix4(r),this},computeFaceNormals:function(){const t=new Jn,e=new Jn;for(let n=0,r=this.faces.length;n<r;n++){const r=this.faces[n],i=this.vertices[r.a],s=this.vertices[r.b],o=this.vertices[r.c];t.subVectors(o,s),e.subVectors(i,s),t.cross(e),t.normalize(),r.normal.copy(t)}},computeVertexNormals:function(t){void 0===t&&(t=!0);const e=new Array(this.vertices.length);for(let t=0,n=this.vertices.length;t<n;t++)e[t]=new Jn;if(t){const t=new Jn,n=new Jn;for(let r=0,i=this.faces.length;r<i;r++){const i=this.faces[r],s=this.vertices[i.a],o=this.vertices[i.b],a=this.vertices[i.c];t.subVectors(a,o),n.subVectors(s,o),t.cross(n),e[i.a].add(t),e[i.b].add(t),e[i.c].add(t)}}else{this.computeFaceNormals();for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t];e[n.a].add(n.normal),e[n.b].add(n.normal),e[n.c].add(n.normal)}}for(let t=0,n=this.vertices.length;t<n;t++)e[t].normalize();for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t],r=n.vertexNormals;3===r.length?(r[0].copy(e[n.a]),r[1].copy(e[n.b]),r[2].copy(e[n.c])):(r[0]=e[n.a].clone(),r[1]=e[n.b].clone(),r[2]=e[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],n=e.vertexNormals;3===n.length?(n[0].copy(e.normal),n[1].copy(e.normal),n[2].copy(e.normal)):(n[0]=e.normal.clone(),n[1]=e.normal.clone(),n[2]=e.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let t=0,n=e.vertexNormals.length;t<n;t++)e.__originalVertexNormals[t]?e.__originalVertexNormals[t].copy(e.vertexNormals[t]):e.__originalVertexNormals[t]=e.vertexNormals[t].clone()}const t=new ds;t.faces=this.faces;for(let e=0,n=this.morphTargets.length;e<n;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];const t=this.morphNormals[e].faceNormals,n=this.morphNormals[e].vertexNormals;for(let e=0,r=this.faces.length;e<r;e++){const e=new Jn,r={a:new Jn,b:new Jn,c:new Jn};t.push(e),n.push(r)}}const n=this.morphNormals[e];t.vertices=this.morphTargets[e].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],r=n.faceNormals[t],i=n.vertexNormals[t];r.copy(e.normal),i.a.copy(e.vertexNormals[0]),i.b.copy(e.vertexNormals[1]),i.c.copy(e.vertexNormals[2])}}for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Fr),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ur),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if(!t||!t.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);let r,i=this.vertices.length,s=this.vertices,o=t.vertices,a=this.faces,l=t.faces,c=this.colors,u=t.colors;void 0===n&&(n=0),void 0!==e&&(r=(new Dn).getNormalMatrix(e));for(let t=0,n=o.length;t<n;t++){const n=o[t].clone();void 0!==e&&n.applyMatrix4(e),s.push(n)}for(let t=0,e=u.length;t<e;t++)c.push(u[t].clone());for(let t=0,e=l.length;t<e;t++){let e,s,o,c=l[t],u=c.vertexNormals,h=c.vertexColors;e=new gi(c.a+i,c.b+i,c.c+i),e.normal.copy(c.normal),void 0!==r&&e.normal.applyMatrix3(r).normalize();for(let t=0,n=u.length;t<n;t++)s=u[t].clone(),void 0!==r&&s.applyMatrix3(r).normalize(),e.vertexNormals.push(s);e.color.copy(c.color);for(let t=0,n=h.length;t<n;t++)o=h[t],e.vertexColors.push(o.clone());e.materialIndex=c.materialIndex+n,a.push(e)}for(let e=0,n=t.faceVertexUvs.length;e<n;e++){const n=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);for(let t=0,r=n.length;t<r;t++){const r=n[t],i=[];for(let t=0,e=r.length;t<e;t++)i.push(r[t].clone());this.faceVertexUvs[e].push(i)}}},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){const t={},e=[],n=[],r=Math.pow(10,4);for(let i=0,s=this.vertices.length;i<s;i++){const s=this.vertices[i],o=Math.round(s.x*r)+"_"+Math.round(s.y*r)+"_"+Math.round(s.z*r);void 0===t[o]?(t[o]=i,e.push(this.vertices[i]),n[i]=e.length-1):n[i]=n[t[o]]}const i=[];for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.a=n[e.a],e.b=n[e.b],e.c=n[e.c];const r=[e.a,e.b,e.c];for(let e=0;e<3;e++)if(r[e]===r[(e+1)%3]){i.push(t);break}}for(let t=i.length-1;t>=0;t--){const e=i[t];this.faces.splice(e,1);for(let t=0,n=this.faceVertexUvs.length;t<n;t++)this.faceVertexUvs[t].splice(e,1)}const s=this.vertices.length-e.length;return this.vertices=e,s},setFromPoints:function(t){this.vertices=[];for(let e=0,n=t.length;e<n;e++){const n=t[e];this.vertices.push(new Jn(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){const t=this.faces,e=t.length;for(let n=0;n<e;n++)t[n]._id=n;t.sort((function(t,e){return t.materialIndex-e.materialIndex}));const n=this.faceVertexUvs[0],r=this.faceVertexUvs[1];let i,s;n&&n.length===e&&(i=[]),r&&r.length===e&&(s=[]);for(let o=0;o<e;o++){const e=t[o]._id;i&&i.push(n[e]),s&&s.push(r[e])}i&&(this.faceVertexUvs[0]=i),s&&(this.faceVertexUvs[1]=s)},toJSON:function(){const t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}const e=[];for(let t=0;t<this.vertices.length;t++){const n=this.vertices[t];e.push(n.x,n.y,n.z)}const n=[],r=[],i={},s=[],o={},a=[],l={};for(let t=0;t<this.faces.length;t++){const e=this.faces[t],r=!0,i=!1,s=void 0!==this.faceVertexUvs[0][t],o=e.normal.length()>0,a=e.vertexNormals.length>0,l=1!==e.color.r||1!==e.color.g||1!==e.color.b,d=e.vertexColors.length>0;let f=0;if(f=c(f,0,0),f=c(f,1,r),f=c(f,2,i),f=c(f,3,s),f=c(f,4,o),f=c(f,5,a),f=c(f,6,l),f=c(f,7,d),n.push(f),n.push(e.a,e.b,e.c),n.push(e.materialIndex),s){const e=this.faceVertexUvs[0][t];n.push(p(e[0]),p(e[1]),p(e[2]))}if(o&&n.push(u(e.normal)),a){const t=e.vertexNormals;n.push(u(t[0]),u(t[1]),u(t[2]))}if(l&&n.push(h(e.color)),d){const t=e.vertexColors;n.push(h(t[0]),h(t[1]),h(t[2]))}}function c(t,e,n){return n?t|1<<e:t&~(1<<e)}function u(t){const e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==i[e]||(i[e]=r.length/3,r.push(t.x,t.y,t.z)),i[e]}function h(t){const e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==o[e]||(o[e]=s.length,s.push(t.getHex())),o[e]}function p(t){const e=t.x.toString()+t.y.toString();return void 0!==l[e]||(l[e]=a.length/2,a.push(t.x,t.y)),l[e]}return t.data={},t.data.vertices=e,t.data.normals=r,s.length>0&&(t.data.colors=s),a.length>0&&(t.data.uvs=[a]),t.data.faces=n,t},clone:function(){return(new ds).copy(this)},copy:function(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;const e=t.vertices;for(let t=0,n=e.length;t<n;t++)this.vertices.push(e[t].clone());const n=t.colors;for(let t=0,e=n.length;t<e;t++)this.colors.push(n[t].clone());const r=t.faces;for(let t=0,e=r.length;t<e;t++)this.faces.push(r[t].clone());for(let e=0,n=t.faceVertexUvs.length;e<n;e++){const n=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);for(let t=0,r=n.length;t<r;t++){const r=n[t],i=[];for(let t=0,e=r.length;t<e;t++){const e=r[t];i.push(e.clone())}this.faceVertexUvs[e].push(i)}}const i=t.morphTargets;for(let t=0,e=i.length;t<e;t++){const e={};if(e.name=i[t].name,void 0!==i[t].vertices){e.vertices=[];for(let n=0,r=i[t].vertices.length;n<r;n++)e.vertices.push(i[t].vertices[n].clone())}if(void 0!==i[t].normals){e.normals=[];for(let n=0,r=i[t].normals.length;n<r;n++)e.normals.push(i[t].normals[n].clone())}this.morphTargets.push(e)}const s=t.morphNormals;for(let t=0,e=s.length;t<e;t++){const e={};if(void 0!==s[t].vertexNormals){e.vertexNormals=[];for(let n=0,r=s[t].vertexNormals.length;n<r;n++){const r=s[t].vertexNormals[n],i={};i.a=r.a.clone(),i.b=r.b.clone(),i.c=r.c.clone(),e.vertexNormals.push(i)}}if(void 0!==s[t].faceNormals){e.faceNormals=[];for(let n=0,r=s[t].faceNormals.length;n<r;n++)e.faceNormals.push(s[t].faceNormals[n].clone())}this.morphNormals.push(e)}const o=t.skinWeights;for(let t=0,e=o.length;t<e;t++)this.skinWeights.push(o[t].clone());const a=t.skinIndices;for(let t=0,e=a.length;t<e;t++)this.skinIndices.push(a[t].clone());const l=t.lineDistances;for(let t=0,e=l.length;t<e;t++)this.lineDistances.push(l[t]);const c=t.boundingBox;null!==c&&(this.boundingBox=c.clone());const u=t.boundingSphere;return null!==u&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class fs extends ds{constructor(t,e,n,r,i,s){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:s},this.fromBufferGeometry(new ms(t,e,n,r,i,s)),this.mergeVertices()}}class ms extends ji{constructor(t=1,e=1,n=1,r=1,i=1,s=1){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:s};const o=this;r=Math.floor(r),i=Math.floor(i),s=Math.floor(s);const a=[],l=[],c=[],u=[];let h=0,p=0;function d(t,e,n,r,i,s,d,f,m,_,g){const y=s/m,v=d/_,b=s/2,x=d/2,w=f/2,S=m+1,M=_+1;let T=0,E=0;const A=new Jn;for(let s=0;s<M;s++){const o=s*v-x;for(let a=0;a<S;a++){const h=a*y-b;A[t]=h*r,A[e]=o*i,A[n]=w,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=f>0?1:-1,c.push(A.x,A.y,A.z),u.push(a/m),u.push(1-s/_),T+=1}}for(let t=0;t<_;t++)for(let e=0;e<m;e++){const n=h+e+S*t,r=h+e+S*(t+1),i=h+(e+1)+S*(t+1),s=h+(e+1)+S*t;a.push(n,r,s),a.push(r,i,s),E+=6}o.addGroup(p,E,g),p+=E,h+=T}d("z","y","x",-1,-1,n,e,t,s,i,0),d("z","y","x",1,-1,n,e,-t,s,i,1),d("x","z","y",1,1,t,n,e,r,s,2),d("x","z","y",1,-1,t,n,-e,r,s,3),d("x","y","z",1,-1,t,e,n,r,i,4),d("x","y","z",-1,-1,t,e,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new Li(l,3)),this.setAttribute("normal",new Li(c,3)),this.setAttribute("uv",new Li(u,2))}}function _s(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function gs(t){const e={};for(let n=0;n<t.length;n++){const r=_s(t[n]);for(const t in r)e[t]=r[t]}return e}const ys={clone:_s,merge:gs};var vs="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",bs="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function xs(t){vi.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=vs,this.fragmentShader=bs,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function ws(){wr.call(this),this.type="Camera",this.matrixWorldInverse=new ir,this.projectionMatrix=new ir,this.projectionMatrixInverse=new ir}function Ss(t,e,n,r){ws.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}xs.prototype=Object.create(vi.prototype),xs.prototype.constructor=xs,xs.prototype.isShaderMaterial=!0,xs.prototype.copy=function(t){return vi.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=_s(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this},xs.prototype.toJSON=function(t){const e=vi.prototype.toJSON.call(this,t);e.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?e.uniforms[n]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[n]={type:"m4",value:r.toArray()}:e.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e},ws.prototype=Object.assign(Object.create(wr.prototype),{constructor:ws,isCamera:!0,copy:function(t,e){return wr.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Jn),this.updateMatrixWorld(!0);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){wr.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,e){wr.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Ss.prototype=Object.assign(Object.create(ws.prototype),{constructor:Ss,isPerspectiveCamera:!0,copy:function(t,e){return ws.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Fn.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){const t=Math.tan(.5*Fn.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Fn.RAD2DEG*Math.atan(Math.tan(.5*Fn.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,r,i,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){let t=this.near,e=t*Math.tan(.5*Fn.DEG2RAD*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r,s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;i+=s.offsetX*r/t,e-=s.offsetY*n/o,r*=s.width/t,n*=s.height/o}const o=this.filmOffset;0!==o&&(i+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){const e=wr.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});const Ms=90,Ts=1;function Es(t,e,n){if(wr.call(this),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new Ss(Ms,Ts,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Jn(1,0,0)),this.add(r);const i=new Ss(Ms,Ts,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Jn(-1,0,0)),this.add(i);const s=new Ss(Ms,Ts,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new Jn(0,1,0)),this.add(s);const o=new Ss(Ms,Ts,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new Jn(0,-1,0)),this.add(o);const a=new Ss(Ms,Ts,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Jn(0,0,1)),this.add(a);const l=new Ss(Ms,Ts,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Jn(0,0,-1)),this.add(l),this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();const c=t.xr.enabled,u=t.getRenderTarget();t.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,r),t.setRenderTarget(n,1),t.render(e,i),t.setRenderTarget(n,2),t.render(e,s),t.setRenderTarget(n,3),t.render(e,o),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=h,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(u),t.xr.enabled=c},this.clear=function(t,e,r,i){const s=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(n,s),t.clear(e,r,i);t.setRenderTarget(s)}}function As(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),Vn.call(this,t,t,e)}function $s(t,e,n,r,i,s,o,a,l,c,u,h){Gn.call(this,null,s,o,a,l,c,r,i,u,h),this.image={data:t||null,width:e||1,height:n||1},this.magFilter=void 0!==l?l:ft,this.minFilter=void 0!==c?c:ft,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}Es.prototype=Object.create(wr.prototype),Es.prototype.constructor=Es,As.prototype=Object.create(Vn.prototype),As.prototype.constructor=As,As.prototype.isWebGLCubeRenderTarget=!0,As.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=kt,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n=new Sr,r="\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",i="\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t",s=new xs({name:"CubemapFromEquirect",uniforms:_s({tEquirect:{value:null}}),vertexShader:r,fragmentShader:i,side:m,blending:v});s.uniforms.tEquirect.value=e;const o=new os(new ms(5,5,5),s);return n.add(o),new Es(1,10,this).update(t,n),o.geometry.dispose(),o.material.dispose(),this},$s.prototype=Object.create(Gn.prototype),$s.prototype.constructor=$s,$s.prototype.isDataTexture=!0;const Cs=new Ur,Bs=new Jn;function Ls(t,e,n,r,i,s){this.planes=[void 0!==t?t:new Qr,void 0!==e?e:new Qr,void 0!==n?n:new Qr,void 0!==r?r:new Qr,void 0!==i?i:new Qr,void 0!==s?s:new Qr]}Object.assign(Ls.prototype,{set:function(t,e,n,r,i,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this},setFromProjectionMatrix:function(t){const e=this.planes,n=t.elements,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7],h=n[8],p=n[9],d=n[10],f=n[11],m=n[12],_=n[13],g=n[14],y=n[15];return e[0].setComponents(o-r,u-a,f-h,y-m).normalize(),e[1].setComponents(o+r,u+a,f+h,y+m).normalize(),e[2].setComponents(o+i,u+l,f+p,y+_).normalize(),e[3].setComponents(o-i,u-l,f-p,y-_).normalize(),e[4].setComponents(o-s,u-c,f-d,y-g).normalize(),e[5].setComponents(o+s,u+c,f+d,y+g).normalize(),this},intersectsObject:function(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Cs.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Cs)},intersectsSprite:function(t){return Cs.center.set(0,0,0),Cs.radius=.7071067811865476,Cs.applyMatrix4(t.matrixWorld),this.intersectsSphere(Cs)},intersectsSphere:function(t){const e=this.planes,n=t.center,r=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(n)<r)return!1;return!0},intersectsBox:function(t){const e=this.planes;for(let n=0;n<6;n++){const r=e[n];if(Bs.x=r.normal.x>0?t.max.x:t.min.x,Bs.y=r.normal.y>0?t.max.y:t.min.y,Bs.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(Bs)<0)return!1}return!0},containsPoint:function(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}});const Rs={common:{diffuse:{value:new di(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Dn},uv2Transform:{value:new Dn},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new kn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new di(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new di(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Dn}},sprite:{diffuse:{value:new di(15658734)},opacity:{value:1},center:{value:new kn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Dn}}};function Ns(){let t=null,e=!1,n=null,r=null;function i(e,s){n(e,s),r=t.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==n&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function Ps(t,e){const n=e.isWebGL2,r=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),r.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=r.get(e);n&&(t.deleteBuffer(n.buffer),r.delete(e))},update:function(e,i){e.isInterleavedBufferAttribute&&(e=e.data);const s=r.get(e);void 0===s?r.set(e,function(e,n){const r=e.array,i=e.usage,s=t.createBuffer();t.bindBuffer(n,s),t.bufferData(n,r,i),e.onUploadCallback();let o=5126;return r instanceof Float32Array?o=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?o=5123:r instanceof Int16Array?o=5122:r instanceof Uint32Array?o=5125:r instanceof Int32Array?o=5124:r instanceof Int8Array?o=5120:r instanceof Uint8Array&&(o=5121),{buffer:s,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,i)):s.version<e.version&&(function(e,r,i){const s=r.array,o=r.updateRange;t.bindBuffer(i,e),-1===o.count?t.bufferSubData(i,0,s):(n?t.bufferSubData(i,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):t.bufferSubData(i,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,e,i),s.version=e.version)}}}function Is(t,e,n,r){ds.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new Os(t,e,n,r)),this.mergeVertices()}function Os(t,e,n,r){ji.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};const i=(t=t||1)/2,s=(e=e||1)/2,o=Math.floor(n)||1,a=Math.floor(r)||1,l=o+1,c=a+1,u=t/o,h=e/a,p=[],d=[],f=[],m=[];for(let t=0;t<c;t++){const e=t*h-s;for(let n=0;n<l;n++){const r=n*u-i;d.push(r,-e,0),f.push(0,0,1),m.push(n/o),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const n=e+l*t,r=e+l*(t+1),i=e+1+l*(t+1),s=e+1+l*t;p.push(n,r,s),p.push(r,i,s)}this.setIndex(p),this.setAttribute("position",new Li(d,3)),this.setAttribute("normal",new Li(f,3)),this.setAttribute("uv",new Li(m,2))}Is.prototype=Object.create(ds.prototype),Is.prototype.constructor=Is,Os.prototype=Object.create(ji.prototype),Os.prototype.constructor=Os;const Fs={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);    } else if (face == 1.0) {\n      uv = vec2(-direction.x, -direction.z) / abs(direction.y);    } else if (face == 2.0) {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);    } else if (face == 3.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);    } else if (face == 4.0) {\n      uv = vec2(-direction.x, direction.z) / abs(direction.y);    } else {\n      uv = vec2(direction.x, direction.y) / abs(direction.z);    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},ks={basic:{uniforms:gs([Rs.common,Rs.specularmap,Rs.envmap,Rs.aomap,Rs.lightmap,Rs.fog]),vertexShader:Fs.meshbasic_vert,fragmentShader:Fs.meshbasic_frag},lambert:{uniforms:gs([Rs.common,Rs.specularmap,Rs.envmap,Rs.aomap,Rs.lightmap,Rs.emissivemap,Rs.fog,Rs.lights,{emissive:{value:new di(0)}}]),vertexShader:Fs.meshlambert_vert,fragmentShader:Fs.meshlambert_frag},phong:{uniforms:gs([Rs.common,Rs.specularmap,Rs.envmap,Rs.aomap,Rs.lightmap,Rs.emissivemap,Rs.bumpmap,Rs.normalmap,Rs.displacementmap,Rs.fog,Rs.lights,{emissive:{value:new di(0)},specular:{value:new di(1118481)},shininess:{value:30}}]),vertexShader:Fs.meshphong_vert,fragmentShader:Fs.meshphong_frag},standard:{uniforms:gs([Rs.common,Rs.envmap,Rs.aomap,Rs.lightmap,Rs.emissivemap,Rs.bumpmap,Rs.normalmap,Rs.displacementmap,Rs.roughnessmap,Rs.metalnessmap,Rs.fog,Rs.lights,{emissive:{value:new di(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Fs.meshphysical_vert,fragmentShader:Fs.meshphysical_frag},toon:{uniforms:gs([Rs.common,Rs.aomap,Rs.lightmap,Rs.emissivemap,Rs.bumpmap,Rs.normalmap,Rs.displacementmap,Rs.gradientmap,Rs.fog,Rs.lights,{emissive:{value:new di(0)}}]),vertexShader:Fs.meshtoon_vert,fragmentShader:Fs.meshtoon_frag},matcap:{uniforms:gs([Rs.common,Rs.bumpmap,Rs.normalmap,Rs.displacementmap,Rs.fog,{matcap:{value:null}}]),vertexShader:Fs.meshmatcap_vert,fragmentShader:Fs.meshmatcap_frag},points:{uniforms:gs([Rs.points,Rs.fog]),vertexShader:Fs.points_vert,fragmentShader:Fs.points_frag},dashed:{uniforms:gs([Rs.common,Rs.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Fs.linedashed_vert,fragmentShader:Fs.linedashed_frag},depth:{uniforms:gs([Rs.common,Rs.displacementmap]),vertexShader:Fs.depth_vert,fragmentShader:Fs.depth_frag},normal:{uniforms:gs([Rs.common,Rs.bumpmap,Rs.normalmap,Rs.displacementmap,{opacity:{value:1}}]),vertexShader:Fs.normal_vert,fragmentShader:Fs.normal_frag},sprite:{uniforms:gs([Rs.sprite,Rs.fog]),vertexShader:Fs.sprite_vert,fragmentShader:Fs.sprite_frag},background:{uniforms:{uvTransform:{value:new Dn},t2D:{value:null}},vertexShader:Fs.background_vert,fragmentShader:Fs.background_frag},cube:{uniforms:gs([Rs.envmap,{opacity:{value:1}}]),vertexShader:Fs.cube_vert,fragmentShader:Fs.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Fs.equirect_vert,fragmentShader:Fs.equirect_frag},distanceRGBA:{uniforms:gs([Rs.common,Rs.displacementmap,{referencePosition:{value:new Jn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Fs.distanceRGBA_vert,fragmentShader:Fs.distanceRGBA_frag},shadow:{uniforms:gs([Rs.lights,Rs.fog,{color:{value:new di(0)},opacity:{value:1}}]),vertexShader:Fs.shadow_vert,fragmentShader:Fs.shadow_frag}};function Ds(t,e,n,r){const i=new di(0);let s,o,a=0,l=null,c=0,u=null;function h(t,n){e.buffers.color.setClear(t.r,t.g,t.b,n,r)}return{getClearColor:function(){return i},setClearColor:function(t,e){i.set(t),a=void 0!==e?e:1,h(i,a)},getClearAlpha:function(){return a},setClearAlpha:function(t){a=t,h(i,a)},render:function(e,r,p,d){let _=!0===r.isScene?r.background:null;const g=t.xr,y=g.getSession&&g.getSession();if(y&&"additive"===y.environmentBlendMode&&(_=null),null===_?h(i,a):_&&_.isColor&&(h(_,1),d=!0),(t.autoClear||d)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),_&&(_.isCubeTexture||_.isWebGLCubeRenderTarget||_.mapping===ct)){void 0===o&&(o=new os(new ms(1,1,1),new xs({name:"BackgroundCubeMaterial",uniforms:_s(ks.cube.uniforms),vertexShader:ks.cube.vertexShader,fragmentShader:ks.cube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(o));const r=_.isWebGLCubeRenderTarget?_.texture:_;o.material.uniforms.envMap.value=r,o.material.uniforms.flipEnvMap.value=r.isCubeTexture?-1:1,l===_&&c===r.version&&u===t.toneMapping||(o.material.needsUpdate=!0,l=_,c=r.version,u=t.toneMapping),e.unshift(o,o.geometry,o.material,0,0,null)}else _&&_.isTexture&&(void 0===s&&(s=new os(new Os(2,2),new xs({name:"BackgroundMaterial",uniforms:_s(ks.background.uniforms),vertexShader:ks.background.vertexShader,fragmentShader:ks.background.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(s)),s.material.uniforms.t2D.value=_,!0===_.matrixAutoUpdate&&_.updateMatrix(),s.material.uniforms.uvTransform.value.copy(_.matrix),l===_&&c===_.version&&u===t.toneMapping||(s.material.needsUpdate=!0,l=_,c=_.version,u=t.toneMapping),e.unshift(s,s.geometry,s.material,0,0,null))}}}function Us(t,e,n,r){const i=t.getParameter(34921),s=r.isWebGL2?null:e.get("OES_vertex_array_object"),o=r.isWebGL2||null!==s,a={},l=p(null);let c=l;function u(e){return r.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function h(e){return r.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function p(t){const e=[],n=[],r=[];for(let t=0;t<i;t++)e[t]=0,n[t]=0,r[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:r,object:t,attributes:{}}}function d(){const t=c.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function f(t){m(t,0)}function m(n,i){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;s[n]=1,0===o[n]&&(t.enableVertexAttribArray(n),o[n]=1),a[n]!==i&&((r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),a[n]=i)}function _(){const e=c.newAttributes,n=c.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==e[r]&&(t.disableVertexAttribArray(r),n[r]=0)}function g(e,n,i,s,o,a){!0!==r.isWebGL2||5124!==i&&5125!==i?t.vertexAttribPointer(e,n,i,s,o,a):t.vertexAttribIPointer(e,n,i,o,a)}function y(){v(),c!==l&&(c=l,u(c.object))}function v(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,h,y,v){let b=!1;if(o){const e=function(e,n,i){const o=!0===i.wireframe;let l=a[e.id];void 0===l&&(l={},a[e.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[o];return void 0===u&&(u=p(r.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[o]=u),u}(y,h,l);c!==e&&(c=e,u(c.object)),b=function(t){const e=c.attributes,n=t.attributes;if(Object.keys(e).length!==Object.keys(n).length)return!0;for(const t in n){const r=e[t],i=n[t];if(r.attribute!==i)return!0;if(r.data!==i.data)return!0}return!1}(y),b&&function(t){const e={},n=t.attributes;for(const t in n){const r=n[t],i={};i.attribute=r,r.data&&(i.data=r.data),e[t]=i}c.attributes=e}(y)}else{const t=!0===l.wireframe;c.geometry===y.id&&c.program===h.id&&c.wireframe===t||(c.geometry=y.id,c.program=h.id,c.wireframe=t,b=!0)}!0===i.isInstancedMesh&&(b=!0),null!==v&&n.update(v,34963),b&&(function(i,s,o,a){if(!1===r.isWebGL2&&(i.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;d();const l=a.attributes,c=o.getAttributes(),u=s.defaultAttributeValues;for(const e in c){const r=c[e];if(r>=0){const s=l[e];if(void 0!==s){const e=s.normalized,i=s.itemSize,o=n.get(s);if(void 0===o)continue;const l=o.buffer,c=o.type,u=o.bytesPerElement;if(s.isInterleavedBufferAttribute){const n=s.data,o=n.stride,h=s.offset;n&&n.isInstancedInterleavedBuffer?(m(r,n.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)):f(r),t.bindBuffer(34962,l),g(r,i,c,e,o*u,h*u)}else s.isInstancedBufferAttribute?(m(r,s.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)):f(r),t.bindBuffer(34962,l),g(r,i,c,e,0,0)}else if("instanceMatrix"===e){const e=n.get(i.instanceMatrix);if(void 0===e)continue;const s=e.buffer,o=e.type;m(r+0,1),m(r+1,1),m(r+2,1),m(r+3,1),t.bindBuffer(34962,s),t.vertexAttribPointer(r+0,4,o,!1,64,0),t.vertexAttribPointer(r+1,4,o,!1,64,16),t.vertexAttribPointer(r+2,4,o,!1,64,32),t.vertexAttribPointer(r+3,4,o,!1,64,48)}else if(void 0!==u){const n=u[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(r,n);break;case 3:t.vertexAttrib3fv(r,n);break;case 4:t.vertexAttrib4fv(r,n);break;default:t.vertexAttrib1fv(r,n)}}}}_()}(i,l,h,y),null!==v&&t.bindBuffer(34963,n.get(v).buffer))},reset:y,resetDefaultState:v,dispose:function(){y();for(const t in a){const e=a[t];for(const t in e){const n=e[t];for(const t in n)h(n[t].object),delete n[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const n=e[t];for(const t in n)h(n[t].object),delete n[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const n=a[e];if(void 0===n[t.id])continue;const r=n[t.id];for(const t in r)h(r[t].object),delete r[t];delete n[t.id]}},initAttributes:d,enableAttribute:f,disableUnusedAttributes:_}}function zs(t,e,n,r){const i=r.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,r){t.drawArrays(s,e,r),n.update(r,s,1)},this.renderInstances=function(r,o,a){if(0===a)return;let l,c;if(i)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,r,o,a),n.update(o,s,a)}}function js(t,e,n){let r;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let o=void 0!==n.precision?n.precision:"highp";const a=i(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=!0===n.logarithmicDepthBuffer,c=t.getParameter(34930),u=t.getParameter(35660),h=t.getParameter(3379),p=t.getParameter(34076),d=t.getParameter(34921),f=t.getParameter(36347),m=t.getParameter(36348),_=t.getParameter(36349),g=u>0,y=s||!!e.get("OES_texture_float");return{isWebGL2:s,getMaxAnisotropy:function(){if(void 0!==r)return r;const n=e.get("EXT_texture_filter_anisotropic");return r=null!==n?t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,r},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:p,maxAttributes:d,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:_,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:g&&y,maxSamples:s?t.getParameter(36183):0}}function Gs(){const t=this;let e=null,n=0,r=!1,i=!1;const s=new Qr,o=new Dn,a={value:null,needsUpdate:!1};function l(){a.value!==e&&(a.value=e,a.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function c(e,n,r,i){let l=null!==e?e.length:0,c=null;if(0!==l){if(c=a.value,!0!==i||null===c){const t=r+4*l,i=n.matrixWorldInverse;o.getNormalMatrix(i),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=r;t!==l;++t,n+=4)s.copy(e[t]).applyMatrix4(i,o),s.normal.toArray(c,n),c[n+3]=s.constant}a.value=c,a.needsUpdate=!0}return t.numPlanes=l,t.numIntersection=0,c}this.uniform=a,this.numPlanes=0,this.numIntersection=0,this.init=function(t,i,s){const o=0!==t.length||i||0!==n||r;return r=i,e=c(t,s,0),n=t.length,o},this.beginShadows=function(){i=!0,c(null)},this.endShadows=function(){i=!1,l()},this.setState=function(t,s,o,u,h,p){if(!r||null===t||0===t.length||i&&!o)i?c(null):l();else{const r=i?0:n,o=4*r;let l=h.clippingState||null;a.value=l,l=c(t,u,o,p);for(let t=0;t!==o;++t)l[t]=e[t];h.clippingState=l,this.numIntersection=s?this.numPlanes:0,this.numPlanes+=r}}}function Hs(t){const e={};return{has:function(n){if(void 0!==e[n])return e[n];let r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return e[n]=r,!!r},get:function(t){return this.has(t)||console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e[t]}}}function Vs(t,e,n,r){const i=new WeakMap,s=new WeakMap;function o(t){const a=t.target,l=i.get(a);null!==l.index&&e.remove(l.index);for(const t in l.attributes)e.remove(l.attributes[t]);a.removeEventListener("dispose",o),i.delete(a);const c=s.get(l);c&&(e.remove(c),s.delete(l)),r.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){const n=[],r=t.index,i=t.attributes.position;let o=0;if(null!==r){const t=r.array;o=r.version;for(let e=0,r=t.length;e<r;e+=3){const r=t[e+0],i=t[e+1],s=t[e+2];n.push(r,i,i,s,s,r)}}else{const t=i.array;o=i.version;for(let e=0,r=t.length/3-1;e<r;e+=3){const t=e+0,r=e+1,i=e+2;n.push(t,r,r,i,i,t)}}const a=new(Pi(n)>65535?Bi:$i)(n,1);a.version=o;const l=s.get(t);l&&e.remove(l),s.set(t,a)}return{get:function(t,e){let r=i.get(e);return r||(e.addEventListener("dispose",o),e.isBufferGeometry?r=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new ji).setFromObject(t)),r=e._bufferGeometry),i.set(e,r),n.memory.geometries++,r)},update:function(t){const n=t.attributes;for(const t in n)e.update(n[t],34962);const r=t.morphAttributes;for(const t in r){const n=r[t];for(let t=0,r=n.length;t<r;t++)e.update(n[t],34962)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return s.get(t)}}}function Ws(t,e,n,r){const i=r.isWebGL2;let s,o,a;this.setMode=function(t){s=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,r){t.drawElements(s,r,o,e*a),n.update(r,s,1)},this.renderInstances=function(r,l,c){if(0===c)return;let u,h;if(i)u=t,h="drawElementsInstanced";else if(u=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](s,l,o,r*a,c),n.update(l,s,c)}}function qs(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,r){switch(e.calls++,n){case 4:e.triangles+=r*(t/3);break;case 1:e.lines+=r*(t/2);break;case 3:e.lines+=r*(t-1);break;case 2:e.lines+=r*t;break;case 0:e.points+=r*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Xs(t,e){return t[0]-e[0]}function Ys(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Js(t){const e={},n=new Float32Array(8),r=[];for(let t=0;t<8;t++)r[t]=[t,0];return{update:function(i,s,o,a){const l=i.morphTargetInfluences,c=void 0===l?0:l.length;let u=e[s.id];if(void 0===u){u=[];for(let t=0;t<c;t++)u[t]=[t,0];e[s.id]=u}for(let t=0;t<c;t++){const e=u[t];e[0]=t,e[1]=l[t]}u.sort(Ys);for(let t=0;t<8;t++)t<c&&u[t][1]?(r[t][0]=u[t][0],r[t][1]=u[t][1]):(r[t][0]=Number.MAX_SAFE_INTEGER,r[t][1]=0);r.sort(Xs);const h=o.morphTargets&&s.morphAttributes.position,p=o.morphNormals&&s.morphAttributes.normal;let d=0;for(let t=0;t<8;t++){const e=r[t],i=e[0],o=e[1];i!==Number.MAX_SAFE_INTEGER&&o?(h&&s.getAttribute("morphTarget"+t)!==h[i]&&s.setAttribute("morphTarget"+t,h[i]),p&&s.getAttribute("morphNormal"+t)!==p[i]&&s.setAttribute("morphNormal"+t,p[i]),n[t]=o,d+=o):(h&&void 0!==s.getAttribute("morphTarget"+t)&&s.deleteAttribute("morphTarget"+t),p&&void 0!==s.getAttribute("morphNormal"+t)&&s.deleteAttribute("morphNormal"+t),n[t]=0)}const f=s.morphTargetsRelative?1:1-d;a.getUniforms().setValue(t,"morphTargetBaseInfluence",f),a.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function Zs(t,e,n,r){let i=new WeakMap;return{update:function(t){const s=r.render.frame,o=t.geometry,a=e.get(t,o);return i.get(a)!==s&&(o.isGeometry&&a.updateFromObject(t),e.update(a),i.set(a,s)),t.isInstancedMesh&&n.update(t.instanceMatrix,34962),a},dispose:function(){i=new WeakMap}}}function Qs(t,e,n,r,i,s,o,a,l,c){t=void 0!==t?t:[],e=void 0!==e?e:st,o=void 0!==o?o:Ft,Gn.call(this,t,e,n,r,i,s,o,a,l,c),this.flipY=!1}function Ks(t,e,n,r){Gn.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:r||1},this.magFilter=ft,this.minFilter=ft,this.wrapR=pt,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function to(t,e,n,r){Gn.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:r||1},this.magFilter=ft,this.minFilter=ft,this.wrapR=pt,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}ks.physical={uniforms:gs([ks.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new kn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new di(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Fs.meshphysical_vert,fragmentShader:Fs.meshphysical_frag},Qs.prototype=Object.create(Gn.prototype),Qs.prototype.constructor=Qs,Qs.prototype.isCubeTexture=!0,Object.defineProperty(Qs.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),Ks.prototype=Object.create(Gn.prototype),Ks.prototype.constructor=Ks,Ks.prototype.isDataTexture2DArray=!0,to.prototype=Object.create(Gn.prototype),to.prototype.constructor=to,to.prototype.isDataTexture3D=!0;const eo=new Gn,no=new Ks,ro=new to,io=new Qs,so=[],oo=[],ao=new Float32Array(16),lo=new Float32Array(9),co=new Float32Array(4);function uo(t,e,n){const r=t[0];if(r<=0||r>0)return t;let i=e*n,s=so[i];if(void 0===s&&(s=new Float32Array(i),so[i]=s),0!==e){r.toArray(s,0);for(let r=1,i=0;r!==e;++r)i+=n,t[r].toArray(s,i)}return s}function ho(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function po(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function fo(t,e){let n=oo[e];void 0===n&&(n=new Int32Array(e),oo[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function mo(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function _o(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ho(n,e))return;t.uniform2fv(this.addr,e),po(n,e)}}function go(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(ho(n,e))return;t.uniform3fv(this.addr,e),po(n,e)}}function yo(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ho(n,e))return;t.uniform4fv(this.addr,e),po(n,e)}}function vo(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(ho(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),po(n,e)}else{if(ho(n,r))return;co.set(r),t.uniformMatrix2fv(this.addr,!1,co),po(n,r)}}function bo(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(ho(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),po(n,e)}else{if(ho(n,r))return;lo.set(r),t.uniformMatrix3fv(this.addr,!1,lo),po(n,r)}}function xo(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(ho(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),po(n,e)}else{if(ho(n,r))return;ao.set(r),t.uniformMatrix4fv(this.addr,!1,ao),po(n,r)}}function wo(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(e||eo,i)}function So(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||no,i)}function Mo(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||ro,i)}function To(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(e||io,i)}function Eo(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Ao(t,e){const n=this.cache;ho(n,e)||(t.uniform2iv(this.addr,e),po(n,e))}function $o(t,e){const n=this.cache;ho(n,e)||(t.uniform3iv(this.addr,e),po(n,e))}function Co(t,e){const n=this.cache;ho(n,e)||(t.uniform4iv(this.addr,e),po(n,e))}function Bo(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Lo(t,e){t.uniform1fv(this.addr,e)}function Ro(t,e){t.uniform1iv(this.addr,e)}function No(t,e){t.uniform2iv(this.addr,e)}function Po(t,e){t.uniform3iv(this.addr,e)}function Io(t,e){t.uniform4iv(this.addr,e)}function Oo(t,e){const n=uo(e,this.size,2);t.uniform2fv(this.addr,n)}function Fo(t,e){const n=uo(e,this.size,3);t.uniform3fv(this.addr,n)}function ko(t,e){const n=uo(e,this.size,4);t.uniform4fv(this.addr,n)}function Do(t,e){const n=uo(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Uo(t,e){const n=uo(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function zo(t,e){const n=uo(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function jo(t,e,n){const r=e.length,i=fo(n,r);t.uniform1iv(this.addr,i);for(let t=0;t!==r;++t)n.safeSetTexture2D(e[t]||eo,i[t])}function Go(t,e,n){const r=e.length,i=fo(n,r);t.uniform1iv(this.addr,i);for(let t=0;t!==r;++t)n.safeSetTextureCube(e[t]||io,i[t])}function Ho(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return mo;case 35664:return _o;case 35665:return go;case 35666:return yo;case 35674:return vo;case 35675:return bo;case 35676:return xo;case 5124:case 35670:return Eo;case 35667:case 35671:return Ao;case 35668:case 35672:return $o;case 35669:case 35673:return Co;case 5125:return Bo;case 35678:case 36198:case 36298:case 36306:case 35682:return wo;case 35679:case 36299:case 36307:return Mo;case 35680:case 36300:case 36308:case 36293:return To;case 36289:case 36303:case 36311:case 36292:return So}}(e.type)}function Vo(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Lo;case 35664:return Oo;case 35665:return Fo;case 35666:return ko;case 35674:return Do;case 35675:return Uo;case 35676:return zo;case 5124:case 35670:return Ro;case 35667:case 35671:return No;case 35668:case 35672:return Po;case 35669:case 35673:return Io;case 35678:case 36198:case 36298:case 36306:case 35682:return jo;case 35680:case 36300:case 36308:case 36293:return Go}}(e.type)}function Wo(t){this.id=t,this.seq=[],this.map={}}Vo.prototype.updateCache=function(t){let e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),po(e,t)},Wo.prototype.setValue=function(t,e,n){const r=this.seq;for(let i=0,s=r.length;i!==s;++i){const s=r[i];s.setValue(t,e[s.id],n)}};const qo=/([\w\d_]+)(\])?(\[|\.)?/g;function Xo(t,e){t.seq.push(e),t.map[e.id]=e}function Yo(t,e,n){const r=t.name,i=r.length;for(qo.lastIndex=0;;){const s=qo.exec(r),o=qo.lastIndex;let a=s[1],l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===i){Xo(n,void 0===c?new Ho(a,t,e):new Vo(a,t,e));break}{let t=n.map[a];void 0===t&&(t=new Wo(a),Xo(n,t)),n=t}}}function Jo(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let r=0;r<n;++r){const n=t.getActiveUniform(e,r);Yo(n,t.getUniformLocation(e,n.name),this)}}function Zo(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}Jo.prototype.setValue=function(t,e,n,r){const i=this.map[e];void 0!==i&&i.setValue(t,n,r)},Jo.prototype.setOptional=function(t,e,n){const r=e[n];void 0!==r&&this.setValue(t,n,r)},Jo.upload=function(t,e,n,r){for(let i=0,s=e.length;i!==s;++i){const s=e[i],o=n[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,r)}},Jo.seqWithValue=function(t,e){const n=[];for(let r=0,i=t.length;r!==i;++r){const i=t[r];i.id in e&&n.push(i)}return n};let Qo=0;function Ko(t){switch(t){case Je:return["Linear","( value )"];case Ze:return["sRGB","( value )"];case Ke:return["RGBE","( value )"];case en:return["RGBM","( value, 7.0 )"];case nn:return["RGBM","( value, 16.0 )"];case rn:return["RGBD","( value, 256.0 )"];case Qe:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case tn:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function ta(t,e,n){const r=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();return r&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function ea(t,e){const n=Ko(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function na(t,e){const n=Ko(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function ra(t,e){let n;switch(e){case K:n="Linear";break;case tt:n="Reinhard";break;case et:n="OptimizedCineon";break;case nt:n="ACESFilmic";break;case rt:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function ia(t){return""!==t}function sa(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function oa(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const aa=/^[ \t]*#include +<([\w\d./]+)>/gm;function la(t){return t.replace(aa,ca)}function ca(t,e){const n=Fs[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return la(n)}const ua=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ha=/#pragma unroll_loop_start[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g;function pa(t){return t.replace(ha,fa).replace(ua,da)}function da(t,e,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),fa(0,e,n,r)}function fa(t,e,n,r){let i="";for(let t=parseInt(e);t<parseInt(n);t++)i+=r.replace(/\[ i \]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return i}function ma(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function _a(t,e,n,r){const i=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===h?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===p?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===d&&(e="SHADOWMAP_TYPE_VSM"),e}(n),c=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case st:case ot:e="ENVMAP_TYPE_CUBE";break;case ct:case ut:e="ENVMAP_TYPE_CUBE_UV";break;case at:case lt:e="ENVMAP_TYPE_EQUIREC"}return e}(n),u=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case ot:case lt:case ut:e="ENVMAP_MODE_REFRACTION"}return e}(n),f=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Y:e="ENVMAP_BLENDING_MULTIPLY";break;case J:e="ENVMAP_BLENDING_MIX";break;case Z:e="ENVMAP_BLENDING_ADD"}return e}(n),m=t.gammaFactor>0?t.gammaFactor:1,_=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ia).join("\n")}(n),g=function(t){const e=[];for(const n in t){const r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}(s),y=i.createProgram();let v,b;n.isRawShaderMaterial?(v=[g].filter(ia).join("\n"),v.length>0&&(v+="\n"),b=[_,g].filter(ia).join("\n"),b.length>0&&(b+="\n")):(v=[ma(n),"#define SHADER_NAME "+n.shaderName,g,n.instancing?"#define USE_INSTANCING":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ia).join("\n"),b=[_,ma(n),"#define SHADER_NAME "+n.shaderName,g,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Q?"#define TONE_MAPPING":"",n.toneMapping!==Q?Fs.tonemapping_pars_fragment:"",n.toneMapping!==Q?ra("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",Fs.encodings_pars_fragment,n.map?ea("mapTexelToLinear",n.mapEncoding):"",n.matcap?ea("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?ea("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?ea("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?ea("lightMapTexelToLinear",n.lightMapEncoding):"",na("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(ia).join("\n")),o=la(o),o=sa(o,n),o=oa(o,n),a=la(a),a=sa(a,n),a=oa(a,n),o=pa(o),a=pa(a),n.isWebGL2&&!n.isRawShaderMaterial&&(v=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+v,b=["#version 300 es\n","#define varying in","out highp vec4 pc_fragColor;","#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b);const x=b+a,w=Zo(i,35633,v+o),S=Zo(i,35632,x);if(i.attachShader(y,w),i.attachShader(y,S),void 0!==n.index0AttributeName?i.bindAttribLocation(y,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(y,0,"position"),i.linkProgram(y),t.debug.checkShaderErrors){const t=i.getProgramInfoLog(y).trim(),e=i.getShaderInfoLog(w).trim(),n=i.getShaderInfoLog(S).trim();let r=!0,s=!0;if(!1===i.getProgramParameter(y,35714)){r=!1;const e=ta(i,w,"vertex"),n=ta(i,S,"fragment");console.error("THREE.WebGLProgram: shader error: ",i.getError(),"35715",i.getProgramParameter(y,35715),"gl.getProgramInfoLog",t,e,n)}else""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==e&&""!==n||(s=!1);s&&(this.diagnostics={runnable:r,programLog:t,vertexShader:{log:e,prefix:v},fragmentShader:{log:n,prefix:b}})}let M,T;return i.deleteShader(w),i.deleteShader(S),this.getUniforms=function(){return void 0===M&&(M=new Jo(i,y)),M},this.getAttributes=function(){return void 0===T&&(T=function(t,e){const n={},r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const r=t.getActiveAttrib(e,i).name;n[r]=t.getAttribLocation(e,r)}return n}(i,y)),T},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(y),this.program=void 0},this.name=n.shaderName,this.id=Qo++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=w,this.fragmentShader=S,this}function ga(t,e,n,r){const i=[],s=n.isWebGL2,o=n.logarithmicDepthBuffer,a=n.floatVertexTextures,l=n.maxVertexUniforms,c=n.vertexTextures;let u=n.precision;const h={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function d(t){let e;return t?t.isTexture?e=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=Je,e}return{getParameters:function(r,i,p,f,g,y,v){const b=f.fog,x=r.isMeshStandardMaterial?f.environment:null,w=r.envMap||x,S=h[r.type],M=v.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(a)return 1024;{const t=l,n=Math.floor((t-20)/4),r=Math.min(n,e.length);return r<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+r+"."),0):r}}(v):0;let T,E;if(null!==r.precision&&(u=n.getMaxPrecision(r.precision),u!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",u,"instead.")),S){const t=ks[S];T=t.vertexShader,E=t.fragmentShader}else T=r.vertexShader,E=r.fragmentShader;const A=t.getRenderTarget();return{isWebGL2:s,shaderID:S,shaderName:r.type,vertexShader:T,fragmentShader:E,defines:r.defines,isRawShaderMaterial:r.isRawShaderMaterial,isShaderMaterial:r.isShaderMaterial,precision:u,instancing:!0===v.isInstancedMesh,supportsVertexTextures:c,outputEncoding:null!==A?d(A.texture):t.outputEncoding,map:!!r.map,mapEncoding:d(r.map),matcap:!!r.matcap,matcapEncoding:d(r.matcap),envMap:!!w,envMapMode:w&&w.mapping,envMapEncoding:d(w),envMapCubeUV:!!w&&(w.mapping===ct||w.mapping===ut),lightMap:!!r.lightMap,lightMapEncoding:d(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:d(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===ln,tangentSpaceNormalMap:r.normalMapType===an,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,transmissionMap:!!r.transmissionMap,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatMap||r.clearcoatRoughnessMap||r.clearcoatNormalMap||r.displacementMap||r.transmissionMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmissionMap||!r.displacementMap),fog:!!b,useFog:r.fog,fogExp2:b&&b.isFogExp2,flatShading:r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:o,skinning:r.skinning&&M>0,maxBones:M,useVertexTexture:a,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:i.directional.length,numPointLights:i.point.length,numSpotLights:i.spot.length,numRectAreaLights:i.rectArea.length,numHemiLights:i.hemi.length,numDirLightShadows:i.directionalShadowMap.length,numPointLightShadows:i.pointShadowMap.length,numSpotLightShadows:i.spotShadowMap.length,numClippingPlanes:g,numClipIntersection:y,dithering:r.dithering,shadowMapEnabled:t.shadowMap.enabled&&p.length>0,shadowMapType:t.shadowMap.type,toneMapping:r.toneMapped?t.toneMapping:Q,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===_,flipSided:r.side===m,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:s||null!==e.get("EXT_frag_depth"),rendererExtensionDrawBuffers:s||null!==e.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:s||null!==e.get("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);if(void 0===e.isRawShaderMaterial){for(let t=0;t<p.length;t++)n.push(e[p[t]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=h[t.type];let n;if(e){const t=ks[e];n=ys.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let s;for(let t=0,e=i.length;t<e;t++){const e=i[t];if(e.cacheKey===n){s=e,++s.usedTimes;break}}return void 0===s&&(s=new _a(t,n,e,r),i.push(s)),s},releaseProgram:function(t){if(0==--t.usedTimes){const e=i.indexOf(t);i[e]=i[i.length-1],i.pop(),t.destroy()}},programs:i}}function ya(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new WeakMap}}}function va(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function ba(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function xa(t){const e=[];let n=0;const r=[],i=[],s={id:-1};function o(r,i,o,a,l,c){let u=e[n];const h=t.get(o);return void 0===u?(u={id:r.id,object:r,geometry:i,material:o,program:h.program||s,groupOrder:a,renderOrder:r.renderOrder,z:l,group:c},e[n]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=o,u.program=h.program||s,u.groupOrder=a,u.renderOrder=r.renderOrder,u.z=l,u.group=c),n++,u}return{opaque:r,transparent:i,init:function(){n=0,r.length=0,i.length=0},push:function(t,e,n,s,a,l){const c=o(t,e,n,s,a,l);(!0===n.transparent?i:r).push(c)},unshift:function(t,e,n,s,a,l){const c=o(t,e,n,s,a,l);(!0===n.transparent?i:r).unshift(c)},finish:function(){for(let t=n,r=e.length;t<r;t++){const n=e[t];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(t,e){r.length>1&&r.sort(t||va),i.length>1&&i.sort(e||ba)}}}function wa(t){let e=new WeakMap;function n(t){const r=t.target;r.removeEventListener("dispose",n),e.delete(r)}return{get:function(r,i){const s=e.get(r);let o;return void 0===s?(o=new xa(t),e.set(r,new WeakMap),e.get(r).set(i,o),r.addEventListener("dispose",n)):(o=s.get(i),void 0===o&&(o=new xa(t),s.set(i,o))),o},dispose:function(){e=new WeakMap}}}function Sa(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Jn,color:new di};break;case"SpotLight":n={position:new Jn,direction:new Jn,color:new di,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Jn,color:new di,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Jn,skyColor:new di,groundColor:new di};break;case"RectAreaLight":n={color:new di,position:new Jn,halfWidth:new Jn,halfHeight:new Jn}}return t[e.id]=n,n}}}let Ma=0;function Ta(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Ea(){const t=new Sa,e=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new kn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new kn,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)n.probe.push(new Jn);const r=new Jn,i=new ir,s=new ir;return{setup:function(o,a,l){let c=0,u=0,h=0;for(let t=0;t<9;t++)n.probe[t].set(0,0,0);let p=0,d=0,f=0,m=0,_=0,g=0,y=0,v=0;const b=l.matrixWorldInverse;o.sort(Ta);for(let a=0,l=o.length;a<l;a++){const l=o[a],x=l.color,w=l.intensity,S=l.distance,M=l.shadow&&l.shadow.map?l.shadow.map.texture:null;if(l.isAmbientLight)c+=x.r*w,u+=x.g*w,h+=x.b*w;else if(l.isLightProbe)for(let t=0;t<9;t++)n.probe[t].addScaledVector(l.sh.coefficients[t],w);else if(l.isDirectionalLight){const i=t.get(l);if(i.color.copy(l.color).multiplyScalar(l.intensity),i.direction.setFromMatrixPosition(l.matrixWorld),r.setFromMatrixPosition(l.target.matrixWorld),i.direction.sub(r),i.direction.transformDirection(b),l.castShadow){const t=l.shadow,r=e.get(l);r.shadowBias=t.bias,r.shadowNormalBias=t.normalBias,r.shadowRadius=t.radius,r.shadowMapSize=t.mapSize,n.directionalShadow[p]=r,n.directionalShadowMap[p]=M,n.directionalShadowMatrix[p]=l.shadow.matrix,g++}n.directional[p]=i,p++}else if(l.isSpotLight){const i=t.get(l);if(i.position.setFromMatrixPosition(l.matrixWorld),i.position.applyMatrix4(b),i.color.copy(x).multiplyScalar(w),i.distance=S,i.direction.setFromMatrixPosition(l.matrixWorld),r.setFromMatrixPosition(l.target.matrixWorld),i.direction.sub(r),i.direction.transformDirection(b),i.coneCos=Math.cos(l.angle),i.penumbraCos=Math.cos(l.angle*(1-l.penumbra)),i.decay=l.decay,l.castShadow){const t=l.shadow,r=e.get(l);r.shadowBias=t.bias,r.shadowNormalBias=t.normalBias,r.shadowRadius=t.radius,r.shadowMapSize=t.mapSize,n.spotShadow[f]=r,n.spotShadowMap[f]=M,n.spotShadowMatrix[f]=l.shadow.matrix,v++}n.spot[f]=i,f++}else if(l.isRectAreaLight){const e=t.get(l);e.color.copy(x).multiplyScalar(w),e.position.setFromMatrixPosition(l.matrixWorld),e.position.applyMatrix4(b),s.identity(),i.copy(l.matrixWorld),i.premultiply(b),s.extractRotation(i),e.halfWidth.set(.5*l.width,0,0),e.halfHeight.set(0,.5*l.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),n.rectArea[m]=e,m++}else if(l.isPointLight){const r=t.get(l);if(r.position.setFromMatrixPosition(l.matrixWorld),r.position.applyMatrix4(b),r.color.copy(l.color).multiplyScalar(l.intensity),r.distance=l.distance,r.decay=l.decay,l.castShadow){const t=l.shadow,r=e.get(l);r.shadowBias=t.bias,r.shadowNormalBias=t.normalBias,r.shadowRadius=t.radius,r.shadowMapSize=t.mapSize,r.shadowCameraNear=t.camera.near,r.shadowCameraFar=t.camera.far,n.pointShadow[d]=r,n.pointShadowMap[d]=M,n.pointShadowMatrix[d]=l.shadow.matrix,y++}n.point[d]=r,d++}else if(l.isHemisphereLight){const e=t.get(l);e.direction.setFromMatrixPosition(l.matrixWorld),e.direction.transformDirection(b),e.direction.normalize(),e.skyColor.copy(l.color).multiplyScalar(w),e.groundColor.copy(l.groundColor).multiplyScalar(w),n.hemi[_]=e,_++}}n.ambient[0]=c,n.ambient[1]=u,n.ambient[2]=h;const x=n.hash;x.directionalLength===p&&x.pointLength===d&&x.spotLength===f&&x.rectAreaLength===m&&x.hemiLength===_&&x.numDirectionalShadows===g&&x.numPointShadows===y&&x.numSpotShadows===v||(n.directional.length=p,n.spot.length=f,n.rectArea.length=m,n.point.length=d,n.hemi.length=_,n.directionalShadow.length=g,n.directionalShadowMap.length=g,n.pointShadow.length=y,n.pointShadowMap.length=y,n.spotShadow.length=v,n.spotShadowMap.length=v,n.directionalShadowMatrix.length=g,n.pointShadowMatrix.length=y,n.spotShadowMatrix.length=v,x.directionalLength=p,x.pointLength=d,x.spotLength=f,x.rectAreaLength=m,x.hemiLength=_,x.numDirectionalShadows=g,x.numPointShadows=y,x.numSpotShadows=v,n.version=Ma++)},state:n}}function Aa(){const t=new Ea,e=[],n=[];return{init:function(){e.length=0,n.length=0},state:{lightsArray:e,shadowsArray:n,lights:t},setupLights:function(r){t.setup(e,n,r)},pushLight:function(t){e.push(t)},pushShadow:function(t){n.push(t)}}}function $a(){let t=new WeakMap;function e(n){const r=n.target;r.removeEventListener("dispose",e),t.delete(r)}return{get:function(n,r){let i;return!1===t.has(n)?(i=new Aa,t.set(n,new WeakMap),t.get(n).set(r,i),n.addEventListener("dispose",e)):!1===t.get(n).has(r)?(i=new Aa,t.get(n).set(r,i)):i=t.get(n).get(r),i},dispose:function(){t=new WeakMap}}}function Ca(t){vi.call(this),this.type="MeshDepthMaterial",this.depthPacking=sn,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function Ba(t){vi.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Jn,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}Ca.prototype=Object.create(vi.prototype),Ca.prototype.constructor=Ca,Ca.prototype.isMeshDepthMaterial=!0,Ca.prototype.copy=function(t){return vi.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},Ba.prototype=Object.create(vi.prototype),Ba.prototype.constructor=Ba,Ba.prototype.isMeshDistanceMaterial=!0,Ba.prototype.copy=function(t){return vi.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};var La="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",Ra="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function Na(t,e,n){let r=new Ls;const i=new kn,s=new kn,o=new Hn,a=[],l=[],c={},u={0:m,1:f,2:_},p=new xs({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new kn},radius:{value:4}},vertexShader:Ra,fragmentShader:La}),g=p.clone();g.defines.HORIZONAL_PASS=1;const y=new ji;y.setAttribute("position",new Si(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new os(y,p),x=this;function w(n,r){const i=e.update(b);p.uniforms.shadow_pass.value=n.map.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(r,null,i,p,b,null),g.uniforms.shadow_pass.value=n.mapPass.texture,g.uniforms.resolution.value=n.mapSize,g.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(r,null,i,g,b,null)}function S(t,e,n){const r=t<<0|e<<1|n<<2;let i=a[r];return void 0===i&&(i=new Ca({depthPacking:on,morphTargets:t,skinning:e}),a[r]=i),i}function M(t,e,n){const r=t<<0|e<<1|n<<2;let i=l[r];return void 0===i&&(i=new Ba({morphTargets:t,skinning:e}),l[r]=i),i}function T(e,n,r,i,s,o,a){let l=null,h=S,p=e.customDepthMaterial;if(!0===i.isPointLight&&(h=M,p=e.customDistanceMaterial),void 0===p){let t=!1;!0===r.morphTargets&&(t=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let i=!1;!0===e.isSkinnedMesh&&(!0===r.skinning?i=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e)),l=h(t,i,!0===e.isInstancedMesh)}else l=p;if(t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){const t=l.uuid,e=r.uuid;let n=c[t];void 0===n&&(n={},c[t]=n);let i=n[e];void 0===i&&(i=l.clone(),n[e]=i),l=i}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=a===d?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:u[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,!0===i.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(i.matrixWorld),l.nearDistance=s,l.farDistance=o),l}function E(n,i,s,o,a){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===d)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const r=e.update(n),i=n.material;if(Array.isArray(i)){const e=r.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],u=i[c.materialIndex];if(u&&u.visible){const e=T(n,r,u,o,s.near,s.far,a);t.renderBufferDirect(s,null,r,e,n,c)}}}else if(i.visible){const e=T(n,r,i,o,s.near,s.far,a);t.renderBufferDirect(s,null,r,e,n,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)E(l[t],i,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=h,this.render=function(e,a,l){if(!1===x.enabled)return;if(!1===x.autoUpdate&&!1===x.needsUpdate)return;if(0===e.length)return;const c=t.getRenderTarget(),u=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),p=t.state;p.setBlending(v),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(let c=0,u=e.length;c<u;c++){const u=e[c],h=u.shadow;if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;if(void 0===h){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}i.copy(h.mapSize);const f=h.getFrameExtents();if(i.multiply(f),s.copy(h.mapSize),(i.x>n||i.y>n)&&(i.x>n&&(s.x=Math.floor(n/f.x),i.x=s.x*f.x,h.mapSize.x=s.x),i.y>n&&(s.y=Math.floor(n/f.y),i.y=s.y*f.y,h.mapSize.y=s.y)),null===h.map&&!h.isPointLightShadow&&this.type===d){const t={minFilter:vt,magFilter:vt,format:kt,stencilBuffer:!1};h.map=new Vn(i.x,i.y,t),h.map.texture.name=u.name+".shadowMap",h.mapPass=new Vn(i.x,i.y,t),h.camera.updateProjectionMatrix()}if(null===h.map){const t={minFilter:ft,magFilter:ft,format:kt,stencilBuffer:!1};h.map=new Vn(i.x,i.y,t),h.map.texture.name=u.name+".shadowMap",h.camera.updateProjectionMatrix()}t.setRenderTarget(h.map),t.clear();const m=h.getViewportCount();for(let t=0;t<m;t++){const e=h.getViewport(t);o.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),p.viewport(o),h.updateMatrices(u,t),r=h.getFrustum(),E(a,l,h.camera,u,this.type)}h.isPointLightShadow||this.type!==d||w(h,l),h.needsUpdate=!1}x.needsUpdate=!1,t.setRenderTarget(c,u,h)}}function Pa(t,e,n){const r=n.isWebGL2,i=new function(){let e=!1;const n=new Hn;let r=null;const i=new Hn(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,s,o,a){!0===a&&(e*=o,r*=o,s*=o),n.set(e,r,s,o),!1===i.equals(n)&&(t.clearColor(e,r,s,o),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},s=new function(){let e=!1,n=null,r=null,i=null;return{setTest:function(t){t?ft(2929):mt(2929)},setMask:function(r){n===r||e||(t.depthMask(r),n=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case z:t.depthFunc(512);break;case j:t.depthFunc(519);break;case G:t.depthFunc(513);break;case H:t.depthFunc(515);break;case V:t.depthFunc(514);break;case W:t.depthFunc(518);break;case q:t.depthFunc(516);break;case X:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);r=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,n=null,r=null,i=null}}},c=new function(){let e=!1,n=null,r=null,i=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(t){e||(t?ft(2960):mt(2960))},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,o){r===e&&i===n&&s===o||(t.stencilFunc(e,n,o),r=e,i=n,s=o)},setOp:function(e,n,r){o===e&&a===n&&l===r||(t.stencilOp(e,n,r),o=e,a=n,l=r)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,r=null,i=null,s=null,o=null,a=null,l=null,c=null}}};let u={},h=null,p=null,d=null,f=null,g=null,y=null,Y=null,J=null,Z=null,Q=!1,K=null,tt=null,et=null,nt=null,rt=null;const it=t.getParameter(35661);let st=!1,ot=0;const at=t.getParameter(7938);-1!==at.indexOf("WebGL")?(ot=parseFloat(/^WebGL\ ([0-9])/.exec(at)[1]),st=ot>=1):-1!==at.indexOf("OpenGL ES")&&(ot=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(at)[1]),st=ot>=2);let lt=null,ct={};const ut=new Hn,ht=new Hn;function pt(e,n,r){const i=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<r;e++)t.texImage2D(n+e,0,6408,1,1,0,6408,5121,i);return s}const dt={};function ft(e){!0!==u[e]&&(t.enable(e),u[e]=!0)}function mt(e){!1!==u[e]&&(t.disable(e),u[e]=!1)}dt[3553]=pt(3553,3553,1),dt[34067]=pt(34067,34069,6),i.setClear(0,0,0,1),s.setClear(1),c.setClear(0),ft(2929),s.setFunc(H),vt(!1),bt(a),ft(2884),yt(v);const _t={[T]:32774,[E]:32778,[A]:32779};if(r)_t[$]=32775,_t[C]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(_t[$]=t.MIN_EXT,_t[C]=t.MAX_EXT)}const gt={[B]:0,[L]:1,[R]:768,[P]:770,[U]:776,[k]:774,[O]:772,[N]:769,[I]:771,[D]:775,[F]:773};function yt(e,n,r,i,s,o,a,l){if(e!==v){if(p||(ft(3042),p=!0),e===M)s=s||n,o=o||r,a=a||i,n===f&&s===Y||(t.blendEquationSeparate(_t[n],_t[s]),f=n,Y=s),r===g&&i===y&&o===J&&a===Z||(t.blendFuncSeparate(gt[r],gt[i],gt[o],gt[a]),g=r,y=i,J=o,Z=a),d=e,Q=null;else if(e!==d||l!==Q){if(f===T&&Y===T||(t.blendEquation(32774),f=T,Y=T),l)switch(e){case b:t.blendFuncSeparate(1,771,1,771);break;case x:t.blendFunc(1,1);break;case w:t.blendFuncSeparate(0,0,769,771);break;case S:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case b:t.blendFuncSeparate(770,771,1,771);break;case x:t.blendFunc(770,1);break;case w:t.blendFunc(0,769);break;case S:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}g=null,y=null,J=null,Z=null,d=e,Q=l}}else p&&(mt(3042),p=!1)}function vt(e){K!==e&&(e?t.frontFace(2304):t.frontFace(2305),K=e)}function bt(e){e!==o?(ft(2884),e!==tt&&(e===a?t.cullFace(1029):e===l?t.cullFace(1028):t.cullFace(1032))):mt(2884),tt=e}function xt(e,n,r){e?(ft(32823),nt===n&&rt===r||(t.polygonOffset(n,r),nt=n,rt=r)):mt(32823)}function wt(e){void 0===e&&(e=33984+it-1),lt!==e&&(t.activeTexture(e),lt=e)}return{buffers:{color:i,depth:s,stencil:c},enable:ft,disable:mt,useProgram:function(e){return h!==e&&(t.useProgram(e),h=e,!0)},setBlending:yt,setMaterial:function(t,e){t.side===_?mt(2884):ft(2884);let n=t.side===m;e&&(n=!n),vt(n),t.blending===b&&!1===t.transparent?yt(v):yt(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),i.setMask(t.colorWrite);const r=t.stencilWrite;c.setTest(r),r&&(c.setMask(t.stencilWriteMask),c.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),c.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),xt(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:vt,setCullFace:bt,setLineWidth:function(e){e!==et&&(st&&t.lineWidth(e),et=e)},setPolygonOffset:xt,setScissorTest:function(t){t?ft(3089):mt(3089)},activeTexture:wt,bindTexture:function(e,n){null===lt&&wt();let r=ct[lt];void 0===r&&(r={type:void 0,texture:void 0},ct[lt]=r),r.type===e&&r.texture===n||(t.bindTexture(e,n||dt[e]),r.type=e,r.texture=n)},unbindTexture:function(){const e=ct[lt];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===ut.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),ut.copy(e))},viewport:function(e){!1===ht.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),ht.copy(e))},reset:function(){u={},lt=null,ct={},h=null,d=null,K=null,tt=null,i.reset(),s.reset(),c.reset()}}}function Ia(t,e,n,r,i,s,o){const a=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,h=i.maxSamples,p=new WeakMap;let d,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function m(t,e){return f?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function _(t,e,n,r){let i=1;if((t.width>r||t.height>r)&&(i=r/Math.max(t.width,t.height)),i<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const r=e?Fn.floorPowerOfTwo:Math.floor,s=r(i*t.width),o=r(i*t.height);void 0===d&&(d=m(s,o));const a=n?m(s,o):d;return a.width=s,a.height=o,a.getContext("2d").drawImage(t,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+o+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function g(t){return Fn.isPowerOfTwo(t.width)&&Fn.isPowerOfTwo(t.height)}function y(t,e){return t.generateMipmaps&&e&&t.minFilter!==ft&&t.minFilter!==vt}function v(e,n,i,s){t.generateMipmap(e),r.get(n).__maxMipLevel=Math.log(Math.max(i,s))*Math.LOG2E}function b(n,r,i){if(!1===a)return r;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let s=r;return 6403===r&&(5126===i&&(s=33326),5131===i&&(s=33325),5121===i&&(s=33321)),6407===r&&(5126===i&&(s=34837),5131===i&&(s=34843),5121===i&&(s=32849)),6408===r&&(5126===i&&(s=34836),5131===i&&(s=34842),5121===i&&(s=32856)),33325!==s&&33326!==s&&34842!==s&&34836!==s||e.get("EXT_color_buffer_float"),s}function x(t){return t===ft||t===mt||t===gt?9728:9729}function w(e){const n=e.target;n.removeEventListener("dispose",w),function(e){const n=r.get(e);void 0!==n.__webglInit&&(t.deleteTexture(n.__webglTexture),r.remove(e))}(n),n.isVideoTexture&&p.delete(n),o.memory.textures--}function S(e){const n=e.target;n.removeEventListener("dispose",S),function(e){const n=r.get(e),i=r.get(e.texture);if(e){if(void 0!==i.__webglTexture&&t.deleteTexture(i.__webglTexture),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(n.__webglFramebuffer[e]),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[e]);else t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&t.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer);r.remove(e.texture),r.remove(e)}}(n),o.memory.textures--}let M=0;function T(t,e){const i=r.get(t);if(t.isVideoTexture&&function(t){const e=o.render.frame;p.get(t)!==e&&(p.set(t,e),t.update())}(t),t.version>0&&i.__version!==t.version){const n=t.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void R(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,i.__webglTexture)}function E(e,i){if(6!==e.image.length)return;const o=r.get(e);if(e.version>0&&o.__version!==e.version){L(o,e),n.activeTexture(33984+i),n.bindTexture(34067,o.__webglTexture),t.pixelStorei(37440,e.flipY);const r=e&&(e.isCompressedTexture||e.image[0].isCompressedTexture),l=e.image[0]&&e.image[0].isDataTexture,u=[];for(let t=0;t<6;t++)u[t]=r||l?l?e.image[t].image:e.image[t]:_(e.image[t],!1,!0,c);const h=u[0],p=g(h)||a,d=s.convert(e.format),f=s.convert(e.type),m=b(e.internalFormat,d,f);let x;if(B(34067,e,p),r){for(let t=0;t<6;t++){x=u[t].mipmaps;for(let r=0;r<x.length;r++){const i=x[r];e.format!==kt&&e.format!==Ft?null!==d?n.compressedTexImage2D(34069+t,r,m,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+t,r,m,i.width,i.height,0,d,f,i.data)}}o.__maxMipLevel=x.length-1}else{x=e.mipmaps;for(let t=0;t<6;t++)if(l){n.texImage2D(34069+t,0,m,u[t].width,u[t].height,0,d,f,u[t].data);for(let e=0;e<x.length;e++){const r=x[e].image[t].image;n.texImage2D(34069+t,e+1,m,r.width,r.height,0,d,f,r.data)}}else{n.texImage2D(34069+t,0,m,d,f,u[t]);for(let e=0;e<x.length;e++){const r=x[e];n.texImage2D(34069+t,e+1,m,d,f,r.image[t])}}o.__maxMipLevel=x.length}y(e,p)&&v(34067,e,h.width,h.height),o.__version=e.version,e.onUpdate&&e.onUpdate(e)}else n.activeTexture(33984+i),n.bindTexture(34067,o.__webglTexture)}function A(t,e){n.activeTexture(33984+e),n.bindTexture(34067,r.get(t).__webglTexture)}const $={[ht]:10497,[pt]:33071,[dt]:33648},C={[ft]:9728,[mt]:9984,[gt]:9986,[vt]:9729,[bt]:9985,[wt]:9987};function B(n,s,o){o?(t.texParameteri(n,10242,$[s.wrapS]),t.texParameteri(n,10243,$[s.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,$[s.wrapR]),t.texParameteri(n,10240,C[s.magFilter]),t.texParameteri(n,10241,C[s.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),s.wrapS===pt&&s.wrapT===pt||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,x(s.magFilter)),t.texParameteri(n,10241,x(s.minFilter)),s.minFilter!==ft&&s.minFilter!==vt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const l=e.get("EXT_texture_filter_anisotropic");if(l){if(s.type===Bt&&null===e.get("OES_texture_float_linear"))return;if(s.type===Lt&&null===(a||e.get("OES_texture_half_float_linear")))return;(s.anisotropy>1||r.get(s).__currentAnisotropy)&&(t.texParameterf(n,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,i.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy)}}function L(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",w),e.__webglTexture=t.createTexture(),o.memory.textures++)}function R(e,r,i){let o=3553;r.isDataTexture2DArray&&(o=35866),r.isDataTexture3D&&(o=32879),L(e,r),n.activeTexture(33984+i),n.bindTexture(o,e.__webglTexture),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment);const l=function(t){return!a&&(t.wrapS!==pt||t.wrapT!==pt||t.minFilter!==ft&&t.minFilter!==vt)}(r)&&!1===g(r.image),c=_(r.image,l,!1,u),h=g(c)||a,p=s.convert(r.format);let d,f=s.convert(r.type),m=b(r.internalFormat,p,f);B(o,r,h);const x=r.mipmaps;if(r.isDepthTexture)m=6402,a?m=r.type===Bt?36012:r.type===Ct?33190:r.type===It?35056:33189:r.type===Bt&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===jt&&6402===m&&r.type!==At&&r.type!==Ct&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=At,f=s.convert(r.type)),r.format===Gt&&6402===m&&(m=34041,r.type!==It&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=It,f=s.convert(r.type))),n.texImage2D(3553,0,m,c.width,c.height,0,p,f,null);else if(r.isDataTexture)if(x.length>0&&h){for(let t=0,e=x.length;t<e;t++)d=x[t],n.texImage2D(3553,t,m,d.width,d.height,0,p,f,d.data);r.generateMipmaps=!1,e.__maxMipLevel=x.length-1}else n.texImage2D(3553,0,m,c.width,c.height,0,p,f,c.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(let t=0,e=x.length;t<e;t++)d=x[t],r.format!==kt&&r.format!==Ft?null!==p?n.compressedTexImage2D(3553,t,m,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,t,m,d.width,d.height,0,p,f,d.data);e.__maxMipLevel=x.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,m,c.width,c.height,c.depth,0,p,f,c.data),e.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,m,c.width,c.height,c.depth,0,p,f,c.data),e.__maxMipLevel=0;else if(x.length>0&&h){for(let t=0,e=x.length;t<e;t++)d=x[t],n.texImage2D(3553,t,m,p,f,d);r.generateMipmaps=!1,e.__maxMipLevel=x.length-1}else n.texImage2D(3553,0,m,p,f,c),e.__maxMipLevel=0;y(r,h)&&v(o,r,c.width,c.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function N(e,i,o,a){const l=s.convert(i.texture.format),c=s.convert(i.texture.type),u=b(i.texture.internalFormat,l,c);n.texImage2D(a,0,u,i.width,i.height,0,l,c,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,o,a,r.get(i.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function P(e,n,r){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let i=33189;if(r){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===Bt?i=36012:e.type===Ct&&(i=33190));const r=I(n);t.renderbufferStorageMultisample(36161,r,i,n.width,n.height)}else t.renderbufferStorage(36161,i,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){if(r){const e=I(n);t.renderbufferStorageMultisample(36161,e,35056,n.width,n.height)}else t.renderbufferStorage(36161,34041,n.width,n.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=s.convert(n.texture.format),i=s.convert(n.texture.type),o=b(n.texture.internalFormat,e,i);if(r){const e=I(n);t.renderbufferStorageMultisample(36161,e,o,n.width,n.height)}else t.renderbufferStorage(36161,o,n.width,n.height)}t.bindRenderbuffer(36161,null)}function I(t){return a&&t.isWebGLMultisampleRenderTarget?Math.min(h,t.samples):0}let O=!1,F=!1;this.allocateTextureUnit=function(){const t=M;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),M+=1,t},this.resetTextureUnits=function(){M=0},this.setTexture2D=T,this.setTexture2DArray=function(t,e){const i=r.get(t);t.version>0&&i.__version!==t.version?R(i,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(t,e){const i=r.get(t);t.version>0&&i.__version!==t.version?R(i,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=E,this.setTextureCubeDynamic=A,this.setupRenderTarget=function(e){const i=r.get(e),l=r.get(e.texture);e.addEventListener("dispose",S),l.__webglTexture=t.createTexture(),o.memory.textures++;const c=!0===e.isWebGLCubeRenderTarget,u=!0===e.isWebGLMultisampleRenderTarget,h=g(e)||a;if(!a||e.texture.format!==Ft||e.texture.type!==Bt&&e.texture.type!==Lt||(e.texture.format=kt,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),c){i.__webglFramebuffer=[];for(let e=0;e<6;e++)i.__webglFramebuffer[e]=t.createFramebuffer()}else if(i.__webglFramebuffer=t.createFramebuffer(),u)if(a){i.__webglMultisampledFramebuffer=t.createFramebuffer(),i.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,i.__webglColorRenderbuffer);const n=s.convert(e.texture.format),r=s.convert(e.texture.type),o=b(e.texture.internalFormat,n,r),a=I(e);t.renderbufferStorageMultisample(36161,a,o,e.width,e.height),t.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(i.__webglDepthRenderbuffer=t.createRenderbuffer(),P(i.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(c){n.bindTexture(34067,l.__webglTexture),B(34067,e.texture,h);for(let t=0;t<6;t++)N(i.__webglFramebuffer[t],e,36064,34069+t);y(e.texture,h)&&v(34067,e.texture,e.width,e.height),n.bindTexture(34067,null)}else n.bindTexture(3553,l.__webglTexture),B(3553,e.texture,h),N(i.__webglFramebuffer,e,36064,3553),y(e.texture,h)&&v(3553,e.texture,e.width,e.height),n.bindTexture(3553,null);e.depthBuffer&&function(e){const n=r.get(e),i=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),T(n.depthTexture,0);const i=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===jt)t.framebufferTexture2D(36160,36096,3553,i,0);else{if(n.depthTexture.format!==Gt)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,i,0)}}(n.__webglFramebuffer,e)}else if(i){n.__webglDepthbuffer=[];for(let r=0;r<6;r++)t.bindFramebuffer(36160,n.__webglFramebuffer[r]),n.__webglDepthbuffer[r]=t.createRenderbuffer(),P(n.__webglDepthbuffer[r],e,!1)}else t.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=t.createRenderbuffer(),P(n.__webglDepthbuffer,e,!1);t.bindFramebuffer(36160,null)}(e)},this.updateRenderTargetMipmap=function(t){const e=t.texture;if(y(e,g(t)||a)){const i=t.isWebGLCubeRenderTarget?34067:3553,s=r.get(e).__webglTexture;n.bindTexture(i,s),v(i,e,t.width,t.height),n.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(a){const n=r.get(e);t.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,n.__webglFramebuffer);const i=e.width,s=e.height;let o=16384;e.depthBuffer&&(o|=256),e.stencilBuffer&&(o|=1024),t.blitFramebuffer(0,0,i,s,0,0,i,s,o,9728),t.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===O&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),O=!0),t=t.texture),T(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),F=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?E(t,e):A(t,e)}}function Oa(t,e,n){const r=n.isWebGL2;return{convert:function(t){let n;if(t===Mt)return 5121;if(t===Rt)return 32819;if(t===Nt)return 32820;if(t===Pt)return 33635;if(t===Tt)return 5120;if(t===Et)return 5122;if(t===At)return 5123;if(t===$t)return 5124;if(t===Ct)return 5125;if(t===Bt)return 5126;if(t===Lt)return r?5131:(n=e.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(t===Ot)return 6406;if(t===Ft)return 6407;if(t===kt)return 6408;if(t===Dt)return 6409;if(t===Ut)return 6410;if(t===jt)return 6402;if(t===Gt)return 34041;if(t===Ht)return 6403;if(t===Vt)return 36244;if(t===Wt)return 33319;if(t===qt)return 33320;if(t===Xt)return 36248;if(t===Yt)return 36249;if(t===Jt||t===Zt||t===Qt||t===Kt){if(n=e.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(t===Jt)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Zt)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Qt)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Kt)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===te||t===ee||t===ne||t===re){if(n=e.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(t===te)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===ee)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===ne)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===re)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===ie)return n=e.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===se||t===oe)&&(n=e.get("WEBGL_compressed_texture_etc"),null!==n)){if(t===se)return n.COMPRESSED_RGB8_ETC2;if(t===oe)return n.COMPRESSED_RGBA8_ETC2_EAC}return t===ae||t===le||t===ce||t===ue||t===he||t===pe||t===de||t===fe||t===me||t===_e||t===ge||t===ye||t===ve||t===be||t===we||t===Se||t===Me||t===Te||t===Ee||t===Ae||t===$e||t===Ce||t===Be||t===Le||t===Re||t===Ne||t===Pe||t===Ie?(n=e.get("WEBGL_compressed_texture_astc"),null!==n?t:null):t===xe?(n=e.get("EXT_texture_compression_bptc"),null!==n?t:null):t===It?r?34042:(n=e.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function Fa(t){Ss.call(this),this.cameras=t||[]}function ka(){wr.call(this),this.type="Group"}function Da(){this._targetRay=null,this._grip=null,this._hand=null}function Ua(t,e){const n=this;let r=null,i=1,s=null,o="local-floor",a=null;const l=[],c=new Map,u=new Ss;u.layers.enable(1),u.viewport=new Hn;const h=new Ss;h.layers.enable(2),h.viewport=new Hn;const p=[u,h],d=new Fa;d.layers.enable(1),d.layers.enable(2);let f=null,m=null;function _(t){const e=c.get(t.inputSource);e&&e.dispatchEvent({type:t.type})}function g(){c.forEach((function(t,e){t.disconnect(e)})),c.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),M.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function y(t){s=t,M.setContext(r),M.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function v(t){const e=r.inputSources;for(let t=0;t<l.length;t++)c.set(e[t],l[t]);for(let e=0;e<t.removed.length;e++){const n=t.removed[e],r=c.get(n);r&&(r.dispatchEvent({type:"disconnected",data:n}),c.delete(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e],r=c.get(n);r&&r.dispatchEvent({type:"connected",data:n})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=l[t];return void 0===e&&(e=new Da,l[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=l[t];return void 0===e&&(e=new Da,l[t]=e),e.getGripSpace()},this.getHand=function(t){let e=l[t];return void 0===e&&(e=new Da,l[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){i=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getSession=function(){return r},this.setSession=function(t){if(r=t,null!==r){r.addEventListener("select",_),r.addEventListener("selectstart",_),r.addEventListener("selectend",_),r.addEventListener("squeeze",_),r.addEventListener("squeezestart",_),r.addEventListener("squeezeend",_),r.addEventListener("end",g);const t=e.getContextAttributes();!0!==t.xrCompatible&&e.makeXRCompatible();const n={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:i},s=new XRWebGLLayer(r,e,n);r.updateRenderState({baseLayer:s}),r.requestReferenceSpace(o).then(y),r.addEventListener("inputsourceschange",v)}};const b=new Jn,x=new Jn;function w(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}this.getCamera=function(t){d.near=h.near=u.near=t.near,d.far=h.far=u.far=t.far,f===d.near&&m===d.far||(r.updateRenderState({depthNear:d.near,depthFar:d.far}),f=d.near,m=d.far);const e=t.parent,n=d.cameras;w(d,e);for(let t=0;t<n.length;t++)w(n[t],e);t.matrixWorld.copy(d.matrixWorld);const i=t.children;for(let t=0,e=i.length;t<e;t++)i[t].updateMatrixWorld(!0);return 2===n.length?function(t,e,n){b.setFromMatrixPosition(e.matrixWorld),x.setFromMatrixPosition(n.matrixWorld);const r=b.distanceTo(x),i=e.projectionMatrix.elements,s=n.projectionMatrix.elements,o=i[14]/(i[10]-1),a=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(s[8]+1)/s[0],p=o*u,d=o*h,f=r/(-u+h),m=f*-u;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);const _=o+f,g=a+f,y=p-m,v=d+(r-m),w=l*a/g*_,S=c*a/g*_;t.projectionMatrix.makePerspective(y,v,w,S,_,g)}(d,u,h):d.projectionMatrix.copy(u.projectionMatrix),d};let S=null;const M=new Ns;M.setAnimationLoop((function(e,n){if(a=n.getViewerPose(s),null!==a){const e=a.views,n=r.renderState.baseLayer;t.setFramebuffer(n.framebuffer);let i=!1;e.length!==d.cameras.length&&(d.cameras.length=0,i=!0);for(let t=0;t<e.length;t++){const r=e[t],s=n.getViewport(r),o=p[t];o.matrix.fromArray(r.transform.matrix),o.projectionMatrix.fromArray(r.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===t&&d.matrix.copy(o.matrix),!0===i&&d.cameras.push(o)}}const i=r.inputSources;for(let t=0;t<l.length;t++){const e=l[t],r=i[t];e.update(r,n,s)}S&&S(e,n)})),this.setAnimationLoop=function(t){S=t},this.dispose=function(){}}function za(t){function e(e,n,r){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap);const i=n.envMap||r;if(i){e.envMap.value=i,e.flipEnvMap.value=i.isCubeTexture?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio;var s=t.get(i).__maxMipLevel;void 0!==s&&(e.maxMipLevel.value=s)}let o,a;n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?o=n.map:n.specularMap?o=n.specularMap:n.displacementMap?o=n.displacementMap:n.normalMap?o=n.normalMap:n.bumpMap?o=n.bumpMap:n.roughnessMap?o=n.roughnessMap:n.metalnessMap?o=n.metalnessMap:n.alphaMap?o=n.alphaMap:n.emissiveMap&&(o=n.emissiveMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),e.uvTransform.value.copy(o.matrix)),n.aoMap?a=n.aoMap:n.lightMap&&(a=n.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),e.uv2Transform.value.copy(a.matrix))}function n(t,e,n){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),(e.envMap||n)&&(t.envMapIntensity.value=e.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,r,i,s,o){r.isMeshBasicMaterial?e(t,r):r.isMeshLambertMaterial?(e(t,r),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,r)):r.isMeshToonMaterial?(e(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshPhongMaterial?(e(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshStandardMaterial?(e(t,r,i),r.isMeshPhysicalMaterial?function(t,e,r){n(t,e,r),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen),e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===m&&t.clearcoatNormalScale.value.negate()),t.transmission.value=e.transmission,e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap)}(t,r,i):n(t,r,i)):r.isMeshMatcapMaterial?(e(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDepthMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDistanceMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,r)):r.isMeshNormalMaterial?(e(t,r),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,n,r){let i;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*r,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?i=e.map:e.alphaMap&&(i=e.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,r,s,o):r.isSpriteMaterial?function(t,e){let n;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?n=e.map:e.alphaMap&&(n=e.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function ja(t){const e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==t.context?t.context:null,r=void 0!==t.alpha&&t.alpha,i=void 0===t.depth||t.depth,s=void 0===t.stencil||t.stencil,o=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.powerPreference?t.powerPreference:"default",u=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let h=null,p=null;this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Je,this.physicallyCorrectLights=!1,this.toneMapping=Q,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const d=this;let f=!1,m=null,_=0,g=0,y=null,v=null,b=-1,x=null,w=null;const S=new Hn,M=new Hn;let T=null,E=e.width,A=e.height,$=1,C=null,B=null;const L=new Hn(0,0,E,A),R=new Hn(0,0,E,A);let N=!1;const P=new Ls,I=new Gs;let O=!1,F=!1;const k=new ir,D=new Jn,U={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function z(){return null===y?$:1}let j,G,H,V,W,q,X,Y,J,Z,K,tt,et,nt,rt,it,st,ot,at,lt=n;function ct(t,n){for(let r=0;r<t.length;r++){const i=t[r],s=e.getContext(i,n);if(null!==s)return s}return null}try{const t={alpha:r,depth:i,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(e.addEventListener("webglcontextlost",dt,!1),e.addEventListener("webglcontextrestored",ft,!1),null===lt){const e=["webgl2","webgl","experimental-webgl"];if(!0===d.isWebGL1Renderer&&e.shift(),lt=ct(e,t),null===lt)throw ct(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===lt.getShaderPrecisionFormat&&(lt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function ut(){j=new Hs(lt),G=new js(lt,j,t),!1===G.isWebGL2&&(j.get("WEBGL_depth_texture"),j.get("OES_texture_float"),j.get("OES_texture_half_float"),j.get("OES_texture_half_float_linear"),j.get("OES_standard_derivatives"),j.get("OES_element_index_uint"),j.get("OES_vertex_array_object"),j.get("ANGLE_instanced_arrays")),j.get("OES_texture_float_linear"),ot=new Oa(lt,j,G),H=new Pa(lt,j,G),H.scissor(M.copy(R).multiplyScalar($).floor()),H.viewport(S.copy(L).multiplyScalar($).floor()),V=new qs(lt),W=new ya,q=new Ia(lt,j,H,W,G,ot,V),X=new Ps(lt,G),at=new Us(lt,j,X,G),Y=new Vs(lt,X,V,at),J=new Zs(lt,Y,X,V),rt=new Js(lt),Z=new ga(d,j,G,at),K=new za(W),tt=new wa(W),et=new $a,nt=new Ds(d,H,J,a),it=new zs(lt,j,V,G),st=new Ws(lt,j,V,G),V.programs=Z.programs,d.capabilities=G,d.extensions=j,d.properties=W,d.renderLists=tt,d.state=H,d.info=V}ut();const ht=new Ua(d,lt);this.xr=ht;const pt=new Na(d,J,G.maxTextureSize);function dt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),f=!0}function ft(){console.log("THREE.WebGLRenderer: Context Restored."),f=!1,ut()}function mt(t){const e=t.target;e.removeEventListener("dispose",mt),function(t){_t(t),W.remove(t)}(e)}function _t(t){const e=W.get(t).program;void 0!==e&&Z.releaseProgram(e)}this.shadowMap=pt,this.getContext=function(){return lt},this.getContextAttributes=function(){return lt.getContextAttributes()},this.forceContextLoss=function(){const t=j.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=j.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return $},this.setPixelRatio=function(t){void 0!==t&&($=t,this.setSize(E,A,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new kn),t.set(E,A)},this.setSize=function(t,n,r){ht.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(E=t,A=n,e.width=Math.floor(t*$),e.height=Math.floor(n*$),!1!==r&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new kn),t.set(E*$,A*$).floor()},this.setDrawingBufferSize=function(t,n,r){E=t,A=n,$=r,e.width=Math.floor(t*r),e.height=Math.floor(n*r),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new Hn),t.copy(S)},this.getViewport=function(t){return t.copy(L)},this.setViewport=function(t,e,n,r){t.isVector4?L.set(t.x,t.y,t.z,t.w):L.set(t,e,n,r),H.viewport(S.copy(L).multiplyScalar($).floor())},this.getScissor=function(t){return t.copy(R)},this.setScissor=function(t,e,n,r){t.isVector4?R.set(t.x,t.y,t.z,t.w):R.set(t,e,n,r),H.scissor(M.copy(R).multiplyScalar($).floor())},this.getScissorTest=function(){return N},this.setScissorTest=function(t){H.setScissorTest(N=t)},this.setOpaqueSort=function(t){C=t},this.setTransparentSort=function(t){B=t},this.getClearColor=function(){return nt.getClearColor()},this.setClearColor=function(){nt.setClearColor.apply(nt,arguments)},this.getClearAlpha=function(){return nt.getClearAlpha()},this.setClearAlpha=function(){nt.setClearAlpha.apply(nt,arguments)},this.clear=function(t,e,n){let r=0;(void 0===t||t)&&(r|=16384),(void 0===e||e)&&(r|=256),(void 0===n||n)&&(r|=1024),lt.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",dt,!1),e.removeEventListener("webglcontextrestored",ft,!1),tt.dispose(),et.dispose(),W.dispose(),J.dispose(),at.dispose(),ht.dispose(),yt.stop()},this.renderBufferImmediate=function(t,e){at.initAttributes();const n=W.get(t);t.hasPositions&&!n.position&&(n.position=lt.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=lt.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=lt.createBuffer()),t.hasColors&&!n.color&&(n.color=lt.createBuffer());const r=e.getAttributes();t.hasPositions&&(lt.bindBuffer(34962,n.position),lt.bufferData(34962,t.positionArray,35048),at.enableAttribute(r.position),lt.vertexAttribPointer(r.position,3,5126,!1,0,0)),t.hasNormals&&(lt.bindBuffer(34962,n.normal),lt.bufferData(34962,t.normalArray,35048),at.enableAttribute(r.normal),lt.vertexAttribPointer(r.normal,3,5126,!1,0,0)),t.hasUvs&&(lt.bindBuffer(34962,n.uv),lt.bufferData(34962,t.uvArray,35048),at.enableAttribute(r.uv),lt.vertexAttribPointer(r.uv,2,5126,!1,0,0)),t.hasColors&&(lt.bindBuffer(34962,n.color),lt.bufferData(34962,t.colorArray,35048),at.enableAttribute(r.color),lt.vertexAttribPointer(r.color,3,5126,!1,0,0)),at.disableUnusedAttributes(),lt.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,r,i,s){null===e&&(e=U);const o=i.isMesh&&i.matrixWorld.determinant()<0,a=St(t,e,r,i);H.setMaterial(r,o);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,h=1;!0===r.wireframe&&(l=Y.getWireframeAttribute(n),h=2),(r.morphTargets||r.morphNormals)&&rt.update(i,n,r,a),at.setup(i,r,a,n,l);let p=it;null!==l&&(u=X.get(l),p=st,p.setIndex(u));const d=null!==l?l.count:c.count,f=n.drawRange.start*h,m=n.drawRange.count*h,_=null!==s?s.start*h:0,g=null!==s?s.count*h:1/0,y=Math.max(f,_),v=Math.min(d,f+m,_+g)-1,b=Math.max(0,v-y+1);if(0!==b){if(i.isMesh)!0===r.wireframe?(H.setLineWidth(r.wireframeLinewidth*z()),p.setMode(1)):p.setMode(4);else if(i.isLine){let t=r.linewidth;void 0===t&&(t=1),H.setLineWidth(t*z()),i.isLineSegments?p.setMode(1):i.isLineLoop?p.setMode(2):p.setMode(3)}else i.isPoints?p.setMode(0):i.isSprite&&p.setMode(4);if(i.isInstancedMesh)p.renderInstances(y,b,i.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);p.renderInstances(y,b,t)}else p.render(y,b)}},this.compile=function(t,e){p=et.get(t,e),p.init(),t.traverse((function(t){t.isLight&&(p.pushLight(t),t.castShadow&&p.pushShadow(t))})),p.setupLights(e);const n=new WeakMap;t.traverse((function(e){let r=e.material;if(r)if(Array.isArray(r))for(let i=0;i<r.length;i++){let s=r[i];!1===n.has(s)&&(wt(s,t,e),n.set(s))}else!1===n.has(r)&&(wt(r,t,e),n.set(r))}))};let gt=null;const yt=new Ns;function vt(t,e,n,r){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)p.pushLight(t),t.castShadow&&p.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||P.intersectsSprite(t)){r&&D.setFromMatrixPosition(t.matrixWorld).applyMatrix4(k);const e=J.update(t),i=t.material;i.visible&&h.push(t,e,i,n,D.z,null)}}else if(t.isImmediateRenderObject)r&&D.setFromMatrixPosition(t.matrixWorld).applyMatrix4(k),h.push(t,null,t.material,n,D.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==V.render.frame&&(t.skeleton.update(),t.skeleton.frame=V.render.frame),!t.frustumCulled||P.intersectsObject(t))){r&&D.setFromMatrixPosition(t.matrixWorld).applyMatrix4(k);const e=J.update(t),i=t.material;if(Array.isArray(i)){const r=e.groups;for(let s=0,o=r.length;s<o;s++){const o=r[s],a=i[o.materialIndex];a&&a.visible&&h.push(t,e,a,n,D.z,o)}}else i.visible&&h.push(t,e,i,n,D.z,null)}const i=t.children;for(let t=0,s=i.length;t<s;t++)vt(i[t],e,n,r)}function bt(t,e,n){const r=!0===e.isScene?e.overrideMaterial:null;for(let i=0,s=t.length;i<s;i++){const s=t[i],o=s.object,a=s.geometry,l=null===r?s.material:r,c=s.group;if(n.isArrayCamera){w=n;const t=n.cameras;for(let n=0,r=t.length;n<r;n++){const r=t[n];o.layers.test(r.layers)&&(H.viewport(S.copy(r.viewport)),p.setupLights(r),xt(o,e,r,a,l,c))}}else w=null,xt(o,e,n,a,l,c)}}function xt(t,e,n,r,i,s){if(t.onBeforeRender(d,e,n,r,i,s),p=et.get(e,w||n),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){const r=St(n,e,i,t);H.setMaterial(i),at.reset(),function(t,e){t.render((function(t){d.renderBufferImmediate(t,e)}))}(t,r)}else d.renderBufferDirect(n,e,r,i,t,s);t.onAfterRender(d,e,n,r,i,s),p=et.get(e,w||n)}function wt(t,e,n){!0!==e.isScene&&(e=U);const r=W.get(t),i=p.state.lights,s=p.state.shadowsArray,o=i.state.version,a=Z.getParameters(t,i.state,s,e,I.numPlanes,I.numIntersection,n),l=Z.getProgramCacheKey(a);let c=r.program,u=!0;if(void 0===c)t.addEventListener("dispose",mt);else if(c.cacheKey!==l)_t(t);else if(r.lightsStateVersion!==o)r.lightsStateVersion=o,u=!1;else{if(void 0!==a.shaderID)return;u=!1}u&&(a.uniforms=Z.getUniforms(t,a),t.onBeforeCompile(a,d),c=Z.acquireProgram(a,l),r.program=c,r.uniforms=a.uniforms,r.outputEncoding=a.outputEncoding);const h=c.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(let e=0;e<d.maxMorphTargets;e++)h["morphTarget"+e]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(let e=0;e<d.maxMorphNormals;e++)h["morphNormal"+e]>=0&&t.numSupportedMorphNormals++}const f=r.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(r.numClippingPlanes=I.numPlanes,r.numIntersection=I.numIntersection,f.clippingPlanes=I.uniform),r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),r.lightsStateVersion=o,r.needsLights&&(f.ambientLightColor.value=i.state.ambient,f.lightProbe.value=i.state.probe,f.directionalLights.value=i.state.directional,f.directionalLightShadows.value=i.state.directionalShadow,f.spotLights.value=i.state.spot,f.spotLightShadows.value=i.state.spotShadow,f.rectAreaLights.value=i.state.rectArea,f.pointLights.value=i.state.point,f.pointLightShadows.value=i.state.pointShadow,f.hemisphereLights.value=i.state.hemi,f.directionalShadowMap.value=i.state.directionalShadowMap,f.directionalShadowMatrix.value=i.state.directionalShadowMatrix,f.spotShadowMap.value=i.state.spotShadowMap,f.spotShadowMatrix.value=i.state.spotShadowMatrix,f.pointShadowMap.value=i.state.pointShadowMap,f.pointShadowMatrix.value=i.state.pointShadowMatrix);const m=r.program.getUniforms(),_=Jo.seqWithValue(m.seq,f);r.uniformsList=_}function St(t,e,n,r){!0!==e.isScene&&(e=U),q.resetTextureUnits();const i=e.fog,s=n.isMeshStandardMaterial?e.environment:null,o=null===y?d.outputEncoding:y.texture.encoding,a=W.get(n),l=p.state.lights;if(!0===O&&(!0===F||t!==x)){const e=t===x&&n.id===b;I.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,t,a,e)}n.version===a.__version?void 0===a.program||n.fog&&a.fog!==i||a.environment!==s||a.needsLights&&a.lightsStateVersion!==l.state.version?wt(n,e,r):void 0===a.numClippingPlanes||a.numClippingPlanes===I.numPlanes&&a.numIntersection===I.numIntersection?a.outputEncoding!==o&&wt(n,e,r):wt(n,e,r):(wt(n,e,r),a.__version=n.version);let c=!1,u=!1,h=!1;const f=a.program,m=f.getUniforms(),_=a.uniforms;if(H.useProgram(f.program)&&(c=!0,u=!0,h=!0),n.id!==b&&(b=n.id,u=!0),c||x!==t){if(m.setValue(lt,"projectionMatrix",t.projectionMatrix),G.logarithmicDepthBuffer&&m.setValue(lt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),x!==t&&(x=t,u=!0,h=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=m.map.cameraPosition;void 0!==e&&e.setValue(lt,D.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&m.setValue(lt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&m.setValue(lt,"viewMatrix",t.matrixWorldInverse)}if(n.skinning){m.setOptional(lt,r,"bindMatrix"),m.setOptional(lt,r,"bindMatrixInverse");const t=r.skeleton;if(t){const e=t.bones;if(G.floatVertexTextures){if(void 0===t.boneTexture){let n=Math.sqrt(4*e.length);n=Fn.ceilPowerOfTwo(n),n=Math.max(n,4);const r=new Float32Array(n*n*4);r.set(t.boneMatrices);const i=new $s(r,n,n,kt,Bt);t.boneMatrices=r,t.boneTexture=i,t.boneTextureSize=n}m.setValue(lt,"boneTexture",t.boneTexture,q),m.setValue(lt,"boneTextureSize",t.boneTextureSize)}else m.setOptional(lt,t,"boneMatrices")}}var g,v;return(u||a.receiveShadow!==r.receiveShadow)&&(a.receiveShadow=r.receiveShadow,m.setValue(lt,"receiveShadow",r.receiveShadow)),u&&(m.setValue(lt,"toneMappingExposure",d.toneMappingExposure),a.needsLights&&(v=h,(g=_).ambientLightColor.needsUpdate=v,g.lightProbe.needsUpdate=v,g.directionalLights.needsUpdate=v,g.directionalLightShadows.needsUpdate=v,g.pointLights.needsUpdate=v,g.pointLightShadows.needsUpdate=v,g.spotLights.needsUpdate=v,g.spotLightShadows.needsUpdate=v,g.rectAreaLights.needsUpdate=v,g.hemisphereLights.needsUpdate=v),i&&n.fog&&K.refreshFogUniforms(_,i),K.refreshMaterialUniforms(_,n,s,$,A),void 0!==_.ltc_1&&(_.ltc_1.value=Rs.LTC_1),void 0!==_.ltc_2&&(_.ltc_2.value=Rs.LTC_2),Jo.upload(lt,a.uniformsList,_,q)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Jo.upload(lt,a.uniformsList,_,q),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&m.setValue(lt,"center",r.center),m.setValue(lt,"modelViewMatrix",r.modelViewMatrix),m.setValue(lt,"normalMatrix",r.normalMatrix),m.setValue(lt,"modelMatrix",r.matrixWorld),f}yt.setAnimationLoop((function(t){ht.isPresenting||gt&&gt(t)})),"undefined"!=typeof window&&yt.setContext(window),this.setAnimationLoop=function(t){gt=t,ht.setAnimationLoop(t),null===t?yt.stop():yt.start()},this.render=function(t,e){let n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===f)return;at.resetDefaultState(),b=-1,x=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===ht.enabled&&!0===ht.isPresenting&&(e=ht.getCamera(e)),!0===t.isScene&&t.onBeforeRender(d,t,e,n||y),p=et.get(t,e),p.init(),k.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),P.setFromProjectionMatrix(k),F=this.localClippingEnabled,O=I.init(this.clippingPlanes,F,e),h=tt.get(t,e),h.init(),vt(t,e,0,d.sortObjects),h.finish(),!0===d.sortObjects&&h.sort(C,B),!0===O&&I.beginShadows();const i=p.state.shadowsArray;pt.render(i,t,e),p.setupLights(e),!0===O&&I.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),nt.render(h,t,e,r);const s=h.opaque,o=h.transparent;s.length>0&&bt(s,t,e),o.length>0&&bt(o,t,e),!0===t.isScene&&t.onAfterRender(d,t,e),null!==y&&(q.updateRenderTargetMipmap(y),q.updateMultisampleRenderTarget(y)),H.buffers.depth.setTest(!0),H.buffers.depth.setMask(!0),H.buffers.color.setMask(!0),H.setPolygonOffset(!1),h=null,p=null},this.setFramebuffer=function(t){m!==t&&null===y&&lt.bindFramebuffer(36160,t),m=t},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return g},this.getRenderTarget=function(){return y},this.setRenderTarget=function(t,e,n){y=t,_=e,g=n,t&&void 0===W.get(t).__webglFramebuffer&&q.setupRenderTarget(t);let r=m,i=!1;if(t){const n=W.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=n[e||0],i=!0):r=t.isWebGLMultisampleRenderTarget?W.get(t).__webglMultisampledFramebuffer:n,S.copy(t.viewport),M.copy(t.scissor),T=t.scissorTest}else S.copy(L).multiplyScalar($).floor(),M.copy(R).multiplyScalar($).floor(),T=N;if(v!==r&&(lt.bindFramebuffer(36160,r),v=r),H.viewport(S),H.scissor(M),H.setScissorTest(T),i){const r=W.get(t.texture);lt.framebufferTexture2D(36160,36064,34069+(e||0),r.__webglTexture,n||0)}},this.readRenderTargetPixels=function(t,e,n,r,i,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=W.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){let o=!1;a!==v&&(lt.bindFramebuffer(36160,a),o=!0);try{const o=t.texture,a=o.format,l=o.type;if(a!==kt&&ot.convert(a)!==lt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(l===Mt||ot.convert(l)===lt.getParameter(35738)||l===Bt&&(G.isWebGL2||j.get("OES_texture_float")||j.get("WEBGL_color_buffer_float"))||l===Lt&&(G.isWebGL2?j.get("EXT_color_buffer_float"):j.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===lt.checkFramebufferStatus(36160)?e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i&&lt.readPixels(e,n,r,i,ot.convert(a),ot.convert(l),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{o&&lt.bindFramebuffer(36160,v)}}},this.copyFramebufferToTexture=function(t,e,n){void 0===n&&(n=0);const r=Math.pow(2,-n),i=Math.floor(e.image.width*r),s=Math.floor(e.image.height*r),o=ot.convert(e.format);q.setTexture2D(e,0),lt.copyTexImage2D(3553,n,o,t.x,t.y,i,s,0),H.unbindTexture()},this.copyTextureToTexture=function(t,e,n,r){void 0===r&&(r=0);const i=e.image.width,s=e.image.height,o=ot.convert(n.format),a=ot.convert(n.type);q.setTexture2D(n,0),lt.pixelStorei(37440,n.flipY),lt.pixelStorei(37441,n.premultiplyAlpha),lt.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?lt.texSubImage2D(3553,r,t.x,t.y,i,s,o,a,e.image.data):e.isCompressedTexture?lt.compressedTexSubImage2D(3553,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):lt.texSubImage2D(3553,r,t.x,t.y,o,a,e.image),0===r&&n.generateMipmaps&&lt.generateMipmap(3553),H.unbindTexture()},this.initTexture=function(t){q.setTexture2D(t,0),H.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Ga(t){ja.call(this,t)}function Ha(t,e){this.name="",this.color=new di(t),this.density=void 0!==e?e:25e-5}function Va(t,e,n){this.name="",this.color=new di(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3}function Wa(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Tn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Fn.generateUUID()}Fa.prototype=Object.assign(Object.create(Ss.prototype),{constructor:Fa,isArrayCamera:!0}),ka.prototype=Object.assign(Object.create(wr.prototype),{constructor:ka,isGroup:!0}),Object.assign(Da.prototype,{constructor:Da,getHandSpace:function(){if(null===this._hand&&(this._hand=new ka,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(let t=0;t<=window.XRHand.LITTLE_PHALANX_TIP;t++){let t=new ka;t.matrixAutoUpdate=!1,t.visible=!1,this._hand.joints.push(t),this._hand.add(t)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new ka,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new ka,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(t,e,n){let r=null,i=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t)if(t.hand){s=!0;for(let r=0;r<=window.XRHand.LITTLE_PHALANX_TIP;r++)if(t.hand[r]){let i=e.getJointPose(t.hand[r],n);const s=l.joints[r];null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.jointRadius=i.radius),s.visible=null!==i;const o=l.joints[window.XRHand.INDEX_PHALANX_TIP],a=l.joints[window.XRHand.THUMB_PHALANX_TIP],c=o.position.distanceTo(a.position),u=.02,h=.005;l.inputState.pinching&&c>u+h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&c<=u-h&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}}else null!==o&&(r=e.getPose(t.targetRaySpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale))),null!==a&&t.gripSpace&&(i=e.getPose(t.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)));return null!==o&&(o.visible=null!==r),null!==a&&(a.visible=null!==i),null!==l&&(l.visible=null!==s),this}}),Object.assign(Ua.prototype,Pn.prototype),Ga.prototype=Object.assign(Object.create(ja.prototype),{constructor:Ga,isWebGL1Renderer:!0}),Object.assign(Ha.prototype,{isFogExp2:!0,clone:function(){return new Ha(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Va.prototype,{isFog:!0,clone:function(){return new Va(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(Wa.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Wa.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(let r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Fn.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new Wa(new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),this.stride);return e.setUsage(this.usage),e},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Fn.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const qa=new Jn;function Xa(t,e,n,r){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r}function Ya(t){vi.call(this),this.type="SpriteMaterial",this.color=new di(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}let Ja;Object.defineProperties(Xa.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(t){this.data.needsUpdate=t}}}),Object.assign(Xa.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(let e=0,n=this.data.count;e<n;e++)qa.x=this.getX(e),qa.y=this.getY(e),qa.z=this.getZ(e),qa.applyMatrix4(t),this.setXYZ(e,qa.x,qa.y,qa.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this},clone:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new Si(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Xa(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),Ya.prototype=Object.create(vi.prototype),Ya.prototype.constructor=Ya,Ya.prototype.isSpriteMaterial=!0,Ya.prototype.copy=function(t){return vi.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};const Za=new Jn,Qa=new Jn,Ka=new Jn,tl=new kn,el=new kn,nl=new ir,rl=new Jn,il=new Jn,sl=new Jn,ol=new kn,al=new kn,ll=new kn;function cl(t){if(wr.call(this),this.type="Sprite",void 0===Ja){Ja=new ji;const t=new Wa(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Ja.setIndex([0,1,2,0,2,3]),Ja.setAttribute("position",new Xa(t,3,0,!1)),Ja.setAttribute("uv",new Xa(t,2,3,!1))}this.geometry=Ja,this.material=void 0!==t?t:new Ya,this.center=new kn(.5,.5)}function ul(t,e,n,r,i,s){tl.subVectors(t,n).addScalar(.5).multiply(r),void 0!==i?(el.x=s*tl.x-i*tl.y,el.y=i*tl.x+s*tl.y):el.copy(tl),t.copy(e),t.x+=el.x,t.y+=el.y,t.applyMatrix4(nl)}cl.prototype=Object.assign(Object.create(wr.prototype),{constructor:cl,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Qa.setFromMatrixScale(this.matrixWorld),nl.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Ka.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Qa.multiplyScalar(-Ka.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const s=this.center;ul(rl.set(-.5,-.5,0),Ka,s,Qa,r,i),ul(il.set(.5,-.5,0),Ka,s,Qa,r,i),ul(sl.set(.5,.5,0),Ka,s,Qa,r,i),ol.set(0,0),al.set(1,0),ll.set(1,1);let o=t.ray.intersectTriangle(rl,il,sl,!1,Za);if(null===o&&(ul(il.set(-.5,.5,0),Ka,s,Qa,r,i),al.set(0,1),o=t.ray.intersectTriangle(rl,sl,il,!1,Za),null===o))return;const a=t.ray.origin.distanceTo(Za);a<t.near||a>t.far||e.push({distance:a,point:Za.clone(),uv:ci.getUV(Za,rl,il,sl,ol,al,ll,new kn),face:null,object:this})},copy:function(t){return wr.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}});const hl=new Jn,pl=new Jn;function dl(){wr.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function fl(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),os.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ir,this.bindMatrixInverse=new ir}dl.prototype=Object.assign(Object.create(wr.prototype),{constructor:dl,isLOD:!0,copy:function(t){wr.prototype.copy.call(this,t,!1);const e=t.levels;for(let t=0,n=e.length;t<n;t++){const n=e[t];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);const n=this.levels;let r;for(r=0;r<n.length&&!(e<n[r].distance);r++);return n.splice(r,0,{distance:e,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){const e=this.levels;if(e.length>0){let n,r;for(n=1,r=e.length;n<r&&!(t<e[n].distance);n++);return e[n-1].object}return null},raycast:function(t,e){if(this.levels.length>0){hl.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(hl);this.getObjectForDistance(n).raycast(t,e)}},update:function(t){const e=this.levels;if(e.length>1){hl.setFromMatrixPosition(t.matrixWorld),pl.setFromMatrixPosition(this.matrixWorld);const n=hl.distanceTo(pl)/t.zoom;let r,i;for(e[0].object.visible=!0,r=1,i=e.length;r<i&&n>=e[r].distance;r++)e[r-1].object.visible=!1,e[r].object.visible=!0;for(this._currentLevel=r-1;r<i;r++)e[r].object.visible=!1}},toJSON:function(t){const e=wr.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let t=0,r=n.length;t<r;t++){const r=n[t];e.object.levels.push({object:r.object.uuid,distance:r.distance})}return e}}),fl.prototype=Object.assign(Object.create(os.prototype),{constructor:fl,isSkinnedMesh:!0,copy:function(t){return os.prototype.copy.call(this,t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const t=new Hn,e=this.geometry.attributes.skinWeight;for(let n=0,r=e.count;n<r;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);const r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){os.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(){const t=new Jn,e=new Hn,n=new Hn,r=new Jn,i=new ir;return function(s,o){const a=this.skeleton,l=this.geometry;e.fromBufferAttribute(l.attributes.skinIndex,s),n.fromBufferAttribute(l.attributes.skinWeight,s),t.fromBufferAttribute(l.attributes.position,s).applyMatrix4(this.bindMatrix),o.set(0,0,0);for(let s=0;s<4;s++){const l=n.getComponent(s);if(0!==l){const n=e.getComponent(s);i.multiplyMatrices(a.bones[n].matrixWorld,a.boneInverses[n]),o.addScaledVector(r.copy(t).applyMatrix4(i),l)}}return o.applyMatrix4(this.bindMatrixInverse)}}()});const ml=new ir,_l=new ir;function gl(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new ir)}}function yl(){wr.call(this),this.type="Bone"}Object.assign(gl.prototype,{calculateInverses:function(){this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++){const e=new ir;this.bones[t]&&e.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(e)}},pose:function(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.getInverse(this.boneInverses[t])}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}},update:function(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=t.length;r<i;r++){const i=t[r]?t[r].matrixWorld:_l;ml.multiplyMatrices(i,e[r]),ml.toArray(n,16*r)}void 0!==r&&(r.needsUpdate=!0)},clone:function(){return new gl(this.bones,this.boneInverses)},getBoneByName:function(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),yl.prototype=Object.assign(Object.create(wr.prototype),{constructor:yl,isBone:!0});const vl=new ir,bl=new ir,xl=[],wl=new os;function Sl(t,e,n){os.call(this,t,e),this.instanceMatrix=new Si(new Float32Array(16*n),16),this.count=n,this.frustumCulled=!1}function Ml(t){vi.call(this),this.type="LineBasicMaterial",this.color=new di(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}Sl.prototype=Object.assign(Object.create(os.prototype),{constructor:Sl,isInstancedMesh:!0,copy:function(t){return os.prototype.copy.call(this,t),this.instanceMatrix.copy(t.instanceMatrix),this.count=t.count,this},getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){const n=this.matrixWorld,r=this.count;if(wl.geometry=this.geometry,wl.material=this.material,void 0!==wl.material)for(let i=0;i<r;i++){this.getMatrixAt(i,vl),bl.multiplyMatrices(n,vl),wl.matrixWorld=bl,wl.raycast(t,xl);for(let t=0,n=xl.length;t<n;t++){const n=xl[t];n.instanceId=i,n.object=this,e.push(n)}xl.length=0}},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),Ml.prototype=Object.create(vi.prototype),Ml.prototype.constructor=Ml,Ml.prototype.isLineBasicMaterial=!0,Ml.prototype.copy=function(t){return vi.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};const Tl=new Jn,El=new Jn,Al=new ir,$l=new Xr,Cl=new Ur;function Bl(t,e,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),wr.call(this),this.type="Line",this.geometry=void 0!==t?t:new ji,this.material=void 0!==e?e:new Ml,this.updateMorphTargets()}Bl.prototype=Object.assign(Object.create(wr.prototype),{constructor:Bl,isLine:!0,copy:function(t){return wr.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,r=e.count;t<r;t++)Tl.fromBufferAttribute(e,t-1),El.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=Tl.distanceTo(El);t.setAttribute("lineDistance",new Li(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,n=t.lineDistances;n[0]=0;for(let t=1,r=e.length;t<r;t++)n[t]=n[t-1],n[t]+=e[t-1].distanceTo(e[t])}return this},raycast:function(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Cl.copy(n.boundingSphere),Cl.applyMatrix4(r),Cl.radius+=i,!1===t.ray.intersectsSphere(Cl))return;Al.getInverse(r),$l.copy(t.ray).applyMatrix4(Al);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,a=new Jn,l=new Jn,c=new Jn,u=new Jn,h=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes.position.array;if(null!==r){const n=r.array;for(let r=0,s=n.length-1;r<s;r+=h){const s=n[r],h=n[r+1];if(a.fromArray(i,3*s),l.fromArray(i,3*h),$l.distanceSqToSegment(a,l,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const p=t.ray.origin.distanceTo(u);p<t.near||p>t.far||e.push({distance:p,point:c.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}else for(let n=0,r=i.length/3-1;n<r;n+=h){if(a.fromArray(i,3*n),l.fromArray(i,3*n+3),$l.distanceSqToSegment(a,l,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(u);r<t.near||r>t.far||e.push({distance:r,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else if(n.isGeometry){const r=n.vertices,i=r.length;for(let n=0;n<i-1;n+=h){if($l.distanceSqToSegment(r[n],r[n+1],u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(u);i<t.near||i>t.far||e.push({distance:i,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const Ll=new Jn,Rl=new Jn;function Nl(t,e){Bl.call(this,t,e),this.type="LineSegments"}function Pl(t,e){Bl.call(this,t,e),this.type="LineLoop"}function Il(t){vi.call(this),this.type="PointsMaterial",this.color=new di(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}Nl.prototype=Object.assign(Object.create(Bl.prototype),{constructor:Nl,isLineSegments:!0,computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,r=e.count;t<r;t+=2)Ll.fromBufferAttribute(e,t),Rl.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Ll.distanceTo(Rl);t.setAttribute("lineDistance",new Li(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,n=t.lineDistances;for(let t=0,r=e.length;t<r;t+=2)Ll.copy(e[t]),Rl.copy(e[t+1]),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Ll.distanceTo(Rl)}return this}}),Pl.prototype=Object.assign(Object.create(Bl.prototype),{constructor:Pl,isLineLoop:!0}),Il.prototype=Object.create(vi.prototype),Il.prototype.constructor=Il,Il.prototype.isPointsMaterial=!0,Il.prototype.copy=function(t){return vi.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};const Ol=new ir,Fl=new Xr,kl=new Ur,Dl=new Jn;function Ul(t,e){wr.call(this),this.type="Points",this.geometry=void 0!==t?t:new ji,this.material=void 0!==e?e:new Il,this.updateMorphTargets()}function zl(t,e,n,r,i,s,o){const a=Fl.distanceSqToPoint(t);if(a<n){const n=new Jn;Fl.closestPointToPoint(t,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:o})}}function jl(t,e,n,r,i,s,o,a,l){Gn.call(this,t,e,n,r,i,s,o,a,l),this.format=void 0!==o?o:Ft,this.minFilter=void 0!==s?s:vt,this.magFilter=void 0!==i?i:vt,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}function Gl(t,e,n,r,i,s,o,a,l,c,u,h){Gn.call(this,null,s,o,a,l,c,r,i,u,h),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function Hl(t,e,n,r,i,s,o,a,l){Gn.call(this,t,e,n,r,i,s,o,a,l),this.needsUpdate=!0}function Vl(t,e,n,r,i,s,o,a,l,c){if((c=void 0!==c?c:jt)!==jt&&c!==Gt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===jt&&(n=At),void 0===n&&c===Gt&&(n=It),Gn.call(this,null,r,i,s,o,a,c,n,l),this.image={width:t,height:e},this.magFilter=void 0!==o?o:ft,this.minFilter=void 0!==a?a:ft,this.flipY=!1,this.generateMipmaps=!1}function Wl(t){ji.call(this),this.type="WireframeGeometry";const e=[],n=[0,0],r={},i=["a","b","c"];if(t&&t.isGeometry){const s=t.faces;for(let t=0,e=s.length;t<e;t++){const e=s[t];for(let t=0;t<3;t++){const s=e[i[t]],o=e[i[(t+1)%3]];n[0]=Math.min(s,o),n[1]=Math.max(s,o);const a=n[0]+","+n[1];void 0===r[a]&&(r[a]={index1:n[0],index2:n[1]})}}for(const n in r){const i=r[n];let s=t.vertices[i.index1];e.push(s.x,s.y,s.z),s=t.vertices[i.index2],e.push(s.x,s.y,s.z)}}else if(t&&t.isBufferGeometry){let i=new Jn;if(null!==t.index){const s=t.attributes.position,o=t.index;let a=t.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let t=0,e=a.length;t<e;++t){const e=a[t],i=e.start;for(let t=i,s=i+e.count;t<s;t+=3)for(let e=0;e<3;e++){const i=o.getX(t+e),s=o.getX(t+(e+1)%3);n[0]=Math.min(i,s),n[1]=Math.max(i,s);const a=n[0]+","+n[1];void 0===r[a]&&(r[a]={index1:n[0],index2:n[1]})}}for(const t in r){const n=r[t];i.fromBufferAttribute(s,n.index1),e.push(i.x,i.y,i.z),i.fromBufferAttribute(s,n.index2),e.push(i.x,i.y,i.z)}}else{const n=t.attributes.position;for(let t=0,r=n.count/3;t<r;t++)for(let r=0;r<3;r++){const s=3*t+r;i.fromBufferAttribute(n,s),e.push(i.x,i.y,i.z);const o=3*t+(r+1)%3;i.fromBufferAttribute(n,o),e.push(i.x,i.y,i.z)}}}this.setAttribute("position",new Li(e,3))}function ql(t,e,n){ds.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n},this.fromBufferGeometry(new Xl(t,e,n)),this.mergeVertices()}function Xl(t,e,n){ji.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:n};const r=[],i=[],s=[],o=[],a=1e-5,l=new Jn,c=new Jn,u=new Jn,h=new Jn,p=new Jn;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const d=e+1;for(let r=0;r<=n;r++){const d=r/n;for(let n=0;n<=e;n++){const r=n/e;t(r,d,c),i.push(c.x,c.y,c.z),r-a>=0?(t(r-a,d,u),h.subVectors(c,u)):(t(r+a,d,u),h.subVectors(u,c)),d-a>=0?(t(r,d-a,u),p.subVectors(c,u)):(t(r,d+a,u),p.subVectors(u,c)),l.crossVectors(h,p).normalize(),s.push(l.x,l.y,l.z),o.push(r,d)}}for(let t=0;t<n;t++)for(let n=0;n<e;n++){const e=t*d+n,i=t*d+n+1,s=(t+1)*d+n+1,o=(t+1)*d+n;r.push(e,i,o),r.push(i,s,o)}this.setIndex(r),this.setAttribute("position",new Li(i,3)),this.setAttribute("normal",new Li(s,3)),this.setAttribute("uv",new Li(o,2))}function Yl(t,e,n,r){ds.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},this.fromBufferGeometry(new Jl(t,e,n,r)),this.mergeVertices()}function Jl(t,e,n,r){ji.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},n=n||1;const i=[],s=[];function o(t,e,n,r){const i=Math.pow(2,r),s=[];for(let r=0;r<=i;r++){s[r]=[];const o=t.clone().lerp(n,r/i),a=e.clone().lerp(n,r/i),l=i-r;for(let t=0;t<=l;t++)s[r][t]=0===t&&r===i?o:o.clone().lerp(a,t/l)}for(let t=0;t<i;t++)for(let e=0;e<2*(i-t)-1;e++){const n=Math.floor(e/2);e%2==0?(a(s[t][n+1]),a(s[t+1][n]),a(s[t][n])):(a(s[t][n+1]),a(s[t+1][n+1]),a(s[t+1][n]))}}function a(t){i.push(t.x,t.y,t.z)}function l(e,n){const r=3*e;n.x=t[r+0],n.y=t[r+1],n.z=t[r+2]}function c(t,e,n,r){r<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=r/2/Math.PI+.5)}function u(t){return Math.atan2(t.z,-t.x)}!function(t){const n=new Jn,r=new Jn,i=new Jn;for(let s=0;s<e.length;s+=3)l(e[s+0],n),l(e[s+1],r),l(e[s+2],i),o(n,r,i,t)}(r=r||0),function(t){const e=new Jn;for(let n=0;n<i.length;n+=3)e.x=i[n+0],e.y=i[n+1],e.z=i[n+2],e.normalize().multiplyScalar(t),i[n+0]=e.x,i[n+1]=e.y,i[n+2]=e.z}(n),function(){const t=new Jn;for(let n=0;n<i.length;n+=3){t.x=i[n+0],t.y=i[n+1],t.z=i[n+2];const r=u(t)/2/Math.PI+.5,o=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(r,1-o)}var e;(function(){const t=new Jn,e=new Jn,n=new Jn,r=new Jn,o=new kn,a=new kn,l=new kn;for(let h=0,p=0;h<i.length;h+=9,p+=6){t.set(i[h+0],i[h+1],i[h+2]),e.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),o.set(s[p+0],s[p+1]),a.set(s[p+2],s[p+3]),l.set(s[p+4],s[p+5]),r.copy(t).add(e).add(n).divideScalar(3);const d=u(r);c(o,p+0,t,d),c(a,p+2,e,d),c(l,p+4,n,d)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],n=s[t+2],r=s[t+4],i=Math.max(e,n,r),o=Math.min(e,n,r);i>.9&&o<.1&&(e<.2&&(s[t+0]+=1),n<.2&&(s[t+2]+=1),r<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new Li(i,3)),this.setAttribute("normal",new Li(i.slice(),3)),this.setAttribute("uv",new Li(s,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function Zl(t,e){ds.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ql(t,e)),this.mergeVertices()}function Ql(t,e){Jl.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Kl(t,e){ds.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new tc(t,e)),this.mergeVertices()}function tc(t,e){Jl.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function ec(t,e){ds.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new nc(t,e)),this.mergeVertices()}function nc(t,e){const n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];Jl.call(this,r,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function rc(t,e){ds.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new ic(t,e)),this.mergeVertices()}function ic(t,e){const n=(1+Math.sqrt(5))/2,r=1/n,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r];Jl.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function sc(t,e,n,r,i,s){ds.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i},void 0!==s&&console.warn("THREE.TubeGeometry: taper has been removed.");const o=new oc(t,e,n,r,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}function oc(t,e,n,r,i){ji.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i},e=e||64,n=n||1,r=r||8,i=i||!1;const s=t.computeFrenetFrames(e,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new Jn,a=new Jn,l=new kn;let c=new Jn;const u=[],h=[],p=[],d=[];function f(i){c=t.getPointAt(i/e,c);const l=s.normals[i],p=s.binormals[i];for(let t=0;t<=r;t++){const e=t/r*Math.PI*2,i=Math.sin(e),s=-Math.cos(e);a.x=s*l.x+i*p.x,a.y=s*l.y+i*p.y,a.z=s*l.z+i*p.z,a.normalize(),h.push(a.x,a.y,a.z),o.x=c.x+n*a.x,o.y=c.y+n*a.y,o.z=c.z+n*a.z,u.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===i?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=r;n++)l.x=t/e,l.y=n/r,p.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),s=(r+1)*t+e,o=(r+1)*(t-1)+e;d.push(n,i,o),d.push(i,s,o)}}()}(),this.setIndex(d),this.setAttribute("position",new Li(u,3)),this.setAttribute("normal",new Li(h,3)),this.setAttribute("uv",new Li(p,2))}function ac(t,e,n,r,i,s,o){ds.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:s},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new lc(t,e,n,r,i,s)),this.mergeVertices()}function lc(t,e,n,r,i,s){ji.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:s},t=t||1,e=e||.4,n=Math.floor(n)||64,r=Math.floor(r)||8,i=i||2,s=s||3;const o=[],a=[],l=[],c=[],u=new Jn,h=new Jn,p=new Jn,d=new Jn,f=new Jn,m=new Jn,_=new Jn;for(let o=0;o<=n;++o){const y=o/n*i*Math.PI*2;g(y,i,s,t,p),g(y+.01,i,s,t,d),m.subVectors(d,p),_.addVectors(d,p),f.crossVectors(m,_),_.crossVectors(f,m),f.normalize(),_.normalize();for(let t=0;t<=r;++t){const i=t/r*Math.PI*2,s=-e*Math.cos(i),d=e*Math.sin(i);u.x=p.x+(s*_.x+d*f.x),u.y=p.y+(s*_.y+d*f.y),u.z=p.z+(s*_.z+d*f.z),a.push(u.x,u.y,u.z),h.subVectors(u,p).normalize(),l.push(h.x,h.y,h.z),c.push(o/n),c.push(t/r)}}for(let t=1;t<=n;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),s=(r+1)*t+e,a=(r+1)*(t-1)+e;o.push(n,i,a),o.push(i,s,a)}function g(t,e,n,r,i){const s=Math.cos(t),o=Math.sin(t),a=n/e*t,l=Math.cos(a);i.x=r*(2+l)*.5*s,i.y=r*(2+l)*o*.5,i.z=r*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new Li(a,3)),this.setAttribute("normal",new Li(l,3)),this.setAttribute("uv",new Li(c,2))}function cc(t,e,n,r,i){ds.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},this.fromBufferGeometry(new uc(t,e,n,r,i)),this.mergeVertices()}function uc(t,e,n,r,i){ji.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},t=t||1,e=e||.4,n=Math.floor(n)||8,r=Math.floor(r)||6,i=i||2*Math.PI;const s=[],o=[],a=[],l=[],c=new Jn,u=new Jn,h=new Jn;for(let s=0;s<=n;s++)for(let p=0;p<=r;p++){const d=p/r*i,f=s/n*Math.PI*2;u.x=(t+e*Math.cos(f))*Math.cos(d),u.y=(t+e*Math.cos(f))*Math.sin(d),u.z=e*Math.sin(f),o.push(u.x,u.y,u.z),c.x=t*Math.cos(d),c.y=t*Math.sin(d),h.subVectors(u,c).normalize(),a.push(h.x,h.y,h.z),l.push(p/r),l.push(s/n)}for(let t=1;t<=n;t++)for(let e=1;e<=r;e++){const n=(r+1)*t+e-1,i=(r+1)*(t-1)+e-1,o=(r+1)*(t-1)+e,a=(r+1)*t+e;s.push(n,i,a),s.push(i,o,a)}this.setIndex(s),this.setAttribute("position",new Li(o,3)),this.setAttribute("normal",new Li(a,3)),this.setAttribute("uv",new Li(l,2))}Ul.prototype=Object.assign(Object.create(wr.prototype),{constructor:Ul,isPoints:!0,copy:function(t){return wr.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),kl.copy(n.boundingSphere),kl.applyMatrix4(r),kl.radius+=i,!1===t.ray.intersectsSphere(kl))return;Ol.getInverse(r),Fl.copy(t.ray).applyMatrix4(Ol);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s;if(n.isBufferGeometry){const i=n.index,s=n.attributes.position.array;if(null!==i){const n=i.array;for(let i=0,a=n.length;i<a;i++){const a=n[i];Dl.fromArray(s,3*a),zl(Dl,a,o,r,t,e,this)}}else for(let n=0,i=s.length/3;n<i;n++)Dl.fromArray(s,3*n),zl(Dl,n,o,r,t,e,this)}else{const i=n.vertices;for(let n=0,s=i.length;n<s;n++)zl(i[n],n,o,r,t,e,this)}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),jl.prototype=Object.assign(Object.create(Gn.prototype),{constructor:jl,isVideoTexture:!0,update:function(){const t=this.image;!1=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Gl.prototype=Object.create(Gn.prototype),Gl.prototype.constructor=Gl,Gl.prototype.isCompressedTexture=!0,Hl.prototype=Object.create(Gn.prototype),Hl.prototype.constructor=Hl,Hl.prototype.isCanvasTexture=!0,Vl.prototype=Object.create(Gn.prototype),Vl.prototype.constructor=Vl,Vl.prototype.isDepthTexture=!0,Wl.prototype=Object.create(ji.prototype),Wl.prototype.constructor=Wl,ql.prototype=Object.create(ds.prototype),ql.prototype.constructor=ql,Xl.prototype=Object.create(ji.prototype),Xl.prototype.constructor=Xl,Yl.prototype=Object.create(ds.prototype),Yl.prototype.constructor=Yl,Jl.prototype=Object.create(ji.prototype),Jl.prototype.constructor=Jl,Zl.prototype=Object.create(ds.prototype),Zl.prototype.constructor=Zl,Ql.prototype=Object.create(Jl.prototype),Ql.prototype.constructor=Ql,Kl.prototype=Object.create(ds.prototype),Kl.prototype.constructor=Kl,tc.prototype=Object.create(Jl.prototype),tc.prototype.constructor=tc,ec.prototype=Object.create(ds.prototype),ec.prototype.constructor=ec,nc.prototype=Object.create(Jl.prototype),nc.prototype.constructor=nc,rc.prototype=Object.create(ds.prototype),rc.prototype.constructor=rc,ic.prototype=Object.create(Jl.prototype),ic.prototype.constructor=ic,sc.prototype=Object.create(ds.prototype),sc.prototype.constructor=sc,oc.prototype=Object.create(ji.prototype),oc.prototype.constructor=oc,oc.prototype.toJSON=function(){const t=ji.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},ac.prototype=Object.create(ds.prototype),ac.prototype.constructor=ac,lc.prototype=Object.create(ji.prototype),lc.prototype.constructor=lc,cc.prototype=Object.create(ds.prototype),cc.prototype.constructor=cc,uc.prototype=Object.create(ji.prototype),uc.prototype.constructor=uc;function hc(t,e,n,r,i){let s,o;if(i===function(t,e,n,r){let i=0;for(let s=e,o=n-r;s<n;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}(t,e,n,r)>0)for(s=e;s<n;s+=r)o=Rc(s,t[s],t[s+1],o);else for(s=n-r;s>=e;s-=r)o=Rc(s,t[s],t[s+1],o);return o&&Ec(o,o.next)&&(Nc(o),o=o.next),o}function pc(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!Ec(r,r.next)&&0!==Tc(r.prev,r,r.next))r=r.next;else{if(Nc(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function dc(t,e,n,r,i,s,o){if(!t)return;!o&&s&&function(t,e,n,r){let i=t;do{null===i.z&&(i.z=xc(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){let e,n,r,i,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,r=n,a=0,e=0;e<c&&(a++,r=r.nextZ,r);e++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,c*=2}while(o>1)}(i)}(t,r,i,s);let a,l,c=t;for(;t.prev!==t.next;)if(a=t.prev,l=t.next,s?mc(t,r,i,s):fc(t))e.push(a.i/n),e.push(t.i/n),e.push(l.i/n),Nc(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?dc(t=_c(pc(t),e,n),e,n,r,i,s,2):2===o&&gc(t,e,n,r,i,s):dc(pc(t),e,n,r,i,s,1);break}}function fc(t){let e=t.prev,n=t,r=t.next;if(Tc(e,n,r)>=0)return!1;let i=t.next.next;for(;i!==t.prev;){if(Sc(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Tc(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function mc(t,e,n,r){let i=t.prev,s=t,o=t.next;if(Tc(i,s,o)>=0)return!1;let a=i.x<s.x?i.x<o.x?i.x:o.x:s.x<o.x?s.x:o.x,l=i.y<s.y?i.y<o.y?i.y:o.y:s.y<o.y?s.y:o.y,c=i.x>s.x?i.x>o.x?i.x:o.x:s.x>o.x?s.x:o.x,u=i.y>s.y?i.y>o.y?i.y:o.y:s.y>o.y?s.y:o.y,h=xc(a,l,e,n,r),p=xc(c,u,e,n,r),d=t.prevZ,f=t.nextZ;for(;d&&d.z>=h&&f&&f.z<=p;){if(d!==t.prev&&d!==t.next&&Sc(i.x,i.y,s.x,s.y,o.x,o.y,d.x,d.y)&&Tc(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==t.prev&&f!==t.next&&Sc(i.x,i.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Tc(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==t.prev&&d!==t.next&&Sc(i.x,i.y,s.x,s.y,o.x,o.y,d.x,d.y)&&Tc(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&Sc(i.x,i.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Tc(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function _c(t,e,n){let r=t;do{let i=r.prev,s=r.next.next;!Ec(i,s)&&Ac(i,r,r.next,s)&&Bc(i,s)&&Bc(s,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(s.i/n),Nc(r),Nc(r.next),r=t=s),r=r.next}while(r!==t);return pc(r)}function gc(t,e,n,r,i,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&Mc(o,t)){let a=Lc(o,t);return o=pc(o,o.next),a=pc(a,a.next),dc(o,e,n,r,i,s),void dc(a,e,n,r,i,s)}t=t.next}o=o.next}while(o!==t)}function yc(t,e){return t.x-e.x}function vc(t,e){if(e=function(t,e){let n,r=e,i=t.x,s=t.y,o=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){let t=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(t<=i&&t>o){if(o=t,t===i){if(s===r.y)return r;if(s===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===o)return n;let a,l=n,c=n.x,u=n.y,h=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&Sc(s<u?i:o,s,c,u,s<u?o:i,s,r.x,r.y)&&(a=Math.abs(s-r.y)/(i-r.x),Bc(r,t)&&(a<h||a===h&&(r.x>n.x||r.x===n.x&&bc(n,r)))&&(n=r,h=a)),r=r.next}while(r!==l);return n}(t,e),e){const n=Lc(e,t);pc(e,e.next),pc(n,n.next)}}function bc(t,e){return Tc(t.prev,t,e.prev)<0&&Tc(e.next,t,t.next)<0}function xc(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function wc(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Sc(t,e,n,r,i,s,o,a){return(i-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(r-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(i-o)*(r-a)>=0}function Mc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Ac(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Bc(t,e)&&Bc(e,t)&&function(t,e){let n=t,r=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(Tc(t.prev,t,e.prev)||Tc(t,e.prev,e))||Ec(t,e)&&Tc(t.prev,t,t.next)>0&&Tc(e.prev,e,e.next)>0)}function Tc(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Ec(t,e){return t.x===e.x&&t.y===e.y}function Ac(t,e,n,r){const i=Cc(Tc(t,e,n)),s=Cc(Tc(t,e,r)),o=Cc(Tc(n,r,t)),a=Cc(Tc(n,r,e));return i!==s&&o!==a||!(0!==i||!$c(t,n,e))||!(0!==s||!$c(t,r,e))||!(0!==o||!$c(n,t,r))||!(0!==a||!$c(n,e,r))}function $c(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Cc(t){return t>0?1:t<0?-1:0}function Bc(t,e){return Tc(t.prev,t,t.next)<0?Tc(t,e,t.next)>=0&&Tc(t,t.prev,e)>=0:Tc(t,e,t.prev)<0||Tc(t,t.next,e)<0}function Lc(t,e){let n=new Pc(t.i,t.x,t.y),r=new Pc(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function Rc(t,e,n,r){const i=new Pc(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Nc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Pc(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const Ic={area:function(t){const e=t.length;let n=0;for(let r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n},isClockWise:function(t){return Ic.area(t)<0},triangulateShape:function(t,e){const n=[],r=[],i=[];Oc(t),Fc(n,t);let s=t.length;e.forEach(Oc);for(let t=0;t<e.length;t++)r.push(s),s+=e[t].length,Fc(n,e[t]);const o=function(t,e,n){n=n||2;let r,i,s,o,a,l,c,u=e&&e.length,h=u?e[0]*n:t.length,p=hc(t,0,h,n,!0),d=[];if(!p||p.next===p.prev)return d;if(u&&(p=function(t,e,n,r){let i,s,o,a,l,c=[];for(i=0,s=e.length;i<s;i++)o=e[i]*r,a=i<s-1?e[i+1]*r:t.length,l=hc(t,o,a,r,!1),l===l.next&&(l.steiner=!0),c.push(wc(l));for(c.sort(yc),i=0;i<c.length;i++)vc(c[i],n),n=pc(n,n.next);return n}(t,e,p,n)),t.length>80*n){r=s=t[0],i=o=t[1];for(let e=n;e<h;e+=n)a=t[e],l=t[e+1],a<r&&(r=a),l<i&&(i=l),a>s&&(s=a),l>o&&(o=l);c=Math.max(s-r,o-i),c=0!==c?1/c:0}return dc(p,d,n,r,i,c),d}(n,r);for(let t=0;t<o.length;t+=3)i.push(o.slice(t,t+3));return i}};function Oc(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Fc(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}function kc(t,e){ds.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new Dc(t,e)),this.mergeVertices()}function Dc(t,e){ji.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,r=[],i=[];for(let e=0,n=t.length;e<n;e++)s(t[e]);function s(t){const s=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:100,c=void 0===e.bevelEnabled||e.bevelEnabled,u=void 0!==e.bevelThickness?e.bevelThickness:6,h=void 0!==e.bevelSize?e.bevelSize:u-2,p=void 0!==e.bevelOffset?e.bevelOffset:0,d=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:Uc;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let _,g,y,v,b,x=!1;f&&(_=f.getSpacedPoints(a),x=!0,c=!1,g=f.computeFrenetFrames(a,!1),y=new Jn,v=new Jn,b=new Jn),c||(d=0,u=0,h=0,p=0);const w=t.extractPoints(o);let S=w.shape;const M=w.holes;if(!Ic.isClockWise(S)){S=S.reverse();for(let t=0,e=M.length;t<e;t++){const e=M[t];Ic.isClockWise(e)&&(M[t]=e.reverse())}}const T=Ic.triangulateShape(S,M),E=S;for(let t=0,e=M.length;t<e;t++){const e=M[t];S=S.concat(e)}function A(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const $=S.length,C=T.length;function B(t,e,n){let r,i,s;const o=t.x-e.x,a=t.y-e.y,l=n.x-t.x,c=n.y-t.y,u=o*o+a*a,h=o*c-a*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),p=Math.sqrt(l*l+c*c),d=e.x-a/h,f=e.y+o/h,m=((n.x-c/p-d)*c-(n.y+l/p-f)*l)/(o*c-a*l);r=d+o*m-t.x,i=f+a*m-t.y;const _=r*r+i*i;if(_<=2)return new kn(r,i);s=Math.sqrt(_/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(c)&&(t=!0),t?(r=-a,i=o,s=Math.sqrt(u)):(r=o,i=a,s=Math.sqrt(u/2))}return new kn(r/s,i/s)}const L=[];for(let t=0,e=E.length,n=e-1,r=t+1;t<e;t++,n++,r++)n===e&&(n=0),r===e&&(r=0),L[t]=B(E[t],E[n],E[r]);const R=[];let N,P=L.concat();for(let t=0,e=M.length;t<e;t++){const e=M[t];N=[];for(let t=0,n=e.length,r=n-1,i=t+1;t<n;t++,r++,i++)r===n&&(r=0),i===n&&(i=0),N[t]=B(e[t],e[r],e[i]);R.push(N),P=P.concat(N)}for(let t=0;t<d;t++){const e=t/d,n=u*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+p;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],L[t],r);F(e.x,e.y,-n)}for(let t=0,e=M.length;t<e;t++){const e=M[t];N=R[t];for(let t=0,i=e.length;t<i;t++){const i=A(e[t],N[t],r);F(i.x,i.y,-n)}}}const I=h+p;for(let t=0;t<$;t++){const e=c?A(S[t],P[t],I):S[t];x?(v.copy(g.normals[0]).multiplyScalar(e.x),y.copy(g.binormals[0]).multiplyScalar(e.y),b.copy(_[0]).add(v).add(y),F(b.x,b.y,b.z)):F(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<$;e++){const n=c?A(S[e],P[e],I):S[e];x?(v.copy(g.normals[t]).multiplyScalar(n.x),y.copy(g.binormals[t]).multiplyScalar(n.y),b.copy(_[t]).add(v).add(y),F(b.x,b.y,b.z)):F(n.x,n.y,l/a*t)}for(let t=d-1;t>=0;t--){const e=t/d,n=u*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+p;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],L[t],r);F(e.x,e.y,l+n)}for(let t=0,e=M.length;t<e;t++){const e=M[t];N=R[t];for(let t=0,i=e.length;t<i;t++){const i=A(e[t],N[t],r);x?F(i.x,i.y+_[a-1].y,_[a-1].x+n):F(i.x,i.y,l+n)}}}function O(t,e){let n=t.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=t.length-1);for(let t=0,n=a+2*d;t<n;t++){const n=$*t,s=$*(t+1);D(e+r+n,e+i+n,e+i+s,e+r+s)}}}function F(t,e,n){s.push(t),s.push(e),s.push(n)}function k(t,e,i){U(t),U(e),U(i);const s=r.length/3,o=m.generateTopUV(n,r,s-3,s-2,s-1);z(o[0]),z(o[1]),z(o[2])}function D(t,e,i,s){U(t),U(e),U(s),U(e),U(i),U(s);const o=r.length/3,a=m.generateSideWallUV(n,r,o-6,o-3,o-2,o-1);z(a[0]),z(a[1]),z(a[3]),z(a[1]),z(a[2]),z(a[3])}function U(t){r.push(s[3*t+0]),r.push(s[3*t+1]),r.push(s[3*t+2])}function z(t){i.push(t.x),i.push(t.y)}!function(){const t=r.length/3;if(c){let t=0,e=$*t;for(let t=0;t<C;t++){const n=T[t];k(n[2]+e,n[1]+e,n[0]+e)}t=a+2*d,e=$*t;for(let t=0;t<C;t++){const n=T[t];k(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<C;t++){const e=T[t];k(e[2],e[1],e[0])}for(let t=0;t<C;t++){const e=T[t];k(e[0]+$*a,e[1]+$*a,e[2]+$*a)}}n.addGroup(t,r.length/3-t,0)}(),function(){const t=r.length/3;let e=0;O(E,e),e+=E.length;for(let t=0,n=M.length;t<n;t++){const n=M[t];O(n,e),e+=n.length}n.addGroup(t,r.length/3-t,1)}()}this.setAttribute("position",new Li(r,3)),this.setAttribute("uv",new Li(i,2)),this.computeVertexNormals()}kc.prototype=Object.create(ds.prototype),kc.prototype.constructor=kc,kc.prototype.toJSON=function(){const t=ds.prototype.toJSON.call(this);return zc(this.parameters.shapes,this.parameters.options,t)},Dc.prototype=Object.create(ji.prototype),Dc.prototype.constructor=Dc,Dc.prototype.toJSON=function(){const t=ji.prototype.toJSON.call(this);return zc(this.parameters.shapes,this.parameters.options,t)};const Uc={generateTopUV:function(t,e,n,r,i){const s=e[3*n],o=e[3*n+1],a=e[3*r],l=e[3*r+1],c=e[3*i],u=e[3*i+1];return[new kn(s,o),new kn(a,l),new kn(c,u)]},generateSideWallUV:function(t,e,n,r,i,s){const o=e[3*n],a=e[3*n+1],l=e[3*n+2],c=e[3*r],u=e[3*r+1],h=e[3*r+2],p=e[3*i],d=e[3*i+1],f=e[3*i+2],m=e[3*s],_=e[3*s+1],g=e[3*s+2];return Math.abs(a-u)<.01?[new kn(o,1-l),new kn(c,1-h),new kn(p,1-f),new kn(m,1-g)]:[new kn(a,1-l),new kn(u,1-h),new kn(d,1-f),new kn(_,1-g)]}};function zc(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,r=t.length;e<r;e++){const r=t[e];n.shapes.push(r.uuid)}else n.shapes.push(t.uuid);return void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}function jc(t,e){ds.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new Gc(t,e)),this.mergeVertices()}function Gc(t,e){const n=(e=e||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new ds;const r=n.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),Dc.call(this,r,e),this.type="TextBufferGeometry"}function Hc(t,e,n,r,i,s,o){ds.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o},this.fromBufferGeometry(new Vc(t,e,n,r,i,s,o)),this.mergeVertices()}function Vc(t,e,n,r,i,s,o){ji.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o},t=t||1,e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,s=void 0!==s?s:0,o=void 0!==o?o:Math.PI;const a=Math.min(s+o,Math.PI);let l=0;const c=[],u=new Jn,h=new Jn,p=[],d=[],f=[],m=[];for(let p=0;p<=n;p++){const _=[],g=p/n;let y=0;0==p&&0==s?y=.5/e:p==n&&a==Math.PI&&(y=-.5/e);for(let n=0;n<=e;n++){const a=n/e;u.x=-t*Math.cos(r+a*i)*Math.sin(s+g*o),u.y=t*Math.cos(s+g*o),u.z=t*Math.sin(r+a*i)*Math.sin(s+g*o),d.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+y,1-g),_.push(l++)}c.push(_)}for(let t=0;t<n;t++)for(let r=0;r<e;r++){const e=c[t][r+1],i=c[t][r],o=c[t+1][r],l=c[t+1][r+1];(0!==t||s>0)&&p.push(e,i,l),(t!==n-1||a<Math.PI)&&p.push(i,o,l)}this.setIndex(p),this.setAttribute("position",new Li(d,3)),this.setAttribute("normal",new Li(f,3)),this.setAttribute("uv",new Li(m,2))}function Wc(t,e,n,r,i,s){ds.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:s},this.fromBufferGeometry(new qc(t,e,n,r,i,s)),this.mergeVertices()}function qc(t,e,n,r,i,s){ji.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:s},t=t||.5,e=e||1,i=void 0!==i?i:0,s=void 0!==s?s:2*Math.PI,n=void 0!==n?Math.max(3,n):8;const o=[],a=[],l=[],c=[];let u=t;const h=(e-t)/(r=void 0!==r?Math.max(1,r):1),p=new Jn,d=new kn;for(let t=0;t<=r;t++){for(let t=0;t<=n;t++){const r=i+t/n*s;p.x=u*Math.cos(r),p.y=u*Math.sin(r),a.push(p.x,p.y,p.z),l.push(0,0,1),d.x=(p.x/e+1)/2,d.y=(p.y/e+1)/2,c.push(d.x,d.y)}u+=h}for(let t=0;t<r;t++){const e=t*(n+1);for(let t=0;t<n;t++){const r=t+e,i=r,s=r+n+1,a=r+n+2,l=r+1;o.push(i,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new Li(a,3)),this.setAttribute("normal",new Li(l,3)),this.setAttribute("uv",new Li(c,2))}function Xc(t,e,n,r){ds.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},this.fromBufferGeometry(new Yc(t,e,n,r)),this.mergeVertices()}function Yc(t,e,n,r){ji.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},e=Math.floor(e)||12,n=n||0,r=r||2*Math.PI,r=Fn.clamp(r,0,2*Math.PI);const i=[],s=[],o=[],a=1/e,l=new Jn,c=new kn;for(let i=0;i<=e;i++){const u=n+i*a*r,h=Math.sin(u),p=Math.cos(u);for(let n=0;n<=t.length-1;n++)l.x=t[n].x*h,l.y=t[n].y,l.z=t[n].x*p,s.push(l.x,l.y,l.z),c.x=i/e,c.y=n/(t.length-1),o.push(c.x,c.y)}for(let n=0;n<e;n++)for(let e=0;e<t.length-1;e++){const r=e+n*t.length,s=r,o=r+t.length,a=r+t.length+1,l=r+1;i.push(s,o,l),i.push(o,a,l)}if(this.setIndex(i),this.setAttribute("position",new Li(s,3)),this.setAttribute("uv",new Li(o,2)),this.computeVertexNormals(),r===2*Math.PI){const n=this.attributes.normal.array,r=new Jn,i=new Jn,s=new Jn,o=e*t.length*3;for(let e=0,a=0;e<t.length;e++,a+=3)r.x=n[a+0],r.y=n[a+1],r.z=n[a+2],i.x=n[o+a+0],i.y=n[o+a+1],i.z=n[o+a+2],s.addVectors(r,i).normalize(),n[a+0]=n[o+a+0]=s.x,n[a+1]=n[o+a+1]=s.y,n[a+2]=n[o+a+2]=s.z}}function Jc(t,e){ds.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Zc(t,e)),this.mergeVertices()}function Zc(t,e){ji.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;const n=[],r=[],i=[],s=[];let o=0,a=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(o,a,e),o+=a,a=0;function l(t){const o=r.length/3,l=t.extractPoints(e);let c=l.shape;const u=l.holes;!1===Ic.isClockWise(c)&&(c=c.reverse());for(let t=0,e=u.length;t<e;t++){const e=u[t];!0===Ic.isClockWise(e)&&(u[t]=e.reverse())}const h=Ic.triangulateShape(c,u);for(let t=0,e=u.length;t<e;t++){const e=u[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];r.push(e.x,e.y,0),i.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=h.length;t<e;t++){const e=h[t],r=e[0]+o,i=e[1]+o,s=e[2]+o;n.push(r,i,s),a+=3}}this.setIndex(n),this.setAttribute("position",new Li(r,3)),this.setAttribute("normal",new Li(i,3)),this.setAttribute("uv",new Li(s,2))}function Qc(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,r=t.length;n<r;n++){const r=t[n];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}function Kc(t,e){ji.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;const n=[],r=Math.cos(Fn.DEG2RAD*e),i=[0,0],s={};let o,a,l;const c=["a","b","c"];let u;t.isBufferGeometry?(u=new ds,u.fromBufferGeometry(t)):u=t.clone(),u.mergeVertices(),u.computeFaceNormals();const h=u.vertices,p=u.faces;for(let t=0,e=p.length;t<e;t++){const e=p[t];for(let n=0;n<3;n++)o=e[c[n]],a=e[c[(n+1)%3]],i[0]=Math.min(o,a),i[1]=Math.max(o,a),l=i[0]+","+i[1],void 0===s[l]?s[l]={index1:i[0],index2:i[1],face1:t,face2:void 0}:s[l].face2=t}for(l in s){const t=s[l];if(void 0===t.face2||p[t.face1].normal.dot(p[t.face2].normal)<=r){let e=h[t.index1];n.push(e.x,e.y,e.z),e=h[t.index2],n.push(e.x,e.y,e.z)}}this.setAttribute("position",new Li(n,3))}function tu(t,e,n,r,i,s,o,a){ds.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new eu(t,e,n,r,i,s,o,a)),this.mergeVertices()}function eu(t,e,n,r,i,s,o,a){ji.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a};const l=this;t=void 0!==t?t:1,e=void 0!==e?e:1,n=n||1,r=Math.floor(r)||8,i=Math.floor(i)||1,s=void 0!==s&&s,o=void 0!==o?o:0,a=void 0!==a?a:2*Math.PI;const c=[],u=[],h=[],p=[];let d=0;const f=[],m=n/2;let _=0;function g(n){let i,s;const f=new kn,g=new Jn;let y=0;const v=!0===n?t:e,b=!0===n?1:-1;i=d;for(let t=1;t<=r;t++)u.push(0,m*b,0),h.push(0,b,0),p.push(.5,.5),d++;s=d;for(let t=0;t<=r;t++){const e=t/r*a+o,n=Math.cos(e),i=Math.sin(e);g.x=v*i,g.y=m*b,g.z=v*n,u.push(g.x,g.y,g.z),h.push(0,b,0),f.x=.5*n+.5,f.y=.5*i*b+.5,p.push(f.x,f.y),d++}for(let t=0;t<r;t++){const e=i+t,r=s+t;!0===n?c.push(r,r+1,e):c.push(r+1,r,e),y+=3}l.addGroup(_,y,!0===n?1:2),_+=y}!function(){const s=new Jn,g=new Jn;let y=0;const v=(e-t)/n;for(let l=0;l<=i;l++){const c=[],_=l/i,y=_*(e-t)+t;for(let t=0;t<=r;t++){const e=t/r,i=e*a+o,l=Math.sin(i),f=Math.cos(i);g.x=y*l,g.y=-_*n+m,g.z=y*f,u.push(g.x,g.y,g.z),s.set(l,v,f).normalize(),h.push(s.x,s.y,s.z),p.push(e,1-_),c.push(d++)}f.push(c)}for(let t=0;t<r;t++)for(let e=0;e<i;e++){const n=f[e][t],r=f[e+1][t],i=f[e+1][t+1],s=f[e][t+1];c.push(n,r,s),c.push(r,i,s),y+=6}l.addGroup(_,y,0),_+=y}(),!1===s&&(t>0&&g(!0),e>0&&g(!1)),this.setIndex(c),this.setAttribute("position",new Li(u,3)),this.setAttribute("normal",new Li(h,3)),this.setAttribute("uv",new Li(p,2))}function nu(t,e,n,r,i,s,o){tu.call(this,0,t,e,n,r,i,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:s,thetaLength:o}}function ru(t,e,n,r,i,s,o){eu.call(this,0,t,e,n,r,i,s,o),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:s,thetaLength:o}}function iu(t,e,n,r){ds.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new su(t,e,n,r)),this.mergeVertices()}function su(t,e,n,r){ji.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},t=t||1,e=void 0!==e?Math.max(3,e):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;const i=[],s=[],o=[],a=[],l=new Jn,c=new kn;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let i=0,u=3;i<=e;i++,u+=3){const h=n+i/e*r;l.x=t*Math.cos(h),l.y=t*Math.sin(h),s.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(s[u]/t+1)/2,c.y=(s[u+1]/t+1)/2,a.push(c.x,c.y)}for(let t=1;t<=e;t++)i.push(t,t+1,0);this.setIndex(i),this.setAttribute("position",new Li(s,3)),this.setAttribute("normal",new Li(o,3)),this.setAttribute("uv",new Li(a,2))}jc.prototype=Object.create(ds.prototype),jc.prototype.constructor=jc,Gc.prototype=Object.create(Dc.prototype),Gc.prototype.constructor=Gc,Hc.prototype=Object.create(ds.prototype),Hc.prototype.constructor=Hc,Vc.prototype=Object.create(ji.prototype),Vc.prototype.constructor=Vc,Wc.prototype=Object.create(ds.prototype),Wc.prototype.constructor=Wc,qc.prototype=Object.create(ji.prototype),qc.prototype.constructor=qc,Xc.prototype=Object.create(ds.prototype),Xc.prototype.constructor=Xc,Yc.prototype=Object.create(ji.prototype),Yc.prototype.constructor=Yc,Jc.prototype=Object.create(ds.prototype),Jc.prototype.constructor=Jc,Jc.prototype.toJSON=function(){const t=ds.prototype.toJSON.call(this);return Qc(this.parameters.shapes,t)},Zc.prototype=Object.create(ji.prototype),Zc.prototype.constructor=Zc,Zc.prototype.toJSON=function(){const t=ji.prototype.toJSON.call(this);return Qc(this.parameters.shapes,t)},Kc.prototype=Object.create(ji.prototype),Kc.prototype.constructor=Kc,tu.prototype=Object.create(ds.prototype),tu.prototype.constructor=tu,eu.prototype=Object.create(ji.prototype),eu.prototype.constructor=eu,nu.prototype=Object.create(tu.prototype),nu.prototype.constructor=nu,ru.prototype=Object.create(eu.prototype),ru.prototype.constructor=ru,iu.prototype=Object.create(ds.prototype),iu.prototype.constructor=iu,su.prototype=Object.create(ji.prototype),su.prototype.constructor=su;var ou=Object.freeze({__proto__:null,WireframeGeometry:Wl,ParametricGeometry:ql,ParametricBufferGeometry:Xl,TetrahedronGeometry:Zl,TetrahedronBufferGeometry:Ql,OctahedronGeometry:Kl,OctahedronBufferGeometry:tc,IcosahedronGeometry:ec,IcosahedronBufferGeometry:nc,DodecahedronGeometry:rc,DodecahedronBufferGeometry:ic,PolyhedronGeometry:Yl,PolyhedronBufferGeometry:Jl,TubeGeometry:sc,TubeBufferGeometry:oc,TorusKnotGeometry:ac,TorusKnotBufferGeometry:lc,TorusGeometry:cc,TorusBufferGeometry:uc,TextGeometry:jc,TextBufferGeometry:Gc,SphereGeometry:Hc,SphereBufferGeometry:Vc,RingGeometry:Wc,RingBufferGeometry:qc,PlaneGeometry:Is,PlaneBufferGeometry:Os,LatheGeometry:Xc,LatheBufferGeometry:Yc,ShapeGeometry:Jc,ShapeBufferGeometry:Zc,ExtrudeGeometry:kc,ExtrudeBufferGeometry:Dc,EdgesGeometry:Kc,ConeGeometry:nu,ConeBufferGeometry:ru,CylinderGeometry:tu,CylinderBufferGeometry:eu,CircleGeometry:iu,CircleBufferGeometry:su,BoxGeometry:fs,BoxBufferGeometry:ms});function au(t){vi.call(this),this.type="ShadowMaterial",this.color=new di(0),this.transparent=!0,this.setValues(t)}function lu(t){xs.call(this,t),this.type="RawShaderMaterial"}function cu(t){vi.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new di(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new di(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function uu(t){cu.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new kn(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(t)}function hu(t){vi.call(this),this.type="MeshPhongMaterial",this.color=new di(16777215),this.specular=new di(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new di(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function pu(t){vi.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new di(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new di(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function du(t){vi.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function fu(t){vi.call(this),this.type="MeshLambertMaterial",this.color=new di(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new di(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function mu(t){vi.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new di(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function _u(t){Ml.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}au.prototype=Object.create(vi.prototype),au.prototype.constructor=au,au.prototype.isShadowMaterial=!0,au.prototype.copy=function(t){return vi.prototype.copy.call(this,t),this.color.copy(t.color),this},lu.prototype=Object.create(xs.prototype),lu.prototype.constructor=lu,lu.prototype.isRawShaderMaterial=!0,cu.prototype=Object.create(vi.prototype),cu.prototype.constructor=cu,cu.prototype.isMeshStandardMaterial=!0,cu.prototype.copy=function(t){return vi.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},uu.prototype=Object.create(cu.prototype),uu.prototype.constructor=uu,uu.prototype.isMeshPhysicalMaterial=!0,uu.prototype.copy=function(t){return cu.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new di).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this},hu.prototype=Object.create(vi.prototype),hu.prototype.constructor=hu,hu.prototype.isMeshPhongMaterial=!0,hu.prototype.copy=function(t){return vi.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},pu.prototype=Object.create(vi.prototype),pu.prototype.constructor=pu,pu.prototype.isMeshToonMaterial=!0,pu.prototype.copy=function(t){return vi.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},du.prototype=Object.create(vi.prototype),du.prototype.constructor=du,du.prototype.isMeshNormalMaterial=!0,du.prototype.copy=function(t){return vi.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},fu.prototype=Object.create(vi.prototype),fu.prototype.constructor=fu,fu.prototype.isMeshLambertMaterial=!0,fu.prototype.copy=function(t){return vi.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},mu.prototype=Object.create(vi.prototype),mu.prototype.constructor=mu,mu.prototype.isMeshMatcapMaterial=!0,mu.prototype.copy=function(t){return vi.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},_u.prototype=Object.create(Ml.prototype),_u.prototype.constructor=_u,_u.prototype.isLineDashedMaterial=!0,_u.prototype.copy=function(t){return Ml.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var gu=Object.freeze({__proto__:null,ShadowMaterial:au,SpriteMaterial:Ya,RawShaderMaterial:lu,ShaderMaterial:xs,PointsMaterial:Il,MeshPhysicalMaterial:uu,MeshStandardMaterial:cu,MeshPhongMaterial:hu,MeshToonMaterial:pu,MeshNormalMaterial:du,MeshLambertMaterial:fu,MeshDepthMaterial:Ca,MeshDistanceMaterial:Ba,MeshBasicMaterial:bi,MeshMatcapMaterial:mu,LineDashedMaterial:_u,LineBasicMaterial:Ml,Material:vi});const yu={arraySlice:function(t,e,n){return yu.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){const r=t.length,i=new t.constructor(r);for(let s=0,o=0;o!==r;++s){const r=n[s]*e;for(let n=0;n!==e;++n)i[o++]=t[r+n]}return i},flattenJSON:function(t,e,n,r){let i=1,s=t[0];for(;void 0!==s&&void 0===s[r];)s=t[i++];if(void 0===s)return;let o=s[r];if(void 0!==o)if(Array.isArray(o))do{o=s[r],void 0!==o&&(e.push(s.time),n.push.apply(n,o)),s=t[i++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[r],void 0!==o&&(e.push(s.time),o.toArray(n,n.length)),s=t[i++]}while(void 0!==s);else do{o=s[r],void 0!==o&&(e.push(s.time),n.push(o)),s=t[i++]}while(void 0!==s)},subclip:function(t,e,n,r,i){i=i||30;const s=t.clone();s.name=e;const o=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],a=e.getValueSize(),l=[],c=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*i;if(!(s<n||s>=r)){l.push(e.times[t]);for(let n=0;n<a;++n)c.push(e.values[t*a+n])}}0!==l.length&&(e.times=yu.convertArray(l,e.times.constructor),e.values=yu.convertArray(c,e.values.constructor),o.push(e))}s.tracks=o;let a=1/0;for(let t=0;t<s.tracks.length;++t)a>s.tracks[t].times[0]&&(a=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=t),(void 0===r||r<=0)&&(r=30);const i=t.tracks.length,s=e/r;for(let e=0;e<i;++e){const r=n.tracks[e],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const o=t.tracks.find((function(t){return t.name===r.name&&t.ValueTypeName===i}));if(void 0===o)continue;const a=r.getValueSize(),l=r.times.length-1;let c;if(s<=r.times[0])c=yu.arraySlice(r.values,0,r.valueSize);else if(s>=r.times[l]){const t=l*a;c=yu.arraySlice(r.values,t)}else{const t=r.createInterpolant();t.evaluate(s),c=t.resultBuffer}"quaternion"===i&&new qn(c[0],c[1],c[2],c[3]).normalize().conjugate().toArray(c);const u=o.times.length;for(let t=0;t<u;++t){const e=t*a;if("quaternion"===i)qn.multiplyQuaternionsFlat(o.values,e,c,0,o.values,e);else for(let t=0;t<a;++t)o.values[e+t]-=c[t]}}return t.blendMode=We,t}};function vu(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function bu(t,e,n,r){vu.call(this,t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function xu(t,e,n,r){vu.call(this,t,e,n,r)}function wu(t,e,n,r){vu.call(this,t,e,n,r)}function Su(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=yu.convertArray(e,this.TimeBufferType),this.values=yu.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function Mu(t,e,n){Su.call(this,t,e,n)}function Tu(t,e,n,r){Su.call(this,t,e,n,r)}function Eu(t,e,n,r){Su.call(this,t,e,n,r)}function Au(t,e,n,r){vu.call(this,t,e,n,r)}function $u(t,e,n,r){Su.call(this,t,e,n,r)}function Cu(t,e,n,r){Su.call(this,t,e,n,r)}function Bu(t,e,n,r){Su.call(this,t,e,n,r)}function Lu(t,e,n,r){this.name=t,this.tracks=n,this.duration=void 0!==e?e:-1,this.blendMode=void 0!==r?r:Ve,this.uuid=Fn.generateUUID(),this.duration<0&&this.resetDuration()}function Ru(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Eu;case"vector":case"vector2":case"vector3":case"vector4":return Bu;case"color":return Tu;case"quaternion":return $u;case"bool":case"boolean":return Mu;case"string":return Cu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];yu.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(vu.prototype,{evaluate:function(t){let e=this.parameterPositions,n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{let s;n:{r:if(!(t<r)){for(let s=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,i)}if(n===s)break;if(i=r,r=e[++n],t<r)break e}s=e.length;break n}if(t>=i)break t;{const o=e[1];t<o&&(n=2,i=o);for(let s=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===s)break;if(r=i,i=e[--n-1],t>=i)break e}s=n,n=0}}for(;n<s;){const r=n+s>>>1;t<e[r]?s=r:n=r+1}if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){const e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r;for(let t=0;t!==r;++t)e[t]=n[i+t];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(vu.prototype,{beforeStart_:vu.prototype.copySampleValue_,afterEnd_:vu.prototype.copySampleValue_}),bu.prototype=Object.assign(Object.create(vu.prototype),{constructor:bu,DefaultSettings_:{endingStart:je,endingEnd:je},intervalChanged_:function(t,e,n){let r=this.parameterPositions,i=t-2,s=t+1,o=r[i],a=r[s];if(void 0===o)switch(this.getSettings_().endingStart){case Ge:i=t,o=2*e-n;break;case He:i=r.length-2,o=e+r[i]-r[i+1];break;default:i=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case Ge:s=t,a=2*n-e;break;case He:s=1,a=n+r[1]-r[0];break;default:s=t-1,a=e}const l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=i*c,this._offsetNext=s*c},interpolate_:function(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(n-e)/(r-e),f=d*d,m=f*d,_=-h*m+2*h*f-h*d,g=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,v=p*m-p*f;for(let t=0;t!==o;++t)i[t]=_*s[c+t]+g*s[l+t]+y*s[a+t]+v*s[u+t];return i}}),xu.prototype=Object.assign(Object.create(vu.prototype),{constructor:xu,interpolate_:function(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=(n-e)/(r-e),u=1-c;for(let t=0;t!==o;++t)i[t]=s[l+t]*u+s[a+t]*c;return i}}),wu.prototype=Object.assign(Object.create(vu.prototype),{constructor:wu,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(Su,{toJSON:function(t){const e=t.constructor;let n;if(void 0!==e.toJSON)n=e.toJSON(t);else{n={name:t.name,times:yu.convertArray(t.times,Array),values:yu.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}}),Object.assign(Su.prototype,{constructor:Su,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Ue,InterpolantFactoryMethodDiscrete:function(t){return new wu(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new xu(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new bu(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){let e;switch(t){case De:e=this.InterpolantFactoryMethodDiscrete;break;case Ue:e=this.InterpolantFactoryMethodLinear;break;case ze:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return De;case this.InterpolantFactoryMethodLinear:return Ue;case this.InterpolantFactoryMethodSmooth:return ze}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]+=t}return this},scale:function(t){if(1!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]*=t}return this},trim:function(t,e){const n=this.times,r=n.length;let i=0,s=r-1;for(;i!==r&&n[i]<t;)++i;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==i||s!==r){i>=s&&(s=Math.max(s,1),i=s-1);const t=this.getValueSize();this.times=yu.arraySlice(n,i,s),this.values=yu.arraySlice(this.values,i*t,s*t)}return this},validate:function(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==i;e++){const r=n[e];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,r),t=!1;break}if(null!==s&&s>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,r,s),t=!1;break}s=r}if(void 0!==r&&yu.isTypedArray(r))for(let e=0,n=r.length;e!==n;++e){const n=r[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t},optimize:function(){const t=yu.arraySlice(this.times),e=yu.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===ze,i=t.length-1;let s=1;for(let o=1;o<i;++o){let i=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==a[0]))if(r)i=!0;else{const t=o*n,r=t-n,s=t+n;for(let o=0;o!==n;++o){const n=e[t+o];if(n!==e[r+o]||n!==e[s+o]){i=!0;break}}}if(i){if(o!==s){t[s]=t[o];const r=o*n,i=s*n;for(let t=0;t!==n;++t)e[i+t]=e[r+t]}++s}}if(i>0){t[s]=t[i];for(let t=i*n,r=s*n,o=0;o!==n;++o)e[r+o]=e[t+o];++s}return s!==t.length?(this.times=yu.arraySlice(t,0,s),this.values=yu.arraySlice(e,0,s*n)):(this.times=t,this.values=e),this},clone:function(){const t=yu.arraySlice(this.times,0),e=yu.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}),Mu.prototype=Object.assign(Object.create(Su.prototype),{constructor:Mu,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:De,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Tu.prototype=Object.assign(Object.create(Su.prototype),{constructor:Tu,ValueTypeName:"color"}),Eu.prototype=Object.assign(Object.create(Su.prototype),{constructor:Eu,ValueTypeName:"number"}),Au.prototype=Object.assign(Object.create(vu.prototype),{constructor:Au,interpolate_:function(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(r-e);let l=t*o;for(let t=l+o;l!==t;l+=4)qn.slerpFlat(i,0,s,l-o,s,l,a);return i}}),$u.prototype=Object.assign(Object.create(Su.prototype),{constructor:$u,ValueTypeName:"quaternion",DefaultInterpolation:Ue,InterpolantFactoryMethodLinear:function(t){return new Au(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Cu.prototype=Object.assign(Object.create(Su.prototype),{constructor:Cu,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:De,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Bu.prototype=Object.assign(Object.create(Su.prototype),{constructor:Bu,ValueTypeName:"vector"}),Object.assign(Lu,{parse:function(t){const e=[],n=t.tracks,r=1/(t.fps||1);for(let t=0,i=n.length;t!==i;++t)e.push(Ru(n[t]).scale(r));return new Lu(t.name,t.duration,e,t.blendMode)},toJSON:function(t){const e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,r=n.length;t!==r;++t)e.push(Su.toJSON(n[t]));return r},CreateFromMorphTargetSequence:function(t,e,n,r){const i=e.length,s=[];for(let t=0;t<i;t++){let o=[],a=[];o.push((t+i-1)%i,t,(t+1)%i),a.push(0,1,0);const l=yu.getKeyframeOrder(o);o=yu.sortedArray(o,1,l),a=yu.sortedArray(a,1,l),r||0!==o[0]||(o.push(i),a.push(a[0])),s.push(new Eu(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/n))}return new Lu(t,-1,s)},findByName:function(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.name.match(i);if(s&&s.length>1){const t=s[1];let e=r[t];e||(r[t]=e=[]),e.push(n)}}const s=[];for(const t in r)s.push(Lu.CreateFromMorphTargetSequence(t,r[t],e,n));return s},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,r,i){if(0!==n.length){const s=[],o=[];yu.flattenJSON(n,s,o,r),0!==s.length&&i.push(new t(e,s,o))}},r=[],i=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const i=l[t].keys;if(i&&0!==i.length)if(i[0].morphTargets){const t={};let e;for(e=0;e<i.length;e++)if(i[e].morphTargets)for(let n=0;n<i[e].morphTargets.length;n++)t[i[e].morphTargets[n]]=-1;for(const n in t){const t=[],s=[];for(let r=0;r!==i[e].morphTargets.length;++r){const r=i[e];t.push(r.time),s.push(r.morphTarget===n?1:0)}r.push(new Eu(".morphTargetInfluence["+n+"]",t,s))}a=t.length*(s||1)}else{const s=".bones["+e[t].name+"]";n(Bu,s+".position",i,"pos",r),n($u,s+".quaternion",i,"rot",r),n(Bu,s+".scale",i,"scl",r)}}return 0===r.length?null:new Lu(i,a,r,o)}}),Object.assign(Lu.prototype,{resetDuration:function(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this},trim:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new Lu(this.name,this.duration,t,this.blendMode)}});const Nu={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function Pu(t,e,n){const r=this;let i,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===s&&void 0!==r.onStart&&r.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,a),o===a&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return i?i(t):t},this.setURLModifier=function(t){return i=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],r=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return r}return null}}const Iu=new Pu;function Ou(t){this.manager=void 0!==t?t:Iu,this.crossOrigin="anonymous",this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Ou.prototype,{load:function(){},loadAsync:function(t,e){const n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});const Fu={};function ku(t){Ou.call(this,t)}function Du(t){Ou.call(this,t)}function Uu(t){Ou.call(this,t)}function zu(t){Ou.call(this,t)}function ju(t){Ou.call(this,t)}function Gu(t){Ou.call(this,t)}function Hu(t){Ou.call(this,t)}function Vu(){this.type="Curve",this.arcLengthDivisions=200}function Wu(t,e,n,r,i,s,o,a){Vu.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=s||2*Math.PI,this.aClockwise=o||!1,this.aRotation=a||0}function qu(t,e,n,r,i,s){Wu.call(this,t,e,n,n,r,i,s),this.type="ArcCurve"}function Xu(){let t=0,e=0,n=0,r=0;function i(i,s,o,a){t=i,e=o,n=-3*i+3*s-2*o-a,r=2*i-2*s+o+a}return{initCatmullRom:function(t,e,n,r,s){i(e,n,s*(n-t),s*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,s,o,a){let l=(e-t)/s-(n-t)/(s+o)+(n-e)/o,c=(n-e)/o-(r-e)/(o+a)+(r-n)/a;l*=o,c*=o,i(e,n,l,c)},calc:function(i){const s=i*i;return t+e*i+n*s+r*(s*i)}}}ku.prototype=Object.assign(Object.create(Ou.prototype),{constructor:ku,load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=Nu.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;if(void 0!==Fu[t])return void Fu[t].push({onLoad:e,onProgress:n,onError:r});const o=t.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(o){const n=o[1],s=!!o[2];let a=o[3];a=decodeURIComponent(a),s&&(a=atob(a));try{let r;const s=(this.responseType||"").toLowerCase();switch(s){case"arraybuffer":case"blob":const t=new Uint8Array(a.length);for(let e=0;e<a.length;e++)t[e]=a.charCodeAt(e);r="blob"===s?new Blob([t.buffer],{type:n}):t.buffer;break;case"document":const e=new DOMParser;r=e.parseFromString(a,n);break;case"json":r=JSON.parse(a);break;default:r=a}setTimeout((function(){e&&e(r),i.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}),0)}}else{Fu[t]=[],Fu[t].push({onLoad:e,onProgress:n,onError:r}),a=new XMLHttpRequest,a.open("GET",t,!0),a.addEventListener("load",(function(e){const n=this.response,r=Fu[t];if(delete Fu[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Nu.add(t,n);for(let t=0,e=r.length;t<e;t++){const e=r[t];e.onLoad&&e.onLoad(n)}i.manager.itemEnd(t)}else{for(let t=0,n=r.length;t<n;t++){const n=r[t];n.onError&&n.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}}),!1),a.addEventListener("progress",(function(e){const n=Fu[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onProgress&&r.onProgress(e)}}),!1),a.addEventListener("error",(function(e){const n=Fu[t];delete Fu[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),a.addEventListener("abort",(function(e){const n=Fu[t];delete Fu[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)a.setRequestHeader(t,this.requestHeader[t]);a.send(null)}return i.manager.itemStart(t),a},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this}}),Du.prototype=Object.assign(Object.create(Ou.prototype),{constructor:Du,load:function(t,e,n,r){const i=this,s=new ku(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},parse:function(t){const e=[];for(let n=0;n<t.length;n++){const r=Lu.parse(t[n]);e.push(r)}return e}}),Uu.prototype=Object.assign(Object.create(Ou.prototype),{constructor:Uu,load:function(t,e,n,r){const i=this,s=[],o=new Gl;o.image=s;const a=new ku(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader);let l=0;function c(c){a.load(t[c],(function(t){const n=i.parse(t,!0);s[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(o.minFilter=vt),o.format=n.format,o.needsUpdate=!0,e&&e(o))}),n,r)}if(Array.isArray(t))for(let e=0,n=t.length;e<n;++e)c(e);else a.load(t,(function(t){const n=i.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)s[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),s[e].format=n.format,s[e].width=n.width,s[e].height=n.height}}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=vt),o.format=n.format,o.needsUpdate=!0,e&&e(o)}),n,r);return o}}),zu.prototype=Object.assign(Object.create(Ou.prototype),{constructor:zu,load:function(t,e,n,r){const i=this,s=new $s,o=new ku(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.load(t,(function(t){const n=i.parse(t);n&&(void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:pt,s.wrapT=void 0!==n.wrapT?n.wrapT:pt,s.magFilter=void 0!==n.magFilter?n.magFilter:vt,s.minFilter=void 0!==n.minFilter?n.minFilter:vt,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=wt),1===n.mipmapCount&&(s.minFilter=vt),s.needsUpdate=!0,e&&e(s,n))}),n,r),s}}),ju.prototype=Object.assign(Object.create(Ou.prototype),{constructor:ju,load:function(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=Nu.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;const o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),Nu.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(t),o.src=t,o}}),Gu.prototype=Object.assign(Object.create(Ou.prototype),{constructor:Gu,load:function(t,e,n,r){const i=new Qs,s=new ju(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(n){s.load(t[n],(function(t){i.images[n]=t,o++,6===o&&(i.needsUpdate=!0,e&&e(i))}),void 0,r)}for(let e=0;e<t.length;++e)a(e);return i}}),Hu.prototype=Object.assign(Object.create(Ou.prototype),{constructor:Hu,load:function(t,e,n,r){const i=new Gn,s=new ju(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(n){i.image=n;const r=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);i.format=r?Ft:kt,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i}}),Object.assign(Vu.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)},getPoints:function(t){void 0===t&&(t=5);const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){const t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,r=this.getPoint(0),i=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),i+=n.distanceTo(r),e.push(i),r=n;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){const n=this.getLengths();let r,i=0,s=n.length;r=e||t*n[s-1];let o,a=0,l=s-1;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),o=n[i]-r,o<0)a=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(i=l,n[i]===r)return i/(s-1);const c=n[i];return(i+(r-c)/(n[i+1]-c))/(s-1)},getTangent:function(t,e){const n=1e-4;let r=t-n,i=t+n;r<0&&(r=0),i>1&&(i=1);const s=this.getPoint(r),o=this.getPoint(i),a=e||(s.isVector2?new kn:new Jn);return a.copy(o).sub(s).normalize(),a},getTangentAt:function(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)},computeFrenetFrames:function(t,e){const n=new Jn,r=[],i=[],s=[],o=new Jn,a=new ir;for(let e=0;e<=t;e++){const n=e/t;r[e]=this.getTangentAt(n,new Jn),r[e].normalize()}i[0]=new Jn,s[0]=new Jn;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),s[0].crossVectors(r[0],i[0]);for(let e=1;e<=t;e++){if(i[e]=i[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(r[e-1],r[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(Fn.clamp(r[e-1].dot(r[e]),-1,1));i[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(r[e],i[e])}if(!0===e){let e=Math.acos(Fn.clamp(i[0].dot(i[t]),-1,1));e/=t,r[0].dot(o.crossVectors(i[0],i[t]))>0&&(e=-e);for(let n=1;n<=t;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],e*n)),s[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:s}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),Wu.prototype=Object.create(Vu.prototype),Wu.prototype.constructor=Wu,Wu.prototype.isEllipseCurve=!0,Wu.prototype.getPoint=function(t,e){const n=e||new kn,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const s=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=s?0:r),!0!==this.aClockwise||s||(i===r?i=-r:i-=r);const o=this.aStartAngle+t*i;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,r=l-this.aY;a=n*t-r*e+this.aX,l=n*e+r*t+this.aY}return n.set(a,l)},Wu.prototype.copy=function(t){return Vu.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Wu.prototype.toJSON=function(){const t=Vu.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},Wu.prototype.fromJSON=function(t){return Vu.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},qu.prototype=Object.create(Wu.prototype),qu.prototype.constructor=qu,qu.prototype.isArcCurve=!0;const Yu=new Jn,Ju=new Xu,Zu=new Xu,Qu=new Xu;function Ku(t,e,n,r){Vu.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=n||"centripetal",this.tension=void 0!==r?r:.5}function th(t,e,n,r,i){const s=.5*(r-e),o=.5*(i-n),a=t*t;return(2*n-2*r+s+o)*(t*a)+(-3*n+3*r-2*s-o)*a+s*t+n}function eh(t,e,n,r){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function nh(t,e,n,r,i){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}function rh(t,e,n,r){Vu.call(this),this.type="CubicBezierCurve",this.v0=t||new kn,this.v1=e||new kn,this.v2=n||new kn,this.v3=r||new kn}function ih(t,e,n,r){Vu.call(this),this.type="CubicBezierCurve3",this.v0=t||new Jn,this.v1=e||new Jn,this.v2=n||new Jn,this.v3=r||new Jn}function sh(t,e){Vu.call(this),this.type="LineCurve",this.v1=t||new kn,this.v2=e||new kn}function oh(t,e){Vu.call(this),this.type="LineCurve3",this.v1=t||new Jn,this.v2=e||new Jn}function ah(t,e,n){Vu.call(this),this.type="QuadraticBezierCurve",this.v0=t||new kn,this.v1=e||new kn,this.v2=n||new kn}function lh(t,e,n){Vu.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Jn,this.v1=e||new Jn,this.v2=n||new Jn}function ch(t){Vu.call(this),this.type="SplineCurve",this.points=t||[]}Ku.prototype=Object.create(Vu.prototype),Ku.prototype.constructor=Ku,Ku.prototype.isCatmullRomCurve3=!0,Ku.prototype.getPoint=function(t,e){const n=e||new Jn,r=this.points,i=r.length,s=(i-(this.closed?0:1))*t;let o,a,l,c,u=Math.floor(s),h=s-u;if(this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/i)+1)*i:0===h&&u===i-1&&(u=i-2,h=1),this.closed||u>0?o=r[(u-1)%i]:(Yu.subVectors(r[0],r[1]).add(r[0]),o=Yu),a=r[u%i],l=r[(u+1)%i],this.closed||u+2<i?c=r[(u+2)%i]:(Yu.subVectors(r[i-1],r[i-2]).add(r[i-1]),c=Yu),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(a),t),n=Math.pow(a.distanceToSquared(l),t),r=Math.pow(l.distanceToSquared(c),t);n<1e-4&&(n=1),e<1e-4&&(e=n),r<1e-4&&(r=n),Ju.initNonuniformCatmullRom(o.x,a.x,l.x,c.x,e,n,r),Zu.initNonuniformCatmullRom(o.y,a.y,l.y,c.y,e,n,r),Qu.initNonuniformCatmullRom(o.z,a.z,l.z,c.z,e,n,r)}else"catmullrom"===this.curveType&&(Ju.initCatmullRom(o.x,a.x,l.x,c.x,this.tension),Zu.initCatmullRom(o.y,a.y,l.y,c.y,this.tension),Qu.initCatmullRom(o.z,a.z,l.z,c.z,this.tension));return n.set(Ju.calc(h),Zu.calc(h),Qu.calc(h)),n},Ku.prototype.copy=function(t){Vu.prototype.copy.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Ku.prototype.toJSON=function(){const t=Vu.prototype.toJSON.call(this);t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Ku.prototype.fromJSON=function(t){Vu.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Jn).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},rh.prototype=Object.create(Vu.prototype),rh.prototype.constructor=rh,rh.prototype.isCubicBezierCurve=!0,rh.prototype.getPoint=function(t,e){const n=e||new kn,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(nh(t,r.x,i.x,s.x,o.x),nh(t,r.y,i.y,s.y,o.y)),n},rh.prototype.copy=function(t){return Vu.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},rh.prototype.toJSON=function(){const t=Vu.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},rh.prototype.fromJSON=function(t){return Vu.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},ih.prototype=Object.create(Vu.prototype),ih.prototype.constructor=ih,ih.prototype.isCubicBezierCurve3=!0,ih.prototype.getPoint=function(t,e){const n=e||new Jn,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(nh(t,r.x,i.x,s.x,o.x),nh(t,r.y,i.y,s.y,o.y),nh(t,r.z,i.z,s.z,o.z)),n},ih.prototype.copy=function(t){return Vu.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},ih.prototype.toJSON=function(){const t=Vu.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},ih.prototype.fromJSON=function(t){return Vu.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},sh.prototype=Object.create(Vu.prototype),sh.prototype.constructor=sh,sh.prototype.isLineCurve=!0,sh.prototype.getPoint=function(t,e){const n=e||new kn;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},sh.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},sh.prototype.getTangent=function(t,e){const n=e||new kn;return n.copy(this.v2).sub(this.v1).normalize(),n},sh.prototype.copy=function(t){return Vu.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},sh.prototype.toJSON=function(){const t=Vu.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},sh.prototype.fromJSON=function(t){return Vu.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},oh.prototype=Object.create(Vu.prototype),oh.prototype.constructor=oh,oh.prototype.isLineCurve3=!0,oh.prototype.getPoint=function(t,e){const n=e||new Jn;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},oh.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},oh.prototype.copy=function(t){return Vu.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},oh.prototype.toJSON=function(){const t=Vu.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},oh.prototype.fromJSON=function(t){return Vu.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},ah.prototype=Object.create(Vu.prototype),ah.prototype.constructor=ah,ah.prototype.isQuadraticBezierCurve=!0,ah.prototype.getPoint=function(t,e){const n=e||new kn,r=this.v0,i=this.v1,s=this.v2;return n.set(eh(t,r.x,i.x,s.x),eh(t,r.y,i.y,s.y)),n},ah.prototype.copy=function(t){return Vu.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},ah.prototype.toJSON=function(){const t=Vu.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},ah.prototype.fromJSON=function(t){return Vu.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},lh.prototype=Object.create(Vu.prototype),lh.prototype.constructor=lh,lh.prototype.isQuadraticBezierCurve3=!0,lh.prototype.getPoint=function(t,e){const n=e||new Jn,r=this.v0,i=this.v1,s=this.v2;return n.set(eh(t,r.x,i.x,s.x),eh(t,r.y,i.y,s.y),eh(t,r.z,i.z,s.z)),n},lh.prototype.copy=function(t){return Vu.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},lh.prototype.toJSON=function(){const t=Vu.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},lh.prototype.fromJSON=function(t){return Vu.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},ch.prototype=Object.create(Vu.prototype),ch.prototype.constructor=ch,ch.prototype.isSplineCurve=!0,ch.prototype.getPoint=function(t,e){const n=e||new kn,r=this.points,i=(r.length-1)*t,s=Math.floor(i),o=i-s,a=r[0===s?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],u=r[s>r.length-3?r.length-1:s+2];return n.set(th(o,a.x,l.x,c.x,u.x),th(o,a.y,l.y,c.y,u.y)),n},ch.prototype.copy=function(t){Vu.prototype.copy.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this},ch.prototype.toJSON=function(){const t=Vu.prototype.toJSON.call(this);t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t},ch.prototype.fromJSON=function(t){Vu.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new kn).fromArray(n))}return this};var uh=Object.freeze({__proto__:null,ArcCurve:qu,CatmullRomCurve3:Ku,CubicBezierCurve:rh,CubicBezierCurve3:ih,EllipseCurve:Wu,LineCurve:sh,LineCurve3:oh,QuadraticBezierCurve:ah,QuadraticBezierCurve3:lh,SplineCurve:ch});function hh(){Vu.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function ph(t){hh.call(this),this.type="Path",this.currentPoint=new kn,t&&this.setFromPoints(t)}function dh(t){ph.call(this,t),this.uuid=Fn.generateUUID(),this.type="Shape",this.holes=[]}function fh(t,e){wr.call(this),this.type="Light",this.color=new di(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function mh(t,e,n){fh.call(this,t,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(wr.DefaultUp),this.updateMatrix(),this.groundColor=new di(e)}function _h(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new kn(512,512),this.map=null,this.mapPass=null,this.matrix=new ir,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ls,this._frameExtents=new kn(1,1),this._viewportCount=1,this._viewports=[new Hn(0,0,1,1)]}function gh(){_h.call(this,new Ss(50,1,.5,500))}function yh(t,e,n,r,i,s){fh.call(this,t,e),this.type="SpotLight",this.position.copy(wr.DefaultUp),this.updateMatrix(),this.target=new wr,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==s?s:1,this.shadow=new gh}function vh(){_h.call(this,new Ss(90,1,.5,500)),this._frameExtents=new kn(4,2),this._viewportCount=6,this._viewports=[new Hn(2,1,1,1),new Hn(0,1,1,1),new Hn(3,1,1,1),new Hn(1,1,1,1),new Hn(3,0,1,1),new Hn(1,0,1,1)],this._cubeDirections=[new Jn(1,0,0),new Jn(-1,0,0),new Jn(0,0,1),new Jn(0,0,-1),new Jn(0,1,0),new Jn(0,-1,0)],this._cubeUps=[new Jn(0,1,0),new Jn(0,1,0),new Jn(0,1,0),new Jn(0,1,0),new Jn(0,0,1),new Jn(0,0,-1)]}function bh(t,e,n,r){fh.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new vh}function xh(t,e,n,r,i,s){ws.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==n?n:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==i?i:.1,this.far=void 0!==s?s:2e3,this.updateProjectionMatrix()}function wh(){_h.call(this,new xh(-5,5,5,-5,.5,500))}function Sh(t,e){fh.call(this,t,e),this.type="DirectionalLight",this.position.copy(wr.DefaultUp),this.updateMatrix(),this.target=new wr,this.shadow=new wh}function Mh(t,e){fh.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function Th(t,e,n,r){fh.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}function Eh(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Jn)}function Ah(t,e){fh.call(this,void 0,e),this.type="LightProbe",this.sh=void 0!==t?t:new Eh}function $h(t){Ou.call(this,t),this.textures={}}hh.prototype=Object.assign(Object.create(Vu.prototype),{constructor:hh,add:function(t){this.curves.push(t)},closePath:function(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new sh(e,t))},getPoint:function(t){const e=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=e){const t=n[r]-e,i=this.curves[r],s=i.getLength(),o=0===s?0:1-t/s;return i.getPointAt(o)}r++}return null},getLength:function(){const t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;const e=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const s=i[r],o=s&&s.isEllipseCurve?2*t:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o);for(let t=0;t<a.length;t++){const r=a[t];n&&n.equals(r)||(e.push(r),n=r)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(t){Vu.prototype.copy.call(this,t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){const t=Vu.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t},fromJSON:function(t){Vu.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new uh[n.type]).fromJSON(n))}return this}}),ph.prototype=Object.assign(Object.create(hh.prototype),{constructor:ph,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){const n=new sh(this.currentPoint.clone(),new kn(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,n,r){const i=new ah(this.currentPoint.clone(),new kn(t,e),new kn(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(t,e,n,r,i,s){const o=new rh(this.currentPoint.clone(),new kn(t,e),new kn(n,r),new kn(i,s));return this.curves.push(o),this.currentPoint.set(i,s),this},splineThru:function(t){const e=new ch([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,n,r,i,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,n,r,i,s),this},absarc:function(t,e,n,r,i,s){return this.absellipse(t,e,n,n,r,i,s),this},ellipse:function(t,e,n,r,i,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,r,i,s,o,a),this},absellipse:function(t,e,n,r,i,s,o,a){const l=new Wu(t,e,n,r,i,s,o,a);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(t){return hh.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){const t=hh.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return hh.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),dh.prototype=Object.assign(Object.create(ph.prototype),{constructor:dh,getPointsHoles:function(t){const e=[];for(let n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){ph.prototype.copy.call(this,t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this},toJSON:function(){const t=ph.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t},fromJSON:function(t){ph.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new ph).fromJSON(n))}return this}}),fh.prototype=Object.assign(Object.create(wr.prototype),{constructor:fh,isLight:!0,copy:function(t){return wr.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){const e=wr.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),mh.prototype=Object.assign(Object.create(fh.prototype),{constructor:mh,isHemisphereLight:!0,copy:function(t){return fh.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(_h.prototype,{_projScreenMatrix:new ir,_lightPositionWorld:new Jn,_lookTarget:new Jn,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){const e=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,s=this._lightPositionWorld;s.setFromMatrixPosition(t.matrixWorld),e.position.copy(s),i.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(i),e.updateMatrixWorld(),r.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),gh.prototype=Object.assign(Object.create(_h.prototype),{constructor:gh,isSpotLightShadow:!0,updateMatrices:function(t){const e=this.camera,n=2*Fn.RAD2DEG*t.angle,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),_h.prototype.updateMatrices.call(this,t)}}),yh.prototype=Object.assign(Object.create(fh.prototype),{constructor:yh,isSpotLight:!0,copy:function(t){return fh.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),vh.prototype=Object.assign(Object.create(_h.prototype),{constructor:vh,isPointLightShadow:!0,updateMatrices:function(t,e){void 0===e&&(e=0);const n=this.camera,r=this.matrix,i=this._lightPositionWorld,s=this._lookTarget,o=this._projScreenMatrix;i.setFromMatrixPosition(t.matrixWorld),n.position.copy(i),s.copy(n.position),s.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(s),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),o.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o)}}),bh.prototype=Object.assign(Object.create(fh.prototype),{constructor:bh,isPointLight:!0,copy:function(t){return fh.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),xh.prototype=Object.assign(Object.create(ws.prototype),{constructor:xh,isOrthographicCamera:!0,copy:function(t,e){return ws.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,n,r,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-t,s=n+t,o=r+e,a=r-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,s=i+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(i,s,o,a,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){const e=wr.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),wh.prototype=Object.assign(Object.create(_h.prototype),{constructor:wh,isDirectionalLightShadow:!0,updateMatrices:function(t){_h.prototype.updateMatrices.call(this,t)}}),Sh.prototype=Object.assign(Object.create(fh.prototype),{constructor:Sh,isDirectionalLight:!0,copy:function(t){return fh.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Mh.prototype=Object.assign(Object.create(fh.prototype),{constructor:Mh,isAmbientLight:!0}),Th.prototype=Object.assign(Object.create(fh.prototype),{constructor:Th,isRectAreaLight:!0,copy:function(t){return fh.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){const e=fh.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),Object.assign(Eh.prototype,{isSphericalHarmonics3:!0,set:function(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},zero:function(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,e){const n=t.x,r=t.y,i=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*r),e.addScaledVector(s[2],.488603*i),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],n*r*1.092548),e.addScaledVector(s[5],r*i*1.092548),e.addScaledVector(s[6],.315392*(3*i*i-1)),e.addScaledVector(s[7],n*i*1.092548),e.addScaledVector(s[8],.546274*(n*n-r*r)),e},getIrradianceAt:function(t,e){const n=t.x,r=t.y,i=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*r),e.addScaledVector(s[2],1.023328*i),e.addScaledVector(s[3],1.023328*n),e.addScaledVector(s[4],.858086*n*r),e.addScaledVector(s[5],.858086*r*i),e.addScaledVector(s[6],.743125*i*i-.247708),e.addScaledVector(s[7],.858086*n*i),e.addScaledVector(s[8],.429043*(n*n-r*r)),e},add:function(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},addScaledSH:function(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this},scale:function(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},lerp:function(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this},equals:function(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(t,e){void 0===e&&(e=0);const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(t,e+3*r);return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(t,e+3*r);return t}}),Object.assign(Eh,{getBasisAt:function(t,e){const n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)}}),Ah.prototype=Object.assign(Object.create(fh.prototype),{constructor:Ah,isLightProbe:!0,copy:function(t){return fh.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){const e=fh.prototype.toJSON.call(this,t);return e.object.sh=this.sh.toArray(),e}}),$h.prototype=Object.assign(Object.create(Ou.prototype),{constructor:$h,load:function(t,e,n,r){const i=this,s=new ku(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},parse:function(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const r=new gu[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=(new di).setHex(t.sheen)),void 0!==t.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&r.specular.setHex(t.specular),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(r.skinning=t.skinning),void 0!==t.morphTargets&&(r.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(r.morphNormals=t.morphNormals),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.vertexTangents&&(r.vertexTangents=t.vertexTangents),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?r.vertexColors=t.vertexColors>0:r.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const i=t.uniforms[e];switch(r.uniforms[e]={},i.type){case"t":r.uniforms[e].value=n(i.value);break;case"c":r.uniforms[e].value=(new di).setHex(i.value);break;case"v2":r.uniforms[e].value=(new kn).fromArray(i.value);break;case"v3":r.uniforms[e].value=(new Jn).fromArray(i.value);break;case"v4":r.uniforms[e].value=(new Hn).fromArray(i.value);break;case"m3":r.uniforms[e].value=(new Dn).fromArray(i.value);case"m4":r.uniforms[e].value=(new ir).fromArray(i.value);break;default:r.uniforms[e].value=i.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)r.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(r.flatShading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=n(t.map)),void 0!==t.matcap&&(r.matcap=n(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),r.normalScale=(new kn).fromArray(e)}return void 0!==t.displacementMap&&(r.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=n(t.specularMap)),void 0!==t.envMap&&(r.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new kn).fromArray(t.clearcoatNormalScale)),void 0!==t.transmission&&(r.transmission=t.transmission),void 0!==t.transmissionMap&&(r.transmissionMap=n(t.transmissionMap)),r},setTextures:function(t){return this.textures=t,this}});const Ch={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}},extractUrlBase:function(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};function Bh(){ji.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function Lh(t,e,n,r){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Si.call(this,t,e,n),this.meshPerAttribute=r||1}function Rh(t){Ou.call(this,t)}Bh.prototype=Object.assign(Object.create(ji.prototype),{constructor:Bh,isInstancedBufferGeometry:!0,copy:function(t){return ji.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t=ji.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),Lh.prototype=Object.assign(Object.create(Si.prototype),{constructor:Lh,isInstancedBufferAttribute:!0,copy:function(t){return Si.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){const t=Si.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),Rh.prototype=Object.assign(Object.create(Ou.prototype),{constructor:Rh,load:function(t,e,n,r){const i=this,s=new ku(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},parse:function(t){const e={},n={};function r(t,r){if(void 0!==e[r])return e[r];const i=t.interleavedBuffers[r],s=function(t,e){if(void 0!==n[e])return n[e];const r=t.arrayBuffers[e],i=new Uint32Array(r).buffer;return n[e]=i,i}(t,i.buffer),o=new Wa(new Nh[i.type](s),i.stride);return o.uuid=i.uuid,e[r]=o,o}const i=t.isInstancedBufferGeometry?new Bh:new ji,s=t.data.index;if(void 0!==s){const t=new Nh[s.type](s.array);i.setIndex(new Si(t,1))}const o=t.data.attributes;for(const e in o){const n=o[e];let s;if(n.isInterleavedBufferAttribute)s=new Xa(r(t.data,n.data),n.itemSize,n.offset,n.normalized);else{const t=new Nh[n.type](n.array);s=new(n.isInstancedBufferAttribute?Lh:Si)(t,n.itemSize,n.normalized)}void 0!==n.name&&(s.name=n.name),i.setAttribute(e,s)}const a=t.data.morphAttributes;if(a)for(const e in a){const n=a[e],s=[];for(let e=0,i=n.length;e<i;e++){const i=n[e];let o;o=i.isInterleavedBufferAttribute?new Xa(r(t.data,i.data),i.itemSize,i.offset,i.normalized):new Si(new Nh[i.type](i.array),i.itemSize,i.normalized),void 0!==i.name&&(o.name=i.name),s.push(o)}i.morphAttributes[e]=s}t.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];i.addGroup(e.start,e.count,e.materialIndex)}const c=t.data.boundingSphere;if(void 0!==c){const t=new Jn;void 0!==c.center&&t.fromArray(c.center),i.boundingSphere=new Ur(t,c.radius)}return t.name&&(i.name=t.name),t.userData&&(i.userData=t.userData),i}});const Nh={Int8Array,Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Ph(t){Ou.call(this,t)}Ph.prototype=Object.assign(Object.create(Ou.prototype),{constructor:Ph,load:function(t,e,n,r){const i=this,s=""===this.path?Ch.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const o=new ku(i.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.load(t,(function(n){let s=null;try{s=JSON.parse(n)}catch(e){return void 0!==r&&r(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const o=s.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?i.parse(s,e):console.error("THREE.ObjectLoader: Can't load "+t)}),n,r)},parse:function(t,e){const n=this.parseShape(t.shapes),r=this.parseGeometries(t.geometries,n),i=this.parseImages(t.images,(function(){void 0!==e&&e(a)})),s=this.parseTextures(t.textures,i),o=this.parseMaterials(t.materials,s),a=this.parseObject(t.object,r,o);return t.animations&&(a.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(a),a},parseShape:function(t){const e={};if(void 0!==t)for(let n=0,r=t.length;n<r;n++){const r=(new dh).fromJSON(t[n]);e[r.uuid]=r}return e},parseGeometries:function(t,e){const n={};let r;if(void 0!==t){const i=new Rh;for(let s=0,o=t.length;s<o;s++){let o;const a=t[s];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new ou[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new ou[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new ou[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new ou[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new ou[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new ou[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new ou[a.type](a.radius,a.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new ou[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new ou[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new ou[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new ou[a.type]((new uh[a.path.type]).fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new ou[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new ou[a.type](a.vertices,a.indices,a.radius,a.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":r=[];for(let t=0,n=a.shapes.length;t<n;t++){const n=e[a.shapes[t]];r.push(n)}o=new ou[a.type](r,a.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":r=[];for(let t=0,n=a.shapes.length;t<n;t++){const n=e[a.shapes[t]];r.push(n)}const t=a.options.extrudePath;void 0!==t&&(a.options.extrudePath=(new uh[t.type]).fromJSON(t)),o=new ou[a.type](r,a.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(a);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+a.type+'"');continue}o.uuid=a.uuid,void 0!==a.name&&(o.name=a.name),!0===o.isBufferGeometry&&void 0!==a.userData&&(o.userData=a.userData),n[a.uuid]=o}}return n},parseMaterials:function(t,e){const n={},r={};if(void 0!==t){const i=new $h;i.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];if("MultiMaterial"===s.type){const t=[];for(let e=0;e<s.materials.length;e++){const r=s.materials[e];void 0===n[r.uuid]&&(n[r.uuid]=i.parse(r)),t.push(n[r.uuid])}r[s.uuid]=t}else void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r},parseAnimations:function(t){const e=[];for(let n=0;n<t.length;n++){const r=t[n],i=Lu.parse(r);void 0!==r.uuid&&(i.uuid=r.uuid),e.push(i)}return e},parseImages:function(t,e){const n=this,r={};let i;function s(t){return n.manager.itemStart(t),i.load(t,(function(){n.manager.itemEnd(t)}),void 0,(function(){n.manager.itemError(t),n.manager.itemEnd(t)}))}if(void 0!==t&&t.length>0){const o=new Pu(e);i=new ju(o),i.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],o=i.url;if(Array.isArray(o)){r[i.uuid]=[];for(let t=0,e=o.length;t<e;t++){const e=o[t],a=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e;r[i.uuid].push(s(a))}}else{const t=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i.url)?i.url:n.resourcePath+i.url;r[i.uuid]=s(t)}}}return r},parseTextures:function(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const r={};if(void 0!==t)for(let i=0,s=t.length;i<s;i++){const s=t[i];let o;void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),o=Array.isArray(e[s.image])?new Qs(e[s.image]):new Gn(e[s.image]),o.needsUpdate=!0,o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=n(s.mapping,Ih)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=n(s.wrap[0],Oh),o.wrapT=n(s.wrap[1],Oh)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=n(s.minFilter,Fh)),void 0!==s.magFilter&&(o.magFilter=n(s.magFilter,Fh)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),r[s.uuid]=o}return r},parseObject:function(t,e,n){let r,i,s;function o(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function a(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),e.push(n[i])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}switch(t.type){case"Scene":r=new Sr,void 0!==t.background&&Number.isInteger(t.background)&&(r.background=new di(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?r.fog=new Va(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(r.fog=new Ha(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":r=new Ss(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(r.focus=t.focus),void 0!==t.zoom&&(r.zoom=t.zoom),void 0!==t.filmGauge&&(r.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(r.filmOffset=t.filmOffset),void 0!==t.view&&(r.view=Object.assign({},t.view));break;case"OrthographicCamera":r=new xh(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(r.zoom=t.zoom),void 0!==t.view&&(r.view=Object.assign({},t.view));break;case"AmbientLight":r=new Mh(t.color,t.intensity);break;case"DirectionalLight":r=new Sh(t.color,t.intensity);break;case"PointLight":r=new bh(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":r=new Th(t.color,t.intensity,t.width,t.height);break;case"SpotLight":r=new yh(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":r=new mh(t.color,t.groundColor,t.intensity);break;case"LightProbe":r=(new Ah).fromJSON(t);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":i=o(t.geometry),s=a(t.material),r=new os(i,s);break;case"InstancedMesh":i=o(t.geometry),s=a(t.material);const e=t.count,n=t.instanceMatrix;r=new Sl(i,s,e),r.instanceMatrix=new Si(new Float32Array(n.array),16);break;case"LOD":r=new dl;break;case"Line":r=new Bl(o(t.geometry),a(t.material),t.mode);break;case"LineLoop":r=new Pl(o(t.geometry),a(t.material));break;case"LineSegments":r=new Nl(o(t.geometry),a(t.material));break;case"PointCloud":case"Points":r=new Ul(o(t.geometry),a(t.material));break;case"Sprite":r=new cl(a(t.material));break;case"Group":r=new ka;break;default:r=new wr}if(r.uuid=t.uuid,void 0!==t.name&&(r.name=t.name),void 0!==t.matrix?(r.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(r.matrixAutoUpdate=t.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==t.position&&r.position.fromArray(t.position),void 0!==t.rotation&&r.rotation.fromArray(t.rotation),void 0!==t.quaternion&&r.quaternion.fromArray(t.quaternion),void 0!==t.scale&&r.scale.fromArray(t.scale)),void 0!==t.castShadow&&(r.castShadow=t.castShadow),void 0!==t.receiveShadow&&(r.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(r.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(r.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(r.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&r.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(r.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.frustumCulled&&(r.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(r.renderOrder=t.renderOrder),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.layers&&(r.layers.mask=t.layers),void 0!==t.children){const i=t.children;for(let t=0;t<i.length;t++)r.add(this.parseObject(i[t],e,n))}if("LOD"===t.type){void 0!==t.autoUpdate&&(r.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],i=r.getObjectByProperty("uuid",n.object);void 0!==i&&r.addLevel(i,n.distance)}}return r}});const Ih={UVMapping:it,CubeReflectionMapping:st,CubeRefractionMapping:ot,EquirectangularReflectionMapping:at,EquirectangularRefractionMapping:lt,CubeUVReflectionMapping:ct,CubeUVRefractionMapping:ut},Oh={RepeatWrapping:ht,ClampToEdgeWrapping:pt,MirroredRepeatWrapping:dt},Fh={NearestFilter:ft,NearestMipmapNearestFilter:mt,NearestMipmapLinearFilter:gt,LinearFilter:vt,LinearMipmapNearestFilter:bt,LinearMipmapLinearFilter:wt};function kh(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Ou.call(this,t),this.options={premultiplyAlpha:"none"}}function Dh(){this.type="ShapePath",this.color=new di,this.subPaths=[],this.currentPath=null}function Uh(t){this.type="Font",this.data=t}function zh(t,e,n,r,i){const s=i.glyphs[t]||i.glyphs["?"];if(!s)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+i.familyName+".");const o=new Dh;let a,l,c,u,h,p,d,f;if(s.o){const t=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let i=0,s=t.length;i<s;)switch(t[i++]){case"m":a=t[i++]*e+n,l=t[i++]*e+r,o.moveTo(a,l);break;case"l":a=t[i++]*e+n,l=t[i++]*e+r,o.lineTo(a,l);break;case"q":c=t[i++]*e+n,u=t[i++]*e+r,h=t[i++]*e+n,p=t[i++]*e+r,o.quadraticCurveTo(h,p,c,u);break;case"b":c=t[i++]*e+n,u=t[i++]*e+r,h=t[i++]*e+n,p=t[i++]*e+r,d=t[i++]*e+n,f=t[i++]*e+r,o.bezierCurveTo(h,p,d,f,c,u)}}return{offsetX:s.ha*e,path:o}}function jh(t){Ou.call(this,t)}let Gh;kh.prototype=Object.assign(Object.create(Ou.prototype),{constructor:kh,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=Nu.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;fetch(t).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,i.options)})).then((function(n){Nu.add(t,n),e&&e(n),i.manager.itemEnd(t)})).catch((function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)}}),Object.assign(Dh.prototype,{moveTo:function(t,e){return this.currentPath=new ph,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,n,r){return this.currentPath.quadraticCurveTo(t,e,n,r),this},bezierCurveTo:function(t,e,n,r,i,s){return this.currentPath.bezierCurveTo(t,e,n,r,i,s),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function n(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n],i=new dh;i.curves=r.curves,e.push(i)}return e}function r(t,e){const n=e.length;let r=!1;for(let i=n-1,s=0;s<n;i=s++){let n=e[i],o=e[s],a=o.x-n.x,l=o.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=e[s],a=-a,o=e[i],l=-l),t.y<n.y||t.y>o.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=l*(t.x-n.x)-a*(t.y-n.y);if(0===e)return!0;if(e<0)continue;r=!r}}else{if(t.y!==n.y)continue;if(o.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=o.x)return!0}}return r}const i=Ic.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===e)return n(s);let o,a,l,c=[];if(1===s.length)return a=s[0],l=new dh,l.curves=a.curves,c.push(l),c;let u=!i(s[0].getPoints());u=t?!u:u;const h=[],p=[];let d,f,m=[],_=0;p[_]=void 0,m[_]=[];for(let e=0,n=s.length;e<n;e++)a=s[e],d=a.getPoints(),o=i(d),o=t?!o:o,o?(!u&&p[_]&&_++,p[_]={s:new dh,p:d},p[_].s.curves=a.curves,u&&_++,m[_]=[]):m[_].push({h:a,p:d[0]});if(!p[0])return n(s);if(p.length>1){let t=!1;const e=[];for(let t=0,e=p.length;t<e;t++)h[t]=[];for(let n=0,i=p.length;n<i;n++){const i=m[n];for(let s=0;s<i.length;s++){const o=i[s];let a=!0;for(let i=0;i<p.length;i++)r(o.p,p[i].p)&&(n!==i&&e.push({froms:n,tos:i,hole:s}),a?(a=!1,h[i].push(o)):t=!0);a&&h[n].push(o)}}e.length>0&&(t||(m=h))}for(let t=0,e=p.length;t<e;t++){l=p[t].s,c.push(l),f=m[t];for(let t=0,e=f.length;t<e;t++)l.holes.push(f[t].h)}return c}}),Object.assign(Uh.prototype,{isFont:!0,generateShapes:function(t,e){void 0===e&&(e=100);const n=[],r=function(t,e,n){const r=Array.from?Array.from(t):String(t).split(""),i=e/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,o=[];let a=0,l=0;for(let t=0;t<r.length;t++){const e=r[t];if("\n"===e)a=0,l-=s;else{const t=zh(e,i,a,l,n);a+=t.offsetX,o.push(t.path)}}return o}(t,e,this.data);for(let t=0,e=r.length;t<e;t++)Array.prototype.push.apply(n,r[t].toShapes());return n}}),jh.prototype=Object.assign(Object.create(Ou.prototype),{constructor:jh,load:function(t,e,n,r){const i=this,s=new ku(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.load(t,(function(t){let n;try{n=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}const r=i.parse(n);e&&e(r)}),n,r)},parse:function(t){return new Uh(t)}});const Hh={getContext:function(){return void 0===Gh&&(Gh=new(window.AudioContext||window.webkitAudioContext)),Gh},setContext:function(t){Gh=t}};function Vh(t){Ou.call(this,t)}function Wh(t,e,n){Ah.call(this,void 0,n);const r=(new di).set(t),i=(new di).set(e),s=new Jn(r.r,r.g,r.b),o=new Jn(i.r,i.g,i.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}function qh(t,e){Ah.call(this,void 0,e);const n=(new di).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}Vh.prototype=Object.assign(Object.create(Ou.prototype),{constructor:Vh,load:function(t,e,n,r){const i=this,s=new ku(i.manager);s.setResponseType("arraybuffer"),s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.load(t,(function(n){try{const t=n.slice(0);Hh.getContext().decodeAudioData(t,(function(t){e(t)}))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}}),Wh.prototype=Object.assign(Object.create(Ah.prototype),{constructor:Wh,isHemisphereLightProbe:!0,copy:function(t){return Ah.prototype.copy.call(this,t),this},toJSON:function(t){return Ah.prototype.toJSON.call(this,t)}}),qh.prototype=Object.assign(Object.create(Ah.prototype),{constructor:qh,isAmbientLightProbe:!0,copy:function(t){return Ah.prototype.copy.call(this,t),this},toJSON:function(t){return Ah.prototype.toJSON.call(this,t)}});const Xh=new ir,Yh=new ir;function Jh(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ss,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ss,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Zh(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(Jh.prototype,{update:function(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const n=t.projectionMatrix.clone(),r=e.eyeSep/2,i=r*e.near/e.focus,s=e.near*Math.tan(Fn.DEG2RAD*e.fov*.5)/e.zoom;let o,a;Yh.elements[12]=-r,Xh.elements[12]=r,o=-s*e.aspect+i,a=s*e.aspect+i,n.elements[0]=2*e.near/(a-o),n.elements[8]=(a+o)/(a-o),this.cameraL.projectionMatrix.copy(n),o=-s*e.aspect-i,a=s*e.aspect-i,n.elements[0]=2*e.near/(a-o),n.elements[8]=(a+o)/(a-o),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Yh),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Xh)}}),Object.assign(Zh.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}});const Qh=new Jn,Kh=new qn,tp=new Jn,ep=new Jn;function np(){wr.call(this),this.type="AudioListener",this.context=Hh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Zh}function rp(t){wr.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._progress=0,this.filters=[]}np.prototype=Object.assign(Object.create(wr.prototype),{constructor:np,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(t){wr.prototype.updateMatrixWorld.call(this,t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Qh,Kh,tp),ep.set(0,0,-1).applyQuaternion(Kh),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Qh.x,t),e.positionY.linearRampToValueAtTime(Qh.y,t),e.positionZ.linearRampToValueAtTime(Qh.z,t),e.forwardX.linearRampToValueAtTime(ep.x,t),e.forwardY.linearRampToValueAtTime(ep.y,t),e.forwardZ.linearRampToValueAtTime(ep.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition(Qh.x,Qh.y,Qh.z),e.setOrientation(ep.x,ep.y,ep.z,n.x,n.y,n.z)}}),rp.prototype=Object.assign(Object.create(wr.prototype),{constructor:rp,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setMediaStreamSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(t){if(void 0===t&&(t=0),!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}});const ip=new Jn,sp=new qn,op=new Jn,ap=new Jn;function lp(t){rp.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function cp(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function up(t,e,n){let r,i,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":r=this._slerp,i=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}lp.prototype=Object.assign(Object.create(rp.prototype),{constructor:lp,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(t){if(wr.prototype.updateMatrixWorld.call(this,t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(ip,sp,op),ap.set(0,0,1).applyQuaternion(sp);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(ip.x,t),e.positionY.linearRampToValueAtTime(ip.y,t),e.positionZ.linearRampToValueAtTime(ip.z,t),e.orientationX.linearRampToValueAtTime(ap.x,t),e.orientationY.linearRampToValueAtTime(ap.y,t),e.orientationZ.linearRampToValueAtTime(ap.z,t)}else e.setPosition(ip.x,ip.y,ip.z),e.setOrientation(ap.x,ap.y,ap.z)}}),Object.assign(cp.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}),Object.assign(up.prototype,{accumulate:function(t,e){const n=this.buffer,r=this.valueSize,i=t*r+r;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==r;++t)n[i+t]=n[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(n,i,0,t,r)}this.cumulativeWeight=s},accumulateAdditive:function(t){const e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t},apply:function(t){const e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const t=e*this._origIndex;this._mixBufferRegion(n,r,t,1-i,e)}s>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*e,1,e);for(let t=e,i=e+e;t!==i;++t)if(n[t]!==n[t+e]){o.setValue(n,r);break}},saveOriginalState:function(){const t=this.binding,e=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(e,r);for(let t=n,i=r;t!==i;++t)e[t]=e[r+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[4*this._addIndex+3]=1},_setAdditiveIdentityOther:function(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]},_select:function(t,e,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)t[e+r]=t[n+r]},_slerp:function(t,e,n,r){qn.slerpFlat(t,e,t,e,t,n,r)},_slerpAdditive:function(t,e,n,r,i){const s=this._workIndex*i;qn.multiplyQuaternionsFlat(t,s,t,e,t,n),qn.slerpFlat(t,e,t,e,t,s,r)},_lerp:function(t,e,n,r,i){const s=1-r;for(let o=0;o!==i;++o){const i=e+o;t[i]=t[i]*s+t[n+o]*r}},_lerpAdditive:function(t,e,n,r,i){for(let s=0;s!==i;++s){const i=e+s;t[i]=t[i]+t[n+s]*r}}});const hp="\\[\\]\\.:\\/",pp=new RegExp("["+hp+"]","g"),dp="[^"+hp+"]",fp="[^"+hp.replace("\\.","")+"]",mp=/((?:WC+[\/:])*)/.source.replace("WC",dp),_p=/(WCOD+)?/.source.replace("WCOD",fp),gp=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",dp),yp=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",dp),vp=new RegExp("^"+mp+_p+gp+yp+"$"),bp=["material","materials","bones"];function xp(t,e,n){const r=n||wp.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}function wp(t,e,n){this.path=e,this.parsedPath=n||wp.parseTrackName(e),this.node=wp.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function Sp(){this.uuid=Fn.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}function Mp(t,e,n,r){this._mixer=t,this._clip=e,this._localRoot=n||null,this.blendMode=r||e.blendMode;const i=e.tracks,s=i.length,o=new Array(s),a={endingStart:je,endingEnd:je};for(let t=0;t!==s;++t){const e=i[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Fe,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Tp(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Ep(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function Ap(t,e,n){Wa.call(this,t,e),this.meshPerAttribute=n||1}function $p(t,e,n,r){this.ray=new Xr(t,e),this.near=n||0,this.far=r||1/0,this.camera=null,this.layers=new lr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Cp(t,e){return t.distance-e.distance}function Bp(t,e,n,r){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===r){const r=t.children;for(let t=0,i=r.length;t<i;t++)Bp(r[t],e,n,!0)}}Object.assign(xp.prototype,{getValue:function(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)},setValue:function(t,e){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)},bind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}),Object.assign(wp,{Composite:xp,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new wp.Composite(t,e,n):new wp(t,e,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(pp,"")},parseTrackName:function(t){const e=vp.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const t=n.nodeName.substring(r+1);-1!==bp.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let r=0;r<t.length;r++){const i=t[r];if(i.name===e||i.uuid===e)return i;const s=n(i.children);if(s)return s}return null},r=n(t.children);if(r)return r}return null}}),Object.assign(wp.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)t[e++]=n[r]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++]},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){let t=this.node,e=this.parsedPath,n=e.objectName,r=e.propertyName,i=e.propertyIndex;if(t||(t=wp.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===r){r=e;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==r){if(void 0===t[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[r]}}const s=t[r];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(wp.prototype,{_getValue_unbound:wp.prototype.getValue,_setValue_unbound:wp.prototype.setValue}),Object.assign(Sp.prototype,{isAnimationObjectGroup:!0,add:function(){const t=this._objects,e=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,s=i.length;let o,a=t.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let p=e[h];if(void 0===p){p=a++,e[h]=p,t.push(u);for(let t=0,e=s;t!==e;++t)i[t].push(new wp(u,n[t],r[t]))}else if(p<l){o=t[p];const a=--l,c=t[a];e[c.uuid]=p,t[p]=c,e[h]=a,t[a]=u;for(let t=0,e=s;t!==e;++t){const e=i[t],s=e[a];let o=e[p];e[p]=s,void 0===o&&(o=new wp(u,n[t],r[t])),e[a]=o}}else t[p]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l},remove:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s],a=o.uuid,l=e[a];if(void 0!==l&&l>=i){const s=i++,c=t[s];e[c.uuid]=l,t[l]=c,e[a]=s,t[s]=o;for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[s],i=e[l];e[l]=r,e[s]=i}}}this.nCachedObjects_=i},uncache:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,s=t.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,l=e[a];if(void 0!==l)if(delete e[a],l<i){const o=--i,a=t[o],c=--s,u=t[c];e[a.uuid]=l,t[l]=a,e[u.uuid]=o,t[o]=u,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[o],i=e[c];e[l]=r,e[o]=i,e.pop()}}else{const i=--s,o=t[i];e[o.uuid]=l,t[l]=o,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t];e[l]=e[i],e.pop()}}}this.nCachedObjects_=i},subscribe_:function(t,e){let n=this._bindingsIndicesByPath,r=n[t],i=this._bindings;if(void 0!==r)return i[r];const s=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[t]=r,s.push(t),o.push(e),i.push(u);for(let n=c,r=a.length;n!==r;++n){const r=a[n];u[n]=new wp(r,t,e)}return u},unsubscribe_:function(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const r=this._paths,i=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o];e[t[o]]=n,s[n]=a,s.pop(),i[n]=i[o],i.pop(),r[n]=r[o],r.pop()}}}),Object.assign(Mp.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,r=t._clip.duration,i=r/n,s=n/r;t.warp(1,i,e),this.warp(s,1,e)}return this},crossFadeTo:function(t,e,n){return t.crossFadeFrom(this,e,n)},stopFading:function(){let t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,n){const r=this._mixer,i=r.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=i,a[1]=i+n,l[0]=t/s,l[1]=e/s,this},stopWarping:function(){let t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,n,r){if(!this.enabled)return void this._updateWeight(t);const i=this._startTime;if(null!==i){const r=(t-i)*n;if(r<0||0===n)return;this._startTime=null,e=n*r}e*=this._updateTimeScale(t);const s=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===We)for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(s),e[n].accumulateAdditive(o);else for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(s),e[n].accumulate(r,o)}},_updateWeight:function(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e},_updateTime:function(t){const e=this._clip.duration,n=this.loop;let r=this.time+t,i=this._loopCount;const s=n===ke;if(0===t)return-1===i?r:s&&1==(1&i)?e-r:r;if(n===Oe){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),r>=e||r<0){const n=Math.floor(r/e);r-=e*n,i+=Math.abs(n);const o=this.repetitions-i;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(s&&1==(1&i))return e-r}return r},_setEndings:function(t,e,n){const r=this._interpolantSettings;n?(r.endingStart=Ge,r.endingEnd=Ge):(r.endingStart=t?this.zeroSlopeAtStart?Ge:je:He,r.endingEnd=e?this.zeroSlopeAtEnd?Ge:je:He)},_scheduleFading:function(t,e,n){const r=this._mixer,i=r.time;let s=this._weightInterpolant;null===s&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=i,a[0]=e,o[1]=i+t,a[1]=n,this}}),Tp.prototype=Object.assign(Object.create(Pn.prototype),{constructor:Tp,_bindAction:function(t,e){const n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,s=t._propertyBindings,o=t._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let t=0;t!==i;++t){const i=r[t],l=i.name;let u=c[l];if(void 0!==u)s[t]=u;else{if(u=s[t],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,l));continue}const r=e&&e._propertyBindings[t].binding.parsedPath;u=new up(wp.create(n,l,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,l),s[t]=u}o[t].resultBuffer=u.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,n){const r=this._actions,i=this._actionsByClip;let s=i[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=r.length,r.push(t),s.actionByRoot[n]=t},_removeInactiveAction:function(t){const e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;const i=t._clip.uuid,s=this._actionsByClip,o=s[i],a=o.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(t){const e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackAction:function(t){const e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_addInactiveBinding:function(t,e,n){const r=this._bindingsByRootAndName,i=this._bindings;let s=r[e];void 0===s&&(s={},r[e]=s),s[n]=t,t._cacheIndex=i.length,i.push(t)},_removeInactiveBinding:function(t){const e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,s=this._bindingsByRootAndName,o=s[r],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[i],0===Object.keys(o).length&&delete s[r]},_lendBinding:function(t){const e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackBinding:function(t){const e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_lendControlInterpolant:function(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new xu(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){const e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,n){const r=e||this._root,i=r.uuid;let s="string"==typeof t?Lu.findByName(r,t):t;const o=null!==s?s.uuid:t;let a=this._actionsByClip[o],l=null;if(void 0===n&&(n=null!==s?s.blendMode:Ve),void 0!==a){const t=a.actionByRoot[i];if(void 0!==t&&t.blendMode===n)return t;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new Mp(this,s,e,n);return this._bindAction(c,l),this._addInactiveAction(c,o,i),c},existingAction:function(t,e){const n=e||this._root,r=n.uuid,i="string"==typeof t?Lu.findByName(n,t):t,s=i?i.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[r]||null},stopAllAction:function(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this},update:function(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),s=this._accuIndex^=1;for(let o=0;o!==n;++o)e[o]._update(r,t,i,s);const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(s);return this},setTime:function(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){const e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const t=i.knownActions;for(let n=0,r=t.length;n!==r;++n){const r=t[n];this._deactivateAction(r);const i=r._cacheIndex,s=e[e.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,s._cacheIndex=i,e[i]=s,e.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}},uncacheRoot:function(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const r=n[t].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[e];if(void 0!==r)for(const t in r){const e=r[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}},uncacheAction:function(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),Ep.prototype.clone=function(){return new Ep(void 0===this.value.clone?this.value:this.value.clone())},Ap.prototype=Object.assign(Object.create(Wa.prototype),{constructor:Ap,isInstancedInterleavedBuffer:!0,copy:function(t){return Wa.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},clone:function(t){const e=Wa.prototype.clone.call(this,t);return e.meshPerAttribute=this.meshPerAttribute,e},toJSON:function(t){const e=Wa.prototype.toJSON.call(this,t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}),Object.assign($p.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,n){const r=n||[];return Bp(t,this,r,e),r.sort(Cp),r},intersectObjects:function(t,e,n){const r=n||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(let n=0,i=t.length;n<i;n++)Bp(t[n],this,r,e);return r.sort(Cp),r}});class Lp{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Fn.clamp(e/this.radius,-1,1))),this}}function Rp(t,e,n){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==n?n:0,this}Object.assign(Rp.prototype,{set:function(t,e,n){return this.radius=t,this.theta=e,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}});const Np=new kn;function Pp(t,e){this.min=void 0!==t?t:new kn(1/0,1/0),this.max=void 0!==e?e:new kn(-1/0,-1/0)}Object.assign(Pp.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){const n=Np.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new kn),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new kn),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new kn),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new kn),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return Np.copy(t).clamp(this.min,this.max).sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});const Ip=new Jn,Op=new Jn;function Fp(t,e){this.start=void 0!==t?t:new Jn,this.end=void 0!==e?e:new Jn}function kp(t){wr.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}Object.assign(Fp.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Jn),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Jn),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Jn),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,e){Ip.subVectors(t,this.start),Op.subVectors(this.end,this.start);const n=Op.dot(Op);let r=Op.dot(Ip)/n;return e&&(r=Fn.clamp(r,0,1)),r},closestPointToPoint:function(t,e,n){const r=this.closestPointToPointParameter(t,e);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Jn),this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),kp.prototype=Object.create(wr.prototype),kp.prototype.constructor=kp,kp.prototype.isImmediateRenderObject=!0;const Dp=new Jn;function Up(t,e){wr.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const n=new ji,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,n=32;t<n;t++,e++){const i=t/n*Math.PI*2,s=e/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new Li(r,3));const i=new Ml({fog:!1,toneMapped:!1});this.cone=new Nl(n,i),this.add(this.cone),this.update()}Up.prototype=Object.create(wr.prototype),Up.prototype.constructor=Up,Up.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Up.prototype.update=function(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Dp.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Dp),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};const zp=new Jn,jp=new ir,Gp=new ir;function Hp(t){const e=[];t&&t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,Hp(t.children[n]));return e}function Vp(t){const e=Hp(t),n=new ji,r=[],i=[],s=new di(0,0,1),o=new di(0,1,0);for(let t=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(s.r,s.g,s.b),i.push(o.r,o.g,o.b))}n.setAttribute("position",new Li(r,3)),n.setAttribute("color",new Li(i,3));const a=new Ml({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});Nl.call(this,n,a),this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function Wp(t,e,n){this.light=t,this.light.updateMatrixWorld(),this.color=n;const r=new Vc(e,4,2),i=new bi({wireframe:!0,fog:!1,toneMapped:!1});os.call(this,r,i),this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}Vp.prototype=Object.create(Nl.prototype),Vp.prototype.constructor=Vp,Vp.prototype.isSkeletonHelper=!0,Vp.prototype.updateMatrixWorld=function(t){const e=this.bones,n=this.geometry,r=n.getAttribute("position");Gp.getInverse(this.root.matrixWorld);for(let t=0,n=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(jp.multiplyMatrices(Gp,i.matrixWorld),zp.setFromMatrixPosition(jp),r.setXYZ(n,zp.x,zp.y,zp.z),jp.multiplyMatrices(Gp,i.parent.matrixWorld),zp.setFromMatrixPosition(jp),r.setXYZ(n+1,zp.x,zp.y,zp.z),n+=2)}n.getAttribute("position").needsUpdate=!0,wr.prototype.updateMatrixWorld.call(this,t)},Wp.prototype=Object.create(os.prototype),Wp.prototype.constructor=Wp,Wp.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Wp.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};const qp=new Jn,Xp=new di,Yp=new di;function Jp(t,e,n){wr.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const r=new tc(e);r.rotateY(.5*Math.PI),this.material=new bi({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),s=new Float32Array(3*i.count);r.setAttribute("color",new Si(s,3)),this.add(new os(r,this.material)),this.update()}function Zp(t,e,n,r){t=t||10,e=e||10,n=new di(void 0!==n?n:4473924),r=new di(void 0!==r?r:8947848);const i=e/2,s=t/e,o=t/2,a=[],l=[];for(let t=0,c=0,u=-o;t<=e;t++,u+=s){a.push(-o,0,u,o,0,u),a.push(u,0,-o,u,0,o);const e=t===i?n:r;e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3}const c=new ji;c.setAttribute("position",new Li(a,3)),c.setAttribute("color",new Li(l,3));const u=new Ml({vertexColors:!0,toneMapped:!1});Nl.call(this,c,u),this.type="GridHelper"}function Qp(t,e,n,r,i,s){t=t||10,e=e||16,n=n||8,r=r||64,i=new di(void 0!==i?i:4473924),s=new di(void 0!==s?s:8947848);const o=[],a=[];for(let n=0;n<=e;n++){const r=n/e*(2*Math.PI),l=Math.sin(r)*t,c=Math.cos(r)*t;o.push(0,0,0),o.push(l,0,c);const u=1&n?i:s;a.push(u.r,u.g,u.b),a.push(u.r,u.g,u.b)}for(let e=0;e<=n;e++){const l=1&e?i:s,c=t-t/n*e;for(let t=0;t<r;t++){let e=t/r*(2*Math.PI),n=Math.sin(e)*c,i=Math.cos(e)*c;o.push(n,0,i),a.push(l.r,l.g,l.b),e=(t+1)/r*(2*Math.PI),n=Math.sin(e)*c,i=Math.cos(e)*c,o.push(n,0,i),a.push(l.r,l.g,l.b)}}const l=new ji;l.setAttribute("position",new Li(o,3)),l.setAttribute("color",new Li(a,3));const c=new Ml({vertexColors:!0,toneMapped:!1});Nl.call(this,l,c),this.type="PolarGridHelper"}Jp.prototype=Object.create(wr.prototype),Jp.prototype.constructor=Jp,Jp.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Jp.prototype.update=function(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");Xp.copy(this.light.color),Yp.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const r=t<n/2?Xp:Yp;e.setXYZ(t,r.r,r.g,r.b)}e.needsUpdate=!0}t.lookAt(qp.setFromMatrixPosition(this.light.matrixWorld).negate())},Zp.prototype=Object.create(Nl.prototype),Zp.prototype.constructor=Zp,Qp.prototype=Object.create(Nl.prototype),Qp.prototype.constructor=Qp;const Kp=new Jn,td=new Jn,ed=new Jn;function nd(t,e,n){wr.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);let r=new ji;r.setAttribute("position",new Li([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const i=new Ml({fog:!1,toneMapped:!1});this.lightPlane=new Bl(r,i),this.add(this.lightPlane),r=new ji,r.setAttribute("position",new Li([0,0,0,0,0,1],3)),this.targetLine=new Bl(r,i),this.add(this.targetLine),this.update()}nd.prototype=Object.create(wr.prototype),nd.prototype.constructor=nd,nd.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},nd.prototype.update=function(){Kp.setFromMatrixPosition(this.light.matrixWorld),td.setFromMatrixPosition(this.light.target.matrixWorld),ed.subVectors(td,Kp),this.lightPlane.lookAt(td),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(td),this.targetLine.scale.z=ed.length()};const rd=new Jn,id=new ws;function sd(t){const e=new ji,n=new Ml({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],s={},o=new di(16755200),a=new di(16711680),l=new di(43775),c=new di(16777215),u=new di(3355443);function h(t,e,n){p(t,n),p(e,n)}function p(t,e){r.push(0,0,0),i.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(r.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),e.setAttribute("position",new Li(r,3)),e.setAttribute("color",new Li(i,3)),Nl.call(this,e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}function od(t,e,n,r,i,s,o){rd.set(i,s,o).unproject(r);const a=e[t];if(void 0!==a){const t=n.getAttribute("position");for(let e=0,n=a.length;e<n;e++)t.setXYZ(a[e],rd.x,rd.y,rd.z)}}sd.prototype=Object.create(Nl.prototype),sd.prototype.constructor=sd,sd.prototype.update=function(){const t=this.geometry,e=this.pointMap;id.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),od("c",e,t,id,0,0,-1),od("t",e,t,id,0,0,1),od("n1",e,t,id,-1,-1,-1),od("n2",e,t,id,1,-1,-1),od("n3",e,t,id,-1,1,-1),od("n4",e,t,id,1,1,-1),od("f1",e,t,id,-1,-1,1),od("f2",e,t,id,1,-1,1),od("f3",e,t,id,-1,1,1),od("f4",e,t,id,1,1,1),od("u1",e,t,id,.7,1.1,-1),od("u2",e,t,id,-.7,1.1,-1),od("u3",e,t,id,0,2,-1),od("cf1",e,t,id,-1,0,1),od("cf2",e,t,id,1,0,1),od("cf3",e,t,id,0,-1,1),od("cf4",e,t,id,0,1,1),od("cn1",e,t,id,-1,0,-1),od("cn2",e,t,id,1,0,-1),od("cn3",e,t,id,0,-1,-1),od("cn4",e,t,id,0,1,-1),t.getAttribute("position").needsUpdate=!0};const ad=new Fr;function ld(t,e){this.object=t,void 0===e&&(e=16776960);const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new ji;i.setIndex(new Si(n,1)),i.setAttribute("position",new Si(r,3)),Nl.call(this,i,new Ml({color:e,toneMapped:!1})),this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}function cd(t,e){this.type="Box3Helper",this.box=t,void 0===e&&(e=16776960);const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new ji;r.setIndex(new Si(n,1)),r.setAttribute("position",new Li([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Nl.call(this,r,new Ml({color:e,toneMapped:!1})),this.type="Box3Helper",this.geometry.computeBoundingSphere()}function ud(t,e,n){this.plane=t,this.size=void 0===e?1:e;const r=void 0!==n?n:16776960,i=new ji;i.setAttribute("position",new Li([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),Bl.call(this,i,new Ml({color:r,toneMapped:!1})),this.type="PlaneHelper";const s=new ji;s.setAttribute("position",new Li([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),this.add(new os(s,new bi({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}ld.prototype=Object.create(Nl.prototype),ld.prototype.constructor=ld,ld.prototype.update=function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&ad.setFromObject(this.object),ad.isEmpty())return;const e=ad.min,n=ad.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=e.x,i[4]=n.y,i[5]=n.z,i[6]=e.x,i[7]=e.y,i[8]=n.z,i[9]=n.x,i[10]=e.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=e.z,i[15]=e.x,i[16]=n.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=n.x,i[22]=e.y,i[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()},ld.prototype.setFromObject=function(t){return this.object=t,this.update(),this},ld.prototype.copy=function(t){return Nl.prototype.copy.call(this,t),this.object=t.object,this},cd.prototype=Object.create(Nl.prototype),cd.prototype.constructor=cd,cd.prototype.updateMatrixWorld=function(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),wr.prototype.updateMatrixWorld.call(this,t))},ud.prototype=Object.create(Bl.prototype),ud.prototype.constructor=ud,ud.prototype.updateMatrixWorld=function(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?m:f,this.lookAt(this.plane.normal),wr.prototype.updateMatrixWorld.call(this,t)};const hd=new Jn;let pd,dd;function fd(t,e,n,r,i,s){wr.call(this),this.type="ArrowHelper",void 0===t&&(t=new Jn(0,0,1)),void 0===e&&(e=new Jn(0,0,0)),void 0===n&&(n=1),void 0===r&&(r=16776960),void 0===i&&(i=.2*n),void 0===s&&(s=.2*i),void 0===pd&&(pd=new ji,pd.setAttribute("position",new Li([0,0,0,0,1,0],3)),dd=new eu(0,.5,1,5,1),dd.translate(0,-.5,0)),this.position.copy(e),this.line=new Bl(pd,new Ml({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new os(dd,new bi({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,i,s)}function md(t){const e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new ji;n.setAttribute("position",new Li(e,3)),n.setAttribute("color",new Li([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));const r=new Ml({vertexColors:!0,toneMapped:!1});Nl.call(this,n,r),this.type="AxesHelper"}fd.prototype=Object.create(wr.prototype),fd.prototype.constructor=fd,fd.prototype.setDirection=function(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{hd.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(hd,e)}},fd.prototype.setLength=function(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()},fd.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},fd.prototype.copy=function(t){return wr.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},md.prototype=Object.create(Nl.prototype),md.prototype.constructor=md;const _d=Math.pow(2,8),gd=[.125,.215,.35,.446,.526,.582],yd=5+gd.length,vd=20,bd={[Je]:0,[Ze]:1,[Ke]:2,[en]:3,[nn]:4,[rn]:5,[Qe]:6},xd=new xh,{_lodPlanes:wd,_sizeLods:Sd,_sigmas:Md}=function(){const t=[],e=[],n=[];let r=8;for(let i=0;i<yd;i++){const s=Math.pow(2,r);e.push(s);let o=1/s;i>4?o=gd[i-8+4-1]:0==i&&(o=0),n.push(o);const a=1/(s-1),l=-a/2,c=1+a/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,p=6,d=3,f=2,m=1,_=new Float32Array(d*p*h),g=new Float32Array(f*p*h),y=new Float32Array(m*p*h);for(let t=0;t<h;t++){const e=t%3*2/3-1,n=t>2?0:-1,r=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];_.set(r,d*p*t),g.set(u,f*p*t);const i=[t,t,t,t,t,t];y.set(i,m*p*t)}const v=new ji;v.setAttribute("position",new Si(_,d)),v.setAttribute("uv",new Si(g,f)),v.setAttribute("faceIndex",new Si(y,m)),t.push(v),r>4&&r--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}();let Td=null;const Ed=(1+Math.sqrt(5))/2,Ad=1/Ed,$d=[new Jn(1,1,1),new Jn(-1,1,1),new Jn(1,1,-1),new Jn(-1,1,-1),new Jn(0,Ed,Ad),new Jn(0,Ed,-Ad),new Jn(Ad,0,Ed),new Jn(-Ad,0,Ed),new Jn(Ed,Ad,0),new Jn(-Ed,Ad,0)];function Cd(t){var e;this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=new lu({name:"SphericalGaussianBlur",defines:{n:e=vd},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(e)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new Jn(0,1,0)},inputEncoding:{value:bd[Je]},outputEncoding:{value:bd[Je]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:v,depthTest:!1,depthWrite:!1}),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}function Bd(t){return void 0!==t&&t.type===Mt&&(t.encoding===Je||t.encoding===Ze||t.encoding===Qe)}function Ld(t){const e=new Vn(3*_d,3*_d,t);return e.texture.mapping=ct,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Rd(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function Nd(){return new lu({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new kn(1,1)},inputEncoding:{value:bd[Je]},outputEncoding:{value:bd[Je]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:v,depthTest:!1,depthWrite:!1})}function Pd(){return new lu({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:bd[Je]},outputEncoding:{value:bd[Je]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:v,depthTest:!1,depthWrite:!1})}function Id(t,e,n,r,i,s,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new gi(t,e,n,i,s,o)}Cd.prototype={constructor:Cd,fromScene:function(t,e=0,n=.1,r=100){Td=this._renderer.getRenderTarget();const i=this._allocateTargets();return this._sceneToCubeUV(t,n,r,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i},fromEquirectangular:function(t){return this._fromTexture(t)},fromCubemap:function(t){return this._fromTexture(t)},compileCubemapShader:function(){null===this._cubemapShader&&(this._cubemapShader=Pd(),this._compileMaterial(this._cubemapShader))},compileEquirectangularShader:function(){null===this._equirectShader&&(this._equirectShader=Nd(),this._compileMaterial(this._equirectShader))},dispose:function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<wd.length;t++)wd[t].dispose()},_cleanup:function(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Td),t.scissorTest=!1,Rd(t,0,0,t.width,t.height)},_fromTexture:function(t){Td=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e},_allocateTargets:function(t){const e={magFilter:ft,minFilter:ft,generateMipmaps:!1,type:Mt,format:zt,encoding:Bd(t)?t.encoding:Ke,depthBuffer:!1,stencilBuffer:!1},n=Ld(e);return n.depthBuffer=!t,this._pingPongRenderTarget=Ld(e),n},_compileMaterial:function(t){const e=new os(wd[0],t);this._renderer.compile(e,xd)},_sceneToCubeUV:function(t,e,n,r){const i=new Ss(90,1,e,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.outputEncoding,c=a.toneMapping,u=a.getClearColor(),h=a.getClearAlpha();a.toneMapping=Q,a.outputEncoding=Je;let p=t.background;if(p&&p.isColor){p.convertSRGBToLinear();const e=Math.max(p.r,p.g,p.b),n=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);p=p.multiplyScalar(Math.pow(2,-n));const r=(n+128)/255;a.setClearColor(p,r),t.background=null}for(let e=0;e<6;e++){const n=e%3;0==n?(i.up.set(0,s[e],0),i.lookAt(o[e],0,0)):1==n?(i.up.set(0,0,s[e]),i.lookAt(0,o[e],0)):(i.up.set(0,s[e],0),i.lookAt(0,0,o[e])),Rd(r,n*_d,e>2?_d:0,_d,_d),a.setRenderTarget(r),a.render(t,i)}a.toneMapping=c,a.outputEncoding=l,a.setClearColor(u,h)},_textureToCubeUV:function(t,e){const n=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=Pd()):null==this._equirectShader&&(this._equirectShader=Nd());const r=t.isCubeTexture?this._cubemapShader:this._equirectShader,i=new os(wd[0],r),s=r.uniforms;s.envMap.value=t,t.isCubeTexture||s.texelSize.value.set(1/t.image.width,1/t.image.height),s.inputEncoding.value=bd[t.encoding],s.outputEncoding.value=bd[e.texture.encoding],Rd(e,0,0,3*_d,2*_d),n.setRenderTarget(e),n.render(i,xd)},_applyPMREM:function(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let e=1;e<yd;e++){const n=Math.sqrt(Md[e]*Md[e]-Md[e-1]*Md[e-1]),r=$d[(e-1)%$d.length];this._blur(t,e-1,e,n,r)}e.autoClear=n},_blur:function(t,e,n,r,i){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,r,"latitudinal",i),this._halfBlur(s,t,n,n,r,"longitudinal",i)},_halfBlur:function(t,e,n,r,i,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new os(wd[r],l),u=l.uniforms,h=Sd[n]-1,p=isFinite(i)?Math.PI/(2*h):2*Math.PI/(2*vd-1),d=i/p,f=isFinite(i)?1+Math.floor(3*d):vd;f>vd&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to ${vd}`);const m=[];let _=0;for(let t=0;t<vd;++t){const e=t/d,n=Math.exp(-e*e/2);m.push(n),0==t?_+=n:t<f&&(_+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/_;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===s,o&&(u.poleAxis.value=o),u.dTheta.value=p,u.mipInt.value=8-n,u.inputEncoding.value=bd[t.texture.encoding],u.outputEncoding.value=bd[t.texture.encoding];const g=Sd[r];Rd(e,3*Math.max(0,_d-2*g),(0===r?0:2*_d)+2*g*(r>4?r-8+4:0),3*g,2*g),a.setRenderTarget(e),a.render(c,xd)}};const Od=0,Fd=1,kd=0,Dd=1,Ud=2;function zd(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function jd(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function Gd(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Ul(t,e)}function Hd(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new cl(t)}function Vd(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Ul(t,e)}function Wd(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Il(t)}function qd(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Il(t)}function Xd(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Il(t)}function Yd(t,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Jn(t,e,n)}function Jd(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Si(t,e).setUsage(En)}function Zd(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Mi(t,e)}function Qd(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Ti(t,e)}function Kd(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Ei(t,e)}function tf(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Ai(t,e)}function ef(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new $i(t,e)}function nf(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Ci(t,e)}function rf(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Bi(t,e)}function sf(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Li(t,e)}function of(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Ri(t,e)}function af(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Ku.call(this,t),this.type="catmullrom",this.closed=!0}function lf(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Ku.call(this,t),this.type="catmullrom"}function cf(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Ku.call(this,t),this.type="catmullrom"}function uf(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new md(t)}function hf(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new ld(t,e)}function pf(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Nl(new Kc(t.geometry),new Ml({color:void 0!==e?e:16777215}))}function df(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Nl(new Wl(t.geometry),new Ml({color:void 0!==e?e:16777215}))}function ff(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new ku(t)}function mf(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new zu(t)}function _f(t,e,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new As(t,n)}Vu.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Vu.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(hh.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=new ds;for(let n=0,r=t.length;n<r;n++){const r=t[n];e.vertices.push(new Jn(r.x,r.y,r.z||0))}return e}}),Object.assign(ph.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),af.prototype=Object.create(Ku.prototype),lf.prototype=Object.create(Ku.prototype),cf.prototype=Object.create(Ku.prototype),Object.assign(cf.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Zp.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Vp.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Ou.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Ch.extractUrlBase(t)}}),Ou.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Ph.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}),Object.assign(Pp.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Fr.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Ur.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Ls.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Fp.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(Fn,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Fn.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Fn.ceilPowerOfTwo(t)}}),Object.assign(Dn.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(ir.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Jn).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,n,r,i,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,r,n,i,s)}}),Qr.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},qn.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(Xr.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(ci.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(ci,{barycoordFromPoint:function(t,e,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),ci.getBarycoord(t,e,n,r,i)},normal:function(t,e,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),ci.getNormal(t,e,n,r)}}),Object.assign(dh.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new kc(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Jc(this,t)}}),Object.assign(kn.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Jn.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Hn.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(ds.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(wr.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(wr.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(os.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(os.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),qe},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(dl.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(gl.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),fl.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Vu.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),Ss.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(fh.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(Si.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===En},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(En)}}}),Object.assign(Si.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?En:Tn),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(ji.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new Si(arguments[1],arguments[2])))},addDrawCall:function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(ji.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Bh.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties($p.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(Wa.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===En},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(Wa.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?En:Tn),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Dc.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Ep.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(vi.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new di}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===g}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(hu.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(uu.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(t){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=t}}}),Object.defineProperties(xs.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(ja.prototype,{clearTarget:function(t,e,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,r)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(ja.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?Ze:Je}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Na.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Vn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(rp.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new Vh).load(t,(function(t){e.setBuffer(t)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),cp.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Es.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};const gf={merge:function(t,e,n){let r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),r=e.matrix,e=e.geometry),t.merge(e,r,n)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};function yf(){console.error("THREE.CanvasRenderer has been removed")}function vf(){console.error("THREE.JSONLoader has been removed.")}zn.crossOrigin=void 0,zn.loadTexture=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new Hu;i.setCrossOrigin(this.crossOrigin);const s=i.load(t,n,void 0,r);return e&&(s.mapping=e),s},zn.loadTextureCube=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new Gu;i.setCrossOrigin(this.crossOrigin);const s=i.load(t,n,void 0,r);return e&&(s.mapping=e),s},zn.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},zn.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const bf={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function xf(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:r}}))},759:(t,e,n)=>{"use strict";n.d(e,{U:()=>r}),t=n.hmd(t),function(e){"object"==typeof exports?t.exports=e():"function"==typeof define&&n.amdO?define([],e):("undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:this).opentype=e()}((function(){return function t(e,n,r){function i(o,a){if(!n[o]){if(!e[o]){if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};e[o][0].call(c.exports,(function(t){return i(e[o][1][t]||t)}),c,c.exports,t,e,n,r)}return n[o].exports}for(var s=void 0,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(t,e,n){function r(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function i(t,e){this.source=t,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=e,this.destLen=0,this.ltree=new r,this.dtree=new r}function s(t,e,n,r){var i,s;for(i=0;n>i;++i)t[i]=0;for(i=0;30-n>i;++i)t[i+n]=i/n|0;for(s=r,i=0;30>i;++i)e[i]=s,s+=1<<t[i]}function o(t,e,n,r){var i,s;for(i=0;16>i;++i)t.table[i]=0;for(i=0;r>i;++i)t.table[e[n+i]]++;for(t.table[0]=0,s=0,i=0;16>i;++i)M[i]=s,s+=t.table[i];for(i=0;r>i;++i)e[n+i]&&(t.trans[M[e[n+i]]++]=i)}function a(t){t.bitcount--||(t.tag=t.source[t.sourceIndex++],t.bitcount=7);var e=1&t.tag;return t.tag>>>=1,e}function l(t,e,n){if(!e)return n;for(;t.bitcount<24;)t.tag|=t.source[t.sourceIndex++]<<t.bitcount,t.bitcount+=8;var r=t.tag&65535>>>16-e;return t.tag>>>=e,t.bitcount-=e,r+n}function c(t,e){for(;t.bitcount<24;)t.tag|=t.source[t.sourceIndex++]<<t.bitcount,t.bitcount+=8;var n=0,r=0,i=0,s=t.tag;do{r=2*r+(1&s),s>>>=1,++i,n+=e.table[i],r-=e.table[i]}while(r>=0);return t.tag=s,t.bitcount-=i,e.trans[n+r]}function u(t,e,n){var r,i,s,a,u,h;for(r=l(t,5,257),i=l(t,5,1),s=l(t,4,4),a=0;19>a;++a)S[a]=0;for(a=0;s>a;++a){var p=l(t,3,0);S[x[a]]=p}for(o(w,S,0,19),u=0;r+i>u;){var d=c(t,w);switch(d){case 16:var f=S[u-1];for(h=l(t,2,3);h;--h)S[u++]=f;break;case 17:for(h=l(t,3,3);h;--h)S[u++]=0;break;case 18:for(h=l(t,7,11);h;--h)S[u++]=0;break;default:S[u++]=d}}o(e,S,0,r),o(n,S,r,i)}function h(t,e,n){for(;;){var r,i,s,o,a=c(t,e);if(256===a)return d;if(256>a)t.dest[t.destLen++]=a;else for(r=l(t,g[a-=257],y[a]),i=c(t,n),o=s=t.destLen-l(t,v[i],b[i]);s+r>o;++o)t.dest[t.destLen++]=t.dest[o]}}function p(t){for(var e,n;t.bitcount>8;)t.sourceIndex--,t.bitcount-=8;if((e=256*(e=t.source[t.sourceIndex+1])+t.source[t.sourceIndex])!==(65535&~(256*t.source[t.sourceIndex+3]+t.source[t.sourceIndex+2])))return f;for(t.sourceIndex+=4,n=e;n;--n)t.dest[t.destLen++]=t.source[t.sourceIndex++];return t.bitcount=0,d}var d=0,f=-3,m=new r,_=new r,g=new Uint8Array(30),y=new Uint16Array(30),v=new Uint8Array(30),b=new Uint16Array(30),x=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),w=new r,S=new Uint8Array(320),M=new Uint16Array(16);(function(t,e){var n;for(n=0;7>n;++n)t.table[n]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,n=0;24>n;++n)t.trans[n]=256+n;for(n=0;144>n;++n)t.trans[24+n]=n;for(n=0;8>n;++n)t.trans[168+n]=280+n;for(n=0;112>n;++n)t.trans[176+n]=144+n;for(n=0;5>n;++n)e.table[n]=0;for(e.table[5]=32,n=0;32>n;++n)e.trans[n]=n})(m,_),s(g,y,4,3),s(v,b,2,1),g[28]=0,y[28]=258,e.exports=function(t,e){var n,r,s=new i(t,e);do{switch(n=a(s),l(s,2,0)){case 0:r=p(s);break;case 1:r=h(s,m,_);break;case 2:u(s,s.ltree,s.dtree),r=h(s,s.ltree,s.dtree);break;default:r=f}if(r!==d)throw new Error("Data error")}while(!n);return s.destLen<s.dest.length?"function"==typeof s.dest.slice?s.dest.slice(0,s.destLen):s.dest.subarray(0,s.destLen):s.dest}},{}],2:[function(t,e,n){n.fail=function(t){throw new Error(t)},n.argument=function(t,e){t||n.fail(e)},n.assert=n.argument},{}],3:[function(t,e,n){n.line=function(t,e,n,r,i){t.beginPath(),t.moveTo(e,n),t.lineTo(r,i),t.stroke()}},{}],4:[function(t,e,n){function r(t){this.font=t}function i(t){this.cmap=t}function s(t,e){this.encoding=t,this.charset=e}function o(t){var e;switch(t.version){case 1:this.names=n.standardNames.slice();break;case 2:for(this.names=new Array(t.numberOfGlyphs),e=0;e<t.numberOfGlyphs;e++)this.names[e]=t.glyphNameIndex[e]<n.standardNames.length?n.standardNames[t.glyphNameIndex[e]]:t.names[t.glyphNameIndex[e]-n.standardNames.length];break;case 2.5:for(this.names=new Array(t.numberOfGlyphs),e=0;e<t.numberOfGlyphs;e++)this.names[e]=n.standardNames[e+t.glyphNameIndex[e]];break;case 3:this.names=[]}}r.prototype.charToGlyphIndex=function(t){var e=t.charCodeAt(0),n=this.font.glyphs;if(!n)return null;for(var r=0;r<n.length;r+=1)for(var i=n.get(r),s=0;s<i.unicodes.length;s+=1)if(i.unicodes[s]===e)return r},i.prototype.charToGlyphIndex=function(t){return this.cmap.glyphIndexMap[t.charCodeAt(0)]||0},s.prototype.charToGlyphIndex=function(t){var e=t.charCodeAt(0),n=this.encoding[e];return this.charset.indexOf(n)},o.prototype.nameToGlyphIndex=function(t){return this.names.indexOf(t)},o.prototype.glyphIndexToName=function(t){return this.names[t]},n.cffStandardStrings=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],n.cffStandardEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],n.cffExpertEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],n.standardNames=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"],n.DefaultEncoding=r,n.CmapEncoding=i,n.CffEncoding=s,n.GlyphNames=o,n.addGlyphNames=function(t){for(var e,n=t.tables.cmap.glyphIndexMap,r=Object.keys(n),i=0;i<r.length;i+=1){var s=r[i],o=n[s];(e=t.glyphs.get(o)).addUnicode(parseInt(s))}for(i=0;i<t.glyphs.length;i+=1)e=t.glyphs.get(i),t.cffEncoding?e.name=t.cffEncoding.charset[i]:t.glyphNames.names&&(e.name=t.glyphNames.glyphIndexToName(i))}},{}],5:[function(t,e,n){function r(t){(t=t||{}).empty||(c.checkArgument(t.familyName,"When creating a new Font object, familyName is required."),c.checkArgument(t.styleName,"When creating a new Font object, styleName is required."),c.checkArgument(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),c.checkArgument(t.ascender,"When creating a new Font object, ascender is required."),c.checkArgument(t.descender,"When creating a new Font object, descender is required."),c.checkArgument(t.descender<0,"Descender should be negative (e.g. -512)."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||t.familyName+t.styleName},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables={os2:{usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR}}),this.supported=!0,this.glyphs=new a.GlyphSet(this,t.glyphs||[]),this.encoding=new o.DefaultEncoding(this),this.substitution=new l(this),this.tables=this.tables||{}}var i=t("./path"),s=t("./tables/sfnt"),o=t("./encoding"),a=t("./glyphset"),l=t("./substitution"),c=t("./util");r.prototype.hasChar=function(t){return null!==this.encoding.charToGlyphIndex(t)},r.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)},r.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),n=this.glyphs.get(e);return n||(n=this.glyphs.get(0)),n},r.prototype.stringToGlyphs=function(t){for(var e=[],n=0;n<t.length;n+=1){var r=t[n];e.push(this.charToGlyph(r))}return e},r.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)},r.prototype.nameToGlyph=function(t){var e=this.nametoGlyphIndex(t),n=this.glyphs.get(e);return n||(n=this.glyphs.get(0)),n},r.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""},r.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var n=this.getGposKerningValue;return n?n(t,e):this.kerningPairs[t+","+e]||0},r.prototype.forEachGlyph=function(t,e,n,r,i,s){e=void 0!==e?e:0,n=void 0!==n?n:0,r=void 0!==r?r:72;for(var o=void 0===(i=i||{}).kerning||i.kerning,a=1/this.unitsPerEm*r,l=this.stringToGlyphs(t),c=0;c<l.length;c+=1){var u=l[c];s(u,e,n,r,i),u.advanceWidth&&(e+=u.advanceWidth*a),o&&c<l.length-1&&(e+=this.getKerningValue(u,l[c+1])*a)}},r.prototype.getPath=function(t,e,n,r,s){var o=new i.Path;return this.forEachGlyph(t,e,n,r,s,(function(t,e,n,r){var i=t.getPath(e,n,r);o.extend(i)})),o},r.prototype.getPaths=function(t,e,n,r,i){var s=[];return this.forEachGlyph(t,e,n,r,i,(function(t,e,n,r){var i=t.getPath(e,n,r);s.push(i)})),s},r.prototype.draw=function(t,e,n,r,i,s){this.getPath(e,n,r,i,s).draw(t)},r.prototype.drawPoints=function(t,e,n,r,i,s){this.forEachGlyph(e,n,r,i,s,(function(e,n,r,i){e.drawPoints(t,n,r,i)}))},r.prototype.drawMetrics=function(t,e,n,r,i,s){this.forEachGlyph(e,n,r,i,s,(function(e,n,r,i){e.drawMetrics(t,n,r,i)}))},r.prototype.getEnglishName=function(t){var e=this.names[t];return e?e.en:void 0},r.prototype.validate=function(){function t(t,e){t||n.push(e)}function e(e){var n=r.getEnglishName(e);t(n&&n.trim().length>0,"No English "+e+" specified.")}var n=[],r=this;e("fontFamily"),e("weightName"),e("manufacturer"),e("copyright"),e("version"),t(this.unitsPerEm>0,"No unitsPerEm specified.")},r.prototype.toTables=function(){return s.fontToTable(this)},r.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},r.prototype.toArrayBuffer=function(){for(var t=this.toTables().encode(),e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0;r<t.length;r++)n[r]=t[r];return e},r.prototype.download=function(){var e=this.getEnglishName("fontFamily"),n=this.getEnglishName("fontSubfamily"),r=e.replace(/\s/g,"")+"-"+n+".otf",i=this.toArrayBuffer();if(c.isBrowser())window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(window.TEMPORARY,i.byteLength,(function(t){t.root.getFile(r,{create:!0},(function(t){t.createWriter((function(e){var n=new DataView(i),r=new Blob([n],{type:"font/opentype"});e.write(r),e.addEventListener("writeend",(function(){location.href=t.toURL()}),!1)}))}))}),(function(t){throw new Error(t.name+": "+t.message)}));else{var s=t("fs"),o=c.arrayBufferToNodeBuffer(i);s.writeFileSync(r,o)}},r.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},r.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},r.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900},n.Font=r},{"./encoding":4,"./glyphset":7,"./path":11,"./substitution":12,"./tables/sfnt":31,"./util":33,fs:void 0}],6:[function(t,e,n){function r(t){this.bindConstructorValues(t)}var i=t("./check"),s=t("./draw"),o=t("./path");r.prototype.bindConstructorValues=function(t){var e,n;this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||void 0!==t.unicode?[t.unicode]:[],t.xMin&&(this.xMin=t.xMin),t.yMin&&(this.yMin=t.yMin),t.xMax&&(this.xMax=t.xMax),t.yMax&&(this.yMax=t.yMax),t.advanceWidth&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",(e=t.path,n=e||{commands:[]},{configurable:!0,get:function(){return"function"==typeof n&&(n=n()),n},set:function(t){n=t}}))},r.prototype.addUnicode=function(t){0===this.unicodes.length&&(this.unicode=t),this.unicodes.push(t)},r.prototype.getPath=function(t,e,n,r){t=void 0!==t?t:0,e=void 0!==e?e:0,r=void 0!==r?r:{xScale:1,yScale:1},n=void 0!==n?n:72;for(var i=1/this.path.unitsPerEm*n,s=r.xScale*i,a=r.yScale*i,l=new o.Path,c=this.path.commands,u=0;u<c.length;u+=1){var h=c[u];"M"===h.type?l.moveTo(t+h.x*s,e+-h.y*a):"L"===h.type?l.lineTo(t+h.x*s,e+-h.y*a):"Q"===h.type?l.quadraticCurveTo(t+h.x1*s,e+-h.y1*a,t+h.x*s,e+-h.y*a):"C"===h.type?l.curveTo(t+h.x1*s,e+-h.y1*a,t+h.x2*s,e+-h.y2*a,t+h.x*s,e+-h.y*a):"Z"===h.type&&l.closePath()}return l},r.prototype.getContours=function(){if(void 0===this.points)return[];for(var t=[],e=[],n=0;n<this.points.length;n+=1){var r=this.points[n];e.push(r),r.lastPointOfContour&&(t.push(e),e=[])}return i.argument(0===e.length,"There are still points left in the current contour."),t},r.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],n=[],r=0;r<t.length;r+=1){var i=t[r];"Z"!==i.type&&(e.push(i.x),n.push(i.y)),("Q"===i.type||"C"===i.type)&&(e.push(i.x1),n.push(i.y1)),"C"===i.type&&(e.push(i.x2),n.push(i.y2))}var s={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,n),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,n),leftSideBearing:this.leftSideBearing};return isFinite(s.xMin)||(s.xMin=0),isFinite(s.xMax)||(s.xMax=this.advanceWidth),isFinite(s.yMin)||(s.yMin=0),isFinite(s.yMax)||(s.yMax=0),s.rightSideBearing=this.advanceWidth-s.leftSideBearing-(s.xMax-s.xMin),s},r.prototype.draw=function(t,e,n,r,i){this.getPath(e,n,r,i).draw(t)},r.prototype.drawPoints=function(t,e,n,r){function i(e,n,r,i){var s=2*Math.PI;t.beginPath();for(var o=0;o<e.length;o+=1)t.moveTo(n+e[o].x*i,r+e[o].y*i),t.arc(n+e[o].x*i,r+e[o].y*i,2,0,s,!1);t.closePath(),t.fill()}e=void 0!==e?e:0,n=void 0!==n?n:0,r=void 0!==r?r:24;for(var s=1/this.path.unitsPerEm*r,o=[],a=[],l=this.path,c=0;c<l.commands.length;c+=1){var u=l.commands[c];void 0!==u.x&&o.push({x:u.x,y:-u.y}),void 0!==u.x1&&a.push({x:u.x1,y:-u.y1}),void 0!==u.x2&&a.push({x:u.x2,y:-u.y2})}t.fillStyle="blue",i(o,e,n,s),t.fillStyle="red",i(a,e,n,s)},r.prototype.drawMetrics=function(t,e,n,r){var i;e=void 0!==e?e:0,n=void 0!==n?n:0,r=void 0!==r?r:24,i=1/this.path.unitsPerEm*r,t.lineWidth=1,t.strokeStyle="black",s.line(t,e,-1e4,e,1e4),s.line(t,-1e4,n,1e4,n);var o=this.xMin||0,a=this.yMin||0,l=this.xMax||0,c=this.yMax||0,u=this.advanceWidth||0;t.strokeStyle="blue",s.line(t,e+o*i,-1e4,e+o*i,1e4),s.line(t,e+l*i,-1e4,e+l*i,1e4),s.line(t,-1e4,n+-a*i,1e4,n+-a*i),s.line(t,-1e4,n+-c*i,1e4,n+-c*i),t.strokeStyle="green",s.line(t,e+u*i,-1e4,e+u*i,1e4)},n.Glyph=r},{"./check":2,"./draw":3,"./path":11}],7:[function(t,e,n){function r(t,e,n){Object.defineProperty(t,e,{get:function(){return t.path,t[n]},set:function(e){t[n]=e},enumerable:!0,configurable:!0})}function i(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var n=0;n<e.length;n++)this.glyphs[n]=e[n];this.length=e&&e.length||0}var s=t("./glyph");i.prototype.get=function(t){return"function"==typeof this.glyphs[t]&&(this.glyphs[t]=this.glyphs[t]()),this.glyphs[t]},i.prototype.push=function(t,e){this.glyphs[t]=e,this.length++},n.GlyphSet=i,n.glyphLoader=function(t,e){return new s.Glyph({index:e,font:t})},n.ttfGlyphLoader=function(t,e,n,i,o,a){return function(){var l=new s.Glyph({index:e,font:t});return l.path=function(){n(l,i,o);var e=a(t.glyphs,l);return e.unitsPerEm=t.unitsPerEm,e},r(l,"xMin","_xMin"),r(l,"xMax","_xMax"),r(l,"yMin","_yMin"),r(l,"yMax","_yMax"),l}},n.cffGlyphLoader=function(t,e,n,r){return function(){var i=new s.Glyph({index:e,font:t});return i.path=function(){var e=n(t,i,r);return e.unitsPerEm=t.unitsPerEm,e},i}}},{"./glyph":6}],8:[function(t,e,n){function r(t,e){for(var n=0,r=t.length-1;r>=n;){var i=n+r>>>1,s=t[i].tag;if(s===e)return i;e>s?n=i+1:r=i-1}return-n-1}var i=t("./check"),s={searchTag:r,binSearch:function(t,e){for(var n=0,r=t.length-1;r>=n;){var i=n+r>>>1,s=t[i];if(s===e)return i;e>s?n=i+1:r=i-1}return-n-1},getScriptNames:function(){var t=this.getGsubTable();return t?t.scripts.map((function(t){return t.tag})):[]},getScriptTable:function(t,e){var n=this.getGsubTable(e);if(n){var i=n.scripts,s=r(n.scripts,t);if(s>=0)return i[s].script;var o={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return i.splice(-1-s,0,o.script),o}},getLangSysTable:function(t,e,n){var i=this.getScriptTable(t,n);if(i){if("DFLT"===e)return i.defaultLangSys;var s=r(i.langSysRecords,e);if(s>=0)return i.langSysRecords[s].langSys;if(n){var o={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return i.langSysRecords.splice(-1-s,0,o),o.langSys}}},getFeatureTable:function(t,e,n,r){var s=this.getLangSysTable(t,e,r);if(s){for(var o,a=s.featureIndexes,l=this.font.tables.gsub.features,c=0;c<a.length;c++)if((o=l[a[c]]).tag===n)return o.feature;if(r){var u=l.length;return i.assert(0===u||n>=l[u-1].tag,"Features must be added in alphabetical order."),o={tag:n,feature:{params:0,lookupListIndexes:[]}},l.push(o),a.push(u),o.feature}}},getLookupTable:function(t,e,n,r,i){var s=this.getFeatureTable(t,e,n,i);if(s){for(var o,a=s.lookupListIndexes,l=this.font.tables.gsub.lookups,c=0;c<a.length;c++)if((o=l[a[c]]).lookupType===r)return o;if(i){o={lookupType:r,lookupFlag:0,subtables:[],markFilteringSet:void 0};var u=l.length;return l.push(o),a.push(u),o}}},expandCoverage:function(t){if(1===t.format)return t.glyphs;for(var e=[],n=t.ranges,r=0;n>r;r++)for(var i=n[r],s=i.start,o=i.end,a=s;o>=a;a++)e.push(a);return e}};e.exports=s},{"./check":2}],9:[function(t,e,n){function r(e,n){t("fs").readFile(e,(function(t,e){return t?n(t.message):void n(null,f.nodeBufferToArrayBuffer(e))}))}function i(t,e){var n=new XMLHttpRequest;n.open("get",t,!0),n.responseType="arraybuffer",n.onload=function(){return 200!==n.status?e("Font could not be loaded: "+n.statusText):e(null,n.response)},n.send()}function s(t,e){for(var n=[],r=12,i=0;e>i;i+=1){var s=p.getTag(t,r),o=p.getULong(t,r+4),a=p.getULong(t,r+8),l=p.getULong(t,r+12);n.push({tag:s,checksum:o,offset:a,length:l,compression:!1}),r+=16}return n}function o(t,e){if("WOFF"===e.compression){var n=new Uint8Array(t.buffer,e.offset+2,e.compressedLength-2),r=new Uint8Array(e.originalLength);if(l(n,r),r.byteLength!==e.originalLength)throw new Error("Decompression error: "+e.tag+" decompressed length doesn't match recorded length");return{data:new DataView(r.buffer,0),offset:0}}return{data:t,offset:e.offset}}function a(t){var e,n,r,i=new u.Font({empty:!0}),a=new DataView(t,0),l=[],h=p.getTag(a,0);if(h===String.fromCharCode(0,1,0,0))i.outlinesFormat="truetype",l=s(a,r=p.getUShort(a,4));else if("OTTO"===h)i.outlinesFormat="cff",l=s(a,r=p.getUShort(a,4));else{if("wOFF"!==h)throw new Error("Unsupported OpenType signature "+h);var d=p.getTag(a,4);if(d===String.fromCharCode(0,1,0,0))i.outlinesFormat="truetype";else{if("OTTO"!==d)throw new Error("Unsupported OpenType flavor "+h);i.outlinesFormat="cff"}l=function(t,e){for(var n=[],r=44,i=0;e>i;i+=1){var s,o=p.getTag(t,r),a=p.getULong(t,r+4),l=p.getULong(t,r+8),c=p.getULong(t,r+12);s=c>l&&"WOFF",n.push({tag:o,offset:a,compression:s,compressedLength:l,originalLength:c}),r+=20}return n}(a,r=p.getUShort(a,12))}for(var f,R,N,P,I,O,F,k,D,U,z=0;r>z;z+=1){var j,G=l[z];switch(G.tag){case"cmap":j=o(a,G),i.tables.cmap=m.parse(j.data,j.offset),i.encoding=new c.CmapEncoding(i.tables.cmap);break;case"fvar":R=G;break;case"head":j=o(a,G),i.tables.head=x.parse(j.data,j.offset),i.unitsPerEm=i.tables.head.unitsPerEm,e=i.tables.head.indexToLocFormat;break;case"hhea":j=o(a,G),i.tables.hhea=w.parse(j.data,j.offset),i.ascender=i.tables.hhea.ascender,i.descender=i.tables.hhea.descender,i.numberOfHMetrics=i.tables.hhea.numberOfHMetrics;break;case"hmtx":O=G;break;case"ltag":j=o(a,G),n=T.parse(j.data,j.offset);break;case"maxp":j=o(a,G),i.tables.maxp=A.parse(j.data,j.offset),i.numGlyphs=i.tables.maxp.numGlyphs;break;case"name":D=G;break;case"OS/2":j=o(a,G),i.tables.os2=C.parse(j.data,j.offset);break;case"post":j=o(a,G),i.tables.post=B.parse(j.data,j.offset),i.glyphNames=new c.GlyphNames(i.tables.post);break;case"glyf":N=G;break;case"loca":k=G;break;case"CFF ":f=G;break;case"kern":F=G;break;case"GPOS":P=G;break;case"GSUB":I=G;break;case"meta":U=G}}var H=o(a,D);if(i.tables.name=$.parse(H.data,H.offset,n),i.names=i.tables.name,N&&k){var V=0===e,W=o(a,k),q=E.parse(W.data,W.offset,i.numGlyphs,V),X=o(a,N);i.glyphs=y.parse(X.data,X.offset,q,i)}else{if(!f)throw new Error("Font doesn't contain TrueType or CFF outlines.");var Y=o(a,f);_.parse(Y.data,Y.offset,i)}var J=o(a,O);if(S.parse(J.data,J.offset,i.numberOfHMetrics,i.numGlyphs,i.glyphs),c.addGlyphNames(i),F){var Z=o(a,F);i.kerningPairs=M.parse(Z.data,Z.offset)}else i.kerningPairs={};if(P){var Q=o(a,P);v.parse(Q.data,Q.offset,i)}if(I){var K=o(a,I);i.tables.gsub=b.parse(K.data,K.offset)}if(R){var tt=o(a,R);i.tables.fvar=g.parse(tt.data,tt.offset,i.names)}if(U){var et=o(a,U);i.tables.meta=L.parse(et.data,et.offset),i.metas=i.tables.meta}return i}var l=t("tiny-inflate"),c=t("./encoding"),u=t("./font"),h=t("./glyph"),p=t("./parse"),d=t("./path"),f=t("./util"),m=t("./tables/cmap"),_=t("./tables/cff"),g=t("./tables/fvar"),y=t("./tables/glyf"),v=t("./tables/gpos"),b=t("./tables/gsub"),x=t("./tables/head"),w=t("./tables/hhea"),S=t("./tables/hmtx"),M=t("./tables/kern"),T=t("./tables/ltag"),E=t("./tables/loca"),A=t("./tables/maxp"),$=t("./tables/name"),C=t("./tables/os2"),B=t("./tables/post"),L=t("./tables/meta");n._parse=p,n.Font=u.Font,n.Glyph=h.Glyph,n.Path=d.Path,n.parse=a,n.load=function(t,e){("undefined"==typeof window?r:i)(t,(function(t,n){if(t)return e(t);var r;try{r=a(n)}catch(t){return e(t,null)}return e(null,r)}))},n.loadSync=function(e){var n=t("fs").readFileSync(e);return a(f.nodeBufferToArrayBuffer(n))}},{"./encoding":4,"./font":5,"./glyph":6,"./parse":10,"./path":11,"./tables/cff":14,"./tables/cmap":15,"./tables/fvar":16,"./tables/glyf":17,"./tables/gpos":18,"./tables/gsub":19,"./tables/head":20,"./tables/hhea":21,"./tables/hmtx":22,"./tables/kern":23,"./tables/loca":24,"./tables/ltag":25,"./tables/maxp":26,"./tables/meta":27,"./tables/name":28,"./tables/os2":29,"./tables/post":30,"./util":33,fs:void 0,"tiny-inflate":1}],10:[function(t,e,n){function r(t,e){return t.getUint16(e,!1)}function i(t,e){this.data=t,this.offset=e,this.relativeOffset=0}var s=t("./check");n.getByte=function(t,e){return t.getUint8(e)},n.getCard8=n.getByte,n.getUShort=n.getCard16=r,n.getShort=function(t,e){return t.getInt16(e,!1)},n.getULong=function(t,e){return t.getUint32(e,!1)},n.getFixed=function(t,e){return t.getInt16(e,!1)+t.getUint16(e+2,!1)/65535},n.getTag=function(t,e){for(var n="",r=e;e+4>r;r+=1)n+=String.fromCharCode(t.getInt8(r));return n},n.getOffset=function(t,e,n){for(var r=0,i=0;n>i;i+=1)r<<=8,r+=t.getUint8(e+i);return r},n.getBytes=function(t,e,n){for(var r=[],i=e;n>i;i+=1)r.push(t.getUint8(i));return r},n.bytesToString=function(t){for(var e="",n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return e};var o={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};i.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},i.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},i.prototype.parseCard8=i.prototype.parseByte,i.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},i.prototype.parseCard16=i.prototype.parseUShort,i.prototype.parseSID=i.prototype.parseUShort,i.prototype.parseOffset16=i.prototype.parseUShort,i.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},i.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t},i.prototype.parseULong=function(){var t=n.getULong(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},i.prototype.parseFixed=function(){var t=n.getFixed(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},i.prototype.parseString=function(t){var e=this.data,n=this.offset+this.relativeOffset,r="";this.relativeOffset+=t;for(var i=0;t>i;i++)r+=String.fromCharCode(e.getUint8(n+i));return r},i.prototype.parseTag=function(){return this.parseString(4)},i.prototype.parseLongDateTime=function(){var t=n.getULong(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t},i.prototype.parseVersion=function(){var t=r(this.data,this.offset+this.relativeOffset),e=r(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t+e/4096/10},i.prototype.skip=function(t,e){void 0===e&&(e=1),this.relativeOffset+=o[t]*e},i.prototype.parseOffset16List=i.prototype.parseUShortList=function(t){void 0===t&&(t=this.parseUShort());for(var e=new Array(t),n=this.data,r=this.offset+this.relativeOffset,i=0;t>i;i++)e[i]=n.getUint16(r),r+=2;return this.relativeOffset+=2*t,e},i.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var n=new Array(t),r=0;t>r;r++)n[r]=e.call(this);return n},i.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var n=new Array(t),r=Object.keys(e),i=0;t>i;i++){for(var s={},o=0;o<r.length;o++){var a=r[o],l=e[a];s[a]=l.call(this)}n[i]=s}return n},i.prototype.parseStruct=function(t){if("function"==typeof t)return t.call(this);for(var e=Object.keys(t),n={},r=0;r<e.length;r++){var i=e[r],s=t[i];n[i]=s.call(this)}return n},i.prototype.parsePointer=function(t){var e=this.parseOffset16();return e>0?new i(this.data,this.offset+e).parseStruct(t):void 0},i.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),n=e.length,r=this.relativeOffset,i=new Array(n),s=0;n>s;s++){var o=e[s];if(0!==o)if(this.relativeOffset=o,t){for(var a=this.parseOffset16List(),l=new Array(a.length),c=0;c<a.length;c++)this.relativeOffset=o+a[c],l[c]=t.call(this);i[s]=l}else i[s]=this.parseUShortList();else i[s]=void 0}return this.relativeOffset=r,i},i.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),n=this.parseUShort();if(1===e)return{format:1,glyphs:this.parseUShortList(n)};if(2===e){for(var r=new Array(n),i=0;n>i;i++)r[i]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:r}}s.assert(!1,"0x"+t.toString(16)+": Coverage format must be 1 or 2.")},i.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();return 1===e?{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()}:2===e?{format:2,ranges:this.parseRecordList({start:i.uShort,end:i.uShort,classId:i.uShort})}:void s.assert(!1,"0x"+t.toString(16)+": ClassDef format must be 1 or 2.")},i.list=function(t,e){return function(){return this.parseList(t,e)}},i.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}},i.pointer=function(t){return function(){return this.parsePointer(t)}},i.tag=i.prototype.parseTag,i.byte=i.prototype.parseByte,i.uShort=i.offset16=i.prototype.parseUShort,i.uShortList=i.prototype.parseUShortList,i.struct=i.prototype.parseStruct,i.coverage=i.prototype.parseCoverage,i.classDef=i.prototype.parseClassDef;var a={reserved:i.uShort,reqFeatureIndex:i.uShort,featureIndexes:i.uShortList};i.prototype.parseScriptList=function(){return this.parsePointer(i.recordList({tag:i.tag,script:i.pointer({defaultLangSys:i.pointer(a),langSysRecords:i.recordList({tag:i.tag,langSys:i.pointer(a)})})}))},i.prototype.parseFeatureList=function(){return this.parsePointer(i.recordList({tag:i.tag,feature:i.pointer({featureParams:i.offset16,lookupListIndexes:i.uShortList})}))},i.prototype.parseLookupList=function(t){return this.parsePointer(i.list(i.pointer((function(){var e=this.parseUShort();s.argument(e>=1&&8>=e,"GSUB lookup type "+e+" unknown.");var n=this.parseUShort(),r=16&n;return{lookupType:e,lookupFlag:n,subtables:this.parseList(i.pointer(t[e])),markFilteringSet:r?this.parseUShort():void 0}}))))},n.Parser=i},{"./check":2}],11:[function(t,e,n){function r(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}r.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})},r.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})},r.prototype.curveTo=r.prototype.bezierCurveTo=function(t,e,n,r,i,s){this.commands.push({type:"C",x1:t,y1:e,x2:n,y2:r,x:i,y:s})},r.prototype.quadTo=r.prototype.quadraticCurveTo=function(t,e,n,r){this.commands.push({type:"Q",x1:t,y1:e,x:n,y:r})},r.prototype.close=r.prototype.closePath=function(){this.commands.push({type:"Z"})},r.prototype.extend=function(t){t.commands&&(t=t.commands),Array.prototype.push.apply(this.commands,t)},r.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var n=this.commands[e];"M"===n.type?t.moveTo(n.x,n.y):"L"===n.type?t.lineTo(n.x,n.y):"C"===n.type?t.bezierCurveTo(n.x1,n.y1,n.x2,n.y2,n.x,n.y):"Q"===n.type?t.quadraticCurveTo(n.x1,n.y1,n.x,n.y):"Z"===n.type&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())},r.prototype.toPathData=function(t){function e(e){return Math.round(e)===e?""+Math.round(e):e.toFixed(t)}function n(){for(var t="",n=0;n<arguments.length;n+=1){var r=arguments[n];r>=0&&n>0&&(t+=" "),t+=e(r)}return t}t=void 0!==t?t:2;for(var r="",i=0;i<this.commands.length;i+=1){var s=this.commands[i];"M"===s.type?r+="M"+n(s.x,s.y):"L"===s.type?r+="L"+n(s.x,s.y):"C"===s.type?r+="C"+n(s.x1,s.y1,s.x2,s.y2,s.x,s.y):"Q"===s.type?r+="Q"+n(s.x1,s.y1,s.x,s.y):"Z"===s.type&&(r+="Z")}return r},r.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&"black"!==this.fill&&(e+=null===this.fill?' fill="none"':' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+"/>"},n.Path=r},{}],12:[function(t,e,n){function r(t,e){var n=t.length;if(n!==e.length)return!1;for(var r=0;n>r;r++)if(t[r]!==e[r])return!1;return!0}function i(t,e,n){for(var r=t.subtables,i=0;i<r.length;i++){var s=r[i];if(s.substFormat===e)return s}return n?(r.push(n),n):void 0}var s=t("./check"),o=t("./layout"),a=function(t){this.font=t};(a.prototype=o).getGsubTable=function(t){var e=this.font.tables.gsub;return!e&&t&&(this.font.tables.gsub=e={version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}),e},a.prototype.getSingle=function(t,e,n){var r=[],i=this.getLookupTable(e,n,t,1);if(!i)return r;for(var s=i.subtables,o=0;o<s.length;o++){var a,l=s[o],c=this.expandCoverage(l.coverage);if(1===l.substFormat){var u=l.deltaGlyphId;for(a=0;a<c.length;a++){var h=c[a];r.push({sub:h,by:h+u})}}else{var p=l.substitute;for(a=0;a<c.length;a++)r.push({sub:c[a],by:p[a]})}}return r},a.prototype.getAlternates=function(t,e,n){var r=[],i=this.getLookupTable(e,n,t,3);if(!i)return r;for(var s=i.subtables,o=0;o<s.length;o++)for(var a=s[o],l=this.expandCoverage(a.coverage),c=a.alternateSets,u=0;u<l.length;u++)r.push({sub:l[u],by:c[u]});return r},a.prototype.getLigatures=function(t,e,n){var r=[],i=this.getLookupTable(e,n,t,4);if(!i)return[];for(var s=i.subtables,o=0;o<s.length;o++)for(var a=s[o],l=this.expandCoverage(a.coverage),c=a.ligatureSets,u=0;u<l.length;u++)for(var h=l[u],p=c[u],d=0;d<p.length;d++){var f=p[d];r.push({sub:[h].concat(f.components),by:f.ligGlyph})}return r},a.prototype.addSingle=function(t,e,n,r){var o=i(this.getLookupTable(n,r,t,1,!0),2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});s.assert(1===o.coverage.format,"Ligature: unable to modify coverage table format "+o.coverage.format);var a=e.sub,l=this.binSearch(o.coverage.glyphs,a);0>l&&(l=-1-l,o.coverage.glyphs.splice(l,0,a),o.substitute.splice(l,0,0)),o.substitute[l]=e.by},a.prototype.addAlternate=function(t,e,n,r){var o=i(this.getLookupTable(n,r,t,3,!0),1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});s.assert(1===o.coverage.format,"Ligature: unable to modify coverage table format "+o.coverage.format);var a=e.sub,l=this.binSearch(o.coverage.glyphs,a);0>l&&(l=-1-l,o.coverage.glyphs.splice(l,0,a),o.alternateSets.splice(l,0,0)),o.alternateSets[l]=e.by},a.prototype.addLigature=function(t,e,n,i){n=n||"DFLT",i=i||"DFLT";var o=this.getLookupTable(n,i,t,4,!0),a=o.subtables[0];a||(a={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},o.subtables[0]=a),s.assert(1===a.coverage.format,"Ligature: unable to modify coverage table format "+a.coverage.format);var l=e.sub[0],c=e.sub.slice(1),u={ligGlyph:e.by,components:c},h=this.binSearch(a.coverage.glyphs,l);if(h>=0){for(var p=a.ligatureSets[h],d=0;d<p.length;d++)if(r(p[d].components,c))return;p.push(u)}else h=-1-h,a.coverage.glyphs.splice(h,0,l),a.ligatureSets.splice(h,0,[u])},a.prototype.getFeature=function(t,e,n){if(e=e||"DFLT",n=n||"DFLT",/ss\d\d/.test(t))return this.getSingle(t,e,n);switch(t){case"aalt":case"salt":return this.getSingle(t,e,n).concat(this.getAlternates(t,e,n));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,n)}},a.prototype.add=function(t,e,n,r){if(n=n||"DFLT",r=r||"DFLT",/ss\d\d/.test(t))return this.addSingle(t,e,n,r);switch(t){case"aalt":case"salt":return"number"==typeof e.by?this.addSingle(t,e,n,r):this.addAlternate(t,e,n,r);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,n,r)}},e.exports=a},{"./check":2,"./layout":8}],13:[function(t,e,n){function r(t,e,n){var r;for(r=0;r<e.length;r+=1){var i=e[r];this[i.name]=i.value}if(this.tableName=t,this.fields=e,n){var s=Object.keys(n);for(r=0;r<s.length;r+=1){var o=s[r],a=n[o];void 0!==this[o]&&(this[o]=a)}}}function i(t,e,n){void 0===n&&(n=e.length);var r=new Array(e.length+1);r[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<e.length;i++)r[i+1]={name:t+i,type:"USHORT",value:e[i]};return r}function s(t,e,n){var r=e.length,i=new Array(r+1);i[0]={name:t+"Count",type:"USHORT",value:r};for(var s=0;r>s;s++)i[s+1]={name:t+s,type:"TABLE",value:n(e[s],s)};return i}function o(t,e,n){var r=e.length,i=[];i[0]={name:t+"Count",type:"USHORT",value:r};for(var s=0;r>s;s++)i=i.concat(n(e[s],s));return i}function a(t){1===t.format?r.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(i("glyph",t.glyphs))):h.assert(!1,"Can't create coverage table format 2 yet.")}function l(t){r.call(this,"scriptListTable",o("scriptRecord",t,(function(t,e){var n=t.script,s=n.defaultLangSys;return h.assert(!!s,"Unable to write GSUB: script "+t.tag+" has no default language system."),[{name:"scriptTag"+e,type:"TAG",value:t.tag},{name:"script"+e,type:"TABLE",value:new r("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new r("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:s.reqFeatureIndex}].concat(i("featureIndex",s.featureIndexes)))}].concat(o("langSys",n.langSysRecords,(function(t,e){var n=t.langSys;return[{name:"langSysTag"+e,type:"TAG",value:t.tag},{name:"langSys"+e,type:"TABLE",value:new r("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:n.reqFeatureIndex}].concat(i("featureIndex",n.featureIndexes)))}]}))))}]})))}function c(t){r.call(this,"featureListTable",o("featureRecord",t,(function(t,e){var n=t.feature;return[{name:"featureTag"+e,type:"TAG",value:t.tag},{name:"feature"+e,type:"TABLE",value:new r("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(i("lookupListIndex",n.lookupListIndexes)))}]})))}function u(t,e){r.call(this,"lookupListTable",s("lookup",t,(function(t){var n=e[t.lookupType];return h.assert(!!n,"Unable to write GSUB lookup type "+t.lookupType+" tables."),new r("lookupTable",[{name:"lookupType",type:"USHORT",value:t.lookupType},{name:"lookupFlag",type:"USHORT",value:t.lookupFlag}].concat(s("subtable",t.subtables,n)))})))}var h=t("./check"),p=t("./types").encode,d=t("./types").sizeOf;r.prototype.encode=function(){return p.TABLE(this)},r.prototype.sizeOf=function(){return d.TABLE(this)},a.prototype=Object.create(r.prototype),a.prototype.constructor=a,l.prototype=Object.create(r.prototype),l.prototype.constructor=l,c.prototype=Object.create(r.prototype),c.prototype.constructor=c,u.prototype=Object.create(r.prototype),u.prototype.constructor=u,n.Record=n.Table=r,n.Coverage=a,n.ScriptList=l,n.FeatureList=c,n.LookupList=u,n.ushortList=i,n.tableList=s,n.recordList=o},{"./check":2,"./types":32}],14:[function(t,e,n){function r(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n+=1)if(!r(t[n],e[n]))return!1;return!0}return!1}function i(t,e,n){var r,i,s,o=[],a=[],l=y.getCard16(t,e);if(0!==l){var c=y.getByte(t,e+2);i=e+(l+1)*c+2;var u=e+3;for(r=0;l+1>r;r+=1)o.push(y.getOffset(t,u,c)),u+=c;s=i+o[l]}else s=e+2;for(r=0;r<o.length-1;r+=1){var h=y.getBytes(t,i+o[r],i+o[r+1]);n&&(h=n(h)),a.push(h)}return{objects:a,startOffset:e,endOffset:s}}function s(t,e){if(28===e)return t.parseByte()<<8|t.parseByte();if(29===e)return t.parseByte()<<24|t.parseByte()<<16|t.parseByte()<<8|t.parseByte();if(30===e)return function(t){for(var e="",n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var r=t.parseByte(),i=r>>4,s=15&r;if(15===i)break;if(e+=n[i],15===s)break;e+=n[s]}return parseFloat(e)}(t);if(e>=32&&246>=e)return e-139;if(e>=247&&250>=e)return 256*(e-247)+t.parseByte()+108;if(e>=251&&254>=e)return 256*-(e-251)-t.parseByte()-108;throw new Error("Invalid b0 "+e)}function o(t,e,n){e=void 0!==e?e:0;var r=new y.Parser(t,e),i=[],o=[];for(n=void 0!==n?n:t.length;r.relativeOffset<n;){var a=r.parseByte();21>=a?(12===a&&(a=1200+r.parseByte()),i.push([a,o]),o=[]):o.push(s(r,a))}return function(t){for(var e={},n=0;n<t.length;n+=1){var r,i=t[n][0],s=t[n][1];if(r=1===s.length?s[0]:s,e.hasOwnProperty(i))throw new Error("Object "+e+" already has key "+i);e[i]=r}return e}(i)}function a(t,e){return 390>=e?_.cffStandardStrings[e]:t[e-391]}function l(t,e,n){for(var r={},i=0;i<e.length;i+=1){var s=e[i],o=t[s.op];void 0===o&&(o=void 0!==s.value?s.value:null),"SID"===s.type&&(o=a(n,o)),r[s.name]=o}return r}function c(t,e,n){function r(t,e){f&&c.closePath(),c.moveTo(t,e),f=!0}function i(){u.length%2!=0&&!p&&(d=u.shift()+t.nominalWidthX),h+=u.length>>1,u.length=0,p=!0}var s,o,a,l,c=new v.Path,u=[],h=0,p=!1,d=t.defaultWidthX,f=!1,m=0,_=0;return function n(g){for(var y,v,b,x,w,S,M,T,E,A,$,C,B=0;B<g.length;){var L=g[B];switch(B+=1,L){case 1:case 3:case 18:case 23:i();break;case 4:u.length>1&&!p&&(d=u.shift()+t.nominalWidthX,p=!0),_+=u.pop(),r(m,_);break;case 5:for(;u.length>0;)m+=u.shift(),_+=u.shift(),c.lineTo(m,_);break;case 6:for(;u.length>0&&(m+=u.shift(),c.lineTo(m,_),0!==u.length);)_+=u.shift(),c.lineTo(m,_);break;case 7:for(;u.length>0&&(_+=u.shift(),c.lineTo(m,_),0!==u.length);)m+=u.shift(),c.lineTo(m,_);break;case 8:for(;u.length>0;)s=m+u.shift(),o=_+u.shift(),a=s+u.shift(),l=o+u.shift(),m=a+u.shift(),_=l+u.shift(),c.curveTo(s,o,a,l,m,_);break;case 10:w=u.pop()+t.subrsBias,(S=t.subrs[w])&&n(S);break;case 11:return;case 12:switch(L=g[B],B+=1,L){case 35:s=m+u.shift(),o=_+u.shift(),a=s+u.shift(),l=o+u.shift(),M=a+u.shift(),T=l+u.shift(),E=M+u.shift(),A=T+u.shift(),$=E+u.shift(),C=A+u.shift(),m=$+u.shift(),_=C+u.shift(),u.shift(),c.curveTo(s,o,a,l,M,T),c.curveTo(E,A,$,C,m,_);break;case 34:s=m+u.shift(),o=_,a=s+u.shift(),l=o+u.shift(),M=a+u.shift(),T=l,E=M+u.shift(),A=l,$=E+u.shift(),C=_,m=$+u.shift(),c.curveTo(s,o,a,l,M,T),c.curveTo(E,A,$,C,m,_);break;case 36:s=m+u.shift(),o=_+u.shift(),a=s+u.shift(),l=o+u.shift(),M=a+u.shift(),T=l,E=M+u.shift(),A=l,$=E+u.shift(),C=A+u.shift(),m=$+u.shift(),c.curveTo(s,o,a,l,M,T),c.curveTo(E,A,$,C,m,_);break;case 37:s=m+u.shift(),o=_+u.shift(),a=s+u.shift(),l=o+u.shift(),M=a+u.shift(),T=l+u.shift(),E=M+u.shift(),A=T+u.shift(),$=E+u.shift(),C=A+u.shift(),Math.abs($-m)>Math.abs(C-_)?m=$+u.shift():_=C+u.shift(),c.curveTo(s,o,a,l,M,T),c.curveTo(E,A,$,C,m,_);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+L),u.length=0}break;case 14:u.length>0&&!p&&(d=u.shift()+t.nominalWidthX,p=!0),f&&(c.closePath(),f=!1);break;case 19:case 20:i(),B+=h+7>>3;break;case 21:u.length>2&&!p&&(d=u.shift()+t.nominalWidthX,p=!0),_+=u.pop(),r(m+=u.pop(),_);break;case 22:u.length>1&&!p&&(d=u.shift()+t.nominalWidthX,p=!0),r(m+=u.pop(),_);break;case 24:for(;u.length>2;)s=m+u.shift(),o=_+u.shift(),a=s+u.shift(),l=o+u.shift(),m=a+u.shift(),_=l+u.shift(),c.curveTo(s,o,a,l,m,_);m+=u.shift(),_+=u.shift(),c.lineTo(m,_);break;case 25:for(;u.length>6;)m+=u.shift(),_+=u.shift(),c.lineTo(m,_);s=m+u.shift(),o=_+u.shift(),a=s+u.shift(),l=o+u.shift(),m=a+u.shift(),_=l+u.shift(),c.curveTo(s,o,a,l,m,_);break;case 26:for(u.length%2&&(m+=u.shift());u.length>0;)s=m,o=_+u.shift(),a=s+u.shift(),l=o+u.shift(),m=a,_=l+u.shift(),c.curveTo(s,o,a,l,m,_);break;case 27:for(u.length%2&&(_+=u.shift());u.length>0;)s=m+u.shift(),o=_,a=s+u.shift(),l=o+u.shift(),m=a+u.shift(),_=l,c.curveTo(s,o,a,l,m,_);break;case 28:y=g[B],v=g[B+1],u.push((y<<24|v<<16)>>16),B+=2;break;case 29:w=u.pop()+t.gsubrsBias,(S=t.gsubrs[w])&&n(S);break;case 30:for(;u.length>0&&(s=m,o=_+u.shift(),a=s+u.shift(),l=o+u.shift(),m=a+u.shift(),_=l+(1===u.length?u.shift():0),c.curveTo(s,o,a,l,m,_),0!==u.length);)s=m+u.shift(),o=_,a=s+u.shift(),l=o+u.shift(),_=l+u.shift(),m=a+(1===u.length?u.shift():0),c.curveTo(s,o,a,l,m,_);break;case 31:for(;u.length>0&&(s=m+u.shift(),o=_,a=s+u.shift(),l=o+u.shift(),_=l+u.shift(),m=a+(1===u.length?u.shift():0),c.curveTo(s,o,a,l,m,_),0!==u.length);)s=m,o=_+u.shift(),a=s+u.shift(),l=o+u.shift(),m=a+u.shift(),_=l+(1===u.length?u.shift():0),c.curveTo(s,o,a,l,m,_);break;default:32>L?console.log("Glyph "+e.index+": unknown operator "+L):247>L?u.push(L-139):251>L?(y=g[B],B+=1,u.push(256*(L-247)+y+108)):255>L?(y=g[B],B+=1,u.push(256*-(L-251)-y-108)):(y=g[B],v=g[B+1],b=g[B+2],x=g[B+3],B+=4,u.push((y<<24|v<<16|b<<8|x)/65536))}}}(n),e.advanceWidth=d,c}function u(t){return t.length<1240?107:t.length<33900?1131:32768}function h(t,e){var n,r=_.cffStandardStrings.indexOf(t);return r>=0&&(n=r),(r=e.indexOf(t))>=0?n=r+_.cffStandardStrings.length:(n=_.cffStandardStrings.length+e.length,e.push(t)),n}function p(t,e,n){for(var i={},s=0;s<t.length;s+=1){var o=t[s],a=e[o.name];void 0===a||r(a,o.value)||("SID"===o.type&&(a=h(a,n)),i[o.op]={name:o.name,type:o.type,value:a})}return i}function d(t,e){var n=new b.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return n.dict=p(x,t,e),n}function f(t){var e=new b.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function m(t){var e=[],n=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var r=0,i=0,s=0;s<n.commands.length;s+=1){var o,a,l=n.commands[s];if("Q"===l.type){var c=1/3,u=2/3;l={type:"C",x:l.x,y:l.y,x1:c*r+u*l.x1,y1:c*i+u*l.y1,x2:c*l.x+u*l.x1,y2:c*l.y+u*l.y1}}if("M"===l.type)o=Math.round(l.x-r),a=Math.round(l.y-i),e.push({name:"dx",type:"NUMBER",value:o}),e.push({name:"dy",type:"NUMBER",value:a}),e.push({name:"rmoveto",type:"OP",value:21}),r=Math.round(l.x),i=Math.round(l.y);else if("L"===l.type)o=Math.round(l.x-r),a=Math.round(l.y-i),e.push({name:"dx",type:"NUMBER",value:o}),e.push({name:"dy",type:"NUMBER",value:a}),e.push({name:"rlineto",type:"OP",value:5}),r=Math.round(l.x),i=Math.round(l.y);else if("C"===l.type){var h=Math.round(l.x1-r),p=Math.round(l.y1-i),d=Math.round(l.x2-l.x1),f=Math.round(l.y2-l.y1);o=Math.round(l.x-l.x2),a=Math.round(l.y-l.y2),e.push({name:"dx1",type:"NUMBER",value:h}),e.push({name:"dy1",type:"NUMBER",value:p}),e.push({name:"dx2",type:"NUMBER",value:d}),e.push({name:"dy2",type:"NUMBER",value:f}),e.push({name:"dx",type:"NUMBER",value:o}),e.push({name:"dy",type:"NUMBER",value:a}),e.push({name:"rrcurveto",type:"OP",value:8}),r=Math.round(l.x),i=Math.round(l.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}var _=t("../encoding"),g=t("../glyphset"),y=t("../parse"),v=t("../path"),b=t("../table"),x=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]}],w=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];n.parse=function(t,e,n){n.tables.cff={};var r=function(t,e){var n={};return n.formatMajor=y.getCard8(t,e),n.formatMinor=y.getCard8(t,e+1),n.size=y.getCard8(t,e+2),n.offsetSize=y.getCard8(t,e+3),n.startOffset=e,n.endOffset=e+4,n}(t,e),s=i(t,r.endOffset,y.bytesToString),h=i(t,s.endOffset),p=i(t,h.endOffset,y.bytesToString),d=i(t,p.endOffset);n.gsubrs=d.objects,n.gsubrsBias=u(n.gsubrs);var f=function(t,e){return l(o(t,0,t.byteLength),x,e)}(new DataView(new Uint8Array(h.objects[0]).buffer),p.objects);n.tables.cff.topDict=f;var m=e+f.private[1],v=function(t,e,n,r){return l(o(t,e,n),w,r)}(t,m,f.private[0],p.objects);if(n.defaultWidthX=v.defaultWidthX,n.nominalWidthX=v.nominalWidthX,0!==v.subrs){var b=i(t,m+v.subrs);n.subrs=b.objects,n.subrsBias=u(n.subrs)}else n.subrs=[],n.subrsBias=0;var S=i(t,e+f.charStrings);n.nGlyphs=S.objects.length;var M=function(t,e,n,r){var i,s,o,l=new y.Parser(t,e);n-=1;var c=[".notdef"],u=l.parseCard8();if(0===u)for(i=0;n>i;i+=1)s=l.parseSID(),c.push(a(r,s));else if(1===u)for(;c.length<=n;)for(s=l.parseSID(),o=l.parseCard8(),i=0;o>=i;i+=1)c.push(a(r,s)),s+=1;else{if(2!==u)throw new Error("Unknown charset format "+u);for(;c.length<=n;)for(s=l.parseSID(),o=l.parseCard16(),i=0;o>=i;i+=1)c.push(a(r,s)),s+=1}return c}(t,e+f.charset,n.nGlyphs,p.objects);n.cffEncoding=0===f.encoding?new _.CffEncoding(_.cffStandardEncoding,M):1===f.encoding?new _.CffEncoding(_.cffExpertEncoding,M):function(t,e,n){var r,i,s={},o=new y.Parser(t,e),a=o.parseCard8();if(0===a){var l=o.parseCard8();for(r=0;l>r;r+=1)s[i=o.parseCard8()]=r}else{if(1!==a)throw new Error("Unknown encoding format "+a);var c=o.parseCard8();for(i=1,r=0;c>r;r+=1)for(var u=o.parseCard8(),h=o.parseCard8(),p=u;u+h>=p;p+=1)s[p]=i,i+=1}return new _.CffEncoding(s,n)}(t,e+f.encoding,M),n.encoding=n.encoding||n.cffEncoding,n.glyphs=new g.GlyphSet(n);for(var T=0;T<n.nGlyphs;T+=1){var E=S.objects[T];n.glyphs.push(T,g.cffGlyphLoader(n,T,c,E))}},n.make=function(t,e){for(var n,r=new b.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),i=1/e.unitsPerEm,s={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[i,0,0,i,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},o=[],a=1;a<t.length;a+=1)n=t.get(a),o.push(n.name);var l=[];r.header=new b.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}]),r.nameIndex=function(t){var e=new b.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var n=0;n<t.length;n+=1)e.names.push({name:"name_"+n,type:"NAME",value:t[n]});return e}([e.postScriptName]);var c=d(s,l);r.topDictIndex=f(c),r.globalSubrIndex=new b.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}]),r.charsets=function(t,e){for(var n=new b.Record("Charsets",[{name:"format",type:"Card8",value:0}]),r=0;r<t.length;r+=1){var i=h(t[r],e);n.fields.push({name:"glyph_"+r,type:"SID",value:i})}return n}(o,l),r.charStringsIndex=function(t){for(var e=new b.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),n=0;n<t.length;n+=1){var r=t.get(n),i=m(r);e.charStrings.push({name:r.name,type:"CHARSTRING",value:i})}return e}(t),r.privateDict=function(t,e){var n=new b.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return n.dict=p(w,{},e),n}(0,l),r.stringIndex=function(t){var e=new b.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var n=0;n<t.length;n+=1)e.strings.push({name:"string_"+n,type:"STRING",value:t[n]});return e}(l);var u=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return s.charset=u,s.encoding=0,s.charStrings=s.charset+r.charsets.sizeOf(),s.private[1]=s.charStrings+r.charStringsIndex.sizeOf(),c=d(s,l),r.topDictIndex=f(c),r}},{"../encoding":4,"../glyphset":7,"../parse":10,"../path":11,"../table":13}],15:[function(t,e,n){function r(t,e,n){t.segments.push({end:e,start:e,delta:-(e-n),offset:0})}var i=t("../check"),s=t("../parse"),o=t("../table");n.parse=function(t,e){var n,r={};r.version=s.getUShort(t,e),i.argument(0===r.version,"cmap table version should be 0."),r.numTables=s.getUShort(t,e+2);var o=-1;for(n=r.numTables-1;n>=0;n-=1){var a=s.getUShort(t,e+4+8*n),l=s.getUShort(t,e+4+8*n+2);if(3===a&&(0===l||1===l||10===l)){o=s.getULong(t,e+4+8*n+4);break}}if(-1===o)return null;var c=new s.Parser(t,e+o);if(r.format=c.parseUShort(),12===r.format)!function(t,e){var n,r;for(e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong(),t.groupCount=r=e.parseULong(),t.glyphIndexMap={},n=0;r>n;n+=1)for(var i=e.parseULong(),s=e.parseULong(),o=e.parseULong(),a=i;s>=a;a+=1)t.glyphIndexMap[a]=o,o++}(r,c);else{if(4!==r.format)throw new Error("Only format 4 and 12 cmap tables are supported.");!function(t,e,n,r,i){var o,a;t.length=e.parseUShort(),t.language=e.parseUShort(),t.segCount=a=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};var l=new s.Parser(n,r+i+14),c=new s.Parser(n,r+i+16+2*a),u=new s.Parser(n,r+i+16+4*a),h=new s.Parser(n,r+i+16+6*a),p=r+i+16+8*a;for(o=0;a-1>o;o+=1)for(var d,f=l.parseUShort(),m=c.parseUShort(),_=u.parseShort(),g=h.parseUShort(),y=m;f>=y;y+=1)0!==g?(p=h.offset+h.relativeOffset-2,p+=g,p+=2*(y-m),0!==(d=s.getUShort(n,p))&&(d=d+_&65535)):d=y+_&65535,t.glyphIndexMap[y]=d}(r,c,t,e,o)}return r},n.make=function(t){var e,n,i=new o.Table("cmap",[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:1},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:12},{name:"format",type:"USHORT",value:4},{name:"length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);for(i.segments=[],e=0;e<t.length;e+=1){for(var s=t.get(e),a=0;a<s.unicodes.length;a+=1)r(i,s.unicodes[a],e);i.segments=i.segments.sort((function(t,e){return t.start-e.start}))}!function(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}(i),n=i.segments.length,i.segCountX2=2*n,i.searchRange=2*Math.pow(2,Math.floor(Math.log(n)/Math.log(2))),i.entrySelector=Math.log(i.searchRange/2)/Math.log(2),i.rangeShift=i.segCountX2-i.searchRange;var l=[],c=[],u=[],h=[],p=[];for(e=0;n>e;e+=1){var d=i.segments[e];l=l.concat({name:"end_"+e,type:"USHORT",value:d.end}),c=c.concat({name:"start_"+e,type:"USHORT",value:d.start}),u=u.concat({name:"idDelta_"+e,type:"SHORT",value:d.delta}),h=h.concat({name:"idRangeOffset_"+e,type:"USHORT",value:d.offset}),void 0!==d.glyphId&&(p=p.concat({name:"glyph_"+e,type:"USHORT",value:d.glyphId}))}return i.fields=i.fields.concat(l),i.fields.push({name:"reservedPad",type:"USHORT",value:0}),i.fields=i.fields.concat(c),i.fields=i.fields.concat(u),i.fields=i.fields.concat(h),i.fields=i.fields.concat(p),i.length=14+2*l.length+2+2*c.length+2*u.length+2*h.length+2*p.length,i}},{"../check":2,"../parse":10,"../table":13}],16:[function(t,e,n){function r(t,e){var n=JSON.stringify(t),r=256;for(var i in e){var s=parseInt(i);if(s&&!(256>s)){if(JSON.stringify(e[i])===n)return s;s>=r&&(r=s+1)}}return e[r]=t,r}function i(t,e,n){var i=r(e.name,n);return[{name:"tag_"+t,type:"TAG",value:e.tag},{name:"minValue_"+t,type:"FIXED",value:e.minValue<<16},{name:"defaultValue_"+t,type:"FIXED",value:e.defaultValue<<16},{name:"maxValue_"+t,type:"FIXED",value:e.maxValue<<16},{name:"flags_"+t,type:"USHORT",value:0},{name:"nameID_"+t,type:"USHORT",value:i}]}function s(t,e,n){var r={},i=new c.Parser(t,e);return r.tag=i.parseTag(),r.minValue=i.parseFixed(),r.defaultValue=i.parseFixed(),r.maxValue=i.parseFixed(),i.skip("uShort",1),r.name=n[i.parseUShort()]||{},r}function o(t,e,n,i){for(var s=[{name:"nameID_"+t,type:"USHORT",value:r(e.name,i)},{name:"flags_"+t,type:"USHORT",value:0}],o=0;o<n.length;++o){var a=n[o].tag;s.push({name:"axis_"+t+" "+a,type:"FIXED",value:e.coordinates[a]<<16})}return s}function a(t,e,n,r){var i={},s=new c.Parser(t,e);i.name=r[s.parseUShort()]||{},s.skip("uShort",1),i.coordinates={};for(var o=0;o<n.length;++o)i.coordinates[n[o].tag]=s.parseFixed();return i}var l=t("../check"),c=t("../parse"),u=t("../table");n.make=function(t,e){var n=new u.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:t.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:t.instances.length},{name:"instanceSize",type:"USHORT",value:4+4*t.axes.length}]);n.offsetToData=n.sizeOf();for(var r=0;r<t.axes.length;r++)n.fields=n.fields.concat(i(r,t.axes[r],e));for(var s=0;s<t.instances.length;s++)n.fields=n.fields.concat(o(s,t.instances[s],t.axes,e));return n},n.parse=function(t,e,n){var r=new c.Parser(t,e),i=r.parseULong();l.argument(65536===i,"Unsupported fvar table version.");var o=r.parseOffset16();r.skip("uShort",1);for(var u=r.parseUShort(),h=r.parseUShort(),p=r.parseUShort(),d=r.parseUShort(),f=[],m=0;u>m;m++)f.push(s(t,e+o+m*h,n));for(var _=[],g=e+o+u*h,y=0;p>y;y++)_.push(a(t,g+y*d,f,n));return{axes:f,instances:_}}},{"../check":2,"../parse":10,"../table":13}],17:[function(t,e,n){function r(t,e,n,r,i){var s;return(e&r)>0?(s=t.parseByte(),0==(e&i)&&(s=-s),s=n+s):s=(e&i)>0?n:n+t.parseShort(),s}function i(t,e,n){var i,s,o=new c.Parser(e,n);if(t.numberOfContours=o.parseShort(),t._xMin=o.parseShort(),t._yMin=o.parseShort(),t._xMax=o.parseShort(),t._yMax=o.parseShort(),t.numberOfContours>0){var l,u=t.endPointIndices=[];for(l=0;l<t.numberOfContours;l+=1)u.push(o.parseUShort());for(t.instructionLength=o.parseUShort(),t.instructions=[],l=0;l<t.instructionLength;l+=1)t.instructions.push(o.parseByte());var h=u[u.length-1]+1;for(i=[],l=0;h>l;l+=1)if(s=o.parseByte(),i.push(s),(8&s)>0)for(var p=o.parseByte(),d=0;p>d;d+=1)i.push(s),l+=1;if(a.argument(i.length===h,"Bad flags."),u.length>0){var f,m=[];if(h>0){for(l=0;h>l;l+=1)s=i[l],(f={}).onCurve=!!(1&s),f.lastPointOfContour=u.indexOf(l)>=0,m.push(f);var _=0;for(l=0;h>l;l+=1)s=i[l],(f=m[l]).x=r(o,s,_,2,16),_=f.x;var g=0;for(l=0;h>l;l+=1)s=i[l],(f=m[l]).y=r(o,s,g,4,32),g=f.y}t.points=m}else t.points=[]}else if(0===t.numberOfContours)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var y=!0;y;){i=o.parseUShort();var v={glyphIndex:o.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(1&i)>0?(2&i)>0?(v.dx=o.parseShort(),v.dy=o.parseShort()):v.matchedPoints=[o.parseUShort(),o.parseUShort()]:(2&i)>0?(v.dx=o.parseChar(),v.dy=o.parseChar()):v.matchedPoints=[o.parseByte(),o.parseByte()],(8&i)>0?v.xScale=v.yScale=o.parseF2Dot14():(64&i)>0?(v.xScale=o.parseF2Dot14(),v.yScale=o.parseF2Dot14()):(128&i)>0&&(v.xScale=o.parseF2Dot14(),v.scale01=o.parseF2Dot14(),v.scale10=o.parseF2Dot14(),v.yScale=o.parseF2Dot14()),t.components.push(v),y=!!(32&i)}}}function s(t,e){for(var n=[],r=0;r<t.length;r+=1){var i=t[r],s={x:e.xScale*i.x+e.scale01*i.y+e.dx,y:e.scale10*i.x+e.yScale*i.y+e.dy,onCurve:i.onCurve,lastPointOfContour:i.lastPointOfContour};n.push(s)}return n}function o(t,e){if(e.isComposite)for(var n=0;n<e.components.length;n+=1){var r=e.components[n],i=t.get(r.glyphIndex);if(i.getPath(),i.points){var o;if(void 0===r.matchedPoints)o=s(i.points,r);else{if(r.matchedPoints[0]>e.points.length-1||r.matchedPoints[1]>i.points.length-1)throw Error("Matched points out of range in "+e.name);var l=e.points[r.matchedPoints[0]],c=i.points[r.matchedPoints[1]],h={xScale:r.xScale,scale01:r.scale01,scale10:r.scale10,yScale:r.yScale,dx:0,dy:0};c=s([c],h)[0],h.dx=l.x-c.x,h.dy=l.y-c.y,o=s(i.points,h)}e.points=e.points.concat(o)}}return function(t){var e=new u.Path;if(!t)return e;for(var n=function(t){for(var e=[],n=[],r=0;r<t.length;r+=1){var i=t[r];n.push(i),i.lastPointOfContour&&(e.push(n),n=[])}return a.argument(0===n.length,"There are still points left in the current contour."),e}(t),r=0;r<n.length;r+=1){var i,s,o=n[r],l=o[0],c=o[o.length-1];l.onCurve?(i=null,s=!0):(i=l=c.onCurve?c:{x:(l.x+c.x)/2,y:(l.y+c.y)/2},s=!1),e.moveTo(l.x,l.y);for(var h=s?1:0;h<o.length;h+=1){var p=o[h],d=0===h?l:o[h-1];if(d.onCurve&&p.onCurve)e.lineTo(p.x,p.y);else if(d.onCurve&&!p.onCurve)i=p;else if(d.onCurve||p.onCurve){if(d.onCurve||!p.onCurve)throw new Error("Invalid state.");e.quadraticCurveTo(i.x,i.y,p.x,p.y),i=null}else{var f={x:(d.x+p.x)/2,y:(d.y+p.y)/2};e.quadraticCurveTo(d.x,d.y,f.x,f.y),i=p}}l!==c&&(i?e.quadraticCurveTo(i.x,i.y,l.x,l.y):e.lineTo(l.x,l.y))}return e.closePath(),e}(e.points)}var a=t("../check"),l=t("../glyphset"),c=t("../parse"),u=t("../path");n.parse=function(t,e,n,r){var s,a=new l.GlyphSet(r);for(s=0;s<n.length-1;s+=1){var c=n[s];c!==n[s+1]?a.push(s,l.ttfGlyphLoader(r,s,i,t,e+c,o)):a.push(s,l.glyphLoader(r,s))}return a}},{"../check":2,"../glyphset":7,"../parse":10,"../path":11}],18:[function(t,e,n){function r(t,e){for(var n=new l.Parser(t,e),r=n.parseUShort(),i=[],s=0;r>s;s++)i[n.parseTag()]={offset:n.parseUShort()};return i}function i(t,e){var n=new l.Parser(t,e),r=n.parseUShort();if(1===r){var i=n.parseUShort(),s=n.parseUShort(),o=n.parseUShortList(s);return function(t){return o[t-i]||0}}if(2===r){for(var a=n.parseUShort(),c=[],u=[],h=[],p=0;a>p;p++)c[p]=n.parseUShort(),u[p]=n.parseUShort(),h[p]=n.parseUShort();return function(t){for(var e=0,n=c.length-1;n>e;){var r=e+n+1>>1;t<c[r]?n=r-1:e=r}return c[e]<=t&&t<=u[e]&&h[e]||0}}}function s(t,e){var n,r=new l.Parser(t,e),s=r.parseUShort(),o=function(t,e){var n=new l.Parser(t,e),r=n.parseUShort(),i=n.parseUShort();if(1===r)return n.parseUShortList(i);if(2===r){for(var s=[];i--;)for(var o=n.parseUShort(),a=n.parseUShort(),c=n.parseUShort(),u=o;a>=u;u++)s[c++]=u;return s}}(t,e+r.parseUShort()),a=r.parseUShort(),c=r.parseUShort();if(4===a&&0===c){var u={};if(1===s){for(var h=r.parseUShort(),p=[],d=r.parseOffset16List(h),f=0;h>f;f++){var m=d[f],_=u[m];if(!_){_={},r.relativeOffset=m;for(var g=r.parseUShort();g--;){var y=r.parseUShort();a&&(n=r.parseShort()),c&&r.parseShort(),_[y]=n}}p[o[f]]=_}return function(t,e){var n=p[t];return n?n[e]:void 0}}if(2===s){for(var v=r.parseUShort(),b=r.parseUShort(),x=r.parseUShort(),w=r.parseUShort(),S=i(t,e+v),M=i(t,e+b),T=[],E=0;x>E;E++)for(var A=T[E]=[],$=0;w>$;$++)a&&(n=r.parseShort()),c&&r.parseShort(),A[$]=n;var C={};for(E=0;E<o.length;E++)C[o[E]]=1;return function(t,e){if(C[t]){var n=S(t),r=M(e),i=T[n];return i?i[r]:void 0}}}}}function o(t,e){var n=new l.Parser(t,e),r=n.parseUShort(),i=n.parseUShort(),o=16&i,a=n.parseUShort(),c=n.parseOffset16List(a),u={lookupType:r,lookupFlag:i,markFilteringSet:o?n.parseUShort():-1};if(2===r){for(var h=[],p=0;a>p;p++)h.push(s(t,e+c[p]));u.getKerningValue=function(t,e){for(var n=h.length;n--;){var r=h[n](t,e);if(void 0!==r)return r}return 0}}return u}var a=t("../check"),l=t("../parse");n.parse=function(t,e,n){var i=new l.Parser(t,e),s=i.parseFixed();a.argument(1===s,"Unsupported GPOS table version."),r(t,e+i.parseUShort()),r(t,e+i.parseUShort());var c=i.parseUShort();i.relativeOffset=c;for(var u=i.parseUShort(),h=i.parseOffset16List(u),p=e+c,d=0;u>d;d++){var f=o(t,p+h[d]);2!==f.lookupType||n.getGposKerningValue||(n.getGposKerningValue=f.getKerningValue)}}},{"../check":2,"../parse":10}],19:[function(t,e,n){var r=t("../check"),i=t("../parse").Parser,s=new Array(9),o=t("../table");s[1]=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();return 1===e?{substFormat:1,coverage:this.parsePointer(i.coverage),deltaGlyphId:this.parseUShort()}:2===e?{substFormat:2,coverage:this.parsePointer(i.coverage),substitute:this.parseOffset16List()}:void r.assert(!1,"0x"+t.toString(16)+": lookup type 1 format must be 1 or 2.")},s[2]=function(){var t=this.parseUShort();return r.argument(1===t,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:t,coverage:this.parsePointer(i.coverage),sequences:this.parseListOfLists()}},s[3]=function(){var t=this.parseUShort();return r.argument(1===t,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:t,coverage:this.parsePointer(i.coverage),alternateSets:this.parseListOfLists()}},s[4]=function(){var t=this.parseUShort();return r.argument(1===t,"GSUB ligature table identifier-format must be 1"),{substFormat:t,coverage:this.parsePointer(i.coverage),ligatureSets:this.parseListOfLists((function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}}))}};var a={sequenceIndex:i.uShort,lookupListIndex:i.uShort};s[5]=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(1===e)return{substFormat:e,coverage:this.parsePointer(i.coverage),ruleSets:this.parseListOfLists((function(){var t=this.parseUShort(),e=this.parseUShort();return{input:this.parseUShortList(t-1),lookupRecords:this.parseRecordList(e,a)}}))};if(2===e)return{substFormat:e,coverage:this.parsePointer(i.coverage),classDef:this.parsePointer(i.classDef),classSets:this.parseListOfLists((function(){var t=this.parseUShort(),e=this.parseUShort();return{classes:this.parseUShortList(t-1),lookupRecords:this.parseRecordList(e,a)}}))};if(3===e){var n=this.parseUShort(),s=this.parseUShort();return{substFormat:e,coverages:this.parseList(n,i.pointer(i.coverage)),lookupRecords:this.parseRecordList(s,a)}}r.assert(!1,"0x"+t.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},s[6]=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();return 1===e?{substFormat:1,coverage:this.parsePointer(i.coverage),chainRuleSets:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(a)}}))}:2===e?{substFormat:2,coverage:this.parsePointer(i.coverage),backtrackClassDef:this.parsePointer(i.classDef),inputClassDef:this.parsePointer(i.classDef),lookaheadClassDef:this.parsePointer(i.classDef),chainClassSet:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(a)}}))}:3===e?{substFormat:3,backtrackCoverage:this.parseList(i.pointer(i.coverage)),inputCoverage:this.parseList(i.pointer(i.coverage)),lookaheadCoverage:this.parseList(i.pointer(i.coverage)),lookupRecords:this.parseRecordList(a)}:void r.assert(!1,"0x"+t.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},s[7]=function(){var t=this.parseUShort();r.argument(1===t,"GSUB Extension Substitution subtable identifier-format must be 1");var e=this.parseUShort(),n=new i(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:e,extension:s[e].call(n)}},s[8]=function(){var t=this.parseUShort();return r.argument(1===t,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:t,coverage:this.parsePointer(i.coverage),backtrackCoverage:this.parseList(i.pointer(i.coverage)),lookaheadCoverage:this.parseList(i.pointer(i.coverage)),substitutes:this.parseUShortList()}};var l=new Array(9);l[1]=function(t){return 1===t.substFormat?new o.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new o.Coverage(t.coverage)},{name:"deltaGlyphID",type:"USHORT",value:t.deltaGlyphId}]):new o.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new o.Coverage(t.coverage)}].concat(o.ushortList("substitute",t.substitute)))},l[3]=function(t){return r.assert(1===t.substFormat,"Lookup type 3 substFormat must be 1."),new o.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new o.Coverage(t.coverage)}].concat(o.tableList("altSet",t.alternateSets,(function(t){return new o.Table("alternateSetTable",o.ushortList("alternate",t))}))))},l[4]=function(t){return r.assert(1===t.substFormat,"Lookup type 4 substFormat must be 1."),new o.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new o.Coverage(t.coverage)}].concat(o.tableList("ligSet",t.ligatureSets,(function(t){return new o.Table("ligatureSetTable",o.tableList("ligature",t,(function(t){return new o.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:t.ligGlyph}].concat(o.ushortList("component",t.components,t.components.length+1)))})))}))))},n.parse=function(t,e){var n=new i(t,e=e||0),o=n.parseVersion();return r.argument(1===o,"Unsupported GSUB table version."),{version:o,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(s)}},n.make=function(t){return new o.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new o.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new o.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new o.LookupList(t.lookups,l)}])}},{"../check":2,"../parse":10,"../table":13}],20:[function(t,e,n){var r=t("../check"),i=t("../parse"),s=t("../table");n.parse=function(t,e){var n={},s=new i.Parser(t,e);return n.version=s.parseVersion(),n.fontRevision=Math.round(1e3*s.parseFixed())/1e3,n.checkSumAdjustment=s.parseULong(),n.magicNumber=s.parseULong(),r.argument(1594834165===n.magicNumber,"Font header has wrong magic number."),n.flags=s.parseUShort(),n.unitsPerEm=s.parseUShort(),n.created=s.parseLongDateTime(),n.modified=s.parseLongDateTime(),n.xMin=s.parseShort(),n.yMin=s.parseShort(),n.xMax=s.parseShort(),n.yMax=s.parseShort(),n.macStyle=s.parseUShort(),n.lowestRecPPEM=s.parseUShort(),n.fontDirectionHint=s.parseShort(),n.indexToLocFormat=s.parseShort(),n.glyphDataFormat=s.parseShort(),n},n.make=function(t){var e=Math.round((new Date).getTime()/1e3)+2082844800,n=e;return t.createdTimestamp&&(n=t.createdTimestamp+2082844800),new s.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:n},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}},{"../check":2,"../parse":10,"../table":13}],21:[function(t,e,n){var r=t("../parse"),i=t("../table");n.parse=function(t,e){var n={},i=new r.Parser(t,e);return n.version=i.parseVersion(),n.ascender=i.parseShort(),n.descender=i.parseShort(),n.lineGap=i.parseShort(),n.advanceWidthMax=i.parseUShort(),n.minLeftSideBearing=i.parseShort(),n.minRightSideBearing=i.parseShort(),n.xMaxExtent=i.parseShort(),n.caretSlopeRise=i.parseShort(),n.caretSlopeRun=i.parseShort(),n.caretOffset=i.parseShort(),i.relativeOffset+=8,n.metricDataFormat=i.parseShort(),n.numberOfHMetrics=i.parseUShort(),n},n.make=function(t){return new i.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}},{"../parse":10,"../table":13}],22:[function(t,e,n){var r=t("../parse"),i=t("../table");n.parse=function(t,e,n,i,s){for(var o,a,l=new r.Parser(t,e),c=0;i>c;c+=1){n>c&&(o=l.parseUShort(),a=l.parseShort());var u=s.get(c);u.advanceWidth=o,u.leftSideBearing=a}},n.make=function(t){for(var e=new i.Table("hmtx",[]),n=0;n<t.length;n+=1){var r=t.get(n),s=r.advanceWidth||0,o=r.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+n,type:"USHORT",value:s}),e.fields.push({name:"leftSideBearing_"+n,type:"SHORT",value:o})}return e}},{"../parse":10,"../table":13}],23:[function(t,e,n){var r=t("../check"),i=t("../parse");n.parse=function(t,e){var n={},s=new i.Parser(t,e),o=s.parseUShort();r.argument(0===o,"Unsupported kern table version."),s.skip("uShort",1);var a=s.parseUShort();r.argument(0===a,"Unsupported kern sub-table version."),s.skip("uShort",2);var l=s.parseUShort();s.skip("uShort",3);for(var c=0;l>c;c+=1){var u=s.parseUShort(),h=s.parseUShort(),p=s.parseShort();n[u+","+h]=p}return n}},{"../check":2,"../parse":10}],24:[function(t,e,n){var r=t("../parse");n.parse=function(t,e,n,i){for(var s=new r.Parser(t,e),o=i?s.parseUShort:s.parseULong,a=[],l=0;n+1>l;l+=1){var c=o.call(s);i&&(c*=2),a.push(c)}return a}},{"../parse":10}],25:[function(t,e,n){var r=t("../check"),i=t("../parse"),s=t("../table");n.make=function(t){for(var e=new s.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),n="",r=12+4*t.length,i=0;i<t.length;++i){var o=n.indexOf(t[i]);0>o&&(o=n.length,n+=t[i]),e.fields.push({name:"offset "+i,type:"USHORT",value:r+o}),e.fields.push({name:"length "+i,type:"USHORT",value:t[i].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:n}),e},n.parse=function(t,e){var n=new i.Parser(t,e),s=n.parseULong();r.argument(1===s,"Unsupported ltag table version."),n.skip("uLong",1);for(var o=n.parseULong(),a=[],l=0;o>l;l++){for(var c="",u=e+n.parseUShort(),h=n.parseUShort(),p=u;u+h>p;++p)c+=String.fromCharCode(t.getInt8(p));a.push(c)}return a}},{"../check":2,"../parse":10,"../table":13}],26:[function(t,e,n){var r=t("../parse"),i=t("../table");n.parse=function(t,e){var n={},i=new r.Parser(t,e);return n.version=i.parseVersion(),n.numGlyphs=i.parseUShort(),1===n.version&&(n.maxPoints=i.parseUShort(),n.maxContours=i.parseUShort(),n.maxCompositePoints=i.parseUShort(),n.maxCompositeContours=i.parseUShort(),n.maxZones=i.parseUShort(),n.maxTwilightPoints=i.parseUShort(),n.maxStorage=i.parseUShort(),n.maxFunctionDefs=i.parseUShort(),n.maxInstructionDefs=i.parseUShort(),n.maxStackElements=i.parseUShort(),n.maxSizeOfInstructions=i.parseUShort(),n.maxComponentElements=i.parseUShort(),n.maxComponentDepth=i.parseUShort()),n},n.make=function(t){return new i.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}},{"../parse":10,"../table":13}],27:[function(t,e,n){var r=t("../types").decode,i=t("../check"),s=t("../parse"),o=t("../table");n.parse=function(t,e){var n=new s.Parser(t,e),o=n.parseULong();i.argument(1===o,"Unsupported META table version."),n.parseULong(),n.parseULong();for(var a=n.parseULong(),l={},c=0;a>c;c++){var u=n.parseTag(),h=n.parseULong(),p=n.parseULong(),d=r.UTF8(t,e+h,p);l[u]=d}return l},n.make=function(t){var e=Object.keys(t).length,n="",r=16+12*e,i=new o.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:r},{name:"numTags",type:"ULONG",value:e}]);for(var s in t){var a=n.length;n+=t[s],i.fields.push({name:"tag "+s,type:"TAG",value:s}),i.fields.push({name:"offset "+s,type:"ULONG",value:r+a}),i.fields.push({name:"length "+s,type:"ULONG",value:t[s].length})}return i.fields.push({name:"stringPool",type:"CHARARRAY",value:n}),i}},{"../check":2,"../parse":10,"../table":13,"../types":32}],28:[function(t,e,n){function r(t,e,n){switch(t){case 0:if(65535===e)return"und";if(n)return n[e];break;case 1:return f[e];case 3:return _[e]}}function i(t,e,n){switch(t){case 0:return g;case 1:return v[n]||y[e];case 3:if(1===e||10===e)return g}}function s(t){var e={};for(var n in t)e[t[n]]=parseInt(n);return e}function o(t,e,n,r,i,s){return new p.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:n},{name:"nameID",type:"USHORT",value:r},{name:"length",type:"USHORT",value:i},{name:"offset",type:"USHORT",value:s}])}function a(t,e){var n=function(t,e){var n=t.length,r=e.length-n+1;t:for(var i=0;r>i;i++)for(;r>i;i++){for(var s=0;n>s;s++)if(e[i+s]!==t[s])continue t;return i}return-1}(t,e);if(0>n){n=e.length;for(var r=0,i=t.length;i>r;++r)e.push(t[r])}return n}var l=t("../types"),c=l.decode,u=l.encode,h=t("../parse"),p=t("../table"),d=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],f={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},m={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},_={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"},g="utf-16",y={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},v={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};n.parse=function(t,e,n){for(var s={},o=new h.Parser(t,e),a=o.parseUShort(),l=o.parseUShort(),u=o.offset+o.parseUShort(),p=0;l>p;p++){var f,m=o.parseUShort(),_=o.parseUShort(),y=o.parseUShort(),v=o.parseUShort(),b=d[v]||v,x=o.parseUShort(),w=o.parseUShort(),S=r(m,y,n),M=i(m,_,y);if(void 0!==M&&void 0!==S&&(f=M===g?c.UTF16(t,u+w,x):c.MACSTRING(t,u+w,x,M))){var T=s[b];void 0===T&&(T=s[b]={}),T[S]=f}}return 1===a&&o.parseUShort(),s},n.make=function(t,e){var n,r=[],l={},c=s(d);for(var h in t){var g=c[h];if(void 0===g&&(g=h),n=parseInt(g),isNaN(n))throw new Error('Name table entry "'+h+'" does not exist, see nameTableNames for complete list.');l[n]=t[h],r.push(n)}for(var y=s(f),v=s(_),b=[],x=[],w=0;w<r.length;w++){var S=l[n=r[w]];for(var M in S){var T=S[M],E=1,A=y[M],$=m[A],C=i(E,$,A),B=u.MACSTRING(T,C);void 0===B&&(E=0,0>(A=e.indexOf(M))&&(A=e.length,e.push(M)),$=4,B=u.UTF16(T));var L=a(B,x);b.push(o(E,$,A,n,B.length,L));var R=v[M];if(void 0!==R){var N=u.UTF16(T),P=a(N,x);b.push(o(3,1,R,n,N.length,P))}}}b.sort((function(t,e){return t.platformID-e.platformID||t.encodingID-e.encodingID||t.languageID-e.languageID||t.nameID-e.nameID}));for(var I=new p.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:b.length},{name:"stringOffset",type:"USHORT",value:6+12*b.length}]),O=0;O<b.length;O++)I.fields.push({name:"record_"+O,type:"RECORD",value:b[O]});return I.fields.push({name:"strings",type:"LITERAL",value:x}),I}},{"../parse":10,"../table":13,"../types":32}],29:[function(t,e,n){var r=t("../parse"),i=t("../table"),s=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];n.unicodeRanges=s,n.getUnicodeRange=function(t){for(var e=0;e<s.length;e+=1){var n=s[e];if(t>=n.begin&&t<n.end)return e}return-1},n.parse=function(t,e){var n={},i=new r.Parser(t,e);n.version=i.parseUShort(),n.xAvgCharWidth=i.parseShort(),n.usWeightClass=i.parseUShort(),n.usWidthClass=i.parseUShort(),n.fsType=i.parseUShort(),n.ySubscriptXSize=i.parseShort(),n.ySubscriptYSize=i.parseShort(),n.ySubscriptXOffset=i.parseShort(),n.ySubscriptYOffset=i.parseShort(),n.ySuperscriptXSize=i.parseShort(),n.ySuperscriptYSize=i.parseShort(),n.ySuperscriptXOffset=i.parseShort(),n.ySuperscriptYOffset=i.parseShort(),n.yStrikeoutSize=i.parseShort(),n.yStrikeoutPosition=i.parseShort(),n.sFamilyClass=i.parseShort(),n.panose=[];for(var s=0;10>s;s++)n.panose[s]=i.parseByte();return n.ulUnicodeRange1=i.parseULong(),n.ulUnicodeRange2=i.parseULong(),n.ulUnicodeRange3=i.parseULong(),n.ulUnicodeRange4=i.parseULong(),n.achVendID=String.fromCharCode(i.parseByte(),i.parseByte(),i.parseByte(),i.parseByte()),n.fsSelection=i.parseUShort(),n.usFirstCharIndex=i.parseUShort(),n.usLastCharIndex=i.parseUShort(),n.sTypoAscender=i.parseShort(),n.sTypoDescender=i.parseShort(),n.sTypoLineGap=i.parseShort(),n.usWinAscent=i.parseUShort(),n.usWinDescent=i.parseUShort(),n.version>=1&&(n.ulCodePageRange1=i.parseULong(),n.ulCodePageRange2=i.parseULong()),n.version>=2&&(n.sxHeight=i.parseShort(),n.sCapHeight=i.parseShort(),n.usDefaultChar=i.parseUShort(),n.usBreakChar=i.parseUShort(),n.usMaxContent=i.parseUShort()),n},n.make=function(t){return new i.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}},{"../parse":10,"../table":13}],30:[function(t,e,n){var r=t("../encoding"),i=t("../parse"),s=t("../table");n.parse=function(t,e){var n,s={},o=new i.Parser(t,e);switch(s.version=o.parseVersion(),s.italicAngle=o.parseFixed(),s.underlinePosition=o.parseShort(),s.underlineThickness=o.parseShort(),s.isFixedPitch=o.parseULong(),s.minMemType42=o.parseULong(),s.maxMemType42=o.parseULong(),s.minMemType1=o.parseULong(),s.maxMemType1=o.parseULong(),s.version){case 1:s.names=r.standardNames.slice();break;case 2:for(s.numberOfGlyphs=o.parseUShort(),s.glyphNameIndex=new Array(s.numberOfGlyphs),n=0;n<s.numberOfGlyphs;n++)s.glyphNameIndex[n]=o.parseUShort();for(s.names=[],n=0;n<s.numberOfGlyphs;n++)if(s.glyphNameIndex[n]>=r.standardNames.length){var a=o.parseChar();s.names.push(o.parseString(a))}break;case 2.5:for(s.numberOfGlyphs=o.parseUShort(),s.offset=new Array(s.numberOfGlyphs),n=0;n<s.numberOfGlyphs;n++)s.offset[n]=o.parseChar()}return s},n.make=function(){return new s.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}},{"../encoding":4,"../parse":10,"../table":13}],31:[function(t,e,n){function r(t){return Math.log(t)/Math.log(2)|0}function i(t){for(;t.length%4!=0;)t.push(0);for(var e=0,n=0;n<t.length;n+=4)e+=(t[n]<<24)+(t[n+1]<<16)+(t[n+2]<<8)+t[n+3];return e%Math.pow(2,32)}function s(t,e,n,r){return new u.Record("Table Record",[{name:"tag",type:"TAG",value:void 0!==t?t:""},{name:"checkSum",type:"ULONG",value:void 0!==e?e:0},{name:"offset",type:"ULONG",value:void 0!==n?n:0},{name:"length",type:"ULONG",value:void 0!==r?r:0}])}function o(t){var e=new u.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var n=Math.pow(2,r(e.numTables));e.searchRange=16*n,e.entrySelector=r(n),e.rangeShift=16*e.numTables-e.searchRange;for(var o=[],a=[],l=e.sizeOf()+s().sizeOf()*e.numTables;l%4!=0;)l+=1,a.push({name:"padding",type:"BYTE",value:0});for(var h=0;h<t.length;h+=1){var p=t[h];c.argument(4===p.tableName.length,"Table name"+p.tableName+" is invalid.");var d=p.sizeOf(),f=s(p.tableName,i(p.encode()),l,d);for(o.push({name:f.tag+" Table Record",type:"RECORD",value:f}),a.push({name:p.tableName+" table",type:"RECORD",value:p}),l+=d,c.argument(!isNaN(l),"Something went wrong calculating the offset.");l%4!=0;)l+=1,a.push({name:"padding",type:"BYTE",value:0})}return o.sort((function(t,e){return t.value.tag>e.value.tag?1:-1})),e.fields=e.fields.concat(o),e.fields=e.fields.concat(a),e}function a(t,e,n){for(var r=0;r<e.length;r+=1){var i=t.charToGlyphIndex(e[r]);if(i>0)return t.glyphs.get(i).getMetrics()}return n}function l(t){for(var e=0,n=0;n<t.length;n+=1)e+=t[n];return e/t.length}var c=t("../check"),u=t("../table"),h=t("./cmap"),p=t("./cff"),d=t("./head"),f=t("./hhea"),m=t("./hmtx"),_=t("./ltag"),g=t("./maxp"),y=t("./name"),v=t("./os2"),b=t("./post"),x=t("./gsub"),w=t("./meta");n.computeCheckSum=i,n.make=o,n.fontToTable=function(t){for(var e,n=[],r=[],s=[],c=[],u=[],S=[],M=[],T=0,E=0,A=0,$=0,C=0,B=0;B<t.glyphs.length;B+=1){var L=t.glyphs.get(B),R=0|L.unicode;if(isNaN(L.advanceWidth))throw new Error("Glyph "+L.name+" ("+B+"): advanceWidth is not a number.");(e>R||void 0===e)&&R>0&&(e=R),R>T&&(T=R);var N=v.getUnicodeRange(R);if(32>N)E|=1<<N;else if(64>N)A|=1<<N-32;else if(96>N)$|=1<<N-64;else{if(!(123>N))throw new Error("Unicode ranges bits > 123 are reserved for internal usage");C|=1<<N-96}if(".notdef"!==L.name){var P=L.getMetrics();n.push(P.xMin),r.push(P.yMin),s.push(P.xMax),c.push(P.yMax),S.push(P.leftSideBearing),M.push(P.rightSideBearing),u.push(L.advanceWidth)}}var I={xMin:Math.min.apply(null,n),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,s),yMax:Math.max.apply(null,c),advanceWidthMax:Math.max.apply(null,u),advanceWidthAvg:l(u),minLeftSideBearing:Math.min.apply(null,S),maxLeftSideBearing:Math.max.apply(null,S),minRightSideBearing:Math.min.apply(null,M)};I.ascender=t.ascender,I.descender=t.descender;var O=d.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:I.xMin,yMin:I.yMin,xMax:I.xMax,yMax:I.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),F=f.make({ascender:I.ascender,descender:I.descender,advanceWidthMax:I.advanceWidthMax,minLeftSideBearing:I.minLeftSideBearing,minRightSideBearing:I.minRightSideBearing,xMaxExtent:I.maxLeftSideBearing+(I.xMax-I.xMin),numberOfHMetrics:t.glyphs.length}),k=g.make(t.glyphs.length),D=v.make({xAvgCharWidth:Math.round(I.advanceWidthAvg),usWeightClass:t.tables.os2.usWeightClass,usWidthClass:t.tables.os2.usWidthClass,usFirstCharIndex:e,usLastCharIndex:T,ulUnicodeRange1:E,ulUnicodeRange2:A,ulUnicodeRange3:$,ulUnicodeRange4:C,fsSelection:t.tables.os2.fsSelection,sTypoAscender:I.ascender,sTypoDescender:I.descender,sTypoLineGap:0,usWinAscent:I.yMax,usWinDescent:Math.abs(I.yMin),ulCodePageRange1:1,sxHeight:a(t,"xyvw",{yMax:Math.round(I.ascender/2)}).yMax,sCapHeight:a(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",I).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0}),U=m.make(t.glyphs),z=h.make(t.glyphs),j=t.getEnglishName("fontFamily"),G=t.getEnglishName("fontSubfamily"),H=j+" "+G,V=t.getEnglishName("postScriptName");V||(V=j.replace(/\s/g,"")+"-"+G);var W={};for(var q in t.names)W[q]=t.names[q];W.uniqueID||(W.uniqueID={en:t.getEnglishName("manufacturer")+":"+H}),W.postScriptName||(W.postScriptName={en:V}),W.preferredFamily||(W.preferredFamily=t.names.fontFamily),W.preferredSubfamily||(W.preferredSubfamily=t.names.fontSubfamily);var X=[],Y=y.make(W,X),J=X.length>0?_.make(X):void 0,Z=b.make(),Q=p.make(t.glyphs,{version:t.getEnglishName("version"),fullName:H,familyName:j,weightName:G,postScriptName:V,unitsPerEm:t.unitsPerEm,fontBBox:[0,I.yMin,I.ascender,I.advanceWidthMax]}),K=t.metas&&Object.keys(t.metas).length>0?w.make(t.metas):void 0,tt=[O,F,k,D,Y,z,Z,Q,U];J&&tt.push(J),t.tables.gsub&&tt.push(x.make(t.tables.gsub)),K&&tt.push(K);var et=o(tt),nt=i(et.encode()),rt=et.fields,it=!1;for(B=0;B<rt.length;B+=1)if("head table"===rt[B].name){rt[B].value.checkSumAdjustment=2981146554-nt,it=!0;break}if(!it)throw new Error("Could not find head table with checkSum to adjust.");return et}},{"../check":2,"../table":13,"./cff":14,"./cmap":15,"./gsub":19,"./head":20,"./hhea":21,"./hmtx":22,"./ltag":25,"./maxp":26,"./meta":27,"./name":28,"./os2":29,"./post":30}],32:[function(t,e,n){function r(t){return function(){return t}}var i=t("./check"),s=2147483648,o={},a={},l={};a.BYTE=function(t){return i.argument(t>=0&&255>=t,"Byte value should be between 0 and 255."),[t]},l.BYTE=r(1),a.CHAR=function(t){return[t.charCodeAt(0)]},l.CHAR=r(1),a.CHARARRAY=function(t){for(var e=[],n=0;n<t.length;n+=1)e[n]=t.charCodeAt(n);return e},l.CHARARRAY=function(t){return t.length},a.USHORT=function(t){return[t>>8&255,255&t]},l.USHORT=r(2),a.SHORT=function(t){return t>=32768&&(t=-(65536-t)),[t>>8&255,255&t]},l.SHORT=r(2),a.UINT24=function(t){return[t>>16&255,t>>8&255,255&t]},l.UINT24=r(3),a.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]},l.ULONG=r(4),a.LONG=function(t){return t>=s&&(t=-(2*s-t)),[t>>24&255,t>>16&255,t>>8&255,255&t]},l.LONG=r(4),a.FIXED=a.ULONG,l.FIXED=l.ULONG,a.FWORD=a.SHORT,l.FWORD=l.SHORT,a.UFWORD=a.USHORT,l.UFWORD=l.USHORT,a.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t]},l.LONGDATETIME=r(8),a.TAG=function(t){return i.argument(4===t.length,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]},l.TAG=r(4),a.Card8=a.BYTE,l.Card8=l.BYTE,a.Card16=a.USHORT,l.Card16=l.USHORT,a.OffSize=a.BYTE,l.OffSize=l.BYTE,a.SID=a.USHORT,l.SID=l.USHORT,a.NUMBER=function(t){return t>=-107&&107>=t?[t+139]:t>=108&&1131>=t?[247+((t-=108)>>8),255&t]:t>=-1131&&-108>=t?[251+((t=-t-108)>>8),255&t]:t>=-32768&&32767>=t?a.NUMBER16(t):a.NUMBER32(t)},l.NUMBER=function(t){return a.NUMBER(t).length},a.NUMBER16=function(t){return[28,t>>8&255,255&t]},l.NUMBER16=r(3),a.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,255&t]},l.NUMBER32=r(5),a.REAL=function(t){var e=t.toString(),n=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(n){var r=parseFloat("1e"+((n[2]?+n[2]:0)+n[1].length));e=(Math.round(t*r)/r).toString()}var i,s,o="";for(i=0,s=e.length;s>i;i+=1){var a=e[i];o+="e"===a?"-"===e[++i]?"c":"b":"."===a?"a":"-"===a?"e":a}var l=[30];for(i=0,s=(o+=1&o.length?"f":"ff").length;s>i;i+=2)l.push(parseInt(o.substr(i,2),16));return l},l.REAL=function(t){return a.REAL(t).length},a.NAME=a.CHARARRAY,l.NAME=l.CHARARRAY,a.STRING=a.CHARARRAY,l.STRING=l.CHARARRAY,o.UTF8=function(t,e,n){for(var r=[],i=n,s=0;i>s;s++,e+=1)r[s]=t.getUint8(e);return String.fromCharCode.apply(null,r)},o.UTF16=function(t,e,n){for(var r=[],i=n/2,s=0;i>s;s++,e+=2)r[s]=t.getUint16(e);return String.fromCharCode.apply(null,r)},a.UTF16=function(t){for(var e=[],n=0;n<t.length;n+=1){var r=t.charCodeAt(n);e[e.length]=r>>8&255,e[e.length]=255&r}return e},l.UTF16=function(t){return 2*t.length};var c={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};o.MACSTRING=function(t,e,n,r){var i=c[r];if(void 0!==i){for(var s="",o=0;n>o;o++){var a=t.getUint8(e+o);s+=127>=a?String.fromCharCode(a):i[127&a]}return s}};var u,h="function"==typeof WeakMap&&new WeakMap;a.MACSTRING=function(t,e){var n=function(t){if(!u)for(var e in u={},c)u[e]=new String(e);var n=u[t];if(void 0!==n){if(h){var r=h.get(n);if(void 0!==r)return r}var i=c[t];if(void 0!==i){for(var s={},o=0;o<i.length;o++)s[i.charCodeAt(o)]=o+128;return h&&h.set(n,s),s}}}(e);if(void 0!==n){for(var r=[],i=0;i<t.length;i++){var s=t.charCodeAt(i);if(s>=128&&void 0===(s=n[s]))return;r[i]=s}return r}},l.MACSTRING=function(t,e){var n=a.MACSTRING(t,e);return void 0!==n?n.length:0},a.INDEX=function(t){var e,n=1,r=[n],i=[];for(e=0;e<t.length;e+=1){var s=a.OBJECT(t[e]);Array.prototype.push.apply(i,s),n+=s.length,r.push(n)}if(0===i.length)return[0,0];var o=[],l=1+Math.floor(Math.log(n)/Math.log(2))/8|0,c=[void 0,a.BYTE,a.USHORT,a.UINT24,a.ULONG][l];for(e=0;e<r.length;e+=1){var u=c(r[e]);Array.prototype.push.apply(o,u)}return Array.prototype.concat(a.Card16(t.length),a.OffSize(l),o,i)},l.INDEX=function(t){return a.INDEX(t).length},a.DICT=function(t){for(var e=[],n=Object.keys(t),r=n.length,i=0;r>i;i+=1){var s=parseInt(n[i],0),o=t[s];e=(e=e.concat(a.OPERAND(o.value,o.type))).concat(a.OPERATOR(s))}return e},l.DICT=function(t){return a.DICT(t).length},a.OPERATOR=function(t){return 1200>t?[t]:[12,t-1200]},a.OPERAND=function(t,e){var n=[];if(Array.isArray(e))for(var r=0;r<e.length;r+=1)i.argument(t.length===e.length,"Not enough arguments given for type"+e),n=n.concat(a.OPERAND(t[r],e[r]));else if("SID"===e)n=n.concat(a.NUMBER(t));else if("offset"===e)n=n.concat(a.NUMBER32(t));else if("number"===e)n=n.concat(a.NUMBER(t));else{if("real"!==e)throw new Error("Unknown operand type "+e);n=n.concat(a.REAL(t))}return n},a.OP=a.BYTE,l.OP=l.BYTE;var p="function"==typeof WeakMap&&new WeakMap;a.CHARSTRING=function(t){if(p){var e=p.get(t);if(void 0!==e)return e}for(var n=[],r=t.length,i=0;r>i;i+=1){var s=t[i];n=n.concat(a[s.type](s.value))}return p&&p.set(t,n),n},l.CHARSTRING=function(t){return a.CHARSTRING(t).length},a.OBJECT=function(t){var e=a[t.type];return i.argument(void 0!==e,"No encoding function for type "+t.type),e(t.value)},l.OBJECT=function(t){var e=l[t.type];return i.argument(void 0!==e,"No sizeOf function for type "+t.type),e(t.value)},a.TABLE=function(t){var e,n=[],r=t.fields.length,s=[],o=[];for(e=0;r>e;e+=1){var l=t.fields[e],c=a[l.type];i.argument(void 0!==c,"No encoding function for field type "+l.type+" ("+l.name+")");var u=t[l.name];void 0===u&&(u=l.value);var h=c(u);"TABLE"===l.type?(o.push(n.length),n=n.concat([0,0]),s.push(h)):n=n.concat(h)}for(e=0;e<s.length;e+=1){var p=o[e],d=n.length;i.argument(65536>d,"Table "+t.tableName+" too big."),n[p]=d>>8,n[p+1]=255&d,n=n.concat(s[e])}return n},l.TABLE=function(t){for(var e=0,n=t.fields.length,r=0;n>r;r+=1){var s=t.fields[r],o=l[s.type];i.argument(void 0!==o,"No sizeOf function for field type "+s.type+" ("+s.name+")");var a=t[s.name];void 0===a&&(a=s.value),e+=o(a),"TABLE"===s.type&&(e+=2)}return e},a.RECORD=a.TABLE,l.RECORD=l.TABLE,a.LITERAL=function(t){return t},l.LITERAL=function(t){return t.length},n.decode=o,n.encode=a,n.sizeOf=l},{"./check":2}],33:[function(t,e,n){n.isBrowser=function(){return"undefined"!=typeof window},n.isNode=function(){return"undefined"==typeof window},n.nodeBufferToArrayBuffer=function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0;r<t.length;++r)n[r]=t[r];return e},n.arrayBufferToNodeBuffer=function(t){for(var e=new Buffer(t.byteLength),n=new Uint8Array(t),r=0;r<e.length;++r)e[r]=n[r];return e},n.checkArgument=function(t,e){if(!t)throw e}},{}]},{},[9])(9)}));var r=window.opentype},408:t=>{var e=/\n/,n="\n",r=/\s/;function i(t,e,n,r){var i=t.indexOf(e,n);return-1===i||i>r?r:i}function s(t){return r.test(t)}function o(t,e,n,r){return{start:e,end:e+Math.min(r,n-e)}}t.exports=function(e,n){return t.exports.lines(e,n).map((function(t){return e.substring(t.start,t.end)})).join("\n")},t.exports.lines=function(t,r){if(0===(r=r||{}).width&&"nowrap"!==r.mode)return[];t=t||"";var a="number"==typeof r.width?r.width:Number.MAX_VALUE,l=Math.max(0,r.start||0),c="number"==typeof r.end?r.end:t.length,u=r.mode,h=r.measure||o;return"pre"===u?function(t,n,r,i,s){for(var o=[],a=r,l=r;l<i&&l<n.length;l++){var c=n.charAt(l),u=e.test(c);if(u||l===i-1){var h=t(n,a,u?l:l+1,s);o.push(h),a=l+1}}return o}(h,t,l,c,a):function(t,e,r,o,a,l){var c=[],u=a;for("nowrap"===l&&(u=Number.MAX_VALUE);r<o&&r<e.length;){for(var h=i(e,n,r,o);r<h&&s(e.charAt(r));)r++;var p=t(e,r,h,u),d=r+(p.end-p.start),f=d+n.length;if(d<h){for(;d>r&&!s(e.charAt(d));)d--;if(d===r)f>r+n.length&&f--,d=f;else for(f=d;d>r&&s(e.charAt(d-n.length));)d--}if(d>=r){var m=t(e,r,d,u);c.push(m)}r=f}return c}(h,t,l,c,a,u)}},720:t=>{t.exports=function(){for(var t={},n=0;n<arguments.length;n++){var r=arguments[n];for(var i in r)e.call(r,i)&&(t[i]=r[i])}return t};var e=Object.prototype.hasOwnProperty},500:(t,e,n)=>{var r=n(412);r.KeyframeTrack.prototype.color="#FF0000",r.KeyframeTrack.prototype.setColor=function(t){this.color=t},r.KeyframeTrack.prototype.sort=function(){for(var t=0;t<this.times.length;t++)for(var e=t+1;e<this.times.length;e++)if(this.times[t]>this.times[e]){var n=this.times[e];this.times[e]=this.times[t],this.times[t]=n;for(var r=this.getValueSize(),i=e*r,s=t*r,o=0;o<r;o++)n=this.values[i+o],this.values[i+o]=this.values[s+o],this.values[s+o]=n}},r.KeyframeTrack._toJSON=r.KeyframeTrack.toJSON,r.KeyframeTrack.toJSON=function(t){var e=r.KeyframeTrack._toJSON.call(this,t);return e.color=t.color,e},r.KeyframeTrack._parse=r.KeyframeTrack.parse,r.KeyframeTrack.parse=function(t){var e=r.KeyframeTrack._parse.call(this,t);return void 0!==t.color&&(e.color=t.color),e}},10:(t,e,n)=>{n(412).Camera.prototype.render=function(t,e){t.render(e,this)}},939:(t,e,n)=>{n(412).BufferAttribute.prototype.toJSON=function(){return{type:"BufferAttribute",typedArray:{type:this.array.constructor.name,array:Array.prototype.slice.call(this.array)},itemSize:this.itemSize,normalized:this.normalized}}},12:(t,e,n)=>{n(412).InterleavedBuffer.prototype.toJSON=function(){return{typedArray:{type:this.array.constructor.name,array:Array.prototype.slice.call(this.array)},stride:this.stride,count:this.count,usage:this.usage}}},443:(t,e,n)=>{n(412).InterleavedBufferAttribute.prototype.toJSON=function(){return{type:"InterleavedBufferAttribute",data:this.data.toJSON(),itemSize:this.itemSize,offset:this.offset,normalized:this.normalized}}},870:(t,e,n)=>{var r=n(412);r.LightShadow.prototype.toJSON=function(){var t={};return t.bias=this.bias,t.radius=this.radius,t.mapSize={x:this.mapSize.x,y:this.mapSize.y},t.camera={top:this.camera.top,bottom:this.camera.bottom,far:this.camera.far,near:this.camera.near,left:this.camera.left,right:this.camera.right},t},r.LightShadow.prototype.fromJSON=function(t){if(void 0!==t.bias&&(this.bias=t.bias),void 0!==t.radius&&(this.radius=t.radius),void 0!==t.mapSize){var e=t.mapSize;this.mapSize.set(e.x,e.y)}if(void 0!==t.camera){var n=t.camera;this.camera.top=n.top,this.camera.bottom=n.bottom,this.camera.left=n.left,this.camera.right=n.right,this.camera.near=n.near,this.camera.far=n.far}}},819:(t,e,n)=>{var r=n(412);r.Fog.NONE=0,r.Fog.LINEAR=1,r.Fog.EXPONENTIAL=2}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var n=__webpack_module_cache__[t]={id:t,loaded:!1,exports:{}};return __webpack_modules__[t].call(n.exports,n,n.exports,__webpack_require__),n.loaded=!0,n.exports}__webpack_require__.amdO={},__webpack_require__.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ARHandler:()=>$c,AdaptiveToneMappingPass:()=>Hs,AfterimagePass:()=>zs,AmbientLight:()=>Zi,AnimationMixer:()=>Lc,AnimationTimer:()=>Uu,App:()=>Ec,ArraybufferUtils:()=>Vi,Audio:()=>yo,AudioEmitter:()=>Qi,AudioLoader:()=>Kl,Base64Utils:()=>Hi,BloomPass:()=>Fs,BokehPass:()=>Is,BufferUtils:()=>Wi,CSS3DObject:()=>Ys,CSS3DRenderer:()=>Wc,CSS3DSprite:()=>qc,CanvasSprite:()=>Ul,CanvasTexture:()=>Dl,CapsuleBufferGeometry:()=>Xl,ColorifyPass:()=>Ns,CompressedTexture:()=>sc,CopyPass:()=>Ls,CubeCamera:()=>ts,CubeTexture:()=>Ki,DataTexture:()=>ic,DirectionalLight:()=>es,DotScreenPass:()=>Bs,EffectComposer:()=>Vs,EventManager:()=>ji,FXAAPass:()=>Ds,FileSystem:()=>qi,FilmPass:()=>$s,FirstPersonControls:()=>qs,Font:()=>_o,FontLoader:()=>Ql,Gamepad:()=>Hc,GeometryLoader:()=>Zl,Group:()=>Xs,Gyroscope:()=>Vc,HTMLView:()=>Js,HemisphereLight:()=>Zs,HueSaturationPass:()=>Es,Image:()=>Yi,ImageLoader:()=>Vl,InstancedMesh:()=>Qs,Key:()=>Ui,Keyboard:()=>Ws,LegacyGeometryLoader:()=>Jl,LensFlare:()=>eo,LightProbe:()=>so,LocalStorage:()=>zu,MaterialLoader:()=>Hl,MathUtils:()=>Gi,Mesh:()=>oo,Model:()=>go,Mouse:()=>zi,NodeScript:()=>Ou,Nunu:()=>jc,ObjectLoader:()=>lc,ObjectUtils:()=>ju,OrbitControls:()=>ao,OrthographicCamera:()=>co,ParametricBufferGeometry:()=>Yl,ParticleEmitter:()=>bc,ParticleEmitterControl:()=>yc,ParticleGroup:()=>vc,ParticleShaders:()=>pc,Pass:()=>us,PerspectiveCamera:()=>uo,PhysicsGenerator:()=>Hu,PhysicsObject:()=>ho,PointLight:()=>po,PositionalAudio:()=>vo,Program:()=>Cc,RectAreaLight:()=>bo,RenderPass:()=>ps,RendererConfiguration:()=>wc,RendererState:()=>cs,Resource:()=>Xi,ResourceContainer:()=>i,ResourceManager:()=>xc,RoundedBoxBufferGeometry:()=>ql,SSAONOHPass:()=>ws,SSAOPass:()=>ys,SSAOShader:()=>gs,Scene:()=>Bc,Script:()=>xo,ShaderAttribute:()=>fc,ShaderPass:()=>hs,ShaderUtils:()=>_c,SkinnedMesh:()=>wo,Sky:()=>To,SobelPass:()=>Ms,SpineAnimation:()=>Cl,SpineTexture:()=>$l,SpotLight:()=>Bl,Sprite:()=>Ll,SpriteSheetTexture:()=>rc,TargetConfig:()=>Sc,TechnicolorPass:()=>_s,TerrainBufferGeometry:()=>Wl,TextBitmap:()=>Ol,TextFile:()=>Fl,TextMesh:()=>kl,TextSprite:()=>zl,Texture:()=>Ji,TextureLoader:()=>oc,Timer:()=>Du,TizenKeyboard:()=>Gc,TwistModifier:()=>Yc,TypedArrayHelper:()=>dc,UnitConverter:()=>Vu,UnrealBloomPass:()=>fs,VRHandler:()=>Ac,Video:()=>ec,VideoLoader:()=>ac,VideoStream:()=>Xc,VideoTexture:()=>nc,Viewport:()=>lo,WebcamTexture:()=>tc,WorkerPool:()=>ku,WorkerTask:()=>Fu});var t={};__webpack_require__.r(t),__webpack_require__.d(t,{AABB:()=>h,ArrayCollisionMatrix:()=>f,BODY_SLEEP_STATES:()=>B,BODY_TYPES:()=>C,Body:()=>L,Box:()=>E,Broadphase:()=>V,COLLISION_TYPES:()=>ur,ConeTwistConstraint:()=>ie,Constraint:()=>Nt,ContactEquation:()=>jt,ContactMaterial:()=>fe,ConvexPolyhedron:()=>S,Cylinder:()=>fn,DistanceConstraint:()=>se,Equation:()=>It,EventTarget:()=>m,FrictionEquation:()=>he,GSSolver:()=>Xn,GridBroadphase:()=>J,Heightfield:()=>yn,HingeConstraint:()=>le,JacobianElement:()=>Pt,LockConstraint:()=>oe,Mat3:()=>o,Material:()=>me,NaiveBroadphase:()=>Q,Narrowphase:()=>hr,ObjectCollisionMatrix:()=>s,Particle:()=>mn,Plane:()=>_n,PointToPointConstraint:()=>Zt,Pool:()=>lr,Quaternion:()=>_,RAY_MODES:()=>tt,Ray:()=>et,RaycastResult:()=>K,RaycastVehicle:()=>Le,RigidVehicle:()=>nn,RotationalEquation:()=>ee,RotationalMotorEquation:()=>ae,SAPBroadphase:()=>Lt,SHAPE_TYPES:()=>v,SPHSystem:()=>on,Shape:()=>b,Solver:()=>qn,Sphere:()=>en,SplitSolver:()=>Qn,Spring:()=>_e,Transform:()=>x,Trimesh:()=>Nn,Vec3:()=>a,Vec3Pool:()=>cr,World:()=>Li});var e={};__webpack_require__.r(e),__webpack_require__.d(e,{ARHandler:()=>$c,AdaptiveToneMappingPass:()=>Hs,AfterimagePass:()=>zs,AmbientLight:()=>Zi,AnimationMixer:()=>Lc,AnimationTimer:()=>Uu,App:()=>Ec,ArraybufferUtils:()=>Vi,Audio:()=>yo,AudioEmitter:()=>Qi,AudioLoader:()=>Kl,Base64Utils:()=>Hi,BloomPass:()=>Fs,BokehPass:()=>Is,BufferUtils:()=>Wi,CSS3DObject:()=>Ys,CSS3DRenderer:()=>Wc,CSS3DSprite:()=>qc,CanvasSprite:()=>Ul,CanvasTexture:()=>Dl,CapsuleBufferGeometry:()=>Xl,ColorifyPass:()=>Ns,CompressedTexture:()=>sc,CopyPass:()=>Ls,CubeCamera:()=>ts,CubeTexture:()=>Ki,DataTexture:()=>ic,DirectionalLight:()=>es,DotScreenPass:()=>Bs,EffectComposer:()=>Vs,EventManager:()=>ji,FXAAPass:()=>Ds,FileSystem:()=>qi,FilmPass:()=>$s,FirstPersonControls:()=>qs,Font:()=>_o,FontLoader:()=>Ql,Gamepad:()=>Hc,GeometryLoader:()=>Zl,Group:()=>Xs,Gyroscope:()=>Vc,HTMLView:()=>Js,HemisphereLight:()=>Zs,HueSaturationPass:()=>Es,Image:()=>Yi,ImageLoader:()=>Vl,InstancedMesh:()=>Qs,Key:()=>Ui,Keyboard:()=>Ws,LegacyGeometryLoader:()=>Jl,LensFlare:()=>eo,LightProbe:()=>so,LocalStorage:()=>zu,MaterialLoader:()=>Hl,MathUtils:()=>Gi,Mesh:()=>oo,Model:()=>go,Mouse:()=>zi,NodeScript:()=>Ou,Nunu:()=>jc,ObjectLoader:()=>lc,ObjectUtils:()=>ju,OrbitControls:()=>ao,OrthographicCamera:()=>co,ParametricBufferGeometry:()=>Yl,ParticleEmitter:()=>bc,ParticleEmitterControl:()=>yc,ParticleGroup:()=>vc,ParticleShaders:()=>pc,Pass:()=>us,PerspectiveCamera:()=>uo,PhysicsGenerator:()=>Hu,PhysicsObject:()=>ho,PointLight:()=>po,PositionalAudio:()=>vo,Program:()=>Cc,RectAreaLight:()=>bo,RenderPass:()=>ps,RendererConfiguration:()=>wc,RendererState:()=>cs,Resource:()=>Xi,ResourceContainer:()=>i,ResourceManager:()=>xc,RoundedBoxBufferGeometry:()=>ql,SSAONOHPass:()=>ws,SSAOPass:()=>ys,SSAOShader:()=>gs,Scene:()=>Bc,Script:()=>xo,ShaderAttribute:()=>fc,ShaderPass:()=>hs,ShaderUtils:()=>_c,SkinnedMesh:()=>wo,Sky:()=>To,SobelPass:()=>Ms,SpineAnimation:()=>Cl,SpineTexture:()=>$l,SpotLight:()=>Bl,Sprite:()=>Ll,SpriteSheetTexture:()=>rc,TargetConfig:()=>Sc,TechnicolorPass:()=>_s,TerrainBufferGeometry:()=>Wl,TextBitmap:()=>Ol,TextFile:()=>Fl,TextMesh:()=>kl,TextSprite:()=>zl,Texture:()=>Ji,TextureLoader:()=>oc,Timer:()=>Du,TizenKeyboard:()=>Gc,TwistModifier:()=>Yc,TypedArrayHelper:()=>dc,UnitConverter:()=>Vu,UnrealBloomPass:()=>fs,VRHandler:()=>Ac,Video:()=>ec,VideoLoader:()=>ac,VideoStream:()=>Xc,VideoTexture:()=>nc,Viewport:()=>lo,WebcamTexture:()=>tc,WorkerPool:()=>ku,WorkerTask:()=>Fu});var n=__webpack_require__(412),r=__webpack_require__(412);function i(){this.images=[],this.videos=[],this.audio=[],this.fonts=[],this.materials=[],this.textures=[],this.geometries=[],this.resources=[],this.shapes=[],this.skeletons=[]}r.AnimationClip.prototype.enabled=!0,r.AnimationClip.prototype.loop=n.LoopRepeat,r.AnimationClip.prototype.timeScale=1,r.AnimationClip.prototype.weight=1,r.AnimationClip._toJSON=r.AnimationClip.toJSON,r.AnimationClip.toJSON=function(t){var e=r.AnimationClip._toJSON.call(this,t);return e.enabled=t.enabled,e.loop=t.loop,e.timeScale=t.timeScale,e.weight=t.weight,e},r.AnimationClip._parse=r.AnimationClip.parse,r.AnimationClip.parse=function(t){var e=r.AnimationClip._parse.call(this,t);return void 0!==t.enabled&&(e.enabled=t.enabled,e.loop=t.loop,e.timeScale=t.timeScale,e.weight=t.weight),e},__webpack_require__(500),__webpack_require__(10),__webpack_require__(939),__webpack_require__(412).InstancedBufferAttribute.prototype.toJSON=function(){var t=n.BufferAttribute.prototype.toJSON.call(this);return t.type="InstancedBufferAttribute",t.meshPerAttribute=this.meshPerAttribute,t},__webpack_require__(12),__webpack_require__(443),i.libraries=["images","videos","audio","fonts","materials","textures","geometries","resources","shapes","skeletons"],i.prototype.copyResources=function(t){this.materials=t.materials,this.textures=t.textures,this.resources=t.resources,this.fonts=t.fonts,this.audio=t.audio,this.geometries=t.geometries,this.images=t.images,this.videos=t.videos,this.shapes=t.shapes,this.skeletons=t.skeletons},i.prototype.getTexture=function(t){return void 0===this.textures[t]&&console.warn("nunuStudio: ResourceContainer, Undefined texture",t),this.textures[t]},i.prototype.getGeometry=function(t){return void 0===this.geometries[t]&&console.warn("nunuStudio: ResourceContainer, Undefined geometry",t),this.geometries[t]},i.prototype.getMaterial=function(t){if(t instanceof Array){for(var e=[],n=0;n<t.length;n++)void 0===this.materials[t[n]]&&console.warn("nunuStudio: ResourceContainer, Undefined material",t),e.push(this.materials[t[n]]);return e}return void 0===this.materials[t]&&console.warn("nunuStudio: ResourceContainer, Undefined material",t),this.materials[t]},i.prototype.getFont=function(t){return void 0===this.fonts[t]&&console.warn("nunuStudio: ResourceContainer, Undefined font",t),this.fonts[t]},i.prototype.getAudio=function(t){return void 0===this.audio[t]&&console.warn("nunuStudio: ResourceContainer, Undefined audio",t),this.audio[t]};class s{constructor(){this.matrix={}}get(t,e){let{id:n}=t,{id:r}=e;if(r>n){const t=r;r=n,n=t}return n+"-"+r in this.matrix}set(t,e,n){let{id:r}=t,{id:i}=e;if(i>r){const t=i;i=r,r=t}n?this.matrix[r+"-"+i]=!0:delete this.matrix[r+"-"+i]}reset(){this.matrix={}}setNumObjects(t){}}class o{constructor(t=[0,0,0,0,0,0,0,0,0]){this.elements=t}identity(){const t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}setZero(){const t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0}setTrace(t){const e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z}getTrace(t=new a){const e=this.elements;t.x=e[0],t.y=e[4],t.z=e[8]}vmult(t,e=new a){const n=this.elements,r=t.x,i=t.y,s=t.z;return e.x=n[0]*r+n[1]*i+n[2]*s,e.y=n[3]*r+n[4]*i+n[5]*s,e.z=n[6]*r+n[7]*i+n[8]*s,e}smult(t){for(let e=0;e<this.elements.length;e++)this.elements[e]*=t}mmult(t,e=new o){const{elements:n}=t;for(let t=0;t<3;t++)for(let r=0;r<3;r++){let i=0;for(let e=0;e<3;e++)i+=n[t+3*e]*this.elements[e+3*r];e.elements[t+3*r]=i}return e}scale(t,e=new o){const n=this.elements,r=e.elements;for(let e=0;3!==e;e++)r[3*e+0]=t.x*n[3*e+0],r[3*e+1]=t.y*n[3*e+1],r[3*e+2]=t.z*n[3*e+2];return e}solve(t,e=new a){const n=[];let r,i;for(r=0;r<12;r++)n.push(0);for(r=0;r<3;r++)for(i=0;i<3;i++)n[r+4*i]=this.elements[r+3*i];n[3]=t.x,n[7]=t.y,n[11]=t.z;let s=3;const o=s;let l,c;do{if(r=o-s,0===n[r+4*r])for(i=r+1;i<o;i++)if(0!==n[r+4*i]){l=4;do{c=4-l,n[c+4*r]+=n[c+4*i]}while(--l);break}if(0!==n[r+4*r])for(i=r+1;i<o;i++){const t=n[r+4*i]/n[r+4*r];l=4;do{c=4-l,n[c+4*i]=c<=r?0:n[c+4*i]-n[c+4*r]*t}while(--l)}}while(--s);if(e.z=n[11]/n[10],e.y=(n[7]-n[6]*e.z)/n[5],e.x=(n[3]-n[2]*e.z-n[1]*e.y)/n[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw"Could not solve equation! Got x=["+e.toString()+"], b=["+t.toString()+"], A=["+this.toString()+"]";return e}e(t,e,n){if(void 0===n)return this.elements[e+3*t];this.elements[e+3*t]=n}copy(t){for(let e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this}toString(){let t="";for(let e=0;e<9;e++)t+=this.elements[e]+",";return t}reverse(t=new o){const e=[];let n,r;for(n=0;n<18;n++)e.push(0);for(n=0;n<3;n++)for(r=0;r<3;r++)e[n+6*r]=this.elements[n+3*r];e[3]=1,e[9]=0,e[15]=0,e[4]=0,e[10]=1,e[16]=0,e[5]=0,e[11]=0,e[17]=1;let i=3;const s=i;let a,l;do{if(n=s-i,0===e[n+6*n])for(r=n+1;r<s;r++)if(0!==e[n+6*r]){a=6;do{l=6-a,e[l+6*n]+=e[l+6*r]}while(--a);break}if(0!==e[n+6*n])for(r=n+1;r<s;r++){const t=e[n+6*r]/e[n+6*n];a=6;do{l=6-a,e[l+6*r]=l<=n?0:e[l+6*r]-e[l+6*n]*t}while(--a)}}while(--i);n=2;do{r=n-1;do{const t=e[n+6*r]/e[n+6*n];a=6;do{l=6-a,e[l+6*r]=e[l+6*r]-e[l+6*n]*t}while(--a)}while(r--)}while(--n);n=2;do{const t=1/e[n+6*n];a=6;do{l=6-a,e[l+6*n]=e[l+6*n]*t}while(--a)}while(n--);n=2;do{r=2;do{if(l=e[3+r+6*n],isNaN(l)||l===1/0)throw"Could not reverse! A=["+this.toString()+"]";t.e(n,r,l)}while(r--)}while(n--);return t}setRotationFromQuaternion(t){const e=t.x,n=t.y,r=t.z,i=t.w,s=e+e,o=n+n,a=r+r,l=e*s,c=e*o,u=e*a,h=n*o,p=n*a,d=r*a,f=i*s,m=i*o,_=i*a,g=this.elements;return g[0]=1-(h+d),g[1]=c-_,g[2]=u+m,g[3]=c+_,g[4]=1-(l+d),g[5]=p-f,g[6]=u-m,g[7]=p+f,g[8]=1-(l+h),this}transpose(t=new o){const e=t.elements,n=this.elements;for(let t=0;3!==t;t++)for(let r=0;3!==r;r++)e[3*t+r]=n[3*r+t];return t}}class a{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}cross(t,e=new a){const n=t.x,r=t.y,i=t.z,s=this.x,o=this.y,l=this.z;return e.x=o*i-l*r,e.y=l*n-s*i,e.z=s*r-o*n,e}set(t,e,n){return this.x=t,this.y=e,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(t,e){if(!e)return new a(this.x+t.x,this.y+t.y,this.z+t.z);e.x=t.x+this.x,e.y=t.y+this.y,e.z=t.z+this.z}vsub(t,e){if(!e)return new a(this.x-t.x,this.y-t.y,this.z-t.z);e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z}crossmat(){return new o([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const t=this.x,e=this.y,n=this.z,r=Math.sqrt(t*t+e*e+n*n);if(r>0){const t=1/r;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return r}unit(t=new a){const e=this.x,n=this.y,r=this.z;let i=Math.sqrt(e*e+n*n+r*r);return i>0?(i=1/i,t.x=e*i,t.y=n*i,t.z=r*i):(t.x=1,t.y=0,t.z=0),t}length(){const t=this.x,e=this.y,n=this.z;return Math.sqrt(t*t+e*e+n*n)}lengthSquared(){return this.dot(this)}distanceTo(t){const e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z;return Math.sqrt((i-e)*(i-e)+(s-n)*(s-n)+(o-r)*(o-r))}distanceSquared(t){const e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z;return(i-e)*(i-e)+(s-n)*(s-n)+(o-r)*(o-r)}scale(t,e=new a){const n=this.x,r=this.y,i=this.z;return e.x=t*n,e.y=t*r,e.z=t*i,e}vmul(t,e=new a){return e.x=t.x*this.x,e.y=t.y*this.y,e.z=t.z*this.z,e}addScaledVector(t,e,n=new a){return n.x=this.x+t*e.x,n.y=this.y+t*e.y,n.z=this.z+t*e.z,n}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}negate(t=new a){return t.x=-this.x,t.y=-this.y,t.z=-this.z,t}tangents(t,e){const n=this.length();if(n>0){const r=l,i=1/n;r.set(this.x*i,this.y*i,this.z*i);const s=c;Math.abs(r.x)<.9?(s.set(1,0,0),r.cross(s,t)):(s.set(0,1,0),r.cross(s,t)),r.cross(t,e)}else t.set(1,0,0),e.set(0,1,0)}toString(){return this.x+","+this.y+","+this.z}toArray(){return[this.x,this.y,this.z]}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}lerp(t,e,n){const r=this.x,i=this.y,s=this.z;n.x=r+(t.x-r)*e,n.y=i+(t.y-i)*e,n.z=s+(t.z-s)*e}almostEquals(t,e=1e-6){return!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)}almostZero(t=1e-6){return!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)}isAntiparallelTo(t,e){return this.negate(u),u.almostEquals(t,e)}clone(){return new a(this.x,this.y,this.z)}}a.ZERO=new a(0,0,0),a.UNIT_X=new a(1,0,0),a.UNIT_Y=new a(0,1,0),a.UNIT_Z=new a(0,0,1);const l=new a,c=new a,u=new a;class h{constructor(t={}){this.lowerBound=new a,this.upperBound=new a,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}setFromPoints(t,e,n,r){const i=this.lowerBound,s=this.upperBound,o=n;i.copy(t[0]),o&&o.vmult(i,i),s.copy(i);for(let e=1;e<t.length;e++){let n=t[e];o&&(o.vmult(n,p),n=p),n.x>s.x&&(s.x=n.x),n.x<i.x&&(i.x=n.x),n.y>s.y&&(s.y=n.y),n.y<i.y&&(i.y=n.y),n.z>s.z&&(s.z=n.z),n.z<i.z&&(i.z=n.z)}return e&&(e.vadd(i,i),e.vadd(s,s)),r&&(i.x-=r,i.y-=r,i.z-=r,s.x+=r,s.y+=r,s.z+=r),this}copy(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this}clone(){return(new h).copy(this)}extend(t){this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,t.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,t.upperBound.z)}overlaps(t){const e=this.lowerBound,n=this.upperBound,r=t.lowerBound,i=t.upperBound,s=r.x<=n.x&&n.x<=i.x||e.x<=i.x&&i.x<=n.x,o=r.y<=n.y&&n.y<=i.y||e.y<=i.y&&i.y<=n.y,a=r.z<=n.z&&n.z<=i.z||e.z<=i.z&&i.z<=n.z;return s&&o&&a}volume(){const t=this.lowerBound,e=this.upperBound;return(e.x-t.x)*(e.y-t.y)*(e.z-t.z)}contains(t){const e=this.lowerBound,n=this.upperBound,r=t.lowerBound,i=t.upperBound;return e.x<=r.x&&n.x>=i.x&&e.y<=r.y&&n.y>=i.y&&e.z<=r.z&&n.z>=i.z}getCorners(t,e,n,r,i,s,o,a){const l=this.lowerBound,c=this.upperBound;t.copy(l),e.set(c.x,l.y,l.z),n.set(c.x,c.y,l.z),r.set(l.x,c.y,c.z),i.set(c.x,l.y,c.z),s.set(l.x,c.y,l.z),o.set(l.x,l.y,c.z),a.copy(c)}toLocalFrame(t,e){const n=d,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7];this.getCorners(r,i,s,o,a,l,c,u);for(let e=0;8!==e;e++){const r=n[e];t.pointToLocal(r,r)}return e.setFromPoints(n)}toWorldFrame(t,e){const n=d,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7];this.getCorners(r,i,s,o,a,l,c,u);for(let e=0;8!==e;e++){const r=n[e];t.pointToWorld(r,r)}return e.setFromPoints(n)}overlapsRay(t){const{direction:e,from:n}=t,r=1/e.x,i=1/e.y,s=1/e.z,o=(this.lowerBound.x-n.x)*r,a=(this.upperBound.x-n.x)*r,l=(this.lowerBound.y-n.y)*i,c=(this.upperBound.y-n.y)*i,u=(this.lowerBound.z-n.z)*s,h=(this.upperBound.z-n.z)*s,p=Math.max(Math.max(Math.min(o,a),Math.min(l,c)),Math.min(u,h)),d=Math.min(Math.min(Math.max(o,a),Math.max(l,c)),Math.max(u,h));return!(d<0||p>d)}}const p=new a,d=[new a,new a,new a,new a,new a,new a,new a,new a];class f{constructor(){this.matrix=[]}get(t,e){let{index:n}=t,{index:r}=e;if(r>n){const t=r;r=n,n=t}return this.matrix[(n*(n+1)>>1)+r-1]}set(t,e,n){let{index:r}=t,{index:i}=e;if(i>r){const t=i;i=r,r=t}this.matrix[(r*(r+1)>>1)+i-1]=n?1:0}reset(){for(let t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0}setNumObjects(t){this.matrix.length=t*(t-1)>>1}}class m{constructor(){}addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;return void 0===n[t]&&(n[t]=[]),n[t].includes(e)||n[t].push(e),this}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return!(void 0===n[t]||!n[t].includes(e))}hasAnyEventListener(t){return void 0!==this._listeners&&void 0!==this._listeners[t]}removeEventListener(t,e){if(void 0===this._listeners)return this;const n=this._listeners;if(void 0===n[t])return this;const r=n[t].indexOf(e);return-1!==r&&n[t].splice(r,1),this}dispatchEvent(t){if(void 0===this._listeners)return this;const e=this._listeners[t.type];if(void 0!==e){t.target=this;for(let n=0,r=e.length;n<r;n++)e[n].call(this,t)}return this}}class _{constructor(t=0,e=0,n=0,r=1){this.x=t,this.y=e,this.z=n,this.w=r}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}toString(){return this.x+","+this.y+","+this.z+","+this.w}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(t,e){const n=Math.sin(.5*e);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(.5*e),this}toAxisAngle(t=new a){this.normalize();const e=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/n,t.y=this.y/n,t.z=this.z/n),[t,e]}setFromVectors(t,e){if(t.isAntiparallelTo(e)){const e=g,n=y;t.tangents(e,n),this.setFromAxisAngle(e,Math.PI)}else{const n=t.cross(e);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(t.length()**2*e.length()**2)+t.dot(e),this.normalize()}return this}mult(t,e=new _){const n=this.x,r=this.y,i=this.z,s=this.w,o=t.x,a=t.y,l=t.z,c=t.w;return e.x=n*c+s*o+r*l-i*a,e.y=r*c+s*a+i*o-n*l,e.z=i*c+s*l+n*a-r*o,e.w=s*c-n*o-r*a-i*l,e}inverse(t=new _){const e=this.x,n=this.y,r=this.z,i=this.w;this.conjugate(t);const s=1/(e*e+n*n+r*r+i*i);return t.x*=s,t.y*=s,t.z*=s,t.w*=s,t}conjugate(t=new _){return t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}normalizeFast(){const t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}vmult(t,e=new a){const n=t.x,r=t.y,i=t.z,s=this.x,o=this.y,l=this.z,c=this.w,u=c*n+o*i-l*r,h=c*r+l*n-s*i,p=c*i+s*r-o*n,d=-s*n-o*r-l*i;return e.x=u*c+d*-s+h*-l-p*-o,e.y=h*c+d*-o+p*-s-u*-l,e.z=p*c+d*-l+u*-o-h*-s,e}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}toEuler(t,e="YZX"){let n,r,i;const s=this.x,o=this.y,a=this.z,l=this.w;if("YZX"!==e)throw new Error("Euler order "+e+" not supported yet.");{const t=s*o+a*l;if(t>.499&&(n=2*Math.atan2(s,l),r=Math.PI/2,i=0),t<-.499&&(n=-2*Math.atan2(s,l),r=-Math.PI/2,i=0),void 0===n){const e=s*s,c=o*o,u=a*a;n=Math.atan2(2*o*l-2*s*a,1-2*c-2*u),r=Math.asin(2*t),i=Math.atan2(2*s*l-2*o*a,1-2*e-2*u)}}t.y=n,t.z=r,t.x=i}setFromEuler(t,e,n,r="XYZ"){const i=Math.cos(t/2),s=Math.cos(e/2),o=Math.cos(n/2),a=Math.sin(t/2),l=Math.sin(e/2),c=Math.sin(n/2);return"XYZ"===r?(this.x=a*s*o+i*l*c,this.y=i*l*o-a*s*c,this.z=i*s*c+a*l*o,this.w=i*s*o-a*l*c):"YXZ"===r?(this.x=a*s*o+i*l*c,this.y=i*l*o-a*s*c,this.z=i*s*c-a*l*o,this.w=i*s*o+a*l*c):"ZXY"===r?(this.x=a*s*o-i*l*c,this.y=i*l*o+a*s*c,this.z=i*s*c+a*l*o,this.w=i*s*o-a*l*c):"ZYX"===r?(this.x=a*s*o-i*l*c,this.y=i*l*o+a*s*c,this.z=i*s*c-a*l*o,this.w=i*s*o+a*l*c):"YZX"===r?(this.x=a*s*o+i*l*c,this.y=i*l*o+a*s*c,this.z=i*s*c-a*l*o,this.w=i*s*o-a*l*c):"XZY"===r&&(this.x=a*s*o-i*l*c,this.y=i*l*o-a*s*c,this.z=i*s*c+a*l*o,this.w=i*s*o+a*l*c),this}clone(){return new _(this.x,this.y,this.z,this.w)}slerp(t,e,n=new _){const r=this.x,i=this.y,s=this.z,o=this.w;let a,l,c,u,h,p=t.x,d=t.y,f=t.z,m=t.w;return l=r*p+i*d+s*f+o*m,l<0&&(l=-l,p=-p,d=-d,f=-f,m=-m),1-l>1e-6?(a=Math.acos(l),c=Math.sin(a),u=Math.sin((1-e)*a)/c,h=Math.sin(e*a)/c):(u=1-e,h=e),n.x=u*r+h*p,n.y=u*i+h*d,n.z=u*s+h*f,n.w=u*o+h*m,n}integrate(t,e,n,r=new _){const i=t.x*n.x,s=t.y*n.y,o=t.z*n.z,a=this.x,l=this.y,c=this.z,u=this.w,h=.5*e;return r.x+=h*(i*u+s*c-o*l),r.y+=h*(s*u+o*a-i*c),r.z+=h*(o*u+i*l-s*a),r.w+=h*(-i*a-s*l-o*c),r}}const g=new a,y=new a,v={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class b{constructor(t={}){this.id=b.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=!t.collisionResponse||t.collisionResponse,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}updateBoundingSphereRadius(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type}volume(){throw"volume() not implemented for shape type "+this.type}calculateLocalInertia(t,e){throw"calculateLocalInertia() not implemented for shape type "+this.type}calculateWorldAABB(t,e,n,r){throw"calculateWorldAABB() not implemented for shape type "+this.type}}b.idCounter=0,b.types=v;class x{constructor(t={}){this.position=new a,this.quaternion=new _,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}pointToLocal(t,e){return x.pointToLocalFrame(this.position,this.quaternion,t,e)}pointToWorld(t,e){return x.pointToWorldFrame(this.position,this.quaternion,t,e)}vectorToWorldFrame(t,e=new a){return this.quaternion.vmult(t,e),e}static pointToLocalFrame(t,e,n,r=new a){return n.vsub(t,r),e.conjugate(w),w.vmult(r,r),r}static pointToWorldFrame(t,e,n,r=new a){return e.vmult(n,r),r.vadd(t,r),r}static vectorToWorldFrame(t,e,n=new a){return t.vmult(e,n),n}static vectorToLocalFrame(t,e,n,r=new a){return e.w*=-1,e.vmult(n,r),e.w*=-1,r}}const w=new _;class S extends b{constructor(t={}){const{vertices:e=[],faces:n=[],normals:r=[],axes:i,boundingSphereRadius:s}=t;super({type:b.types.CONVEXPOLYHEDRON}),this.vertices=e,this.faces=n,this.faceNormals=r,0===this.faceNormals.length&&this.computeNormals(),s?this.boundingSphereRadius=s:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=i?i.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const t=this.faces,e=this.vertices,n=this.uniqueEdges;n.length=0;const r=new a;for(let i=0;i!==t.length;i++){const s=t[i],o=s.length;for(let t=0;t!==o;t++){const i=(t+1)%o;e[s[t]].vsub(e[s[i]],r),r.normalize();let a=!1;for(let t=0;t!==n.length;t++)if(n[t].almostEquals(r)||n[t].almostEquals(r)){a=!0;break}a||n.push(r.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let t=0;t<this.faces.length;t++){for(let e=0;e<this.faces[t].length;e++)if(!this.vertices[this.faces[t][e]])throw new Error("Vertex "+this.faces[t][e]+" not found!");const e=this.faceNormals[t]||new a;this.getFaceNormal(t,e),e.negate(e),this.faceNormals[t]=e;const n=this.vertices[this.faces[t][0]];if(e.dot(n)<0){console.error(".faceNormals["+t+"] = Vec3("+e.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(let e=0;e<this.faces[t].length;e++)console.warn(".vertices["+this.faces[t][e]+"] = Vec3("+this.vertices[this.faces[t][e]].toString()+")")}}}getFaceNormal(t,e){const n=this.faces[t],r=this.vertices[n[0]],i=this.vertices[n[1]],s=this.vertices[n[2]];S.computeNormal(r,i,s,e)}clipAgainstHull(t,e,n,r,i,s,o,l,c){const u=new a;let h=-1,p=-Number.MAX_VALUE;for(let t=0;t<n.faces.length;t++){u.copy(n.faceNormals[t]),i.vmult(u,u);const e=u.dot(s);e>p&&(p=e,h=t)}const d=[];for(let t=0;t<n.faces[h].length;t++){const e=n.vertices[n.faces[h][t]],s=new a;s.copy(e),i.vmult(s,s),r.vadd(s,s),d.push(s)}h>=0&&this.clipFaceAgainstHull(s,t,e,d,o,l,c)}findSeparatingAxis(t,e,n,r,i,s,o,l){const c=new a,u=new a,h=new a,p=new a,d=new a,f=new a;let m=Number.MAX_VALUE;const _=this;if(_.uniqueAxes)for(let o=0;o!==_.uniqueAxes.length;o++){n.vmult(_.uniqueAxes[o],c);const a=_.testSepAxis(c,t,e,n,r,i);if(!1===a)return!1;a<m&&(m=a,s.copy(c))}else{const a=o?o.length:_.faces.length;for(let l=0;l<a;l++){const a=o?o[l]:l;c.copy(_.faceNormals[a]),n.vmult(c,c);const u=_.testSepAxis(c,t,e,n,r,i);if(!1===u)return!1;u<m&&(m=u,s.copy(c))}}if(t.uniqueAxes)for(let o=0;o!==t.uniqueAxes.length;o++){i.vmult(t.uniqueAxes[o],u);const a=_.testSepAxis(u,t,e,n,r,i);if(!1===a)return!1;a<m&&(m=a,s.copy(u))}else{const o=l?l.length:t.faces.length;for(let a=0;a<o;a++){const o=l?l[a]:a;u.copy(t.faceNormals[o]),i.vmult(u,u);const c=_.testSepAxis(u,t,e,n,r,i);if(!1===c)return!1;c<m&&(m=c,s.copy(u))}}for(let o=0;o!==_.uniqueEdges.length;o++){n.vmult(_.uniqueEdges[o],p);for(let o=0;o!==t.uniqueEdges.length;o++)if(i.vmult(t.uniqueEdges[o],d),p.cross(d,f),!f.almostZero()){f.normalize();const o=_.testSepAxis(f,t,e,n,r,i);if(!1===o)return!1;o<m&&(m=o,s.copy(f))}}return r.vsub(e,h),h.dot(s)>0&&s.negate(s),!0}testSepAxis(t,e,n,r,i,s){S.project(this,t,n,r,M),S.project(e,t,i,s,T);const o=M[0],a=M[1],l=T[0],c=T[1];if(o<c||l<a)return!1;const u=o-c,h=l-a;return u<h?u:h}calculateLocalInertia(t,e){const n=new a,r=new a;this.computeLocalAABB(r,n);const i=n.x-r.x,s=n.y-r.y,o=n.z-r.z;e.x=1/12*t*(2*s*2*s+2*o*2*o),e.y=1/12*t*(2*i*2*i+2*o*2*o),e.z=1/12*t*(2*s*2*s+2*i*2*i)}getPlaneConstantOfFace(t){const e=this.faces[t],n=this.faceNormals[t],r=this.vertices[e[0]];return-n.dot(r)}clipFaceAgainstHull(t,e,n,r,i,s,o){const l=new a,c=new a,u=new a,h=new a,p=new a,d=new a,f=new a,m=new a,_=this,g=r,y=[];let v=-1,b=Number.MAX_VALUE;for(let e=0;e<_.faces.length;e++){l.copy(_.faceNormals[e]),n.vmult(l,l);const r=l.dot(t);r<b&&(b=r,v=e)}if(v<0)return;const x=_.faces[v];x.connectedFaces=[];for(let t=0;t<_.faces.length;t++)for(let e=0;e<_.faces[t].length;e++)-1!==x.indexOf(_.faces[t][e])&&t!==v&&-1===x.connectedFaces.indexOf(t)&&x.connectedFaces.push(t);const w=x.length;for(let t=0;t<w;t++){const r=_.vertices[x[t]],i=_.vertices[x[(t+1)%w]];r.vsub(i,c),u.copy(c),n.vmult(u,u),e.vadd(u,u),h.copy(this.faceNormals[v]),n.vmult(h,h),e.vadd(h,h),u.cross(h,p),p.negate(p),d.copy(r),n.vmult(d,d),e.vadd(d,d);const s=x.connectedFaces[t];f.copy(this.faceNormals[s]);const o=this.getPlaneConstantOfFace(s);m.copy(f),n.vmult(m,m);const a=o-m.dot(e);for(this.clipFaceAgainstPlane(g,y,m,a);g.length;)g.shift();for(;y.length;)g.push(y.shift())}f.copy(this.faceNormals[v]);const S=this.getPlaneConstantOfFace(v);m.copy(f),n.vmult(m,m);const M=S-m.dot(e);for(let t=0;t<g.length;t++){let e=m.dot(g[t])+M;if(e<=i&&(console.log("clamped: depth="+e+" to minDist="+i),e=i),e<=s){const n=g[t];if(e<=1e-6){const t={point:n,normal:m,depth:e};o.push(t)}}}}clipFaceAgainstPlane(t,e,n,r){let i,s;const o=t.length;if(o<2)return e;let l=t[t.length-1],c=t[0];i=n.dot(l)+r;for(let u=0;u<o;u++){if(c=t[u],s=n.dot(c)+r,i<0)if(s<0){const t=new a;t.copy(c),e.push(t)}else{const t=new a;l.lerp(c,i/(i-s),t),e.push(t)}else if(s<0){const t=new a;l.lerp(c,i/(i-s),t),e.push(t),e.push(c)}l=c,i=s}return e}computeWorldVertices(t,e){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new a);const n=this.vertices,r=this.worldVertices;for(let i=0;i!==this.vertices.length;i++)e.vmult(n[i],r[i]),t.vadd(r[i],r[i]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(t,e){const n=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let r=0;r<this.vertices.length;r++){const i=n[r];i.x<t.x?t.x=i.x:i.x>e.x&&(e.x=i.x),i.y<t.y?t.y=i.y:i.y>e.y&&(e.y=i.y),i.z<t.z?t.z=i.z:i.z>e.z&&(e.z=i.z)}}computeWorldFaceNormals(t){const e=this.faceNormals.length;for(;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new a);const n=this.faceNormals,r=this.worldFaceNormals;for(let i=0;i!==e;i++)t.vmult(n[i],r[i]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let t=0;const e=this.vertices;for(let n=0;n!==e.length;n++){const r=e[n].lengthSquared();r>t&&(t=r)}this.boundingSphereRadius=Math.sqrt(t)}calculateWorldAABB(t,e,n,r){const i=this.vertices;let s,o,l,c,u,h,p=new a;for(let n=0;n<i.length;n++){p.copy(i[n]),e.vmult(p,p),t.vadd(p,p);const r=p;(void 0===s||r.x<s)&&(s=r.x),(void 0===c||r.x>c)&&(c=r.x),(void 0===o||r.y<o)&&(o=r.y),(void 0===u||r.y>u)&&(u=r.y),(void 0===l||r.z<l)&&(l=r.z),(void 0===h||r.z>h)&&(h=r.z)}n.set(s,o,l),r.set(c,u,h)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(t=new a){const e=this.vertices;for(let n=0;n<e.length;n++)t.vadd(e[n],t);return t.scale(1/e.length,t),t}transformAllPoints(t,e){const n=this.vertices.length,r=this.vertices;if(e){for(let t=0;t<n;t++){const n=r[t];e.vmult(n,n)}for(let t=0;t<this.faceNormals.length;t++){const n=this.faceNormals[t];e.vmult(n,n)}}if(t)for(let e=0;e<n;e++){const n=r[e];n.vadd(t,n)}}pointIsInside(t){const e=this.vertices,n=this.faces,r=this.faceNormals,i=new a;this.getAveragePointLocal(i);for(let s=0;s<this.faces.length;s++){let o=r[s];const l=e[n[s][0]],c=new a;t.vsub(l,c);const u=o.dot(c),h=new a;i.vsub(l,h);const p=o.dot(h);if(u<0&&p>0||u>0&&p<0)return!1}return-1}}S.computeNormal=(t,e,n,r)=>{const i=new a,s=new a;e.vsub(t,s),n.vsub(e,i),i.cross(s,r),r.isZero()||r.normalize()};const M=[],T=[];S.project=(t,e,n,r,i)=>{const s=t.vertices.length,o=new a;let l=0,c=0;const u=new a,h=t.vertices;u.setZero(),x.vectorToLocalFrame(n,r,e,o),x.pointToLocalFrame(n,r,u,u);const p=u.dot(o);c=l=h[0].dot(o);for(let t=1;t<s;t++){const e=h[t].dot(o);e>l&&(l=e),e<c&&(c=e)}if(c-=p,l-=p,c>l){const t=c;c=l,l=t}i[0]=l,i[1]=c};class E extends b{constructor(t){super({type:b.types.BOX}),this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const t=this.halfExtents.x,e=this.halfExtents.y,n=this.halfExtents.z,r=a,i=[new r(-t,-e,-n),new r(t,-e,-n),new r(t,e,-n),new r(-t,e,-n),new r(-t,-e,n),new r(t,-e,n),new r(t,e,n),new r(-t,e,n)],s=[new r(0,0,1),new r(0,1,0),new r(1,0,0)],o=new S({vertices:i,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:s});this.convexPolyhedronRepresentation=o,o.material=this.material}calculateLocalInertia(t,e=new a){return E.calculateInertia(this.halfExtents,t,e),e}getSideNormals(t,e){const n=t,r=this.halfExtents;if(n[0].set(r.x,0,0),n[1].set(0,r.y,0),n[2].set(0,0,r.z),n[3].set(-r.x,0,0),n[4].set(0,-r.y,0),n[5].set(0,0,-r.z),void 0!==e)for(let t=0;t!==n.length;t++)e.vmult(n[t],n[t]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(t,e,n){const r=this.halfExtents,i=[[r.x,r.y,r.z],[-r.x,r.y,r.z],[-r.x,-r.y,r.z],[-r.x,-r.y,-r.z],[r.x,-r.y,-r.z],[r.x,r.y,-r.z],[-r.x,r.y,-r.z],[r.x,-r.y,r.z]];for(let r=0;r<i.length;r++)A.set(i[r][0],i[r][1],i[r][2]),e.vmult(A,A),t.vadd(A,A),n(A.x,A.y,A.z)}calculateWorldAABB(t,e,n,r){const i=this.halfExtents;$[0].set(i.x,i.y,i.z),$[1].set(-i.x,i.y,i.z),$[2].set(-i.x,-i.y,i.z),$[3].set(-i.x,-i.y,-i.z),$[4].set(i.x,-i.y,-i.z),$[5].set(i.x,i.y,-i.z),$[6].set(-i.x,i.y,-i.z),$[7].set(i.x,-i.y,i.z);const s=$[0];e.vmult(s,s),t.vadd(s,s),r.copy(s),n.copy(s);for(let i=1;i<8;i++){const s=$[i];e.vmult(s,s),t.vadd(s,s);const o=s.x,a=s.y,l=s.z;o>r.x&&(r.x=o),a>r.y&&(r.y=a),l>r.z&&(r.z=l),o<n.x&&(n.x=o),a<n.y&&(n.y=a),l<n.z&&(n.z=l)}}}E.calculateInertia=(t,e,n)=>{const r=t;n.x=1/12*e*(2*r.y*2*r.y+2*r.z*2*r.z),n.y=1/12*e*(2*r.x*2*r.x+2*r.z*2*r.z),n.z=1/12*e*(2*r.y*2*r.y+2*r.x*2*r.x)};const A=new a,$=[new a,new a,new a,new a,new a,new a,new a,new a],C={DYNAMIC:1,STATIC:2,KINEMATIC:4},B={AWAKE:0,SLEEPY:1,SLEEPING:2};class L extends m{constructor(t={}){super(),this.id=L.idCounter++,this.index=-1,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new a,this.collisionFilterGroup="number"==typeof t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionResponse="boolean"!=typeof t.collisionResponse||t.collisionResponse,this.position=new a,this.previousPosition=new a,this.interpolatedPosition=new a,this.initPosition=new a,t.position&&(this.position.copy(t.position),this.previousPosition.copy(t.position),this.interpolatedPosition.copy(t.position),this.initPosition.copy(t.position)),this.velocity=new a,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new a,this.force=new a;const e="number"==typeof t.mass?t.mass:0;this.mass=e,this.invMass=e>0?1/e:0,this.material=t.material||null,this.linearDamping="number"==typeof t.linearDamping?t.linearDamping:.01,this.type=e<=0?L.STATIC:L.DYNAMIC,typeof t.type==typeof L.STATIC&&(this.type=t.type),this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new a,this.quaternion=new _,this.initQuaternion=new _,this.previousQuaternion=new _,this.interpolatedQuaternion=new _,t.quaternion&&(this.quaternion.copy(t.quaternion),this.initQuaternion.copy(t.quaternion),this.previousQuaternion.copy(t.quaternion),this.interpolatedQuaternion.copy(t.quaternion)),this.angularVelocity=new a,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new a,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new a,this.invInertia=new a,this.invInertiaWorld=new o,this.invMassSolve=0,this.invInertiaSolve=new a,this.invInertiaWorldSolve=new o,this.fixedRotation=void 0!==t.fixedRotation&&t.fixedRotation,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.01,this.linearFactor=new a(1,1,1),t.linearFactor&&this.linearFactor.copy(t.linearFactor),this.angularFactor=new a(1,1,1),t.angularFactor&&this.angularFactor.copy(t.angularFactor),this.aabb=new h,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new a,t.shape&&this.addShape(t.shape),this.updateMassProperties()}wakeUp(){const t=this.sleepState;this.sleepState=0,this.wakeUpAfterNarrowphase=!1,t===L.SLEEPING&&this.dispatchEvent(L.wakeupEvent)}sleep(){this.sleepState=L.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(t){if(this.allowSleep){const e=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),r=this.sleepSpeedLimit**2;e===L.AWAKE&&n<r?(this.sleepState=L.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(L.sleepyEvent)):e===L.SLEEPY&&n>r?this.wakeUp():e===L.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(L.sleepEvent))}}updateSolveMassProperties(){this.sleepState===L.SLEEPING||this.type===L.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(t,e=new a){return t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e}vectorToLocalFrame(t,e=new a){return this.quaternion.conjugate().vmult(t,e),e}pointToWorldFrame(t,e=new a){return this.quaternion.vmult(t,e),e.vadd(this.position,e),e}vectorToWorldFrame(t,e=new a){return this.quaternion.vmult(t,e),e}addShape(t,e,n){const r=new a,i=new _;return e&&r.copy(e),n&&i.copy(n),this.shapes.push(t),this.shapeOffsets.push(r),this.shapeOrientations.push(i),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,t.body=this,this}updateBoundingRadius(){const t=this.shapes,e=this.shapeOffsets,n=t.length;let r=0;for(let i=0;i!==n;i++){const n=t[i];n.updateBoundingSphereRadius();const s=e[i].length(),o=n.boundingSphereRadius;s+o>r&&(r=s+o)}this.boundingRadius=r}computeAABB(){const t=this.shapes,e=this.shapeOffsets,n=this.shapeOrientations,r=t.length,i=R,s=N,o=this.quaternion,a=this.aabb,l=P;for(let c=0;c!==r;c++){const r=t[c];o.vmult(e[c],i),i.vadd(this.position,i),o.mult(n[c],s),r.calculateWorldAABB(i,s,l.lowerBound,l.upperBound),0===c?a.copy(l):a.extend(l)}this.aabbNeedsUpdate=!1}updateInertiaWorld(t){const e=this.invInertia;if(e.x!==e.y||e.y!==e.z||t){const t=I,n=O;t.setRotationFromQuaternion(this.quaternion),t.transpose(n),t.scale(e,t),t.mmult(n,this.invInertiaWorld)}}applyForce(t,e){if(this.type!==L.DYNAMIC)return;const n=F;e.cross(t,n),this.force.vadd(t,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(t,e){if(this.type!==L.DYNAMIC)return;const n=k,r=D;this.vectorToWorldFrame(t,n),this.vectorToWorldFrame(e,r),this.applyForce(n,r)}applyImpulse(t,e){if(this.type!==L.DYNAMIC)return;const n=e,r=U;r.copy(t),r.scale(this.invMass,r),this.velocity.vadd(r,this.velocity);const i=z;n.cross(t,i),this.invInertiaWorld.vmult(i,i),this.angularVelocity.vadd(i,this.angularVelocity)}applyLocalImpulse(t,e){if(this.type!==L.DYNAMIC)return;const n=j,r=G;this.vectorToWorldFrame(t,n),this.vectorToWorldFrame(e,r),this.applyImpulse(n,r)}updateMassProperties(){const t=H;this.invMass=this.mass>0?1/this.mass:0;const e=this.inertia,n=this.fixedRotation;this.computeAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),E.calculateInertia(t,this.mass,e),this.invInertia.set(e.x>0&&!n?1/e.x:0,e.y>0&&!n?1/e.y:0,e.z>0&&!n?1/e.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(t,e){const n=new a;return t.vsub(this.position,n),this.angularVelocity.cross(n,e),this.velocity.vadd(e,e),e}integrate(t,e,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==L.DYNAMIC&&this.type!==L.KINEMATIC||this.sleepState===L.SLEEPING)return;const r=this.velocity,i=this.angularVelocity,s=this.position,o=this.force,a=this.torque,l=this.quaternion,c=this.invMass,u=this.invInertiaWorld,h=this.linearFactor,p=c*t;r.x+=o.x*p*h.x,r.y+=o.y*p*h.y,r.z+=o.z*p*h.z;const d=u.elements,f=this.angularFactor,m=a.x*f.x,_=a.y*f.y,g=a.z*f.z;i.x+=t*(d[0]*m+d[1]*_+d[2]*g),i.y+=t*(d[3]*m+d[4]*_+d[5]*g),i.z+=t*(d[6]*m+d[7]*_+d[8]*g),s.x+=r.x*t,s.y+=r.y*t,s.z+=r.z*t,l.integrate(this.angularVelocity,t,this.angularFactor,l),e&&(n?l.normalizeFast():l.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}L.COLLIDE_EVENT_NAME="collide",L.DYNAMIC=1,L.STATIC=2,L.KINEMATIC=4,L.AWAKE=B.AWAKE,L.SLEEPY=B.SLEEPY,L.SLEEPING=B.SLEEPING,L.idCounter=0,L.wakeupEvent={type:"wakeup"},L.sleepyEvent={type:"sleepy"},L.sleepEvent={type:"sleep"};const R=new a,N=new _,P=new h,I=new o,O=new o,F=new a,k=new a,D=new a,U=new a,z=new a,j=new a,G=new a,H=new a;class V{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(t,e,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(t,e){return 0!=(t.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&t.collisionFilterMask)&&(0==(t.type&L.STATIC)&&t.sleepState!==L.SLEEPING||0==(e.type&L.STATIC)&&e.sleepState!==L.SLEEPING)}intersectionTest(t,e,n,r){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,n,r):this.doBoundingSphereBroadphase(t,e,n,r)}doBoundingSphereBroadphase(t,e,n,r){const i=W;e.position.vsub(t.position,i);const s=(t.boundingRadius+e.boundingRadius)**2;i.lengthSquared()<s&&(n.push(t),r.push(e))}doBoundingBoxBroadphase(t,e,n,r){t.aabbNeedsUpdate&&t.computeAABB(),e.aabbNeedsUpdate&&e.computeAABB(),t.aabb.overlaps(e.aabb)&&(n.push(t),r.push(e))}makePairsUnique(t,e){const n=q,r=X,i=Y,s=t.length;for(let n=0;n!==s;n++)r[n]=t[n],i[n]=e[n];t.length=0,e.length=0;for(let t=0;t!==s;t++){const e=r[t].id,s=i[t].id,o=e<s?e+","+s:s+","+e;n[o]=t,n.keys.push(o)}for(let s=0;s!==n.keys.length;s++){const s=n.keys.pop(),o=n[s];t.push(r[o]),e.push(i[o]),delete n[s]}}setWorld(t){}aabbQuery(t,e,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const W=new a,q={keys:[]},X=[],Y=[];V.boundingSphereCheck=(t,e)=>{const n=new a;t.position.vsub(e.position,n);const r=t.shapes[0],i=e.shapes[0];return Math.pow(r.boundingSphereRadius+i.boundingSphereRadius,2)>n.lengthSquared()};class J extends V{constructor(t=new a(100,100,100),e=new a(-100,-100,-100),n=10,r=10,i=10){super(),this.nx=n,this.ny=r,this.nz=i,this.aabbMin=t,this.aabbMax=e;const s=this.nx*this.ny*this.nz;if(s<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=s,this.binLengths.length=s;for(let t=0;t<s;t++)this.bins[t]=[],this.binLengths[t]=0}collisionPairs(t,e,n){const r=t.numObjects(),i=t.bodies,s=this.aabbMax,o=this.aabbMin,a=this.nx,l=this.ny,c=this.nz,u=l*c,h=c,p=s.x,d=s.y,f=s.z,m=o.x,_=o.y,g=o.z,y=a/(p-m),v=l/(d-_),x=c/(f-g),w=(p-m)/a,S=(d-_)/l,M=(f-g)/c,T=.5*Math.sqrt(w*w+S*S+M*M),E=b.types,A=E.SPHERE,$=E.PLANE,C=(E.BOX,E.COMPOUND,E.CONVEXPOLYHEDRON,this.bins),B=this.binLengths,L=this.bins.length;for(let t=0;t!==L;t++)B[t]=0;const R=Math.ceil;function N(t,e,n,r,i,s,o){let p=(t-m)*y|0,d=(e-_)*v|0,f=(n-g)*x|0,b=R((r-m)*y),w=R((i-_)*v),S=R((s-g)*x);p<0?p=0:p>=a&&(p=a-1),d<0?d=0:d>=l&&(d=l-1),f<0?f=0:f>=c&&(f=c-1),b<0?b=0:b>=a&&(b=a-1),w<0?w=0:w>=l&&(w=l-1),S<0?S=0:S>=c&&(S=c-1),p*=u,d*=h,f*=1,b*=u,w*=h,S*=1;for(let t=p;t<=b;t+=u)for(let e=d;e<=w;e+=h)for(let n=f;n<=S;n+=1){const r=t+e+n;C[r][B[r]++]=o}}for(let t=0;t!==r;t++){const e=i[t],n=e.shapes[0];switch(n.type){case A:{const t=n,r=e.position.x,i=e.position.y,s=e.position.z,o=t.radius;N(r-o,i-o,s-o,r+o,i+o,s+o,e);break}case $:{const t=n;t.worldNormalNeedsUpdate&&t.computeWorldNormal(e.quaternion);const r=t.worldNormal,i=m+.5*w-e.position.x,s=_+.5*S-e.position.y,o=g+.5*M-e.position.z,p=Z;p.set(i,s,o);for(let t=0,n=0;t!==a;t++,n+=u,p.y=s,p.x+=w)for(let t=0,i=0;t!==l;t++,i+=h,p.z=o,p.y+=S)for(let t=0,s=0;t!==c;t++,s+=1,p.z+=M)if(p.dot(r)<T){const t=n+i+s;C[t][B[t]++]=e}break}default:e.aabbNeedsUpdate&&e.computeAABB(),N(e.aabb.lowerBound.x,e.aabb.lowerBound.y,e.aabb.lowerBound.z,e.aabb.upperBound.x,e.aabb.upperBound.y,e.aabb.upperBound.z,e)}}for(let t=0;t!==L;t++){const r=B[t];if(r>1){const i=C[t];for(let t=0;t!==r;t++){const r=i[t];for(let s=0;s!==t;s++){const t=i[s];this.needBroadphaseCollision(r,t)&&this.intersectionTest(r,t,e,n)}}}}this.makePairsUnique(e,n)}}const Z=new a;class Q extends V{constructor(){super()}collisionPairs(t,e,n){const r=t.bodies,i=r.length;let s,o;for(let t=0;t!==i;t++)for(let i=0;i!==t;i++)s=r[t],o=r[i],this.needBroadphaseCollision(s,o)&&this.intersectionTest(s,o,e,n)}aabbQuery(t,e,n=[]){for(let r=0;r<t.bodies.length;r++){const i=t.bodies[r];i.aabbNeedsUpdate&&i.computeAABB(),i.aabb.overlaps(e)&&n.push(i)}return n}}class K{constructor(){this.rayFromWorld=new a,this.rayToWorld=new a,this.hitNormalWorld=new a,this.hitPointWorld=new a,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(t,e,n,r,i,s,o){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(r),this.shape=i,this.body=s,this.distance=o}}const tt={CLOSEST:1,ANY:2,ALL:4};class et{constructor(t=new a,e=new a){this.from=t.clone(),this.to=e.clone(),this.direction=new a,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=et.ANY,this.result=new K,this.hasHit=!1,this.callback=t=>{}}intersectWorld(t,e){return this.mode=e.mode||et.ANY,this.result=e.result||new K,this.skipBackfaces=!!e.skipBackfaces,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===e.checkCollisionResponse||e.checkCollisionResponse,e.from&&this.from.copy(e.from),e.to&&this.to.copy(e.to),this.callback=e.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(nt),rt.length=0,t.broadphase.aabbQuery(t,nt,rt),this.intersectBodies(rt),this.hasHit}intersectBody(t,e){e&&(this.result=e,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!t.collisionResponse)return;if(0==(this.collisionFilterGroup&t.collisionFilterMask)||0==(t.collisionFilterGroup&this.collisionFilterMask))return;const r=at,i=lt;for(let e=0,s=t.shapes.length;e<s;e++){const s=t.shapes[e];if((!n||s.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[e],i),t.quaternion.vmult(t.shapeOffsets[e],r),r.vadd(t.position,r),this.intersectShape(s,i,r,t),this.result.shouldStop))break}}intersectBodies(t,e){e&&(this.result=e,this.updateDirection());for(let e=0,n=t.length;!this.result.shouldStop&&e<n;e++)this.intersectBody(t[e])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(t,e,n,r){const i=function(t,e,n){n.vsub(t,Ct);const r=Ct.dot(e);e.scale(r,Bt),Bt.vadd(t,Bt);return n.distanceTo(Bt)}(this.from,this.direction,n);if(i>t.boundingSphereRadius)return;const s=this[t.type];s&&s.call(this,t,e,n,r,t)}_intersectBox(t,e,n,r,i){return this._intersectConvex(t.convexPolyhedronRepresentation,e,n,r,i)}_intersectPlane(t,e,n,r,i){const s=this.from,o=this.to,l=this.direction,c=new a(0,0,1);e.vmult(c,c);const u=new a;s.vsub(n,u);const h=u.dot(c);if(o.vsub(n,u),h*u.dot(c)>0)return;if(s.distanceTo(o)<h)return;const p=c.dot(l);if(Math.abs(p)<this.precision)return;const d=new a,f=new a,m=new a;s.vsub(n,d);const _=-c.dot(d)/p;l.scale(_,f),s.vadd(f,m),this.reportIntersection(c,m,i,r,-1)}getAABB(t){const{lowerBound:e,upperBound:n}=t,r=this.to,i=this.from;e.x=Math.min(r.x,i.x),e.y=Math.min(r.y,i.y),e.z=Math.min(r.z,i.z),n.x=Math.max(r.x,i.x),n.y=Math.max(r.y,i.y),n.z=Math.max(r.z,i.z)}_intersectHeightfield(t,e,n,r,i){t.data,t.elementSize;const s=mt;s.from.copy(this.from),s.to.copy(this.to),x.pointToLocalFrame(n,e,s.from,s.from),x.pointToLocalFrame(n,e,s.to,s.to),s.updateDirection();const o=_t;let a,l,c,u;a=l=0,c=u=t.data.length-1;const p=new h;s.getAABB(p),t.getIndexOfPosition(p.lowerBound.x,p.lowerBound.y,o,!0),a=Math.max(a,o[0]),l=Math.max(l,o[1]),t.getIndexOfPosition(p.upperBound.x,p.upperBound.y,o,!0),c=Math.min(c,o[0]+1),u=Math.min(u,o[1]+1);for(let o=a;o<c;o++)for(let a=l;a<u;a++){if(this.result.shouldStop)return;if(t.getAabbAtIndex(o,a,p),p.overlapsRay(s)){if(t.getConvexTrianglePillar(o,a,!1),x.pointToWorldFrame(n,e,t.pillarOffset,ft),this._intersectConvex(t.pillarConvex,e,ft,r,i,dt),this.result.shouldStop)return;t.getConvexTrianglePillar(o,a,!0),x.pointToWorldFrame(n,e,t.pillarOffset,ft),this._intersectConvex(t.pillarConvex,e,ft,r,i,dt)}}}_intersectSphere(t,e,n,r,i){const s=this.from,o=this.to,a=t.radius,l=(o.x-s.x)**2+(o.y-s.y)**2+(o.z-s.z)**2,c=2*((o.x-s.x)*(s.x-n.x)+(o.y-s.y)*(s.y-n.y)+(o.z-s.z)*(s.z-n.z)),u=c**2-4*l*((s.x-n.x)**2+(s.y-n.y)**2+(s.z-n.z)**2-a**2),h=gt,p=yt;if(!(u<0))if(0===u)s.lerp(o,u,h),h.vsub(n,p),p.normalize(),this.reportIntersection(p,h,i,r,-1);else{const t=(-c-Math.sqrt(u))/(2*l),e=(-c+Math.sqrt(u))/(2*l);if(t>=0&&t<=1&&(s.lerp(o,t,h),h.vsub(n,p),p.normalize(),this.reportIntersection(p,h,i,r,-1)),this.result.shouldStop)return;e>=0&&e<=1&&(s.lerp(o,e,h),h.vsub(n,p),p.normalize(),this.reportIntersection(p,h,i,r,-1))}}_intersectConvex(t,e,n,r,i,s){const o=vt,a=bt,l=s&&s.faceList||null,c=t.faces,u=t.vertices,h=t.faceNormals,p=this.direction,d=this.from,f=this.to,m=d.distanceTo(f),_=l?l.length:c.length,g=this.result;for(let t=0;!g.shouldStop&&t<_;t++){const s=l?l[t]:t,f=c[s],_=h[s],y=e,v=n;a.copy(u[f[0]]),y.vmult(a,a),a.vadd(v,a),a.vsub(d,a),y.vmult(_,o);const b=p.dot(o);if(Math.abs(b)<this.precision)continue;const x=o.dot(a)/b;if(!(x<0)){p.scale(x,ct),ct.vadd(d,ct),ut.copy(u[f[0]]),y.vmult(ut,ut),v.vadd(ut,ut);for(let t=1;!g.shouldStop&&t<f.length-1;t++){ht.copy(u[f[t]]),pt.copy(u[f[t+1]]),y.vmult(ht,ht),y.vmult(pt,pt),v.vadd(ht,ht),v.vadd(pt,pt);const e=ct.distanceTo(d);!ot(ct,ut,ht,pt)&&!ot(ct,ht,ut,pt)||e>m||this.reportIntersection(o,ct,i,r,s)}}}}_intersectTrimesh(t,e,n,r,i,s){const o=xt,a=At,l=$t,c=bt,u=wt,h=St,p=Mt,d=Et,f=Tt,m=(s&&s.faceList,t.indices),_=(t.vertices,this.from),g=this.to,y=this.direction;l.position.copy(n),l.quaternion.copy(e),x.vectorToLocalFrame(n,e,y,u),x.pointToLocalFrame(n,e,_,h),x.pointToLocalFrame(n,e,g,p),p.x*=t.scale.x,p.y*=t.scale.y,p.z*=t.scale.z,h.x*=t.scale.x,h.y*=t.scale.y,h.z*=t.scale.z,p.vsub(h,u),u.normalize();const v=h.distanceSquared(p);t.tree.rayQuery(this,l,a);for(let s=0,l=a.length;!this.result.shouldStop&&s!==l;s++){const l=a[s];t.getNormal(l,o),t.getVertex(m[3*l],ut),ut.vsub(h,c);const p=u.dot(o),_=o.dot(c)/p;if(_<0)continue;u.scale(_,ct),ct.vadd(h,ct),t.getVertex(m[3*l+1],ht),t.getVertex(m[3*l+2],pt);const g=ct.distanceSquared(h);!ot(ct,ht,ut,pt)&&!ot(ct,ut,ht,pt)||g>v||(x.vectorToWorldFrame(e,o,f),x.pointToWorldFrame(n,e,ct,d),this.reportIntersection(f,d,i,r,l))}a.length=0}reportIntersection(t,e,n,r,i){const s=this.from,o=this.to,a=s.distanceTo(e),l=this.result;if(!(this.skipBackfaces&&t.dot(this.direction)>0))switch(l.hitFaceIndex=void 0!==i?i:-1,this.mode){case et.ALL:this.hasHit=!0,l.set(s,o,t,e,n,r,a),l.hasHit=!0,this.callback(l);break;case et.CLOSEST:(a<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(s,o,t,e,n,r,a));break;case et.ANY:this.hasHit=!0,l.hasHit=!0,l.set(s,o,t,e,n,r,a),l.shouldStop=!0}}}et.CLOSEST=1,et.ANY=2,et.ALL=4;const nt=new h,rt=[],it=new a,st=new a;function ot(t,e,n,r){r.vsub(e,Ct),n.vsub(e,it),t.vsub(e,st);const i=Ct.dot(Ct),s=Ct.dot(it),o=Ct.dot(st),a=it.dot(it),l=it.dot(st);let c,u;return(c=a*o-s*l)>=0&&(u=i*l-s*o)>=0&&c+u<i*a-s*s}et.pointInTriangle=ot;const at=new a,lt=new _,ct=new a,ut=new a,ht=new a,pt=new a;et.prototype[b.types.BOX]=et.prototype._intersectBox,et.prototype[b.types.PLANE]=et.prototype._intersectPlane;const dt={faceList:[0]},ft=new a,mt=new et,_t=[];et.prototype[b.types.HEIGHTFIELD]=et.prototype._intersectHeightfield;const gt=new a,yt=new a;et.prototype[b.types.SPHERE]=et.prototype._intersectSphere;const vt=new a,bt=new a;et.prototype[b.types.CONVEXPOLYHEDRON]=et.prototype._intersectConvex;const xt=new a,wt=new a,St=new a,Mt=new a,Tt=new a,Et=new a,At=(new h,[]),$t=new x;et.prototype[b.types.TRIMESH]=et.prototype._intersectTrimesh;const Ct=new a,Bt=new a;class Lt extends V{constructor(t){super(),this.axisList=[],this.world=null,this.axisIndex=0;const e=this.axisList;this._addBodyHandler=t=>{e.push(t.body)},this._removeBodyHandler=t=>{const n=e.indexOf(t.body);-1!==n&&e.splice(n,1)},t&&this.setWorld(t)}setWorld(t){this.axisList.length=0;for(let e=0;e<t.bodies.length;e++)this.axisList.push(t.bodies[e]);t.removeEventListener("addBody",this._addBodyHandler),t.removeEventListener("removeBody",this._removeBodyHandler),t.addEventListener("addBody",this._addBodyHandler),t.addEventListener("removeBody",this._removeBodyHandler),this.world=t,this.dirty=!0}collisionPairs(t,e,n){const r=this.axisList,i=r.length,s=this.axisIndex;let o,a;for(this.dirty&&(this.sortList(),this.dirty=!1),o=0;o!==i;o++){const t=r[o];for(a=o+1;a<i;a++){const i=r[a];if(this.needBroadphaseCollision(t,i)){if(!Lt.checkBounds(t,i,s))break;this.intersectionTest(t,i,e,n)}}}}sortList(){const t=this.axisList,e=this.axisIndex,n=t.length;for(let e=0;e!==n;e++){const n=t[e];n.aabbNeedsUpdate&&n.computeAABB()}0===e?Lt.insertionSortX(t):1===e?Lt.insertionSortY(t):2===e&&Lt.insertionSortZ(t)}autoDetectAxis(){let t=0,e=0,n=0,r=0,i=0,s=0;const o=this.axisList,a=o.length,l=1/a;for(let l=0;l!==a;l++){const a=o[l],c=a.position.x;t+=c,e+=c*c;const u=a.position.y;n+=u,r+=u*u;const h=a.position.z;i+=h,s+=h*h}const c=e-t*t*l,u=r-n*n*l,h=s-i*i*l;this.axisIndex=c>u?c>h?0:2:u>h?1:2}aabbQuery(t,e,n=[]){this.dirty&&(this.sortList(),this.dirty=!1);const r=this.axisIndex;let i="x";1===r&&(i="y"),2===r&&(i="z");const s=this.axisList;e.lowerBound[i],e.upperBound[i];for(let t=0;t<s.length;t++){const r=s[t];r.aabbNeedsUpdate&&r.computeAABB(),r.aabb.overlaps(e)&&n.push(r)}return n}}function Rt(){}Lt.insertionSortX=t=>{for(let e=1,n=t.length;e<n;e++){const n=t[e];let r;for(r=e-1;r>=0&&!(t[r].aabb.lowerBound.x<=n.aabb.lowerBound.x);r--)t[r+1]=t[r];t[r+1]=n}return t},Lt.insertionSortY=t=>{for(let e=1,n=t.length;e<n;e++){const n=t[e];let r;for(r=e-1;r>=0&&!(t[r].aabb.lowerBound.y<=n.aabb.lowerBound.y);r--)t[r+1]=t[r];t[r+1]=n}return t},Lt.insertionSortZ=t=>{for(let e=1,n=t.length;e<n;e++){const n=t[e];let r;for(r=e-1;r>=0&&!(t[r].aabb.lowerBound.z<=n.aabb.lowerBound.z);r--)t[r+1]=t[r];t[r+1]=n}return t},Lt.checkBounds=(t,e,n)=>{let r,i;0===n?(r=t.position.x,i=e.position.x):1===n?(r=t.position.y,i=e.position.y):2===n&&(r=t.position.z,i=e.position.z);const s=t.boundingRadius;return i-e.boundingRadius<r+s},Rt.defaults=(t={},e)=>{for(let n in e)n in t||(t[n]=e[n]);return t};class Nt{constructor(t,e,n={}){n=Rt.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.id=Nt.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const t=this.equations;for(let e=0;e<t.length;e++)t[e].enabled=!0}disable(){const t=this.equations;for(let e=0;e<t.length;e++)t[e].enabled=!1}}Nt.idCounter=0;class Pt{constructor(){this.spatial=new a,this.rotational=new a}multiplyElement(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)}multiplyVectors(t,e){return t.dot(this.spatial)+e.dot(this.rotational)}}class It{constructor(t,e,n=-1e6,r=1e6){this.id=It.id++,this.minForce=n,this.maxForce=r,this.bi=t,this.bj=e,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new Pt,this.jacobianElementB=new Pt,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(t,e,n){const r=e,i=t,s=n;this.a=4/(s*(1+4*r)),this.b=4*r/(1+4*r),this.eps=4/(s*s*i*(1+4*r))}computeB(t,e,n){const r=this.computeGW();return-this.computeGq()*t-r*e-this.computeGiMf()*n}computeGq(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,r=this.bj,i=n.position,s=r.position;return t.spatial.dot(i)+e.spatial.dot(s)}computeGW(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,r=this.bj,i=n.velocity,s=r.velocity,o=n.angularVelocity,a=r.angularVelocity;return t.multiplyVectors(i,o)+e.multiplyVectors(s,a)}computeGWlambda(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,r=this.bj,i=n.vlambda,s=r.vlambda,o=n.wlambda,a=r.wlambda;return t.multiplyVectors(i,o)+e.multiplyVectors(s,a)}computeGiMf(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,r=this.bj,i=n.force,s=n.torque,o=r.force,a=r.torque,l=n.invMassSolve,c=r.invMassSolve;return i.scale(l,Ot),o.scale(c,Ft),n.invInertiaWorldSolve.vmult(s,kt),r.invInertiaWorldSolve.vmult(a,Dt),t.multiplyVectors(Ot,kt)+e.multiplyVectors(Ft,Dt)}computeGiMGt(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,r=this.bj,i=n.invMassSolve,s=r.invMassSolve,o=n.invInertiaWorldSolve,a=r.invInertiaWorldSolve;let l=i+s;return o.vmult(t.rotational,Ut),l+=Ut.dot(t.rotational),a.vmult(e.rotational,Ut),l+=Ut.dot(e.rotational),l}addToWlambda(t){const e=this.jacobianElementA,n=this.jacobianElementB,r=this.bi,i=this.bj,s=zt;r.vlambda.addScaledVector(r.invMassSolve*t,e.spatial,r.vlambda),i.vlambda.addScaledVector(i.invMassSolve*t,n.spatial,i.vlambda),r.invInertiaWorldSolve.vmult(e.rotational,s),r.wlambda.addScaledVector(t,s,r.wlambda),i.invInertiaWorldSolve.vmult(n.rotational,s),i.wlambda.addScaledVector(t,s,i.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}It.id=0;const Ot=new a,Ft=new a,kt=new a,Dt=new a,Ut=new a,zt=new a;class jt extends It{constructor(t,e,n=1e6){super(t,e,0,n),this.restitution=0,this.ri=new a,this.rj=new a,this.ni=new a}computeB(t){const e=this.a,n=this.b,r=this.bi,i=this.bj,s=this.ri,o=this.rj,a=Gt,l=Ht,c=r.velocity,u=r.angularVelocity,h=(r.force,r.torque,i.velocity),p=i.angularVelocity,d=(i.force,i.torque,Vt),f=this.jacobianElementA,m=this.jacobianElementB,_=this.ni;s.cross(_,a),o.cross(_,l),_.negate(f.spatial),a.negate(f.rotational),m.spatial.copy(_),m.rotational.copy(l),d.copy(i.position),d.vadd(o,d),d.vsub(r.position,d),d.vsub(s,d);const g=_.dot(d),y=this.restitution+1;return-g*e-(y*h.dot(_)-y*c.dot(_)+p.dot(l)-u.dot(a))*n-t*this.computeGiMf()}getImpactVelocityAlongNormal(){const t=Wt,e=qt,n=Xt,r=Yt,i=Jt;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,r),this.bi.getVelocityAtWorldPoint(n,t),this.bj.getVelocityAtWorldPoint(r,e),t.vsub(e,i),this.ni.dot(i)}}const Gt=new a,Ht=new a,Vt=new a,Wt=new a,qt=new a,Xt=new a,Yt=new a,Jt=new a;class Zt extends Nt{constructor(t,e=new a,n,r=new a,i=1e6){super(t,n),this.pivotA=e.clone(),this.pivotB=r.clone();const s=this.equationX=new jt(t,n),o=this.equationY=new jt(t,n),l=this.equationZ=new jt(t,n);this.equations.push(s,o,l),s.minForce=o.minForce=l.minForce=-i,s.maxForce=o.maxForce=l.maxForce=i,s.ni.set(1,0,0),o.ni.set(0,1,0),l.ni.set(0,0,1)}update(){const t=this.bodyA,e=this.bodyB,n=this.equationX,r=this.equationY,i=this.equationZ;t.quaternion.vmult(this.pivotA,n.ri),e.quaternion.vmult(this.pivotB,n.rj),r.ri.copy(n.ri),r.rj.copy(n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj)}}class Qt extends It{constructor(t,e,n={}){const r=void 0!==n.maxForce?n.maxForce:1e6;super(t,e,-r,r),this.axisA=n.axisA?n.axisA.clone():new a(1,0,0),this.axisB=n.axisB?n.axisB.clone():new a(0,1,0),this.angle=void 0!==n.angle?n.angle:0}computeB(t){const e=this.a,n=this.b,r=this.axisA,i=this.axisB,s=Kt,o=te,a=this.jacobianElementA,l=this.jacobianElementB;return r.cross(i,s),i.cross(r,o),a.rotational.copy(o),l.rotational.copy(s),-(Math.cos(this.angle)-r.dot(i))*e-this.computeGW()*n-t*this.computeGiMf()}}const Kt=new a,te=new a;class ee extends It{constructor(t,e,n={}){const r=void 0!==n.maxForce?n.maxForce:1e6;super(t,e,-r,r),this.axisA=n.axisA?n.axisA.clone():new a(1,0,0),this.axisB=n.axisB?n.axisB.clone():new a(0,1,0),this.maxAngle=Math.PI/2}computeB(t){const e=this.a,n=this.b,r=this.axisA,i=this.axisB,s=ne,o=re,a=this.jacobianElementA,l=this.jacobianElementB;return r.cross(i,s),i.cross(r,o),a.rotational.copy(o),l.rotational.copy(s),-(Math.cos(this.maxAngle)-r.dot(i))*e-this.computeGW()*n-t*this.computeGiMf()}}const ne=new a,re=new a;class ie extends Zt{constructor(t,e,n={}){const r=void 0!==n.maxForce?n.maxForce:1e6;super(t,n.pivotA?n.pivotA.clone():new a,e,n.pivotB?n.pivotB.clone():new a,r),this.axisA=n.axisA?n.axisA.clone():new a,this.axisB=n.axisB?n.axisB.clone():new a,this.collideConnected=!!n.collideConnected,this.angle=void 0!==n.angle?n.angle:0;const i=this.coneEquation=new Qt(t,e,n),s=this.twistEquation=new ee(t,e,n);this.twistAngle=void 0!==n.twistAngle?n.twistAngle:0,i.maxForce=0,i.minForce=-r,s.maxForce=0,s.minForce=-r,this.equations.push(i,s)}update(){const t=this.bodyA,e=this.bodyB,n=this.coneEquation,r=this.twistEquation;super.update(),t.vectorToWorldFrame(this.axisA,n.axisA),e.vectorToWorldFrame(this.axisB,n.axisB),this.axisA.tangents(r.axisA,r.axisA),t.vectorToWorldFrame(r.axisA,r.axisA),this.axisB.tangents(r.axisB,r.axisB),e.vectorToWorldFrame(r.axisB,r.axisB),n.angle=this.angle,r.maxAngle=this.twistAngle}}class se extends Nt{constructor(t,e,n,r=1e6){super(t,e),void 0===n&&(n=t.position.distanceTo(e.position)),this.distance=n;const i=this.distanceEquation=new jt(t,e);this.equations.push(i),i.minForce=-r,i.maxForce=r}update(){const t=this.bodyA,e=this.bodyB,n=this.distanceEquation,r=.5*this.distance,i=n.ni;e.position.vsub(t.position,i),i.normalize(),i.scale(r,n.ri),i.scale(-r,n.rj)}}class oe extends Zt{constructor(t,e,n={}){const r=void 0!==n.maxForce?n.maxForce:1e6,i=new a,s=new a,o=new a;t.position.vadd(e.position,o),o.scale(.5,o),e.pointToLocalFrame(o,s),t.pointToLocalFrame(o,i),super(t,i,e,s,r),this.xA=t.vectorToLocalFrame(a.UNIT_X),this.xB=e.vectorToLocalFrame(a.UNIT_X),this.yA=t.vectorToLocalFrame(a.UNIT_Y),this.yB=e.vectorToLocalFrame(a.UNIT_Y),this.zA=t.vectorToLocalFrame(a.UNIT_Z),this.zB=e.vectorToLocalFrame(a.UNIT_Z);const l=this.rotationalEquation1=new ee(t,e,n),c=this.rotationalEquation2=new ee(t,e,n),u=this.rotationalEquation3=new ee(t,e,n);this.equations.push(l,c,u)}update(){const t=this.bodyA,e=this.bodyB,n=(this.motorEquation,this.rotationalEquation1),r=this.rotationalEquation2,i=this.rotationalEquation3;super.update(),t.vectorToWorldFrame(this.xA,n.axisA),e.vectorToWorldFrame(this.yB,n.axisB),t.vectorToWorldFrame(this.yA,r.axisA),e.vectorToWorldFrame(this.zB,r.axisB),t.vectorToWorldFrame(this.zA,i.axisA),e.vectorToWorldFrame(this.xB,i.axisB)}}class ae extends It{constructor(t,e,n=1e6){super(t,e,-n,n),this.axisA=new a,this.axisB=new a,this.targetVelocity=0}computeB(t){this.a;const e=this.b,n=(this.bi,this.bj,this.axisA),r=this.axisB,i=this.jacobianElementA,s=this.jacobianElementB;return i.rotational.copy(n),r.negate(s.rotational),-(this.computeGW()-this.targetVelocity)*e-t*this.computeGiMf()}}class le extends Zt{constructor(t,e,n={}){const r=void 0!==n.maxForce?n.maxForce:1e6;super(t,n.pivotA?n.pivotA.clone():new a,e,n.pivotB?n.pivotB.clone():new a,r),(this.axisA=n.axisA?n.axisA.clone():new a(1,0,0)).normalize(),(this.axisB=n.axisB?n.axisB.clone():new a(1,0,0)).normalize(),this.collideConnected=!!n.collideConnected;const i=this.rotationalEquation1=new ee(t,e,n),s=this.rotationalEquation2=new ee(t,e,n),o=this.motorEquation=new ae(t,e,r);o.enabled=!1,this.equations.push(i,s,o)}enableMotor(){this.motorEquation.enabled=!0}disableMotor(){this.motorEquation.enabled=!1}setMotorSpeed(t){this.motorEquation.targetVelocity=t}setMotorMaxForce(t){this.motorEquation.maxForce=t,this.motorEquation.minForce=-t}update(){const t=this.bodyA,e=this.bodyB,n=this.motorEquation,r=this.rotationalEquation1,i=this.rotationalEquation2,s=ce,o=ue,a=this.axisA,l=this.axisB;super.update(),t.quaternion.vmult(a,s),e.quaternion.vmult(l,o),s.tangents(r.axisA,i.axisA),r.axisB.copy(o),i.axisB.copy(o),this.motorEquation.enabled&&(t.quaternion.vmult(this.axisA,n.axisA),e.quaternion.vmult(this.axisB,n.axisB))}}const ce=new a,ue=new a;class he extends It{constructor(t,e,n){super(t,e,-n,n),this.ri=new a,this.rj=new a,this.t=new a}computeB(t){this.a;const e=this.b,n=(this.bi,this.bj,this.ri),r=this.rj,i=pe,s=de,o=this.t;n.cross(o,i),r.cross(o,s);const a=this.jacobianElementA,l=this.jacobianElementB;return o.negate(a.spatial),i.negate(a.rotational),l.spatial.copy(o),l.rotational.copy(s),-this.computeGW()*e-t*this.computeGiMf()}}const pe=new a,de=new a;class fe{constructor(t,e,n){n=Rt.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=fe.idCounter++,this.materials=[t,e],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}fe.idCounter=0;class me{constructor(t={}){let e="";"string"==typeof t&&(e=t,t={}),this.name=e,this.id=me.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}}me.idCounter=0;class _e{constructor(t,e,n={}){this.restLength="number"==typeof n.restLength?n.restLength:1,this.stiffness=n.stiffness||100,this.damping=n.damping||1,this.bodyA=t,this.bodyB=e,this.localAnchorA=new a,this.localAnchorB=new a,n.localAnchorA&&this.localAnchorA.copy(n.localAnchorA),n.localAnchorB&&this.localAnchorB.copy(n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB)}setWorldAnchorA(t){this.bodyA.pointToLocalFrame(t,this.localAnchorA)}setWorldAnchorB(t){this.bodyB.pointToLocalFrame(t,this.localAnchorB)}getWorldAnchorA(t){this.bodyA.pointToWorldFrame(this.localAnchorA,t)}getWorldAnchorB(t){this.bodyB.pointToWorldFrame(this.localAnchorB,t)}applyForce(){const t=this.stiffness,e=this.damping,n=this.restLength,r=this.bodyA,i=this.bodyB,s=ge,o=ye,a=ve,l=be,c=Ae,u=xe,h=we,p=Se,d=Me,f=Te,m=Ee;this.getWorldAnchorA(u),this.getWorldAnchorB(h),u.vsub(r.position,p),h.vsub(i.position,d),h.vsub(u,s);const _=s.length();o.copy(s),o.normalize(),i.velocity.vsub(r.velocity,a),i.angularVelocity.cross(d,c),a.vadd(c,a),r.angularVelocity.cross(p,c),a.vsub(c,a),o.scale(-t*(_-n)-e*a.dot(o),l),r.force.vsub(l,r.force),i.force.vadd(l,i.force),p.cross(l,f),d.cross(l,m),r.torque.vsub(f,r.torque),i.torque.vadd(m,i.torque)}}const ge=new a,ye=new a,ve=new a,be=new a,xe=new a,we=new a,Se=new a,Me=new a,Te=new a,Ee=new a,Ae=new a;class $e{constructor(t={}){t=Rt.defaults(t,{chassisConnectionPointLocal:new a,chassisConnectionPointWorld:new a,directionLocal:new a,directionWorld:new a,axleLocal:new a,axleWorld:new a,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,slipInfo:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=t.maxSuspensionTravel,this.customSlidingRotationalSpeed=t.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=t.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=t.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=t.chassisConnectionPointWorld.clone(),this.directionLocal=t.directionLocal.clone(),this.directionWorld=t.directionWorld.clone(),this.axleLocal=t.axleLocal.clone(),this.axleWorld=t.axleWorld.clone(),this.suspensionRestLength=t.suspensionRestLength,this.suspensionMaxLength=t.suspensionMaxLength,this.radius=t.radius,this.suspensionStiffness=t.suspensionStiffness,this.dampingCompression=t.dampingCompression,this.dampingRelaxation=t.dampingRelaxation,this.frictionSlip=t.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=t.rollInfluence,this.maxSuspensionForce=t.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=t.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.slipInfo=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new K,this.worldTransform=new x,this.isInContact=!1}updateWheel(t){const e=this.raycastResult;if(this.isInContact){const n=e.hitNormalWorld.dot(e.directionWorld);e.hitPointWorld.vsub(t.position,Be),t.getVelocityAtWorldPoint(Be,Ce);const r=e.hitNormalWorld.dot(Ce);if(n>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{const t=-1/n;this.suspensionRelativeVelocity=r*t,this.clippedInvContactDotSuspension=t}}else e.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.hitNormalWorld),this.clippedInvContactDotSuspension=1}}const Ce=new a,Be=new a;class Le{constructor(t){this.chassisBody=t.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==t.indexRightAxis?t.indexRightAxis:1,this.indexForwardAxis=void 0!==t.indexForwardAxis?t.indexForwardAxis:0,this.indexUpAxis=void 0!==t.indexUpAxis?t.indexUpAxis:2,this.constraints=[],this.preStepCallback=()=>{},this.currentVehicleSpeedKmHour=0}addWheel(t={}){const e=new $e(t),n=this.wheelInfos.length;return this.wheelInfos.push(e),n}setSteeringValue(t,e){this.wheelInfos[e].steering=t}applyEngineForce(t,e){this.wheelInfos[e].engineForce=t}setBrake(t,e){this.wheelInfos[e].brake=t}addToWorld(t){this.constraints,t.addBody(this.chassisBody);const e=this;this.preStepCallback=()=>{e.updateVehicle(t.dt)},t.addEventListener("preStep",this.preStepCallback),this.world=t}getVehicleAxisWorld(t,e){e.set(0===t?1:0,1===t?1:0,2===t?1:0),this.chassisBody.vectorToWorldFrame(e,e)}updateVehicle(t){const e=this.wheelInfos,n=e.length,r=this.chassisBody;for(let t=0;t<n;t++)this.updateWheelTransform(t);this.currentVehicleSpeedKmHour=3.6*r.velocity.length();const i=new a;this.getVehicleAxisWorld(this.indexForwardAxis,i),i.dot(r.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(let t=0;t<n;t++)this.castRay(e[t]);this.updateSuspension(t);const s=new a,o=new a;for(let i=0;i<n;i++){const n=e[i];let a=n.suspensionForce;a>n.maxSuspensionForce&&(a=n.maxSuspensionForce),n.raycastResult.hitNormalWorld.scale(a*t,s),n.raycastResult.hitPointWorld.vsub(r.position,o),r.applyImpulse(s,o)}this.updateFriction(t);const l=new a,c=new a,u=new a;for(let i=0;i<n;i++){const n=e[i];r.getVelocityAtWorldPoint(n.chassisConnectionPointWorld,u);let s=1;if(1===this.indexUpAxis&&(s=-1),n.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,c);const e=c.dot(n.raycastResult.hitNormalWorld);n.raycastResult.hitNormalWorld.scale(e,l),c.vsub(l,c);const r=c.dot(u);n.deltaRotation=s*r*t/n.radius}!n.sliding&&n.isInContact||0===n.engineForce||!n.useCustomSlidingRotationalSpeed||(n.deltaRotation=(n.engineForce>0?1:-1)*n.customSlidingRotationalSpeed*t),Math.abs(n.brake)>Math.abs(n.engineForce)&&(n.deltaRotation=0),n.rotation+=n.deltaRotation,n.deltaRotation*=.99}}updateSuspension(t){const e=this.chassisBody.mass,n=this.wheelInfos,r=n.length;for(let t=0;t<r;t++){const r=n[t];if(r.isInContact){let t;const n=r.suspensionRestLength-r.suspensionLength;t=r.suspensionStiffness*n*r.clippedInvContactDotSuspension;const i=r.suspensionRelativeVelocity;let s;s=i<0?r.dampingCompression:r.dampingRelaxation,t-=s*i,r.suspensionForce=t*e,r.suspensionForce<0&&(r.suspensionForce=0)}else r.suspensionForce=0}}removeFromWorld(t){this.constraints,t.removeBody(this.chassisBody),t.removeEventListener("preStep",this.preStepCallback),this.world=null}castRay(t){const e=Ie,n=Oe;this.updateWheelTransformWorld(t);const r=this.chassisBody;let i=-1;const s=t.suspensionRestLength+t.radius;t.directionWorld.scale(s,e);const o=t.chassisConnectionPointWorld;o.vadd(e,n);const l=t.raycastResult;l.reset();const c=r.collisionResponse;r.collisionResponse=!1,this.world.rayTest(o,n,l),r.collisionResponse=c;const u=l.body;if(t.raycastResult.groundObject=0,u){i=l.distance,t.raycastResult.hitNormalWorld=l.hitNormalWorld,t.isInContact=!0;const e=l.distance;t.suspensionLength=e-t.radius;const n=t.suspensionRestLength-t.maxSuspensionTravel,s=t.suspensionRestLength+t.maxSuspensionTravel;t.suspensionLength<n&&(t.suspensionLength=n),t.suspensionLength>s&&(t.suspensionLength=s,t.raycastResult.reset());const o=t.raycastResult.hitNormalWorld.dot(t.directionWorld),c=new a;r.getVelocityAtWorldPoint(t.raycastResult.hitPointWorld,c);const u=t.raycastResult.hitNormalWorld.dot(c);if(o>=-.1)t.suspensionRelativeVelocity=0,t.clippedInvContactDotSuspension=10;else{const e=-1/o;t.suspensionRelativeVelocity=u*e,t.clippedInvContactDotSuspension=e}}else t.suspensionLength=t.suspensionRestLength+0*t.maxSuspensionTravel,t.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.raycastResult.hitNormalWorld),t.clippedInvContactDotSuspension=1;return i}updateWheelTransformWorld(t){t.isInContact=!1;const e=this.chassisBody;e.pointToWorldFrame(t.chassisConnectionPointLocal,t.chassisConnectionPointWorld),e.vectorToWorldFrame(t.directionLocal,t.directionWorld),e.vectorToWorldFrame(t.axleLocal,t.axleWorld)}updateWheelTransform(t){const e=Re,n=Ne,r=Pe,i=this.wheelInfos[t];this.updateWheelTransformWorld(i),i.directionLocal.scale(-1,e),n.copy(i.axleLocal),e.cross(n,r),r.normalize(),n.normalize();const s=i.steering,o=new _;o.setFromAxisAngle(e,s);const a=new _;a.setFromAxisAngle(n,i.rotation);const l=i.worldTransform.quaternion;this.chassisBody.quaternion.mult(o,l),l.mult(a,l),l.normalize();const c=i.worldTransform.position;c.copy(i.directionWorld),c.scale(i.suspensionLength,c),c.vadd(i.chassisConnectionPointWorld,c)}getWheelTransformWorld(t){return this.wheelInfos[t].worldTransform}updateFriction(t){const e=ke,n=this.wheelInfos,r=n.length,i=this.chassisBody,s=Ue,o=De;for(let t=0;t<r;t++){const e=n[t];e.raycastResult.body,e.sideImpulse=0,e.forwardImpulse=0,s[t]||(s[t]=new a),o[t]||(o[t]=new a)}for(let t=0;t<r;t++){const r=n[t],a=r.raycastResult.body;if(a){const n=o[t];this.getWheelTransformWorld(t).vectorToWorldFrame(Fe[this.indexRightAxis],n);const l=r.raycastResult.hitNormalWorld,c=n.dot(l);l.scale(c,e),n.vsub(e,n),n.normalize(),l.cross(n,s[t]),s[t].normalize(),r.sideImpulse=tn(i,r.raycastResult.hitPointWorld,a,r.raycastResult.hitPointWorld,n),r.sideImpulse*=ze}}this.sliding=!1;for(let e=0;e<r;e++){const r=n[e],o=r.raycastResult.body;let a=0;if(r.slipInfo=1,o){const n=0,l=r.brake?r.brake:n;a=Ve(i,o,r.raycastResult.hitPointWorld,s[e],l),a+=r.engineForce*t;const c=l/a;r.slipInfo*=c}if(r.forwardImpulse=0,r.skidInfo=1,o){r.skidInfo=1;const e=r.suspensionForce*t*r.frictionSlip,n=e*e;r.forwardImpulse=a;const i=.5*r.forwardImpulse,s=1*r.sideImpulse,o=i*i+s*s;if(r.sliding=!1,o>n){this.sliding=!0,r.sliding=!0;const t=e/Math.sqrt(o);r.skidInfo*=t}}}if(this.sliding)for(let t=0;t<r;t++){const e=n[t];0!==e.sideImpulse&&e.skidInfo<1&&(e.forwardImpulse*=e.skidInfo,e.sideImpulse*=e.skidInfo)}for(let t=0;t<r;t++){const e=n[t],r=new a;if(e.raycastResult.hitPointWorld.vsub(i.position,r),0!==e.forwardImpulse){const n=new a;s[t].scale(e.forwardImpulse,n),i.applyImpulse(n,r)}if(0!==e.sideImpulse){const n=e.raycastResult.body,s=new a;e.raycastResult.hitPointWorld.vsub(n.position,s);const l=new a;o[t].scale(e.sideImpulse,l),i.vectorToLocalFrame(r,r),r["xyz"[this.indexUpAxis]]*=e.rollInfluence,i.vectorToWorldFrame(r,r),i.applyImpulse(l,r),l.scale(-1,l),n.applyImpulse(l,s)}}}}const Re=new a,Ne=new a,Pe=new a,Ie=(new et,new a),Oe=new a,Fe=[new a(1,0,0),new a(0,1,0),new a(0,0,1)],ke=new a,De=[],Ue=[],ze=1,je=new a,Ge=new a,He=new a;function Ve(t,e,n,r,i){let s=0;const o=n,a=je,l=Ge,c=He;return t.getVelocityAtWorldPoint(o,a),e.getVelocityAtWorldPoint(o,l),a.vsub(l,c),s=-r.dot(c)*(1/(Je(t,n,r)+Je(e,n,r))),i<s&&(s=i),s<-i&&(s=-i),s}const We=new a,qe=new a,Xe=new a,Ye=new a;function Je(t,e,n){const r=We,i=qe,s=Xe,o=Ye;return e.vsub(t.position,r),r.cross(n,i),t.invInertiaWorld.vmult(i,o),o.cross(r,s),t.invMass+n.dot(s)}const Ze=new a,Qe=new a,Ke=new a;function tn(t,e,n,r,i){if(i.lengthSquared()>1.1)return 0;const s=Ze,o=Qe,a=Ke;return t.getVelocityAtWorldPoint(e,s),n.getVelocityAtWorldPoint(r,o),s.vsub(o,a),-.2*i.dot(a)*(1/(t.invMass+n.invMass))}class en extends b{constructor(t){if(super({type:b.types.SPHERE}),this.radius=void 0!==t?t:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(t,e=new a){const n=2*t*this.radius*this.radius/5;return e.x=n,e.y=n,e.z=n,e}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(t,e,n,r){const i=this.radius,s=["x","y","z"];for(let e=0;e<s.length;e++){const o=s[e];n[o]=t[o]-i,r[o]=t[o]+i}}}class nn{constructor(t={}){this.wheelBodies=[],this.coordinateSystem=void 0!==t.coordinateSystem?t.coordinateSystem.clone():new a(1,2,3),t.chassisBody?this.chassisBody=t.chassisBody:this.chassisBody=new L({mass:1,shape:new E(new a(5,2,.5))}),this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}addWheel(t={}){let e;e=t.body?t.body:new L({mass:1,shape:new en(1.2)}),this.wheelBodies.push(e),this.wheelForces.push(0);const n=void 0!==t.position?t.position.clone():new a,r=new a;this.chassisBody.pointToWorldFrame(n,r),e.position.set(r.x,r.y,r.z);const i=void 0!==t.axis?t.axis.clone():new a(0,1,0);this.wheelAxes.push(i);const s=new le(this.chassisBody,e,{pivotA:n,axisA:i,pivotB:a.ZERO,axisB:i,collideConnected:!1});return this.constraints.push(s),this.wheelBodies.length-1}setSteeringValue(t,e){const n=this.wheelAxes[e],r=Math.cos(t),i=Math.sin(t),s=n.x,o=n.y;this.constraints[e].axisA.set(r*s-i*o,i*s+r*o,0)}setMotorSpeed(t,e){const n=this.constraints[e];n.enableMotor(),n.motorTargetVelocity=t}disableMotor(t){this.constraints[t].disableMotor()}setWheelForce(t,e){this.wheelForces[e]=t}applyWheelForce(t,e){const n=this.wheelAxes[e],r=this.wheelBodies[e],i=r.torque;n.scale(t,rn),r.vectorToWorldFrame(rn,rn),i.vadd(rn,i)}addToWorld(t){const e=this.constraints,n=this.wheelBodies.concat([this.chassisBody]);for(let e=0;e<n.length;e++)t.addBody(n[e]);for(let n=0;n<e.length;n++)t.addConstraint(e[n]);t.addEventListener("preStep",this._update.bind(this))}_update(){const t=this.wheelForces;for(let e=0;e<t.length;e++)this.applyWheelForce(t[e],e)}removeFromWorld(t){const e=this.constraints,n=this.wheelBodies.concat([this.chassisBody]);for(let e=0;e<n.length;e++)t.removeBody(n[e]);for(let n=0;n<e.length;n++)t.removeConstraint(e[n])}getWheelSpeed(t){const e=this.wheelAxes[t],n=this.wheelBodies[t].angularVelocity;return this.chassisBody.vectorToWorldFrame(e,sn),n.dot(sn)}}const rn=new a,sn=new a;class on{constructor(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}add(t){this.particles.push(t),this.neighbors.length<this.particles.length&&this.neighbors.push([])}remove(t){const e=this.particles.indexOf(t);-1!==e&&(this.particles.splice(e,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())}getNeighbors(t,e){const n=this.particles.length,r=t.id,i=this.smoothingRadius*this.smoothingRadius,s=an;for(let o=0;o!==n;o++){const n=this.particles[o];n.position.vsub(t.position,s),r!==n.id&&s.lengthSquared()<i&&e.push(n)}}update(){const t=this.particles.length,e=ln,n=this.speedOfSound,r=this.eps;for(let r=0;r!==t;r++){const t=this.particles[r],i=this.neighbors[r];i.length=0,this.getNeighbors(t,i),i.push(this.particles[r]);const s=i.length;let o=0;for(let n=0;n!==s;n++){t.position.vsub(i[n].position,e);const r=e.length(),s=this.w(r);o+=i[n].mass*s}this.densities[r]=o,this.pressures[r]=n*n*(this.densities[r]-this.density)}const i=cn,s=un,o=hn,a=pn,l=dn;for(let e=0;e!==t;e++){const t=this.particles[e];let n,c;i.set(0,0,0),s.set(0,0,0);const u=this.neighbors[e],h=u.length;for(let p=0;p!==h;p++){const h=u[p];t.position.vsub(h.position,a);const d=a.length();n=-h.mass*(this.pressures[e]/(this.densities[e]*this.densities[e]+r)+this.pressures[p]/(this.densities[p]*this.densities[p]+r)),this.gradw(a,o),o.scale(n,o),i.vadd(o,i),h.velocity.vsub(t.velocity,l),l.scale(1/(1e-4+this.densities[e]*this.densities[p])*this.viscosity*h.mass,l),c=this.nablaw(d),l.scale(c,l),s.vadd(l,s)}s.scale(t.mass,s),i.scale(t.mass,i),t.force.vadd(s,t.force),t.force.vadd(i,t.force)}}w(t){const e=this.smoothingRadius;return 315/(64*Math.PI*e**9)*(e*e-t*t)**3}gradw(t,e){const n=t.length(),r=this.smoothingRadius;t.scale(945/(32*Math.PI*r**9)*(r*r-n*n)**2,e)}nablaw(t){const e=this.smoothingRadius;return 945/(32*Math.PI*e**9)*(e*e-t*t)*(7*t*t-3*e*e)}}const an=new a,ln=new a,cn=new a,un=new a,hn=new a,pn=new a,dn=new a;class fn extends S{constructor(t,e,n,r){const i=r,s=[],o=[],l=[],c=[],u=[],h=Math.cos,p=Math.sin;s.push(new a(e*h(0),e*p(0),.5*-n)),c.push(0),s.push(new a(t*h(0),t*p(0),.5*n)),u.push(1);for(let r=0;r<i;r++){const d=2*Math.PI/i*(r+1),f=2*Math.PI/i*(r+.5);r<i-1?(s.push(new a(e*h(d),e*p(d),.5*-n)),c.push(2*r+2),s.push(new a(t*h(d),t*p(d),.5*n)),u.push(2*r+3),l.push([2*r+2,2*r+3,2*r+1,2*r])):l.push([0,1,2*r+1,2*r]),(i%2==1||r<i/2)&&o.push(new a(h(f),p(f),0))}l.push(u),o.push(new a(0,0,1));const d=[];for(let t=0;t<c.length;t++)d.push(c[c.length-t-1]);l.push(d),super({vertices:s,faces:l,axes:o})}}class mn extends b{constructor(){super({type:b.types.PARTICLE})}calculateLocalInertia(t,e=new a){return e.set(0,0,0),e}volume(){return 0}updateBoundingSphereRadius(){this.boundingSphereRadius=0}calculateWorldAABB(t,e,n,r){n.copy(t),r.copy(t)}}class _n extends b{constructor(){super({type:b.types.PLANE}),this.worldNormal=new a,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(t){const e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(t,e=new a){return e}volume(){return Number.MAX_VALUE}calculateWorldAABB(t,e,n,r){gn.set(0,0,1),e.vmult(gn,gn);const i=Number.MAX_VALUE;n.set(-i,-i,-i),r.set(i,i,i),1===gn.x?r.x=t.x:-1===gn.x&&(n.x=t.x),1===gn.y?r.y=t.y:-1===gn.y&&(n.y=t.y),1===gn.z?r.z=t.z:-1===gn.z&&(n.z=t.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const gn=new a;class yn extends b{constructor(t,e={}){e=Rt.defaults(e,{maxValue:null,minValue:null,elementSize:1}),super({type:b.types.HEIGHTFIELD}),this.data=t,this.maxValue=e.maxValue,this.minValue=e.minValue,this.elementSize=e.elementSize,null===e.minValue&&this.updateMinValue(),null===e.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,this.pillarConvex=new S,this.pillarOffset=new a,this.updateBoundingSphereRadius(),this._cachedPillars={}}update(){this._cachedPillars={}}updateMinValue(){const t=this.data;let e=t[0][0];for(let n=0;n!==t.length;n++)for(let r=0;r!==t[n].length;r++){const i=t[n][r];i<e&&(e=i)}this.minValue=e}updateMaxValue(){const t=this.data;let e=t[0][0];for(let n=0;n!==t.length;n++)for(let r=0;r!==t[n].length;r++){const i=t[n][r];i>e&&(e=i)}this.maxValue=e}setHeightValueAtIndex(t,e,n){this.data[t][e]=n,this.clearCachedConvexTrianglePillar(t,e,!1),t>0&&(this.clearCachedConvexTrianglePillar(t-1,e,!0),this.clearCachedConvexTrianglePillar(t-1,e,!1)),e>0&&(this.clearCachedConvexTrianglePillar(t,e-1,!0),this.clearCachedConvexTrianglePillar(t,e-1,!1)),e>0&&t>0&&this.clearCachedConvexTrianglePillar(t-1,e-1,!0)}getRectMinMax(t,e,n,r,i=[]){const s=this.data;let o=this.minValue;for(let i=t;i<=n;i++)for(let t=e;t<=r;t++){const e=s[i][t];e>o&&(o=e)}i[0]=this.minValue,i[1]=o}getIndexOfPosition(t,e,n,r){const i=this.elementSize,s=this.data;let o=Math.floor(t/i),a=Math.floor(e/i);return n[0]=o,n[1]=a,r&&(o<0&&(o=0),a<0&&(a=0),o>=s.length-1&&(o=s.length-1),a>=s[0].length-1&&(a=s[0].length-1)),!(o<0||a<0||o>=s.length-1||a>=s[0].length-1)}getTriangleAt(t,e,n,r,i,s){const o=vn;this.getIndexOfPosition(t,e,o,n);let a=o[0],l=o[1];const c=this.data;n&&(a=Math.min(c.length-2,Math.max(0,a)),l=Math.min(c[0].length-2,Math.max(0,l)));const u=this.elementSize,h=(t/u-a)**2+(e/u-l)**2>(t/u-(a+1))**2+(e/u-(l+1))**2;return this.getTriangle(a,l,h,r,i,s),h}getNormalAt(t,e,n,r){const i=Mn,s=Tn,o=En,a=An,l=$n;this.getTriangleAt(t,e,n,i,s,o),s.vsub(i,a),o.vsub(i,l),a.cross(l,r),r.normalize()}getAabbAtIndex(t,e,{lowerBound:n,upperBound:r}){const i=this.data,s=this.elementSize;n.set(t*s,e*s,i[t][e]),r.set((t+1)*s,(e+1)*s,i[t+1][e+1])}getHeightAt(t,e,n){const r=this.data,i=xn,s=wn,o=Sn,a=vn;this.getIndexOfPosition(t,e,a,n);let l=a[0],c=a[1];n&&(l=Math.min(r.length-2,Math.max(0,l)),c=Math.min(r[0].length-2,Math.max(0,c)));const u=this.getTriangleAt(t,e,n,i,s,o);!function(t,e,n,r,i,s,o,a,l){l.x=((s-a)*(t-o)+(o-i)*(e-a))/((s-a)*(n-o)+(o-i)*(r-a)),l.y=((a-r)*(t-o)+(n-o)*(e-a))/((s-a)*(n-o)+(o-i)*(r-a)),l.z=1-l.x-l.y}(t,e,i.x,i.y,s.x,s.y,o.x,o.y,bn);const h=bn;return u?r[l+1][c+1]*h.x+r[l][c+1]*h.y+r[l+1][c]*h.z:r[l][c]*h.x+r[l+1][c]*h.y+r[l][c+1]*h.z}getCacheConvexTrianglePillarKey(t,e,n){return t+"_"+e+"_"+(n?1:0)}getCachedConvexTrianglePillar(t,e,n){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]}setCachedConvexTrianglePillar(t,e,n,r,i){this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]={convex:r,offset:i}}clearCachedConvexTrianglePillar(t,e,n){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]}getTriangle(t,e,n,r,i,s){const o=this.data,a=this.elementSize;n?(r.set((t+1)*a,(e+1)*a,o[t+1][e+1]),i.set(t*a,(e+1)*a,o[t][e+1]),s.set((t+1)*a,e*a,o[t+1][e])):(r.set(t*a,e*a,o[t][e]),i.set((t+1)*a,e*a,o[t+1][e]),s.set(t*a,(e+1)*a,o[t][e+1]))}getConvexTrianglePillar(t,e,n){let r=this.pillarConvex,i=this.pillarOffset;if(this.cacheEnabled){const s=this.getCachedConvexTrianglePillar(t,e,n);if(s)return this.pillarConvex=s.convex,void(this.pillarOffset=s.offset);r=new S,i=new a,this.pillarConvex=r,this.pillarOffset=i}const s=this.data,o=this.elementSize,l=r.faces;r.vertices.length=6;for(let t=0;t<6;t++)r.vertices[t]||(r.vertices[t]=new a);l.length=5;for(let t=0;t<5;t++)l[t]||(l[t]=[]);const c=r.vertices,u=(Math.min(s[t][e],s[t+1][e],s[t][e+1],s[t+1][e+1])-this.minValue)/2+this.minValue;n?(i.set((t+.75)*o,(e+.75)*o,u),c[0].set(.25*o,.25*o,s[t+1][e+1]-u),c[1].set(-.75*o,.25*o,s[t][e+1]-u),c[2].set(.25*o,-.75*o,s[t+1][e]-u),c[3].set(.25*o,.25*o,-u-1),c[4].set(-.75*o,.25*o,-u-1),c[5].set(.25*o,-.75*o,-u-1),l[0][0]=0,l[0][1]=1,l[0][2]=2,l[1][0]=5,l[1][1]=4,l[1][2]=3,l[2][0]=2,l[2][1]=5,l[2][2]=3,l[2][3]=0,l[3][0]=3,l[3][1]=4,l[3][2]=1,l[3][3]=0,l[4][0]=1,l[4][1]=4,l[4][2]=5,l[4][3]=2):(i.set((t+.25)*o,(e+.25)*o,u),c[0].set(-.25*o,-.25*o,s[t][e]-u),c[1].set(.75*o,-.25*o,s[t+1][e]-u),c[2].set(-.25*o,.75*o,s[t][e+1]-u),c[3].set(-.25*o,-.25*o,-u-1),c[4].set(.75*o,-.25*o,-u-1),c[5].set(-.25*o,.75*o,-u-1),l[0][0]=0,l[0][1]=1,l[0][2]=2,l[1][0]=5,l[1][1]=4,l[1][2]=3,l[2][0]=0,l[2][1]=2,l[2][2]=5,l[2][3]=3,l[3][0]=1,l[3][1]=0,l[3][2]=3,l[3][3]=4,l[4][0]=4,l[4][1]=5,l[4][2]=2,l[4][3]=1),r.computeNormals(),r.computeEdges(),r.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(t,e,n,r,i)}calculateLocalInertia(t,e=new a){return e.set(0,0,0),e}volume(){return Number.MAX_VALUE}calculateWorldAABB(t,e,n,r){n.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}updateBoundingSphereRadius(){const t=this.data,e=this.elementSize;this.boundingSphereRadius=new a(t.length*e,t[0].length*e,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).length()}setHeightsFromImage(t,e){const{x:n,z:r,y:i}=e,s=document.createElement("canvas");s.width=t.width,s.height=t.height;const o=s.getContext("2d");o.drawImage(t,0,0);const a=o.getImageData(0,0,t.width,t.height),l=this.data;l.length=0,this.elementSize=Math.abs(n)/a.width;for(let t=0;t<a.height;t++){const e=[];for(let i=0;i<a.width;i++){const s=(a.data[4*(t*a.height+i)]+a.data[4*(t*a.height+i)+1]+a.data[4*(t*a.height+i)+2])/4/255*r;n<0?e.push(s):e.unshift(s)}i<0?l.unshift(e):l.push(e)}this.updateMaxValue(),this.updateMinValue(),this.update()}}const vn=[],bn=new a,xn=new a,wn=new a,Sn=new a,Mn=new a,Tn=new a,En=new a,An=new a,$n=new a;class Cn{constructor(t={}){this.root=t.root||null,this.aabb=t.aabb?t.aabb.clone():new h,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(t,e,n=0){const r=this.data;if(!this.aabb.contains(t))return!1;const i=this.children;if(n<(this.maxDepth||this.root.maxDepth)){let r=!1;i.length||(this.subdivide(),r=!0);for(let r=0;8!==r;r++)if(i[r].insert(t,e,n+1))return!0;r&&(i.length=0)}return r.push(e),!0}subdivide(){const t=this.aabb,e=t.lowerBound,n=t.upperBound,r=this.children;r.push(new Cn({aabb:new h({lowerBound:new a(0,0,0)})}),new Cn({aabb:new h({lowerBound:new a(1,0,0)})}),new Cn({aabb:new h({lowerBound:new a(1,1,0)})}),new Cn({aabb:new h({lowerBound:new a(1,1,1)})}),new Cn({aabb:new h({lowerBound:new a(0,1,1)})}),new Cn({aabb:new h({lowerBound:new a(0,0,1)})}),new Cn({aabb:new h({lowerBound:new a(1,0,1)})}),new Cn({aabb:new h({lowerBound:new a(0,1,0)})})),n.vsub(e,Ln),Ln.scale(.5,Ln);const i=this.root||this;for(let t=0;8!==t;t++){const n=r[t];n.root=i;const s=n.aabb.lowerBound;s.x*=Ln.x,s.y*=Ln.y,s.z*=Ln.z,s.vadd(e,s),s.vadd(Ln,n.aabb.upperBound)}}aabbQuery(t,e){this.data,this.children;const n=[this];for(;n.length;){const r=n.pop();r.aabb.overlaps(t)&&Array.prototype.push.apply(e,r.data),Array.prototype.push.apply(n,r.children)}return e}rayQuery(t,e,n){return t.getAABB(Rn),Rn.toLocalFrame(e,Rn),this.aabbQuery(Rn,n),n}removeEmptyNodes(){for(let t=this.children.length-1;t>=0;t--)this.children[t].removeEmptyNodes(),this.children[t].children.length||this.children[t].data.length||this.children.splice(t,1)}}class Bn extends Cn{constructor(t,e={}){super({root:null,aabb:t}),this.maxDepth=void 0!==e.maxDepth?e.maxDepth:8}}const Ln=new a,Rn=new h;class Nn extends b{constructor(t,e){super({type:b.types.TRIMESH}),this.vertices=new Float32Array(t),this.indices=new Int16Array(e),this.normals=new Float32Array(e.length),this.aabb=new h,this.edges=null,this.scale=new a(1,1,1),this.tree=new Bn,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const t=this.tree;t.reset(),t.aabb.copy(this.aabb);const e=this.scale;t.aabb.lowerBound.x*=1/e.x,t.aabb.lowerBound.y*=1/e.y,t.aabb.lowerBound.z*=1/e.z,t.aabb.upperBound.x*=1/e.x,t.aabb.upperBound.y*=1/e.y,t.aabb.upperBound.z*=1/e.z;const n=new h,r=new a,i=new a,s=new a,o=[r,i,s];for(let e=0;e<this.indices.length/3;e++){const a=3*e;this._getUnscaledVertex(this.indices[a],r),this._getUnscaledVertex(this.indices[a+1],i),this._getUnscaledVertex(this.indices[a+2],s),n.setFromPoints(o),t.insert(n,e)}t.removeEmptyNodes()}getTrianglesInAABB(t,e){In.copy(t);const n=this.scale,r=n.x,i=n.y,s=n.z,o=In.lowerBound,a=In.upperBound;return o.x/=r,o.y/=i,o.z/=s,a.x/=r,a.y/=i,a.z/=s,this.tree.aabbQuery(In,e)}setScale(t){const e=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,n=t.x===t.y&&t.y===t.z;e&&n||this.updateNormals(),this.scale.copy(t),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const t=Pn,e=this.normals;for(let n=0;n<this.indices.length/3;n++){const r=3*n,i=this.indices[r],s=this.indices[r+1],o=this.indices[r+2];this.getVertex(i,Un),this.getVertex(s,zn),this.getVertex(o,jn),Nn.computeNormal(zn,Un,jn,t),e[r]=t.x,e[r+1]=t.y,e[r+2]=t.z}}updateEdges(){const t={},e=(e,n)=>{t[e<n?e+"_"+n:n+"_"+e]=!0};for(let t=0;t<this.indices.length/3;t++){const n=3*t,r=this.indices[n],i=this.indices[n+1],s=this.indices[n+2];e(r,i),e(i,s),e(s,r)}const n=Object.keys(t);this.edges=new Int16Array(2*n.length);for(let t=0;t<n.length;t++){const e=n[t].split("_");this.edges[2*t]=parseInt(e[0],10),this.edges[2*t+1]=parseInt(e[1],10)}}getEdgeVertex(t,e,n){const r=this.edges[2*t+(e?1:0)];this.getVertex(r,n)}getEdgeVector(t,e){const n=On,r=Fn;this.getEdgeVertex(t,0,n),this.getEdgeVertex(t,1,r),r.vsub(n,e)}getVertex(t,e){const n=this.scale;return this._getUnscaledVertex(t,e),e.x*=n.x,e.y*=n.y,e.z*=n.z,e}_getUnscaledVertex(t,e){const n=3*t,r=this.vertices;return e.set(r[n],r[n+1],r[n+2])}getWorldVertex(t,e,n,r){return this.getVertex(t,r),x.pointToWorldFrame(e,n,r,r),r}getTriangleVertices(t,e,n,r){const i=3*t;this.getVertex(this.indices[i],e),this.getVertex(this.indices[i+1],n),this.getVertex(this.indices[i+2],r)}getNormal(t,e){const n=3*t;return e.set(this.normals[n],this.normals[n+1],this.normals[n+2])}calculateLocalInertia(t,e){this.computeLocalAABB(Gn);const n=Gn.upperBound.x-Gn.lowerBound.x,r=Gn.upperBound.y-Gn.lowerBound.y,i=Gn.upperBound.z-Gn.lowerBound.z;return e.set(1/12*t*(2*r*2*r+2*i*2*i),1/12*t*(2*n*2*n+2*i*2*i),1/12*t*(2*r*2*r+2*n*2*n))}computeLocalAABB(t){const e=t.lowerBound,n=t.upperBound,r=this.vertices.length,i=(this.vertices,Hn);this.getVertex(0,i),e.copy(i),n.copy(i);for(let t=0;t!==r;t++)this.getVertex(t,i),i.x<e.x?e.x=i.x:i.x>n.x&&(n.x=i.x),i.y<e.y?e.y=i.y:i.y>n.y&&(n.y=i.y),i.z<e.z?e.z=i.z:i.z>n.z&&(n.z=i.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let t=0;const e=this.vertices,n=new a;for(let r=0,i=e.length/3;r!==i;r++){this.getVertex(r,n);const e=n.lengthSquared();e>t&&(t=e)}this.boundingSphereRadius=Math.sqrt(t)}calculateWorldAABB(t,e,n,r){const i=Vn,s=Wn;i.position=t,i.quaternion=e,this.aabb.toWorldFrame(i,s),n.copy(s.lowerBound),r.copy(s.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}}const Pn=new a,In=new h,On=new a,Fn=new a,kn=new a,Dn=new a;Nn.computeNormal=(t,e,n,r)=>{e.vsub(t,Dn),n.vsub(e,kn),kn.cross(Dn,r),r.isZero()||r.normalize()};const Un=new a,zn=new a,jn=new a,Gn=new h,Hn=new a,Vn=new x,Wn=new h;Nn.createTorus=(t=1,e=.5,n=8,r=6,i=2*Math.PI)=>{const s=[],o=[];for(let o=0;o<=n;o++)for(let a=0;a<=r;a++){const l=a/r*i,c=o/n*Math.PI*2,u=(t+e*Math.cos(c))*Math.cos(l),h=(t+e*Math.cos(c))*Math.sin(l),p=e*Math.sin(c);s.push(u,h,p)}for(let t=1;t<=n;t++)for(let e=1;e<=r;e++){const n=(r+1)*t+e-1,i=(r+1)*(t-1)+e-1,s=(r+1)*(t-1)+e,a=(r+1)*t+e;o.push(n,i,a),o.push(i,s,a)}return new Nn(s,o)};class qn{constructor(){this.equations=[]}solve(t,e){return 0}addEquation(t){t.enabled&&this.equations.push(t)}removeEquation(t){const e=this.equations,n=e.indexOf(t);-1!==n&&e.splice(n,1)}removeAllEquations(){this.equations.length=0}}class Xn extends qn{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(t,e){let n=0;const r=this.iterations,i=this.tolerance*this.tolerance,s=this.equations,o=s.length,a=e.bodies,l=a.length,c=t;let u,h,p,d,f,m;if(0!==o)for(let t=0;t!==l;t++)a[t].updateSolveMassProperties();const _=Jn,g=Zn,y=Yn;_.length=o,g.length=o,y.length=o;for(let t=0;t!==o;t++){const e=s[t];y[t]=0,g[t]=e.computeB(c),_[t]=1/e.computeC()}if(0!==o){for(let t=0;t!==l;t++){const e=a[t],n=e.vlambda,r=e.wlambda;n.set(0,0,0),r.set(0,0,0)}for(n=0;n!==r;n++){d=0;for(let t=0;t!==o;t++){const e=s[t];u=g[t],h=_[t],m=y[t],f=e.computeGWlambda(),p=h*(u-f-e.eps*m),m+p<e.minForce?p=e.minForce-m:m+p>e.maxForce&&(p=e.maxForce-m),y[t]+=p,d+=p>0?p:-p,e.addToWlambda(p)}if(d*d<i)break}for(let t=0;t!==l;t++){const e=a[t],n=e.velocity,r=e.angularVelocity;e.vlambda.vmul(e.linearFactor,e.vlambda),n.vadd(e.vlambda,n),e.wlambda.vmul(e.angularFactor,e.wlambda),r.vadd(e.wlambda,r)}let t=s.length;const e=1/c;for(;t--;)s[t].multiplier=y[t]*e}return n}}const Yn=[],Jn=[],Zn=[];class Qn extends qn{constructor(t){for(super(),this.iterations=10,this.tolerance=1e-7,this.subsolver=t,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}createNode(){return{body:null,children:[],eqs:[],visited:!1}}solve(t,e){const n=Kn,r=this.nodePool,i=e.bodies,s=this.equations,o=s.length,a=i.length,l=this.subsolver;for(;r.length<a;)r.push(this.createNode());n.length=a;for(let t=0;t<a;t++)n[t]=r[t];for(let t=0;t!==a;t++){const e=n[t];e.body=i[t],e.children.length=0,e.eqs.length=0,e.visited=!1}for(let t=0;t!==o;t++){const e=s[t],r=i.indexOf(e.bi),o=i.indexOf(e.bj),a=n[r],l=n[o];a.children.push(l),a.eqs.push(e),l.children.push(a),l.eqs.push(e)}let c,u=0,h=tr;l.tolerance=this.tolerance,l.iterations=this.iterations;const p=er;for(;c=rr(n);){h.length=0,p.bodies.length=0,sr(c,or,p.bodies,h);const e=h.length;h=h.sort(ar);for(let t=0;t!==e;t++)l.addEquation(h[t]);l.solve(t,p),l.removeAllEquations(),u++}return u}}const Kn=[],tr=[],er={bodies:[]},nr=L.STATIC;function rr(t){const e=t.length;for(let n=0;n!==e;n++){const e=t[n];if(!(e.visited||e.body.type&nr))return e}return!1}const ir=[];function sr(t,e,n,r){for(ir.push(t),t.visited=!0,e(t,n,r);ir.length;){const t=ir.pop();let i;for(;i=rr(t.children);)i.visited=!0,e(i,n,r),ir.push(i)}}function or(t,e,n){e.push(t.body);const r=t.eqs.length;for(let e=0;e!==r;e++){const r=t.eqs[e];n.includes(r)||n.push(r)}}function ar(t,e){return e.id-t.id}class lr{constructor(){this.objects=[],this.type=Object}release(...t){const e=t.length;for(let n=0;n!==e;n++)this.objects.push(t[n]);return this}get(){return 0===this.objects.length?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(t){const e=this.objects;for(;e.length>t;)e.pop();for(;e.length<t;)e.push(this.constructObject());return this}}class cr extends lr{constructor(){super(),this.type=a}constructObject(){return new a}}const ur={sphereSphere:b.types.SPHERE,spherePlane:b.types.SPHERE|b.types.PLANE,boxBox:b.types.BOX|b.types.BOX,sphereBox:b.types.SPHERE|b.types.BOX,planeBox:b.types.PLANE|b.types.BOX,convexConvex:b.types.CONVEXPOLYHEDRON,sphereConvex:b.types.SPHERE|b.types.CONVEXPOLYHEDRON,planeConvex:b.types.PLANE|b.types.CONVEXPOLYHEDRON,boxConvex:b.types.BOX|b.types.CONVEXPOLYHEDRON,sphereHeightfield:b.types.SPHERE|b.types.HEIGHTFIELD,boxHeightfield:b.types.BOX|b.types.HEIGHTFIELD,convexHeightfield:b.types.CONVEXPOLYHEDRON|b.types.HEIGHTFIELD,sphereParticle:b.types.PARTICLE|b.types.SPHERE,planeParticle:b.types.PLANE|b.types.PARTICLE,boxParticle:b.types.BOX|b.types.PARTICLE,convexParticle:b.types.PARTICLE|b.types.CONVEXPOLYHEDRON,sphereTrimesh:b.types.SPHERE|b.types.TRIMESH,planeTrimesh:b.types.PLANE|b.types.TRIMESH};class hr{constructor(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new cr,this.world=t,this.currentContactMaterial=t.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(t,e,n,r,i,s){let o;this.contactPointPool.length?(o=this.contactPointPool.pop(),o.bi=t,o.bj=e):o=new jt(t,e),o.enabled=t.collisionResponse&&e.collisionResponse&&n.collisionResponse&&r.collisionResponse;const a=this.currentContactMaterial;o.restitution=a.restitution,o.setSpookParams(a.contactEquationStiffness,a.contactEquationRelaxation,this.world.dt);const l=n.material||t.material,c=r.material||e.material;return l&&c&&l.restitution>=0&&c.restitution>=0&&(o.restitution=l.restitution*c.restitution),o.si=i||n,o.sj=s||r,o}createFrictionEquationsFromContact(t,e){const n=t.bi,r=t.bj,i=t.si,s=t.sj,o=this.world,a=this.currentContactMaterial;let l=a.friction;const c=i.material||n.material,u=s.material||r.material;if(c&&u&&c.friction>=0&&u.friction>=0&&(l=c.friction*u.friction),l>0){const i=l*o.gravity.length();let s=n.invMass+r.invMass;s>0&&(s=1/s);const c=this.frictionEquationPool,u=c.length?c.pop():new he(n,r,i*s),h=c.length?c.pop():new he(n,r,i*s);return u.bi=h.bi=n,u.bj=h.bj=r,u.minForce=h.minForce=-i*s,u.maxForce=h.maxForce=i*s,u.ri.copy(t.ri),u.rj.copy(t.rj),h.ri.copy(t.ri),h.rj.copy(t.rj),t.ni.tangents(u.t,h.t),u.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,o.dt),h.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,o.dt),u.enabled=h.enabled=t.enabled,e.push(u,h),!0}return!1}createFrictionFromAverage(t){let e=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(e,this.frictionResult)||1===t)return;const n=this.frictionResult[this.frictionResult.length-2],r=this.frictionResult[this.frictionResult.length-1];pr.setZero(),dr.setZero(),fr.setZero();const i=e.bi;e.bj;for(let n=0;n!==t;n++)e=this.result[this.result.length-1-n],e.bi!==i?(pr.vadd(e.ni,pr),dr.vadd(e.ri,dr),fr.vadd(e.rj,fr)):(pr.vsub(e.ni,pr),dr.vadd(e.rj,dr),fr.vadd(e.ri,fr));const s=1/t;dr.scale(s,n.ri),fr.scale(s,n.rj),r.ri.copy(n.ri),r.rj.copy(n.rj),pr.normalize(),pr.tangents(n.t,r.t)}getContacts(t,e,n,r,i,s,o){this.contactPointPool=i,this.frictionEquationPool=o,this.result=r,this.frictionResult=s;const a=gr,l=yr,c=mr,u=_r;for(let r=0,i=t.length;r!==i;r++){const i=t[r],s=e[r];let o=null;i.material&&s.material&&(o=n.getContactMaterial(i.material,s.material)||null);const h=i.type&L.KINEMATIC&&s.type&L.STATIC||i.type&L.STATIC&&s.type&L.KINEMATIC||i.type&L.KINEMATIC&&s.type&L.KINEMATIC;for(let t=0;t<i.shapes.length;t++){i.quaternion.mult(i.shapeOrientations[t],a),i.quaternion.vmult(i.shapeOffsets[t],c),c.vadd(i.position,c);const e=i.shapes[t];for(let t=0;t<s.shapes.length;t++){s.quaternion.mult(s.shapeOrientations[t],l),s.quaternion.vmult(s.shapeOffsets[t],u),u.vadd(s.position,u);const r=s.shapes[t];if(!(e.collisionFilterMask&r.collisionFilterGroup&&r.collisionFilterMask&e.collisionFilterGroup))continue;if(c.distanceTo(u)>e.boundingSphereRadius+r.boundingSphereRadius)continue;let p=null;e.material&&r.material&&(p=n.getContactMaterial(e.material,r.material)||null),this.currentContactMaterial=p||o||n.defaultContactMaterial;const d=this[e.type|r.type];if(d){let t=!1;t=e.type<r.type?d.call(this,e,r,c,u,a,l,i,s,e,r,h):d.call(this,r,e,u,c,l,a,s,i,e,r,h),t&&h&&(n.shapeOverlapKeeper.set(e.id,r.id),n.bodyOverlapKeeper.set(i.id,s.id))}}}}}sphereSphere(t,e,n,r,i,s,o,a,l,c,u){if(u)return n.distanceSquared(r)<(t.radius+e.radius)**2;const h=this.createContactEquation(o,a,t,e,l,c);r.vsub(n,h.ni),h.ni.normalize(),h.ri.copy(h.ni),h.rj.copy(h.ni),h.ri.scale(t.radius,h.ri),h.rj.scale(-e.radius,h.rj),h.ri.vadd(n,h.ri),h.ri.vsub(o.position,h.ri),h.rj.vadd(r,h.rj),h.rj.vsub(a.position,h.rj),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult)}spherePlane(t,e,n,r,i,s,o,a,l,c,u){const h=this.createContactEquation(o,a,t,e,l,c);if(h.ni.set(0,0,1),s.vmult(h.ni,h.ni),h.ni.negate(h.ni),h.ni.normalize(),h.ni.scale(t.radius,h.ri),n.vsub(r,Fr),h.ni.scale(h.ni.dot(Fr),kr),Fr.vsub(kr,h.rj),-Fr.dot(h.ni)<=t.radius){if(u)return!0;const t=h.ri,e=h.rj;t.vadd(n,t),t.vsub(o.position,t),e.vadd(r,e),e.vsub(a.position,e),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult)}}boxBox(t,e,n,r,i,s,o,a,l,c,u){return t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,n,r,i,s,o,a,t,e,u)}sphereBox(t,e,n,r,i,s,o,a,l,c,u){const h=this.v3pool,p=qr;n.vsub(r,Gr),e.getSideNormals(p,s);const d=t.radius;let f=!1;const m=Yr,_=Jr,g=Zr;let y=null,v=0,b=0,x=0,w=null;for(let t=0,e=p.length;t!==e&&!1===f;t++){const e=Hr;e.copy(p[t]);const n=e.length();e.normalize();const r=Gr.dot(e);if(r<n+d&&r>0){const i=Vr,s=Wr;i.copy(p[(t+1)%3]),s.copy(p[(t+2)%3]);const o=i.length(),a=s.length();i.normalize(),s.normalize();const l=Gr.dot(i),c=Gr.dot(s);if(l<o&&l>-o&&c<a&&c>-a){const t=Math.abs(r-n-d);if((null===w||t<w)&&(w=t,b=l,x=c,y=n,m.copy(e),_.copy(i),g.copy(s),v++,u))return!0}}}if(v){f=!0;const i=this.createContactEquation(o,a,t,e,l,c);m.scale(-d,i.ri),i.ni.copy(m),i.ni.negate(i.ni),m.scale(y,m),_.scale(b,_),m.vadd(_,m),g.scale(x,g),m.vadd(g,i.rj),i.ri.vadd(n,i.ri),i.ri.vsub(o.position,i.ri),i.rj.vadd(r,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}let S=h.get();const M=Xr;for(let i=0;2!==i&&!f;i++)for(let s=0;2!==s&&!f;s++)for(let h=0;2!==h&&!f;h++)if(S.set(0,0,0),i?S.vadd(p[0],S):S.vsub(p[0],S),s?S.vadd(p[1],S):S.vsub(p[1],S),h?S.vadd(p[2],S):S.vsub(p[2],S),r.vadd(S,M),M.vsub(n,M),M.lengthSquared()<d*d){if(u)return!0;f=!0;const i=this.createContactEquation(o,a,t,e,l,c);i.ri.copy(M),i.ri.normalize(),i.ni.copy(i.ri),i.ri.scale(d,i.ri),i.rj.copy(S),i.ri.vadd(n,i.ri),i.ri.vsub(o.position,i.ri),i.rj.vadd(r,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}h.release(S),S=null;const T=h.get(),E=h.get(),A=h.get(),$=h.get(),C=h.get(),B=p.length;for(let i=0;i!==B&&!f;i++)for(let s=0;s!==B&&!f;s++)if(i%3!=s%3){p[s].cross(p[i],T),T.normalize(),p[i].vadd(p[s],E),A.copy(n),A.vsub(E,A),A.vsub(r,A);const h=A.dot(T);T.scale(h,$);let m=0;for(;m===i%3||m===s%3;)m++;C.copy(n),C.vsub($,C),C.vsub(E,C),C.vsub(r,C);const _=Math.abs(h),g=C.length();if(_<p[m].length()&&g<d){if(u)return!0;f=!0;const i=this.createContactEquation(o,a,t,e,l,c);E.vadd($,i.rj),i.rj.copy(i.rj),C.negate(i.ni),i.ni.normalize(),i.ri.copy(i.rj),i.ri.vadd(r,i.ri),i.ri.vsub(n,i.ri),i.ri.normalize(),i.ri.scale(d,i.ri),i.ri.vadd(n,i.ri),i.ri.vsub(o.position,i.ri),i.rj.vadd(r,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}h.release(T,E,A,$,C)}planeBox(t,e,n,r,i,s,o,a,l,c,u){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,e.convexPolyhedronRepresentation.id=e.id,this.planeConvex(t,e.convexPolyhedronRepresentation,n,r,i,s,o,a,t,e,u)}convexConvex(t,e,n,r,i,s,o,a,l,c,u,h,p){const d=pi;if(!(n.distanceTo(r)>t.boundingSphereRadius+e.boundingSphereRadius)&&t.findSeparatingAxis(e,n,i,r,s,d,h,p)){const h=[],p=di;t.clipAgainstHull(n,i,e,r,s,d,-100,100,h);let f=0;for(let i=0;i!==h.length;i++){if(u)return!0;const s=this.createContactEquation(o,a,t,e,l,c),m=s.ri,_=s.rj;d.negate(s.ni),h[i].normal.negate(p),p.scale(h[i].depth,p),h[i].point.vadd(p,m),_.copy(h[i].point),m.vsub(n,m),_.vsub(r,_),m.vadd(n,m),m.vsub(o.position,m),_.vadd(r,_),_.vsub(a.position,_),this.result.push(s),f++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(s,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}}sphereConvex(t,e,n,r,i,s,o,a,l,c,u){const h=this.v3pool;n.vsub(r,Qr);const p=e.faceNormals,d=e.faces,f=e.vertices,m=t.radius;let _=!1;for(let i=0;i!==f.length;i++){const h=f[i],p=ni;s.vmult(h,p),r.vadd(p,p);const d=ei;if(p.vsub(n,d),d.lengthSquared()<m*m){if(u)return!0;_=!0;const i=this.createContactEquation(o,a,t,e,l,c);return i.ri.copy(d),i.ri.normalize(),i.ni.copy(i.ri),i.ri.scale(m,i.ri),p.vsub(r,i.rj),i.ri.vadd(n,i.ri),i.ri.vsub(o.position,i.ri),i.rj.vadd(r,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),void this.createFrictionEquationsFromContact(i,this.frictionResult)}}for(let i=0,g=d.length;i!==g&&!1===_;i++){const g=p[i],y=d[i],v=ri;s.vmult(g,v);const b=ii;s.vmult(f[y[0]],b),b.vadd(r,b);const x=si;v.scale(-m,x),n.vadd(x,x);const w=oi;x.vsub(b,w);const S=w.dot(v),M=ai;if(n.vsub(b,M),S<0&&M.dot(v)>0){const i=[];for(let t=0,e=y.length;t!==e;t++){const e=h.get();s.vmult(f[y[t]],e),r.vadd(e,e),i.push(e)}if(jr(i,v,n)){if(u)return!0;_=!0;const s=this.createContactEquation(o,a,t,e,l,c);v.scale(-m,s.ri),v.negate(s.ni);const p=h.get();v.scale(-S,p);const d=h.get();v.scale(-m,d),n.vsub(r,s.rj),s.rj.vadd(d,s.rj),s.rj.vadd(p,s.rj),s.rj.vadd(r,s.rj),s.rj.vsub(a.position,s.rj),s.ri.vadd(n,s.ri),s.ri.vsub(o.position,s.ri),h.release(p),h.release(d),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult);for(let t=0,e=i.length;t!==e;t++)h.release(i[t]);return}for(let p=0;p!==y.length;p++){const d=h.get(),_=h.get();s.vmult(f[y[(p+1)%y.length]],d),s.vmult(f[y[(p+2)%y.length]],_),r.vadd(d,d),r.vadd(_,_);const g=Kr;_.vsub(d,g);const v=ti;g.unit(v);const b=h.get(),x=h.get();n.vsub(d,x);const w=x.dot(v);v.scale(w,b),b.vadd(d,b);const S=h.get();if(b.vsub(n,S),w>0&&w*w<g.lengthSquared()&&S.lengthSquared()<m*m){if(u)return!0;const s=this.createContactEquation(o,a,t,e,l,c);b.vsub(r,s.rj),b.vsub(n,s.ni),s.ni.normalize(),s.ni.scale(m,s.ri),s.rj.vadd(r,s.rj),s.rj.vsub(a.position,s.rj),s.ri.vadd(n,s.ri),s.ri.vsub(o.position,s.ri),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult);for(let t=0,e=i.length;t!==e;t++)h.release(i[t]);return h.release(d),h.release(_),h.release(b),h.release(S),void h.release(x)}h.release(d),h.release(_),h.release(b),h.release(S),h.release(x)}for(let t=0,e=i.length;t!==e;t++)h.release(i[t])}}}planeConvex(t,e,n,r,i,s,o,a,l,c,u){const h=li,p=ci;p.set(0,0,1),i.vmult(p,p);let d=0;const f=ui;for(let i=0;i!==e.vertices.length;i++)if(h.copy(e.vertices[i]),s.vmult(h,h),r.vadd(h,h),h.vsub(n,f),p.dot(f)<=0){if(u)return!0;const i=this.createContactEquation(o,a,t,e,l,c),s=hi;p.scale(p.dot(f),s),h.vsub(s,s),s.vsub(n,i.ri),i.ni.copy(p),h.vsub(r,i.rj),i.ri.vadd(n,i.ri),i.ri.vsub(o.position,i.ri),i.rj.vadd(r,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),d++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(i,this.frictionResult)}this.enableFrictionReduction&&d&&this.createFrictionFromAverage(d)}boxConvex(t,e,n,r,i,s,o,a,l,c,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,n,r,i,s,o,a,t,e,u)}sphereHeightfield(t,e,n,r,i,s,o,a,l,c,u){const h=e.data,p=t.radius,d=e.elementSize,f=Ai,m=Ei;x.pointToLocalFrame(r,s,n,m);let _=Math.floor((m.x-p)/d)-1,g=Math.ceil((m.x+p)/d)+1,y=Math.floor((m.y-p)/d)-1,v=Math.ceil((m.y+p)/d)+1;if(g<0||v<0||_>h.length||y>h[0].length)return;_<0&&(_=0),g<0&&(g=0),y<0&&(y=0),v<0&&(v=0),_>=h.length&&(_=h.length-1),g>=h.length&&(g=h.length-1),v>=h[0].length&&(v=h[0].length-1),y>=h[0].length&&(y=h[0].length-1);const b=[];e.getRectMinMax(_,y,g,v,b);const w=b[0],S=b[1];if(m.z-p>S||m.z+p<w)return;const M=this.result;for(let l=_;l<g;l++)for(let c=y;c<v;c++){const h=M.length;let p=!1;if(e.getConvexTrianglePillar(l,c,!1),x.pointToWorldFrame(r,s,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(p=this.sphereConvex(t,e.pillarConvex,n,f,i,s,o,a,t,e,u)),u&&p)return!0;if(e.getConvexTrianglePillar(l,c,!0),x.pointToWorldFrame(r,s,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(p=this.sphereConvex(t,e.pillarConvex,n,f,i,s,o,a,t,e,u)),u&&p)return!0;if(M.length-h>2)return}}boxHeightfield(t,e,n,r,i,s,o,a,l,c,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,e,n,r,i,s,o,a,t,e,u)}convexHeightfield(t,e,n,r,i,s,o,a,l,c,u){const h=e.data,p=e.elementSize,d=t.boundingSphereRadius,f=Mi,m=Ti,_=Si;x.pointToLocalFrame(r,s,n,_);let g=Math.floor((_.x-d)/p)-1,y=Math.ceil((_.x+d)/p)+1,v=Math.floor((_.y-d)/p)-1,b=Math.ceil((_.y+d)/p)+1;if(y<0||b<0||g>h.length||v>h[0].length)return;g<0&&(g=0),y<0&&(y=0),v<0&&(v=0),b<0&&(b=0),g>=h.length&&(g=h.length-1),y>=h.length&&(y=h.length-1),b>=h[0].length&&(b=h[0].length-1),v>=h[0].length&&(v=h[0].length-1);const w=[];e.getRectMinMax(g,v,y,b,w);const S=w[0],M=w[1];if(!(_.z-d>M||_.z+d<S))for(let l=g;l<y;l++)for(let c=v;c<b;c++){let h=!1;if(e.getConvexTrianglePillar(l,c,!1),x.pointToWorldFrame(r,s,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(h=this.convexConvex(t,e.pillarConvex,n,f,i,s,o,a,null,null,u,m,null)),u&&h)return!0;if(e.getConvexTrianglePillar(l,c,!0),x.pointToWorldFrame(r,s,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(h=this.convexConvex(t,e.pillarConvex,n,f,i,s,o,a,null,null,u,m,null)),u&&h)return!0}}sphereParticle(t,e,n,r,i,s,o,a,l,c,u){const h=gi;if(h.set(0,0,1),r.vsub(n,h),h.lengthSquared()<=t.radius*t.radius){if(u)return!0;const n=this.createContactEquation(a,o,e,t,l,c);h.normalize(),n.rj.copy(h),n.rj.scale(t.radius,n.rj),n.ni.copy(h),n.ni.negate(n.ni),n.ri.set(0,0,0),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}planeParticle(t,e,n,r,i,s,o,a,l,c,u){const h=fi;h.set(0,0,1),o.quaternion.vmult(h,h);const p=mi;if(r.vsub(o.position,p),h.dot(p)<=0){if(u)return!0;const n=this.createContactEquation(a,o,e,t,l,c);n.ni.copy(h),n.ni.negate(n.ni),n.ri.set(0,0,0);const i=_i;h.scale(h.dot(r),i),r.vsub(i,i),n.rj.copy(i),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}boxParticle(t,e,n,r,i,s,o,a,l,c,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,n,r,i,s,o,a,t,e,u)}convexParticle(t,e,n,r,i,s,o,a,l,c,u){let h=-1;const p=bi,d=wi;let f=null;const m=vi;if(m.copy(r),m.vsub(n,m),i.conjugate(yi),yi.vmult(m,m),t.pointIsInside(m)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(n,i),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(i);for(let e=0,n=t.faces.length;e!==n;e++){const n=[t.worldVertices[t.faces[e][0]]],i=t.worldFaceNormals[e];r.vsub(n[0],xi);const s=-i.dot(xi);if(null===f||Math.abs(s)<Math.abs(f)){if(u)return!0;f=s,h=e,p.copy(i)}}if(-1!==h){const i=this.createContactEquation(a,o,e,t,l,c);p.scale(f,d),d.vadd(r,d),d.vsub(n,d),i.rj.copy(d),p.negate(i.ni),i.ri.set(0,0,0);const s=i.ri,u=i.rj;s.vadd(r,s),s.vsub(a.position,s),u.vadd(n,u),u.vsub(o.position,u),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}sphereTrimesh(t,e,n,r,i,s,o,a,l,c,u){const h=Er,p=Ar,d=$r,f=Cr,m=Br,_=Lr,g=Ir,y=Tr,v=Sr,b=Or;x.pointToLocalFrame(r,s,n,m);const w=t.radius;g.lowerBound.set(m.x-w,m.y-w,m.z-w),g.upperBound.set(m.x+w,m.y+w,m.z+w),e.getTrianglesInAABB(g,b);const S=Mr,M=t.radius*t.radius;for(let i=0;i<b.length;i++)for(let h=0;h<3;h++)if(e.getVertex(e.indices[3*b[i]+h],S),S.vsub(m,v),v.lengthSquared()<=M){if(y.copy(S),x.pointToWorldFrame(r,s,y,S),S.vsub(n,v),u)return!0;let i=this.createContactEquation(o,a,t,e,l,c);i.ni.copy(v),i.ni.normalize(),i.ri.copy(i.ni),i.ri.scale(t.radius,i.ri),i.ri.vadd(n,i.ri),i.ri.vsub(o.position,i.ri),i.rj.copy(S),i.rj.vsub(a.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}for(let i=0;i<b.length;i++)for(let g=0;g<3;g++){e.getVertex(e.indices[3*b[i]+g],h),e.getVertex(e.indices[3*b[i]+(g+1)%3],p),p.vsub(h,d),m.vsub(p,_);const y=_.dot(d);m.vsub(h,_);let v=_.dot(d);if(v>0&&y<0&&(m.vsub(h,_),f.copy(d),f.normalize(),v=_.dot(f),f.scale(v,_),_.vadd(h,_),_.distanceTo(m)<t.radius)){if(u)return!0;const i=this.createContactEquation(o,a,t,e,l,c);_.vsub(m,i.ni),i.ni.normalize(),i.ni.scale(t.radius,i.ri),i.ri.vadd(n,i.ri),i.ri.vsub(o.position,i.ri),x.pointToWorldFrame(r,s,_,_),_.vsub(a.position,i.rj),x.vectorToWorldFrame(s,i.ni,i.ni),x.vectorToWorldFrame(s,i.ri,i.ri),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}const T=Rr,E=Nr,A=Pr,$=wr;for(let i=0,h=b.length;i!==h;i++){e.getTriangleVertices(b[i],T,E,A),e.getNormal(b[i],$),m.vsub(T,_);let h=_.dot($);if($.scale(h,_),m.vsub(_,_),h=_.distanceTo(m),et.pointInTriangle(_,T,E,A)&&h<t.radius){if(u)return!0;let i=this.createContactEquation(o,a,t,e,l,c);_.vsub(m,i.ni),i.ni.normalize(),i.ni.scale(t.radius,i.ri),i.ri.vadd(n,i.ri),i.ri.vsub(o.position,i.ri),x.pointToWorldFrame(r,s,_,_),_.vsub(a.position,i.rj),x.vectorToWorldFrame(s,i.ni,i.ni),x.vectorToWorldFrame(s,i.ri,i.ri),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}b.length=0}planeTrimesh(t,e,n,r,i,s,o,l,c,u,h){const p=new a,d=vr;d.set(0,0,1),i.vmult(d,d);for(let i=0;i<e.vertices.length/3;i++){e.getVertex(i,p);const f=new a;f.copy(p),x.pointToWorldFrame(r,s,f,p);const m=br;if(p.vsub(n,m),d.dot(m)<=0){if(h)return!0;const n=this.createContactEquation(o,l,t,e,c,u);n.ni.copy(d);const r=xr;d.scale(m.dot(d),r),p.vsub(r,r),n.ri.copy(r),n.ri.vsub(o.position,n.ri),n.rj.copy(p),n.rj.vsub(l.position,n.rj),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}}}const pr=new a,dr=new a,fr=new a,mr=new a,_r=new a,gr=new _,yr=new _;hr.prototype[ur.boxBox]=hr.prototype.boxBox,hr.prototype[ur.boxConvex]=hr.prototype.boxConvex,hr.prototype[ur.boxParticle]=hr.prototype.boxParticle,hr.prototype[ur.sphereSphere]=hr.prototype.sphereSphere;const vr=new a,br=new a,xr=new a;hr.prototype[ur.planeTrimesh]=hr.prototype.planeTrimesh;const wr=new a,Sr=new a,Mr=new a,Tr=new a,Er=new a,Ar=new a,$r=new a,Cr=new a,Br=new a,Lr=new a,Rr=new a,Nr=new a,Pr=new a,Ir=new h,Or=[];hr.prototype[ur.sphereTrimesh]=hr.prototype.sphereTrimesh;const Fr=new a,kr=new a;hr.prototype[ur.spherePlane]=hr.prototype.spherePlane;const Dr=new a,Ur=new a,zr=new a;function jr(t,e,n){let r=null;const i=t.length;for(let s=0;s!==i;s++){const o=t[s],a=Dr;t[(s+1)%i].vsub(o,a);const l=Ur;a.cross(e,l);const c=zr;n.vsub(o,c);const u=l.dot(c);if(!(null===r||u>0&&!0===r||u<=0&&!1===r))return!1;null===r&&(r=u>0)}return!0}const Gr=new a,Hr=new a,Vr=new a,Wr=new a,qr=[new a,new a,new a,new a,new a,new a],Xr=new a,Yr=new a,Jr=new a,Zr=new a;hr.prototype[ur.sphereBox]=hr.prototype.sphereBox;const Qr=new a,Kr=new a,ti=new a,ei=new a,ni=new a,ri=new a,ii=new a,si=new a,oi=new a,ai=new a;hr.prototype[ur.sphereConvex]=hr.prototype.sphereConvex,hr.prototype[ur.planeBox]=hr.prototype.planeBox;const li=new a,ci=new a,ui=new a,hi=new a;hr.prototype[ur.planeConvex]=hr.prototype.planeConvex;const pi=new a,di=new a;hr.prototype[ur.convexConvex]=hr.prototype.convexConvex;const fi=new a,mi=new a,_i=new a;hr.prototype[ur.planeParticle]=hr.prototype.planeParticle;const gi=new a;hr.prototype[ur.sphereParticle]=hr.prototype.sphereParticle;const yi=new _,vi=new a,bi=new a,xi=new a,wi=new a;hr.prototype[ur.convexParticle]=hr.prototype.convexParticle,hr.prototype[ur.boxHeightfield]=hr.prototype.boxHeightfield;const Si=new a,Mi=new a,Ti=[0];hr.prototype[ur.convexHeightfield]=hr.prototype.convexHeightfield;const Ei=new a,Ai=new a;hr.prototype[ur.sphereHeightfield]=hr.prototype.sphereHeightfield;class $i{constructor(){this.current=[],this.previous=[]}getKey(t,e){if(e<t){const n=e;e=t,t=n}return t<<16|e}set(t,e){const n=this.getKey(t,e),r=this.current;let i=0;for(;n>r[i];)i++;if(n!==r[i]){for(let t=r.length-1;t>=i;t--)r[t+1]=r[t];r[i]=n}}tick(){const t=this.current;this.current=this.previous,this.previous=t,this.current.length=0}getDiff(t,e){const n=this.current,r=this.previous,i=n.length,s=r.length;let o=0;for(let e=0;e<i;e++){let i=!1;const s=n[e];for(;s>r[o];)o++;i=s===r[o],i||Ci(t,s)}o=0;for(let t=0;t<s;t++){let i=!1;const s=r[t];for(;s>n[o];)o++;i=n[o]===s,i||Ci(e,s)}}}function Ci(t,e){t.push((4294901760&e)>>16,65535&e)}class Bi{constructor(){this.data={keys:[]}}get(t,e){if(t>e){const n=e;e=t,t=n}return this.data[t+"-"+e]}set(t,e,n){if(t>e){const n=e;e=t,t=n}const r=t+"-"+e;this.get(t,e)||this.data.keys.push(r),this.data[r]=n}reset(){const t=this.data,e=t.keys;for(;e.length>0;)delete t[e.pop()]}}class Li extends m{constructor(t={}){super(),this.dt=-1,this.allowSleep=!!t.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=void 0!==t.quatNormalizeSkip?t.quatNormalizeSkip:0,this.quatNormalizeFast=void 0!==t.quatNormalizeFast&&t.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new a,t.gravity&&this.gravity.copy(t.gravity),this.broadphase=void 0!==t.broadphase?t.broadphase:new Q,this.bodies=[],this.hasActiveBodies=!1,this.solver=void 0!==t.solver?t.solver:new Xn,this.constraints=[],this.narrowphase=new hr(this),this.collisionMatrix=new f,this.collisionMatrixPrevious=new f,this.bodyOverlapKeeper=new $i,this.shapeOverlapKeeper=new $i,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new Bi,this.defaultMaterial=new me("default"),this.defaultContactMaterial=new fe(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(t,e){return this.contactMaterialTable.get(t.id,e.id)}numObjects(){return this.bodies.length}collisionMatrixTick(){const t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(t){this.constraints.push(t)}removeConstraint(t){const e=this.constraints.indexOf(t);-1!==e&&this.constraints.splice(e,1)}rayTest(t,e,n){n instanceof K?this.raycastClosest(t,e,{skipBackfaces:!0},n):this.raycastAll(t,e,{skipBackfaces:!0},n)}raycastAll(t,e,n={},r){return n.mode=et.ALL,n.from=t,n.to=e,n.callback=r,Ri.intersectWorld(this,n)}raycastAny(t,e,n={},r){return n.mode=et.ANY,n.from=t,n.to=e,n.result=r,Ri.intersectWorld(this,n)}raycastClosest(t,e,n={},r){return n.mode=et.CLOSEST,n.from=t,n.to=e,n.result=r,Ri.intersectWorld(this,n)}addBody(t){this.bodies.includes(t)||(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof L&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.idToBodyMap[t.id]=t,this.dispatchEvent(this.addBodyEvent))}removeBody(t){t.world=null;const e=this.bodies.length-1,n=this.bodies,r=n.indexOf(t);if(-1!==r){n.splice(r,1);for(let t=0;t!==n.length;t++)n[t].index=t;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,delete this.idToBodyMap[t.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(t){return this.idToBodyMap[t]}getShapeById(t){const e=this.bodies;for(let n=0,r=e.length;n<r;n++){const r=e[n].shapes;for(let e=0,n=r.length;e<n;e++){const n=r[e];if(n.id===t)return n}}}addMaterial(t){this.materials.push(t)}addContactMaterial(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)}step(t,e=0,n=10){if(0===e)this.internalStep(t),this.time+=t;else{this.accumulator+=e;let r=0;for(;this.accumulator>=t&&r<n;)this.internalStep(t),this.accumulator-=t,r++;const i=this.accumulator%t/t;for(let t=0;t!==this.bodies.length;t++){const e=this.bodies[t];e.previousPosition.lerp(e.position,i,e.interpolatedPosition),e.previousQuaternion.slerp(e.quaternion,i,e.interpolatedQuaternion),e.previousQuaternion.normalize()}this.time+=e}}internalStep(t){this.dt=t;const e=this.contacts,n=ki,r=Di,i=this.numObjects(),s=this.bodies,o=this.solver,a=this.gravity,l=this.doProfiling,c=this.profile,u=L.DYNAMIC;let h=-1/0;const p=this.constraints,d=Fi,f=(a.length(),a.x),m=a.y,_=a.z;let g=0;for(l&&(h=performance.now()),g=0;g!==i;g++){const t=s[g];if(t.type===u){const e=t.force,n=t.mass;e.x+=n*f,e.y+=n*m,e.z+=n*_}}for(let t=0,e=this.subsystems.length;t!==e;t++)this.subsystems[t].update();l&&(h=performance.now()),n.length=0,r.length=0,this.broadphase.collisionPairs(this,n,r),l&&(c.broadphase=performance.now()-h);let y=p.length;for(g=0;g!==y;g++){const t=p[g];if(!t.collideConnected)for(let e=n.length-1;e>=0;e-=1)(t.bodyA===n[e]&&t.bodyB===r[e]||t.bodyB===n[e]&&t.bodyA===r[e])&&(n.splice(e,1),r.splice(e,1))}this.collisionMatrixTick(),l&&(h=performance.now());const v=Oi,b=e.length;for(g=0;g!==b;g++)v.push(e[g]);e.length=0;const x=this.frictionEquations.length;for(g=0;g!==x;g++)d.push(this.frictionEquations[g]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,r,this,e,v,this.frictionEquations,d),l&&(c.narrowphase=performance.now()-h),l&&(h=performance.now()),g=0;g<this.frictionEquations.length;g++)o.addEquation(this.frictionEquations[g]);const w=e.length;for(let t=0;t!==w;t++){const n=e[t],r=n.bi,i=n.bj,s=n.si,a=n.sj;let l;l=r.material&&i.material&&this.getContactMaterial(r.material,i.material)||this.defaultContactMaterial;let c=l.friction;r.material&&i.material&&(r.material.friction>=0&&i.material.friction>=0&&(c=r.material.friction*i.material.friction),r.material.restitution>=0&&i.material.restitution>=0&&(n.restitution=r.material.restitution*i.material.restitution)),o.addEquation(n),r.allowSleep&&r.type===L.DYNAMIC&&r.sleepState===L.SLEEPING&&i.sleepState===L.AWAKE&&i.type!==L.STATIC&&i.velocity.lengthSquared()+i.angularVelocity.lengthSquared()>=2*i.sleepSpeedLimit**2&&(r.wakeUpAfterNarrowphase=!0),i.allowSleep&&i.type===L.DYNAMIC&&i.sleepState===L.SLEEPING&&r.sleepState===L.AWAKE&&r.type!==L.STATIC&&r.velocity.lengthSquared()+r.angularVelocity.lengthSquared()>=2*r.sleepSpeedLimit**2&&(i.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(r,i,!0),this.collisionMatrixPrevious.get(r,i)||(Ii.body=i,Ii.contact=n,r.dispatchEvent(Ii),Ii.body=r,i.dispatchEvent(Ii)),this.bodyOverlapKeeper.set(r.id,i.id),this.shapeOverlapKeeper.set(s.id,a.id)}for(this.emitContactEvents(),l&&(c.makeContactConstraints=performance.now()-h,h=performance.now()),g=0;g!==i;g++){const t=s[g];t.wakeUpAfterNarrowphase&&(t.wakeUp(),t.wakeUpAfterNarrowphase=!1)}for(y=p.length,g=0;g!==y;g++){const t=p[g];t.update();for(let e=0,n=t.equations.length;e!==n;e++){const n=t.equations[e];o.addEquation(n)}}o.solve(t,this),l&&(c.solve=performance.now()-h),o.removeAllEquations();const S=Math.pow;for(g=0;g!==i;g++){const e=s[g];if(e.type&u){const n=S(1-e.linearDamping,t),r=e.velocity;r.scale(n,r);const i=e.angularVelocity;if(i){const n=S(1-e.angularDamping,t);i.scale(n,i)}}}for(this.dispatchEvent(Pi),g=0;g!==i;g++){const t=s[g];t.preStep&&t.preStep.call(t)}l&&(h=performance.now());const M=this.stepnumber%(this.quatNormalizeSkip+1)==0,T=this.quatNormalizeFast;for(g=0;g!==i;g++)s[g].integrate(t,M,T);for(this.clearForces(),this.broadphase.dirty=!0,l&&(c.integrate=performance.now()-h),this.time+=t,this.stepnumber+=1,this.dispatchEvent(Ni),g=0;g!==i;g++){const t=s[g],e=t.postStep;e&&e.call(t)}let E=!0;if(this.allowSleep)for(E=!1,g=0;g!==i;g++){const t=s[g];t.sleepTick(this.time),t.sleepState!==L.SLEEPING&&(E=!0)}this.hasActiveBodies=E}clearForces(){const t=this.bodies,e=t.length;for(let n=0;n!==e;n++){const e=t[n];e.force,e.torque,e.force.set(0,0,0),e.torque.set(0,0,0)}}}new h;const Ri=new et;if("undefined"==typeof performance&&(performance={}),!performance.now){let t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),performance.now=()=>Date.now()-t}const Ni={type:"postStep"},Pi={type:"preStep"},Ii={type:L.COLLIDE_EVENT_NAME,body:null,contact:null},Oi=[],Fi=[],ki=[],Di=[];function Ui(){this.pressed=!1,this.justPressed=!1,this.justReleased=!1}function zi(t,e){this._keys=new Array(5),this._position=new n.Vector2(0,0),this._positionUpdated=!1,this._delta=new n.Vector2(0,0),this._wheel=0,this._wheelUpdated=!1,this._doubleClicked=new Array(5),this.keys=new Array(5),this.position=new n.Vector2(0,0),this.delta=new n.Vector2(0,0),this.wheel=0,this.doubleClicked=new Array(5),this.domElement=void 0!==t?t:window,this.canvas=null,this.events=new ji;for(var r=0;r<5;r++)this._doubleClicked[r]=!1,this.doubleClicked[r]=!1,this._keys[r]=new Ui,this.keys[r]=new Ui;var i=this;if(void 0!==window.onmousewheel?this.events.add(this.domElement,"mousewheel",(function(t){i._wheel=t.deltaY,i._wheelUpdated=!0})):void 0!==window.addEventListener?this.events.add(this.domElement,"DOMMouseScroll",(function(t){i._wheel=30*t.detail,i._wheelUpdated=!0})):this.events.add(this.domElement,"wheel",(function(t){i._wheel=t.deltaY,i._wheelUpdated=!0})),"ontouchstart"in window||navigator.msMaxTouchPoints>0){var s=new n.Vector2(0,0);this.events.add(this.domElement,"touchstart",(function(t){var e=t.touches[0];i.updatePosition(e.screenX,e.screenY,0,0),i.updateKey(zi.LEFT,Ui.DOWN),s.set(e.screenX,e.screenY)})),this.events.add(this.domElement,"touchend",(function(t){i.updateKey(zi.LEFT,Ui.UP)})),this.events.add(this.domElement,"touchcancel",(function(t){i.updateKey(zi.LEFT,Ui.UP)})),this.events.add(document.body,"touchmove",(function(t){var e=t.touches[0];i.updatePosition(e.screenX,e.screenY,e.screenX-s.x,e.screenY-s.y),s.set(e.screenX,e.screenY)}))}this.events.add(this.domElement,"mousemove",(function(t){i.updatePosition(t.clientX,t.clientY,t.movementX,t.movementY)})),this.events.add(this.domElement,"mousedown",(function(t){i.updateKey(t.which-1,Ui.DOWN)})),this.events.add(this.domElement,"mouseup",(function(t){i.updateKey(t.which-1,Ui.UP)})),this.events.add(this.domElement,"dragstart",(function(t){i.updateKey(t.which-1,Ui.UP)})),this.events.add(this.domElement,"dblclick",(function(t){i._doubleClicked[t.which-1]=!0})),!0!==e&&this.create()}function ji(){this.events=[]}function Gi(){}function Hi(){}function Vi(){}function Wi(){}function qi(){}Li.prototype.emitContactEvents=(()=>{const t=[],e=[],n={type:"beginContact",bodyA:null,bodyB:null},r={type:"endContact",bodyA:null,bodyB:null},i={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},s={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};return function(){const o=this.hasAnyEventListener("beginContact"),a=this.hasAnyEventListener("endContact");if((o||a)&&this.bodyOverlapKeeper.getDiff(t,e),o){for(let e=0,r=t.length;e<r;e+=2)n.bodyA=this.getBodyById(t[e]),n.bodyB=this.getBodyById(t[e+1]),this.dispatchEvent(n);n.bodyA=n.bodyB=null}if(a){for(let t=0,n=e.length;t<n;t+=2)r.bodyA=this.getBodyById(e[t]),r.bodyB=this.getBodyById(e[t+1]),this.dispatchEvent(r);r.bodyA=r.bodyB=null}t.length=e.length=0;const l=this.hasAnyEventListener("beginShapeContact"),c=this.hasAnyEventListener("endShapeContact");if((l||c)&&this.shapeOverlapKeeper.getDiff(t,e),l){for(let e=0,n=t.length;e<n;e+=2){const n=this.getShapeById(t[e]),r=this.getShapeById(t[e+1]);i.shapeA=n,i.shapeB=r,i.bodyA=n.body,i.bodyB=r.body,this.dispatchEvent(i)}i.bodyA=i.bodyB=i.shapeA=i.shapeB=null}if(c){for(let t=0,n=e.length;t<n;t+=2){const n=this.getShapeById(e[t]),r=this.getShapeById(e[t+1]);s.shapeA=n,s.shapeB=r,s.bodyA=n.body,s.bodyB=r.body,this.dispatchEvent(s)}s.bodyA=s.bodyB=s.shapeA=s.shapeB=null}}})(),Ui.DOWN=-1,Ui.UP=1,Ui.RESET=0,Ui.prototype.constructor=Ui,Ui.prototype.update=function(t){this.justPressed=!1,this.justReleased=!1,t===Ui.DOWN?(!1===this.pressed&&(this.justPressed=!0),this.pressed=!0):t===Ui.UP?(this.pressed&&(this.justReleased=!0),this.pressed=!1):t===Ui.RESET&&(this.justReleased=!1,this.justPressed=!1)},Ui.prototype.set=function(t,e,n){this.justPressed=t,this.pressed=e,this.justReleased=n},Ui.prototype.reset=function(){this.justPressed=!1,this.pressed=!1,this.justReleased=!1},zi.prototype=zi,zi.prototype.constructor=zi,zi.LEFT=0,zi.MIDDLE=1,zi.RIGHT=2,zi.BACK=3,zi.FORWARD=4,zi.setCanvas=function(t){this.canvas=t,t.pointerInside=!1,t.addEventListener("mouseenter",(function(){this.pointerInside=!0})),t.addEventListener("mouseleave",(function(){this.pointerInside=!1}))},zi.insideCanvas=function(){return null!==this.canvas&&this.canvas.pointerInside},zi.setLock=function(t){null!==this.canvas&&(t?(this.canvas.requestPointerLock=this.canvas.requestPointerLock||this.canvas.mozRequestPointerLock||this.canvas.webkitRequestPointerLock,void 0!==this.canvas.requestPointerLock&&this.canvas.requestPointerLock()):void 0!==document.exitPointerLock?document.exitPointerLock():void 0!==document.mozExitPointerLock?document.mozExitPointerLock():void 0!==document.webkitExitPointerLock&&document.webkitExitPointerLock())},zi.buttonPressed=function(t){return this.keys[t].pressed},zi.buttonDoubleClicked=function(t){return this.doubleClicked[t]},zi.buttonJustPressed=function(t){return this.keys[t].justPressed},zi.buttonJustReleased=function(t){return this.keys[t].justReleased},zi.updatePosition=function(t,e,n,r){if(null!==this.canvas){var i=this.canvas.getBoundingClientRect();t-=i.left,e-=i.top}this._position.set(t,e),this._delta.x+=n,this._delta.y+=r,this._positionUpdated=!0},zi.updateKey=function(t,e){t>-1&&this._keys[t].update(e)},zi.update=function(){for(var t=0;t<5;t++)this._keys[t].justPressed&&this.keys[t].justPressed&&(this._keys[t].justPressed=!1),this._keys[t].justReleased&&this.keys[t].justReleased&&(this._keys[t].justReleased=!1),this.keys[t].set(this._keys[t].justPressed,this._keys[t].pressed,this._keys[t].justReleased),!0===this._doubleClicked[t]?(this.doubleClicked[t]=!0,this._doubleClicked[t]=!1):this.doubleClicked[t]=!1;this._wheelUpdated?(this.wheel=this._wheel,this._wheelUpdated=!1):this.wheel=0,this._positionUpdated?(this.delta.copy(this._delta),this.position.copy(this._position),this._delta.set(0,0),this._positionUpdated=!1):(this.delta.x=0,this.delta.y=0)},zi.create=function(){this.events.create()},zi.dispose=function(){this.events.destroy()},ji.prototype.addAndCreate=function(t,e,n){var r=[t,e,n,!0];r[0].addEventListener(r[1],r[2]),r[3]=!0,this.events.push(r)},ji.prototype.remove=function(t,e){for(var n=this.events.length-1;n>=0;n--)this.events[n][0]===t&&this.events[n][1]===e&&(this.events[n][3]&&(this.events[n][0].removeEventListener(this.events[n][1],this.events[n][2]),this.events[n][3]=!1),this.events.splice(n,1))},ji.prototype.add=function(t,e,n){this.events.push([t,e,n,!1])},ji.prototype.clear=function(){this.destroy(),this.events=[]},ji.prototype.create=function(){for(var t=0;t<this.events.length;t++){var e=this.events[t];e[0].addEventListener(e[1],e[2]),e[3]=!0}},ji.prototype.destroy=function(){for(var t=0;t<this.events.length;t++){var e=this.events[t];e[0].removeEventListener(e[1],e[2]),e[3]=!1}},ji.prototype.addScrollEvent=function(t,e){void 0!==window.onmousewheel?this.add(t,"mousewheel",e):void 0!==window.addEventListener?this.add(t,"DOMMouseScroll",(function(t){t.deltaY=30*t.detail,e(t)})):this.add(t,"wheel",e)},Gi.PI2=2*Math.PI,Gi.PID3=Math.PI/3,Gi.PID2=Math.PI/2,Gi.randomColor=function(){for(var t="#",e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t},Hi.encoding="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Hi.isBase64=function(t){if("string"!=typeof t)return!1;if(t.startsWith("data:"))return!0;for(var e=0;e<t.length;e++)if(!Hi.encoding.includes(t.charAt(e)))return!1;return!0},Hi.removeHeader=function(t){return t.slice(t.search(";base64,")+8)},Hi.getFileFormat=function(t){var e=t.indexOf("/")+1,n=t.indexOf(";");return t.substr(e,n-e)},Hi.fromArraybuffer=function(t){for(var e,n,r,i,s,o="",a=new Uint8Array(t),l=a.byteLength%3,c=a.byteLength-l,u=0;u<c;u+=3)e=(16515072&(s=a[u]<<16|a[u+1]<<8|a[u+2]))>>18,n=(258048&s)>>12,r=(4032&s)>>6,i=63&s,o+=Hi.encoding[e]+Hi.encoding[n]+Hi.encoding[r]+Hi.encoding[i];return 1===l?(e=(252&(s=a[c]))>>2,n=(3&s)<<4,o+=Hi.encoding[e]+Hi.encoding[n]+"=="):2===l&&(e=(64512&(s=a[c]<<8|a[c+1]))>>10,n=(1008&s)>>4,r=(15&s)<<2,o+=Hi.encoding[e]+Hi.encoding[n]+Hi.encoding[r]+"="),o},Hi.fromBinaryString=function(t){for(var e,n,r,i="",s=t.length%3,o=t.length-s,a=0;a<o;a+=3)e=255&t.charCodeAt(a),n=t.charCodeAt(a+1),r=t.charCodeAt(a+2),i+=Hi.encoding.charAt(e>>2),i+=Hi.encoding.charAt((3&e)<<4|(240&n)>>4),i+=Hi.encoding.charAt((15&n)<<2|(192&r)>>6),i+=Hi.encoding.charAt(63&r);return 1===s?(e=255&t.charCodeAt(a),i+=Hi.encoding.charAt(e>>2),i+=Hi.encoding.charAt((3&e)<<4),i+="=="):2===s&&(e=255&t.charCodeAt(a),n=t.charCodeAt(a+1),i+=Hi.encoding.charAt(e>>2),i+=Hi.encoding.charAt((3&e)<<4|(240&n)>>4),i+=Hi.encoding.charAt((15&n)<<2),i+="="),i},Vi.fromBinaryString=function(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),i=0;i<e;i++)r[i]=t.charCodeAt(i);return n},Vi.fromBase64=function(t){for(var e,n,r,i,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=t.length/4*3,a=new ArrayBuffer(o),l=new Uint8Array(a),c=0,u=0;c<o;c+=3)e=s.indexOf(t.charAt(u++)),n=s.indexOf(t.charAt(u++)),r=s.indexOf(t.charAt(u++)),i=s.indexOf(t.charAt(u++)),l[c]=e<<2|n>>4,64!==r&&(l[c+1]=(15&n)<<4|r>>2),64!==i&&(l[c+2]=(3&r)<<6|i);return a},Vi.fromBuffer=function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0;r<t.length;r++)n[r]=t[r];return e},Wi.fromArrayBuffer=function(t){for(var e=new Buffer(t.byteLength),n=new Uint8Array(t),r=0;r<e.length;r++)e[r]=n[r];return e};try{qi.fs=window.require?window.require("fs"):null}catch(t){}function Xi(t,e){this.name=t,this.uuid=n.Math.generateUUID(),this.type=e,this.format="",this.encoding="",this.data=null}function Yi(t,e){if(Xi.call(this,"image","Image"),this.width=-1,this.height=-1,void 0!==t)if(t instanceof ArrayBuffer)this.loadArrayBufferData(t,e);else if(Hi.isBase64(t))this.encoding=Hi.getFileFormat(t),this.format="base64",this.data=t;else if(t.startsWith("blob")){var n=qi.readFileArrayBuffer(t,!0);this.loadArrayBufferData(n)}else this.encoding=qi.getFileExtension(t),this.format="url",this.data=t;else this.createSolidColor()}function Ji(t,e,r,i,s,o,a,l,c,u){this.source="string"==typeof t?new Yi(t):void 0===t?new Yi:t,n.Texture.call(this,document.createElement("img"),e,r,i,s,o,a,l,c,u);var h=this;if(this.name="texture",this.category="Image",this.disposed=!1,this.format=this.source.hasTransparency()?n.RGBAFormat:n.RGBFormat,this.updateSource(),"gif"===this.source.encoding){function p(){h.disposed||(h.needsUpdate=!0,requestAnimationFrame(p))}this.generateMipmaps=!1,this.magFilter=n.LinearFilter,this.minFilter=n.LinearFilter,p()}}function Zi(t){n.AmbientLight.call(this,t),this.name="ambient",this.matrixAutoUpdate=!1}function Qi(t){n.Object3D.call(this),this.name="audio",this.type="Audio",this.listener=new n.AudioListener,this.context=this.listener.context,this.matrixAutoUpdate=!1,this.gain=this.context.createGain(),this.gain.connect(this.listener.getInput()),this.buffer=null,this.filters=[],this.sourceType="empty",this.audio=void 0!==t?t:null,this.autoplay=!0,this.volume=1,this.playbackRate=1,this.startTime=0,this.loop=!0,this.detune=0,this.isPlaying=!1,this.hasPlaybackControl=!0,this.filters=[]}function Ki(t,e,r,i,s,o,a,l,c,u){void 0===e&&(e=n.CubeReflectionMapping);for(var h=[],p=0;p<6;p++)h.push(document.createElement("canvas"));n.Texture.call(this,h,e,r,i,s,o,a,l,c,u),this.images=void 0!==t?t:[],this.size=512,this.flipY=!1,this.mode=6===this.images.length?Ki.CUBE:Ki.CROSS,this.images.length>0&&this.updateImages(),this.name="cubetexture",this.category="Cube"}function ts(t,e,r,i){n.Object3D.call(this),this.name="cubecamera",this.type="CubeCamera",this.near=void 0!==t?t:.01,this.far=void 0!==e?e:1e4,this.resolution=void 0!==r?r:256,this.autoUpdate=void 0!==i&&i,this.cameras=[];for(var s=0;s<6;s++){var o=new n.PerspectiveCamera(90,1,this.near,this.far);o.parent=this,this.cameras.push(o)}this.cameras[0].up.set(0,-1,0),this.cameras[0].lookAt(new n.Vector3(1,0,0)),this.cameras[1].up.set(0,-1,0),this.cameras[1].lookAt(new n.Vector3(-1,0,0)),this.cameras[2].up.set(0,0,1),this.cameras[2].lookAt(new n.Vector3(0,1,0)),this.cameras[3].up.set(0,0,-1),this.cameras[3].lookAt(new n.Vector3(0,-1,0)),this.cameras[4].up.set(0,-1,0),this.cameras[4].lookAt(new n.Vector3(0,0,1)),this.cameras[5].up.set(0,-1,0),this.cameras[5].lookAt(new n.Vector3(0,0,-1)),this.renderTarget=new n.WebGLCubeRenderTarget(this.resolution,{format:n.RGBFormat,magFilter:n.LinearFilter,minFilter:n.LinearFilter,generateMipmaps:!1});var a=this;Object.defineProperties(this,{cube:{get:function(){return a.renderTarget.texture},set:function(){}}}),this.scene=null,this.renderer=null}function es(t,e){n.DirectionalLight.call(this,t,e),this.name="directional",this.castShadow=!0,this.shadow.camera.near=.5,this.shadow.camera.far=1e4}qi.isLocalFile=function(t){return!(t.startsWith("http")||t.startsWith("blob")||t.startsWith("data"))},qi.readFile=function(t,e,n,r,i){if(void 0===e&&(e=!0),qi.fs&&qi.isLocalFile(t)){if(!0===e){var s=qi.fs.readFileSync(t,"utf8");return void 0!==n&&n(s),s}return qi.fs.readFile(t,"utf8",(function(t,e){null!==t?void 0!==i&&i(t):void 0!==n&&n(e)})),null}var o=new XMLHttpRequest;return o.overrideMimeType("text/plain"),o.open("GET",t,!e),void 0!==n&&(o.onload=function(){n(o.response)}),void 0!==r&&(o.onprogress=r),void 0!==i&&(o.onerror=i),o.send(null),!0===e?o.response:null},qi.readFileArrayBuffer=function(t,e,n,r,i){if(void 0===e&&(e=!0),qi.fs&&qi.isLocalFile(t)){if(!0===e){var s=qi.fs.readFileSync(t);return Vi.fromBuffer(s)}return qi.fs.readFile(t,(function(t,e){null!==t?void 0!==i&&i(t):void 0!==n&&n(Vi.fromBuffer(e))})),null}var o=new XMLHttpRequest;return o.open("GET",t,!e),o.overrideMimeType("text/plain; charset=x-user-defined"),void 0!==n&&(o.onload=function(){n(Vi.fromBinaryString(o.response))}),void 0!==r&&(o.onprogress=r),void 0!==i&&(o.onerror=i),o.send(null),!0===e?Vi.fromBinaryString(o.response):null},qi.readFileBase64=function(t,e,n,r,i){if(void 0===e&&(e=!0),qi.fs&&qi.isLocalFile(t)){if(!0===e){var s=qi.fs.readFileSync(t);return new Buffer(s).toString("base64")}return qi.fs.readFile(t,(function(t,e){null!==t?void 0!==i&&i(t):void 0!==n&&n(new Buffer(e).toString("base64"))})),null}var o=new XMLHttpRequest;return o.open("GET",t,!e),o.overrideMimeType("text/plain; charset=x-user-defined"),void 0!==n&&(o.onload=function(){n(Hi.fromBinaryString(o.response))}),void 0!==r&&(o.onprogress=r),void 0!==i&&(o.onerror=i),o.send(null),!0===e?Hi.fromBinaryString(o.response):null},qi.writeFile=function(t,e,n,r){if(qi.fs)if(void 0!==qi.fs.writeFileSync)!1!==n?(qi.fs.writeFileSync(t,e,"utf8"),void 0!==r&&r()):qi.fs.writeFile(t,e,"utf8",r);else{var i=qi.fs.createWriteStream(t,"utf8");i.write(e),i.end()}else{var s=new Blob([e],{type:"octet/stream"}),o=document.createElement("a");o.download=t,o.href=window.URL.createObjectURL(s),o.style.display="none",o.onclick=function(){document.body.removeChild(this)},document.body.appendChild(o),o.click(),void 0!==r&&r()}},qi.writeFileBase64=function(t,e,n,r){if(qi.fs){var i=Buffer.from(Hi.removeHeader(e),"base64");if(void 0!==qi.fs.writeFile)!1!==n?(qi.fs.writeFileSync(t,i),void 0!==r&&r()):qi.fs.writeFile(t,i,r);else{var s=qi.fs.createWriteStream(t);s.write(i),s.end()}}else{var o=Vi.fromBase64(Hi.removeHeader(e)),a=new Blob([o]),l=document.createElement("a");l.download=t,l.href=window.URL.createObjectURL(a),l.onclick=function(){document.body.removeChild(this)},l.style.display="none",document.body.appendChild(l),l.click(),void 0!==r&&r()}},qi.writeFileArrayBuffer=function(t,e,n,r){if(qi.fs){var i=Wi.fromArrayBuffer(e);if(void 0!==qi.fs.writeFileSync)!1!==n?(qi.fs.writeFileSync(t,i),void 0!==r&&r()):qi.fs.writeFile(t,i,r);else{var s=qi.fs.createWriteStream(t);s.write(i),s.end()}}else{var o=new Blob([e]),a=document.createElement("a");a.download=t,a.href=window.URL.createObjectURL(o),a.onclick=function(){document.body.removeChild(this)},a.style.display="none",document.body.appendChild(a),a.click(),void 0!==r&&r()}},qi.chooseFileWrite=function(t,e){jc.runningOnDesktop()?qi.chooseFile((function(e){e.length>0&&t(e[0].path)}),e,!0):qi.chooseFileName((function(e){t(e)}),e)},qi.chooseDirectory=function(){return new Promise((function(t,e){var n=document.createElement("input");n.type="file",n.style.display="none",n.nwdirectory=!0,document.body.appendChild(n),n.onchange=function(){t(n.value),document.body.removeChild(n)},n.onerror=e,n.onabort=e,n.click()}))},qi.chooseFile=function(t,e,n,r){var i=document.createElement("input");i.type="file",i.style.display="none",document.body.appendChild(i),void 0!==e&&(i.accept=e),!0===r&&(i.multiple=!0),i.onchange=function(){void 0!==t&&t(i.files),document.body.removeChild(i)},void 0!==n&&(i.nwsaveas=!0!==n?n:"file"),i.click()},qi.chooseFileName=function(t,e,n){var r=prompt("Save As",void 0!==n?n:"file");null!==r&&(void 0===e||r.endsWith(e)||(r+=e),void 0!==t&&t(r))},qi.copyFile=function(t,e){qi.fs&&(void 0!==qi.fs.copyFileSync?qi.fs.copyFileSync(t,e):(t.replace(new RegExp("/","g"),"\\"),e.replace(new RegExp("/","g"),"\\"),qi.fs.createReadStream(t).pipe(qi.fs.createWriteStream(e))))},qi.makeDirectory=function(t){qi.fs&&(t.replace(new RegExp("/","g"),"\\"),qi.fs.mkdirSync(t,{recursive:!0}))},qi.getFilesDirectory=function(t){if(qi.fs)try{return t.replace(new RegExp("/","g"),"\\"),qi.fs.readdirSync(t)}catch(t){return[]}return[]},qi.deleteFolder=function(t){qi.fs&&qi.fs.existsSync(t)&&(qi.fs.readdirSync(t).forEach((function(e){var n=t+"/"+e;qi.fs.lstatSync(n).isDirectory()?qi.deleteFolder(n):qi.fs.unlinkSync(n)})),qi.fs.rmdirSync(t))},qi.copyFolder=function(t,e){if(qi.fs){t.replace(new RegExp("/","g"),"\\"),e.replace(new RegExp("/","g"),"\\"),qi.makeDirectory(e);for(var n=qi.fs.readdirSync(t),r=0;r<n.length;r++){var i=t+"\\"+n[r],s=e+"\\"+n[r],o=qi.fs.statSync(i);o.isDirectory()?qi.copyFolder(i,s):o.isSymbolicLink()?qi.fs.symlinkSync(qi.fs.readlinkSync(i),s):qi.copyFile(i,s)}}},qi.fileExists=function(t){return!!qi.fs&&(t.replace(new RegExp("/","g"),"\\"),qi.fs.existsSync(t))},qi.getFileName=function(t){if(void 0!==t){t instanceof File&&(t=t.name);var e=t.lastIndexOf("\\"),n=t.lastIndexOf("/");return t.substring(e>n?e+1:n+1,t.lastIndexOf("."))}return""},qi.getFileNameWithExtension=function(t){if(void 0!==t){t instanceof File&&(t=t.name);var e=t.lastIndexOf("\\"),n=t.lastIndexOf("/");return t.substring(e>n?e+1:n+1,t.length)}return""},qi.getNameWithoutExtension=function(t){return void 0!==t?(t instanceof File&&(t=t.name),t.substring(0,t.lastIndexOf("."))):""},qi.getFilePath=function(t){if(void 0!==t){t instanceof File&&(t=t.name);var e=t.lastIndexOf("\\"),n=t.lastIndexOf("/");return t.substring(0,e>n?e+1:n+1)}return""},qi.getFileExtension=function(t){return void 0!==t?(t instanceof File&&(t=t.name),t.substring(t.lastIndexOf(".")+1,t.length).toLowerCase()):""},Xi.prototype.export=function(t){"base64"===this.format?qi.writeFileBase64(t,this.data):"arraybuffer"===this.format?qi.writeFileArrayBuffer(t,void 0!==this.arraybuffer?this.arraybuffer:this.data):"string"===this.format?qi.writeFile(t,this.data):"json"===this.format?qi.writeFile(t,JSON.stringify(this.data)):"url"===this.format&&qi.writeFileArrayBuffer(t,qi.readFileArrayBuffer(this.data))},Xi.prototype.dispose=function(){},Xi.prototype.toJSON=function(t){var e={};return e.name=this.name,e.uuid=this.uuid,e.type=this.type,e},Yi.prototype=Object.create(Xi.prototype),Yi.fileIsImage=function(t){return void 0!==t&&(!!t.type.startsWith("image")||(t=t.name.toLocaleLowerCase()).endsWith("tga")||t.endsWith("dds")||t.endsWith("pvr")||t.endsWith("ktx")||t.endsWith("basis"))},Yi.prototype.getImageSize=function(t){if(this.width>-1&&this.height>-1)t(this.width,this.height);else{var e=this,n=document.createElement("img");n.src=this.data,n.onload=function(){e.width=n.naturalWidth,e.height=n.naturalHeight,t(e.width,e.height)}}},Yi.prototype.getImageData=function(t){var e=this,n=document.createElement("img");n.src=this.data,n.onload=function(){e.width=n.naturalWidth,e.height=n.naturalHeight;var r=document.createElement("canvas");r.width=n.naturalWidth,r.height=n.naturalWidth;var i=r.getContext("2d");i.drawImage(n,0,0,n.width,n.height),t(i.getImageData(0,0,n.width,n.height),e.width,e.height)}},Yi.prototype.createSolidColor=function(t){var e=document.createElement("canvas");e.width=1,e.height=1;var n=e.getContext("2d");n.fillStyle=void 0!==t?t:Gi.randomColor(),n.fillRect(0,0,1,1),this.data=e.toDataURL("image/png"),this.format="base64",this.encoding="png"},Yi.prototype.loadArrayBufferData=function(t,e){var n=new Uint8Array(t),r=new Blob([n],{type:"image/"+e});this.data=URL.createObjectURL(r),this.arraybuffer=t,this.encoding=void 0!==e?e:"",this.format="arraybuffer"},Yi.prototype.hasTransparency=function(t){if(!0===t&&this.width>-1&&this.height>-1){var e=document.createElement("img"),n=document.createElement("canvas");n.width=e.width,n.height=e.height;var r=n.getContext("2d");r.drawImage(e,0,0,e.width,e.height);for(var i=r.getImageData(0,0,e.width,e.height).data,s=3;s<i.length;s+=4)if(255!==i[s])return!0;return!1}return"png"===this.encoding||"gif"===this.encoding},Yi.prototype.compressJPEG=function(t){var e=document.createElement("img");e.src=this.data;var n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0,e.width,e.height);var r=this;n.toBlob((function(t){var e=new FileReader;e.onload=function(){r.encoding="jpeg",r.format="arraybuffer",r.data=e.result},e.readAsArrayBuffer(t)}),"image/jpeg",void 0!==t?t:.7)},Yi.prototype.dispose=function(){"arraybuffer"===this.format&&URL.revokeObjectURL(this.data)},Yi.prototype.toJSON=function(t){if(void 0!==t.images[this.uuid])return t.images[this.uuid];var e=Xi.prototype.toJSON.call(this,t);return"url"===this.format&&this.loadArrayBufferData(qi.readFileArrayBuffer(this.data),this.encoding),e.width=this.width,e.height=this.height,e.encoding=this.encoding,"arraybuffer"===this.format?(e.format=this.format,e.data=this.arraybuffer):"base64"===this.format?(e.format="arraybuffer",e.data=Vi.fromBase64(Hi.removeHeader(this.data))):(e.format=this.format,e.data=this.data),t.images[this.uuid]=e,e},Ji.prototype=Object.create(n.Texture.prototype),Ji.isTexture=!0,Ji.prototype.updateSource=function(){if(null!==this.source){var t=this;this.image.crossOrigin="anonymous",this.image.src=this.source.data,this.image.onload=function(){t.needsUpdate=!0},this.image.onerror=function(){console.log("nunuStudio: Failed to load image "+t.source.uuid+" data."),t.source.createSolidColor(),t.image.src=t.source.data,t.needsUpdate=!0}}else console.warn("nunuStudio: Texture source is null."),this.source.createSolidColor(),this.image.src=t.source.data,this.needsUpdate=!0},Ji.prototype.dispose=function(){n.Texture.prototype.dispose.call(this),this.disposed=!0},Ji.prototype.toJSON=function(t){var e=n.Texture.prototype.toJSON.call(this,t),r=this.source.toJSON(t);return e.image=r.uuid,e},Zi.prototype=Object.create(n.AmbientLight.prototype),Qi.prototype=Object.create(n.Object3D.prototype),Qi.SOURCE={EMPTY:"empty",BUFFER:"buffer",NODE:"audioNode"},Qi.prototype.onEnded=function(){this.isPlaying=!1},Qi.prototype.connect=function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},Qi.prototype.disconnect=function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},Qi.prototype.initialize=function(){if(null!==this.audio){var t=this;this.audio.getAudioBuffer(this.context,(function(e){t.setBuffer(e)}))}else console.warn("nunuStudio: AudioEmitter audio is null.");this.setVolume(this.volume),this.setPlaybackRate(this.playbackRate),n.Object3D.prototype.initialize.call(this)},Qi.prototype.setBuffer=function(t){return this.buffer=t,this.sourceType="buffer",!0===this.autoplay&&this.play(),this},Qi.prototype.play=function(){if(null!==this.buffer){this.isPlaying&&console.warn("nunuStudio: Audio is already playing, its only possible to control the last playing instance.");var t=this.context.createBufferSource();return t.buffer=this.buffer,t.detune.value=this.detune,t.loop=this.loop,t.onended=this.onEnded.bind(this),t.playbackRate.setValueAtTime(this.playbackRate,this.startTime),t.start(0,this.startTime),this.isPlaying=!0,this.source=t,this.connect()}console.warn("nunuStudio: Audio buffer not ready, audio will not play.")},Qi.prototype.pause=function(){return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this},Qi.prototype.stop=function(){return this.source.stop(),this.startTime=0,this.isPlaying=!1,this},Qi.prototype.setAudio=function(t){this.audio=t,null!==this.buffer&&(this.isPlaying&&this.stop(),this.disconnect());var e=this;this.audio.getAudioBuffer(this.context,(function(t){e.setBuffer(t)}))},Qi.prototype.getVolume=function(){return this.gain.gain.value},Qi.prototype.setVolume=function(t){return this.volume=t,this.gain.gain.value=t,this},Qi.prototype.setLoop=function(t){return this.loop=t,this.isPlaying&&(this.source.loop=this.loop),this},Qi.prototype.setDetune=function(t){return this.detune=t,!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},Qi.prototype.getLoop=function(){return this.loop},Qi.prototype.setPlaybackRate=function(t){return this.playbackRate=t,this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this},Qi.prototype.getPlaybackRate=function(){return this.playbackRate},Qi.prototype.getFilters=function(){return this.filters},Qi.prototype.setFilters=function(t){return t||(t=[]),this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},Qi.prototype.getFilter=function(t){return this.getFilters()[void 0!==t?t:0]},Qi.prototype.setFilter=function(t){return this.setFilters(t?[t]:[])},Qi.prototype.setNodeSource=function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},Qi.prototype.getOutput=function(){return this.gain},Qi.prototype.dispose=function(){this.isPlaying&&(this.stop(),this.disconnect()),n.Object3D.prototype.dispose.call(this)},Qi.prototype.toJSON=function(t){var e=this.audio,r=n.Object3D.prototype.toJSON.call(this,t,(function(t,n){e=e.toJSON(t)}));return r.object.audio=e.uuid,r.object.volume=this.volume,r.object.autoplay=this.autoplay,r.object.startTime=this.startTime,r.object.playbackRate=this.playbackRate,r.object.loop=this.loop,r},Ki.prototype=Object.create(n.Texture.prototype),Ki.prototype.constructor=Ki,Ki.prototype.isCubeTexture=!0,Ki.RIGHT=0,Ki.LEFT=1,Ki.TOP=2,Ki.BOTTOM=3,Ki.FRONT=4,Ki.BACK=5,Ki.CUBE=20,Ki.CROSS=21,Ki.EQUIRECTANGULAR=22,Ki.prototype.setSize=function(t){0==(t&t-1)?this.size=t:console.warn("nunuStudio: CubeTexture new size is not a power of two.")},Ki.prototype.setImages=function(t,e){this.mode=void 0!==e?e:Ki.CUBE,this.images=t},Ki.prototype.updateImages=function(){var t=this;if(this.mode===Ki.CUBE)for(var e=0;e<this.images.length;e++)"string"==typeof this.images[e]&&(this.images[e]=new Yi(this.images[e])),(n=document.createElement("img")).crossOrigin="anonymous",n.index=e,n.src=this.images[e].data,n.onload=function(){t.image[this.index].width=t.size,t.image[this.index].height=t.size,t.image[this.index].getContext("2d").drawImage(this,0,0,t.size,t.size),t.needsUpdate=!0};else if(this.mode===Ki.CROSS){for(e=0;e<this.image.length;e++)this.image[e].width=this.size,this.image[e].height=this.size;(n=document.createElement("img")).src=this.images[0].data,n.onload=function(){var e=this.naturalWidth/4,n=this.naturalHeight/3;t.image[Ki.LEFT].getContext("2d").drawImage(this,0,n,e,n,0,0,t.size,t.size),t.image[Ki.FRONT].getContext("2d").drawImage(this,e,n,e,n,0,0,t.size,t.size),t.image[Ki.RIGHT].getContext("2d").drawImage(this,2*e,n,e,n,0,0,t.size,t.size),t.image[Ki.BACK].getContext("2d").drawImage(this,3*e,n,e,n,0,0,t.size,t.size),t.image[Ki.TOP].getContext("2d").drawImage(this,e,0,e,n,0,0,t.size,t.size),t.image[Ki.BOTTOM].getContext("2d").drawImage(this,e,2*n,e,n,0,0,t.size,t.size),t.needsUpdate=!0}}else if(this.mode===Ki.EQUIRECTANGULAR){for(e=0;e<this.image.length;e++)this.image[e].width=this.size,this.image[e].height=this.size;var n;(n=document.createElement("img")).src=this.images[0].data,n.onload=function(){var e=document.createElement("canvas");e.width=n.naturalWidth,e.height=n.naturalHeight;var r=e.getContext("2d");r.drawImage(n,0,0);for(var i=r.getImageData(0,0,e.width,e.height),s=0;s<6;s++){var o=Ki.renderEquirectFace(i,s,Math.PI,t.size);t.image[s].getContext("2d").putImageData(o,0,0)}t.needsUpdate=!0}}},Ki.resampleBilinear=function(t,e,r,i,s){for(var o=t.width,a=t.height,l=t.data,c=n.Math.clamp(Math.floor(r),0,o-1),u=n.Math.clamp(Math.ceil(r),0,o-1),h=r-c,p=n.Math.clamp(Math.floor(i),0,a-1),d=n.Math.clamp(Math.ceil(i),0,a-1),f=i-p,m=4*(p*o+c),_=4*(p*o+u),g=4*(d*o+c),y=4*(d*o+u),v=0;v<3;v++){var b=l[m+v]*(1-h)+l[_+v]*h,x=l[g+v]*(1-h)+l[y+v]*h;e.data[s+v]=Math.ceil(b*(1-f)+x*f)}},Ki.renderEquirectFace=function(t,e,r,i){for(var s=new ImageData(i,i),o=Ki.faces[e],a=0;a<i;a++)for(var l=0;l<i;l++){var c=4*(l*i+a);s.data[c+3]=255;var u=o(2*(a+.5)/i-1,2*(l+.5)/i-1),h=Math.sqrt(u.x*u.x+u.y*u.y+u.z*u.z),p=n.Math.euclideanModulo(Math.atan2(u.y,u.x)+r,2*Math.PI),d=Math.acos(u.z/h),f=t.width*p/Math.PI/2-.5,m=t.height*d/Math.PI-.5;Ki.resampleBilinear(t,s,f,m,c)}return s},Ki.faces=[function(t,e){return new n.Vector3(t,-1,-e)},function(t,e){return new n.Vector3(-t,1,-e)},function(t,e){return new n.Vector3(-e,-t,1)},function(t,e){return new n.Vector3(e,-t,-1)},function(t,e){return new n.Vector3(-1,-t,-e)},function(t,e){return new n.Vector3(1,t,-e)}],Ki.prototype.toJSON=function(t){var e=n.Texture.prototype.toJSON.call(this,t);if(e.size=this.size,e.mode=this.mode,e.images=[],this.mode===Ki.EQUIRECTANGULAR||this.mode===Ki.CROSS){var r=this.images[0].toJSON(t);e.images.push(r.uuid)}else for(var i=0;i<this.images.length;i++)r=this.images[i].toJSON(t),e.images.push(r.uuid);return e},ts.prototype=Object.create(n.Object3D.prototype),ts.prototype.initialize=function(){for(var t=this;null!==t.parent;)(t=t.parent)instanceof Bc?this.scene=t:t instanceof Cc&&(this.renderer=t.renderer);n.Object3D.prototype.initialize.call(this)},ts.prototype.update=function(t){this.autoUpdate&&this.updateCubeMap(this.renderer,this.scene),n.Object3D.prototype.update.call(this,t)},ts.prototype.setResolution=function(t){this.resolution=t,this.renderTarget.setSize(t,t)},ts.prototype.clear=function(t,e,n,r){for(var i=t.getRenderTarget(),s=0;s<6;s++)t.setRenderTarget(this.renderTarget,s),t.clear(e,n,r);t.setRenderTarget(i)},ts.prototype.updateCubeMap=function(t,e){var n=t.autoClear;t.autoClear=!1;var r=t.getRenderTarget(),i=this.renderTarget.texture.generateMipmaps;this.renderTarget.texture.generateMipmaps=!1;for(var s=0;s<6;s++)5===s&&(this.renderTarget.texture.generateMipmaps=i),this.cameras[s].updateMatrixWorld(),t.setRenderTarget(this.renderTarget,s),t.clear(!0,!0,!0),t.render(e,this.cameras[s]);t.autoClear=n,t.setRenderTarget(r)},ts.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return e.object.near=this.near,e.object.far=this.far,e.object.resolution=this.resolution,e.object.autoUpdate=this.autoUpdate,e},es.prototype=Object.create(n.DirectionalLight.prototype),es.prototype.updateShadowMap=function(){this.shadow.map.dispose(),this.shadow.map=null,this.shadow.camera.updateProjectionMatrix()};var ns,rs,is,ss={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")};function os(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(os.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),os.FullScreenQuad=(ns=new n.OrthographicCamera(-1,1,1,-1,0,1),rs=new n.PlaneBufferGeometry(2,2),is=function(t){this._mesh=new n.Mesh(rs,t)},Object.defineProperty(is.prototype,"material",{get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}),Object.assign(is.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(t){t.render(this._mesh,ns)}}),is);var as=function(t,e){os.call(this),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1};as.prototype=Object.assign(Object.create(os.prototype),{constructor:as,render:function(t,e,n){var r,i,s=t.getContext(),o=t.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(r=0,i=1):(r=1,i=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.buffers.stencil.setFunc(s.ALWAYS,r,4294967295),o.buffers.stencil.setClear(i),o.buffers.stencil.setLocked(!0),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(s.EQUAL,1,4294967295),o.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.buffers.stencil.setLocked(!0)}});var ls=function(){os.call(this),this.needsSwap=!1};function cs(){this.autoClear=!1,this.autoClearColor=!1,this.autoClearStencil=!1,this.autoClearDepth=!1,this.sortObjects=!0,this.clearColor=new n.Color,this.clearAlpha=1}function us(){this.uuid=n.Math.generateUUID(),this.type="Pass",this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1,this.copyToScreen=!1}function hs(t,e){us.call(this),this.type="Shader",this.textureID=void 0!==e?e:"tDiffuse",t instanceof n.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=n.UniformsUtils.clone(t.uniforms),this.material=new n.ShaderMaterial({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.createQuadScene()}function ps(){us.call(this),this.type="Render",this.clear=!0}ls.prototype=Object.create(os.prototype),Object.assign(ls.prototype,{render:function(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}),cs.prototype.backup=function(t){this.autoClear=t.autoClear,this.autoClearColor=t.autoClearColor,this.autoClearStencil=t.autoClearStencil,this.autoClearDepth=t.autoClearDepth,this.sortObjects=t.sortObjects,this.clearColor.copy(t.getClearColor()),this.clearAlpha=t.getClearAlpha()},cs.prototype.restore=function(t){t.autoClear=this.autoClear,t.autoClearColor=this.autoClearColor,t.autoClearStencil=this.autoClearStencil,t.autoClearDepth=this.autoClearDepth,t.sortObjects=this.sortObjects,t.setClearColor(this.clearColor),t.setClearAlpha(this.clearAlpha)},us.RGBALinear={minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat},us.RGBLinear={minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBFormat},us.RGBANearest={minFilter:n.NearestFilter,magFilter:n.NearestFilter,format:n.RGBAFormat},us.prototype.createQuadScene=function(){this.camera=new n.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new n.Scene,this.quad=new n.Mesh(new n.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},us.prototype.setSize=function(t,e){},us.prototype.render=function(t,e,n,r,i,s,o){},us.prototype.dispose=function(){},us.prototype.toJSON=function(t){var e={};return e.uuid=this.uuid,e.type=this.type,e.clear=this.clear,e.enabled=this.enabled,e.needsSwap=this.needsSwap,e.renderToScreen=this.renderToScreen,e.copyToScreen=this.copyToScreen,e},hs.prototype=Object.create(us.prototype),hs.prototype.render=function(t,e,n,r,i,s,o){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.quad.material=this.material,t.setRenderTarget(this.renderToScreen?null:e),this.clear&&t.clear(),t.render(this.scene,this.camera)},ps.prototype=Object.create(us.prototype),ps.prototype.render=function(t,e,n,r,i,s,o){this.clear?(t.autoClear=!0,t.autoClearColor=!0,t.autoClearDepth=!0,t.autoClearStencil=!0):t.autoClear=!1,t.setRenderTarget(this.renderToScreen?null:e),t.render(s,o)};var ds={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new n.Color(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","\tgl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")};function fs(t,e,r){us.call(this),this.type="UnrealBloom",this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;for(var i=0;i<this.nMips;i++){var s;(s=new n.WebGLRenderTarget(0,0,us.RGBALinear)).texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(s),(s=new n.WebGLRenderTarget(0,0,us.RGBALinear)).texture.generateMipmaps=!1,this.renderTargetsVertical.push(s)}this.renderTargetBright=new n.WebGLRenderTarget(0,0,us.RGBALinear),this.renderTargetBright.texture.generateMipmaps=!1;var o=ds;this.highPassUniforms=n.UniformsUtils.clone(o.uniforms),this.materialHighPassFilter=new n.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var a=[3,5,7,9,11];for(i=0;i<this.nMips;i++)this.separableBlurMaterials.push(fs.getSeperableBlurMaterial(a[i])),this.separableBlurMaterials[i].uniforms.texSize.value=new n.Vector2(0,0);this.compositeMaterial=fs.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.highPassUniforms.luminosityThreshold.value=void 0!==r?r:.7,this.highPassUniforms.smoothWidth.value=.01,this.compositeMaterial.uniforms.bloomStrength.value=void 0!==t?t:.8,this.compositeMaterial.uniforms.bloomRadius.value=void 0!==e?e:.3,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.compositeMaterial.uniforms.bloomTintColors.value=[new n.Vector3(1,1,1),new n.Vector3(1,1,1),new n.Vector3(1,1,1),new n.Vector3(1,1,1),new n.Vector3(1,1,1)],this.compositeMaterial.needsUpdate=!0,this.copyUniforms=n.UniformsUtils.clone(ss.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new n.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:ss.vertexShader,fragmentShader:ss.fragmentShader,blending:n.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.createQuadScene(),this.basic=new n.MeshBasicMaterial,Object.defineProperties(this,{strength:{get:function(){return this.compositeMaterial.uniforms.bloomStrength.value},set:function(t){this.compositeMaterial.uniforms.bloomStrength.value=t}},radius:{get:function(){return this.compositeMaterial.uniforms.bloomRadius.value},set:function(t){this.compositeMaterial.uniforms.bloomRadius.value=t}},threshold:{get:function(){return this.highPassUniforms.luminosityThreshold.value},set:function(t){this.highPassUniforms.luminosityThreshold.value}},smooth:{get:function(){return this.highPassUniforms.smoothWidth.value},set:function(t){this.highPassUniforms.smoothWidth.value}},bloomFactors:{get:function(){return this.compositeMaterial.uniforms.bloomFactors.value},set:function(t){this.compositeMaterial.uniforms.bloomFactors.value}},bloomTintColors:{get:function(){return this.compositeMaterial.uniforms.bloomTintColors.value},set:function(t){this.compositeMaterial.uniforms.bloomTintColors.value=t}}})}fs.prototype=Object.create(us.prototype),fs.BlurDirectionX=new n.Vector2(1,0),fs.BlurDirectionY=new n.Vector2(0,1),fs.prototype.dispose=function(){for(var t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()},fs.prototype.setSize=function(t,e){var n=Math.round(t/2),r=Math.round(e/2);this.renderTargetBright.setSize(n,r);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(n,r),this.renderTargetsVertical[i].setSize(n,r),this.separableBlurMaterials[i].uniforms.texSize.value.set(n,r),n=Math.round(n/2),r=Math.round(r/2)},fs.prototype.render=function(t,e,r,i,s,o,a){t.autoClear=!1,t.setClearColor(new n.Color(0,0,0),0),s&&t.context.disable(t.context.STENCIL_TEST),this.renderToScreen&&(this.quad.material=this.basic,this.basic.map=r.texture,t.setRenderTarget(null),t.clear(),t.render(this.scene,this.camera)),this.highPassUniforms.tDiffuse.value=r.texture,this.quad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),t.render(this.scene,this.camera);for(var l=this.renderTargetBright,c=0;c<this.nMips;c++)this.quad.material=this.separableBlurMaterials[c],this.separableBlurMaterials[c].uniforms.colorTexture.value=l.texture,this.separableBlurMaterials[c].uniforms.direction.value=fs.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[c]),t.clear(),t.render(this.scene,this.camera),this.separableBlurMaterials[c].uniforms.colorTexture.value=this.renderTargetsHorizontal[c].texture,this.separableBlurMaterials[c].uniforms.direction.value=fs.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[c]),t.clear(),t.render(this.scene,this.camera),l=this.renderTargetsVertical[c];this.quad.material=this.compositeMaterial,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.render(this.scene,this.camera),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,s&&t.context.enable(t.context.STENCIL_TEST),t.setRenderTarget(this.renderToScreen?null:r),t.render(this.scene,this.camera)},fs.prototype.toJSON=function(t){var e=us.prototype.toJSON.call(this,t);e.strength=this.strength,e.radius=this.radius,e.threshold=this.threshold,e.bloomFactors=this.bloomFactors,e.bloomTintColors=[];for(var n=0;n<this.bloomTintColors.length;n++)e.bloomTintColors.push(this.bloomTintColors[n].toArray());return e},fs.getSeperableBlurMaterial=function(t){return new n.ShaderMaterial({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new n.Vector2(.5,.5)},direction:{value:new n.Vector2(.5,.5)}},vertexShader:"\n\t\t\tvarying vec2 vUv;\n\t\t\tvoid main()\n\t\t\t{\n\t\t\t\tvUv = uv;\n\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\t}",fragmentShader:"\n\t\t\t#include <common>\n\t\t\tvarying vec2 vUv;\n\t\t\tuniform sampler2D colorTexture;\n\t\t\tuniform vec2 texSize;\n\t\t\tuniform vec2 direction;\n\t\t\t\n\t\t\tfloat gaussianPdf(in float x, in float sigma)\n\t\t\t{\n\t\t\t\treturn 0.39894 * exp(-0.5 * x * x / (sigma * sigma)) / sigma;\n\t\t\t}\n\t\t\t\n\t\t\tvoid main()\n\t\t\t{\n\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\tfloat fSigma = float(SIGMA);\n\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\n\t\t\t\tvec3 diffuseSum = texture2D(colorTexture, vUv).rgb * weightSum;\n\t\t\t\tfor(int i = 1; i < KERNEL_RADIUS; i++)\n\t\t\t\t{\n\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\n\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\tvec3 sample1 = texture2D(colorTexture, vUv + uvOffset).rgb;\n\t\t\t\t\tvec3 sample2 = texture2D(colorTexture, vUv - uvOffset).rgb;\n\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t}\n\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t}"})},fs.getCompositeMaterial=function(t){return new n.ShaderMaterial({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"\n\t\t\tvarying vec2 vUv;\n\t\t\tvoid main()\n\t\t\t{\n\t\t\t\tvUv = uv;\n\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\t}",fragmentShader:"\n\t\t\tvarying vec2 vUv;\n\t\t\tuniform sampler2D blurTexture1;\n\t\t\tuniform sampler2D blurTexture2;\n\t\t\tuniform sampler2D blurTexture3;\n\t\t\tuniform sampler2D blurTexture4;\n\t\t\tuniform sampler2D blurTexture5;\n\t\t\tuniform sampler2D dirtTexture;\n\t\t\tuniform float bloomStrength;\n\t\t\tuniform float bloomRadius;\n\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\t\t\t\n\t\t\tfloat lerpBloomFactor(const in float factor)\n\t\t\t{\n\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t}\n\t\t\t\n\t\t\tvoid main()\n\t\t\t{\n\t\t\t\tgl_FragColor = bloomStrength * (lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \n\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \n\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \n\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \n\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv));\n\t\t\t}"})};var ms={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","\tvec4 newTex = vec4(tex.r, (tex.g + tex.b) * .5, (tex.g + tex.b) * .5, 1.0);","\tgl_FragColor = newTex;","}"].join("\n")};function _s(){hs.call(this,ms),this.type="Technicolor"}_s.prototype=Object.create(hs.prototype);var gs={uniforms:{tDiffuse:{value:null},tDepth:{value:null},size:{value:new n.Vector2(512,512)},cameraNear:{value:1},cameraFar:{value:100},radius:{value:32},onlyAO:{value:0},aoClamp:{value:.25},lumInfluence:{value:.7}},vertexShader:"varying vec2 vUv;\n\nvoid main()\n{\n\tvUv = uv;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"uniform float cameraNear;\nuniform float cameraFar;\n\n#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n#endif\n\nuniform float radius; // ao radius \nuniform bool onlyAO; // use only ambient occlusion pass?\n\nuniform vec2 size; // texture width, height\nuniform float aoClamp; // depth clamp - reduces haloing at screen edges\n\nuniform float lumInfluence; // how much luminance affects occlusion\n\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\n\nvarying vec2 vUv;\n\n#define DL 2.399963229728653 // PI *(3.0 - sqrt(5.0))\n#define EULER 2.718281828459045\n\n// user variables\nconst int samples = 64; // ao sample count\nconst bool useNoise = true; // use noise instead of pattern for sample dithering\nconst float noiseAmount = 0.0004; // dithering amount\nconst float diffArea = 0.4; // self-shadowing reduction\nconst float gDisplace = 0.4; // gauss bell center\n\n// RGBA depth\n#include <packing>\n\n// generating noise / pattern texture for dithering\nvec2 rand(const vec2 coord)\n{\n\tvec2 noise;\n\n\tif(useNoise)\n\t{\n\t\tfloat nx = dot(coord, vec2(12.9898, 78.233));\n\t\tfloat ny = dot(coord, vec2(12.9898, 78.233) * 2.0);\n\t\tnoise = clamp(fract(43758.5453 * sin(vec2(nx, ny))), 0.0, 1.0);\n\t}\n\telse\n\t{\n\t\tfloat ff = fract(1.0 - coord.s *(size.x / 2.0));\n\t\tfloat gg = fract(coord.t *(size.y / 2.0));\n\t\tnoise = vec2(0.25, 0.75) * vec2(ff) + vec2(0.75, 0.25) * gg;\n\t}\n\n\treturn(noise * 2.0  - 1.0) * noiseAmount;\n}\n\nfloat readDepth(const in vec2 coord) {\n\n\tfloat cameraFarPlusNear = cameraFar + cameraNear;\n\tfloat cameraFarMinusNear = cameraFar - cameraNear;\n\tfloat cameraCoef = 2.0 * cameraNear;\n\n\t#ifdef USE_LOGDEPTHBUF\n\t\tfloat logz = unpackRGBAToDepth(texture2D(tDepth, coord));\n\t\tfloat w = pow(2.0, (logz / logDepthBufFC)) - 1.0;\n\t\tfloat z = (logz / w) + 1.0;\n\t#else\n\t\tfloat z = unpackRGBAToDepth(texture2D(tDepth, coord));\n\t#endif\n\n\treturn cameraCoef /(cameraFarPlusNear - z * cameraFarMinusNear);\n}\n\nfloat compareDepths(const in float depth1, const in float depth2, inout int far)\n{\n\tfloat garea = 8.0; // gauss bell width\n\tfloat diff =(depth1 - depth2) * 100.0; // depth difference (0-100)\n\n\t// reduce left bell width to avoid self-shadowing\n\tif(diff < gDisplace)\n\t{\n\t\tgarea = diffArea;\n\n\t}\n\telse\n\t{\n\t\tfar = 1;\n\t}\n\n\tfloat dd = diff - gDisplace;\n\tfloat gauss = pow(EULER, -2.0 *(dd * dd) /(garea * garea));\n\treturn gauss;\n}\n\nfloat calcAO(float depth, float dw, float dh)\n{\n\tvec2 vv = vec2(dw, dh);\n\tvec2 coord1 = vUv + radius * vv;\n\tvec2 coord2 = vUv - radius * vv;\n\n\tfloat temp1 = 0.0;\n\tfloat temp2 = 0.0;\n\n\tint far = 0;\n\ttemp1 = compareDepths(depth, readDepth(coord1), far);\n\n\t// DEPTH EXTRAPOLATION\n\tif(far > 0)\n\t{\n\t\ttemp2 = compareDepths(readDepth(coord2), depth, far);\n\t\ttemp1 +=(1.0 - temp1) * temp2;\n\t}\n\n\treturn temp1;\n}\n\nvoid main()\n{\n\tvec2 noise = rand(vUv);\n\tfloat depth = readDepth(vUv);\n\n\tfloat tt = clamp(depth, aoClamp, 1.0);\n\n\tfloat w =(1.0 / size.x) / tt +(noise.x *(1.0 - noise.x));\n\tfloat h =(1.0 / size.y) / tt +(noise.y *(1.0 - noise.y));\n\n\tfloat ao = 0.0;\n\n\tfloat dz = 1.0 / float(samples);\n\tfloat l = 0.0;\n\tfloat z = 1.0 - dz / 2.0;\n\n\tfor(int i = 0; i <= samples; i ++)\n\t{\n\t\tfloat r = sqrt(1.0 - z);\n\n\t\tfloat pw = cos(l) * r;\n\t\tfloat ph = sin(l) * r;\n\t\tao += calcAO(depth, pw * w, ph * h);\n\t\tz = z - dz;\n\t\tl = l + DL;\n\t}\n\n\tao /= float(samples);\n\tao = 1.0 - ao;\n\n\tvec3 color = texture2D(tDiffuse, vUv).rgb;\n\n\tvec3 lumcoeff = vec3(0.299, 0.587, 0.114);\n\tfloat lum = dot(color.rgb, lumcoeff);\n\tvec3 luminance = vec3(lum);\n\n\tvec3 final = vec3(color * mix(vec3(ao), vec3(1.0), luminance * lumInfluence)); // mix(color * ao, white, luminance)\n\n\tif(onlyAO)\n\t{\n\t\tfinal = vec3(mix(vec3(ao), vec3(1.0), luminance * lumInfluence)); // ambient occlusion only\n\t}\n\n\tgl_FragColor = vec4(final, 1.0);\n}"};function ys(){hs.call(this,gs),this.type="SSAO",this.depthMaterial=new n.MeshDepthMaterial,this.depthMaterial.depthPacking=n.RGBADepthPacking,this.depthMaterial.blending=n.NoBlending,this.depthRenderTarget=new n.WebGLRenderTarget(2,2,{minFilter:n.LinearFilter,magFilter:n.LinearFilter}),this.uniforms.tDepth.value=this.depthRenderTarget.texture,this.uniforms.size.value.set(2,2),Object.defineProperties(this,{radius:{get:function(){return this.uniforms.radius.value},set:function(t){this.uniforms.radius.value=t}},onlyAO:{get:function(){return this.uniforms.onlyAO.value},set:function(t){this.uniforms.onlyAO.value=t}},aoClamp:{get:function(){return this.uniforms.aoClamp.value},set:function(t){this.uniforms.aoClamp.value=t}},lumInfluence:{get:function(){return this.uniforms.lumInfluence.value},set:function(t){this.uniforms.lumInfluence.value=t}}}),this.radius=4,this.onlyAO=!1,this.aoClamp=.25,this.lumInfluence=.7}ys.prototype=Object.create(hs.prototype),ys.prototype.render=function(t,e,n,r,i,s,o){this.uniforms.cameraNear.value=o.near,this.uniforms.cameraFar.value=o.far,s.overrideMaterial=this.depthMaterial,t.setRenderTarget(this.depthRenderTarget),t.clear(!0,!0,!0),t.render(s,o),s.overrideMaterial=null,hs.prototype.render.call(this,t,e,n,r,i)},ys.prototype.setSize=function(t,e){this.uniforms.size.value.set(t,e),this.depthRenderTarget.setSize(t,e)},ys.prototype.toJSON=function(t){var e=us.prototype.toJSON.call(this,t);return e.onlyAO=this.onlyAO,e.radius=this.radius,e.aoClamp=this.aoClamp,e.lumInfluence=this.lumInfluence,e};var vs={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new n.Vector2},cameraProjectionMatrix:{value:new n.Matrix4},cameraInverseProjectionMatrix:{value:new n.Matrix4},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tDepth;","uniform sampler2D tNoise;","uniform vec3 kernel[ KERNEL_SIZE ];","uniform vec2 resolution;","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float kernelRadius;","uniform float minDistance;","uniform float maxDistance;","varying vec2 vUv;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\treturn texture2D( tDepth, screenPosition ).x;","}","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( depthSampler, coord ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec2 screenPosition ) {","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","}","void main() {","\tfloat depth = getDepth( vUv );","\tfloat viewZ = getViewZ( depth );","\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );","\tvec3 viewNormal = getViewNormal( vUv );"," vec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );","\tvec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;","\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );","\tvec3 bitangent = cross( viewNormal, tangent );","\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );"," float occlusion = 0.0;"," for ( int i = 0; i < KERNEL_SIZE; i ++ ) {","\t\tvec3 sampleVector = kernelMatrix * kernel[ i ];","\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius );","\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 );","\t\tsamplePointNDC /= samplePointNDC.w;","\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5;","\t\tfloat realDepth = getLinearDepth( samplePointUv );","\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar );","\t\tfloat delta = sampleDepth - realDepth;","\t\tif ( delta > minDistance && delta < maxDistance ) {","\t\t\tocclusion += 1.0;","\t\t}","\t}","\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );","\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );","}"].join("\n")},bs=(["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","varying vec2 vUv;","#include <packing>","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( depthSampler, coord ).x;","\t#endif","}","void main() {","\tfloat depth = getLinearDepth( vUv );","\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );","}"].join("\n"),{uniforms:{tDiffuse:{value:null},resolution:{value:new n.Vector2}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","\tvec2 texelSize = ( 1.0 / resolution );","\tfloat result = 0.0;","\tfor ( int i = - 2; i <= 2; i ++ ) {","\t\tfor ( int j = - 2; j <= 2; j ++ ) {","\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;","\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;","\t\t}","\t}","\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );","}"].join("\n")});function xs(t){void 0===t&&(t=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var e=0;e<256;e++)this.p[e]=Math.floor(256*t.random());for(this.perm=[],e=0;e<512;e++)this.perm[e]=this.p[255&e];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}function ws(){us.call(this),this.type="SSAONOH",this.kernel=[],this.noiseTexture=null,this.createQuadScene(),this.depthTexture=new n.DepthTexture,this.depthTexture.type=n.UnsignedShortType,this.depthTexture.minFilter=n.NearestFilter,this.depthTexture.maxFilter=n.NearestFilter,this.normalMaterial=new n.MeshNormalMaterial,this.normalMaterial.blending=n.NoBlending,this.normalRenderTarget=new n.WebGLRenderTarget(1,1,{minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat,depthTexture:this.depthTexture,depthBuffer:!0}),this.ssaoRenderTarget=new n.WebGLRenderTarget(1,1,us.RGBALinear),this.blurRenderTarget=new n.WebGLRenderTarget(1,1,us.RGBALinear),this.blurMaterial=new n.ShaderMaterial({defines:Object.assign({},bs.defines),uniforms:n.UniformsUtils.clone(bs.uniforms),vertexShader:bs.vertexShader,fragmentShader:bs.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.ssaoMaterial=new n.ShaderMaterial({defines:Object.assign({},vs.defines),uniforms:n.UniformsUtils.clone(vs.uniforms),vertexShader:vs.vertexShader,fragmentShader:vs.fragmentShader,blending:n.NoBlending}),this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.copyMaterial=new n.ShaderMaterial({uniforms:n.UniformsUtils.clone(ss.uniforms),vertexShader:ss.vertexShader,fragmentShader:ss.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:n.DstColorFactor,blendDst:n.ZeroFactor,blendEquation:n.AddEquation,blendSrcAlpha:n.DstAlphaFactor,blendDstAlpha:n.ZeroFactor,blendEquationAlpha:n.AddEquation}),this._kernelSize=0;var t=this;Object.defineProperties(this,{kernelRadius:{get:function(){return t.ssaoMaterial.uniforms.kernelRadius.value},set:function(e){t.ssaoMaterial.uniforms.kernelRadius.value=e}},minDistance:{get:function(){return t.ssaoMaterial.uniforms.minDistance.value},set:function(e){t.ssaoMaterial.uniforms.minDistance.value=e}},maxDistance:{get:function(){return t.ssaoMaterial.uniforms.maxDistance.value},set:function(e){t.ssaoMaterial.uniforms.maxDistance.value=e}},kernelSize:{get:function(){return t._kernelSize},set:function(e){t._kernelSize=e,t.generateSampleKernel(),t.generateRandomKernelRotations(),t.ssaoMaterial.uniforms.tNoise.value=t.noiseTexture,t.ssaoMaterial.uniforms.kernel.value=t.kernel}}}),this.kernelSize=64,this.kernelRadius=8,this.minDistance=.1,this.maxDistance=1e3}xs.prototype.dot=function(t,e,n){return t[0]*e+t[1]*n},xs.prototype.dot3=function(t,e,n,r){return t[0]*e+t[1]*n+t[2]*r},xs.prototype.dot4=function(t,e,n,r,i){return t[0]*e+t[1]*n+t[2]*r+t[3]*i},xs.prototype.noise=function(t,e){var n,r,i=(t+e)*(.5*(Math.sqrt(3)-1)),s=Math.floor(t+i),o=Math.floor(e+i),a=(3-Math.sqrt(3))/6,l=(s+o)*a,c=t-(s-l),u=e-(o-l);c>u?(n=1,r=0):(n=0,r=1);var h=c-n+a,p=u-r+a,d=c-1+2*a,f=u-1+2*a,m=255&s,_=255&o,g=this.perm[m+this.perm[_]]%12,y=this.perm[m+n+this.perm[_+r]]%12,v=this.perm[m+1+this.perm[_+1]]%12,b=.5-c*c-u*u,x=.5-h*h-p*p,w=.5-d*d-f*f;return 70*((b<0?0:(b*=b)*b*this.dot(this.grad3[g],c,u))+(x<0?0:(x*=x)*x*this.dot(this.grad3[y],h,p))+(w<0?0:(w*=w)*w*this.dot(this.grad3[v],d,f)))},xs.prototype.noise3d=function(t,e,n){var r,i,s,o,a,l,c=(t+e+n)*(1/3),u=Math.floor(t+c),h=Math.floor(e+c),p=Math.floor(n+c),d=1/6,f=(u+h+p)*d,m=t-(u-f),_=e-(h-f),g=n-(p-f);m>=_?_>=g?(r=1,i=0,s=0,o=1,a=1,l=0):m>=g?(r=1,i=0,s=0,o=1,a=0,l=1):(r=0,i=0,s=1,o=1,a=0,l=1):_<g?(r=0,i=0,s=1,o=0,a=1,l=1):m<g?(r=0,i=1,s=0,o=0,a=1,l=1):(r=0,i=1,s=0,o=1,a=1,l=0);var y=m-r+d,v=_-i+d,b=g-s+d,x=m-o+2*d,w=_-a+2*d,S=g-l+2*d,M=m-1+.5,T=_-1+.5,E=g-1+.5,A=255&u,$=255&h,C=255&p,B=this.perm[A+this.perm[$+this.perm[C]]]%12,L=this.perm[A+r+this.perm[$+i+this.perm[C+s]]]%12,R=this.perm[A+o+this.perm[$+a+this.perm[C+l]]]%12,N=this.perm[A+1+this.perm[$+1+this.perm[C+1]]]%12,P=.6-m*m-_*_-g*g,I=.6-y*y-v*v-b*b,O=.6-x*x-w*w-S*S,F=.6-M*M-T*T-E*E;return 32*((P<0?0:(P*=P)*P*this.dot3(this.grad3[B],m,_,g))+(I<0?0:(I*=I)*I*this.dot3(this.grad3[L],y,v,b))+(O<0?0:(O*=O)*O*this.dot3(this.grad3[R],x,w,S))+(F<0?0:(F*=F)*F*this.dot3(this.grad3[N],M,T,E)))},xs.prototype.noise4d=function(t,e,n,r){var i,s,o,a,l,c,u,h,p,d,f,m,_=this.grad4,g=this.simplex,y=this.perm,v=(Math.sqrt(5)-1)/4,b=(5-Math.sqrt(5))/20,x=(t+e+n+r)*v,w=Math.floor(t+x),S=Math.floor(e+x),M=Math.floor(n+x),T=Math.floor(r+x),E=(w+S+M+T)*b,A=t-(w-E),$=e-(S-E),C=n-(M-E),B=r-(T-E),L=(A>$?32:0)+(A>C?16:0)+($>C?8:0)+(A>B?4:0)+($>B?2:0)+(C>B?1:0),R=A-(i=g[L][0]>=3?1:0)+b,N=$-(s=g[L][1]>=3?1:0)+b,P=C-(o=g[L][2]>=3?1:0)+b,I=B-(a=g[L][3]>=3?1:0)+b,O=A-(l=g[L][0]>=2?1:0)+2*b,F=$-(c=g[L][1]>=2?1:0)+2*b,k=C-(u=g[L][2]>=2?1:0)+2*b,D=B-(h=g[L][3]>=2?1:0)+2*b,U=A-(p=g[L][0]>=1?1:0)+3*b,z=$-(d=g[L][1]>=1?1:0)+3*b,j=C-(f=g[L][2]>=1?1:0)+3*b,G=B-(m=g[L][3]>=1?1:0)+3*b,H=A-1+4*b,V=$-1+4*b,W=C-1+4*b,q=B-1+4*b,X=255&w,Y=255&S,J=255&M,Z=255&T,Q=y[X+y[Y+y[J+y[Z]]]]%32,K=y[X+i+y[Y+s+y[J+o+y[Z+a]]]]%32,tt=y[X+l+y[Y+c+y[J+u+y[Z+h]]]]%32,et=y[X+p+y[Y+d+y[J+f+y[Z+m]]]]%32,nt=y[X+1+y[Y+1+y[J+1+y[Z+1]]]]%32,rt=.6-A*A-$*$-C*C-B*B,it=.6-R*R-N*N-P*P-I*I,st=.6-O*O-F*F-k*k-D*D,ot=.6-U*U-z*z-j*j-G*G,at=.6-H*H-V*V-W*W-q*q;return 27*((rt<0?0:(rt*=rt)*rt*this.dot4(_[Q],A,$,C,B))+(it<0?0:(it*=it)*it*this.dot4(_[K],R,N,P,I))+(st<0?0:(st*=st)*st*this.dot4(_[tt],O,F,k,D))+(ot<0?0:(ot*=ot)*ot*this.dot4(_[et],U,z,j,G))+(at<0?0:(at*=at)*at*this.dot4(_[nt],H,V,W,q)))},ws.prototype=Object.create(us.prototype),ws.prototype.generateSampleKernel=function(){for(var t=0;t<this._kernelSize;t++){var e=new n.Vector3;e.x=2*Math.random()-1,e.y=2*Math.random()-1,e.z=Math.random(),e.normalize();var r=t/this._kernelSize;r=n.Math.lerp(.1,1,r*r),e.multiplyScalar(r),this.kernel.push(e)}},ws.prototype.generateRandomKernelRotations=function(){for(var t=new xs,e=new Float32Array(16),r=0;r<16;r++){var i=2*Math.random()-1,s=2*Math.random()-1;e[r]=t.noise3d(i,s,0)}this.noiseTexture=new n.DataTexture(e,4,4,n.LuminanceFormat,n.FloatType),this.noiseTexture.wrapS=n.RepeatWrapping,this.noiseTexture.wrapT=n.RepeatWrapping,this.noiseTexture.needsUpdate=!0},ws.prototype.render=function(t,e,r,i,s,o,a){t.autoClear=!1,t.setClearColor(7829503),t.setClearAlpha(1),o.overrideMaterial=this.normalMaterial,t.setRenderTarget(this.normalRenderTarget),t.clear(!0,!0,!0),t.render(o,a),o.overrideMaterial=null,this.ssaoMaterial.uniforms.tDepth.value=this.depthTexture,this.ssaoMaterial.uniforms.tDiffuse.value=r.texture,this.ssaoMaterial.uniforms.cameraNear.value=a.near,this.ssaoMaterial.uniforms.cameraFar.value=a.far,this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(a.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(a.projectionMatrix),this.renderPass(t,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(t,this.blurMaterial,this.blurRenderTarget),this.renderToScreen?(this.copyMaterial.uniforms.tDiffuse.value=r.texture,this.copyMaterial.blending=n.NoBlending,this.renderPass(t,this.copyMaterial,null,this.clear),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=n.CustomBlending,this.renderPass(t,this.copyMaterial,null,!1)):(this.copyMaterial.uniforms.tDiffuse.value=r.texture,this.copyMaterial.blending=n.NoBlending,this.renderPass(t,this.copyMaterial,e,this.clear),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=n.CustomBlending,this.renderPass(t,this.copyMaterial,e,!1))},ws.prototype.renderPass=function(t,e,n,r){this.quad.material=e,t.autoClear=!1,t.setRenderTarget(n),r&&t.clear(!0,!0,!0),t.render(this.scene,this.camera)},ws.prototype.dispose=function(){this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.quad.geometry.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose()},ws.prototype.setSize=function(t,e){this.ssaoMaterial.uniforms.resolution.value.set(t,e),this.blurMaterial.uniforms.resolution.value.set(t,e),this.normalRenderTarget.setSize(t,e),this.ssaoRenderTarget.setSize(t,e),this.blurRenderTarget.setSize(t,e)},ws.prototype.toJSON=function(t){var e=us.prototype.toJSON.call(this,t);return e.kernelSize=this.kernelSize,e.kernelRadius=this.kernelRadius,e.minDistance=this.minDistance,e.maxDistance=this.maxDistance,e};var Ss={uniforms:{tDiffuse:{value:null},resolution:{value:new n.Vector2}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","\tvec2 texel = vec2( 1.0 / resolution.x, 1.0 / resolution.y );","\tconst mat3 Gx = mat3( -1, -2, -1, 0, 0, 0, 1, 2, 1 );","\tconst mat3 Gy = mat3( -1, 0, 1, -2, 0, 2, -1, 0, 1 );","\tfloat tx0y0 = texture2D( tDiffuse, vUv + texel * vec2( -1, -1 ) ).r;","\tfloat tx0y1 = texture2D( tDiffuse, vUv + texel * vec2( -1,  0 ) ).r;","\tfloat tx0y2 = texture2D( tDiffuse, vUv + texel * vec2( -1,  1 ) ).r;","\tfloat tx1y0 = texture2D( tDiffuse, vUv + texel * vec2(  0, -1 ) ).r;","\tfloat tx1y1 = texture2D( tDiffuse, vUv + texel * vec2(  0,  0 ) ).r;","\tfloat tx1y2 = texture2D( tDiffuse, vUv + texel * vec2(  0,  1 ) ).r;","\tfloat tx2y0 = texture2D( tDiffuse, vUv + texel * vec2(  1, -1 ) ).r;","\tfloat tx2y1 = texture2D( tDiffuse, vUv + texel * vec2(  1,  0 ) ).r;","\tfloat tx2y2 = texture2D( tDiffuse, vUv + texel * vec2(  1,  1 ) ).r;","\tfloat valueGx = Gx[0][0] * tx0y0 + Gx[1][0] * tx1y0 + Gx[2][0] * tx2y0 + ","\t\tGx[0][1] * tx0y1 + Gx[1][1] * tx1y1 + Gx[2][1] * tx2y1 + ","\t\tGx[0][2] * tx0y2 + Gx[1][2] * tx1y2 + Gx[2][2] * tx2y2; ","\tfloat valueGy = Gy[0][0] * tx0y0 + Gy[1][0] * tx1y0 + Gy[2][0] * tx2y0 + ","\t\tGy[0][1] * tx0y1 + Gy[1][1] * tx1y1 + Gy[2][1] * tx2y1 + ","\t\tGy[0][2] * tx0y2 + Gy[1][2] * tx1y2 + Gy[2][2] * tx2y2; ","\tfloat G = sqrt( ( valueGx * valueGx ) + ( valueGy * valueGy ) );","\tgl_FragColor = vec4( vec3( G ), 1 );","}"].join("\n")};function Ms(){hs.call(this,Ss),this.type="Sobel"}Ms.prototype=Object.create(hs.prototype),Ms.prototype.setSize=function(t,e){this.uniforms.resolution.value.set(t,e)};var Ts={uniforms:{tDiffuse:{value:null},hue:{value:0},saturation:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float hue;","uniform float saturation;","varying vec2 vUv;","void main() {","\tgl_FragColor = texture2D( tDiffuse, vUv );","\tfloat angle = hue * 3.14159265;","\tfloat s = sin(angle), c = cos(angle);","\tvec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","\tfloat len = length(gl_FragColor.rgb);","\tgl_FragColor.rgb = vec3(","\t\tdot(gl_FragColor.rgb, weights.xyz),","\t\tdot(gl_FragColor.rgb, weights.zxy),","\t\tdot(gl_FragColor.rgb, weights.yzx)","\t);","\tfloat average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","\tif (saturation > 0.0) {","\t\tgl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));","\t} else {","\t\tgl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);","\t}","}"].join("\n")};function Es(t,e){hs.call(this,Ts),this.type="HueSaturation",Object.defineProperties(this,{hue:{get:function(){return this.uniforms.hue.value},set:function(t){this.uniforms.hue.value=t}},saturation:{get:function(){return this.uniforms.saturation.value},set:function(t){this.uniforms.saturation.value=t}}}),this.hue=void 0!==t?t:0,this.saturation=void 0!==e?e:0}Es.prototype=Object.create(hs.prototype),Es.prototype.toJSON=function(t){var e=us.prototype.toJSON.call(this,t);return e.hue=this.hue,e.saturation=this.saturation,e};var As={uniforms:{tDiffuse:{value:null},time:{value:0},nIntensity:{value:.5},sIntensity:{value:.05},sCount:{value:4096},grayscale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 cTextureScreen = texture2D( tDiffuse, vUv );","\tfloat dx = rand( vUv + time );","\tvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );","\tvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","\tcResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","\tcResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","\tif( grayscale ) {","\t\tcResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","\t}","\tgl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")};function $s(t,e,r,i){us.call(this),this.type="Film",this.createQuadScene(),this.uniforms=n.UniformsUtils.clone(As.uniforms),this.material=new n.ShaderMaterial({uniforms:this.uniforms,vertexShader:As.vertexShader,fragmentShader:As.fragmentShader});var s=this;Object.defineProperties(this,{grayscale:{get:function(){return s.uniforms.grayscale.value},set:function(t){s.uniforms.grayscale.value=t}},noiseIntensity:{get:function(){return s.uniforms.nIntensity.value},set:function(t){s.uniforms.nIntensity.value=t}},scanlinesIntensity:{get:function(){return s.uniforms.sIntensity.value},set:function(t){s.uniforms.sIntensity.value=t}},scanlinesCount:{get:function(){return s.uniforms.sCount.value},set:function(t){s.uniforms.sCount.value=t}}}),this.grayscale=void 0!==i&&i,this.noiseIntensity=void 0!==t?t:.35,this.scanlinesIntensity=void 0!==e?e:.5,this.scanlinesCount=void 0!==r?r:512}$s.prototype=Object.create(us.prototype),$s.prototype.render=function(t,e,n,r,i,s,o){this.uniforms.time.value+=r,this.uniforms.tDiffuse.value=n.texture,this.quad.material=this.material,this.clear?(t.autoClear=!0,t.autoClearColor=!0,t.autoClearDepth=!0,t.autoClearStencil=!0):t.autoClear=!1,t.setRenderTarget(this.renderToScreen?null:e),t.render(this.scene,this.camera)},$s.prototype.toJSON=function(t){var e=us.prototype.toJSON.call(this,t);return e.grayscale=this.grayscale,e.noiseIntensity=this.noiseIntensity,e.scanlinesIntensity=this.scanlinesIntensity,e.scanlinesCount=this.scanlinesCount,e};var Cs={uniforms:{tDiffuse:{value:null},tSize:{value:new n.Vector2(256,256)},center:{value:new n.Vector2(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","\tfloat s = sin( angle ), c = cos( angle );","\tvec2 tex = vUv * tSize - center;","\tvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","\treturn ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","\tvec4 color = texture2D( tDiffuse, vUv );","\tfloat average = ( color.r + color.g + color.b ) / 3.0;","\tgl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")};function Bs(t,e,r){us.call(this),this.type="DotScreen",this.createQuadScene(),this.uniforms=n.UniformsUtils.clone(Cs.uniforms),this.material=new n.ShaderMaterial({uniforms:this.uniforms,vertexShader:Cs.vertexShader,fragmentShader:Cs.fragmentShader}),Object.defineProperties(this,{center:{get:function(){return this.uniforms.center.value},set:function(t){this.uniforms.center.value=t}},angle:{get:function(){return this.uniforms.angle.value},set:function(t){this.uniforms.angle.value=t}},scale:{get:function(){return this.uniforms.scale.value},set:function(t){this.uniforms.scale.value=t}}}),void 0!==t&&this.center.copy(t),this.angle=void 0!==e?e:.5,this.scale=void 0!==r?r:.8}function Ls(){hs.call(this,ss),this.type="Copy"}Bs.prototype=Object.create(us.prototype),Bs.prototype.render=function(t,e,n,r,i,s,o){this.uniforms.tDiffuse.value=n.texture,this.uniforms.tSize.value.set(n.width,n.height),this.quad.material=this.material,this.clear?(t.autoClear=!0,t.autoClearColor=!0,t.autoClearDepth=!0,t.autoClearStencil=!0):t.autoClear=!1,t.setRenderTarget(this.renderToScreen?null:e),t.render(this.scene,this.camera)},Bs.prototype.toJSON=function(t){var e=us.prototype.toJSON.call(this,t);return e.center=this.center.toArray(),e.angle=this.angle,e.scale=this.scale,e},Ls.prototype=Object.create(hs.prototype);var Rs={uniforms:{tDiffuse:{value:null},color:{value:new n.Color(16777215)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tgl_FragColor = vec4( v * color, texel.w );","}"].join("\n")};function Ns(){hs.call(this,Rs),this.type="Colorify",Object.defineProperties(this,{color:{get:function(){return this.uniforms.color.value},set:function(t){this.uniforms.color.value=t}}})}Ns.prototype=Object.create(hs.prototype),Ns.prototype.toJSON=function(t){var e=us.prototype.toJSON.call(this,t);return e.color=this.color.getHex(),e};var Ps={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:.01},nearClip:{value:1},farClip:{value:1e3}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float nearClip;","uniform float farClip;","uniform float focus;","uniform float aspect;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, nearClip, farClip );","\t#else","\treturn orthographicDepthToViewZ( depth, nearClip, farClip );","\t#endif","}","void main() {","\tvec2 aspectcorrect = vec2( 1.0, aspect );","\tfloat viewZ = getViewZ( getDepth( vUv ) );","\tfloat factor = ( focus + viewZ );","\tvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","\tvec2 dofblur9 = dofblur * 0.9;","\tvec2 dofblur7 = dofblur * 0.7;","\tvec2 dofblur4 = dofblur * 0.4;","\tvec4 col = vec4( 0.0 );","\tcol += texture2D( tColor, vUv.xy );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","\tgl_FragColor = col / 41.0;","\tgl_FragColor.a = 1.0;","}"].join("\n")};function Is(t,e,r){us.call(this),this.type="Bokeh",this.renderTargetColor=new n.WebGLRenderTarget(0,0,us.RGBLinear),this.renderTargetDepth=this.renderTargetColor.clone(),this.materialDepth=new n.MeshDepthMaterial,this.materialDepth.depthPacking=n.RGBADepthPacking,this.materialDepth.blending=n.NoBlending,this.uniforms=n.UniformsUtils.clone(Ps.uniforms),this.uniforms.tDepth.value=this.renderTargetDepth.texture,this.materialBokeh=new n.ShaderMaterial({defines:Ps.defines,uniforms:this.uniforms,vertexShader:Ps.vertexShader,fragmentShader:Ps.fragmentShader}),this.createQuadScene(),this.quad.material=this.materialBokeh;var i=this;Object.defineProperties(this,{aperture:{get:function(){return i.uniforms.aperture.value},set:function(t){i.uniforms.aperture.value=t}},focus:{get:function(){return i.uniforms.focus.value},set:function(t){i.uniforms.focus.value=t}},maxblur:{get:function(){return i.uniforms.maxblur.value},set:function(t){i.uniforms.maxblur.value=t}}}),this.focus=void 0!==t?t:1,this.aperture=void 0!==e?e:1,this.maxblur=void 0!==r?r:.2}Is.prototype=Object.create(us.prototype),Is.prototype.render=function(t,e,n,r,i,s,o){s.overrideMaterial=this.materialDepth,t.autoClear=!1,t.setClearColor(16777215),t.setClearAlpha(1),t.setRenderTarget(this.renderTargetDepth),t.clear(!0,!0,!0),t.render(s,o),this.uniforms.tColor.value=n.texture,this.uniforms.nearClip.value=o.near,this.uniforms.farClip.value=o.far,this.uniforms.aspect.value=o.aspect,this.clear?(t.autoClear=!0,t.autoClearColor=!0,t.autoClearDepth=!0,t.autoClearStencil=!0):t.autoClear=!1,t.setRenderTarget(this.renderToScreen?null:e),t.render(this.scene,this.camera),s.overrideMaterial=null},Is.prototype.setSize=function(t,e){this.renderTargetColor.setSize(t,e),this.renderTargetDepth.setSize(t,e)},Is.prototype.toJSON=function(t){var e=us.prototype.toJSON.call(this,t);return e.aperture=this.aperture,e.focus=this.focus,e.maxblur=this.maxblur,e};var Os={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new n.Vector2(.001953125,0)},cKernel:{value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","\tvUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","\tvec2 imageCoord = vUv;","\tvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","\tfor( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","\t\tsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","\t\timageCoord += uImageIncrement;","\t}","\tgl_FragColor = sum;","}"].join("\n"),buildKernel:function(t){function e(t,e){return Math.exp(-t*t/(2*e*e))}var n,r,i,s,o=2*Math.ceil(3*t)+1;for(o>25&&(o=25),s=.5*(o-1),r=new Array(o),i=0,n=0;n<o;++n)r[n]=e(n-s,t),i+=r[n];for(n=0;n<o;++n)r[n]/=i;return r}};function Fs(t,e,r,i){us.call(this),this.type="Bloom",this.copyToScreen=!0,this.createQuadScene(),t=void 0!==t?t:1,e=void 0!==e?e:25,r=void 0!==r?r:4,i=void 0!==i?i:256,this.renderTargetX=new n.WebGLRenderTarget(i,i,us.RGBALinear),this.renderTargetY=new n.WebGLRenderTarget(i,i,us.RGBALinear),this.copyUniforms=n.UniformsUtils.clone(ss.uniforms),this.copyUniforms.opacity.value=t,this.materialCopy=new n.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:ss.vertexShader,fragmentShader:ss.fragmentShader,blending:n.AdditiveBlending,transparent:!0}),this.convolutionUniforms=n.UniformsUtils.clone(Os.uniforms),this.convolutionUniforms.uImageIncrement.value=Fs.blurX,this.convolutionUniforms.cKernel.value=Os.buildKernel(r),this.materialConvolution=new n.ShaderMaterial({uniforms:this.convolutionUniforms,vertexShader:Os.vertexShader,fragmentShader:Os.fragmentShader,defines:{KERNEL_SIZE_FLOAT:e.toFixed(1),KERNEL_SIZE_INT:e.toFixed(0)}})}Fs.blurX=new n.Vector2(.001953125,0),Fs.blurY=new n.Vector2(0,.001953125),Fs.prototype=Object.create(us.prototype),Fs.prototype.render=function(t,e,n,r,i,s,o){i&&t.context.disable(t.context.STENCIL_TEST),this.quad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=n.texture,this.convolutionUniforms.uImageIncrement.value=Fs.blurX,t.setRenderTarget(this.renderTargetX),t.clear(!0,!0,!0),t.render(this.scene,this.camera),this.convolutionUniforms.tDiffuse.value=this.renderTargetX.texture,this.convolutionUniforms.uImageIncrement.value=Fs.blurY,t.setRenderTarget(this.renderTargetY),t.clear(!0,!0,!0),t.render(this.scene,this.camera),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetY.texture,i&&t.context.enable(t.context.STENCIL_TEST),t.setRenderTarget(e),t.render(this.scene,this.camera)},Fs.prototype.toJSON=function(t){var e=us.prototype.toJSON.call(this,t);return e.strength=this.strength,e.kernelSize=this.kernelSize,e.sigma=this.sigma,e.resolution=this.resolution,e};var ks={uniforms:{tDiffuse:{value:null},resolution:{value:new n.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")};function Ds(){hs.call(this,ks),this.type="FXAA"}Ds.prototype=Object.create(hs.prototype),Ds.prototype.setSize=function(t,e){this.uniforms.resolution.value.set(1/t,1/e)};var Us={uniforms:{damp:{value:.96},tOld:{value:null},tNew:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float damp;","uniform sampler2D tOld;","uniform sampler2D tNew;","varying vec2 vUv;","vec4 when_gt( vec4 x, float y ) {","\treturn max( sign( x - y ), 0.0 );","}","void main() {","\tvec4 texelOld = texture2D( tOld, vUv );","\tvec4 texelNew = texture2D( tNew, vUv );","\ttexelOld *= damp * when_gt( texelOld, 0.1 );","\tgl_FragColor = max(texelNew, texelOld);","}"].join("\n")};function zs(t){us.call(this),this.type="Afterimage",this.uniforms=n.UniformsUtils.clone(Us.uniforms),this.textureComp=new n.WebGLRenderTarget(1,1,{minFilter:n.LinearFilter,magFilter:n.NearestFilter,format:n.RGBAFormat}),this.textureOld=new n.WebGLRenderTarget(1,1,{minFilter:n.LinearFilter,magFilter:n.NearestFilter,format:n.RGBAFormat}),this.shaderMaterial=new n.ShaderMaterial({uniforms:this.uniforms,vertexShader:Us.vertexShader,fragmentShader:Us.fragmentShader}),this.basicMaterial=new n.MeshBasicMaterial,this.createQuadScene(),Object.defineProperties(this,{damp:{get:function(){return this.uniforms.damp.value},set:function(t){this.uniforms.damp.value=t}}}),this.damp=void 0!==t?t:.96}zs.prototype=Object.create(us.prototype),zs.prototype.render=function(t,e,n,r,i,s,o){var a=this.textureOld;this.textureOld=this.textureComp,this.textureComp=a,this.uniforms.tNew.value=n.texture,this.uniforms.tOld.value=this.textureOld.texture,this.quad.material=this.shaderMaterial,t.autoClear=!1,t.setRenderTarget(this.textureComp),t.render(this.scene,this.camera),this.basicMaterial.map=this.textureComp.texture,this.clear?(t.autoClear=!0,t.autoClearColor=!0,t.autoClearDepth=!0,t.autoClearStencil=!0):t.autoClear=!1,this.quad.material=this.basicMaterial,t.setRenderTarget(this.renderToScreen?null:e),t.render(this.scene,this.camera)},zs.prototype.setSize=function(t,e){this.textureComp.setSize(t,e),this.textureOld.setSize(t,e)},zs.prototype.toJSON=function(t){var e=us.prototype.toJSON.call(this,t);return e.damp=this.damp,e};var js={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tfloat l = linearToRelativeLuminance( texel.rgb );","\tgl_FragColor = vec4( l, l, l, texel.w );","}"].join("\n")},Gs={uniforms:{tDiffuse:{value:null},averageLuminance:{value:1},luminanceMap:{value:null},maxLuminance:{value:16},minLuminance:{value:.01},middleGrey:{value:.6}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float middleGrey;","uniform float minLuminance;","uniform float maxLuminance;","#ifdef ADAPTED_LUMINANCE","\tuniform sampler2D luminanceMap;","#else","\tuniform float averageLuminance;","#endif","vec3 ToneMap( vec3 vColor ) {","\t#ifdef ADAPTED_LUMINANCE","\t\tfloat fLumAvg = texture2D(luminanceMap, vec2(0.5, 0.5)).r;","\t#else","\t\tfloat fLumAvg = averageLuminance;","\t#endif","\tfloat fLumPixel = linearToRelativeLuminance( vColor );","\tfloat fLumScaled = (fLumPixel * middleGrey) / max( minLuminance, fLumAvg );","\tfloat fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (maxLuminance * maxLuminance)))) / (1.0 + fLumScaled);","\treturn fLumCompressed * vColor;","}","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = vec4( ToneMap( texel.xyz ), texel.w );","}"].join("\n")};function Hs(t,e){us.call(this);var r=this;this.type="AdaptiveToneMapping",this.needsInit=!0,this.resolution=void 0!==e?e:256,this._adaptive=void 0===t||t,this.luminanceRT=null,this.previousLuminanceRT=null,this.currentLuminanceRT=null,this.copyUniforms=n.UniformsUtils.clone(ss.uniforms),this.materialCopy=new n.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:ss.vertexShader,fragmentShader:ss.fragmentShader,blending:n.NoBlending,depthTest:!1}),this.materialLuminance=new n.ShaderMaterial({uniforms:n.UniformsUtils.clone(js.uniforms),vertexShader:js.vertexShader,fragmentShader:js.fragmentShader,blending:n.NoBlending}),this.createShader(),void 0===Gs&&console.error("nunuStudio: AdaptiveToneMappingPass relies on ToneMapShader"),this.materialToneMap=new n.ShaderMaterial({uniforms:n.UniformsUtils.clone(Gs.uniforms),vertexShader:Gs.vertexShader,fragmentShader:Gs.fragmentShader,blending:n.NoBlending}),this.createQuadScene(),Object.defineProperties(this,{minLuminance:{get:function(){return r.adaptLuminanceShader.uniforms.minLuminance.value},set:function(t){r.adaptLuminanceShader.uniforms.minLuminance.value=t}},tau:{get:function(){return r.adaptLuminanceShader.uniforms.tau.value},set:function(t){r.adaptLuminanceShader.uniforms.tau.value=t}},adaptive:{get:function(){return r._adaptive},set:function(t){t?(this._adaptive=!0,this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture):(this._adaptive=!1,delete this.materialToneMap.defines.ADAPTED_LUMINANCE,this.materialToneMap.uniforms.luminanceMap.value=null),this.materialToneMap.needsUpdate=!0}}})}function Vs(){this.uuid=n.Math.generateUUID(),this.width=1,this.height=1,this.passes=[],this.writeBuffer=new n.WebGLRenderTarget(this.width,this.height,Vs.bufferParameters),this.readBuffer=new n.WebGLRenderTarget(this.width,this.height,Vs.bufferParameters),this.copyPass=new hs(ss),this.rendererState=new cs}function Ws(t){this.keys=[],this.actions=[];var e=this,n=this.actions;this.events=new ji,this.events.add(window,"keydown",(function(t){n.push(t.keyCode),n.push(Ui.DOWN)})),this.events.add(window,"keyup",(function(t){n.push(t.keyCode),n.push(Ui.UP)})),this.events.add(window,"focus",(function(t){e.reset()})),!0!==t&&this.create()}function qs(){n.Group.call(this),this.name="controls",this.type="FirstPersonControls",this.sensitivity=.005,this.needsButtonPressed=!0,this.movementEnabled=!0,this.moveSpeed=.05,this.moveOnPlane=!1,this.moveKeys=[Ws.W,Ws.S,Ws.A,Ws.D],this.vector=new n.Vector2(0,0),this.mouse=null,this.keyboard=null,this.tempVector=new n.Vector3}function Xs(){n.Group.call(this),this.name="group",this.type="Group"}function Ys(t){n.Object3D.call(this),this.element=t,this.element.style.position="absolute",this.addEventListener("removed",(function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)}));var e=this,r=!0;Object.defineProperties(this,{visible:{get:function(){return r},set:function(t){r=t,e.element.style.display=t?"block":"none"}}})}function Js(t){var e=document.createElement("iframe");e.style.border="none",Ys.call(this,e),this.type="HTMLView",this.name="webview";var n,r,i=this;Object.defineProperties(this,{url:{get:function(){return t},set:function(e){t=void 0!==e?Js.processURL(e):"",i.element.src=t}},width:{get:function(){return n},set:function(t){n=t,i.element.style.width=n+"px"}},height:{get:function(){return r},set:function(t){r=t,i.element.style.height=r+"px"}}}),this.width=512,this.height=512,this.url=void 0!==t?t:""}function Zs(t,e,r){n.HemisphereLight.call(this,t,e,r),this.name="hemisphere"}function Qs(t,e,r){n.InstancedMesh.call(this,t,e,r),this.name="instanced",this.type="InstancedMesh",this.receiveShadow=!0,this.castShadow=!0,Object.defineProperties(this,{count:{get:function(){return r},set:function(t){t>r&&(this.instanceMatrix=new n.BufferAttribute(new Float32Array(16*t),16)),r=t}}})}Hs.prototype=Object.create(us.prototype),Hs.prototype.constructor=Hs,Hs.prototype.render=function(t,e,n,r,i){this.needsInit&&(this.reset(),this.luminanceRT.texture.type=n.texture.type,this.previousLuminanceRT.texture.type=n.texture.type,this.currentLuminanceRT.texture.type=n.texture.type,this.needsInit=!1),this._adaptive&&(this.quad.material=this.materialLuminance,this.materialLuminance.uniforms.tDiffuse.value=n.texture,t.setRenderTarget(this.currentLuminanceRT),t.render(this.scene,this.camera),this.quad.material=this.materialAdaptiveLum,this.materialAdaptiveLum.uniforms.delta.value=r,this.materialAdaptiveLum.uniforms.lastLum.value=this.previousLuminanceRT.texture,this.materialAdaptiveLum.uniforms.currentLum.value=this.currentLuminanceRT.texture,t.setRenderTarget(this.luminanceRT),t.render(this.scene,this.camera),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.luminanceRT.texture,t.setRenderTarget(this.previousLuminanceRT),t.render(this.scene,this.camera)),this.quad.material=this.materialToneMap,this.materialToneMap.uniforms.tDiffuse.value=n.texture,this.clear?(t.autoClear=!0,t.autoClearColor=!0,t.autoClearDepth=!0,t.autoClearStencil=!0):t.autoClear=!1,t.setRenderTarget(this.renderToScreen?null:e),t.render(this.scene,this.camera)},Hs.prototype.createShader=function(){this.adaptLuminanceShader={defines:{MIP_LEVEL_1X1:(Math.log(this.resolution)/Math.log(2)).toFixed(1)},uniforms:{lastLum:{value:null},currentLum:{value:null},minLuminance:{value:.01},delta:{value:.016},tau:{value:1}},vertexShader:"varying vec2 vUv;\n\t\tvoid main(){\n\t\t\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\n\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\n\t\tuniform sampler2D lastLum;\n\t\tuniform sampler2D currentLum;\n\t\tuniform float minLuminance;\n\t\tuniform float delta;\n\t\tuniform float tau;\n\t\t\n\t\tvoid main()\n\t\t{\n\t\t\tvec4 lastLum = texture2D(lastLum, vUv, MIP_LEVEL_1X1);\n\t\t\tvec4 currentLum = texture2D(currentLum, vUv, MIP_LEVEL_1X1);\n\t\t\t\n\t\t\tfloat fLastLum = max(minLuminance, lastLum.r);\n\t\t\tfloat fCurrentLum = max(minLuminance, currentLum.r);\n\t\t\t\n\t\t\t// The adaption seems to work better in extreme lighting differences if the input luminance is squared.\t\t\tfCurrentLum *= fCurrentLum;\n\t\t\t\n\t\t\t// Adapt the luminance using Pattanaik's technique\t\t\tfloat fAdaptedLum = fLastLum + (fCurrentLum - fLastLum) * (1.0 - exp(-delta * tau));\n\t\t\tgl_FragColor.r = fAdaptedLum;\n\t\t}"},this.materialAdaptiveLum=new n.ShaderMaterial({uniforms:n.UniformsUtils.clone(this.adaptLuminanceShader.uniforms),vertexShader:this.adaptLuminanceShader.vertexShader,fragmentShader:this.adaptLuminanceShader.fragmentShader,defines:this.adaptLuminanceShader.defines,blending:n.NoBlending})},Hs.prototype.reset=function(){this.luminanceRT&&this.luminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose(),this.luminanceRT=new n.WebGLRenderTarget(this.resolution,this.resolution,us.RGBALinear),this.luminanceRT.texture.generateMipmaps=!1,this.previousLuminanceRT=new n.WebGLRenderTarget(this.resolution,this.resolution,us.RGBALinear),this.previousLuminanceRT.texture.generateMipmaps=!1,this.currentLuminanceRT=new n.WebGLRenderTarget(this.resolution,this.resolution,{minFilter:n.LinearMipMapLinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat}),this._adaptive&&(this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture),this.quad.material=new n.MeshBasicMaterial({color:7829367}),this.materialLuminance.needsUpdate=!0,this.materialAdaptiveLum.needsUpdate=!0,this.materialToneMap.needsUpdate=!0},Hs.prototype.dispose=function(){this.luminanceRT&&this.luminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.materialLuminance&&this.materialLuminance.dispose(),this.materialAdaptiveLum&&this.materialAdaptiveLum.dispose(),this.materialCopy&&this.materialCopy.dispose(),this.materialToneMap&&this.materialToneMap.dispose()},Hs.prototype.toJSON=function(t){var e=us.prototype.toJSON.call(this,t);return e.minLuminance=this.minLuminance,e.tau=this.tau,e.adaptive=this._adaptive,e},Vs.bufferParameters={minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat,stencilBuffer:!1},Vs.prototype.swapBuffers=function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},Vs.prototype.addPass=function(t){this.passes.push(t)},Vs.prototype.moveBack=function(t){var e=this.passes.indexOf(t);if(e>0){for(var n=e;n!==e-1;n-=1)this.passes[n]=this.passes[n-1];return this.passes[e-1]=t,!0}return!1},Vs.prototype.moveForward=function(t){var e=this.passes.indexOf(t);if(-1!==e&&e<this.passes.length-1){for(var n=e;n!==e+1;n+=1)this.passes[n]=this.passes[n+1];return this.passes[e+1]=t,!0}return!1},Vs.prototype.removePass=function(t){var e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)},Vs.prototype.insertPass=function(t,e){this.passes.splice(e,0,t)},Vs.prototype.render=function(t,e,n,r){var i=!1;this.rendererState.backup(t);for(var s=0;s<this.passes.length;s++){var o=this.passes[s];if(o.enabled){if(o.render(t,this.writeBuffer,this.readBuffer,r,i,e,n),o.renderToScreen){o.copyToScreen&&(this.copyPass.renderToScreen=!0,this.copyPass.render(t,this.readBuffer,this.writeBuffer,r));break}o.needsSwap&&(i&&(t.context.stencilFunc(t.context.NOTEQUAL,1,4294967295),this.copyPass.renderToScreen=!1,this.copyPass.render(t,this.writeBuffer,this.readBuffer,r),t.context.stencilFunc(t.context.EQUAL,1,4294967295)),this.swapBuffers()),void 0!==as&&(o instanceof as?i=!0:o instanceof ls&&(i=!1))}}this.rendererState.restore(t)},Vs.prototype.setSize=function(t,e){t=Math.floor(t),e=Math.floor(e),this.width=t,this.height=e,this.writeBuffer.setSize(t,e),this.readBuffer.setSize(t,e);for(var n=0;n<this.passes.length;n++)this.passes[n].setSize(t,e)},Vs.prototype.reset=function(){this.dispose(),this.writeBuffer=new n.WebGLRenderTarget(this.width,this.height,Vs.bufferParameters),this.readBuffer=new n.WebGLRenderTarget(this.width,this.height,Vs.bufferParameters)},Vs.prototype.dispose=function(){this.writeBuffer.dispose(),this.readBuffer.dispose(),this.writeBuffer=null,this.readBuffer=null},Vs.prototype.toJSON=function(){var t={};t.uuid=this.uuid,t.passes=[];for(var e=0;e<this.passes.length;e++)t.passes.push(this.passes[e].toJSON());return t},Vs.fromJSON=function(t){var e=new Vs;e.uuid=t.uuid;for(var n=0;n<t.passes.length;n++){var r=t.passes[n],i=null;if("Render"===r.type)i=new ps;else if("UnrealBloom"===r.type)for((i=new fs).strength=r.strength,i.radius=r.radius,i.threshold=r.threshold,i.bloomFactors=r.bloomFactors,n=0;n<i.bloomTintColors.length;n++)i.bloomTintColors[n].fromArray(r.bloomTintColors[n]);else"Bloom"===r.type?i=new Fs(r.strength,r.kernelSize,r.sigma,r.resolution):"SSAONOH"===r.type?((i=new ws).kernelRadius=r.kernelRadius,i.minDistance=r.minDistance,i.maxDistance=r.maxDistance,i.kernelSize=r.kernelSize):"SSAO"===r.type?((i=new ys).onlyAO=r.onlyAO,i.radius=r.radius,i.aoClamp=r.aoClamp,i.lumInfluence=r.lumInfluence):"Bokeh"===r.type?i=new Is(r.focus,r.aperture,r.maxblur):"FXAA"===r.type?i=new Ds:"Copy"===r.type?i=new Ls:"Film"===r.type?((i=new $s).grayscale=r.grayscale,i.noiseIntensity=r.noiseIntensity,i.scanlinesIntensity=r.scanlinesIntensity,i.scanlinesCount=r.scanlinesCount):"DotScreen"===r.type?((i=new Bs).center.fromArray(r.center),i.angle=r.angle,i.scale=r.scale):"Colorify"===r.type?(i=new Ns).color.setHex(r.color):"Sobel"===r.type?i=new Ms:"Technicolor"===r.type?i=new _s:"HueSaturation"===r.type?((i=new Es).hue=r.hue,i.saturation=r.saturation):"AdaptiveToneMapping"===r.type?((i=new Hs(r.adaptive)).tau=r.tau,i.minLuminance=r.minLuminance):"Afterimage"===r.type?(i=new zs).damp=r.damp:i=new ps;i.uuid=r.uuid,i.enabled=r.enabled,i.needsSwap=r.needsSwap,i.renderToScreen=r.renderToScreen,i.clear=r.clear,i.copyToScreen=!0===r.copyToScreen,e.addPass(i)}return e},Ws.prototype=Ws,Ws.prototype.constructor=Ws,Ws.update=function(){for(var t=0;this.actions.length>t;){var e=this.actions.shift(),n=this.actions.shift();void 0===this.keys[e]&&(this.keys[e]=new Ui),this.keys[e].update(n),(this.keys[e].justReleased||this.keys[e].justPressed)&&(this.actions.push(e),this.actions.push(Ui.RESET),t+=2)}},Ws.reset=function(){for(var t=0;t<this.keys.length;t++)void 0!==this.keys[t]&&this.keys[t].reset()},Ws.keyPressed=function(t){return void 0!==this.keys[t]&&this.keys[t].pressed},Ws.keyJustPressed=function(t){return void 0!==this.keys[t]&&this.keys[t].justPressed},Ws.keyJustReleased=function(t){return void 0!==this.keys[t]&&this.keys[t].justReleased},Ws.create=function(){this.events.create()},Ws.dispose=function(){this.events.destroy()},Ws.TAB=9,Ws.ENTER=13,Ws.SHIFT=16,Ws.CTRL=17,Ws.ALT=18,Ws.CAPS_LOCK=20,Ws.ESC=27,Ws.SPACEBAR=32,Ws.PAGE_UP=33,Ws.PAGE_DOWN=34,Ws.END=35,Ws.HOME=36,Ws.INSERT=45,Ws.DEL=46,Ws.LEFT=37,Ws.RIGHT=39,Ws.UP=38,Ws.DOWN=40,Ws.NUM0=48,Ws.NUM1=49,Ws.NUM2=50,Ws.NUM3=51,Ws.NUM4=52,Ws.NUM5=53,Ws.NUM6=54,Ws.NUM7=55,Ws.NUM8=56,Ws.NUM9=57,Ws.A=65,Ws.B=66,Ws.C=67,Ws.D=68,Ws.E=69,Ws.F=70,Ws.G=71,Ws.H=72,Ws.I=73,Ws.J=74,Ws.K=75,Ws.L=76,Ws.M=77,Ws.N=78,Ws.O=79,Ws.P=80,Ws.Q=81,Ws.R=82,Ws.S=83,Ws.T=84,Ws.U=85,Ws.V=86,Ws.W=87,Ws.X=88,Ws.Y=89,Ws.Z=90,Ws.F1=112,Ws.F2=113,Ws.F3=114,Ws.F4=115,Ws.F5=116,Ws.F6=117,Ws.F7=118,Ws.F8=119,Ws.F9=120,Ws.F10=121,Ws.F11=122,Ws.F12=123,qs.UP=new n.Vector3(0,1,0),qs.prototype=Object.create(n.Group.prototype),qs.prototype.initialize=function(){for(var t=this;null!==t.parent;)(t=t.parent)instanceof Cc&&(this.mouse=t.mouse,this.keyboard=t.keyboard);this.updateControls(),n.Group.prototype.initialize.call(this)},qs.prototype.update=function(t){if(this.needsButtonPressed&&!this.mouse.buttonPressed(zi.LEFT)||(this.vector.y-=this.sensitivity*this.mouse.delta.y,this.vector.x-=this.sensitivity*this.mouse.delta.x,this.vector.y<-1.57?this.vector.y=-1.57:this.vector.y>1.57&&(this.vector.y=1.57),this.updateControls()),this.movementEnabled){if(this.keyboard.keyPressed(this.moveKeys[0])){var e=this.getWorldDirection(this.tempVector);this.moveOnPlane&&(e.y=0),e.normalize(),e.multiplyScalar(this.moveSpeed),this.position.sub(e)}this.keyboard.keyPressed(this.moveKeys[1])&&(e=this.getWorldDirection(this.tempVector),this.moveOnPlane&&(e.y=0),e.normalize(),e.multiplyScalar(this.moveSpeed),this.position.add(e)),this.keyboard.keyPressed(this.moveKeys[2])&&((e=new n.Vector3(Math.sin(this.vector.x-1.57),0,Math.cos(this.vector.x-1.57))).normalize(),e.multiplyScalar(this.moveSpeed),this.position.sub(e)),this.keyboard.keyPressed(this.moveKeys[3])&&((e=new n.Vector3(Math.sin(this.vector.x+1.57),0,Math.cos(this.vector.x+1.57))).normalize(),e.multiplyScalar(this.moveSpeed),this.position.sub(e))}n.Object3D.prototype.update.call(this,t)},qs.prototype.updateControls=function(){var t=Math.cos(this.vector.y),e=new n.Vector3(Math.sin(this.vector.x)*t,Math.sin(this.vector.y),Math.cos(this.vector.x)*t);e.add(this.position);var r=new n.Matrix4;r.lookAt(this.position,e,qs.UP),this.quaternion.setFromRotationMatrix(r)},qs.prototype.getDirection=function(){var t=this.getWorldDirection(this.tempVector);return t.normalize(),t},qs.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return e.object.moveSpeed=this.moveSpeed,e.object.sensitivity=this.sensitivity,e.object.needsButtonPressed=this.needsButtonPressed,e.object.movementEnabled=this.movementEnabled,e.object.moveOnPlane=this.moveOnPlane,e.object.moveKeys=this.moveKeys,e},Xs.prototype=Object.create(n.Group.prototype),Xs.prototype.constructor=Xs,Ys.prototype=Object.create(n.Object3D.prototype),Ys.prototype.constructor=Ys,Ys.prototype.isCSS3DObject=!0,Js.prototype=Object.create(Ys.prototype),Js.prototype.constructor=Js,Js.processURL=function(t){return t.replace("watch?v=","embed/")},Js.prototype.toJSON=function(t){var e=Ys.prototype.toJSON.call(this,t);return e.object.height=this.height,e.object.width=this.width,e.object.url=this.url,e},Zs.prototype=Object.create(n.HemisphereLight.prototype),Qs.prototype=Object.create(n.InstancedMesh.prototype),Qs.prototype.dispose=function(){null!==this.material&&void 0!==this.material.dispose&&this.material.dispose(),null!==this.geometry&&void 0!==this.geometry.dispose&&this.geometry.dispose(),n.Object3D.prototype.dispose.call(this)},Qs.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return e.object.instanceMatrix=this.instanceMatrix.toJSON(),e.object.count=this.count,e};var Ks=function(){n.Mesh.call(this,Ks.Geometry,new n.MeshBasicMaterial({opacity:0,transparent:!0})),this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;var t=new n.Vector3,e=new n.Vector3,r=new n.DataTexture(new Uint8Array(768),16,16,n.RGBFormat);r.minFilter=n.NearestFilter,r.magFilter=n.NearestFilter,r.wrapS=n.ClampToEdgeWrapping,r.wrapT=n.ClampToEdgeWrapping;var i=new n.DataTexture(new Uint8Array(768),16,16,n.RGBFormat);i.minFilter=n.NearestFilter,i.magFilter=n.NearestFilter,i.wrapS=n.ClampToEdgeWrapping,i.wrapT=n.ClampToEdgeWrapping;var s=Ks.Geometry,o=new n.RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","void main() {","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","void main() {","\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );","}"].join("\n"),depthTest:!0,depthWrite:!1,transparent:!1}),a=new n.RawShaderMaterial({uniforms:{map:{value:r},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","\tvUV = uv;","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","varying vec2 vUV;","void main() {","\tgl_FragColor = texture2D( map, vUV );","}"].join("\n"),depthTest:!1,depthWrite:!1,transparent:!1}),l=new n.Mesh(s,o),c=[],u=to.Shader,h=new n.RawShaderMaterial({uniforms:{map:{value:null},occlusionMap:{value:i},color:{value:new n.Color(16777215)},scale:{value:new n.Vector2},screenPosition:{value:new n.Vector3}},vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:n.AdditiveBlending,transparent:!0,depthWrite:!1}),p=new n.Mesh(s,h);this.addElement=function(t){c.push(t)};var d=new n.Vector2,f=new n.Vector2,m=new n.Box2,_=new n.Vector4;this.onBeforeRender=function(n,u,g){n.getCurrentViewport(_);var y=_.w/_.z,v=_.z/2,b=_.w/2,x=16/_.w;if(d.set(x*y,x),m.min.set(_.x,_.y),m.max.set(_.x+(_.z-16),_.y+(_.w-16)),e.setFromMatrixPosition(this.matrixWorld),e.applyMatrix4(g.matrixWorldInverse),!(e.z>0)&&(t.copy(e).applyMatrix4(g.projectionMatrix),f.x=_.x+t.x*v+v-8,f.y=_.y+t.y*b+b-8,m.containsPoint(f))){n.copyFramebufferToTexture(f,r),(E=o.uniforms).scale.value=d,E.screenPosition.value=t,n.renderBufferDirect(g,null,s,o,l,null),n.copyFramebufferToTexture(f,i),(E=a.uniforms).scale.value=d,E.screenPosition.value=t,n.renderBufferDirect(g,null,s,a,l,null);for(var w=2*-t.x,S=2*-t.y,M=0,T=c.length;M<T;M++){var E,A=c[M];(E=h.uniforms).color.value.copy(A.color),E.map.value=A.texture,E.screenPosition.value.x=t.x+w*A.distance,E.screenPosition.value.y=t.y+S*A.distance,x=A.size/_.w,y=_.w/_.z,E.scale.value.set(x*y,x),h.uniformsNeedUpdate=!0,n.renderBufferDirect(g,null,s,h,p,null)}}},this.dispose=function(){o.dispose(),a.dispose(),h.dispose(),r.dispose(),i.dispose();for(var t=0,e=c.length;t<e;t++)c[t].texture.dispose()}};Ks.prototype=Object.create(n.Mesh.prototype),Ks.prototype.constructor=Ks,Ks.prototype.isLensflare=!0;var to=function(t,e,r,i){this.texture=t,this.size=e||1,this.distance=r||0,this.color=i||new n.Color(16777215)};function eo(){n.Mesh.call(this,Ks.Geometry,new n.MeshBasicMaterial({opacity:0,transparent:!0})),this.name="lensflare",this.type="LensFlare",this.renderOrder=1/0,this.frustumCulled=!1,this.receiveShadow=!1,this.castShadow=!1,this.elements=[];var t=new n.Vector3,e=new n.DataTexture(new Uint8Array(768),16,16,n.RGBFormat);e.minFilter=n.NearestFilter,e.magFilter=n.NearestFilter,e.wrapS=n.ClampToEdgeWrapping,e.wrapT=n.ClampToEdgeWrapping,e.needsUpdate=!0;var r=new n.DataTexture(new Uint8Array(768),16,16,n.RGBFormat);r.minFilter=n.NearestFilter,r.magFilter=n.NearestFilter,r.wrapS=n.ClampToEdgeWrapping,r.wrapT=n.ClampToEdgeWrapping,r.needsUpdate=!0;var i=Ks.Geometry,s=Ks.Shader,o=new n.RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:"precision highp float;\n\t\t\tuniform vec3 screenPosition;\n\t\t\tuniform vec2 scale;\n\t\t\tattribute vec3 position;\n\t\t\tvoid main()\n\t\t\t{\n\t\t\t\tgl_Position = vec4(position.xy * scale + screenPosition.xy, screenPosition.z, 1.0);\n\t\t\t}",fragmentShader:"precision highp float;\n\t\t\tvoid main()\n\t\t\t{\n\t\t\t\tgl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n\t\t\t}",depthTest:!0,depthWrite:!1,transparent:!1}),a=new n.RawShaderMaterial({uniforms:{map:{value:e},scale:{value:null},screenPosition:{value:null}},vertexShader:"precision highp float;\n\t\t\tuniform vec3 screenPosition;\n\t\t\tuniform vec2 scale;\n\t\t\tattribute vec3 position;\n\t\t\tattribute vec2 uv;\n\t\t\tvarying vec2 vUV;\n\t\t\tvoid main()\n\t\t\t{\n\t\t\t\tvUV = uv;\n\t\t\t\tgl_Position = vec4(position.xy * scale + screenPosition.xy, screenPosition.z, 1.0);\n\t\t\t}",fragmentShader:"precision highp float;\n\t\t\tuniform sampler2D map;\n\t\t\tvarying vec2 vUV;\n\t\t\tvoid main()\n\t\t\t{\n\t\t\t\tgl_FragColor = texture2D(map, vUV);\n\t\t\t}",depthTest:!1,depthWrite:!1,transparent:!1}),l=new n.Mesh(i,o),c=(s=to.Shader,new n.RawShaderMaterial({uniforms:{map:{value:null},occlusionMap:{value:r},color:{value:new n.Color(16777215)},scale:{value:new n.Vector2},screenPosition:{value:new n.Vector3}},vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:n.AdditiveBlending,transparent:!0,depthWrite:!1})),u=new n.Mesh(i,c),h=new n.Vector2,p=new n.Vector2,d=new n.Box2,f=new n.Vector4;this.onBeforeRender=function(n,s,m){n.getCurrentViewport(f);var _=f.w/f.z,g=f.z/2,y=f.w/2,v=16/f.w;if(h.set(v*_,v),d.min.set(f.x,f.y),d.max.set(f.x+(f.z-16),f.y+(f.w-16)),t.setFromMatrixPosition(this.matrixWorld),t.applyMatrix4(m.matrixWorldInverse),t.applyMatrix4(m.projectionMatrix),p.x=f.x+t.x*g+g-8,p.y=f.y+t.y*y+y-8,d.containsPoint(p)){n.copyFramebufferToTexture(p,e),(M=o.uniforms).scale.value=h,M.screenPosition.value=t,n.renderBufferDirect(m,null,i,o,l,null),n.copyFramebufferToTexture(p,r),(M=a.uniforms).scale.value=h,M.screenPosition.value=t,n.renderBufferDirect(m,null,i,a,l,null);for(var b=2*-t.x,x=2*-t.y,w=0,S=this.elements.length;w<S;w++){var M,T=this.elements[w];(M=c.uniforms).color.value.copy(T.color),M.map.value=T.texture,M.screenPosition.value.x=t.x+b*T.distance,M.screenPosition.value.y=t.y+x*T.distance,v=T.size/f.w,_=f.w/f.z,M.scale.value.set(v*_,v),c.uniformsNeedUpdate=!0,n.renderBufferDirect(m,null,i,c,u,null)}}},this.dispose=function(){o.dispose(),a.dispose(),c.dispose(),e.dispose(),r.dispose();for(var t=0;t<this.elements.length;t++)this.elements[t].texture.dispose()}}to.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform sampler2D occlusionMap;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\tvVisibility =        visibility.r / 9.0;","\tvVisibility *= 1.0 - visibility.g / 9.0;","\tvVisibility *=       visibility.b / 9.0;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvec4 texture = texture2D( map, vUV );","\ttexture.a *= vVisibility;","\tgl_FragColor = texture;","\tgl_FragColor.rgb *= color;","}"].join("\n")},Ks.Geometry=function(){var t=new n.BufferGeometry,e=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),r=new n.InterleavedBuffer(e,5);return t.setIndex([0,1,2,0,2,3]),t.setAttribute("position",new n.InterleavedBufferAttribute(r,3,0,!1)),t.setAttribute("uv",new n.InterleavedBufferAttribute(r,2,3,!1)),t}(),eo.prototype=Object.create(n.Mesh.prototype),eo.prototype.addFlare=function(t,e,r,i){void 0===e&&(e=-1),void 0===r&&(r=0),void 0===i&&(i=new n.Color(16777215)),r=Math.min(r,Math.max(0,r)),this.addElement(new to(t,e,r,i))},eo.prototype.addElement=function(t){this.elements.push(t)},eo.prototype.toJSON=function(t){var e=this,r=[],i=n.Object3D.prototype.toJSON.call(this,t,(function(t,n){for(var i=0;i<e.elements.length;i++){var s={};s.texture=e.elements[i].texture.toJSON(t).uuid,s.size=e.elements[i].size,s.distance=e.elements[i].distance,s.color=e.elements[i].color.getHex(),r.push(s)}}));return i.object.elements=r,i};var no,ro=function(t,e){switch(e){case n.sRGBEncoding:t.convertSRGBToLinear();break;case n.LinearEncoding:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported encoding.")}return t},io=__webpack_require__(412);function so(t,e){n.LightProbe.call(this,t,e),this.type="LightProbe",this.name="probe"}function oo(t,e){n.Mesh.call(this,t,e),this.name="model",this.receiveShadow=!0,this.castShadow=!0}function ao(){n.Group.call(this),this.name="orbit",this.type="OrbitControls",this.distance=4,this.maxDistance=20,this.minDistance=2,this.sensitivity=.002,this.zoomSensitivity=.001,this.limitUp=1.57,this.limitDown=-1.57,this.needsButtonPressed=!0,this.zoomEnabled=!0,this.movementEnabled=!0,this.center=new n.Vector3(0,0,0),this.vector=new n.Vector2(Math.PI/2,0),this.smooth=!0,this.friction=.8,this.speed=.3,this.invertNavigation=!1,this.mouse=null,this.keyboard=null,this.speedDistance=0,this.speedCenter=new n.Vector3(0,0,0),this.speedOrientation=new n.Vector2(0,0),this.tempVector=new n.Vector3}function lo(t){this.offset=new n.Vector2(0,0),this.size=new n.Vector2(1,1),this.mode=void 0!==t?t:lo.RELATIVE,this.anchor=lo.TOP_LEFT,this.width=1,this.height=1,this.viewport=new n.Vector4(0,0,1,1)}function co(t,e,r,i,s){n.OrthographicCamera.call(this,-1,1,1,-1,i,s),this.name="camera",this.size=void 0!==t?t:10,this.aspect=void 0!==e?e:1,this.mode=void 0!==r?r:co.RESIZE_HORIZONTAL,this.viewport=new lo,this.clearColor=!0,this.clearDepth=!0,this.clearStencil=!0,this.order=0,this.updateProjectionMatrix(),this.composer=new Vs;var o=new ps;o.renderToScreen=!0,this.composer.addPass(o)}function uo(t,e,r,i){this.viewport=new lo,n.PerspectiveCamera.call(this,t,e,r,i),this.name="camera",this.clearColor=!0,this.clearDepth=!0,this.clearStencil=!0,this.order=0,this.composer=new Vs;var s=new ps;s.renderToScreen=!0,this.composer.addPass(s)}function ho(){n.Group.call(this),this.name="physics",this.type="Physics",this.body=new L,this.body.type=L.DYNAMIC,this.body.mass=1,this.mode=ho.LOCAL,this.world=null}function po(t,e,r,i){n.PointLight.call(this,t,e,r,i),this.name="point",this.castShadow=!0,this.shadow.camera.near=.1,this.shadow.camera.far=1e3,this.shadow.bias=0}so.prototype=Object.create(n.LightProbe.prototype),so.prototype.generate=function(){var t=this.getScene();if(null!==t){var e=new OffscreenCanvas(256,256),r=new n.WebGLRenderer({canvas:e,alpha:!0}),i=new TCubeCamera(1,1e3,256,{format:n.RGBAFormat,magFilter:n.LinearFilter,minFilter:n.LinearFilter});i.matrixAutoUpdate=!1,i.matrix.copy(this.matrix),i.matrixWorld.copy(this.matrixWorld),i.renderTarget.texture.encoding=io.sRGBEncoding,i.update(r,t);var s=function(t,e){for(var r,i,s,o=0,a=new n.Vector3,l=new n.Vector3,c=new n.Color,u=[0,0,0,0,0,0,0,0,0],h=new n.SphericalHarmonics3,p=h.coefficients,d=0;d<6;d++){var f=e.width,m=new Uint8Array(f*f*4);t.readRenderTargetPixels(e,0,0,f,f,m,d);for(var _=2/f,g=0,y=m.length;g<y;g+=4){c.setRGB(m[g]/255,m[g+1]/255,m[g+2]/255),ro(c,e.texture.encoding);var v=g/4,b=(v%f+.5)*_-1,x=1-(Math.floor(v/f)+.5)*_;switch(d){case 0:a.set(1,x,-b);break;case 1:a.set(-1,x,b);break;case 2:a.set(b,1,-x);break;case 3:a.set(b,-1,x);break;case 4:a.set(b,x,1);break;case 5:a.set(-b,x,-1)}i=a.lengthSq(),o+=s=4/(Math.sqrt(i)*i),l.copy(a).normalize(),n.SphericalHarmonics3.getBasisAt(l,u);for(var w=0;w<9;w++)p[w].x+=u[w]*c.r*s,p[w].y+=u[w]*c.g*s,p[w].z+=u[w]*c.b*s}}for(r=4*Math.PI/o,w=0;w<9;w++)p[w].x*=r,p[w].y*=r,p[w].z*=r;return new n.LightProbe(h)}(r,i.renderTarget);this.sh=s.sh}else console.warn("nunuStudio: LightProbe cannot generate, no scene.",this)},so.prototype.toJSON=function(t){var e=n.Light.prototype.toJSON.call(this,t);return e.object.sh=this.sh.toArray(),e},oo.prototype=Object.create(n.Mesh.prototype),oo.prototype.dispose=function(){null!==this.material&&void 0!==this.material.dispose&&this.material.dispose(),null!==this.geometry&&void 0!==this.geometry.dispose&&this.geometry.dispose(),n.Object3D.prototype.dispose.call(this)},ao.UP=new n.Vector3(0,1,0),ao.ZERO=new n.Vector3(0,0,0),ao.prototype=Object.create(n.Group.prototype),ao.prototype.initialize=function(){for(var t=this;null!==t.parent;)(t=t.parent)instanceof Cc&&(this.mouse=t.mouse,this.keyboard=t.keyboard);this.center.copy(this.position),this.updateControls(),n.Group.prototype.initialize.call(this)},ao.prototype.update=function(t){var e=!1;if(this.needsButtonPressed&&!this.mouse.buttonPressed(zi.LEFT)||(!0===this.smooth?(this.speedOrientation.y+=this.speed*this.sensitivity*(this.invertNavigation?this.mouse.delta.y:-this.mouse.delta.y),this.speedOrientation.x-=this.speed*this.sensitivity*this.mouse.delta.x):(this.vector.y-=this.sensitivity*(this.invertNavigation?this.mouse.delta.y:-this.mouse.delta.y),this.vector.x-=this.sensitivity*this.mouse.delta.x),e=!0),this.zoomEnabled&&(this.mouse.buttonPressed(zi.MIDDLE)&&(!0===this.smooth?this.speedCenter.y+=this.speed*this.sensitivity*this.mouse.delta.y*this.distance:this.center.y+=this.sensitivity*this.mouse.delta.y*this.distance,e=!0),0!==this.mouse.wheel&&(!0===this.smooth?this.speedDistance+=this.speed*this.mouse.wheel*this.position.distanceTo(this.center)*this.sensitivity:this.distance+=this.mouse.wheel*this.position.distanceTo(this.center)*this.sensitivity,e=!0)),this.movementEnabled&&this.mouse.buttonPressed(zi.RIGHT)){var r=this.getWorldDirection(this.tempVector);if(r.y=0,r.normalize(),!0===this.smooth){var i=this.speed*this.mouse.delta.y*this.sensitivity*this.distance;this.speedCenter.x+=-r.x*i,this.speedCenter.z+=-r.z*i,r.applyAxisAngle(ao.UP,Math.PI/2);var s=this.speed*this.mouse.delta.x*this.sensitivity*this.distance;this.speedCenter.x-=r.x*s,this.speedCenter.z-=r.z*s}else i=this.mouse.delta.y*this.sensitivity*this.distance,this.center.x+=-r.x*i,this.center.z+=-r.z*i,r.applyAxisAngle(ao.UP,Math.PI/2),s=this.mouse.delta.x*this.sensitivity*this.distance,this.center.x-=r.x*s,this.center.z-=r.z*s;e=!0}if(!0===this.smooth)return this.distance+=this.speedDistance,this.center.add(this.speedCenter),this.vector.add(this.speedOrientation),this.speedDistance*=this.friction,this.speedOrientation.multiplyScalar(this.friction),this.speedCenter.multiplyScalar(this.friction),void this.updateControls();!0===e&&this.updateControls(),n.Object3D.prototype.update.call(this,t)},ao.prototype.updateControls=function(){this.vector.y<this.limitDown?this.vector.y=this.limitDown:this.vector.y>this.limitUp&&(this.vector.y=this.limitUp),this.distance<this.minDistance?this.distance=this.minDistance:this.distance>this.maxDistance&&(this.distance=this.maxDistance);var t=this.distance*Math.cos(this.vector.y);this.position.set(Math.cos(this.vector.x)*t,this.distance*Math.sin(this.vector.y),Math.sin(this.vector.x)*t),this.position.add(this.center);var e=new n.Matrix4;e.lookAt(this.position,this.center,ao.UP),this.quaternion.setFromRotationMatrix(e)},ao.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return e.object.distance=this.distance,e.object.maxDistance=this.maxDistance,e.object.minDistance=this.minDistance,e.object.sensitivity=this.sensitivity,e.object.limitUp=this.limitUp,e.object.limitDown=this.limitDown,e.object.needsButtonPressed=this.needsButtonPressed,e.object.zoomEnabled=this.zoomEnabled,e.object.movementEnabled=this.movementEnabled,e.object.smooth=this.smooth,e.object.friction=this.friction,e.object.speed=this.speed,e.object.invertNavigation=this.invertNavigation,e.object.center=this.center.toArray(),e.object.vector=this.vector.toArray(),e},lo.RELATIVE=200,lo.ABSOLUTE=201,lo.TOP_LEFT=301,lo.TOP_RIGHT=302,lo.BOTTOM_LEFT=303,lo.BOTTOM_RIGHT=304,lo.prototype.update=function(t){var e,r,i,s,o,a;void 0===t?(i=0,s=0,e=this.width,r=this.height):(i=t.viewport.x,s=t.viewport.y,e=t.viewport.z,r=t.viewport.w),this.mode===lo.RELATIVE?(o=new n.Vector2(this.offset.x*e,this.offset.y*r),a=new n.Vector2(this.size.x*e,this.size.y*r)):this.mode===lo.ABSOLUTE&&(o=this.offset,a=this.size),this.anchor===lo.BOTTOM_LEFT?this.viewport.set(o.x+i,o.y+s,a.x,a.y):this.anchor===lo.BOTTOM_RIGHT?this.viewport.set(e-a.x-o.x+i,o.y+s,a.x,a.y):this.anchor===lo.TOP_LEFT?this.viewport.set(o.x+i,r-a.y-o.y+s,a.x,a.y):this.anchor===lo.TOP_RIGHT&&this.viewport.set(e-a.x-o.x+i,r-a.y-o.y+s,a.x,a.y)},lo.prototype.getAspectRatio=function(){return this.viewport.z/this.viewport.w},lo.prototype.isInside=function(t,e){return e.position.x>this.viewport.x&&e.position.x<this.viewport.x+this.viewport.z&&e.position.y<this.height-this.viewport.y&&e.position.y>this.height-this.viewport.y-this.viewport.w},lo.prototype.getNormalized=(no=new n.Vector2,function(t,e){var n=e.position.x-this.viewport.z-this.viewport.x,r=e.position.y-(this.height-(this.viewport.y+this.viewport.w));return no.set(n/this.viewport.z*2+1,-r/this.viewport.w*2+1),no}),lo.prototype.enable=function(t){t.setViewport(this.viewport),t.setScissor(this.viewport)},lo.prototype.toJSON=function(){return{offset:this.offset.toArray(),size:this.size.toArray(),mode:this.mode,anchor:this.anchor}},lo.prototype.fromJSON=function(t){this.offset.fromArray(t.offset),this.size.fromArray(t.size),this.mode=t.mode,this.anchor=t.anchor},co.prototype=Object.create(n.OrthographicCamera.prototype),co.RESIZE_HORIZONTAL=0,co.RESIZE_VERTICAL=1,co.prototype.resize=function(t,e,n){this.viewport.width=t,this.viewport.height=e,this.viewport.update(n),this.aspect=this.viewport.getAspectRatio(),this.updateProjectionMatrix(),this.composer.setSize(this.viewport.viewport.z,this.viewport.viewport.w)},co.prototype.setupRenderer=function(t){this.viewport.enable(t),t.clear(this.clearColor,this.clearDepth,this.clearStencil)},co.prototype.render=function(t,e){this.composer.render(t,e,this,.016)},co.prototype.destroy=function(){var t=this.getScene();null!==t&&t.removeCamera(this),n.Object3D.prototype.destroy.call(this)},co.prototype.updateProjectionMatrix=function(){this.mode===co.RESIZE_HORIZONTAL?(this.top=this.size/2,this.bottom=-this.top,this.right=this.top*this.aspect,this.left=-this.right):this.mode===co.RESIZE_VERTICAL&&(this.right=this.size/2,this.left=-this.right,this.top=this.right/this.aspect,this.bottom=-this.top),n.OrthographicCamera.prototype.updateProjectionMatrix.call(this)},co.prototype.toJSON=function(t){var e=n.OrthographicCamera.prototype.toJSON.call(this,t);return e.object.size=this.size,e.object.aspect=this.aspect,e.object.mode=this.mode,e.object.clearColor=this.clearColor,e.object.clearDepth=this.clearDepth,e.object.clearStencil=this.clearStencil,e.object.viewport=this.viewport.toJSON(),e.object.order=this.order,e.object.composer=this.composer.toJSON(),e},uo.prototype=Object.create(n.PerspectiveCamera.prototype),uo.prototype.resize=function(t,e,n){this.viewport.width=t,this.viewport.height=e,this.viewport.update(n),this.aspect=this.viewport.getAspectRatio(),this.updateProjectionMatrix(),this.composer.setSize(this.viewport.viewport.z,this.viewport.viewport.w)},uo.prototype.setupRenderer=function(t){this.viewport.enable(t),t.clear(this.clearColor,this.clearDepth,this.clearStencil)},uo.prototype.render=function(t,e){this.composer.render(t,e,this,.016)},uo.prototype.destroy=function(){var t=this.getScene();null!==t&&t.removeCamera(this),n.Object3D.prototype.destroy.call(this)},uo.prototype.updateProjectionMatrix=function(){var t=this.near*Math.tan(.5*n.Math.DEG2RAD*this.fov)/this.zoom,e=2*t,r=this.aspect*e,i=-.5*r;0!==this.filmOffset&&(i+=this.near*this.filmOffset/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-e,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},uo.prototype.toJSON=function(t){var e=n.PerspectiveCamera.prototype.toJSON.call(this,t);return e.object.clearColor=this.clearColor,e.object.clearDepth=this.clearDepth,e.object.clearStencil=this.clearStencil,e.object.viewport=this.viewport.toJSON(),e.object.order=this.order,e.object.composer=this.composer.toJSON(),e},ho.prototype=Object.create(n.Group.prototype),ho.LOCAL=100,ho.WORLD=101,ho.prototype.initialize=function(){if(this.mode===ho.LOCAL)this.body.position.copy(this.position),this.body.quaternion.copy(this.quaternion);else if(this.mode===ho.WORLD){var t=new n.Vector3;this.getWorldPosition(t),this.body.position.copy(t);var e=new n.Quaternion;this.getWorldQuaternion(e),this.body.quaternion.copy(e)}for(var r=this;null!==r.parent;)(r=r.parent)instanceof Bc&&(this.world=r.world,this.world.addBody(this.body));n.Object3D.prototype.initialize.call(this)},ho.prototype.update=function(t){if(this.mode===ho.LOCAL)this.position.copy(this.body.position),this.body.fixedRotation||this.quaternion.copy(this.body.quaternion);else if(this.mode===ho.WORLD){var e=new n.Matrix4;if(this.body.fixedRotation)e.setPosition(this.body.position.x,this.body.position.y,this.body.position.z);else{var r=new n.Quaternion;r.copy(this.body.quaternion),e.makeRotationFromQuaternion(r),e.setPosition(this.body.position.x,this.body.position.y,this.body.position.z)}var i=new n.Matrix4;i.getInverse(this.parent.matrixWorld);var s=new n.Vector3;i.multiply(e),i.decompose(this.position,this.quaternion,s)}n.Object3D.prototype.update.call(this,t)},ho.prototype.addShape=function(t){t instanceof b&&this.body.addShape(t)},ho.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);e.object.mode=this.mode,e.object.body={},e.object.body.type=this.body.type,e.object.body.mass=this.body.mass,e.object.body.linearDamping=this.body.linearDamping,e.object.body.angularDamping=this.body.angularDamping,e.object.body.allowSleep=this.body.allowSleep,e.object.body.sleepSpeedLimit=this.body.sleepSpeedLimit,e.object.body.sleepTimeLimit=this.body.sleepTimeLimit,e.object.body.collisionFilterGroup=this.body.collisionFilterGroup,e.object.body.collisionFilterMask=this.body.collisionFilterMask,e.object.body.fixedRotation=this.body.fixedRotation,e.object.body.shapes=[];for(var r=this.body.shapes,i=0;i<r.length;i++){var s=r[i],o={};o.type=s.type,s.type===b.types.SPHERE?o.radius=s.radius:s.type===b.types.BOX?(o.halfExtents={},o.halfExtents.x=s.halfExtents.x,o.halfExtents.y=s.halfExtents.y,o.halfExtents.z=s.halfExtents.z):s.type===b.types.CONVEXPOLYHEDRON?(o.vertices=s.vertices,o.faces=s.faces):s.type===b.types.HEIGHTFIELD?(o.data=s.data,o.maxValue=s.maxValue,o.minValue=s.minValue,o.elementSize=s.elementSize):s.type===b.types.TRIMESH&&(o.vertices=s.vertices,o.normals=s.normals,o.edges=s.edges,o.indices=s.indices),e.object.body.shapes[i]=o}return e},ho.fromJSON=function(t){var e=new ho;void 0!==t.mode&&(e.mode=t.mode),e.body.type=t.body.type,e.body.mass=t.body.mass,e.body.linearDamping=t.body.linearDamping,e.body.angularDamping=t.body.angularDamping,e.body.allowSleep=t.body.allowSleep,e.body.sleepSpeedLimit=t.body.sleepSpeedLimit,e.body.sleepTimeLimit=t.body.sleepTimeLimit,e.body.collisionFilterGroup=t.body.collisionFilterGroup,e.body.collisionFilterMask=t.body.collisionFilterMask,e.body.fixedRotation=t.body.fixedRotation;for(var n=t.body.shapes,r=0;r<n.length;r++){var i=n[r];if(i.type===b.types.SPHERE)e.body.addShape(new en(i.radius));else if(i.type===b.types.BOX)e.body.addShape(new E(new a(i.halfExtents.x,i.halfExtents.y,i.halfExtents.z)));else if(i.type===b.types.PARTICLE)e.body.addShape(new mn);else if(i.type===b.types.PLANE)e.body.addShape(new _n);else if(i.type===b.types.HEIGHTFIELD)e.body.addShape(new yn(i.data,{maxValue:i.maxValue,minValue:i.minValue,elementSize:i.elementSize}));else if(i.type===b.types.CONVEXPOLYHEDRON){for(var s=0;s<i.vertices.length;s++)i.vertices[s]=new a(i.vertices[s].x,i.vertices[s].y,i.vertices[s].z);e.body.addShape(new S(i.vertices,i.faces))}}return e},po.prototype=Object.create(n.PointLight.prototype),po.prototype.updateShadowMap=function(){this.shadow.map.dispose(),this.shadow.map=null,this.shadow.camera.updateProjectionMatrix()};var fo=__webpack_require__(759),mo=function(t){n.Loader.call(this,t),this.reversed=!1};function _o(t){Xi.call(this,"font","Font"),this.reversed=!1,this.font=null,void 0!==t&&(t instanceof ArrayBuffer?(this.data=t,this.format="arraybuffer",this.loadTTF()):"object"==typeof t?(this.data=t,this.font=t,this.format="json",this.encoding="json"):(this.encoding=qi.getFileExtension(t),this.name=qi.getFileName(t),"json"===this.encoding?(this.data=JSON.parse(qi.readFile(t)),this.format="json",this.font=this.data):"ttf"!==this.encoding&&"otf"!==this.encoding&&"ttc"!==this.encoding&&"otc"!==this.encoding||(this.data=qi.readFileArrayBuffer(t),this.format="arraybuffer",this.loadTTF())))}function go(){Xi.call(this,"model","Model")}function yo(t,e){Xi.call(this,"audio","Audio"),void 0!==t&&(t instanceof ArrayBuffer?(this.data=t,this.encoding=void 0!==e?e:"",this.format="arraybuffer"):Hi.isBase64(t)?(this.encoding=void 0!==e?e:"",this.data=Vi.fromBase64(t),this.format="arraybuffer"):(this.data=qi.readFileArrayBuffer(t),this.encoding=qi.getFileExtension(t),this.format="arraybuffer"))}function vo(t){Qi.call(this,t),this.type="PositionalAudio",this.matrixAutoUpdate=!0,this.distanceModel="inverse",this.panningModel="HRTF",this.panner=this.context.createPanner(),this.panner.connect(this.gain),this.panner.panningModel=this.panningModel,this.panner.distanceModel=this.distanceModel,this.panner.refDistance=1,this.panner.maxDistance=1e4,this.panner.rolloffFactor=1,this.panner.coneInnerAngle=360,this.panner.coneOuterAngle=0,this.panner.coneOuterGain=0,this.scene=null,this.tempPosition=new n.Vector3,this.tempPositionCamera=new n.Vector3,this.tempQuaternionCamera=new n.Quaternion}function bo(t,e,r,i){n.RectAreaLight.call(this,t,e,r,i),this.name="rectarea"}function xo(t,e){n.Group.call(this),this.type="Script",this.name="script",this.code=void 0!==t?t:xo.DEFAULT,this.mode=void 0!==e?e:xo.APPEND,this.script={},this.program=null,this.scene=null}function wo(t,e){n.SkinnedMesh.call(this,t,e),this.name="skinned",this.receiveShadow=!0,this.castShadow=!0,this.skeleton=null}mo.prototype=Object.assign(Object.create(n.Loader.prototype),{constructor:mo,load:function(t,e,r,i){var s=this,o=new n.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.load(t,(function(n){try{e(s.parse(n))}catch(e){i?i(e):console.error(e),s.manager.itemError(t)}}),r,i)},parse:function(t){function e(t){var e,n=[];t.forEach((function(t){"m"===t.type.toLowerCase()?(e=[t],n.push(e)):"z"!==t.type.toLowerCase()&&e.push(t)}));var r=[];return n.forEach((function(t){var e={type:"m",x:t[t.length-1].x,y:t[t.length-1].y};r.push(e);for(var n=t.length-1;n>0;n--){var i=t[n];e={type:i.type},void 0!==i.x2&&void 0!==i.y2?(e.x1=i.x2,e.y1=i.y2,e.x2=i.x1,e.y2=i.y1):void 0!==i.x1&&void 0!==i.y1&&(e.x1=i.x1,e.y1=i.y1),e.x=t[n-1].x,e.y=t[n-1].y,r.push(e)}})),r}return void 0===fo.U?(console.warn("THREE.TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(t,n){for(var r=Math.round,i={},s=1e5/(72*(t.unitsPerEm||2048)),o=t.encoding.cmap.glyphIndexMap,a=Object.keys(o),l=0;l<a.length;l++){var c=a[l],u=t.glyphs.glyphs[o[c]];if(void 0!==c){var h={ha:r(u.advanceWidth*s),x_min:r(u.xMin*s),x_max:r(u.xMax*s),o:""};n&&(u.path.commands=e(u.path.commands)),u.path.commands.forEach((function(t){"c"===t.type.toLowerCase()&&(t.type="b"),h.o+=t.type.toLowerCase()+" ",void 0!==t.x&&void 0!==t.y&&(h.o+=r(t.x*s)+" "+r(t.y*s)+" "),void 0!==t.x1&&void 0!==t.y1&&(h.o+=r(t.x1*s)+" "+r(t.y1*s)+" "),void 0!==t.x2&&void 0!==t.y2&&(h.o+=r(t.x2*s)+" "+r(t.y2*s)+" ")})),i[String.fromCodePoint(u.unicode)]=h}}return{glyphs:i,familyName:t.getEnglishName("fullName"),ascender:r(t.ascender*s),descender:r(t.descender*s),underlinePosition:t.tables.post.underlinePosition,underlineThickness:t.tables.post.underlineThickness,boundingBox:{xMin:t.tables.head.xMin,xMax:t.tables.head.xMax,yMin:t.tables.head.yMin,yMax:t.tables.head.yMax},resolution:1e3,original_font_information:t.tables.name}}(fo.U.parse(t),this.reversed)}}),_o.prototype=Object.create(Xi.prototype),_o.fileIsFont=function(t){return void 0!==t&&((t=t.name.toLocaleLowerCase()).endsWith("ttf")||t.endsWith("otf")||t.endsWith("ttc")||t.endsWith("otc")||t.endsWith("json"))},_o.prototype.isFont=!0,_o.prototype.reverseGlyphs=function(){this.reversed=!this.reversed,this.loadTTF()},_o.prototype.loadTTF=function(){var t=new mo;t.reversed=this.reversed,this.font=t.parse(this.data)},_o.prototype.toJSON=function(t){if(void 0!==t.fonts[this.uuid])return t.fonts[this.uuid];var e=Xi.prototype.toJSON.call(this,t);return e.encoding=this.encoding,e.reversed=this.reversed,"arraybuffer"===this.format?(e.data=this.data,e.format=this.format):"base64"===this.format?(e.data=Vi.fromBase64(this.data),e.format="arraybuffer"):(e.data=this.data,e.format=this.format),t.fonts[this.uuid]=e,e},_o.prototype.generateShapes=function(t,e,r){void 0===e&&(e=100),void 0===r&&(r=10);for(var i=this.font,s=function(t){for(var n=String(t).split(""),r=e/i.resolution,s=(i.boundingBox.yMax-i.boundingBox.yMin)*r,o=0,a=0,c=[],u=0;u<n.length;u++){var h=n[u];if("\n"===h)a-=s,o=0;else{var p=l(h,r,o,a);o+=p.width,c.push(p.path)}}return c}(t),o=[],a=0;a<s.length;a++)Array.prototype.push.apply(o,s[a].toShapes());return o;function l(t,e,s,o){var a=i.glyphs[t]||i.glyphs["?"];if(a){var l,c,u,h,p,d,f,m,_,g,y,v=new n.ShapePath,b=[],x=n.ShapeUtils.b2,w=n.ShapeUtils.b3;if(a.o)for(var S=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),M=0,T=S.length;M<T;){var E=S[M++];if("m"===E&&(l=S[M++]*e+s,c=S[M++]*e+o,v.moveTo(l,c)),"l"===E)l=S[M++]*e+s,c=S[M++]*e+o,v.lineTo(l,c);else if("q"===E){if(u=S[M++]*e+s,h=S[M++]*e+o,f=S[M++]*e+s,m=S[M++]*e+o,v.quadraticCurveTo(f,m,u,h),y=b[b.length-1]){p=y.x,d=y.y;for(var A=1;A<=r;A++)x($=A/r,p,f,u),x($,d,m,h)}}else if("b"===E&&(u=S[M++]*e+s,h=S[M++]*e+o,f=S[M++]*e+s,m=S[M++]*e+o,_=S[M++]*e+s,g=S[M++]*e+o,v.bezierCurveTo(f,m,_,g,u,h),y=b[b.length-1]))for(p=y.x,d=y.y,A=1;A<=r;A++){var $;w($=A/r,p,f,_,u),w($,d,m,g,h)}}return{width:a.ha*e,path:v}}}},go.prototype=Object.create(Xi.prototype),go.extensions=["gcode","drc","assimp","assimp.json","blend","amf","babylon","prwm","svg","obj","3ds","dae","gltf","glb","3mf","awd","ply","vtk","vtp","wrl","vrml","fbx","pcd","stl","json","x"],go.fileIsModel=function(t){if(void 0!==t){t=t.name.toLocaleLowerCase();for(var e=0;e<go.extensions.length;e++)if(t.endsWith(go.extensions[e]))return!0}return!1},yo.prototype=Object.create(Xi.prototype),yo.fileIsAudio=function(t){return!(void 0===t||!t.type.startsWith("audio"))},yo.prototype.getAudioBuffer=function(t,e){t.decodeAudioData(this.data.slice(0),e,(function(t){console.error("nunuStudio: Cannot decode audio buffer ("+t+")")}))},yo.prototype.toJSON=function(t){if(void 0!==t.audio[this.uuid])return t.audio[this.uuid];var e=Xi.prototype.toJSON.call(this,t);return e.encoding=this.encoding,e.data=this.data,e.format=this.format,t.audio[this.uuid]=e,e},vo.prototype=Object.create(Qi.prototype),vo.prototype.initialize=function(){Qi.prototype.initialize.call(this);for(var t=this.parent;null!==t;){if(t instanceof Bc){this.scene=t;break}t=t.parent}},vo.prototype.update=function(t){if(this.scene.cameras.length>0){var e=this.scene.cameras[0];this.getWorldPosition(this.tempPosition),e.getWorldPosition(this.tempPositionCamera),e.getWorldQuaternion(this.tempQuaternionCamera),this.tempPosition.sub(this.tempPositionCamera),this.tempPosition.z=-this.tempPosition.z,this.tempPosition.applyQuaternion(this.tempQuaternionCamera),this.panner.setPosition(this.tempPosition.x,this.tempPosition.z,this.tempPosition.y)}else this.panner.setPosition(0,0,0),this.panner.setOrientation(0,0,0);n.Object3D.prototype.update.call(this,t)},vo.prototype.getOutput=function(){return this.panner},vo.prototype.getRefDistance=function(){return this.panner.refDistance},vo.prototype.setRefDistance=function(t){this.panner.refDistance=t},vo.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor},vo.prototype.setRolloffFactor=function(t){this.panner.rolloffFactor=t},vo.prototype.getDistanceModel=function(){return this.panner.distanceModel},vo.prototype.setDistanceModel=function(t){this.panner.distanceModel=t},vo.prototype.getMaxDistance=function(){return this.panner.maxDistance},vo.prototype.setMaxDistance=function(t){this.panner.maxDistance=t},vo.prototype.toJSON=function(t){var e=Qi.prototype.toJSON.call(this,t);return e.object.distanceModel=this.distanceModel,e.object.panningModel=this.panningModel,e},bo.prototype=Object.create(n.RectAreaLight.prototype),bo.prototype.toJSON=function(t){var e=n.Light.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e},xo.prototype=Object.create(n.Group.prototype),xo.includeRegex=/include[ ]*\([ \n]*["'].+?["'][ \n]*\);*/gi,xo.includeRegexStart=/include[ ]*\([ \n]*["']/gi,xo.includeRegexEnd=/["'][ \n]*\);*/gi,xo.DEFAULT="function initialize() {\n\t// TODO ADD CODE\n}\n\nfunction update(delta) {\n\t// TODO ADD CODE\n}",xo.METHODS=["initialize","update","dispose","onMouseOver","onResize","onAppData"],xo.APPEND=100,xo.EVALUATE=101,xo.INCLUDE=102,xo.getIncludes=function(t){for(var e=[],n=new RegExp(xo.includeRegex,"gi");;){var r=n.exec(t);if(null===r)break;var i=r[0];i=(i=i.replace(xo.includeRegexStart,"")).replace(xo.includeRegexEnd,""),e.push(i)}return e},xo.removeComments=function(t){return t.replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")},xo.removeIncludes=function(t){return t.replace(xo.includeRegex,"")},xo.prototype.initialize=function(){for(var t=this;null!==t.parent;)(t=t.parent)instanceof Bc?this.scene=t:t instanceof Cc&&(this.program=t);n.Object3D.prototype.initialize.call(this);var e=this;this.compileCode(this.code,(function(){void 0!==e.script.initialize&&e.script.initialize.call(e)}))},xo.prototype.update=function(t){if(void 0!==this.script.onMouseOver){var e=this.scene.raycaster.intersectObjects(this.children,!0);e.length>0&&this.script.onMouseOver.call(this,e)}void 0!==this.script.update&&this.script.update.call(this,t),n.Object3D.prototype.update.call(this,t)},xo.prototype.dispose=function(){void 0!==this.script.dispose&&this.script.dispose.call(this),n.Object3D.prototype.dispose.call(this)},xo.prototype.resize=function(t,e){void 0!==this.script.onResize&&this.script.onResize.call(this,t,e)},xo.prototype.appData=function(t){void 0!==this.script.onAppData&&this.script.onAppData.call(this,t)},xo.prototype.compileCode=function(t,e){try{t=this.code;for(var n=0;n<xo.METHODS.length;n++){var r=xo.METHODS[n];t+="\nif(this."+r+" == undefined && typeof "+r+" !== 'undefined'){this."+r+" = "+r+";}"}if(this.mode===xo.APPEND){t=xo.removeComments(t);var i=xo.getIncludes(t);for(t=xo.removeIncludes(t),n=0;n<i.length;n++){var s=this.program.getResourceByName(i[n]);if(null===s){if(null===(s=qi.readFile(i[n],!0)))throw new Error("Script include() library "+i[n]+" not found.");t=s+"\n"+t}else t=s.data+"\n"+t}t+='\nfunction include(name)\t\t\t{\t\t\t\tconsole.warn("nunuStudio: Script running in append mode, " + name + " cannot be included in runtime.");\t\t\t}'}else if(this.mode===xo.EVALUATE)t+='\nfunction include(name)\t\t\t{\t\t\t\tvar text = program.getResourceByName(name);\t\t\t\tif(text === null)\t\t\t\t{\t\t\t\t\ttext = FileSystem.readFile(name, true);\t\t\t\t\tif(text !== null)\t\t\t\t\t{\t\t\t\t\t\tnew Function(text).call(this);\t\t\t\t\t}\t\t\t\t\telse\t\t\t\t\t{\t\t\t\t\t\tconsole.warn("nunuStudio: Javascript file " + name + " not found.");\t\t\t\t\t}\t\t\t\t}\t\t\t\telse\t\t\t\t{\t\t\t\t\tnew Function(text.data).call(this);\t\t\t\t}\t\t\t}';else if(this.mode===xo.INCLUDE){i=xo.getIncludes(t),t=xo.removeIncludes(t);var o=0,a=[];for(n=0;n<i.length;n++){var l=this.program.getResourceByName(i[n]);if(null!==l){var c=new Blob([l.data],{type:"text/plain"});a.push(URL.createObjectURL(c))}else{var u=qi.readFile(i[n],!0);if(null===u)throw new Error("Script include() library "+i[n]+" not found.");c=new Blob([u],{type:"text/plain"}),a.push(URL.createObjectURL(c))}}if(a.length>0)for(n=0;n<a.length;n++){var h=document.createElement("script");h.type="text/javascript",h.async=!0,h.src=url,h.onload=function(){++o===a.length&&void 0!==e&&e()},h.onerror=h.onload,document.body.appendChild(h)}else void 0!==e&&e()}var p=new Function("__context__","for(var p in __context__){eval('var ' + p + ' = __context__[p];');}"+t);try{var d=this.createContextObject();this.script=new p(d)}catch(t){throw this.script={},console.warn("nunuStudio: Error initializing script code",t),new Error("Error initializing script code")}this.mode!==xo.INCLUDE&&e()}catch(t){throw this.script={},console.warn("nunuStudio: Error compiling script code",t),new Error("Error compiling script code")}},xo.prototype.createContextObject=function(){var r={};Object.assign(r,t),Object.assign(r,n),Object.assign(r,e);var i={};for(var s of["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2","abs","acos","acosh","asin","asinh","atan","atan2","atanh","cbrt","ceil","clz32","cos","cosh","exp","expm1","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc"])i[s]=window.Math[s];return Object.assign(i,n.Math),Object.assign(r,{self:this,program:this.program,scene:this.scene,THREE:n,CANNON:t,Math:i,Keyboard:this.program.keyboard,Mouse:this.program.mouse}),r},xo.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return e.object.code=this.code,e.object.mode=this.mode,e},wo.prototype=Object.create(n.SkinnedMesh.prototype),wo.prototype.dispose=function(){null!==this.material&&void 0!==this.material.dispose&&this.material.dispose(),null!==this.geometry&&void 0!==this.geometry.dispose&&this.geometry.dispose(),n.Object3D.prototype.dispose.call(this)},wo.prototype.toJSON=function(t){var e=this,r=n.Object3D.prototype.toJSON.call(this,t,(function(t,n){null!==e.skeleton&&(void 0===t.skeletons[e.skeleton.uuid]&&(t.skeletons[e.skeleton.uuid]=e.skeleton.toJSON(t)),n.skeleton=e.skeleton.uuid)}));return void 0!==this.bindMode&&(r.object.bindMode=this.bindMode),void 0!==this.bindMatrix&&(r.object.bindMatrix=this.bindMatrix.toArray()),r};const So="uniform vec3 topColor;\nuniform vec3 bottomColor;\nuniform float offset;\nuniform float exponent;\nvarying vec3 vWorldPosition;\n\nvoid main()\n{\n\tfloat h = normalize(vWorldPosition + offset).y;\n\tgl_FragColor = vec4(mix(bottomColor, topColor, max(pow(max(h , 0.0), exponent), 0.0)), 1.0);\n}\n",Mo="varying vec3 vWorldPosition;\n\nvoid main()\n{\n\tvec4 worldPosition = modelMatrix * vec4(position, 1.0);\n\tvWorldPosition = worldPosition.xyz;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}";function To(t,e,r,i){n.Group.call(this),this.name="sky",this.type="Sky",this.colorTop=[new n.Color(7844859),new n.Color(30463),new n.Color(220086),new n.Color(9273)],this.colorBottom=[new n.Color(15461606),new n.Color(16777215),new n.Color(16705495),new n.Color(26023)],this.sunColor=16777130,this.intensity=.3,this.moonColor=5592507,this.hemisphere=new n.HemisphereLight(3310847,16764031,.5),this.hemisphere.locked=!0,this.hemisphere.matrixAutoUpdate=!1,this.add(this.hemisphere),this.sun=new es(this.sunColor,this.intensity),this.sun.castShadow=!0,this.sun.locked=!0,this.add(this.sun);var s={topColor:{type:"c",value:new n.Color(0,.46,1)},bottomColor:{type:"c",value:new n.Color(1,1,1)},offset:{type:"f",value:20},exponent:{type:"f",value:.2}};s.topColor.value.copy(this.hemisphere.color);var o=new n.SphereBufferGeometry(1500,16,16),a=new n.ShaderMaterial({vertexShader:Mo,fragmentShader:So,uniforms:s,side:n.BackSide});this.sky=new n.Mesh(o,a),this.sky.locked=!0,this.sky.matrixAutoUpdate=!1,this.add(this.sky),this.sky.raycast=function(){return null},this.autoUpdate=void 0===t||t,this.sunDistance=void 0!==r?r:100,this.dayTime=void 0!==e?e:120,this.time=void 0!==i?i:75,this.updateSky()}To.prototype=Object.create(n.Group.prototype),To.prototype.initialize=function(){this.updateSky(),n.Object3D.prototype.initialize.call(this)},To.prototype.update=function(t){this.autoUpdate&&(this.time+=t,this.time>this.dayTime&&(this.time-=this.dayTime),this.updateSky()),n.Object3D.prototype.update.call(this,t)},To.prototype.updateSky=function(){var t=this.time/this.dayTime;if(t<.25)this.sky.material.uniforms.topColor.value.setRGB(this.colorTop[3].r,this.colorTop[3].g,this.colorTop[3].b),this.sky.material.uniforms.bottomColor.value.setRGB(this.colorBottom[3].r,this.colorBottom[3].g,this.colorBottom[3].b);else if(t<.292){var e=1-(n=23.81*(t-.25));this.sky.material.uniforms.topColor.value.setRGB(e*this.colorTop[3].r+n*this.colorTop[0].r,e*this.colorTop[3].g+n*this.colorTop[0].g,e*this.colorTop[3].b+n*this.colorTop[0].b),this.sky.material.uniforms.bottomColor.value.setRGB(e*this.colorBottom[3].r+n*this.colorBottom[0].r,e*this.colorBottom[3].g+n*this.colorBottom[0].g,e*this.colorBottom[3].b+n*this.colorBottom[0].b)}else t<.4167?(this.sky.material.uniforms.topColor.value.setRGB(this.colorTop[0].r,this.colorTop[0].g,this.colorTop[0].b),this.sky.material.uniforms.bottomColor.value.setRGB(this.colorBottom[0].r,this.colorBottom[0].g,this.colorBottom[0].b)):t<.5?(e=1-(n=12*(t-.4167)),this.sky.material.uniforms.topColor.value.setRGB(e*this.colorTop[0].r+n*this.colorTop[1].r,e*this.colorTop[0].g+n*this.colorTop[1].g,e*this.colorTop[0].b+n*this.colorTop[1].b),this.sky.material.uniforms.bottomColor.value.setRGB(e*this.colorBottom[0].r+n*this.colorBottom[1].r,e*this.colorBottom[0].g+n*this.colorBottom[1].g,e*this.colorBottom[0].b+n*this.colorBottom[1].b)):t<.708?(this.sky.material.uniforms.topColor.value.setRGB(this.colorTop[1].r,this.colorTop[1].g,this.colorTop[1].b),this.sky.material.uniforms.bottomColor.value.setRGB(this.colorBottom[1].r,this.colorBottom[1].g,this.colorBottom[1].b)):t<.75?(e=1-(n=23.81*(t-.708)),this.sky.material.uniforms.topColor.value.setRGB(e*this.colorTop[1].r+n*this.colorTop[2].r,e*this.colorTop[1].g+n*this.colorTop[2].g,e*this.colorTop[1].b+n*this.colorTop[2].b),this.sky.material.uniforms.bottomColor.value.setRGB(e*this.colorBottom[1].r+n*this.colorBottom[2].r,e*this.colorBottom[1].g+n*this.colorBottom[2].g,e*this.colorBottom[1].b+n*this.colorBottom[2].b)):t<.8333?(e=1-(n=12.048*(t-.75)),this.sky.material.uniforms.topColor.value.setRGB(e*this.colorTop[2].r+n*this.colorTop[3].r,e*this.colorTop[2].g+n*this.colorTop[3].g,e*this.colorTop[2].b+n*this.colorTop[3].b),this.sky.material.uniforms.bottomColor.value.setRGB(e*this.colorBottom[2].r+n*this.colorBottom[3].r,e*this.colorBottom[2].g+n*this.colorBottom[3].g,e*this.colorBottom[2].b+n*this.colorBottom[3].b)):(this.sky.material.uniforms.topColor.value.setRGB(this.colorTop[3].r,this.colorTop[3].g,this.colorTop[3].b),this.sky.material.uniforms.bottomColor.value.setRGB(this.colorBottom[3].r,this.colorBottom[3].g,this.colorBottom[3].b));if(t<.2)this.sun.intensity=this.intensity,this.sun.color.setHex(this.moonColor);else if(t<.3)e=1-(n=10*(t-.2)),n<.5?(e=2-2*n,this.sun.intensity=e*this.intensity,this.sun.color.setHex(this.moonColor)):(n*=2,this.sun.intensity=n*this.intensity,this.sun.color.setHex(this.sunColor));else if(t<.7)this.sun.intensity=this.intensity,this.sun.color.setHex(this.sunColor);else if(t<.8){var n;(n=10*(t-.7))<.5?(e=2-2*n,this.sun.intensity=e*this.intensity,this.sun.color.setHex(this.sunColor)):(n*=2,this.sun.intensity=n*this.intensity,this.sun.color.setHex(this.moonColor))}else this.sun.intensity=this.intensity,this.sun.color.setHex(this.moonColor);var r=Gi.PI2*t-Gi.PID2;t>.25&&t<.75?(this.sun.position.x=this.sunDistance*Math.cos(r),this.sun.position.y=this.sunDistance*Math.sin(r)):(this.sun.position.x=this.sunDistance*Math.cos(r+Math.PI),this.sun.position.y=this.sunDistance*Math.sin(r+Math.PI))},To.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);e.object.colorTop=[];for(var r=0;r<this.colorTop.length;r++)e.object.colorTop.push(this.colorTop[r].toJSON());for(e.object.colorBottom=[],r=0;r<this.colorBottom.length;r++)e.object.colorBottom.push(this.colorBottom[r].toJSON());return e.object.sunColor=this.sunColor,e.object.moonColor=this.moonColor,e.object.intensity=this.intensity,e.object.autoUpdate=this.autoUpdate,e.object.sunDistance=this.sunDistance,e.object.dayTime=this.dayTime,e.object.time=this.time,e.object.sun={},e.object.sun.castShadow=this.sun.castShadow,e.object.sun.shadow=this.sun.shadow.toJSON(),e};var Eo,Ao,$o=__webpack_require__(175);if($o){let t=window.require;window.require=e=>t?t(e):"three"===e?$o:void 0}class Co{constructor(){this.entries={},this.size=0}add(t){let e=this.entries[t];return this.entries[t]=!0,!e&&(this.size++,!0)}addAll(t){let e=this.size;for(var n=0,r=t.length;n<r;n++)this.add(t[n]);return e!=this.size}contains(t){return this.entries[t]}clear(){this.entries={},this.size=0}}class Bo{constructor(t=0,e=0,n=0,r=0){this.r=t,this.g=e,this.b=n,this.a=r}set(t,e,n,r){return this.r=t,this.g=e,this.b=n,this.a=r,this.clamp()}setFromColor(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}setFromString(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=8!=t.length?1:parseInt(t.substr(6,2),16)/255,this}add(t,e,n,r){return this.r+=t,this.g+=e,this.b+=n,this.a+=r,this.clamp()}clamp(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}static rgba8888ToColor(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}static rgb888ToColor(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}static fromString(t){return(new Bo).setFromString(t)}}Bo.WHITE=new Bo(1,1,1,1),Bo.RED=new Bo(1,0,0,1),Bo.GREEN=new Bo(0,1,0,1),Bo.BLUE=new Bo(0,0,1,1),Bo.MAGENTA=new Bo(1,0,1,1);class Lo{static clamp(t,e,n){return t<e?e:t>n?n:t}static cosDeg(t){return Math.cos(t*Lo.degRad)}static sinDeg(t){return Math.sin(t*Lo.degRad)}static signum(t){return t>0?1:t<0?-1:0}static toInt(t){return t>0?Math.floor(t):Math.ceil(t)}static cbrt(t){let e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}static randomTriangular(t,e){return Lo.randomTriangularWith(t,e,.5*(t+e))}static randomTriangularWith(t,e,n){let r=Math.random(),i=e-t;return r<=(n-t)/i?t+Math.sqrt(r*i*(n-t)):e-Math.sqrt((1-r)*i*(e-n))}static isPowerOfTwo(t){return t&&0==(t&t-1)}}Lo.PI=3.1415927,Lo.PI2=2*Lo.PI,Lo.radiansToDegrees=180/Lo.PI,Lo.radDeg=Lo.radiansToDegrees,Lo.degreesToRadians=Lo.PI/180,Lo.degRad=Lo.degreesToRadians;class Ro{apply(t,e,n){return t+(e-t)*this.applyInternal(n)}}class No extends Ro{constructor(t){super(),this.power=2,this.power=t}applyInternal(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1}}class Po{static arrayCopy(t,e,n,r,i){for(let s=e,o=r;s<e+i;s++,o++)n[o]=t[s]}static arrayFill(t,e,n,r){for(let i=e;i<n;i++)t[i]=r}static setArraySize(t,e,n=0){let r=t.length;if(r==e)return t;if(t.length=e,r<e)for(let i=r;i<e;i++)t[i]=n;return t}static ensureArrayCapacity(t,e,n=0){return t.length>=e?t:Po.setArraySize(t,e,n)}static newArray(t,e){let n=new Array(t);for(let r=0;r<t;r++)n[r]=e;return n}static newFloatArray(t){if(Po.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);{let e=new Array(t);for(let t=0;t<e.length;t++)e[t]=0;return e}}static newShortArray(t){if(Po.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);{let e=new Array(t);for(let t=0;t<e.length;t++)e[t]=0;return e}}static toFloatArray(t){return Po.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t}static toSinglePrecision(t){return Po.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t}static webkit602BugfixHelper(t,e){}static contains(t,e,n=!0){for(var r=0;r<t.length;r++)if(t[r]==e)return!0;return!1}static enumValue(t,e){return t[e[0].toUpperCase()+e.slice(1)]}}Po.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array;class Io{constructor(t){this.items=new Array,this.instantiator=t}obtain(){return this.items.length>0?this.items.pop():this.instantiator()}free(t){t.reset&&t.reset(),this.items.push(t)}freeAll(t){for(let e=0;e<t.length;e++)this.free(t[e])}clear(){this.items.length=0}}class Oo{constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){return this.x=t,this.y=e,this}length(){let t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}normalize(){let t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}}class Fo{constructor(t){if(!t)throw new Error("name cannot be null.");this.name=t}}class ko extends Fo{constructor(t){super(t),this.id=ko.nextID++,this.worldVerticesLength=0,this.deformAttachment=this}computeWorldVertices(t,e,n,r,i,s){n=i+(n>>1)*s;let o=t.bone.skeleton,a=t.deform,l=this.vertices,c=this.bones;if(!c){a.length>0&&(l=a);let o=t.bone,c=o.worldX,u=o.worldY,h=o.a,p=o.b,d=o.c,f=o.d;for(let t=e,o=i;o<n;t+=2,o+=s){let e=l[t],n=l[t+1];r[o]=e*h+n*p+c,r[o+1]=e*d+n*f+u}return}let u=0,h=0;for(let t=0;t<e;t+=2){let t=c[u];u+=t+1,h+=t}let p=o.bones;if(0==a.length)for(let t=i,e=3*h;t<n;t+=s){let n=0,i=0,s=c[u++];for(s+=u;u<s;u++,e+=3){let t=p[c[u]],r=l[e],s=l[e+1],o=l[e+2];n+=(r*t.a+s*t.b+t.worldX)*o,i+=(r*t.c+s*t.d+t.worldY)*o}r[t]=n,r[t+1]=i}else{let t=a;for(let e=i,o=3*h,a=h<<1;e<n;e+=s){let n=0,i=0,s=c[u++];for(s+=u;u<s;u++,o+=3,a+=2){let e=p[c[u]],r=l[o]+t[a],s=l[o+1]+t[a+1],h=l[o+2];n+=(r*e.a+s*e.b+e.worldX)*h,i+=(r*e.c+s*e.d+e.worldY)*h}r[e]=n,r[e+1]=i}}}copyTo(t){this.bones?(t.bones=new Array(this.bones.length),Po.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,this.vertices?(t.vertices=Po.newFloatArray(this.vertices.length),Po.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment}}ko.nextID=0;class Do{constructor(t,e,n){if(!t)throw new Error("name cannot be null.");this.name=t,this.setTimelines(e),this.duration=n}setTimelines(t){if(!t)throw new Error("timelines cannot be null.");this.timelines=t,this.timelineIds=new Co;for(var e=0;e<t.length;e++)this.timelineIds.addAll(t[e].getPropertyIds())}hasTimeline(t){for(let e=0;e<t.length;e++)if(this.timelineIds.contains(t[e]))return!0;return!1}apply(t,e,n,r,i,s,o,a){if(!t)throw new Error("skeleton cannot be null.");r&&0!=this.duration&&(n%=this.duration,e>0&&(e%=this.duration));let l=this.timelines;for(let r=0,c=l.length;r<c;r++)l[r].apply(t,e,n,i,s,o,a)}}!function(t){t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add"}(Eo||(Eo={})),function(t){t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut"}(Ao||(Ao={}));class Uo{constructor(t,e){this.propertyIds=e,this.frames=Po.newFloatArray(t*this.getFrameEntries())}getPropertyIds(){return this.propertyIds}getFrameEntries(){return 1}getFrameCount(){return this.frames.length/this.getFrameEntries()}getDuration(){return this.frames[this.frames.length-this.getFrameEntries()]}static search1(t,e){let n=t.length;for(let r=1;r<n;r++)if(t[r]>e)return r-1;return n-1}static search(t,e,n){let r=t.length;for(let i=n;i<r;i+=n)if(t[i]>e)return i-n;return r-n}}class zo extends Uo{constructor(t,e,n){super(t,n),this.curves=Po.newFloatArray(t+18*e),this.curves[t-1]=1}setLinear(t){this.curves[t]=0}setStepped(t){this.curves[t]=1}shrink(t){let e=this.getFrameCount()+18*t;if(this.curves.length>e){let t=Po.newFloatArray(e);Po.arrayCopy(this.curves,0,t,0,e),this.curves=t}}setBezier(t,e,n,r,i,s,o,a,l,c,u){let h=this.curves,p=this.getFrameCount()+18*t;0==n&&(h[e]=2+p);let d=.03*(r-2*s+a),f=.03*(i-2*o+l),m=.006*(3*(s-a)-r+c),_=.006*(3*(o-l)-i+u),g=2*d+m,y=2*f+_,v=.3*(s-r)+d+.16666667*m,b=.3*(o-i)+f+.16666667*_,x=r+v,w=i+b;for(let t=p+18;p<t;p+=2)h[p]=x,h[p+1]=w,v+=g,b+=y,g+=m,y+=_,x+=v,w+=b}getBezierValue(t,e,n,r){let i=this.curves;if(i[r]>t){let s=this.frames[e],o=this.frames[e+n];return o+(t-s)/(i[r]-s)*(i[r+1]-o)}let s=r+18;for(r+=2;r<s;r+=2)if(i[r]>=t){let e=i[r-2],n=i[r-1];return n+(t-e)/(i[r]-e)*(i[r+1]-n)}e+=this.getFrameEntries();let o=i[s-2],a=i[s-1];return a+(t-o)/(this.frames[e]-o)*(this.frames[e+n]-a)}}class jo extends zo{constructor(t,e,n){super(t,e,[n])}getFrameEntries(){return 2}setFrame(t,e,n){t<<=1,this.frames[t]=e,this.frames[t+1]=n}getCurveValue(t){let e=this.frames,n=e.length-2;for(let r=2;r<=n;r+=2)if(e[r]>t){n=r-2;break}let r=this.curves[n>>1];switch(r){case 0:let r=e[n],i=e[n+1];return i+(t-r)/(e[n+2]-r)*(e[n+2+1]-i);case 1:return e[n+1]}return this.getBezierValue(t,n,1,r-2)}}class Go extends zo{constructor(t,e,n,r){super(t,e,[n,r])}getFrameEntries(){return 3}setFrame(t,e,n,r){t*=3,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r}}class Ho extends jo{constructor(t,e,n){super(t,e,"0|"+n),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){let a=t.bones[this.boneIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case Eo.setup:return void(a.rotation=a.data.rotation);case Eo.first:a.rotation+=(a.data.rotation-a.rotation)*i}return}let l=this.getCurveValue(n);switch(s){case Eo.setup:a.rotation=a.data.rotation+l*i;break;case Eo.first:case Eo.replace:l+=a.data.rotation-a.rotation;case Eo.add:a.rotation+=l*i}}}class Vo extends Go{constructor(t,e,n){super(t,e,"1|"+n,"2|"+n),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){let a=t.bones[this.boneIndex];if(!a.active)return;let l=this.frames;if(n<l[0]){switch(s){case Eo.setup:return a.x=a.data.x,void(a.y=a.data.y);case Eo.first:a.x+=(a.data.x-a.x)*i,a.y+=(a.data.y-a.y)*i}return}let c=0,u=0,h=Uo.search(l,n,3),p=this.curves[h/3];switch(p){case 0:let t=l[h];c=l[h+1],u=l[h+2];let e=(n-t)/(l[h+3]-t);c+=(l[h+3+1]-c)*e,u+=(l[h+3+2]-u)*e;break;case 1:c=l[h+1],u=l[h+2];break;default:c=this.getBezierValue(n,h,1,p-2),u=this.getBezierValue(n,h,2,p+18-2)}switch(s){case Eo.setup:a.x=a.data.x+c*i,a.y=a.data.y+u*i;break;case Eo.first:case Eo.replace:a.x+=(a.data.x+c-a.x)*i,a.y+=(a.data.y+u-a.y)*i;break;case Eo.add:a.x+=c*i,a.y+=u*i}}}class Wo extends jo{constructor(t,e,n){super(t,e,"1|"+n),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){let a=t.bones[this.boneIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case Eo.setup:return void(a.x=a.data.x);case Eo.first:a.x+=(a.data.x-a.x)*i}return}let l=this.getCurveValue(n);switch(s){case Eo.setup:a.x=a.data.x+l*i;break;case Eo.first:case Eo.replace:a.x+=(a.data.x+l-a.x)*i;break;case Eo.add:a.x+=l*i}}}class qo extends jo{constructor(t,e,n){super(t,e,"2|"+n),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){let a=t.bones[this.boneIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case Eo.setup:return void(a.y=a.data.y);case Eo.first:a.y+=(a.data.y-a.y)*i}return}let l=this.getCurveValue(n);switch(s){case Eo.setup:a.y=a.data.y+l*i;break;case Eo.first:case Eo.replace:a.y+=(a.data.y+l-a.y)*i;break;case Eo.add:a.y+=l*i}}}class Xo extends Go{constructor(t,e,n){super(t,e,"3|"+n,"4|"+n),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){let a=t.bones[this.boneIndex];if(!a.active)return;let l,c,u=this.frames;if(n<u[0]){switch(s){case Eo.setup:return a.scaleX=a.data.scaleX,void(a.scaleY=a.data.scaleY);case Eo.first:a.scaleX+=(a.data.scaleX-a.scaleX)*i,a.scaleY+=(a.data.scaleY-a.scaleY)*i}return}let h=Uo.search(u,n,3),p=this.curves[h/3];switch(p){case 0:let t=u[h];l=u[h+1],c=u[h+2];let e=(n-t)/(u[h+3]-t);l+=(u[h+3+1]-l)*e,c+=(u[h+3+2]-c)*e;break;case 1:l=u[h+1],c=u[h+2];break;default:l=this.getBezierValue(n,h,1,p-2),c=this.getBezierValue(n,h,2,p+18-2)}if(l*=a.data.scaleX,c*=a.data.scaleY,1==i)s==Eo.add?(a.scaleX+=l-a.data.scaleX,a.scaleY+=c-a.data.scaleY):(a.scaleX=l,a.scaleY=c);else{let t=0,e=0;if(o==Ao.mixOut)switch(s){case Eo.setup:t=a.data.scaleX,e=a.data.scaleY,a.scaleX=t+(Math.abs(l)*Lo.signum(t)-t)*i,a.scaleY=e+(Math.abs(c)*Lo.signum(e)-e)*i;break;case Eo.first:case Eo.replace:t=a.scaleX,e=a.scaleY,a.scaleX=t+(Math.abs(l)*Lo.signum(t)-t)*i,a.scaleY=e+(Math.abs(c)*Lo.signum(e)-e)*i;break;case Eo.add:a.scaleX=(l-a.data.scaleX)*i,a.scaleY=(c-a.data.scaleY)*i}else switch(s){case Eo.setup:t=Math.abs(a.data.scaleX)*Lo.signum(l),e=Math.abs(a.data.scaleY)*Lo.signum(c),a.scaleX=t+(l-t)*i,a.scaleY=e+(c-e)*i;break;case Eo.first:case Eo.replace:t=Math.abs(a.scaleX)*Lo.signum(l),e=Math.abs(a.scaleY)*Lo.signum(c),a.scaleX=t+(l-t)*i,a.scaleY=e+(c-e)*i;break;case Eo.add:a.scaleX+=(l-a.data.scaleX)*i,a.scaleY+=(c-a.data.scaleY)*i}}}}class Yo extends jo{constructor(t,e,n){super(t,e,"3|"+n),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){let a=t.bones[this.boneIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case Eo.setup:return void(a.scaleX=a.data.scaleX);case Eo.first:a.scaleX+=(a.data.scaleX-a.scaleX)*i}return}let l=this.getCurveValue(n)*a.data.scaleX;if(1==i)s==Eo.add?a.scaleX+=l-a.data.scaleX:a.scaleX=l;else{let t=0;if(o==Ao.mixOut)switch(s){case Eo.setup:t=a.data.scaleX,a.scaleX=t+(Math.abs(l)*Lo.signum(t)-t)*i;break;case Eo.first:case Eo.replace:t=a.scaleX,a.scaleX=t+(Math.abs(l)*Lo.signum(t)-t)*i;break;case Eo.add:a.scaleX=(l-a.data.scaleX)*i}else switch(s){case Eo.setup:t=Math.abs(a.data.scaleX)*Lo.signum(l),a.scaleX=t+(l-t)*i;break;case Eo.first:case Eo.replace:t=Math.abs(a.scaleX)*Lo.signum(l),a.scaleX=t+(l-t)*i;break;case Eo.add:a.scaleX+=(l-a.data.scaleX)*i}}}}class Jo extends jo{constructor(t,e,n){super(t,e,"4|"+n),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){let a=t.bones[this.boneIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case Eo.setup:return void(a.scaleY=a.data.scaleY);case Eo.first:a.scaleY+=(a.data.scaleY-a.scaleY)*i}return}let l=this.getCurveValue(n)*a.data.scaleY;if(1==i)s==Eo.add?a.scaleY+=l-a.data.scaleY:a.scaleY=l;else{let t=0;if(o==Ao.mixOut)switch(s){case Eo.setup:t=a.data.scaleY,a.scaleY=t+(Math.abs(l)*Lo.signum(t)-t)*i;break;case Eo.first:case Eo.replace:t=a.scaleY,a.scaleY=t+(Math.abs(l)*Lo.signum(t)-t)*i;break;case Eo.add:a.scaleY=(l-a.data.scaleY)*i}else switch(s){case Eo.setup:t=Math.abs(a.data.scaleY)*Lo.signum(l),a.scaleY=t+(l-t)*i;break;case Eo.first:case Eo.replace:t=Math.abs(a.scaleY)*Lo.signum(l),a.scaleY=t+(l-t)*i;break;case Eo.add:a.scaleY+=(l-a.data.scaleY)*i}}}}class Zo extends Go{constructor(t,e,n){super(t,e,"5|"+n,"6|"+n),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){let a=t.bones[this.boneIndex];if(!a.active)return;let l=this.frames;if(n<l[0]){switch(s){case Eo.setup:return a.shearX=a.data.shearX,void(a.shearY=a.data.shearY);case Eo.first:a.shearX+=(a.data.shearX-a.shearX)*i,a.shearY+=(a.data.shearY-a.shearY)*i}return}let c=0,u=0,h=Uo.search(l,n,3),p=this.curves[h/3];switch(p){case 0:let t=l[h];c=l[h+1],u=l[h+2];let e=(n-t)/(l[h+3]-t);c+=(l[h+3+1]-c)*e,u+=(l[h+3+2]-u)*e;break;case 1:c=l[h+1],u=l[h+2];break;default:c=this.getBezierValue(n,h,1,p-2),u=this.getBezierValue(n,h,2,p+18-2)}switch(s){case Eo.setup:a.shearX=a.data.shearX+c*i,a.shearY=a.data.shearY+u*i;break;case Eo.first:case Eo.replace:a.shearX+=(a.data.shearX+c-a.shearX)*i,a.shearY+=(a.data.shearY+u-a.shearY)*i;break;case Eo.add:a.shearX+=c*i,a.shearY+=u*i}}}class Qo extends jo{constructor(t,e,n){super(t,e,"5|"+n),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){let a=t.bones[this.boneIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case Eo.setup:return void(a.shearX=a.data.shearX);case Eo.first:a.shearX+=(a.data.shearX-a.shearX)*i}return}let l=this.getCurveValue(n);switch(s){case Eo.setup:a.shearX=a.data.shearX+l*i;break;case Eo.first:case Eo.replace:a.shearX+=(a.data.shearX+l-a.shearX)*i;break;case Eo.add:a.shearX+=l*i}}}class Ko extends jo{constructor(t,e,n){super(t,e,"6|"+n),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){let a=t.bones[this.boneIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case Eo.setup:return void(a.shearY=a.data.shearY);case Eo.first:a.shearY+=(a.data.shearY-a.shearY)*i}return}let l=this.getCurveValue(n);switch(s){case Eo.setup:a.shearY=a.data.shearY+l*i;break;case Eo.first:case Eo.replace:a.shearY+=(a.data.shearY+l-a.shearY)*i;break;case Eo.add:a.shearY+=l*i}}}class ta extends zo{constructor(t,e,n){super(t,e,["7|"+n,"8|"+n]),this.slotIndex=0,this.slotIndex=n}getFrameEntries(){return 5}setFrame(t,e,n,r,i,s){t*=5,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r,this.frames[t+3]=i,this.frames[t+4]=s}apply(t,e,n,r,i,s,o){let a=t.slots[this.slotIndex];if(!a.bone.active)return;let l=this.frames,c=a.color;if(n<l[0]){let t=a.data.color;switch(s){case Eo.setup:return void c.setFromColor(t);case Eo.first:c.add((t.r-c.r)*i,(t.g-c.g)*i,(t.b-c.b)*i,(t.a-c.a)*i)}return}let u=0,h=0,p=0,d=0,f=Uo.search(l,n,5),m=this.curves[f/5];switch(m){case 0:let t=l[f];u=l[f+1],h=l[f+2],p=l[f+3],d=l[f+4];let e=(n-t)/(l[f+5]-t);u+=(l[f+5+1]-u)*e,h+=(l[f+5+2]-h)*e,p+=(l[f+5+3]-p)*e,d+=(l[f+5+4]-d)*e;break;case 1:u=l[f+1],h=l[f+2],p=l[f+3],d=l[f+4];break;default:u=this.getBezierValue(n,f,1,m-2),h=this.getBezierValue(n,f,2,m+18-2),p=this.getBezierValue(n,f,3,m+36-2),d=this.getBezierValue(n,f,4,m+54-2)}1==i?c.set(u,h,p,d):(s==Eo.setup&&c.setFromColor(a.data.color),c.add((u-c.r)*i,(h-c.g)*i,(p-c.b)*i,(d-c.a)*i))}}class ea extends zo{constructor(t,e,n){super(t,e,["7|"+n]),this.slotIndex=0,this.slotIndex=n}getFrameEntries(){return 4}setFrame(t,e,n,r,i){t<<=2,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r,this.frames[t+3]=i}apply(t,e,n,r,i,s,o){let a=t.slots[this.slotIndex];if(!a.bone.active)return;let l=this.frames,c=a.color;if(n<l[0]){let t=a.data.color;switch(s){case Eo.setup:return c.r=t.r,c.g=t.g,void(c.b=t.b);case Eo.first:c.r+=(t.r-c.r)*i,c.g+=(t.g-c.g)*i,c.b+=(t.b-c.b)*i}return}let u=0,h=0,p=0,d=Uo.search(l,n,4),f=this.curves[d>>2];switch(f){case 0:let t=l[d];u=l[d+1],h=l[d+2],p=l[d+3];let e=(n-t)/(l[d+4]-t);u+=(l[d+4+1]-u)*e,h+=(l[d+4+2]-h)*e,p+=(l[d+4+3]-p)*e;break;case 1:u=l[d+1],h=l[d+2],p=l[d+3];break;default:u=this.getBezierValue(n,d,1,f-2),h=this.getBezierValue(n,d,2,f+18-2),p=this.getBezierValue(n,d,3,f+36-2)}if(1==i)c.r=u,c.g=h,c.b=p;else{if(s==Eo.setup){let t=a.data.color;c.r=t.r,c.g=t.g,c.b=t.b}c.r+=(u-c.r)*i,c.g+=(h-c.g)*i,c.b+=(p-c.b)*i}}}class na extends jo{constructor(t,e,n){super(t,e,"8|"+n),this.slotIndex=0,this.slotIndex=n}apply(t,e,n,r,i,s,o){let a=t.slots[this.slotIndex];if(!a.bone.active)return;let l=a.color;if(n<this.frames[0]){let t=a.data.color;switch(s){case Eo.setup:return void(l.a=t.a);case Eo.first:l.a+=(t.a-l.a)*i}return}let c=this.getCurveValue(n);1==i?l.a=c:(s==Eo.setup&&(l.a=a.data.color.a),l.a+=(c-l.a)*i)}}class ra extends zo{constructor(t,e,n){super(t,e,["7|"+n,"8|"+n,"9|"+n]),this.slotIndex=0,this.slotIndex=n}getFrameEntries(){return 8}setFrame(t,e,n,r,i,s,o,a,l){t<<=3,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r,this.frames[t+3]=i,this.frames[t+4]=s,this.frames[t+5]=o,this.frames[t+6]=a,this.frames[t+7]=l}apply(t,e,n,r,i,s,o){let a=t.slots[this.slotIndex];if(!a.bone.active)return;let l=this.frames,c=a.color,u=a.darkColor;if(n<l[0]){let t=a.data.color,e=a.data.darkColor;switch(s){case Eo.setup:return c.setFromColor(t),u.r=e.r,u.g=e.g,void(u.b=e.b);case Eo.first:c.add((t.r-c.r)*i,(t.g-c.g)*i,(t.b-c.b)*i,(t.a-c.a)*i),u.r+=(e.r-u.r)*i,u.g+=(e.g-u.g)*i,u.b+=(e.b-u.b)*i}return}let h=0,p=0,d=0,f=0,m=0,_=0,g=0,y=Uo.search(l,n,8),v=this.curves[y>>3];switch(v){case 0:let t=l[y];h=l[y+1],p=l[y+2],d=l[y+3],f=l[y+4],m=l[y+5],_=l[y+6],g=l[y+7];let e=(n-t)/(l[y+8]-t);h+=(l[y+8+1]-h)*e,p+=(l[y+8+2]-p)*e,d+=(l[y+8+3]-d)*e,f+=(l[y+8+4]-f)*e,m+=(l[y+8+5]-m)*e,_+=(l[y+8+6]-_)*e,g+=(l[y+8+7]-g)*e;break;case 1:h=l[y+1],p=l[y+2],d=l[y+3],f=l[y+4],m=l[y+5],_=l[y+6],g=l[y+7];break;default:h=this.getBezierValue(n,y,1,v-2),p=this.getBezierValue(n,y,2,v+18-2),d=this.getBezierValue(n,y,3,v+36-2),f=this.getBezierValue(n,y,4,v+54-2),m=this.getBezierValue(n,y,5,v+72-2),_=this.getBezierValue(n,y,6,v+90-2),g=this.getBezierValue(n,y,7,v+108-2)}if(1==i)c.set(h,p,d,f),u.r=m,u.g=_,u.b=g;else{if(s==Eo.setup){c.setFromColor(a.data.color);let t=a.data.darkColor;u.r=t.r,u.g=t.g,u.b=t.b}c.add((h-c.r)*i,(p-c.g)*i,(d-c.b)*i,(f-c.a)*i),u.r+=(m-u.r)*i,u.g+=(_-u.g)*i,u.b+=(g-u.b)*i}}}class ia extends zo{constructor(t,e,n){super(t,e,["7|"+n,"9|"+n]),this.slotIndex=0,this.slotIndex=n}getFrameEntries(){return 7}setFrame(t,e,n,r,i,s,o,a){t*=7,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r,this.frames[t+3]=i,this.frames[t+4]=s,this.frames[t+5]=o,this.frames[t+6]=a}apply(t,e,n,r,i,s,o){let a=t.slots[this.slotIndex];if(!a.bone.active)return;let l=this.frames,c=a.color,u=a.darkColor;if(n<l[0]){let t=a.data.color,e=a.data.darkColor;switch(s){case Eo.setup:return c.r=t.r,c.g=t.g,c.b=t.b,u.r=e.r,u.g=e.g,void(u.b=e.b);case Eo.first:c.r+=(t.r-c.r)*i,c.g+=(t.g-c.g)*i,c.b+=(t.b-c.b)*i,u.r+=(e.r-u.r)*i,u.g+=(e.g-u.g)*i,u.b+=(e.b-u.b)*i}return}let h=0,p=0,d=0,f=0,m=0,_=0,g=Uo.search(l,n,7),y=this.curves[g/7];switch(y){case 0:let t=l[g];h=l[g+1],p=l[g+2],d=l[g+3],f=l[g+4],m=l[g+5],_=l[g+6];let e=(n-t)/(l[g+7]-t);h+=(l[g+7+1]-h)*e,p+=(l[g+7+2]-p)*e,d+=(l[g+7+3]-d)*e,f+=(l[g+7+4]-f)*e,m+=(l[g+7+5]-m)*e,_+=(l[g+7+6]-_)*e;break;case 1:h=l[g+1],p=l[g+2],d=l[g+3],f=l[g+4],m=l[g+5],_=l[g+6];break;default:h=this.getBezierValue(n,g,1,y-2),p=this.getBezierValue(n,g,2,y+18-2),d=this.getBezierValue(n,g,3,y+36-2),f=this.getBezierValue(n,g,4,y+54-2),m=this.getBezierValue(n,g,5,y+72-2),_=this.getBezierValue(n,g,6,y+90-2)}if(1==i)c.r=h,c.g=p,c.b=d,u.r=f,u.g=m,u.b=_;else{if(s==Eo.setup){let t=a.data.color,e=a.data.darkColor;c.r=t.r,c.g=t.g,c.b=t.b,u.r=e.r,u.g=e.g,u.b=e.b}c.r+=(h-c.r)*i,c.g+=(p-c.g)*i,c.b+=(d-c.b)*i,u.r+=(f-u.r)*i,u.g+=(m-u.g)*i,u.b+=(_-u.b)*i}}}class sa extends Uo{constructor(t,e){super(t,["10|"+e]),this.slotIndex=0,this.slotIndex=e,this.attachmentNames=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,n){this.frames[t]=e,this.attachmentNames[t]=n}apply(t,e,n,r,i,s,o){let a=t.slots[this.slotIndex];a.bone.active&&(o!=Ao.mixOut?n<this.frames[0]?s!=Eo.setup&&s!=Eo.first||this.setAttachment(t,a,a.data.attachmentName):this.setAttachment(t,a,this.attachmentNames[Uo.search1(this.frames,n)]):s==Eo.setup&&this.setAttachment(t,a,a.data.attachmentName))}setAttachment(t,e,n){e.setAttachment(n?t.getAttachment(this.slotIndex,n):null)}}class oa extends zo{constructor(t,e,n,r){super(t,e,["11|"+n+"|"+r.id]),this.slotIndex=0,this.slotIndex=n,this.attachment=r,this.vertices=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,n){this.frames[t]=e,this.vertices[t]=n}setBezier(t,e,n,r,i,s,o,a,l,c,u){let h=this.curves,p=this.getFrameCount()+18*t;0==n&&(h[e]=2+p);let d=.03*(r-2*s+a),f=.03*l-.06*o,m=.006*(3*(s-a)-r+c),_=.018*(o-l+.33333333),g=2*d+m,y=2*f+_,v=.3*(s-r)+d+.16666667*m,b=.3*o+f+.16666667*_,x=r+v,w=b;for(let t=p+18;p<t;p+=2)h[p]=x,h[p+1]=w,v+=g,b+=y,g+=m,y+=_,x+=v,w+=b}getCurvePercent(t,e){let n=this.curves,r=n[e];switch(r){case 0:let n=this.frames[e];return(t-n)/(this.frames[e+this.getFrameEntries()]-n);case 1:return 0}if(r-=2,n[r]>t){let i=this.frames[e];return n[r+1]*(t-i)/(n[r]-i)}let i=r+18;for(r+=2;r<i;r+=2)if(n[r]>=t){let e=n[r-2],i=n[r-1];return i+(t-e)/(n[r]-e)*(n[r+1]-i)}let s=n[i-2],o=n[i-1];return o+(1-o)*(t-s)/(this.frames[e+this.getFrameEntries()]-s)}apply(t,e,n,r,i,s,o){let a=t.slots[this.slotIndex];if(!a.bone.active)return;let l=a.getAttachment();if(!(l instanceof ko)||l.deformAttachment!=this.attachment)return;let c=a.deform;0==c.length&&(s=Eo.setup);let u=this.vertices,h=u[0].length,p=this.frames;if(n<p[0]){let t=l;switch(s){case Eo.setup:return void(c.length=0);case Eo.first:if(1==i)return void(c.length=0);if(c.length=h,t.bones)for(i=1-i,d=0;d<h;d++)c[d]*=i;else{let e=t.vertices;for(var d=0;d<h;d++)c[d]+=(e[d]-c[d])*i}}return}if(c.length=h,n>=p[p.length-1]){let t=u[p.length-1];if(1==i)if(s==Eo.add){let e=l;if(e.bones)for(let e=0;e<h;e++)c[e]+=t[e];else{let n=e.vertices;for(let e=0;e<h;e++)c[e]+=t[e]-n[e]}}else Po.arrayCopy(t,0,c,0,h);else switch(s){case Eo.setup:{let e=l;if(e.bones)for(let e=0;e<h;e++)c[e]=t[e]*i;else{let n=e.vertices;for(let e=0;e<h;e++){let r=n[e];c[e]=r+(t[e]-r)*i}}break}case Eo.first:case Eo.replace:for(let e=0;e<h;e++)c[e]+=(t[e]-c[e])*i;break;case Eo.add:let e=l;if(e.bones)for(let e=0;e<h;e++)c[e]+=t[e]*i;else{let n=e.vertices;for(let e=0;e<h;e++)c[e]+=(t[e]-n[e])*i}}return}let f=Uo.search1(p,n),m=this.getCurvePercent(n,f),_=u[f],g=u[f+1];if(1==i)if(s==Eo.add){let t=l;if(t.bones)for(let t=0;t<h;t++){let e=_[t];c[t]+=e+(g[t]-e)*m}else{let e=t.vertices;for(let t=0;t<h;t++){let n=_[t];c[t]+=n+(g[t]-n)*m-e[t]}}}else for(let t=0;t<h;t++){let e=_[t];c[t]=e+(g[t]-e)*m}else switch(s){case Eo.setup:{let t=l;if(t.bones)for(let t=0;t<h;t++){let e=_[t];c[t]=(e+(g[t]-e)*m)*i}else{let e=t.vertices;for(let t=0;t<h;t++){let n=_[t],r=e[t];c[t]=r+(n+(g[t]-n)*m-r)*i}}break}case Eo.first:case Eo.replace:for(let t=0;t<h;t++){let e=_[t];c[t]+=(e+(g[t]-e)*m-c[t])*i}break;case Eo.add:let t=l;if(t.bones)for(let t=0;t<h;t++){let e=_[t];c[t]+=(e+(g[t]-e)*m)*i}else{let e=t.vertices;for(let t=0;t<h;t++){let n=_[t];c[t]+=(n+(g[t]-n)*m-e[t])*i}}}}}class aa extends Uo{constructor(t){super(t,aa.propertyIds),this.events=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,n,r,i,s,o){if(!r)return;let a=this.frames,l=this.frames.length;if(e>n)this.apply(t,e,Number.MAX_VALUE,r,i,s,o),e=-1;else if(e>=a[l-1])return;if(n<a[0])return;let c=0;if(e<a[0])c=0;else{c=Uo.search1(a,e)+1;let t=a[c];for(;c>0&&a[c-1]==t;)c--}for(;c<l&&n>=a[c];c++)r.push(this.events[c])}}aa.propertyIds=["12"];class la extends Uo{constructor(t){super(t,la.propertyIds),this.drawOrders=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,n){this.frames[t]=e,this.drawOrders[t]=n}apply(t,e,n,r,i,s,o){if(o==Ao.mixOut)return void(s==Eo.setup&&Po.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));if(n<this.frames[0])return void(s!=Eo.setup&&s!=Eo.first||Po.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));let a=this.drawOrders[Uo.search1(this.frames,n)];if(a){let e=t.drawOrder,n=t.slots;for(let t=0,r=a.length;t<r;t++)e[t]=n[a[t]]}else Po.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)}}la.propertyIds=["13"];class ca extends zo{constructor(t,e,n){super(t,e,["14|"+n]),this.ikConstraintIndex=n}getFrameEntries(){return 6}setFrame(t,e,n,r,i,s,o){t*=6,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r,this.frames[t+3]=i,this.frames[t+4]=s?1:0,this.frames[t+5]=o?1:0}apply(t,e,n,r,i,s,o){let a=t.ikConstraints[this.ikConstraintIndex];if(!a.active)return;let l=this.frames;if(n<l[0]){switch(s){case Eo.setup:return a.mix=a.data.mix,a.softness=a.data.softness,a.bendDirection=a.data.bendDirection,a.compress=a.data.compress,void(a.stretch=a.data.stretch);case Eo.first:a.mix+=(a.data.mix-a.mix)*i,a.softness+=(a.data.softness-a.softness)*i,a.bendDirection=a.data.bendDirection,a.compress=a.data.compress,a.stretch=a.data.stretch}return}let c=0,u=0,h=Uo.search(l,n,6),p=this.curves[h/6];switch(p){case 0:let t=l[h];c=l[h+1],u=l[h+2];let e=(n-t)/(l[h+6]-t);c+=(l[h+6+1]-c)*e,u+=(l[h+6+2]-u)*e;break;case 1:c=l[h+1],u=l[h+2];break;default:c=this.getBezierValue(n,h,1,p-2),u=this.getBezierValue(n,h,2,p+18-2)}s==Eo.setup?(a.mix=a.data.mix+(c-a.data.mix)*i,a.softness=a.data.softness+(u-a.data.softness)*i,o==Ao.mixOut?(a.bendDirection=a.data.bendDirection,a.compress=a.data.compress,a.stretch=a.data.stretch):(a.bendDirection=l[h+3],a.compress=0!=l[h+4],a.stretch=0!=l[h+5])):(a.mix+=(c-a.mix)*i,a.softness+=(u-a.softness)*i,o==Ao.mixIn&&(a.bendDirection=l[h+3],a.compress=0!=l[h+4],a.stretch=0!=l[h+5]))}}class ua extends zo{constructor(t,e,n){super(t,e,["15|"+n]),this.transformConstraintIndex=n}getFrameEntries(){return 7}setFrame(t,e,n,r,i,s,o,a){let l=this.frames;l[t*=7]=e,l[t+1]=n,l[t+2]=r,l[t+3]=i,l[t+4]=s,l[t+5]=o,l[t+6]=a}apply(t,e,n,r,i,s,o){let a=t.transformConstraints[this.transformConstraintIndex];if(!a.active)return;let l,c,u,h,p,d,f=this.frames;if(n<f[0]){let t=a.data;switch(s){case Eo.setup:return a.mixRotate=t.mixRotate,a.mixX=t.mixX,a.mixY=t.mixY,a.mixScaleX=t.mixScaleX,a.mixScaleY=t.mixScaleY,void(a.mixShearY=t.mixShearY);case Eo.first:a.mixRotate+=(t.mixRotate-a.mixRotate)*i,a.mixX+=(t.mixX-a.mixX)*i,a.mixY+=(t.mixY-a.mixY)*i,a.mixScaleX+=(t.mixScaleX-a.mixScaleX)*i,a.mixScaleY+=(t.mixScaleY-a.mixScaleY)*i,a.mixShearY+=(t.mixShearY-a.mixShearY)*i}return}let m=Uo.search(f,n,7),_=this.curves[m/7];switch(_){case 0:let t=f[m];l=f[m+1],c=f[m+2],u=f[m+3],h=f[m+4],p=f[m+5],d=f[m+6];let e=(n-t)/(f[m+7]-t);l+=(f[m+7+1]-l)*e,c+=(f[m+7+2]-c)*e,u+=(f[m+7+3]-u)*e,h+=(f[m+7+4]-h)*e,p+=(f[m+7+5]-p)*e,d+=(f[m+7+6]-d)*e;break;case 1:l=f[m+1],c=f[m+2],u=f[m+3],h=f[m+4],p=f[m+5],d=f[m+6];break;default:l=this.getBezierValue(n,m,1,_-2),c=this.getBezierValue(n,m,2,_+18-2),u=this.getBezierValue(n,m,3,_+36-2),h=this.getBezierValue(n,m,4,_+54-2),p=this.getBezierValue(n,m,5,_+72-2),d=this.getBezierValue(n,m,6,_+90-2)}if(s==Eo.setup){let t=a.data;a.mixRotate=t.mixRotate+(l-t.mixRotate)*i,a.mixX=t.mixX+(c-t.mixX)*i,a.mixY=t.mixY+(u-t.mixY)*i,a.mixScaleX=t.mixScaleX+(h-t.mixScaleX)*i,a.mixScaleY=t.mixScaleY+(p-t.mixScaleY)*i,a.mixShearY=t.mixShearY+(d-t.mixShearY)*i}else a.mixRotate+=(l-a.mixRotate)*i,a.mixX+=(c-a.mixX)*i,a.mixY+=(u-a.mixY)*i,a.mixScaleX+=(h-a.mixScaleX)*i,a.mixScaleY+=(p-a.mixScaleY)*i,a.mixShearY+=(d-a.mixShearY)*i}}class ha extends jo{constructor(t,e,n){super(t,e,"16|"+n),this.pathConstraintIndex=n}apply(t,e,n,r,i,s,o){let a=t.pathConstraints[this.pathConstraintIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case Eo.setup:return void(a.position=a.data.position);case Eo.first:a.position+=(a.data.position-a.position)*i}return}let l=this.getCurveValue(n);s==Eo.setup?a.position=a.data.position+(l-a.data.position)*i:a.position+=(l-a.position)*i}}class pa extends jo{constructor(t,e,n){super(t,e,"17|"+n),this.pathConstraintIndex=0,this.pathConstraintIndex=n}apply(t,e,n,r,i,s,o){let a=t.pathConstraints[this.pathConstraintIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case Eo.setup:return void(a.spacing=a.data.spacing);case Eo.first:a.spacing+=(a.data.spacing-a.spacing)*i}return}let l=this.getCurveValue(n);s==Eo.setup?a.spacing=a.data.spacing+(l-a.data.spacing)*i:a.spacing+=(l-a.spacing)*i}}class da extends zo{constructor(t,e,n){super(t,e,["18|"+n]),this.pathConstraintIndex=0,this.pathConstraintIndex=n}getFrameEntries(){return 4}setFrame(t,e,n,r,i){let s=this.frames;s[t<<=2]=e,s[t+1]=n,s[t+2]=r,s[t+3]=i}apply(t,e,n,r,i,s,o){let a=t.pathConstraints[this.pathConstraintIndex];if(!a.active)return;let l,c,u,h=this.frames;if(n<h[0]){switch(s){case Eo.setup:return a.mixRotate=a.data.mixRotate,a.mixX=a.data.mixX,void(a.mixY=a.data.mixY);case Eo.first:a.mixRotate+=(a.data.mixRotate-a.mixRotate)*i,a.mixX+=(a.data.mixX-a.mixX)*i,a.mixY+=(a.data.mixY-a.mixY)*i}return}let p=Uo.search(h,n,4),d=this.curves[p>>2];switch(d){case 0:let t=h[p];l=h[p+1],c=h[p+2],u=h[p+3];let e=(n-t)/(h[p+4]-t);l+=(h[p+4+1]-l)*e,c+=(h[p+4+2]-c)*e,u+=(h[p+4+3]-u)*e;break;case 1:l=h[p+1],c=h[p+2],u=h[p+3];break;default:l=this.getBezierValue(n,p,1,d-2),c=this.getBezierValue(n,p,2,d+18-2),u=this.getBezierValue(n,p,3,d+36-2)}if(s==Eo.setup){let t=a.data;a.mixRotate=t.mixRotate+(l-t.mixRotate)*i,a.mixX=t.mixX+(c-t.mixX)*i,a.mixY=t.mixY+(u-t.mixY)*i}else a.mixRotate+=(l-a.mixRotate)*i,a.mixX+=(c-a.mixX)*i,a.mixY+=(u-a.mixY)*i}}class fa{constructor(t){this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new _a(this),this.propertyIDs=new Co,this.animationsChanged=!1,this.trackEntryPool=new Io((()=>new ma)),this.data=t}static emptyAnimation(){return Ta||(Ta=new Do("<empty>",[],0)),Ta}update(t){t*=this.timeScale;let e=this.tracks;for(let n=0,r=e.length;n<r;n++){let r=e[n];if(!r)continue;r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;let i=t*r.timeScale;if(r.delay>0){if(r.delay-=i,r.delay>0)continue;i=-r.delay,r.delay=0}let s=r.next;if(s){let e=r.trackLast-s.delay;if(e>=0){for(s.delay=0,s.trackTime+=0==r.timeScale?0:(e/r.timeScale+t)*s.timeScale,r.trackTime+=i,this.setCurrent(n,s,!0);s.mixingFrom;)s.mixTime+=t,s=s.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&!r.mixingFrom){e[n]=null,this.queue.end(r),this.clearNext(r);continue}if(r.mixingFrom&&this.updateMixingFrom(r,t)){let t=r.mixingFrom;for(r.mixingFrom=null,t&&(t.mixingTo=null);t;)this.queue.end(t),t=t.mixingFrom}r.trackTime+=i}this.queue.drain()}updateMixingFrom(t,e){let n=t.mixingFrom;if(!n)return!0;let r=this.updateMixingFrom(n,e);return n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=n.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=n.mixingFrom,n.mixingFrom&&(n.mixingFrom.mixingTo=t),t.interruptAlpha=n.interruptAlpha,this.queue.end(n)),r):(n.trackTime+=e*n.timeScale,t.mixTime+=e,!1)}apply(t){if(!t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();let e=this.events,n=this.tracks,r=!1;for(let s=0,o=n.length;s<o;s++){let o=n[s];if(!o||o.delay>0)continue;r=!0;let a=0==s?Eo.first:o.mixBlend,l=o.alpha;o.mixingFrom?l*=this.applyMixingFrom(o,t,a):o.trackTime>=o.trackEnd&&!o.next&&(l=0);let c=o.animationLast,u=o.getAnimationTime(),h=u,p=e;o.reverse&&(h=o.animation.duration-h,p=null);let d=o.animation.timelines,f=d.length;if(0==s&&1==l||a==Eo.add)for(let e=0;e<f;e++){Po.webkit602BugfixHelper(l,a);var i=d[e];i instanceof sa?this.applyAttachmentTimeline(i,t,h,a,!0):i.apply(t,c,h,p,l,a,Ao.mixIn)}else{let e=o.timelineMode,n=o.timelinesRotation.length!=f<<1;n&&(o.timelinesRotation.length=f<<1);for(let r=0;r<f;r++){let i=d[r],s=e[r]==ya?a:Eo.setup;i instanceof Ho?this.applyRotateTimeline(i,t,h,l,s,o.timelinesRotation,r<<1,n):i instanceof sa?this.applyAttachmentTimeline(i,t,h,a,!0):(Po.webkit602BugfixHelper(l,a),i.apply(t,c,h,p,l,s,Ao.mixIn))}}this.queueEvents(o,u),e.length=0,o.nextAnimationLast=u,o.nextTrackLast=o.trackTime}for(var s=this.unkeyedState+Sa,o=t.slots,a=0,l=t.slots.length;a<l;a++){var c=o[a];if(c.attachmentState==s){var u=c.data.attachmentName;c.setAttachment(u?t.getAttachment(c.data.index,u):null)}}return this.unkeyedState+=2,this.queue.drain(),r}applyMixingFrom(t,e,n){let r=t.mixingFrom;r.mixingFrom&&this.applyMixingFrom(r,e,n);let i=0;0==t.mixDuration?(i=1,n==Eo.first&&(n=Eo.setup)):(i=t.mixTime/t.mixDuration,i>1&&(i=1),n!=Eo.first&&(n=r.mixBlend));let s=i<r.attachmentThreshold,o=i<r.drawOrderThreshold,a=r.animation.timelines,l=a.length,c=r.alpha*t.interruptAlpha,u=c*(1-i),h=r.animationLast,p=r.getAnimationTime(),d=p,f=null;if(r.reverse?d=r.animation.duration-d:i<r.eventThreshold&&(f=this.events),n==Eo.add)for(let t=0;t<l;t++)a[t].apply(e,h,d,f,u,n,Ao.mixOut);else{let t=r.timelineMode,i=r.timelineHoldMix,p=r.timelinesRotation.length!=l<<1;p&&(r.timelinesRotation.length=l<<1),r.totalAlpha=0;for(let m=0;m<l;m++){let l,_=a[m],g=Ao.mixOut,y=0;switch(t[m]){case ya:if(!o&&_ instanceof la)continue;l=n,y=u;break;case va:l=Eo.setup,y=u;break;case ba:l=n,y=c;break;case xa:l=Eo.setup,y=c;break;default:l=Eo.setup;let t=i[m];y=c*Math.max(0,1-t.mixTime/t.mixDuration)}r.totalAlpha+=y,_ instanceof Ho?this.applyRotateTimeline(_,e,d,y,l,r.timelinesRotation,m<<1,p):_ instanceof sa?this.applyAttachmentTimeline(_,e,d,l,s):(Po.webkit602BugfixHelper(y,n),o&&_ instanceof la&&l==Eo.setup&&(g=Ao.mixIn),_.apply(e,h,d,f,y,l,g))}}return t.mixDuration>0&&this.queueEvents(r,p),this.events.length=0,r.nextAnimationLast=p,r.nextTrackLast=r.trackTime,i}applyAttachmentTimeline(t,e,n,r,i){var s=e.slots[t.slotIndex];s.bone.active&&(n<t.frames[0]?r!=Eo.setup&&r!=Eo.first||this.setAttachment(e,s,s.data.attachmentName,i):this.setAttachment(e,s,t.attachmentNames[Uo.search1(t.frames,n)],i),s.attachmentState<=this.unkeyedState&&(s.attachmentState=this.unkeyedState+Sa))}setAttachment(t,e,n,r){e.setAttachment(n?t.getAttachment(e.data.index,n):null),r&&(e.attachmentState=this.unkeyedState+Ma)}applyRotateTimeline(t,e,n,r,i,s,o,a){if(a&&(s[o]=0),1==r)return void t.apply(e,0,n,null,1,i,Ao.mixIn);let l=e.bones[t.boneIndex];if(!l.active)return;let c=0,u=0;if(n<t.frames[0])switch(i){case Eo.setup:l.rotation=l.data.rotation;default:return;case Eo.first:c=l.rotation,u=l.data.rotation}else c=i==Eo.setup?l.data.rotation:l.rotation,u=l.data.rotation+t.getCurveValue(n);let h=0,p=u-c;if(p-=360*(16384-(16384.499999999996-p/360|0)),0==p)h=s[o];else{let t=0,e=0;a?(t=0,e=p):(t=s[o],e=s[o+1]);let n=p>0,r=t>=0;Lo.signum(e)!=Lo.signum(p)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*Lo.signum(t)),r=n),h=p+t-t%360,r!=n&&(h+=360*Lo.signum(t)),s[o]=h}s[o+1]=p,l.rotation=c+h*r}queueEvents(t,e){let n=t.animationStart,r=t.animationEnd,i=r-n,s=t.trackLast%i,o=this.events,a=0,l=o.length;for(;a<l;a++){let e=o[a];if(e.time<s)break;e.time>r||this.queue.event(t,e)}let c=!1;for(c=t.loop?0==i||s>t.trackTime%i:e>=r&&t.animationLast<r,c&&this.queue.complete(t);a<l;a++){let e=o[a];e.time<n||this.queue.event(t,e)}}clearTracks(){let t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let t=0,e=this.tracks.length;t<e;t++)this.clearTrack(t);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;let e=this.tracks[t];if(!e)return;this.queue.end(e),this.clearNext(e);let n=e;for(;;){let t=n.mixingFrom;if(!t)break;this.queue.end(t),n.mixingFrom=null,n.mixingTo=null,n=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,n){let r=this.expandToIndex(t);this.tracks[t]=e,e.previous=null,r&&(n&&this.queue.interrupt(r),e.mixingFrom=r,r.mixingTo=e,e.mixTime=0,r.mixingFrom&&r.mixDuration>0&&(e.interruptAlpha*=Math.min(1,r.mixTime/r.mixDuration)),r.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,n=!1){let r=this.data.skeletonData.findAnimation(e);if(!r)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,r,n)}setAnimationWith(t,e,n=!1){if(!e)throw new Error("animation cannot be null.");let r=!0,i=this.expandToIndex(t);i&&(-1==i.nextTrackLast?(this.tracks[t]=i.mixingFrom,this.queue.interrupt(i),this.queue.end(i),this.clearNext(i),i=i.mixingFrom,r=!1):this.clearNext(i));let s=this.trackEntry(t,e,n,i);return this.setCurrent(t,s,r),this.queue.drain(),s}addAnimation(t,e,n=!1,r=0){let i=this.data.skeletonData.findAnimation(e);if(!i)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,i,n,r)}addAnimationWith(t,e,n=!1,r=0){if(!e)throw new Error("animation cannot be null.");let i=this.expandToIndex(t);if(i)for(;i.next;)i=i.next;let s=this.trackEntry(t,e,n,i);return i?(i.next=s,s.previous=i,r<=0&&(r+=i.getTrackComplete()-s.mixDuration)):(this.setCurrent(t,s,!0),this.queue.drain()),s.delay=r,s}setEmptyAnimation(t,e=0){let n=this.setAnimationWith(t,fa.emptyAnimation(),!1);return n.mixDuration=e,n.trackEnd=e,n}addEmptyAnimation(t,e=0,n=0){let r=this.addAnimationWith(t,fa.emptyAnimation(),!1,n);return n<=0&&(r.delay+=r.mixDuration-e),r.mixDuration=e,r.trackEnd=e,r}setEmptyAnimations(t=0){let e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,n=this.tracks.length;e<n;e++){let n=this.tracks[e];n&&this.setEmptyAnimation(n.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(Po.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,n,r){let i=this.trackEntryPool.obtain();return i.trackIndex=t,i.animation=e,i.loop=n,i.holdPrevious=!1,i.eventThreshold=0,i.attachmentThreshold=0,i.drawOrderThreshold=0,i.animationStart=0,i.animationEnd=e.duration,i.animationLast=-1,i.nextAnimationLast=-1,i.delay=0,i.trackTime=0,i.trackLast=-1,i.nextTrackLast=-1,i.trackEnd=Number.MAX_VALUE,i.timeScale=1,i.alpha=1,i.interruptAlpha=1,i.mixTime=0,i.mixDuration=r?this.data.getMix(r.animation,e):0,i.mixBlend=Eo.replace,i}clearNext(t){let e=t.next;for(;e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();let t=this.tracks;for(let e=0,n=t.length;e<n;e++){let n=t[e];if(n){for(;n.mixingFrom;)n=n.mixingFrom;do{n.mixingTo&&n.mixBlend==Eo.add||this.computeHold(n),n=n.mixingTo}while(n)}}}computeHold(t){let e=t.mixingTo,n=t.animation.timelines,r=t.animation.timelines.length,i=t.timelineMode;i.length=r;let s=t.timelineHoldMix;s.length=0;let o=this.propertyIDs;if(e&&e.holdPrevious)for(let t=0;t<r;t++)i[t]=o.addAll(n[t].getPropertyIds())?xa:ba;else t:for(let a=0;a<r;a++){let r=n[a],l=r.getPropertyIds();if(o.addAll(l))if(!e||r instanceof sa||r instanceof la||r instanceof aa||!e.animation.hasTimeline(l))i[a]=va;else{for(let n=e.mixingTo;n;n=n.mixingTo)if(!n.animation.hasTimeline(l)){if(t.mixDuration>0){i[a]=wa,s[a]=n;continue t}break}i[a]=xa}else i[a]=ya}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(!t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){let e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}}class ma{constructor(){this.mixBlend=Eo.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.previous=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){let t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}getTrackComplete(){let t=this.animationEnd-this.animationStart;if(0!=t){if(this.loop)return t*(1+(this.trackTime/t|0));if(this.trackTime<t)return t}return this.trackTime}}class _a{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(ga.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(ga.interrupt),this.objects.push(t)}end(t){this.objects.push(ga.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(ga.dispose),this.objects.push(t)}complete(t){this.objects.push(ga.complete),this.objects.push(t)}event(t,e){this.objects.push(ga.event),this.objects.push(t),this.objects.push(e)}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;let t=this.objects,e=this.animState.listeners;for(let n=0;n<t.length;n+=2){let r=t[n],i=t[n+1];switch(r){case ga.start:i.listener&&i.listener.start&&i.listener.start(i);for(let t=0;t<e.length;t++)e[t].start&&e[t].start(i);break;case ga.interrupt:i.listener&&i.listener.interrupt&&i.listener.interrupt(i);for(let t=0;t<e.length;t++)e[t].interrupt&&e[t].interrupt(i);break;case ga.end:i.listener&&i.listener.end&&i.listener.end(i);for(let t=0;t<e.length;t++)e[t].end&&e[t].end(i);case ga.dispose:i.listener&&i.listener.dispose&&i.listener.dispose(i);for(let t=0;t<e.length;t++)e[t].dispose&&e[t].dispose(i);this.animState.trackEntryPool.free(i);break;case ga.complete:i.listener&&i.listener.complete&&i.listener.complete(i);for(let t=0;t<e.length;t++)e[t].complete&&e[t].complete(i);break;case ga.event:let r=t[2+n++];i.listener&&i.listener.event&&i.listener.event(i,r);for(let t=0;t<e.length;t++)e[t].event&&e[t].event(i,r)}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}}var ga;!function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(ga||(ga={}));const ya=0,va=1,ba=2,xa=3,wa=4,Sa=1,Ma=2;let Ta=null;class Ea{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,!t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,n){let r=this.skeletonData.findAnimation(t);if(!r)throw new Error("Animation not found: "+t);let i=this.skeletonData.findAnimation(e);if(!i)throw new Error("Animation not found: "+e);this.setMixWith(r,i,n)}setMixWith(t,e,n){if(!t)throw new Error("from cannot be null.");if(!e)throw new Error("to cannot be null.");let r=t.name+"."+e.name;this.animationToMixTime[r]=n}getMix(t,e){let n=t.name+"."+e.name,r=this.animationToMixTime[n];return void 0===r?this.defaultMix:r}}class Aa extends ko{constructor(t){super(t),this.color=new Bo(1,1,1,1)}copy(){let t=new Aa(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}}class $a extends ko{constructor(t){super(t),this.color=new Bo(.2275,.2275,.8078,1)}copy(){let t=new $a(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}class Ca{constructor(t){this._image=t}getImage(){return this._image}}var Ba,La,Ra,Na,Pa,Ia,Oa,Fa,ka,Da,Ua;!function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(Ba||(Ba={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(La||(La={}));class za{constructor(){this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.degrees=0,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0}}class ja{constructor(t){this.pages=new Array,this.regions=new Array;let e=new Ga(t),n=new Array(4),r=null,i=null,s={size:()=>{r.width=parseInt(n[1]),r.height=parseInt(n[2])},format:()=>{},filter:()=>{r.minFilter=Po.enumValue(Ba,n[1]),r.magFilter=Po.enumValue(Ba,n[2])},repeat:()=>{-1!=n[1].indexOf("x")&&(r.uWrap=La.Repeat),-1!=n[1].indexOf("y")&&(r.vWrap=La.Repeat)},pma:()=>{r.pma="true"==n[1]}};var o={xy:()=>{i.x=parseInt(n[1]),i.y=parseInt(n[2])},size:()=>{i.width=parseInt(n[1]),i.height=parseInt(n[2])},bounds:()=>{i.x=parseInt(n[1]),i.y=parseInt(n[2]),i.width=parseInt(n[3]),i.height=parseInt(n[4])},offset:()=>{i.offsetX=parseInt(n[1]),i.offsetY=parseInt(n[2])},orig:()=>{i.originalWidth=parseInt(n[1]),i.originalHeight=parseInt(n[2])},offsets:()=>{i.offsetX=parseInt(n[1]),i.offsetY=parseInt(n[2]),i.originalWidth=parseInt(n[3]),i.originalHeight=parseInt(n[4])},rotate:()=>{let t=n[1];"true"==t?i.degrees=90:"false"!=t&&(i.degrees=parseInt(t))},index:()=>{i.index=parseInt(n[1])}};let a=e.readLine();for(;a&&0==a.trim().length;)a=e.readLine();for(;a&&0!=a.trim().length&&0!=e.readEntry(n,a);)a=e.readLine();let l=null,c=null;for(;null!==a;)if(0==a.trim().length)r=null,a=e.readLine();else if(r){for(i=new Va,i.page=r,i.name=a;;){let t=e.readEntry(n,a=e.readLine());if(0==t)break;let r=o[n[0]];if(r)r();else{l||(l=[],c=[]),l.push(n[0]);let e=[];for(let r=0;r<t;r++)e.push(parseInt(n[r+1]));c.push(e)}}0==i.originalWidth&&0==i.originalHeight&&(i.originalWidth=i.width,i.originalHeight=i.height),l&&l.length>0&&(i.names=l,i.values=c,l=null,c=null),i.u=i.x/r.width,i.v=i.y/r.height,90==i.degrees?(i.u2=(i.x+i.height)/r.width,i.v2=(i.y+i.width)/r.height):(i.u2=(i.x+i.width)/r.width,i.v2=(i.y+i.height)/r.height),this.regions.push(i)}else{for(r=new Ha,r.name=a.trim();0!=e.readEntry(n,a=e.readLine());){let t=s[n[0]];t&&t()}this.pages.push(r)}}findRegion(t){for(let e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null}setTextures(t,e=""){for(let n of this.pages)n.setTexture(t.get(e+n.name))}dispose(){for(let t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()}}class Ga{constructor(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}readLine(){return this.index>=this.lines.length?null:this.lines[this.index++]}readEntry(t,e){if(!e)return 0;if(0==(e=e.trim()).length)return 0;let n=e.indexOf(":");if(-1==n)return 0;t[0]=e.substr(0,n).trim();for(let r=1,i=n+1;;r++){let n=e.indexOf(",",i);if(-1==n)return t[r]=e.substr(i).trim(),r;if(t[r]=e.substr(i,n-i).trim(),i=n+1,4==r)return 4}}}class Ha{constructor(){this.minFilter=Ba.Nearest,this.magFilter=Ba.Nearest,this.uWrap=La.ClampToEdge,this.vWrap=La.ClampToEdge}setTexture(t){this.texture=t,t.setFilters(this.minFilter,this.magFilter),t.setWraps(this.uWrap,this.vWrap)}}class Va extends za{}class Wa extends ko{constructor(t){super(t),this.color=new Bo(1,1,1,1),this.tempColor=new Bo(0,0,0,0)}updateUVs(){let t=this.regionUVs;this.uvs&&this.uvs.length==t.length||(this.uvs=Po.newFloatArray(t.length));let e=this.uvs,n=this.uvs.length,r=this.region.u,i=this.region.v,s=0,o=0;if(this.region instanceof Va){let a=this.region,l=a.page.texture.getImage(),c=l.width,u=l.height;switch(a.degrees){case 90:r-=(a.originalHeight-a.offsetY-a.height)/c,i-=(a.originalWidth-a.offsetX-a.width)/u,s=a.originalHeight/c,o=a.originalWidth/u;for(let a=0;a<n;a+=2)e[a]=r+t[a+1]*s,e[a+1]=i+(1-t[a])*o;return;case 180:r-=(a.originalWidth-a.offsetX-a.width)/c,i-=a.offsetY/u,s=a.originalWidth/c,o=a.originalHeight/u;for(let a=0;a<n;a+=2)e[a]=r+(1-t[a])*s,e[a+1]=i+(1-t[a+1])*o;return;case 270:r-=a.offsetY/c,i-=a.offsetX/u,s=a.originalHeight/c,o=a.originalWidth/u;for(let a=0;a<n;a+=2)e[a]=r+(1-t[a+1])*s,e[a+1]=i+t[a]*o;return}r-=a.offsetX/c,i-=(a.originalHeight-a.offsetY-a.height)/u,s=a.originalWidth/c,o=a.originalHeight/u}else this.region?(s=this.region.u2-r,o=this.region.v2-i):(r=i=0,s=o=1);for(let a=0;a<n;a+=2)e[a]=r+t[a]*s,e[a+1]=i+t[a+1]*o}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(this.parentMesh)return this.newLinkedMesh();let t=new Wa(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Array(this.regionUVs.length),Po.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.uvs=new Array(this.uvs.length),Po.arrayCopy(this.uvs,0,t.uvs,0,this.uvs.length),t.triangles=new Array(this.triangles.length),Po.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,this.edges&&(t.edges=new Array(this.edges.length),Po.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}newLinkedMesh(){let t=new Wa(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(this.parentMesh?this.parentMesh:this),t.updateUVs(),t}}class qa extends ko{constructor(t){super(t),this.closed=!1,this.constantSpeed=!1,this.color=new Bo(1,1,1,1)}copy(){let t=new qa(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),Po.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}class Xa extends ko{constructor(t){super(t),this.color=new Bo(.38,.94,0,1)}computeWorldPosition(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e}computeWorldRotation(t){let e=Lo.cosDeg(this.rotation),n=Lo.sinDeg(this.rotation),r=e*t.a+n*t.b,i=e*t.c+n*t.d;return Math.atan2(i,r)*Lo.radDeg}copy(){let t=new Xa(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}class Ya extends Fo{constructor(t){super(t),this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new Bo(1,1,1,1),this.offset=Po.newFloatArray(8),this.uvs=Po.newFloatArray(8),this.tempColor=new Bo(1,1,1,1)}updateOffset(){this.region;let t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.region.offsetX*t,r=-this.height/2*this.scaleY+this.region.offsetY*e,i=n+this.region.width*t,s=r+this.region.height*e,o=this.rotation*Math.PI/180,a=Math.cos(o),l=Math.sin(o),c=this.x,u=this.y,h=n*a+c,p=n*l,d=r*a+u,f=r*l,m=i*a+c,_=i*l,g=s*a+u,y=s*l,v=this.offset;v[0]=h-f,v[1]=d+p,v[2]=h-y,v[3]=g+p,v[4]=m-y,v[5]=g+_,v[6]=m-f,v[7]=d+_}setRegion(t){this.region=t;let e=this.uvs;90==t.degrees?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}computeWorldVertices(t,e,n,r){let i=this.offset,s=t.worldX,o=t.worldY,a=t.a,l=t.b,c=t.c,u=t.d,h=0,p=0;h=i[0],p=i[1],e[n]=h*a+p*l+s,e[n+1]=h*c+p*u+o,n+=r,h=i[2],p=i[3],e[n]=h*a+p*l+s,e[n+1]=h*c+p*u+o,n+=r,h=i[4],p=i[5],e[n]=h*a+p*l+s,e[n+1]=h*c+p*u+o,n+=r,h=i[6],p=i[7],e[n]=h*a+p*l+s,e[n+1]=h*c+p*u+o}copy(){let t=new Ya(this.name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,Po.arrayCopy(this.uvs,0,t.uvs,0,8),Po.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t}}Ya.X1=0,Ya.Y1=1,Ya.C1R=2,Ya.C1G=3,Ya.C1B=4,Ya.C1A=5,Ya.U1=6,Ya.V1=7,Ya.X2=8,Ya.Y2=9,Ya.C2R=10,Ya.C2G=11,Ya.C2B=12,Ya.C2A=13,Ya.U2=14,Ya.V2=15,Ya.X3=16,Ya.Y3=17,Ya.C3R=18,Ya.C3G=19,Ya.C3B=20,Ya.C3A=21,Ya.U3=22,Ya.V3=23,Ya.X4=24,Ya.Y4=25,Ya.C4R=26,Ya.C4G=27,Ya.C4B=28,Ya.C4A=29,Ya.U4=30,Ya.V4=31;class Ja{constructor(t){this.atlas=t}newRegionAttachment(t,e,n){let r=this.atlas.findRegion(n);if(!r)throw new Error("Region not found in atlas: "+n+" (region attachment: "+e+")");r.renderObject=r;let i=new Ya(e);return i.setRegion(r),i}newMeshAttachment(t,e,n){let r=this.atlas.findRegion(n);if(!r)throw new Error("Region not found in atlas: "+n+" (mesh attachment: "+e+")");r.renderObject=r;let i=new Wa(e);return i.region=r,i}newBoundingBoxAttachment(t,e){return new Aa(e)}newPathAttachment(t,e){return new qa(e)}newPointAttachment(t,e){return new Xa(e)}newClippingAttachment(t,e){return new $a(e)}}class Za{constructor(t,e,n){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=Ra.Normal,this.skinRequired=!1,this.color=new Bo,t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=n}}!function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(Ra||(Ra={}));class Qa{constructor(t,e,n){if(this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=n,this.setToSetupPose()}isActive(){return this.active}update(){this.updateWorldTransformWith(this.ax,this.ay,this.arotation,this.ascaleX,this.ascaleY,this.ashearX,this.ashearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,n,r,i,s,o){this.ax=t,this.ay=e,this.arotation=n,this.ascaleX=r,this.ascaleY=i,this.ashearX=s,this.ashearY=o;let a=this.parent;if(!a){let a=this.skeleton,l=n+90+o,c=a.scaleX,u=a.scaleY;return this.a=Lo.cosDeg(n+s)*r*c,this.b=Lo.cosDeg(l)*i*c,this.c=Lo.sinDeg(n+s)*r*u,this.d=Lo.sinDeg(l)*i*u,this.worldX=t*c+a.x,void(this.worldY=e*u+a.y)}let l=a.a,c=a.b,u=a.c,h=a.d;switch(this.worldX=l*t+c*e+a.worldX,this.worldY=u*t+h*e+a.worldY,this.data.transformMode){case Ra.Normal:{let t=n+90+o,e=Lo.cosDeg(n+s)*r,a=Lo.cosDeg(t)*i,p=Lo.sinDeg(n+s)*r,d=Lo.sinDeg(t)*i;return this.a=l*e+c*p,this.b=l*a+c*d,this.c=u*e+h*p,void(this.d=u*a+h*d)}case Ra.OnlyTranslation:{let t=n+90+o;this.a=Lo.cosDeg(n+s)*r,this.b=Lo.cosDeg(t)*i,this.c=Lo.sinDeg(n+s)*r,this.d=Lo.sinDeg(t)*i;break}case Ra.NoRotationOrReflection:{let t=l*l+u*u,e=0;t>1e-4?(t=Math.abs(l*h-c*u)/t,l/=this.skeleton.scaleX,u/=this.skeleton.scaleY,c=u*t,h=l*t,e=Math.atan2(u,l)*Lo.radDeg):(l=0,u=0,e=90-Math.atan2(h,c)*Lo.radDeg);let a=n+s-e,p=n+o-e+90,d=Lo.cosDeg(a)*r,f=Lo.cosDeg(p)*i,m=Lo.sinDeg(a)*r,_=Lo.sinDeg(p)*i;this.a=l*d-c*m,this.b=l*f-c*_,this.c=u*d+h*m,this.d=u*f+h*_;break}case Ra.NoScale:case Ra.NoScaleOrReflection:{let t=Lo.cosDeg(n),e=Lo.sinDeg(n),a=(l*t+c*e)/this.skeleton.scaleX,p=(u*t+h*e)/this.skeleton.scaleY,d=Math.sqrt(a*a+p*p);d>1e-5&&(d=1/d),a*=d,p*=d,d=Math.sqrt(a*a+p*p),this.data.transformMode==Ra.NoScale&&l*h-c*u<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(d=-d);let f=Math.PI/2+Math.atan2(p,a),m=Math.cos(f)*d,_=Math.sin(f)*d,g=Lo.cosDeg(s)*r,y=Lo.cosDeg(90+o)*i,v=Lo.sinDeg(s)*r,b=Lo.sinDeg(90+o)*i;this.a=a*g+m*v,this.b=a*y+m*b,this.c=p*g+_*v,this.d=p*y+_*b;break}}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY}setToSetupPose(){let t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.c,this.a)*Lo.radDeg}getWorldRotationY(){return Math.atan2(this.d,this.b)*Lo.radDeg}getWorldScaleX(){return Math.sqrt(this.a*this.a+this.c*this.c)}getWorldScaleY(){return Math.sqrt(this.b*this.b+this.d*this.d)}updateAppliedTransform(){let t=this.parent;if(!t)return this.ax=this.worldX-this.skeleton.x,this.ay=this.worldY-this.skeleton.y,this.arotation=Math.atan2(this.c,this.a)*Lo.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*Lo.radDeg);let e=t.a,n=t.b,r=t.c,i=t.d,s=1/(e*i-n*r),o=this.worldX-t.worldX,a=this.worldY-t.worldY;this.ax=o*i*s-a*n*s,this.ay=a*e*s-o*r*s;let l=s*i,c=s*e,u=s*n,h=s*r,p=l*this.a-u*this.c,d=l*this.b-u*this.d,f=c*this.c-h*this.a,m=c*this.d-h*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(p*p+f*f),this.ascaleX>1e-4){let t=p*m-d*f;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(p*d+f*m,t)*Lo.radDeg,this.arotation=Math.atan2(f,p)*Lo.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(d*d+m*m),this.ashearY=0,this.arotation=90-Math.atan2(m,d)*Lo.radDeg}worldToLocal(t){let e=1/(this.a*this.d-this.b*this.c),n=t.x-this.worldX,r=t.y-this.worldY;return t.x=n*this.d*e-r*this.b*e,t.y=r*this.a*e-n*this.c*e,t}localToWorld(t){let e=t.x,n=t.y;return t.x=e*this.a+n*this.b+this.worldX,t.y=e*this.c+n*this.d+this.worldY,t}worldToLocalRotation(t){let e=Lo.sinDeg(t),n=Lo.cosDeg(t);return Math.atan2(this.a*e-this.c*n,this.d*n-this.b*e)*Lo.radDeg+this.rotation-this.shearX}localToWorldRotation(t){t-=this.rotation-this.shearX;let e=Lo.sinDeg(t),n=Lo.cosDeg(t);return Math.atan2(n*this.c+e*this.d,n*this.a+e*this.b)*Lo.radDeg}rotateWorld(t){let e=this.a,n=this.b,r=this.c,i=this.d,s=Lo.cosDeg(t),o=Lo.sinDeg(t);this.a=s*e-o*r,this.b=s*n-o*i,this.c=o*e+s*r,this.d=o*n+s*i}}class Ka{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let n=0;n<t.bones.length;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)}isActive(){return this.active}update(){if(0==this.mix)return;let t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.data.uniform,this.softness,this.mix)}}apply1(t,e,n,r,i,s,o){let a=t.parent,l=a.a,c=a.b,u=a.c,h=a.d,p=-t.ashearX-t.arotation,d=0,f=0;switch(t.data.transformMode){case Ra.OnlyTranslation:d=e-t.worldX,f=n-t.worldY;break;case Ra.NoRotationOrReflection:let r=Math.abs(l*h-c*u)/(l*l+u*u),i=l/t.skeleton.scaleX,s=u/t.skeleton.scaleY;c=-s*r*t.skeleton.scaleX,h=i*r*t.skeleton.scaleY,p+=Math.atan2(s,i)*Lo.radDeg;default:let o=e-a.worldX,m=n-a.worldY,_=l*h-c*u;d=(o*h-m*c)/_-t.ax,f=(m*l-o*u)/_-t.ay}p+=Math.atan2(f,d)*Lo.radDeg,t.ascaleX<0&&(p+=180),p>180?p-=360:p<-180&&(p+=360);let m=t.ascaleX,_=t.ascaleY;if(r||i){switch(t.data.transformMode){case Ra.NoScale:case Ra.NoScaleOrReflection:d=e-t.worldX,f=n-t.worldY}let a=t.data.length*m,l=Math.sqrt(d*d+f*f);if(r&&l<a||i&&l>a&&a>1e-4){let t=(l/a-1)*o+1;m*=t,s&&(_*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+p*o,m,_,t.ashearX,t.ashearY)}apply2(t,e,n,r,i,s,o,a,l){let c=t.ax,u=t.ay,h=t.ascaleX,p=t.ascaleY,d=h,f=p,m=e.ascaleX,_=0,g=0,y=0;h<0?(h=-h,_=180,y=-1):(_=0,y=1),p<0&&(p=-p,y=-y),m<0?(m=-m,g=180):g=0;let v=e.ax,b=0,x=0,w=0,S=t.a,M=t.b,T=t.c,E=t.d,A=Math.abs(h-p)<=1e-4;!A||s?(b=0,x=S*v+t.worldX,w=T*v+t.worldY):(b=e.ay,x=S*v+M*b+t.worldX,w=T*v+E*b+t.worldY);let $=t.parent;S=$.a,M=$.b,T=$.c,E=$.d;let C,B,L=1/(S*E-M*T),R=x-$.worldX,N=w-$.worldY,P=(R*E-N*M)*L-c,I=(N*S-R*T)*L-u,O=Math.sqrt(P*P+I*I),F=e.data.length*m;if(O<1e-4)return this.apply1(t,n,r,!1,s,!1,l),void e.updateWorldTransformWith(v,b,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);R=n-$.worldX,N=r-$.worldY;let k=(R*E-N*M)*L-c,D=(N*S-R*T)*L-u,U=k*k+D*D;if(0!=a){a*=h*(m+1)*.5;let t=Math.sqrt(U),e=t-O-F*h+a;if(e>0){let n=Math.min(1,e/(2*a))-1;n=(e-a*(1-n*n))/t,k-=n*k,D-=n*D,U=k*k+D*D}}t:if(A){F*=h;let t=(U-O*O-F*F)/(2*O*F);t<-1?(t=-1,B=Math.PI*i):t>1?(t=1,B=0,s&&(S=(Math.sqrt(U)/(O+F)-1)*l+1,d*=S,o&&(f*=S))):B=Math.acos(t)*i,S=O+F*t,M=F*Math.sin(B),C=Math.atan2(D*S-k*M,k*S+D*M)}else{S=h*F,M=p*F;let t=S*S,e=M*M,n=Math.atan2(D,k);T=e*O*O+t*U-t*e;let r=-2*e*O,s=e-t;if(E=r*r-4*s*T,E>=0){let t=Math.sqrt(E);r<0&&(t=-t),t=.5*-(r+t);let e=t/s,o=T/t,a=Math.abs(e)<Math.abs(o)?e:o;if(a*a<=U){N=Math.sqrt(U-a*a)*i,C=n-Math.atan2(N,a),B=Math.atan2(N/p,(a-O)/h);break t}}let o=Lo.PI,a=O-S,l=a*a,c=0,u=0,d=O+S,f=d*d,m=0;T=-S*O/(t-e),T>=-1&&T<=1&&(T=Math.acos(T),R=S*Math.cos(T)+O,N=M*Math.sin(T),E=R*R+N*N,E<l&&(o=T,l=E,a=R,c=N),E>f&&(u=T,f=E,d=R,m=N)),U<=.5*(l+f)?(C=n-Math.atan2(c*i,a),B=o*i):(C=n-Math.atan2(m*i,d),B=u*i)}let z=Math.atan2(b,v)*y,j=t.arotation;C=(C-z)*Lo.radDeg+_-j,C>180?C-=360:C<-180&&(C+=360),t.updateWorldTransformWith(c,u,j+C*l,d,f,0,0),j=e.arotation,B=((B+z)*Lo.radDeg-e.ashearX)*y+g-j,B>180?B-=360:B<-180&&(B+=360),e.updateWorldTransformWith(v,b,j+B*l,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}}class tl{constructor(t,e,n){this.name=t,this.order=e,this.skinRequired=n}}class el extends tl{constructor(t){super(t,0,!1),this.bones=new Array,this.mixRotate=0,this.mixX=0,this.mixY=0}}(Da=Na||(Na={}))[Da.Fixed=0]="Fixed",Da[Da.Percent=1]="Percent",(ka=Pa||(Pa={}))[ka.Length=0]="Length",ka[ka.Fixed=1]="Fixed",ka[ka.Percent=2]="Percent",ka[ka.Proportional=3]="Proportional",function(t){t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale"}(Ia||(Ia={}));class nl{constructor(t,e){if(this.position=0,this.spacing=0,this.mixRotate=0,this.mixX=0,this.mixY=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let n=0,r=t.bones.length;n<r;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY}isActive(){return this.active}update(){let t=this.target.getAttachment();if(!(t instanceof qa))return;let e=this.mixRotate,n=this.mixX,r=this.mixY;if(0==e&&0==n&&0==r)return;let i=this.data,s=i.rotateMode==Ia.Tangent,o=i.rotateMode==Ia.ChainScale,a=this.bones,l=a.length,c=s?l:l+1,u=Po.setArraySize(this.spaces,c),h=o?this.lengths=Po.setArraySize(this.lengths,l):null,p=this.spacing;switch(i.spacingMode){case Pa.Percent:if(o)for(let t=0,e=c-1;t<e;t++){let e=a[t],n=e.data.length;if(n<nl.epsilon)h[t]=0;else{let r=n*e.a,i=n*e.c;h[t]=Math.sqrt(r*r+i*i)}}Po.arrayFill(u,1,c,p);break;case Pa.Proportional:let t=0;for(let e=0,n=c-1;e<n;){let n=a[e],r=n.data.length;if(r<nl.epsilon)o&&(h[e]=0),u[++e]=p;else{let i=r*n.a,s=r*n.c,a=Math.sqrt(i*i+s*s);o&&(h[e]=a),u[++e]=a,t+=a}}if(t>0){t=c/t*p;for(let e=1;e<c;e++)u[e]*=t}break;default:let e=i.spacingMode==Pa.Length;for(let t=0,n=c-1;t<n;){let n=a[t],r=n.data.length;if(r<nl.epsilon)o&&(h[t]=0),u[++t]=p;else{let i=r*n.a,s=r*n.c,a=Math.sqrt(i*i+s*s);o&&(h[t]=a),u[++t]=(e?r+p:p)*a/r}}}let d=this.computeWorldPositions(t,c,s),f=d[0],m=d[1],_=i.offsetRotation,g=!1;if(0==_)g=i.rotateMode==Ia.Chain;else{g=!1;let t=this.target.bone;_*=t.a*t.d-t.b*t.c>0?Lo.degRad:-Lo.degRad}for(let t=0,i=3;t<l;t++,i+=3){let l=a[t];l.worldX+=(f-l.worldX)*n,l.worldY+=(m-l.worldY)*r;let c=d[i],p=d[i+1],y=c-f,v=p-m;if(o){let n=h[t];if(0!=n){let t=(Math.sqrt(y*y+v*v)/n-1)*e+1;l.a*=t,l.c*=t}}if(f=c,m=p,e>0){let n=l.a,r=l.b,o=l.c,a=l.d,c=0,h=0,p=0;if(c=s?d[i-1]:0==u[t+1]?d[i+2]:Math.atan2(v,y),c-=Math.atan2(o,n),g){h=Math.cos(c),p=Math.sin(c);let t=l.data.length;f+=(t*(h*n-p*o)-y)*e,m+=(t*(p*n+h*o)-v)*e}else c+=_;c>Lo.PI?c-=Lo.PI2:c<-Lo.PI&&(c+=Lo.PI2),c*=e,h=Math.cos(c),p=Math.sin(c),l.a=h*n-p*o,l.b=h*r-p*a,l.c=p*n+h*o,l.d=p*r+h*a}l.updateAppliedTransform()}}computeWorldPositions(t,e,n){let r=this.target,i=this.position,s=this.spaces,o=Po.setArraySize(this.positions,3*e+2),a=null,l=t.closed,c=t.worldVerticesLength,u=c/6,h=nl.NONE;if(!t.constantSpeed){let p=t.lengths;u-=l?1:2;let d,f=p[u];switch(this.data.positionMode==Na.Percent&&(i*=f),this.data.spacingMode){case Pa.Percent:d=f;break;case Pa.Proportional:d=f/e;break;default:d=1}a=Po.setArraySize(this.world,8);for(let m=0,_=0,g=0;m<e;m++,_+=3){let e=s[m]*d;i+=e;let y=i;if(l)y%=f,y<0&&(y+=f),g=0;else{if(y<0){h!=nl.BEFORE&&(h=nl.BEFORE,t.computeWorldVertices(r,2,4,a,0,2)),this.addBeforePosition(y,a,0,o,_);continue}if(y>f){h!=nl.AFTER&&(h=nl.AFTER,t.computeWorldVertices(r,c-6,4,a,0,2)),this.addAfterPosition(y-f,a,0,o,_);continue}}for(;;g++){let t=p[g];if(!(y>t)){if(0==g)y/=t;else{let e=p[g-1];y=(y-e)/(t-e)}break}}g!=h&&(h=g,l&&g==u?(t.computeWorldVertices(r,c-4,4,a,0,2),t.computeWorldVertices(r,0,4,a,4,2)):t.computeWorldVertices(r,6*g+2,8,a,0,2)),this.addCurvePosition(y,a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],o,_,n||m>0&&0==e)}return o}l?(c+=2,a=Po.setArraySize(this.world,c),t.computeWorldVertices(r,2,c-4,a,0,2),t.computeWorldVertices(r,0,2,a,c-4,2),a[c-2]=a[0],a[c-1]=a[1]):(u--,c-=4,a=Po.setArraySize(this.world,c),t.computeWorldVertices(r,2,c,a,0,2));let p,d=Po.setArraySize(this.curves,u),f=0,m=a[0],_=a[1],g=0,y=0,v=0,b=0,x=0,w=0,S=0,M=0,T=0,E=0,A=0,$=0,C=0,B=0;for(let t=0,e=2;t<u;t++,e+=6)g=a[e],y=a[e+1],v=a[e+2],b=a[e+3],x=a[e+4],w=a[e+5],S=.1875*(m-2*g+v),M=.1875*(_-2*y+b),T=.09375*(3*(g-v)-m+x),E=.09375*(3*(y-b)-_+w),A=2*S+T,$=2*M+E,C=.75*(g-m)+S+.16666667*T,B=.75*(y-_)+M+.16666667*E,f+=Math.sqrt(C*C+B*B),C+=A,B+=$,A+=T,$+=E,f+=Math.sqrt(C*C+B*B),C+=A,B+=$,f+=Math.sqrt(C*C+B*B),C+=A+T,B+=$+E,f+=Math.sqrt(C*C+B*B),d[t]=f,m=x,_=w;switch(this.data.positionMode==Na.Percent&&(i*=f),this.data.spacingMode){case Pa.Percent:p=f;break;case Pa.Proportional:p=f/e;break;default:p=1}let L=this.segments,R=0;for(let t=0,r=0,u=0,N=0;t<e;t++,r+=3){let e=s[t]*p;i+=e;let P=i;if(l)P%=f,P<0&&(P+=f),u=0;else{if(P<0){this.addBeforePosition(P,a,0,o,r);continue}if(P>f){this.addAfterPosition(P-f,a,c-4,o,r);continue}}for(;;u++){let t=d[u];if(!(P>t)){if(0==u)P/=t;else{let e=d[u-1];P=(P-e)/(t-e)}break}}if(u!=h){h=u;let t=6*u;for(m=a[t],_=a[t+1],g=a[t+2],y=a[t+3],v=a[t+4],b=a[t+5],x=a[t+6],w=a[t+7],S=.03*(m-2*g+v),M=.03*(_-2*y+b),T=.006*(3*(g-v)-m+x),E=.006*(3*(y-b)-_+w),A=2*S+T,$=2*M+E,C=.3*(g-m)+S+.16666667*T,B=.3*(y-_)+M+.16666667*E,R=Math.sqrt(C*C+B*B),L[0]=R,t=1;t<8;t++)C+=A,B+=$,A+=T,$+=E,R+=Math.sqrt(C*C+B*B),L[t]=R;C+=A,B+=$,R+=Math.sqrt(C*C+B*B),L[8]=R,C+=A+T,B+=$+E,R+=Math.sqrt(C*C+B*B),L[9]=R,N=0}for(P*=R;;N++){let t=L[N];if(!(P>t)){if(0==N)P/=t;else{let e=L[N-1];P=N+(P-e)/(t-e)}break}}this.addCurvePosition(.1*P,m,_,g,y,v,b,x,w,o,r,n||t>0&&0==e)}return o}addBeforePosition(t,e,n,r,i){let s=e[n],o=e[n+1],a=e[n+2]-s,l=e[n+3]-o,c=Math.atan2(l,a);r[i]=s+t*Math.cos(c),r[i+1]=o+t*Math.sin(c),r[i+2]=c}addAfterPosition(t,e,n,r,i){let s=e[n+2],o=e[n+3],a=s-e[n],l=o-e[n+1],c=Math.atan2(l,a);r[i]=s+t*Math.cos(c),r[i+1]=o+t*Math.sin(c),r[i+2]=c}addCurvePosition(t,e,n,r,i,s,o,a,l,c,u,h){if(0==t||isNaN(t))return c[u]=e,c[u+1]=n,void(c[u+2]=Math.atan2(i-n,r-e));let p=t*t,d=p*t,f=1-t,m=f*f,_=m*f,g=f*t,y=3*g,v=f*y,b=y*t,x=e*_+r*v+s*b+a*d,w=n*_+i*v+o*b+l*d;c[u]=x,c[u+1]=w,h&&(c[u+2]=t<.001?Math.atan2(i-n,r-e):Math.atan2(w-(n*m+i*g*2+o*p),x-(e*m+r*g*2+s*p)))}}nl.NONE=-1,nl.BEFORE=-2,nl.AFTER=-3,nl.epsilon=1e-5;class rl{constructor(t,e){if(this.deform=new Array,!t)throw new Error("data cannot be null.");if(!e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new Bo,this.darkColor=t.darkColor?new Bo:null,this.setToSetupPose()}getSkeleton(){return this.bone.skeleton}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(t instanceof ko&&this.attachment instanceof ko&&t.deformAttachment==this.attachment.deformAttachment||(this.deform.length=0),this.attachment=t,this.attachmentTime=this.bone.skeleton.time)}setAttachmentTime(t){this.attachmentTime=this.bone.skeleton.time-t}getAttachmentTime(){return this.bone.skeleton.time-this.attachmentTime}setToSetupPose(){this.color.setFromColor(this.data.color),this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),this.data.attachmentName?(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName))):this.attachment=null}}class il{constructor(t,e){if(this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.temp=new Oo,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY,this.mixScaleX=t.mixScaleX,this.mixScaleY=t.mixScaleY,this.mixShearY=t.mixShearY,this.bones=new Array;for(let n=0;n<t.bones.length;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)}isActive(){return this.active}update(){0==this.mixRotate&&0==this.mixX&&0==this.mixY&&0==this.mixScaleX&&0==this.mixScaleX&&0==this.mixShearY||(this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld())}applyAbsoluteWorld(){let t=this.mixRotate,e=this.mixX,n=this.mixY,r=this.mixScaleX,i=this.mixScaleY,s=this.mixShearY,o=0!=e||0!=n,a=this.target,l=a.a,c=a.b,u=a.c,h=a.d,p=l*h-c*u>0?Lo.degRad:-Lo.degRad,d=this.data.offsetRotation*p,f=this.data.offsetShearY*p,m=this.bones;for(let p=0,_=m.length;p<_;p++){let _=m[p];if(0!=t){let e=_.a,n=_.b,r=_.c,i=_.d,s=Math.atan2(u,l)-Math.atan2(r,e)+d;s>Lo.PI?s-=Lo.PI2:s<-Lo.PI&&(s+=Lo.PI2),s*=t;let o=Math.cos(s),a=Math.sin(s);_.a=o*e-a*r,_.b=o*n-a*i,_.c=a*e+o*r,_.d=a*n+o*i}if(o){let t=this.temp;a.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),_.worldX+=(t.x-_.worldX)*e,_.worldY+=(t.y-_.worldY)*n}if(0!=r){let t=Math.sqrt(_.a*_.a+_.c*_.c);0!=t&&(t=(t+(Math.sqrt(l*l+u*u)-t+this.data.offsetScaleX)*r)/t),_.a*=t,_.c*=t}if(0!=i){let t=Math.sqrt(_.b*_.b+_.d*_.d);0!=t&&(t=(t+(Math.sqrt(c*c+h*h)-t+this.data.offsetScaleY)*i)/t),_.b*=t,_.d*=t}if(s>0){let t=_.b,e=_.d,n=Math.atan2(e,t),r=Math.atan2(h,c)-Math.atan2(u,l)-(n-Math.atan2(_.c,_.a));r>Lo.PI?r-=Lo.PI2:r<-Lo.PI&&(r+=Lo.PI2),r=n+(r+f)*s;let i=Math.sqrt(t*t+e*e);_.b=Math.cos(r)*i,_.d=Math.sin(r)*i}_.updateAppliedTransform()}}applyRelativeWorld(){let t=this.mixRotate,e=this.mixX,n=this.mixY,r=this.mixScaleX,i=this.mixScaleY,s=this.mixShearY,o=0!=e||0!=n,a=this.target,l=a.a,c=a.b,u=a.c,h=a.d,p=l*h-c*u>0?Lo.degRad:-Lo.degRad,d=this.data.offsetRotation*p,f=this.data.offsetShearY*p,m=this.bones;for(let p=0,_=m.length;p<_;p++){let _=m[p];if(0!=t){let e=_.a,n=_.b,r=_.c,i=_.d,s=Math.atan2(u,l)+d;s>Lo.PI?s-=Lo.PI2:s<-Lo.PI&&(s+=Lo.PI2),s*=t;let o=Math.cos(s),a=Math.sin(s);_.a=o*e-a*r,_.b=o*n-a*i,_.c=a*e+o*r,_.d=a*n+o*i}if(o){let t=this.temp;a.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),_.worldX+=t.x*e,_.worldY+=t.y*n}if(0!=r){let t=(Math.sqrt(l*l+u*u)-1+this.data.offsetScaleX)*r+1;_.a*=t,_.c*=t}if(0!=i){let t=(Math.sqrt(c*c+h*h)-1+this.data.offsetScaleY)*i+1;_.b*=t,_.d*=t}if(s>0){let t=Math.atan2(h,c)-Math.atan2(u,l);t>Lo.PI?t-=Lo.PI2:t<-Lo.PI&&(t+=Lo.PI2);let e=_.b,n=_.d;t=Math.atan2(n,e)+(t-Lo.PI/2+f)*s;let r=Math.sqrt(e*e+n*n);_.b=Math.cos(t)*r,_.d=Math.sin(t)*r}_.updateAppliedTransform()}}applyAbsoluteLocal(){let t=this.mixRotate,e=this.mixX,n=this.mixY,r=this.mixScaleX,i=this.mixScaleY,s=this.mixShearY,o=this.target,a=this.bones;for(let l=0,c=a.length;l<c;l++){let c=a[l],u=c.arotation;if(0!=t){let e=o.arotation-u+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),u+=e*t}let h=c.ax,p=c.ay;h+=(o.ax-h+this.data.offsetX)*e,p+=(o.ay-p+this.data.offsetY)*n;let d=c.ascaleX,f=c.ascaleY;0!=r&&0!=d&&(d=(d+(o.ascaleX-d+this.data.offsetScaleX)*r)/d),0!=i&&0!=f&&(f=(f+(o.ascaleY-f+this.data.offsetScaleY)*i)/f);let m=c.ashearY;if(0!=s){let t=o.ashearY-m+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),m+=t*s}c.updateWorldTransformWith(h,p,u,d,f,c.ashearX,m)}}applyRelativeLocal(){let t=this.mixRotate,e=this.mixX,n=this.mixY,r=this.mixScaleX,i=this.mixScaleY,s=this.mixShearY,o=this.target,a=this.bones;for(let l=0,c=a.length;l<c;l++){let c=a[l],u=c.arotation+(o.arotation+this.data.offsetRotation)*t,h=c.ax+(o.ax+this.data.offsetX)*e,p=c.ay+(o.ay+this.data.offsetY)*n,d=c.ascaleX*((o.ascaleX-1+this.data.offsetScaleX)*r+1),f=c.ascaleY*((o.ascaleY-1+this.data.offsetScaleY)*i+1),m=c.ashearY+(o.ashearY+this.data.offsetShearY)*s;c.updateWorldTransformWith(h,p,u,d,f,c.ashearX,m)}}}class sl{constructor(t){if(this._updateCache=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,!t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){let n,r=t.bones[e];if(r.parent){let t=this.bones[r.parent.index];n=new Qa(r,this,t),t.children.push(n)}else n=new Qa(r,this,null);this.bones.push(n)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){let n=t.slots[e],r=this.bones[n.boneData.index],i=new rl(n,r);this.slots.push(i),this.drawOrder.push(i)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){let n=t.ikConstraints[e];this.ikConstraints.push(new Ka(n,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){let n=t.transformConstraints[e];this.transformConstraints.push(new il(n,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){let n=t.pathConstraints[e];this.pathConstraints.push(new nl(n,this))}this.color=new Bo(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0;let t=this.bones;for(let e=0,n=t.length;e<n;e++){let n=t[e];n.sorted=n.data.skinRequired,n.active=!n.sorted}if(this.skin){let t=this.skin.bones;for(let e=0,n=this.skin.bones.length;e<n;e++){let n=this.bones[t[e].index];do{n.sorted=!1,n.active=!0,n=n.parent}while(n)}}let e=this.ikConstraints,n=this.transformConstraints,r=this.pathConstraints,i=e.length,s=n.length,o=r.length,a=i+s+o;t:for(let t=0;t<a;t++){for(let n=0;n<i;n++){let r=e[n];if(r.data.order==t){this.sortIkConstraint(r);continue t}}for(let e=0;e<s;e++){let r=n[e];if(r.data.order==t){this.sortTransformConstraint(r);continue t}}for(let e=0;e<o;e++){let n=r[e];if(n.data.order==t){this.sortPathConstraint(n);continue t}}}for(let e=0,n=t.length;e<n;e++)this.sortBone(t[e])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&Po.contains(this.skin.constraints,t.data,!0)),!t.active)return;let e=t.target;this.sortBone(e);let n=t.bones,r=n[0];if(this.sortBone(r),1==n.length)this._updateCache.push(t),this.sortReset(r.children);else{let e=n[n.length-1];this.sortBone(e),this._updateCache.push(t),this.sortReset(r.children),e.sorted=!0}}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||this.skin&&Po.contains(this.skin.constraints,t.data,!0)),!t.active)return;let e=t.target,n=e.data.index,r=e.bone;this.skin&&this.sortPathConstraintAttachment(this.skin,n,r),this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,n,r);for(let t=0,e=this.data.skins.length;t<e;t++)this.sortPathConstraintAttachment(this.data.skins[t],n,r);let i=e.getAttachment();i instanceof qa&&this.sortPathConstraintAttachmentWith(i,r);let s=t.bones,o=s.length;for(let t=0;t<o;t++)this.sortBone(s[t]);this._updateCache.push(t);for(let t=0;t<o;t++)this.sortReset(s[t].children);for(let t=0;t<o;t++)s[t].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&Po.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);let e=t.bones,n=e.length;if(t.data.local)for(let t=0;t<n;t++){let n=e[t];this.sortBone(n.parent),this.sortBone(n)}else for(let t=0;t<n;t++)this.sortBone(e[t]);this._updateCache.push(t);for(let t=0;t<n;t++)this.sortReset(e[t].children);for(let t=0;t<n;t++)e[t].sorted=!0}sortPathConstraintAttachment(t,e,n){let r=t.attachments[e];if(r)for(let t in r)this.sortPathConstraintAttachmentWith(r[t],n)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof qa))return;let n=t.bones;if(n){let t=this.bones;for(let e=0,r=n.length;e<r;){let r=n[e++];for(r+=e;e<r;)this.sortBone(t[n[e++]])}}else this.sortBone(e)}sortBone(t){if(t.sorted)return;let e=t.parent;e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,n=t.length;e<n;e++){let n=t[e];n.active&&(n.sorted&&this.sortReset(n.children),n.sorted=!1)}}updateWorldTransform(){let t=this.bones;for(let e=0,n=t.length;e<n;e++){let n=t[e];n.ax=n.x,n.ay=n.y,n.arotation=n.rotation,n.ascaleX=n.scaleX,n.ascaleY=n.scaleY,n.ashearX=n.shearX,n.ashearY=n.shearY}let e=this._updateCache;for(let t=0,n=e.length;t<n;t++)e[t].update()}updateWorldTransformWith(t){let e=this.getRootBone(),n=t.a,r=t.b,i=t.c,s=t.d;e.worldX=n*this.x+r*this.y+t.worldX,e.worldY=i*this.x+s*this.y+t.worldY;let o=e.rotation+90+e.shearY,a=Lo.cosDeg(e.rotation+e.shearX)*e.scaleX,l=Lo.cosDeg(o)*e.scaleY,c=Lo.sinDeg(e.rotation+e.shearX)*e.scaleX,u=Lo.sinDeg(o)*e.scaleY;e.a=(n*a+r*c)*this.scaleX,e.b=(n*l+r*u)*this.scaleX,e.c=(i*a+s*c)*this.scaleY,e.d=(i*l+s*u)*this.scaleY;let h=this._updateCache;for(let t=0,n=h.length;t<n;t++){let n=h[t];n!=e&&n.update()}}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){let t=this.bones;for(let e=0,n=t.length;e<n;e++)t[e].setToSetupPose();let e=this.ikConstraints;for(let t=0,n=e.length;t<n;t++){let n=e[t];n.mix=n.data.mix,n.softness=n.data.softness,n.bendDirection=n.data.bendDirection,n.compress=n.data.compress,n.stretch=n.data.stretch}let n=this.transformConstraints;for(let t=0,e=n.length;t<e;t++){let e=n[t],r=e.data;e.mixRotate=r.mixRotate,e.mixX=r.mixX,e.mixY=r.mixY,e.mixScaleX=r.mixScaleX,e.mixScaleY=r.mixScaleY,e.mixShearY=r.mixShearY}let r=this.pathConstraints;for(let t=0,e=r.length;t<e;t++){let e=r[t],n=e.data;e.position=n.position,e.spacing=n.spacing,e.mixRotate=n.mixRotate,e.mixX=n.mixX,e.mixY=n.mixY}}setSlotsToSetupPose(){let t=this.slots;Po.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,n=t.length;e<n;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(!t)throw new Error("boneName cannot be null.");let e=this.bones;for(let n=0,r=e.length;n<r;n++){let r=e[n];if(r.data.name==t)return r}return null}findSlot(t){if(!t)throw new Error("slotName cannot be null.");let e=this.slots;for(let n=0,r=e.length;n<r;n++){let r=e[n];if(r.data.name==t)return r}return null}setSkinByName(t){let e=this.data.findSkin(t);if(!e)throw new Error("Skin not found: "+t);this.setSkin(e)}setSkin(t){if(t!=this.skin){if(t)if(this.skin)t.attachAll(this,this.skin);else{let e=this.slots;for(let n=0,r=e.length;n<r;n++){let r=e[n],i=r.data.attachmentName;if(i){let e=t.getAttachment(n,i);e&&r.setAttachment(e)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,e){return this.getAttachment(this.data.findSlot(t).index,e)}getAttachment(t,e){if(!e)throw new Error("attachmentName cannot be null.");if(this.skin){let n=this.skin.getAttachment(t,e);if(n)return n}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(!t)throw new Error("slotName cannot be null.");let n=this.slots;for(let r=0,i=n.length;r<i;r++){let i=n[r];if(i.data.name==t){let n=null;if(e&&(n=this.getAttachment(r,e),!n))throw new Error("Attachment not found: "+e+", for slot: "+t);return void i.setAttachment(n)}}throw new Error("Slot not found: "+t)}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.ikConstraints;for(let n=0,r=e.length;n<r;n++){let r=e[n];if(r.data.name==t)return r}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.transformConstraints;for(let n=0,r=e.length;n<r;n++){let r=e[n];if(r.data.name==t)return r}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.pathConstraints;for(let n=0,r=e.length;n<r;n++){let r=e[n];if(r.data.name==t)return r}return null}getBounds(t,e,n=new Array(2)){if(!t)throw new Error("offset cannot be null.");if(!e)throw new Error("size cannot be null.");let r=this.drawOrder,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(let t=0,e=r.length;t<e;t++){let e=r[t];if(!e.bone.active)continue;let l=0,c=null,u=e.getAttachment();if(u instanceof Ya)l=8,c=Po.setArraySize(n,l,0),u.computeWorldVertices(e.bone,c,0,2);else if(u instanceof Wa){let t=u;l=t.worldVerticesLength,c=Po.setArraySize(n,l,0),t.computeWorldVertices(e,0,l,c,0,2)}if(c)for(let t=0,e=c.length;t<e;t+=2){let e=c[t],n=c[t+1];i=Math.min(i,e),s=Math.min(s,n),o=Math.max(o,e),a=Math.max(a,n)}}t.set(i,s),e.set(o-i,a-s)}update(t){this.time+=t}}class ol{constructor(t,e,n){this.slotIndex=t,this.name=e,this.attachment=n}}class al{constructor(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,!t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,e,n){if(!n)throw new Error("attachment cannot be null.");let r=this.attachments;t>=r.length&&(r.length=t+1),r[t]||(r[t]={}),r[t][e]=n}addSkin(t){for(let e=0;e<t.bones.length;e++){let n=t.bones[e],r=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==n){r=!0;break}r||this.bones.push(n)}for(let e=0;e<t.constraints.length;e++){let n=t.constraints[e],r=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==n){r=!0;break}r||this.constraints.push(n)}let e=t.getAttachments();for(let t=0;t<e.length;t++){var n=e[t];this.setAttachment(n.slotIndex,n.name,n.attachment)}}copySkin(t){for(let e=0;e<t.bones.length;e++){let n=t.bones[e],r=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==n){r=!0;break}r||this.bones.push(n)}for(let e=0;e<t.constraints.length;e++){let n=t.constraints[e],r=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==n){r=!0;break}r||this.constraints.push(n)}let e=t.getAttachments();for(let t=0;t<e.length;t++){var n=e[t];n.attachment&&(n.attachment instanceof Wa?(n.attachment=n.attachment.newLinkedMesh(),this.setAttachment(n.slotIndex,n.name,n.attachment)):(n.attachment=n.attachment.copy(),this.setAttachment(n.slotIndex,n.name,n.attachment)))}}getAttachment(t,e){let n=this.attachments[t];return n?n[e]:null}removeAttachment(t,e){let n=this.attachments[t];n&&(n[e]=null)}getAttachments(){let t=new Array;for(var e=0;e<this.attachments.length;e++){let n=this.attachments[e];if(n)for(let r in n){let i=n[r];i&&t.push(new ol(e,r,i))}}return t}getAttachmentsForSlot(t,e){let n=this.attachments[t];if(n)for(let r in n){let i=n[r];i&&e.push(new ol(t,r,i))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,e){let n=0;for(let r=0;r<t.slots.length;r++){let i=t.slots[r],s=i.getAttachment();if(s&&n<e.attachments.length){let t=e.attachments[n];for(let e in t)if(s==t[e]){let t=this.getAttachment(n,e);t&&i.setAttachment(t);break}}n++}}}class ll{constructor(t,e,n){if(this.color=new Bo(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");if(!n)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=n}}!function(t){t[t.Normal=0]="Normal",t[t.Additive=1]="Additive",t[t.Multiply=2]="Multiply",t[t.Screen=3]="Screen"}(Oa||(Oa={})),function(t){t[t.Region=0]="Region",t[t.BoundingBox=1]="BoundingBox",t[t.Mesh=2]="Mesh",t[t.LinkedMesh=3]="LinkedMesh",t[t.Path=4]="Path",t[t.Point=5]="Point",t[t.Clipping=6]="Clipping"}(Fa||(Fa={}));class cl{constructor(){this.convexPolygons=new Array,this.convexPolygonsIndices=new Array,this.indicesArray=new Array,this.isConcaveArray=new Array,this.triangles=new Array,this.polygonPool=new Io((()=>new Array)),this.polygonIndicesPool=new Io((()=>new Array))}triangulate(t){let e=t,n=t.length>>1,r=this.indicesArray;r.length=0;for(let t=0;t<n;t++)r[t]=t;let i=this.isConcaveArray;i.length=0;for(let t=0,s=n;t<s;++t)i[t]=cl.isConcave(t,n,e,r);let s=this.triangles;for(s.length=0;n>3;){let t=n-1,o=0,a=1;for(;;){t:if(!i[o]){let s=r[t]<<1,l=r[o]<<1,c=r[a]<<1,u=e[s],h=e[s+1],p=e[l],d=e[l+1],f=e[c],m=e[c+1];for(let s=(a+1)%n;s!=t;s=(s+1)%n){if(!i[s])continue;let t=r[s]<<1,n=e[t],o=e[t+1];if(cl.positiveArea(f,m,u,h,n,o)&&cl.positiveArea(u,h,p,d,n,o)&&cl.positiveArea(p,d,f,m,n,o))break t}break}if(0==a){do{if(!i[o])break;o--}while(o>0);break}t=o,o=a,a=(a+1)%n}s.push(r[(n+o-1)%n]),s.push(r[o]),s.push(r[(o+1)%n]),r.splice(o,1),i.splice(o,1),n--;let l=(n+o-1)%n,c=o==n?0:o;i[l]=cl.isConcave(l,n,e,r),i[c]=cl.isConcave(c,n,e,r)}return 3==n&&(s.push(r[2]),s.push(r[0]),s.push(r[1])),s}decompose(t,e){let n=t,r=this.convexPolygons;this.polygonPool.freeAll(r),r.length=0;let i=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(i),i.length=0;let s=this.polygonIndicesPool.obtain();s.length=0;let o=this.polygonPool.obtain();o.length=0;let a=-1,l=0;for(let t=0,c=e.length;t<c;t+=3){let c=e[t]<<1,u=e[t+1]<<1,h=e[t+2]<<1,p=n[c],d=n[c+1],f=n[u],m=n[u+1],_=n[h],g=n[h+1],y=!1;if(a==c){let t=o.length-4,e=cl.winding(o[t],o[t+1],o[t+2],o[t+3],_,g),n=cl.winding(_,g,o[0],o[1],o[2],o[3]);e==l&&n==l&&(o.push(_),o.push(g),s.push(h),y=!0)}y||(o.length>0?(r.push(o),i.push(s)):(this.polygonPool.free(o),this.polygonIndicesPool.free(s)),o=this.polygonPool.obtain(),o.length=0,o.push(p),o.push(d),o.push(f),o.push(m),o.push(_),o.push(g),s=this.polygonIndicesPool.obtain(),s.length=0,s.push(c),s.push(u),s.push(h),l=cl.winding(p,d,f,m,_,g),a=c)}o.length>0&&(r.push(o),i.push(s));for(let t=0,e=r.length;t<e;t++){if(s=i[t],0==s.length)continue;let n=s[0],a=s[s.length-1];o=r[t];let l=o.length-4,c=o[l],u=o[l+1],h=o[l+2],p=o[l+3],d=o[0],f=o[1],m=o[2],_=o[3],g=cl.winding(c,u,h,p,d,f);for(let l=0;l<e;l++){if(l==t)continue;let e=i[l];if(3!=e.length)continue;let y=e[0],v=e[1],b=e[2],x=r[l],w=x[x.length-2],S=x[x.length-1];if(y!=n||v!=a)continue;let M=cl.winding(c,u,h,p,w,S),T=cl.winding(w,S,d,f,m,_);M==g&&T==g&&(x.length=0,e.length=0,o.push(w),o.push(S),s.push(b),c=h,u=p,h=w,p=S,l=0)}}for(let t=r.length-1;t>=0;t--)o=r[t],0==o.length&&(r.splice(t,1),this.polygonPool.free(o),s=i[t],i.splice(t,1),this.polygonIndicesPool.free(s));return r}static isConcave(t,e,n,r){let i=r[(e+t-1)%e]<<1,s=r[t]<<1,o=r[(t+1)%e]<<1;return!this.positiveArea(n[i],n[i+1],n[s],n[s+1],n[o],n[o+1])}static positiveArea(t,e,n,r,i,s){return t*(s-r)+n*(e-s)+i*(r-e)>=0}static winding(t,e,n,r,i,s){let o=n-t,a=r-e;return i*a-s*o+o*e-t*a>=0?1:-1}}class ul{constructor(){this.triangulator=new cl,this.clippingPolygon=new Array,this.clipOutput=new Array,this.clippedVertices=new Array,this.clippedTriangles=new Array,this.scratch=new Array}clipStart(t,e){if(this.clipAttachment)return 0;this.clipAttachment=e;let n=e.worldVerticesLength,r=Po.setArraySize(this.clippingPolygon,n);e.computeWorldVertices(t,0,n,r,0,2);let i=this.clippingPolygon;ul.makeClockwise(i);let s=this.clippingPolygons=this.triangulator.decompose(i,this.triangulator.triangulate(i));for(let t=0,e=s.length;t<e;t++){let e=s[t];ul.makeClockwise(e),e.push(e[0]),e.push(e[1])}return s.length}clipEndWithSlot(t){this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()}clipEnd(){this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)}isClipping(){return null!=this.clipAttachment}clipTriangles(t,e,n,r,i,s,o,a){let l=this.clipOutput,c=this.clippedVertices,u=this.clippedTriangles,h=this.clippingPolygons,p=this.clippingPolygons.length,d=a?12:8,f=0;c.length=0,u.length=0;t:for(let e=0;e<r;e+=3){let r=n[e]<<1,m=t[r],_=t[r+1],g=i[r],y=i[r+1];r=n[e+1]<<1;let v=t[r],b=t[r+1],x=i[r],w=i[r+1];r=n[e+2]<<1;let S=t[r],M=t[r+1],T=i[r],E=i[r+1];for(let t=0;t<p;t++){let e=c.length;if(!this.clip(m,_,v,b,S,M,h[t],l)){let t=Po.setArraySize(c,e+3*d);t[e]=m,t[e+1]=_,t[e+2]=s.r,t[e+3]=s.g,t[e+4]=s.b,t[e+5]=s.a,a?(t[e+6]=g,t[e+7]=y,t[e+8]=o.r,t[e+9]=o.g,t[e+10]=o.b,t[e+11]=o.a,t[e+12]=v,t[e+13]=b,t[e+14]=s.r,t[e+15]=s.g,t[e+16]=s.b,t[e+17]=s.a,t[e+18]=x,t[e+19]=w,t[e+20]=o.r,t[e+21]=o.g,t[e+22]=o.b,t[e+23]=o.a,t[e+24]=S,t[e+25]=M,t[e+26]=s.r,t[e+27]=s.g,t[e+28]=s.b,t[e+29]=s.a,t[e+30]=T,t[e+31]=E,t[e+32]=o.r,t[e+33]=o.g,t[e+34]=o.b,t[e+35]=o.a):(t[e+6]=g,t[e+7]=y,t[e+8]=v,t[e+9]=b,t[e+10]=s.r,t[e+11]=s.g,t[e+12]=s.b,t[e+13]=s.a,t[e+14]=x,t[e+15]=w,t[e+16]=S,t[e+17]=M,t[e+18]=s.r,t[e+19]=s.g,t[e+20]=s.b,t[e+21]=s.a,t[e+22]=T,t[e+23]=E),e=u.length;let n=Po.setArraySize(u,e+3);n[e]=f,n[e+1]=f+1,n[e+2]=f+2,f+=3;continue t}{let t=l.length;if(0==t)continue;let n=b-M,r=S-v,i=m-S,h=M-_,p=1/(n*i+r*(_-M)),A=t>>1,$=this.clipOutput,C=Po.setArraySize(c,e+A*d);for(let l=0;l<t;l+=2){let t=$[l],c=$[l+1];C[e]=t,C[e+1]=c,C[e+2]=s.r,C[e+3]=s.g,C[e+4]=s.b,C[e+5]=s.a;let u=t-S,f=c-M,m=(n*u+r*f)*p,_=(h*u+i*f)*p,v=1-m-_;C[e+6]=g*m+x*_+T*v,C[e+7]=y*m+w*_+E*v,a&&(C[e+8]=o.r,C[e+9]=o.g,C[e+10]=o.b,C[e+11]=o.a),e+=d}e=u.length;let B=Po.setArraySize(u,e+3*(A-2));A--;for(let t=1;t<A;t++)B[e]=f,B[e+1]=f+t,B[e+2]=f+t+1,e+=3;f+=A+1}}}}clip(t,e,n,r,i,s,o,a){let l=a,c=!1,u=null;o.length%4>=2?(u=a,a=this.scratch):u=this.scratch,u.length=0,u.push(t),u.push(e),u.push(n),u.push(r),u.push(i),u.push(s),u.push(t),u.push(e),a.length=0;let h=o,p=o.length-4;for(let t=0;;t+=2){let e=h[t],n=h[t+1],r=h[t+2],i=h[t+3],s=e-r,o=n-i,d=u,f=u.length-2,m=a.length;for(let t=0;t<f;t+=2){let l=d[t],u=d[t+1],h=d[t+2],p=d[t+3],f=s*(p-i)-o*(h-r)>0;if(s*(u-i)-o*(l-r)>0){if(f){a.push(h),a.push(p);continue}let t=p-u,s=h-l,o=t*(r-e)-s*(i-n);if(Math.abs(o)>1e-6){let c=(s*(n-u)-t*(e-l))/o;a.push(e+(r-e)*c),a.push(n+(i-n)*c)}else a.push(e),a.push(n)}else if(f){let t=p-u,s=h-l,o=t*(r-e)-s*(i-n);if(Math.abs(o)>1e-6){let c=(s*(n-u)-t*(e-l))/o;a.push(e+(r-e)*c),a.push(n+(i-n)*c)}else a.push(e),a.push(n);a.push(h),a.push(p)}c=!0}if(m==a.length)return l.length=0,!0;if(a.push(a[0]),a.push(a[1]),t==p)break;let _=a;(a=u).length=0,u=_}if(l!=a){l.length=0;for(let t=0,e=a.length-2;t<e;t++)l[t]=a[t]}else l.length=l.length-2;return c}static makeClockwise(t){let e=t,n=t.length,r=e[n-2]*e[1]-e[0]*e[n-1],i=0,s=0,o=0,a=0;for(let t=0,l=n-3;t<l;t+=2)i=e[t],s=e[t+1],o=e[t+2],a=e[t+3],r+=i*a-o*s;if(!(r<0))for(let t=0,r=n-2,i=n>>1;t<i;t+=2){let n=e[t],i=e[t+1],s=r-t;e[t]=e[s],e[t+1]=e[s+1],e[s]=n,e[s+1]=i}}}class hl{constructor(t){this.name=t}}class pl{constructor(t,e){if(!e)throw new Error("data cannot be null.");this.time=t,this.data=e}}class dl extends tl{constructor(t){super(t,0,!1),this.bones=new Array,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.softness=0}}class fl{constructor(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}findBone(t){if(!t)throw new Error("boneName cannot be null.");let e=this.bones;for(let n=0,r=e.length;n<r;n++){let r=e[n];if(r.name==t)return r}return null}findSlot(t){if(!t)throw new Error("slotName cannot be null.");let e=this.slots;for(let n=0,r=e.length;n<r;n++){let r=e[n];if(r.name==t)return r}return null}findSkin(t){if(!t)throw new Error("skinName cannot be null.");let e=this.skins;for(let n=0,r=e.length;n<r;n++){let r=e[n];if(r.name==t)return r}return null}findEvent(t){if(!t)throw new Error("eventDataName cannot be null.");let e=this.events;for(let n=0,r=e.length;n<r;n++){let r=e[n];if(r.name==t)return r}return null}findAnimation(t){if(!t)throw new Error("animationName cannot be null.");let e=this.animations;for(let n=0,r=e.length;n<r;n++){let r=e[n];if(r.name==t)return r}return null}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.ikConstraints;for(let n=0,r=e.length;n<r;n++){let r=e[n];if(r.name==t)return r}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.transformConstraints;for(let n=0,r=e.length;n<r;n++){let r=e[n];if(r.name==t)return r}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.pathConstraints;for(let n=0,r=e.length;n<r;n++){let r=e[n];if(r.name==t)return r}return null}}class ml extends tl{constructor(t){super(t,0,!1),this.bones=new Array,this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1}}class _l{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){let e=this.scale,n=new fl,r="string"==typeof t?JSON.parse(t):t,i=r.skeleton;if(i&&(n.hash=i.hash,n.version=i.spine,n.x=i.x,n.y=i.y,n.width=i.width,n.height=i.height,n.fps=i.fps,n.imagesPath=i.images),r.bones)for(let t=0;t<r.bones.length;t++){let i=r.bones[t],s=null,o=xl(i,"parent",null);o&&(s=n.findBone(o));let a=new Za(n.bones.length,i.name,s);a.length=xl(i,"length",0)*e,a.x=xl(i,"x",0)*e,a.y=xl(i,"y",0)*e,a.rotation=xl(i,"rotation",0),a.scaleX=xl(i,"scaleX",1),a.scaleY=xl(i,"scaleY",1),a.shearX=xl(i,"shearX",0),a.shearY=xl(i,"shearY",0),a.transformMode=Po.enumValue(Ra,xl(i,"transform","Normal")),a.skinRequired=xl(i,"skin",!1);let l=xl(i,"color",null);l&&a.color.setFromString(l),n.bones.push(a)}if(r.slots)for(let t=0;t<r.slots.length;t++){let e=r.slots[t],i=n.findBone(e.bone),s=new ll(n.slots.length,e.name,i),o=xl(e,"color",null);o&&s.color.setFromString(o);let a=xl(e,"dark",null);a&&(s.darkColor=Bo.fromString(a)),s.attachmentName=xl(e,"attachment",null),s.blendMode=Po.enumValue(Oa,xl(e,"blend","normal")),n.slots.push(s)}if(r.ik)for(let t=0;t<r.ik.length;t++){let i=r.ik[t],s=new dl(i.name);s.order=xl(i,"order",0),s.skinRequired=xl(i,"skin",!1);for(let t=0;t<i.bones.length;t++)s.bones.push(n.findBone(i.bones[t]));s.target=n.findBone(i.target),s.mix=xl(i,"mix",1),s.softness=xl(i,"softness",0)*e,s.bendDirection=xl(i,"bendPositive",!0)?1:-1,s.compress=xl(i,"compress",!1),s.stretch=xl(i,"stretch",!1),s.uniform=xl(i,"uniform",!1),n.ikConstraints.push(s)}if(r.transform)for(let t=0;t<r.transform.length;t++){let i=r.transform[t],s=new ml(i.name);s.order=xl(i,"order",0),s.skinRequired=xl(i,"skin",!1);for(let t=0;t<i.bones.length;t++)s.bones.push(n.findBone(i.bones[t]));let o=i.target;s.target=n.findBone(o),s.local=xl(i,"local",!1),s.relative=xl(i,"relative",!1),s.offsetRotation=xl(i,"rotation",0),s.offsetX=xl(i,"x",0)*e,s.offsetY=xl(i,"y",0)*e,s.offsetScaleX=xl(i,"scaleX",0),s.offsetScaleY=xl(i,"scaleY",0),s.offsetShearY=xl(i,"shearY",0),s.mixRotate=xl(i,"mixRotate",1),s.mixX=xl(i,"mixX",1),s.mixY=xl(i,"mixY",s.mixX),s.mixScaleX=xl(i,"mixScaleX",1),s.mixScaleY=xl(i,"mixScaleY",s.mixScaleX),s.mixShearY=xl(i,"mixShearY",1),n.transformConstraints.push(s)}if(r.path)for(let t=0;t<r.path.length;t++){let i=r.path[t],s=new el(i.name);s.order=xl(i,"order",0),s.skinRequired=xl(i,"skin",!1);for(let t=0;t<i.bones.length;t++)s.bones.push(n.findBone(i.bones[t]));let o=i.target;s.target=n.findSlot(o),s.positionMode=Po.enumValue(Na,xl(i,"positionMode","Percent")),s.spacingMode=Po.enumValue(Pa,xl(i,"spacingMode","Length")),s.rotateMode=Po.enumValue(Ia,xl(i,"rotateMode","Tangent")),s.offsetRotation=xl(i,"rotation",0),s.position=xl(i,"position",0),s.positionMode==Na.Fixed&&(s.position*=e),s.spacing=xl(i,"spacing",0),s.spacingMode!=Pa.Length&&s.spacingMode!=Pa.Fixed||(s.spacing*=e),s.mixRotate=xl(i,"mixRotate",1),s.mixX=xl(i,"mixX",1),s.mixY=xl(i,"mixY",s.mixX),n.pathConstraints.push(s)}if(r.skins)for(let t=0;t<r.skins.length;t++){let e=r.skins[t],i=new al(e.name);if(e.bones)for(let t=0;t<e.bones.length;t++)i.bones.push(n.findBone(e.bones[t]));if(e.ik)for(let t=0;t<e.ik.length;t++)i.constraints.push(n.findIkConstraint(e.ik[t]));if(e.transform)for(let t=0;t<e.transform.length;t++)i.constraints.push(n.findTransformConstraint(e.transform[t]));if(e.path)for(let t=0;t<e.path.length;t++)i.constraints.push(n.findPathConstraint(e.path[t]));for(let t in e.attachments){let r=n.findSlot(t),s=e.attachments[t];for(let t in s){let e=this.readAttachment(s[t],i,r.index,t,n);e&&i.setAttachment(r.index,t,e)}}n.skins.push(i),"default"==i.name&&(n.defaultSkin=i)}for(let t=0,e=this.linkedMeshes.length;t<e;t++){let e=this.linkedMeshes[t],r=(e.skin?n.findSkin(e.skin):n.defaultSkin).getAttachment(e.slotIndex,e.parent);e.mesh.deformAttachment=e.inheritDeform?r:e.mesh,e.mesh.setParentMesh(r),e.mesh.updateUVs()}if(this.linkedMeshes.length=0,r.events)for(let t in r.events){let e=r.events[t],i=new hl(t);i.intValue=xl(e,"int",0),i.floatValue=xl(e,"float",0),i.stringValue=xl(e,"string",""),i.audioPath=xl(e,"audio",null),i.audioPath&&(i.volume=xl(e,"volume",1),i.balance=xl(e,"balance",0)),n.events.push(i)}if(r.animations)for(let t in r.animations){let e=r.animations[t];this.readAnimation(e,t,n)}return n}readAttachment(t,e,n,r,i){let s=this.scale;switch(r=xl(t,"name",r),xl(t,"type","region")){case"region":{let n=xl(t,"path",r),i=this.attachmentLoader.newRegionAttachment(e,r,n);if(!i)return null;i.path=n,i.x=xl(t,"x",0)*s,i.y=xl(t,"y",0)*s,i.scaleX=xl(t,"scaleX",1),i.scaleY=xl(t,"scaleY",1),i.rotation=xl(t,"rotation",0),i.width=t.width*s,i.height=t.height*s;let o=xl(t,"color",null);return o&&i.color.setFromString(o),i.updateOffset(),i}case"boundingbox":{let n=this.attachmentLoader.newBoundingBoxAttachment(e,r);if(!n)return null;this.readVertices(t,n,t.vertexCount<<1);let i=xl(t,"color",null);return i&&n.color.setFromString(i),n}case"mesh":case"linkedmesh":{let i=xl(t,"path",r),o=this.attachmentLoader.newMeshAttachment(e,r,i);if(!o)return null;o.path=i;let a=xl(t,"color",null);a&&o.color.setFromString(a),o.width=xl(t,"width",0)*s,o.height=xl(t,"height",0)*s;let l=xl(t,"parent",null);if(l)return this.linkedMeshes.push(new gl(o,xl(t,"skin",null),n,l,xl(t,"deform",!0))),o;let c=t.uvs;return this.readVertices(t,o,c.length),o.triangles=t.triangles,o.regionUVs=c,o.updateUVs(),o.edges=xl(t,"edges",null),o.hullLength=2*xl(t,"hull",0),o}case"path":{let n=this.attachmentLoader.newPathAttachment(e,r);if(!n)return null;n.closed=xl(t,"closed",!1),n.constantSpeed=xl(t,"constantSpeed",!0);let i=t.vertexCount;this.readVertices(t,n,i<<1);let o=Po.newArray(i/3,0);for(let e=0;e<t.lengths.length;e++)o[e]=t.lengths[e]*s;n.lengths=o;let a=xl(t,"color",null);return a&&n.color.setFromString(a),n}case"point":{let n=this.attachmentLoader.newPointAttachment(e,r);if(!n)return null;n.x=xl(t,"x",0)*s,n.y=xl(t,"y",0)*s,n.rotation=xl(t,"rotation",0);let i=xl(t,"color",null);return i&&n.color.setFromString(i),n}case"clipping":{let n=this.attachmentLoader.newClippingAttachment(e,r);if(!n)return null;let s=xl(t,"end",null);s&&(n.endSlot=i.findSlot(s));let o=t.vertexCount;this.readVertices(t,n,o<<1);let a=xl(t,"color",null);return a&&n.color.setFromString(a),n}}return null}readVertices(t,e,n){let r=this.scale;e.worldVerticesLength=n;let i=t.vertices;if(n==i.length){let t=Po.toFloatArray(i);if(1!=r)for(let e=0,n=i.length;e<n;e++)t[e]*=r;return void(e.vertices=t)}let s=new Array,o=new Array;for(let t=0,e=i.length;t<e;){let e=i[t++];o.push(e);for(let n=t+4*e;t<n;t+=4)o.push(i[t]),s.push(i[t+1]*r),s.push(i[t+2]*r),s.push(i[t+3])}e.bones=o,e.vertices=Po.toFloatArray(s)}readAnimation(t,e,n){let r=this.scale,i=new Array;if(t.slots)for(let e in t.slots){let r=t.slots[e],s=n.findSlot(e).index;for(let t in r){let e=r[t];if(!e)continue;let n=e.length;if("attachment"==t){let t=new sa(n,s);for(let r=0;r<n;r++){let n=e[r];t.setFrame(r,xl(n,"time",0),n.name)}i.push(t)}else if("rgba"==t){let t=new ta(n,n<<2,s),r=e[0],o=xl(r,"time",0),a=Bo.fromString(r.color);for(let n=0,i=0;;n++){t.setFrame(n,o,a.r,a.g,a.b,a.a);let s=e[n+1];if(!s){t.shrink(i);break}let l=xl(s,"time",0),c=Bo.fromString(s.color),u=r.curve;u&&(i=bl(u,t,i,n,0,o,l,a.r,c.r,1),i=bl(u,t,i,n,1,o,l,a.g,c.g,1),i=bl(u,t,i,n,2,o,l,a.b,c.b,1),i=bl(u,t,i,n,3,o,l,a.a,c.a,1)),o=l,a=c,r=s}i.push(t)}else if("rgb"==t){let t=new ea(n,3*n,s),r=e[0],o=xl(r,"time",0),a=Bo.fromString(r.color);for(let n=0,i=0;;n++){t.setFrame(n,o,a.r,a.g,a.b);let s=e[n+1];if(!s){t.shrink(i);break}let l=xl(s,"time",0),c=Bo.fromString(s.color),u=r.curve;u&&(i=bl(u,t,i,n,0,o,l,a.r,c.r,1),i=bl(u,t,i,n,1,o,l,a.g,c.g,1),i=bl(u,t,i,n,2,o,l,a.b,c.b,1)),o=l,a=c,r=s}i.push(t)}else if("alpha"==t)i.push(yl(e,new na(n,n,s),0,1));else if("rgba2"==t){let t=new ra(n,7*n,s),r=e[0],o=xl(r,"time",0),a=Bo.fromString(r.light),l=Bo.fromString(r.dark);for(let n=0,i=0;;n++){t.setFrame(n,o,a.r,a.g,a.b,a.a,l.r,l.g,l.b);let s=e[n+1];if(!s){t.shrink(i);break}let c=xl(s,"time",0),u=Bo.fromString(s.light),h=Bo.fromString(s.dark),p=r.curve;p&&(i=bl(p,t,i,n,0,o,c,a.r,u.r,1),i=bl(p,t,i,n,1,o,c,a.g,u.g,1),i=bl(p,t,i,n,2,o,c,a.b,u.b,1),i=bl(p,t,i,n,3,o,c,a.a,u.a,1),i=bl(p,t,i,n,4,o,c,l.r,h.r,1),i=bl(p,t,i,n,5,o,c,l.g,h.g,1),i=bl(p,t,i,n,6,o,c,l.b,h.b,1)),o=c,a=u,l=h,r=s}i.push(t)}else if("rgb2"==t){let t=new ia(n,6*n,s),r=e[0],o=xl(r,"time",0),a=Bo.fromString(r.light),l=Bo.fromString(r.dark);for(let n=0,i=0;;n++){t.setFrame(n,o,a.r,a.g,a.b,l.r,l.g,l.b);let s=e[n+1];if(!s){t.shrink(i);break}let c=xl(s,"time",0),u=Bo.fromString(s.light),h=Bo.fromString(s.dark),p=r.curve;p&&(i=bl(p,t,i,n,0,o,c,a.r,u.r,1),i=bl(p,t,i,n,1,o,c,a.g,u.g,1),i=bl(p,t,i,n,2,o,c,a.b,u.b,1),i=bl(p,t,i,n,3,o,c,l.r,h.r,1),i=bl(p,t,i,n,4,o,c,l.g,h.g,1),i=bl(p,t,i,n,5,o,c,l.b,h.b,1)),o=c,a=u,l=h,r=s}i.push(t)}}}if(t.bones)for(let e in t.bones){let s=t.bones[e],o=n.findBone(e).index;for(let t in s){let e=s[t],n=e.length;if(0!=n)if("rotate"===t)i.push(yl(e,new Ho(n,n,o),0,1));else if("translate"===t){let t=new Vo(n,n<<1,o);i.push(vl(e,t,"x","y",0,r))}else if("translatex"===t){let t=new Wo(n,n,o);i.push(yl(e,t,0,r))}else if("translatey"===t){let t=new qo(n,n,o);i.push(yl(e,t,0,r))}else if("scale"===t){let t=new Xo(n,n<<1,o);i.push(vl(e,t,"x","y",1,1))}else if("scalex"===t){let t=new Yo(n,n,o);i.push(yl(e,t,1,1))}else if("scaley"===t){let t=new Jo(n,n,o);i.push(yl(e,t,1,1))}else if("shear"===t){let t=new Zo(n,n<<1,o);i.push(vl(e,t,"x","y",0,1))}else if("shearx"===t){let t=new Qo(n,n,o);i.push(yl(e,t,0,1))}else if("sheary"===t){let t=new Ko(n,n,o);i.push(yl(e,t,0,1))}}}if(t.ik)for(let e in t.ik){let s=t.ik[e],o=s[0];if(!o)continue;let a=n.findIkConstraint(e),l=n.ikConstraints.indexOf(a),c=new ca(s.length,s.length<<1,l),u=xl(o,"time",0),h=xl(o,"mix",1),p=xl(o,"softness",0)*r;for(let t=0,e=0;;t++){c.setFrame(t,u,h,p,xl(o,"bendPositive",!0)?1:-1,xl(o,"compress",!1),xl(o,"stretch",!1));let n=s[t+1];if(!n){c.shrink(e);break}let i=xl(n,"time",0),a=xl(n,"mix",1),l=xl(n,"softness",0)*r,d=o.curve;d&&(e=bl(d,c,e,t,0,u,i,h,a,1),e=bl(d,c,e,t,1,u,i,p,l,r)),u=i,h=a,p=l,o=n}i.push(c)}if(t.transform)for(let e in t.transform){let r=t.transform[e],s=r[0];if(!s)continue;let o=n.findTransformConstraint(e),a=n.transformConstraints.indexOf(o),l=new ua(r.length,6*r.length,a),c=xl(s,"time",0),u=xl(s,"mixRotate",1),h=xl(s,"mixX",1),p=xl(s,"mixY",h),d=xl(s,"mixScaleX",1),f=xl(s,"mixScaleY",d),m=xl(s,"mixShearY",1);for(let t=0,e=0;;t++){l.setFrame(t,c,u,h,p,d,f,m);let n=r[t+1];if(!n){l.shrink(e);break}let i=xl(n,"time",0),o=xl(n,"mixRotate",1),a=xl(n,"mixX",1),_=xl(n,"mixY",a),g=xl(n,"mixScaleX",1),y=xl(n,"mixScaleY",g),v=xl(n,"mixShearY",1),b=s.curve;b&&(e=bl(b,l,e,t,0,c,i,u,o,1),e=bl(b,l,e,t,1,c,i,h,a,1),e=bl(b,l,e,t,2,c,i,p,_,1),e=bl(b,l,e,t,3,c,i,d,g,1),e=bl(b,l,e,t,4,c,i,f,y,1),e=bl(b,l,e,t,5,c,i,m,v,1)),c=i,u=o,h=a,p=_,d=g,f=y,d=g,s=n}i.push(l)}if(t.path)for(let e in t.path){let s=t.path[e],o=n.findPathConstraint(e),a=n.pathConstraints.indexOf(o);for(let t in s){let e=s[t],n=e[0];if(!n)continue;let l=e.length;if("position"===t){let t=new ha(l,l,a);i.push(yl(e,t,0,o.positionMode==Na.Fixed?r:1))}else if("spacing"===t){let t=new pa(l,l,a);i.push(yl(e,t,0,o.spacingMode==Pa.Length||o.spacingMode==Pa.Fixed?r:1))}else if("mix"===t){let t=new da(l,3*l,a),r=xl(n,"time",0),s=xl(n,"mixRotate",1),o=xl(n,"mixX",1),c=xl(n,"mixY",o);for(let i=0,a=0;;i++){t.setFrame(i,r,s,o,c);let l=e[i+1];if(!l){t.shrink(a);break}let u=xl(l,"time",0),h=xl(l,"mixRotate",1),p=xl(l,"mixX",1),d=xl(l,"mixY",p),f=n.curve;f&&(a=bl(f,t,a,i,0,r,u,s,h,1),a=bl(f,t,a,i,1,r,u,o,p,1),a=bl(f,t,a,i,2,r,u,c,d,1)),r=u,s=h,o=p,c=d,n=l}i.push(t)}}}if(t.deform)for(let e in t.deform){let s=t.deform[e],o=n.findSkin(e);for(let t in s){let e=s[t],a=n.findSlot(t).index;for(let t in e){let n=e[t],s=n[0];if(!s)continue;let l=o.getAttachment(a,t),c=l.bones,u=l.vertices,h=c?u.length/3*2:u.length,p=new oa(n.length,n.length,a,l),d=xl(s,"time",0);for(let t=0,e=0;;t++){let i,o=xl(s,"vertices",null);if(o){i=Po.newFloatArray(h);let t=xl(s,"offset",0);if(Po.arrayCopy(o,0,i,t,o.length),1!=r)for(let e=t,n=e+o.length;e<n;e++)i[e]*=r;if(!c)for(let t=0;t<h;t++)i[t]+=u[t]}else i=c?Po.newFloatArray(h):u;p.setFrame(t,d,i);let a=n[t+1];if(!a){p.shrink(e);break}let l=xl(a,"time",0),f=s.curve;f&&(e=bl(f,p,e,t,0,d,l,0,1,1)),d=l,s=a}i.push(p)}}}if(t.drawOrder){let e=new la(t.drawOrder.length),r=n.slots.length,s=0;for(let i=0;i<t.drawOrder.length;i++,s++){let o=t.drawOrder[i],a=null,l=xl(o,"offsets",null);if(l){a=Po.newArray(r,-1);let t=Po.newArray(r-l.length,0),e=0,i=0;for(let r=0;r<l.length;r++){let s=l[r],o=n.findSlot(s.slot).index;for(;e!=o;)t[i++]=e++;a[e+s.offset]=e++}for(;e<r;)t[i++]=e++;for(let e=r-1;e>=0;e--)-1==a[e]&&(a[e]=t[--i])}e.setFrame(s,xl(o,"time",0),a)}i.push(e)}if(t.events){let e=new aa(t.events.length),r=0;for(let i=0;i<t.events.length;i++,r++){let s=t.events[i],o=n.findEvent(s.name),a=new pl(Po.toSinglePrecision(xl(s,"time",0)),o);a.intValue=xl(s,"int",o.intValue),a.floatValue=xl(s,"float",o.floatValue),a.stringValue=xl(s,"string",o.stringValue),a.data.audioPath&&(a.volume=xl(s,"volume",1),a.balance=xl(s,"balance",0)),e.setFrame(r,a)}i.push(e)}let s=0;for(let t=0,e=i.length;t<e;t++)s=Math.max(s,i[t].getDuration());n.animations.push(new Do(e,i,s))}}class gl{constructor(t,e,n,r,i){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=r,this.inheritDeform=i}}function yl(t,e,n,r){let i=t[0],s=xl(i,"time",0),o=xl(i,"value",n)*r,a=0;for(let l=0;;l++){e.setFrame(l,s,o);let c=t[l+1];if(!c)return e.shrink(a),e;let u=xl(c,"time",0),h=xl(c,"value",n)*r;i.curve&&(a=bl(i.curve,e,a,l,0,s,u,o,h,r)),s=u,o=h,i=c}}function vl(t,e,n,r,i,s){let o=t[0],a=xl(o,"time",0),l=xl(o,n,i)*s,c=xl(o,r,i)*s,u=0;for(let h=0;;h++){e.setFrame(h,a,l,c);let p=t[h+1];if(!p)return e.shrink(u),e;let d=xl(p,"time",0),f=xl(p,n,i)*s,m=xl(p,r,i)*s,_=o.curve;_&&(u=bl(_,e,u,h,0,a,d,l,f,s),u=bl(_,e,u,h,1,a,d,c,m,s)),a=d,l=f,c=m,o=p}}function bl(t,e,n,r,i,s,o,a,l,c){if("stepped"==t)return e.setStepped(r),n;let u=i<<2,h=t[u],p=t[u+1]*c,d=t[u+2],f=t[u+3]*c;return e.setBezier(n,r,i,s,a,h,p,d,f,o,l),n+1}function xl(t,e,n){return void 0!==t[e]?t[e]:n}void 0===Math.fround&&(Math.fround=(Ua=new Float32Array(1),function(t){return Ua[0]=t,Ua[0]}));class wl{constructor(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}begin(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY}transform(t,e,n,r){let i=this.angle*Lo.degreesToRadians,s=t.x-this.worldX,o=t.y-this.worldY,a=Math.sqrt(s*s+o*o);if(a<this.radius){let e=wl.interpolation.apply(0,i,(this.radius-a)/this.radius),n=Math.cos(e),r=Math.sin(e);t.x=n*s-r*o+this.worldX,t.y=r*s+n*o+this.worldY}}end(){}}wl.interpolation=new class extends No{constructor(t){super(t)}applyInternal(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1}}(2);var Sl=__webpack_require__(175);class Ml extends Ca{constructor(t){super(t),this.texture=new Sl.Texture(t),this.texture.flipY=!1,this.texture.needsUpdate=!0}setFilters(t,e){this.texture.minFilter=Ml.toThreeJsTextureFilter(t),this.texture.magFilter=Ml.toThreeJsTextureFilter(e)}setWraps(t,e){this.texture.wrapS=Ml.toThreeJsTextureWrap(t),this.texture.wrapT=Ml.toThreeJsTextureWrap(e)}dispose(){this.texture.dispose()}static toThreeJsTextureFilter(t){if(t===Ba.Linear)return Sl.LinearFilter;if(t===Ba.MipMap)return Sl.LinearMipMapLinearFilter;if(t===Ba.MipMapLinearNearest)return Sl.LinearMipMapNearestFilter;if(t===Ba.MipMapNearestLinear)return Sl.NearestMipMapLinearFilter;if(t===Ba.MipMapNearestNearest)return Sl.NearestMipMapNearestFilter;if(t===Ba.Nearest)return Sl.NearestFilter;throw new Error("Unknown texture filter: "+t)}static toThreeJsTextureWrap(t){if(t===La.ClampToEdge)return Sl.ClampToEdgeWrapping;if(t===La.MirroredRepeat)return Sl.MirroredRepeatWrapping;if(t===La.Repeat)return Sl.RepeatWrapping;throw new Error("Unknown texture wrap: "+t)}}class Tl extends Sl.ShaderMaterial{constructor(t){let e={uniforms:{map:{type:"t",value:null}},vertexShader:"\n\t\t\t\tattribute vec4 color;\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tvarying vec4 vColor;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tvColor = color;\n\t\t\t\t\tgl_Position = projectionMatrix*modelViewMatrix*vec4(position,1.0);\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\t\tuniform sampler2D map;\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tvarying vec4 vColor;\n\t\t\t\tvoid main(void) {\n\t\t\t\t\tgl_FragColor = texture2D(map, vUv)*vColor;\n\t\t\t\t}\n\t\t\t",side:Sl.DoubleSide,transparent:!0,alphaTest:.5};t(e),super(e)}}class El extends Sl.Object3D{constructor(t,e=(t=>{})){super(),this.tempPos=new Oo,this.tempUv=new Oo,this.tempLight=new Bo,this.tempDark=new Bo,this.zOffset=.1,this.batches=new Array,this.nextBatchIndex=0,this.clipper=new ul,this.vertices=Po.newFloatArray(1024),this.tempColor=new Bo,this.materialCustomizer=e,this.skeleton=new sl(t);let n=new Ea(t);this.state=new fa(n)}update(t){let e=this.state,n=this.skeleton;e.update(t),e.apply(n),n.updateWorldTransform(),this.updateGeometry()}dispose(){for(var t=0;t<this.batches.length;t++)this.batches[t].dispose()}clearBatches(){for(var t=0;t<this.batches.length;t++)this.batches[t].clear(),this.batches[t].visible=!1;this.nextBatchIndex=0}nextBatch(){if(this.batches.length==this.nextBatchIndex){let t=new Al(10920,this.materialCustomizer);this.add(t),this.batches.push(t)}let t=this.batches[this.nextBatchIndex++];return t.visible=!0,t}updateGeometry(){this.clearBatches();let t=this.tempPos,e=this.tempUv,n=this.tempLight,r=this.tempDark,i=this.clipper,s=this.vertices,o=null,a=null,l=this.skeleton.drawOrder,c=this.nextBatch();c.begin();let u=0,h=this.zOffset;for(let p=0,d=l.length;p<d;p++){let d=i.isClipping()?2:El.VERTEX_SIZE,f=l[p];if(!f.bone.active){i.clipEndWithSlot(f);continue}let m=f.getAttachment(),_=null,g=null,y=0;if(m instanceof Ya){let t=m;_=t.color,s=this.vertices,y=4*d,t.computeWorldVertices(f.bone,s,0,d),o=El.QUAD_TRIANGLES,a=t.uvs,g=t.region.renderObject.page.texture}else{if(!(m instanceof Wa)){if(m instanceof $a){let t=m;i.clipStart(f,t);continue}i.clipEndWithSlot(f);continue}{let t=m;_=t.color,s=this.vertices,y=(t.worldVerticesLength>>1)*d,y>s.length&&(s=this.vertices=Po.newFloatArray(y)),t.computeWorldVertices(f,0,t.worldVerticesLength,s,0,d),o=t.triangles,a=t.uvs,g=t.region.renderObject.page.texture}}if(g){let l,p,m,v,b=f.bone.skeleton.color,x=f.color,w=b.a*x.a*_.a,S=this.tempColor;if(S.set(b.r*x.r*_.r,b.g*x.g*_.g,b.b*x.b*_.b,w),i.isClipping()){i.clipTriangles(s,y,o,o.length,a,S,null,!1);let c=i.clippedVertices,u=i.clippedTriangles;if(this.vertexEffect){let i=this.vertexEffect,s=c;for(let o=0,a=c.length;o<a;o+=d)t.x=s[o],t.y=s[o+1],n.setFromColor(S),r.set(0,0,0,0),e.x=s[o+6],e.y=s[o+7],i.transform(t,e,n,r),s[o]=t.x,s[o+1]=t.y,s[o+2]=n.r,s[o+3]=n.g,s[o+4]=n.b,s[o+5]=n.a,s[o+6]=e.x,s[o+7]=e.y}l=c,p=c.length,m=u,v=u.length}else{let i=s;if(this.vertexEffect){let s=this.vertexEffect;for(let o=0,l=0,c=y;o<c;o+=d,l+=2)t.x=i[o],t.y=i[o+1],n.setFromColor(S),r.set(0,0,0,0),e.x=a[l],e.y=a[l+1],s.transform(t,e,n,r),i[o]=t.x,i[o+1]=t.y,i[o+2]=n.r,i[o+3]=n.g,i[o+4]=n.b,i[o+5]=n.a,i[o+6]=e.x,i[o+7]=e.y}else for(let t=2,e=0,n=y;t<n;t+=d,e+=2)i[t]=S.r,i[t+1]=S.g,i[t+2]=S.b,i[t+3]=S.a,i[t+4]=a[e],i[t+5]=a[e+1];l=s,p=y,m=o,v=o.length}if(0==p||0==v){i.clipEndWithSlot(f);continue}c.canBatch(p,v)||(c.end(),c=this.nextBatch(),c.begin());let M=c.material;M.uniforms.map.value||(M.uniforms.map.value=g.texture),M.uniforms.map.value!=g.texture&&(c.end(),c=this.nextBatch(),c.begin(),M=c.material,M.uniforms.map.value=g.texture),M.needsUpdate=!0,c.batch(l,p,m,v,u),u+=h}i.clipEndWithSlot(f)}i.clipEnd(),c.end()}}El.QUAD_TRIANGLES=[0,1,2,2,3,0],El.VERTEX_SIZE=8;class Al extends Sl.Mesh{constructor(t=10920,e=(t=>{})){if(super(),this.verticesLength=0,this.indicesLength=0,t>10920)throw new Error("Can't have more than 10920 triangles per batch: "+t);let n=this.vertices=new Float32Array(t*Al.VERTEX_SIZE),r=this.indices=new Uint16Array(3*t),i=new Sl.BufferGeometry,s=this.vertexBuffer=new Sl.InterleavedBuffer(n,Al.VERTEX_SIZE);s.usage=WebGLRenderingContext.DYNAMIC_DRAW,i.setAttribute("position",new Sl.InterleavedBufferAttribute(s,3,0,!1)),i.setAttribute("color",new Sl.InterleavedBufferAttribute(s,4,3,!1)),i.setAttribute("uv",new Sl.InterleavedBufferAttribute(s,2,7,!1)),i.setIndex(new Sl.BufferAttribute(r,1)),i.getIndex().usage=WebGLRenderingContext.DYNAMIC_DRAW,i.drawRange.start=0,i.drawRange.count=0,this.geometry=i,this.material=new Tl(e)}dispose(){if(this.geometry.dispose(),this.material instanceof Sl.Material)this.material.dispose();else if(this.material)for(let t=0;t<this.material.length;t++){let e=this.material[t];e instanceof Sl.Material&&e.dispose()}}clear(){let t=this.geometry;return t.drawRange.start=0,t.drawRange.count=0,this.material.uniforms.map.value=null,this}begin(){this.verticesLength=0,this.indicesLength=0}canBatch(t,e){return!(this.indicesLength+e>=this.indices.byteLength/2||this.verticesLength+t>=this.vertices.byteLength/2)}batch(t,e,n,r,i=0){let s=this.verticesLength/Al.VERTEX_SIZE,o=this.vertices,a=this.verticesLength,l=0;for(;l<e;)o[a++]=t[l++],o[a++]=t[l++],o[a++]=i,o[a++]=t[l++],o[a++]=t[l++],o[a++]=t[l++],o[a++]=t[l++],o[a++]=t[l++],o[a++]=t[l++];this.verticesLength=a;let c=this.indices;for(a=this.indicesLength,l=0;l<r;a++,l++)c[a]=n[l]+s;this.indicesLength+=r}end(){this.vertexBuffer.needsUpdate=this.verticesLength>0,this.vertexBuffer.updateRange.offset=0,this.vertexBuffer.updateRange.count=this.verticesLength;let t=this.geometry;t.getIndex().needsUpdate=this.indicesLength>0,t.getIndex().updateRange.offset=0,t.getIndex().updateRange.count=this.indicesLength,t.drawRange.start=0,t.drawRange.count=this.indicesLength}}function $l(t){Ml.call(this,t.image),this.texture=t,this.texture.flipY=!1}function Cl(t,e,r,i){void 0===i&&(i=[]);var s=new ja(e,(function(t){for(var n=0;n<i.length;n++)if(i[n].name===t){var s=new $l(i[n].texture);break}n===i.length&&(s=new $l(new Ji(new Yi(r+"/"+t))),i.push({name:t,texture:s.texture}));var o=s.texture.image,a=s.texture.source;if(a.width>0&&a.height>0)o.width=a.width,o.height=a.height;else if(0!==o.naturalWidth&&0!==o.naturalHeight)o.width=o.naturalWidth,o.height=o.naturalHeight,a.width=o.width,a.height=o.height;else{var l=e.search("size: "),c=e.search("\nformat"),u=e.substring(l+6,c);u=u.split(","),o.width=parseInt(u[0]),o.height=parseInt(u[1])}return s})),o=new Ja(s),a=new _l(o).readSkeletonData(t);El.call(this,a),this.name="spine",this.type="SpineAnimation",this.scale.set(.01,.01,.01),this.json=t,this.atlas=e,this.textures=i,this.skin=this.getSkins().length>0?this.getSkins()[0].name:null,this.animation=this.getAnimations().length>0?this.getAnimations()[0].name:null,this.track=0,this.loop=!0,this.clock=new n.Clock,this.play()}function Bl(t,e,r,i,s,o){n.SpotLight.call(this,t,e,r,i,s,o),this.name="spotlight",this.castShadow=!0,this.shadow.camera.near=.05,this.shadow.camera.far=5e3,this.shadow.mapSize.width=512,this.shadow.mapSize.height=512}function Ll(t){n.Sprite.call(this,t),this.name="sprite"}Al.VERTEX_SIZE=9,$l.prototype=Object.create(Ml.prototype),Cl.prototype=Object.create(El.prototype),Cl.prototype.update=function(t){El.prototype.update.call(this,t),n.Object3D.prototype.update.call(this)},Cl.prototype.onBeforeRender=function(){this.state.update(this.clock.getDelta()),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform(),this.updateGeometry()},Cl.prototype.play=function(){null!==this.animation&&this.setAnimation(this.track,this.animation,this.loop),null!==this.skin&&this.setSkin(this.skin)},Cl.prototype.getAnimations=function(){return this.state.data.skeletonData.animations},Cl.prototype.setAnimation=function(t,e,n){try{void 0!==t&&(this.track=t),void 0!==e&&(this.animation=e),void 0!==n&&(this.loop=n),this.state.setAnimation(this.track,this.animation,this.loop)}catch(e){this.animation=null,console.warn("nunuStudio: Error setting spine animation "+name+" on track "+t)}},Cl.prototype.getSkins=function(){return this.state.data.skeletonData.skins},Cl.prototype.setSkin=function(t){try{this.skeleton.setSkinByName(t),this.skin=t}catch(e){this.skin=null,console.warn("nunuStudio: Error setting spine skin "+t)}},Cl.prototype.toJSON=function(t){var e=[],r=this,i=n.Object3D.prototype.toJSON.call(this,t,(function(t){for(var n=0;n<r.textures.length;n++){var i=r.textures[n].texture.toJSON(t);e.push({name:r.textures[n].name,texture:i.uuid})}}));return i.object.json=this.json,i.object.atlas=this.atlas,i.object.textures=e,null!==this.animation&&(i.object.animation=this.animation,i.object.track=this.track,i.object.loop=this.loop),null!==this.skin&&(i.object.skin=this.skin),i},Bl.prototype=Object.create(n.SpotLight.prototype),Bl.prototype.setTarget=function(t){this.target=t},Bl.prototype.updateShadowMap=function(){this.shadow.map.dispose(),this.shadow.map=null,this.shadow.camera.updateProjectionMatrix()},Bl.prototype.toJSON=function(t){var e=n.Light.prototype.toJSON.call(this,t);return e.object.target=this.target.uuid,e},Ll.prototype=Object.create(n.Sprite.prototype),Ll.prototype.dispose=function(){null!==this.material&&void 0!==this.material.dispose&&this.material.dispose(),n.Object3D.prototype.dispose.call(this)};var Rl=__webpack_require__(980);function Nl(t){n.Group.call(this),this.type="PythonScript",this.name="script",this.code=void 0!==t?t:Nl.DEFAULT,this.script={},this.program=null,this.scene=null}Nl.prototype=Object.create(n.Group.prototype),Nl.DEFAULT="def initialize(obj, scene, program, keyboard, mouse):\n\t# TODO <ADD CODE HERE>\n\tpass\n\ndef update(delta, obj, scene, program, keyboard, mouse):\n\t# TODO <ADD CODE HERE>\n\tpass",Nl.prototype.initialize=function(){for(var t=this;null!==t.parent;)(t=t.parent)instanceof Bc?this.scene=t:t instanceof Cc&&(this.program=t);n.Object3D.prototype.initialize.call(this),this.compileCode(this.code),void 0!==this.script.initialize&&this.script.initialize.call(this,this,this.scene,this.program,this.program.keyboard,this.program.mouse)},Nl.prototype.update=function(t){if(void 0!==this.script.onMouseOver){var e=this.scene.raycaster.intersectObjects(this.children,!0);e.length>0&&this.script.onMouseOver.call(this,e)}void 0!==this.script.update&&this.script.update.call(this,t,this,this.scene,this.program,this.program.keyboard,this.program.mouse),n.Object3D.prototype.update.call(this,t)},Nl.prototype.dispose=function(){void 0!==this.script.dispose&&this.script.dispose.call(this,this,this.scene,this.program,this.program.keyboard,this.program.mouse),n.Object3D.prototype.dispose.call(this)},Nl.prototype.resize=function(t,e){void 0!==this.script.onResize&&this.script.onResize.call(this,t,e,this,this.scene,this.program,this.program.keyboard,this.program.mouse)},Nl.prototype.appData=function(t){void 0!==this.script.onAppData&&this.script.onAppData.call(this,t,this,this.scene,this.program,this.program.keyboard,this.program.mouse)},Nl.prototype.compileCode=function(t){var e;try{e=(e=Rl.python_to_js(t)).substring(e.indexOf("\n")+1,e.lastIndexOf("\n"))}catch(t){throw new Error("Failed to transpile python into javascript code.",t)}for(var n=0;n<xo.METHODS.length;n++){var r=xo.METHODS[n];e+="\nif(this."+r+' == undefined && typeof $locals___main__["'+r+"\"] !== 'undefined'){this."+r+' = $locals___main__["'+r+'"];}'}var i=new Function(e);try{this.script=new i}catch(t){throw this.script={},console.warn("nunuStudio: Error initializing script code",t),new Error("Error initializing script code")}},Nl.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return e.object.code=this.code,e};var Pl=__webpack_require__(573),Il=__webpack_require__.n(Pl);function Ol(t,e,r,i){if(void 0===t.font)throw new Error("TextBitmap configuration font is required.");void 0===t.width&&(t.width=500),void 0===t.align&&(t.align=Ol.CENTER),void 0===t.lineHeight&&(t.lineHeight=t.font.common.lineHeight),void 0===t.letterSpacing&&(t.letterSpacing=5),void 0===t.text&&(t.text=""),this.config=t,this.uniforms={map:{type:"t",value:e},color:{type:"v3",value:new n.Color(void 0!==i?i:16777215)},smoothing:{type:"f",value:0},threshold:{type:"f",value:.4}},n.Mesh.call(this,Il()(this.config),null),this.name="text",this.type="TextBitmap",r=void 0!==r?r:Ol.BITMAP;var s=.01;Object.defineProperties(this,{fontScale:{get:function(){return s},set:function(t){s=t,this.updateGeometry()}},shader:{get:function(){return r},set:function(t){r=t,this.updateShader()}},texture:{get:function(){return this.uniforms.map.value},set:function(t){this.uniforms.map.value=t,this.material.needsUpdate=!0}},font:{get:function(){return this.config.font},set:function(t){this.config.font=t,this.updateGeometry()}},text:{get:function(){return this.config.text},set:function(t){this.config.text!==t&&(this.config.text=t,this.updateGeometry())}},lineHeight:{get:function(){return this.config.lineHeight},set:function(t){this.config.lineHeight=t,this.updateGeometry()}},letterSpacing:{get:function(){return this.config.letterSpacing},set:function(t){this.config.letterSpacing=t,this.updateGeometry()}},align:{get:function(){return this.config.align},set:function(t){this.config.align=t,this.updateGeometry()}},width:{get:function(){return this.config.width},set:function(t){this.config.width=t,this.updateGeometry()}},color:{get:function(){return this.uniforms.color.value},set:function(t){this.uniforms.color.value=t}},threshold:{get:function(){return this.uniforms.threshold.value},set:function(t){this.uniforms.threshold.value=t}},smoothing:{get:function(){return this.uniforms.smoothing.value},set:function(t){this.uniforms.smoothing.value=t}}}),this.updateGeometry(),this.updateShader(e)}function Fl(t,e){Xi.call(this,"text","TextFile"),this.format="string",this.encoding=void 0!==e?e:"txt",this.data=void 0!==t?t:""}function kl(t,e,n,r,i,s,o,a,l,c){oo.call(this,kl.EMPTY_GEOMETRY,e),this.name="text",this.type="TextMesh",this.font=void 0!==n?n:null,this.extruded=void 0===c||c,this.size=void 0!==a?a:1,this.height=void 0!==r?r:.5,this.curveSegments=void 0!==l?l:15,this.bevel=void 0!==i&&i,this.bevelThickness=void 0!==s?s:.1,this.bevelSize=void 0!==o?o:.05,void 0!==t&&(t="text"),Object.defineProperties(this,{text:{get:function(){return t},set:function(e){t!==e&&(t=e,this.updateGeometry())}}}),this.updateGeometry()}function Dl(t,e,r,i,s,o,a,l,c,u,h){n.Texture.call(this,document.createElement("canvas"),r,i,s,o,a,l,c,u,h),this.name="canvas",this.category="Canvas",this.format=n.RGBAFormat,Object.defineProperties(this,{width:{get:function(){return this.image.width},set:function(t){this.image.width=t}},height:{get:function(){return this.image.height},set:function(t){this.image.height=t}}}),this.width=void 0!==t?t:1,this.height=void 0!==e?e:1,this.context=this.image.getContext("2d")}function Ul(){this.texture=new Dl,this.canvas=this.texture.image;var t=new n.SpriteMaterial({map:this.texture,color:16777215,transparent:!0,alphaTest:.4,depthTest:!0,depthWrite:!0,sizeAttenuation:!0});n.Sprite.call(this,t),this.name="sprite",this.type="CanvasSprite",Object.defineProperties(this,{sizeAttenuation:{get:function(){return this.material.sizeAttenuation},set:function(t){this.material.sizeAttenuation=t,this.material.needsUpdate=!0}}})}function zl(){Ul.call(this),this.name="text",this.type="TextSprite";var t="",e="#FFFFFF",n=!0,r="#000000",i=1,s=32,o=zl.CENTER,a="arial";Object.defineProperties(this,{font:{get:function(){return a},set:function(t){a=t,this.drawText()}},align:{get:function(){return o},set:function(t){o=t,this.drawText()}},color:{get:function(){return e},set:function(t){e=t,this.drawText()}},text:{get:function(){return t},set:function(e){e!==t&&(t=e,this.drawText())}},outline:{get:function(){return n},set:function(t){n=t,this.drawText()}},outlineColor:{get:function(){return r},set:function(t){r=t,this.drawText()}},outlineWidth:{get:function(){return i},set:function(t){i=t,this.drawText()}},resolution:{get:function(){return s},set:function(t){s=t,this.drawText()}}}),this.text="text"}Ol.prototype=Object.create(n.Mesh.prototype),Ol.prototype.constructor=Ol,Ol.BITMAP=100,Ol.SDF=101,Ol.MSDF=102,Ol.LEFT="left",Ol.CENTER="center",Ol.RIGHT="right",Ol.prototype.setText=function(t){this.text=t},Ol.prototype.updateShader=function(){var t;t=this.shader===Ol.SDF?"/**\n * Shader object used to render single channel SDF data.\n *\n * Contains only the fragment shader code, the vertex is the same for every render mode.\n * \n * Details about signed distance fields for vetorial shapes rendering.\n *    - https:// steamcdn-a.akamaihd.net/apps/valve/2007/SIGGRAPH2007_AlphaTestedMagnification.pdf\n */\nvarying vec2 vUv;\nuniform sampler2D map;\nuniform vec3 color;\nuniform float smoothing;\nuniform float threshold;\n\nvoid main()\n{\n\tfloat distance = texture2D(map, vUv).a;\n\tfloat alpha = smoothstep(threshold - smoothing, threshold + smoothing, distance);\n\tgl_FragColor = vec4(color, alpha);\n}":this.shader===Ol.MSDF?"/*\n * Shader object used to render single channel MSDF data.\n *\n * Contains only the fragment shader code, the vertex is the same for every render mode.\n * \n * Details about MultiChannel Signed Distance Fields for vetorial shapes rendering.\n *    - https:// onlinelibrary.wiley.com/doi/full/10.1111/cgf.13265\n */\n\nvarying vec2 vUv;\nuniform sampler2D map;\nuniform vec3 color;\nuniform float smoothing;\nuniform float threshold;\n\nfloat median(float r, float g, float b)\n{\n\treturn max(min(r, g), min(max(r, g), b));\n}\n\nvoid main()\n{\n\tvec3 smpl = texture2D(map, vUv).rgb;\n\tfloat sigDist = median(smpl.r, smpl.g, smpl.b) - 0.5;\n\tfloat alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);\n\tgl_FragColor = vec4(color, 1.0 - alpha);\n}\n":"/**\n * Shader object used to render the bitmap directly without any processing.\n *\n * Contains only the fragment shader code, the vertex is the same for every render mode.\n */\nvarying vec2 vUv;\nuniform sampler2D map;\n\nvoid main()\n{\n\tgl_FragColor = texture2D(map, vUv);\n}\n",this.material=new n.ShaderMaterial({uniforms:this.uniforms,fragmentShader:t,vertexShader:"/**\n * Vertex shader used to draw the text, is responsible for applying the billboard effect by removing the rotation from the transformation matrix.\n */\n#define BILLBOARD 0 \n\nvarying vec2 vUv;\n\nvoid main()\n{\n\tvUv = uv;\n\t\n\t#if BILLBOARD\n\t\tmat4 model = modelViewMatrix; \n\t\tmodel[0][0] = 1.0;\n\t\tmodel[0][1] = 0.0;\n\t\tmodel[0][2] = 0.0;\n\t\t\n\t\tmodel[1][0] = 0.0;\n\t\tmodel[1][1] = 1.0;\n\t\tmodel[1][2] = 0.0;\n\t\t\n\t\tmodel[2][0] = 0.0;\n\t\tmodel[2][1] = 0.0;\n\t\tmodel[2][2] = 1.0;\n\t\t\n\t\tgl_Position = projectionMatrix * model * vec4(position, 1.0);\n\t#else\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t#endif\n\t\n}",side:n.DoubleSide,transparent:!0,depthTest:!0}),this.material.extensions.derivatives=this.shader===Ol.MSDF},Ol.prototype.updateGeometry=function(){if(this.geometry.update(this.config),1!==this.fontScale)for(var t=this.geometry.attributes.position.array,e=0;e<t.length;e++)t[e]*=this.fontScale},Ol.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return e.object.texture=this.texture.toJSON(t).uuid,e.object.fontScale=this.fontScale,e.object.shader=this.shader,e.object.text=this.text,e.object.font=this.font,e.object.lineHeight=this.lineHeight,e.object.letterSpacing=this.letterSpacing,e.object.align=this.align,e.object.width=this.width,e.object.color=this.color,e.object.threshold=this.threshold,e.object.smoothing=this.smoothing,e},Ol.fromJSON=function(t,e){var n=new Ol(t,e,t.shader);return n.color=t.color,n.threshold=t.threshold,n.smoothing=t.smoothing,n.fontScale=t.fontScale,n},Fl.prototype=Object.create(Xi.prototype),Fl.extensions=[".js",".txt",".glsl",".json",".xml",".yaml",".csv",".css",".html"],Fl.fileIsText=function(t){t=t.name.toLocaleLowerCase();for(var e=0;e<Fl.extensions.length;e++)if(t.endsWith(Fl.extensions[e]))return!0;return!1},Fl.prototype.toJSON=function(t){if(void 0!==t.resources[this.uuid])return t.resources[this.uuid];var e=Xi.prototype.toJSON.call(this,t);return e.encoding=this.encoding,e.data=this.data,e.format=this.format,t.resources[this.uuid]=e,e},kl.prototype=Object.create(oo.prototype),kl.EMPTY_GEOMETRY=new n.Geometry,kl.prototype.setFont=function(t){this.font!==t&&(this.font=t,this.updateGeometry())},kl.prototype.setText=function(t){this.text=t},kl.prototype.updateGeometry=function(){if(null!==this.font){if(void 0!==this.geometry&&this.geometry.dispose(),!0!==this.font.isFont)return console.warn("nunuStudio: Font parameter is not an instance of Font."),void(this.geometry=kl.EMPTY_GEOMETRY);var t=this.font.generateShapes(this.text,this.size);this.extruded?(this.geometry=new n.ExtrudeBufferGeometry(t,{curveSegments:this.curveSegments,depth:this.height,bevelEnabled:this.bevel,bevelSize:this.bevelSize,bevelThickness:this.bevelThickness}),this.geometry.computeVertexNormals()):this.geometry=new n.ShapeBufferGeometry(t,this.curveSegments)}},kl.prototype.clone=function(){return new kl(this.text,this.material,this.font,this.height,this.bevel,this.bevelThickness,this.bevelSize,this.size,this.curveSegments)},kl.prototype.toJSON=function(t){var e=this.geometry;this.geometry=void 0;var r=this.font,i=n.Object3D.prototype.toJSON.call(this,t,(function(t,e){r=r.toJSON(t)}));return i.object.text=this.text,i.object.font=r.uuid,i.object.size=this.size,i.object.curveSegments=this.curveSegments,i.object.height=this.height,i.object.bevel=this.bevel,i.object.bevelThickness=this.bevelThickness,i.object.bevelSize=this.bevelSize,i.object.extruded=this.extruded,this.geometry=e,i},Dl.prototype=Object.create(n.Texture.prototype),Dl.prototype.constructor=Dl,Dl.prototype.isCanvasTexture=!0,Dl.prototype.placeholder=function(){this.context.fillStyle="#000000",this.context.fillRect(0,0,this.width,this.height),this.context.font="Normal "+Math.round(this.width/12)+"px Arial",this.context.textAlign="center",this.context.fillStyle="#FF0000",this.context.fillText("Canvas Texture",this.width/2,this.height/2),this.needsUpdate=!0},Dl.prototype.clear=function(t){void 0===t?this.context.clearRect(0,0,width,height):(this.context.fillStyle=t,this.context.fillRect(0,0,this.width,this.height))},Dl.prototype.toJSON=function(t){var e=n.Texture.prototype.toJSON.call(this,t);return e.width=this.width,e.height=this.height,e},Ul.prototype=Object.create(n.Sprite.prototype),zl.prototype=Object.create(Ul.prototype),zl.LEFT="left",zl.CENTER="center",zl.RIGHT="right",zl.prototype.drawText=function(){var t=this.resolution,e=.8*t,r=this.texture.context;r.font=e+"px "+this.font;var i=r.measureText(this.text).width,s=n.Math.ceilPowerOfTwo(i),o=s/t;this.texture.width=s,this.texture.height=t,r.clearRect(0,0,s,t),0!==this.text.length&&(r.font=e+"px "+this.font,r.textAlign=this.align,r.textBaseline="middle",r.fillStyle=this.color,r.fillText(this.text,s/2,t/2),!0===this.outline&&(r.lineWidth=this.outlineWidth,r.strokeStyle=this.outlineColor,r.strokeText(this.text,s/2,t/2)),this.scale.x=o*this.scale.y,this.texture.needsUpdate=!0)},zl.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return e.object.text=this.text,e.object.color=this.color,e.object.outline=this.outline,e.object.outlineColor=this.outlineColor,e.object.outlineWidth=this.outlineWidth,e.object.resolution=this.resolution,e.object.align=this.align,e.object.font=this.font,e},zl.fromJSON=function(t){var e=new zl;return e.text=t.text,e.color=t.color,e.outline=t.outline,e.outlineColor=t.outlineColor,e.outlineWidth=t.outlineWidth,e.resolution=t.resolution,e.align=t.align,e.font=t.font,e};var jl=__webpack_require__(412);function Gl(){n.Mesh.call(this,new n.BufferGeometry,new n.MeshBasicMaterial({depthWrite:!1,colorWrite:!1})),this.name="billboard",this.type="BillboardGroup"}function Hl(t){this.manager=void 0!==t?t:n.DefaultLoadingManager,this.textures={}}function Vl(t){this.manager=void 0!==t?t:n.DefaultLoadingManager,this.path="",this.crossOrigin="Anonymous"}function Wl(t,e,r,i,s,o){n.BufferGeometry.call(this),this.type="TerrainBufferGeometry",this.parameters={width:t||1,height:e||1,widthSegments:r||10,heightSegments:i||10,scale:s||1},this.image=o,this.generate()}function ql(t,e,r,i,s){n.BufferGeometry.call(this),this.type="RoundedBoxBufferGeometry",s=isNaN(s)?1:Math.max(1,Math.floor(s)),t=isNaN(t)?1:t,e=isNaN(e)?1:e,r=isNaN(r)?1:r,i=isNaN(i)?.15:i;var o=t/2-(i=Math.min(i,Math.min(t,Math.min(e,Math.min(r)))/2)),a=e/2-i,l=r/2-i;this.parameters={width:t,height:e,depth:r,radius:i,radiusSegments:s};var c=s+1,u=c*s+1<<3,h=new n.BufferAttribute(new Float32Array(3*u),3),p=new n.BufferAttribute(new Float32Array(3*u),3),d=[],f=[],m=(new n.Vector3,new n.Vector3),_=[],g=[],y=[],v=c*s,b=v+1;!function(){for(var t=[new n.Vector3(1,1,1),new n.Vector3(1,1,-1),new n.Vector3(-1,1,-1),new n.Vector3(-1,1,1),new n.Vector3(1,-1,1),new n.Vector3(1,-1,-1),new n.Vector3(-1,-1,-1),new n.Vector3(-1,-1,1)],e=0;e<8;e++)d.push([]),f.push([]);for(var r=Math.PI/2,c=new n.Vector3(o,a,l),u=0;u<=s;u++){var h=u/s*r,p=Math.cos(h),y=Math.sin(h);if(u!==s)for(var v=0;v<=s;v++){var b=v/s*r;m.x=p*Math.cos(b),m.y=y,m.z=p*Math.sin(b),x=m.clone().multiplyScalar(i).add(c),d[0].push(x),_.push(x),w=m.clone().normalize(),f[0].push(w),g.push(w)}else{m.set(0,1,0);var x=m.clone().multiplyScalar(i).add(c);d[0].push(x),_.push(x);var w=m.clone();f[0].push(w),g.push(w)}}for(var S=1;S<8;S++)for(e=0;e<d[0].length;e++)x=d[0][e].clone().multiply(t[S]),d[S].push(x),_.push(x),w=f[0][e].clone().multiply(t[S]),f[S].push(w),g.push(w)}(),function(){var t=v,e=v+b,n=v+2*b,r=v+3*b;y.push(t,e,n,t,n,r),t=v+4*b,e=v+5*b,n=v+6*b,r=v+7*b,y.push(t,n,e,t,r,n),t=0,e=b,n=4*b,r=5*b,y.push(t,n,e,e,n,r),t=2*b,e=3*b,n=6*b,r=7*b,y.push(t,n,e,e,n,r),t=s,e=s+3*b,n=s+4*b,r=s+7*b,y.push(t,e,n,e,r,n),t=s+b,e=s+2*b,n=s+5*b,r=s+6*b,y.push(t,n,e,e,n,r)}(),function(){for(var t=[!0,!1,!0,!1,!1,!0,!1,!0],e=c*(s-1),n=0;n<8;n++){for(var r=b*n,i=0;i<s-1;i++)for(var o=i*c,a=(i+1)*c,l=0;l<s;l++){var u=l+1,h=r+o+l,p=r+o+u,d=r+a+l,f=r+a+u;t[n]?y.push(h,d,p,p,d,f):y.push(h,p,d,p,f,d)}for(l=0;l<s;l++)h=r+e+l,p=r+e+l+1,d=r+v,t[n]?y.push(h,d,p):y.push(h,p,d)}}(),function(){for(var t=0;t<4;t++)for(var e=t*b,n=4*b+e,r=!0&t,i=0;i<s;i++){var o=i+1,a=e+i,l=e+o,c=n+i,u=n+o;r?y.push(a,c,l,l,c,u):y.push(a,l,c,l,u,c)}}(),function(){for(var t=s-1,e=[0,1,4,5],n=[3,2,7,6],r=[0,1,1,0],i=0;i<4;i++)for(var o=e[i]*b,a=n[i]*b,l=0;l<=t;l++){var u=o+s+l*c,h=o+(l!==t?s+(l+1)*c:b-1),p=a+s+l*c,d=a+(l!==t?s+(l+1)*c:b-1);r[i]?y.push(u,p,h,h,p,d):y.push(u,h,p,h,d,p)}}(),function(){for(var t=[0,2,4,6],e=[1,3,5,7],n=0;n<4;n++)for(var r=b*t[n],i=b*e[n],o=1>=n,a=0;a<s;a++){var l=a*c,u=(a+1)*c,h=r+l,p=r+u,d=i+l,f=i+u;o?y.push(h,d,p,p,d,f):y.push(h,p,d,p,f,d)}}();for(var x=0,w=0;w<_.length;w++)h.setXYZ(x,_[w].x,_[w].y,_[w].z),p.setXYZ(x,g[w].x,g[w].y,g[w].z),x++;this.setIndex(new n.BufferAttribute(new Uint16Array(y),1)),this.addAttribute("position",h),this.addAttribute("normal",p)}function Xl(t,e,r,i,s,o,a,l,c){n.BufferGeometry.call(this),this.type="CapsuleBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:i,heightSegments:s,capsTopSegments:o,capsBottomSegments:a,thetaStart:l,thetaLength:c},t=void 0!==t?t:1,e=void 0!==e?e:1,r=void 0!==r?r:2,i=Math.floor(i)||8,s=Math.floor(s)||1,o=Math.floor(o)||2,a=Math.floor(a)||2,l=void 0!==l?l:0,c=void 0!==c?c:2*Math.PI;var u=Math.acos((e-t)/r),h=(i+1)*(s+1+a+o),p=i*(s+a+o)*2*3,d=new n.BufferAttribute(new(p>65535?Uint32Array:Uint16Array)(p),1),f=new n.BufferAttribute(new Float32Array(3*h),3),m=new n.BufferAttribute(new Float32Array(3*h),3),_=new n.BufferAttribute(new Float32Array(2*h),2),g=0,y=0,v=[],b=r/2;!function(){var h,p,x=new n.Vector3,w=new n.Vector3,S=Math.cos(u),M=Math.sin(u),T=new n.Vector2(t*M,b+t*S).sub(new n.Vector2(e*M,e*S-b)).length(),E=t*u+T+e*(Math.PI/2-u),A=0;for(p=0;p<=o;p++){var $=[],C=Math.PI/2-u*(p/o);A+=t*u/o;var B=Math.cos(C),L=Math.sin(C),R=B*t;for(h=0;h<=i;h++){var N=(k=h/i)*c+l,P=Math.sin(N),I=Math.cos(N);w.x=R*P,w.y=b+L*t,w.z=R*I,f.setXYZ(g,w.x,w.y,w.z),x.set(B*P,L,B*I),m.setXYZ(g,x.x,x.y,x.z),_.setXY(g,k,1-A/E),$.push(g),g++}v.push($)}var O=r+S*t-S*e,F=M*(e-t)/O;for(p=1;p<=s;p++){for($=[],A+=T/s,R=M*(p*(e-t)/s+t),h=0;h<=i;h++)N=(k=h/i)*c+l,P=Math.sin(N),I=Math.cos(N),w.x=R*P,w.y=b+S*t-p*O/s,w.z=R*I,f.setXYZ(g,w.x,w.y,w.z),x.set(P,F,I).normalize(),m.setXYZ(g,x.x,x.y,x.z),_.setXY(g,k,1-A/E),$.push(g),g++;v.push($)}for(p=1;p<=a;p++){for($=[],C=Math.PI/2-u-(Math.PI-u)*(p/a),A+=e*u/a,B=Math.cos(C),L=Math.sin(C),R=B*e,h=0;h<=i;h++){var k;N=(k=h/i)*c+l,P=Math.sin(N),I=Math.cos(N),w.x=R*P,w.y=L*e-b,w.z=R*I,f.setXYZ(g,w.x,w.y,w.z),x.set(B*P,L,B*I),m.setXYZ(g,x.x,x.y,x.z),_.setXY(g,k,1-A/E),$.push(g),g++}v.push($)}for(h=0;h<i;h++)for(p=0;p<o+s+a;p++){var D=v[p][h],U=v[p+1][h],z=v[p+1][h+1],j=v[p][h+1];d.setX(y,D),y++,d.setX(y,U),y++,d.setX(y,j),y++,d.setX(y,U),y++,d.setX(y,z),y++,d.setX(y,j),y++}}(),this.setIndex(d),this.setAttribute("position",f),this.setAttribute("normal",m),this.setAttribute("uv",_)}function Yl(t,e,r){var i=this.compile(t);n.ParametricBufferGeometry.call(this,i,e,r),this.type="ParametricBufferGeometry",this.parameters={code:t,slices:e,stacks:r}}function Jl(t){this.manager=void 0!==t?t:n.DefaultLoadingManager,this.withCredentials=!1}function Zl(t){this.manager=void 0!==t?t:n.DefaultLoadingManager,this.shapes={},this.images={}}function Ql(t){this.manager=void 0!==t?t:n.DefaultLoadingManager}function Kl(t){this.manager=void 0!==t?t:n.DefaultLoadingManager}function tc(t,e,r,i,s){var o=document.createElement("video");o.autoplay=!0,o.loop=!0,n.Texture.call(this,o,t,e,r,n.LinearFilter,n.LinearFilter,n.RGBFormat,i,s);var a=this;this.generateMipmaps=!1,this.disposed=!1,this.name="webcam",this.category="Webcam",this.mode=tc.USER,this.stream=null,this.connect(),requestAnimationFrame((function t(){o.readyState>=o.HAVE_CURRENT_DATA&&(a.needsUpdate=!0),a.disposed||requestAnimationFrame(t)}))}function ec(t,e){Xi.call(this,"video","Video"),void 0!==t&&(t instanceof ArrayBuffer?this.loadArrayBufferData(t,e):Hi.isBase64(t)?(this.encoding=Hi.getFileFormat(t),this.format="base64",this.data=t):this.loadArrayBufferData(qi.readFileArrayBuffer(t),qi.getFileExtension(t)))}function nc(t,e,r,i,s,o){n.Texture.call(this,document.createElement("video"),e,r,i,n.LinearFilter,n.LinearFilter,n.RGBFormat,s,o),this.disposed=!1,this.generateMipmaps=!1,this.name="video",this.category="Video",this.autoplay=!0,this.loop=!0,this.playbackRate=1,this.volume=1,this.image.crossOrigin="anonymous",this.image.autoplay=this.autoplay,this.image.playbackRate=this.playbackRate,this.image.loop=this.loop,this.image.volume=this.volume,this.video=null,this.setVideo(t);var a=this;!function t(){a.disposed||(a.image.readyState>=a.image.HAVE_CURRENT_DATA&&(a.needsUpdate=!0),requestAnimationFrame(t))}()}function rc(t,e,r,i,s,o,a){Ji.call(this,t,s,n.RepeatWrapping,n.RepeatWrapping,n.LinearFilter,n.LinearFilter,n.RGBFormat,o,a),this.name="animation",this.category="SpriteSheet",this.disposed=!1,this.format=this.source.hasTransparency()?n.RGBAFormat:n.RGBFormat,this.repeat.set(1/e,1/r),this.loop=!0,this.animationSpeed=.1,this._totalFrames=i,this._beginFrame=0,this._endFrame=0,this._framesHorizontal=e,this._framesVertical=r;var l=this;Object.defineProperties(this,{framesHorizontal:{get:function(){return this._framesHorizontal},set:function(t){this._framesHorizontal=t,this.repeat.x=1/t,this.totalFrames=this._framesHorizontal*this._framesVertical}},framesVertical:{get:function(){return this._framesVertical},set:function(t){this._framesVertical=t,this.repeat.y=1/t,this.totalFrames=this._framesHorizontal*this._framesVertical}},endFrame:{get:function(){return this._endFrame},set:function(t){t>this._totalFrames&&(t=this._totalFrames),this._endFrame=t}},beginFrame:{get:function(){return this._beginFrame},set:function(t){t<0&&(t=0),this.currentFrame=t,this._beginFrame=t}},totalFrames:{get:function(){return this._totalFrames},set:function(t){this._beginFrame=0,this._endFrame=t,this._totalFrames=t}}}),this.currentFrame=0,function t(){l.disposed||(l.step(),setTimeout(t,1e3*l.animationSpeed))}()}function ic(t,e,r,i,s,o,a,l,c,u,h,p){n.Texture.call(this,null,o,a,l,c,u,i,s,h,p),this.category="DataTexture",this.image={data:t||null,width:e||1,height:r||1},this.magFilter=void 0!==c?c:NearestFilter,this.minFilter=void 0!==u?u:NearestFilter,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}function sc(t,e,r,i,s,o,a,l,c,u,h,p){n.Texture.call(this,null,o,a,l,c,u,i,s,h,p),this.category="Compressed",this.image={width:e,height:r},this.mipmaps=t,this.isCubeTexture=!1,this.flipY=!1,this.generateMipmaps=!1}function oc(t){this.manager=void 0!==t?t:n.DefaultLoadingManager,this.path="",this.crossOrigin="anonymous",this.images=[],this.videos=[],this.fonts=[]}function ac(t){this.manager=void 0!==t?t:n.DefaultLoadingManager}function lc(t){i.call(this),this.manager=void 0!==t?t:n.DefaultLoadingManager,this.texturePath=""}Gl.prototype=Object.create(n.Mesh.prototype),Gl.prototype.constructor=Gl,Gl.prototype.isScene=!0,Gl.prototype.onBeforeRender=function(t,e,n,r,i,s){var o=new jl.Quaternion;n.getWorldQuaternion(o),this.quaternion.copy(o)},Hl.prototype.load=function(t,e,n,r){var i=this;new FileLoader(i.manager).load(t,(function(t){e(i.parse(JSON.parse(t)))}),n,r)},Hl.prototype.setTextures=function(t){this.textures=t},Hl.prototype.parse=function(t){var e=n.MaterialLoader.prototype.parse.call(this,t);if(void 0!==t.materials)for(var r=0,i=t.materials.length;r<i;r++)e.materials.push(this.parse(t.materials[r]));return e},Vl.prototype.setCrossOrigin=function(t){return this.crossOrigin=t,this},Vl.prototype.setPath=function(t){return this.path=t,this},Vl.prototype.loadJSON=function(t,e,r,i){var s=this;new n.FileLoader(this.manager).load(t,(function(t){e(s.parse(JSON.parse(t)))}),r,i)},Vl.prototype.parse=function(t){var e=new Yi(void 0!==t.data.toArrayBuffer?t.data.toArrayBuffer():t.data,t.encoding);return e.name=t.name,e.uuid=t.uuid,void 0!==t.width&&(e.width=t.width,e.height=t.height),e},Wl.prototype=Object.create(n.BufferGeometry.prototype),Wl.constructor=Wl,Wl.prototype.generate=function(){var t=this.parameters.width,e=this.parameters.height,r=this.parameters.widthSegments,i=this.parameters.heightSegments,s=this.parameters.scale,o=this;this.image.getImageData((function(a,l,c){var u=t/2,h=e/2,p=Math.floor(r)||1,d=p+1,f=Math.floor(i)||1,m=t/p,_=e/f,g=[],y=[],v=[],b=[],x=l/(t+1),w=c/(e+1);function S(t,e){var n=Math.round((t+u)*x),r=Math.round((e+h)*w)*(4*l)+4*n;return a.data[r]/255}for(var M=0;M<=f;M++)for(var T=M*_-h,E=0;E<=p;E++){var A=E*m-u,$=S(A,T)*s;y.push(A,$,T),v.push(0,1,0),b.push(E/p),b.push(1-M/f)}for(M=0;M<f;M++)for(E=0;E<p;E++){var C=E+d*M,B=E+d*(M+1),L=E+1+d*(M+1),R=E+1+d*M;g.push(C,B,R),g.push(B,L,R)}o.setIndex(g),o.setAttribute("position",new n.Float32BufferAttribute(y,3)),o.setAttribute("normal",new n.Float32BufferAttribute(v,3)),o.setAttribute("uv",new n.Float32BufferAttribute(b,2)),o.computeVertexNormals(),o.boundingBox=null,o.boundingSphere=null}))},Wl.prototype.toJSON=function(){var t=n.BufferGeometry.prototype.toJSON.call(this);return t.image=this.image.uuid,t},ql.prototype=Object.create(n.BufferGeometry.prototype),ql.constructor=ql,Xl.prototype=Object.create(n.BufferGeometry.prototype),Xl.prototype.constructor=Xl,Yl.prototype=Object.create(n.ParametricBufferGeometry.prototype),Yl.prototype.compile=function(t){try{return new Function("u, v, target","target = target || new Vector3();\n"+t)}catch(t){console.error("nunuStudio: Error occured while compiling ParametricBufferGeometry code.",t)}return function(t,e,r){return r||new n.Vector3}},Jl.prototype.load=function(t,e,r,i){var s=this,o=void 0===this.path?LoaderUtils.extractUrlBase(t):this.path,a=new n.FileLoader(this.manager);a.setPath(this.path),a.setWithCredentials(this.withCredentials),a.load(t,(function(n){var r=JSON.parse(n),i=r.metadata;if(void 0!==i){var a=i.type;if(void 0!==a&&"object"===a.toLowerCase())return void console.error("nunuStudio: LegacyGeometryLoader: "+t+" should be loaded with ObjectLoader instead.")}var l=s.parse(r,o);e(l.geometry,l.materials)}),r,i)},Jl.prototype.setPath=function(t){return this.path=t,this},Jl.prototype.setResourcePath=function(t){return this.resourcePath=t,this},Jl.prototype.setCrossOrigin=function(t){return this.crossOrigin=t,this},Jl.prototype.parse=function(t,e){void 0!==t.data&&(t=t.data),void 0!==t.scale?t.scale=1/t.scale:t.scale=1;var r=new n.Geometry;return function(t,e){function r(t,e){return t&1<<e}var i,s,o,a,l,c,u,h,p,d,f,m,_,g,y,v,b,x,w,S,M,T,E,A,$,C,B,L=t.faces,R=t.vertices,N=t.normals,P=t.colors,I=t.scale,O=0;if(void 0!==t.uvs){for(i=0;i<t.uvs.length;i++)t.uvs[i].length&&O++;for(i=0;i<O;i++)e.faceVertexUvs[i]=[]}for(a=0,l=R.length;a<l;)(x=new n.Vector3).x=R[a++]*I,x.y=R[a++]*I,x.z=R[a++]*I,e.vertices.push(x);for(a=0,l=L.length;a<l;)if(f=r(d=L[a++],0),m=r(d,1),_=r(d,3),g=r(d,4),y=r(d,5),v=r(d,6),b=r(d,7),f){if((S=new n.Face3).a=L[a],S.b=L[a+1],S.c=L[a+3],(M=new n.Face3).a=L[a+1],M.b=L[a+2],M.c=L[a+3],a+=4,m&&(p=L[a++],S.materialIndex=p,M.materialIndex=p),o=e.faces.length,_)for(i=0;i<O;i++)for(A=t.uvs[i],e.faceVertexUvs[i][o]=[],e.faceVertexUvs[i][o+1]=[],s=0;s<4;s++)C=A[2*(h=L[a++])],B=A[2*h+1],$=new n.Vector2(C,B),2!==s&&e.faceVertexUvs[i][o].push($),0!==s&&e.faceVertexUvs[i][o+1].push($);if(g&&(u=3*L[a++],S.normal.set(N[u++],N[u++],N[u]),M.normal.copy(S.normal)),y)for(i=0;i<4;i++)u=3*L[a++],E=new n.Vector3(N[u++],N[u++],N[u]),2!==i&&S.vertexNormals.push(E),0!==i&&M.vertexNormals.push(E);if(v&&(T=P[c=L[a++]],S.color.setHex(T),M.color.setHex(T)),b)for(i=0;i<4;i++)T=P[c=L[a++]],2!==i&&S.vertexColors.push(new Color(T)),0!==i&&M.vertexColors.push(new Color(T));e.faces.push(S),e.faces.push(M)}else{if((w=new n.Face3).a=L[a++],w.b=L[a++],w.c=L[a++],m&&(p=L[a++],w.materialIndex=p),o=e.faces.length,_)for(i=0;i<O;i++)for(A=t.uvs[i],e.faceVertexUvs[i][o]=[],s=0;s<3;s++)C=A[2*(h=L[a++])],B=A[2*h+1],$=new n.Vector2(C,B),e.faceVertexUvs[i][o].push($);if(g&&(u=3*L[a++],w.normal.set(N[u++],N[u++],N[u])),y)for(i=0;i<3;i++)u=3*L[a++],E=new n.Vector3(N[u++],N[u++],N[u]),w.vertexNormals.push(E);if(v&&(c=L[a++],w.color.setHex(P[c])),b)for(i=0;i<3;i++)c=L[a++],w.vertexColors.push(new Color(P[c]));e.faces.push(w)}}(t,r),function(t,e){var n=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var r=0,i=t.skinWeights.length;r<i;r+=n){var s=t.skinWeights[r],o=n>1?t.skinWeights[r+1]:0,a=n>2?t.skinWeights[r+2]:0,l=n>3?t.skinWeights[r+3]:0;e.skinWeights.push(new Vector4(s,o,a,l))}if(t.skinIndices)for(r=0,i=t.skinIndices.length;r<i;r+=n){var c=t.skinIndices[r],u=n>1?t.skinIndices[r+1]:0,h=n>2?t.skinIndices[r+2]:0,p=n>3?t.skinIndices[r+3]:0;e.skinIndices.push(new Vector4(c,u,h,p))}e.bones=t.bones,e.bones&&e.bones.length>0&&(e.skinWeights.length!==e.skinIndices.length||e.skinIndices.length!==e.vertices.length)&&console.warn("nunuStudio: When skinning, number of vertices ("+e.vertices.length+"), skinIndices ("+e.skinIndices.length+"), and skinWeights ("+e.skinWeights.length+") should match.")}(t,r),function(t,e){var r=t.scale;if(void 0!==t.morphTargets)for(var i=0,s=t.morphTargets.length;i<s;i++){e.morphTargets[i]={},e.morphTargets[i].name=t.morphTargets[i].name,e.morphTargets[i].vertices=[];for(var o=e.morphTargets[i].vertices,a=t.morphTargets[i].vertices,l=0,c=a.length;l<c;l+=3){var u=new n.Vector3;u.x=a[l]*r,u.y=a[l+1]*r,u.z=a[l+2]*r,o.push(u)}}if(void 0!==t.morphColors&&t.morphColors.length>0){var h=e.faces,p=t.morphColors[0].colors;for(i=0,s=h.length;i<s;i++)h[i].color.fromArray(p,3*i)}}(t,r),function(t,e){var r=[],i=[];void 0!==t.animation&&i.push(t.animation),void 0!==t.animations&&(t.animations.length?i=i.concat(t.animations):i.push(t.animations));for(var s=0;s<i.length;s++){var o=n.AnimationClip.parseAnimation(i[s],e.bones);o&&r.push(o)}if(e.morphTargets){var a=n.AnimationClip.CreateClipsFromMorphTargetSequences(e.morphTargets,10);r=r.concat(a)}r.length>0&&(e.animations=r)}(t,r),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:r}:{geometry:r,materials:Loader.prototype.initMaterials(t.materials,this.resourcePath||e,this.crossOrigin)}},Zl.prototype.setImages=function(t){return this.images=t,this},Zl.prototype.setShapes=function(t){return this.shapes=t,this},Zl.prototype.load=function(t,e,r,i){new n.FileLoader(this.manager).load(t,(function(t){e(self.parse(JSON.parse(t)))}),r,i)},Zl.prototype.parse=function(t){var e=null;if("CapsuleBufferGeometry"===t.type)e=new Xl(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.capsTopSegments,t.capsBottomSegments,t.thetaStart,t.thetaLength);else if("RoundedBoxBufferGeometry"===t.type)e=new ql(t.width,t.height,t.depth,t.radius,t.radiusSegments);else if("TerrainBufferGeometry"===t.type)e=new Wl(t.width,t.height,t.widthSegments,t.heightSegments,t.scale,this.images[t.image]);else if("ParametricBufferGeometry"===t.type)e=new Yl(t.code,t.slices,t.stacks);else if("Geometry"===t.type)e=(new Jl).parse(t.data).geometry;else{var r=n.ObjectLoader.prototype.parseGeometries([t],this.shapes);for(var i in r){e=r[i];break}}return e.uuid=t.uuid,e.name=void 0!==t.name?t.name:"geometry",e},Ql.prototype.load=function(t,e,r,i){new n.FileLoader(this.manager).load(t,(function(t){e(new _o(JSON.parse(t)))}),r,i)},Ql.prototype.parse=function(t){if(void 0!==t.data){var e=new _o;return e.name=t.name,e.uuid=t.uuid,e.encoding=t.encoding,void 0!==t.reversed&&(e.reversed=t.reversed),"arraybuffer"===t.format?(e.format=t.format,e.data=void 0!==t.data.toArrayBuffer?t.data.toArrayBuffer():t.data,e.loadTTF()):"base64"===t.format?(e.format="arraybuffer",e.data=Vi.fromBase64(t.data),e.loadTTF()):(e.format=t.format,e.data=t.data,e.font=t.data),e}return new _o(t)},Kl.prototype.load=function(t,e,r,i){new n.FileLoader(this.manager).load(t,(function(t){e(self.parse(JSON.parse(t)))}),r,i)},Kl.prototype.parse=function(t){var e=new yo;return e.name=t.name,e.uuid=t.uuid,e.encoding=t.encoding,"base64"===t.format?(e.format="arraybuffer",e.data=Vi.fromBase64(t.data)):"arraybuffer"===t.format?(e.format=t.format,e.data=void 0!==t.data.toArrayBuffer?t.data.toArrayBuffer():t.data):(e.format=t.format,e.data=t.data),e},tc.USER=21,tc.ENVIRONMENT=22,tc.prototype=Object.create(n.Texture.prototype),tc.prototype.constructor=tc,tc.isTexture=!0,tc.prototype.connect=function(){var t={facingMode:this.mode===tc.USER?"user":{exact:"environment"}},e=this;void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:t}).then((function(t){e.stream=t,e.image.srcObject=t,e.image.play()})).catch((function(t){console.warn("nunuStudio: No webcam available")})):navigator.getUserMedia&&navigator.getUserMedia({video:!0},(function(t){e.stream=t,e.image.src=URL.createObjectURL(t)}),(function(t){console.warn("nunuStudio: No webcam available")}))},tc.prototype.disconnect=function(){if(null!==this.stream)for(var t=this.stream.getTracks(),e=0;e<t.length;e++)t[e].stop()},tc.prototype.dispose=function(){n.Texture.prototype.dispose.call(this),this.disconnect(),this.disposed=!0,this.image.paused||this.image.pause()},tc.prototype.toJSON=function(t){var e=n.Texture.prototype.toJSON.call(this,t);return e.mode=this.mode,e},ec.prototype=Object.create(Xi.prototype),ec.fileIsVideo=function(t){return!(void 0===t||!t.type.startsWith("video"))},ec.prototype.loadArrayBufferData=function(t,e){var n=new Uint8Array(t),r=new Blob([n],{type:"video/"+e});this.data=URL.createObjectURL(r),this.arraybuffer=t,this.encoding=e,this.format="arraybuffer"},ec.prototype.toJSON=function(t){if(void 0!==t.videos[this.uuid])return t.videos[this.uuid];var e=Xi.prototype.toJSON.call(this,t);return e.encoding=this.encoding,"arraybuffer"===this.format?(e.format=this.format,e.data=this.arraybuffer):"base64"===this.format?(e.format="arraybuffer",e.data=Vi.fromBase64(Hi.removeHeader(this.data))):(e.format=this.format,e.data=this.data),t.videos[this.uuid]=e,e},nc.prototype=Object.create(n.Texture.prototype),nc.isVideoTexture=!0,nc.prototype.setVideo=function(t){if(null==t)return this.video=null,void(this.image.src=null);this.video="string"==typeof t?new ec(t):t,this.image.src=this.video.data},nc.prototype.setTime=function(t){this.image.currentTime=t},nc.prototype.setLoop=function(t){this.loop=t,this.image.loop=t},nc.prototype.setVolume=function(t){this.volume=t>=0&&t<=1?t:t>=0?1:0,this.image.volume=this.volume},nc.prototype.setAutoPlay=function(t){this.autoplay=t,this.image.autoplay=this.autoplay},nc.prototype.setPlaybackRate=function(t){this.playbackRate=t,this.image.playbackRate=t},nc.prototype.pause=function(){this.image.paused||this.image.pause()},nc.prototype.play=function(){this.image.paused&&this.image.play()},nc.prototype.dispose=function(){n.Texture.prototype.dispose.call(this),this.disposed=!0,this.image.pause(),this.image.src="",this.image.load()},nc.prototype.toJSON=function(t){var e=n.Texture.prototype.toJSON.call(this,t),r=this.video.toJSON(t);return e.video=r.uuid,e.loop=this.loop,e.autoplay=this.autoplay,e.playbackRate=this.playbackRate,e.volume=this.volume,e},rc.prototype=Object.create(Ji.prototype),rc.isTexture=!0,rc.prototype.step=function(){this.currentFrame++,this.currentFrame>=this._endFrame&&(this.currentFrame=this._beginFrame),this.offset.x=this.currentFrame%this.framesHorizontal/this.framesHorizontal,this.offset.y=1-this.repeat.y-Math.floor(this.currentFrame/this.framesHorizontal)/this.framesVertical},rc.prototype.setAnimationSpeed=function(t){this.animationSpeed=t},rc.prototype.setFrameGrid=function(t,e){this._framesHorizontal=t,this._framesVertical=e,this._totalFrames=t*e,this.repeat.set(1/t,1/e)},rc.prototype.setAnimationFrames=function(t,e){this.beginFrame=t,this.endFrame=e},rc.prototype.dispose=function(){Ji.prototype.dispose.call(this),this.disposed=!0},rc.prototype.toJSON=function(t){var e=Ji.prototype.toJSON.call(this,t),n=this.source.toJSON(t);return e.image=n.uuid,e.loop=this.loop,e.animationSpeed=this.animationSpeed,e.framesHorizontal=this._framesHorizontal,e.framesVertical=this._framesVertical,e.totalFrames=this._totalFrames,e.beginFrame=this._beginFrame,e.endFrame=this._endFrame,e},ic.prototype=Object.create(n.Texture.prototype),ic.prototype.constructor=ic,ic.prototype.isDataTexture=!0,ic.prototype.toJSON=function(t){var e=n.Texture.prototype.toJSON.call(this,t);return e.image={height:this.image.height,width:this.image.width,data:Array.from(this.image.data)},e},sc.prototype=Object.create(n.Texture.prototype),sc.prototype.constructor=sc,sc.prototype.isCompressedTexture=!0,sc.prototype.toJSON=function(t){var e=n.Texture.prototype.toJSON.call(this,t);if(e.isCubeTexture=this.isCubeTexture,this.isCubeTexture){e.image=[];for(var r=0;r<this.image.length;r++){for(var i={mipmaps:[],format:this.image[r].format,width:this.image[r].width,height:this.image[r].height},s=0;s<this.image[r].mipmaps.length;s++)i.mipmaps.push({width:this.image[r].mipmaps[s].width,height:this.image[r].mipmaps[s].height,data:this.image[r].mipmaps[s].data});e.image.push(i)}}else for(e.mipmaps=[],e.width=this.image.width,e.height=this.image.height,s=0;s<this.mipmaps.length;s++)e.mipmaps.push({width:this.mipmaps[s].width,height:this.mipmaps[s].height,data:this.mipmaps[s].data});return e},oc.prototype.setCrossOrigin=function(t){return this.crossOrigin=t,this},oc.prototype.setPath=function(t){return this.path=t,this},oc.prototype.setImages=function(t){return this.images=t,this},oc.prototype.setVideos=function(t){return this.videos=t,this},oc.prototype.setFonts=function(t){return this.fonts=t,this},oc.prototype.load=function(t,e,n,r){try{var i=new Ji(this.path+t);return void 0!==e&&e(i),i}catch(t){return void 0!==r&&r(t),console.warn("nunuStudio: Texture not found",t),new Ji}},oc.prototype.loadJSON=function(t,e,r,i){var s=this;new n.FileLoader(this.manager).load(t,(function(t){s.parse(JSON.parse(t),e)}),r,i)},oc.prototype.parse=function(t,e){var n=null,r=t.category;if("Video"===r)void 0===t.video&&console.warn("nunuStudio: TextureLoader, No video specified for",t.uuid),void 0===this.videos[t.video]&&console.warn("nunuStudio: TextureLoader, Undefined video",t.video),(n=new nc(this.videos[t.video])).setLoop(t.loop),n.setAutoPlay(t.autoplay),n.setPlaybackRate(t.playbackRate),n.setVolume(t.volume);else if("Webcam"===r)n=new tc,void 0!==t.mode&&(n.mode=t.mode);else if("Compressed"===r)if(t.isCubeTexture){(n=new sc).image=[],n.isCubeTexture=!0;for(var i=0;i<t.image.length;i++){for(var s=0;s<t.image[i].mipmaps.length;s++)void 0!==t.image[i].mipmaps[s].data.toArrayBuffer&&(t.image[i].mipmaps[s].data=new Uint8Array(t.image[i].mipmaps[s].data.toArrayBuffer()));n.image.push(t.image[i])}}else{for(s=0;s<t.mipmaps.length;s++)void 0!==t.mipmaps[s].data.toArrayBuffer&&(t.mipmaps[s].data=new Uint8Array(t.mipmaps[s].data.toArrayBuffer()));n=new sc(t.mipmaps,t.width,t.height)}else if("Cube"===r){var o=[];for(s=0;s<t.images.length;s++)void 0===this.images[t.images[s]]&&console.warn("nunuStudio: TextureLoader, undefined image",t.images[s]),o.push(this.images[t.images[s]]);(n=new Ki).setImages(o,t.mode),n.setSize(t.size),n.updateImages()}else"Canvas"===r?n=new Dl(t.width,t.height):"DataTexture"===r?n=new ic(new Float32Array(t.image.data),t.image.width,t.image.height):(void 0===t.image&&console.warn("nunuStudio: TextureLoader, no image specified for",t.uuid),void 0===this.images[t.image]&&console.warn("nunuStudio: TextureLoader, undefined image",t.image),"SpriteSheet"===r?((n=new rc(this.images[t.image],t.framesHorizontal,t.framesVertical,t.totalFrames)).loop=t.loop,n.animationSpeed=t.animationSpeed,n.beginFrame=t.beginFrame,n.endFrame=t.endFrame):n=new Ji(this.images[t.image]));return n.needsUpdate=!0,n.uuid=t.uuid,n.name=t.name,n.mapping=t.mapping,n.repeat.set(t.repeat[0],t.repeat[1]),n.offset.set(t.offset[0],t.offset[1]),void 0!==t.center&&n.center.set(t.center[0],t.center[1]),void 0!==t.rotation&&(n.rotation=t.rotation),n.wrapS=t.wrap[0],n.wrapT=t.wrap[1],void 0!==t.format&&(n.format=t.format),void 0!==t.type&&(n.type=t.type),void 0!==t.encoding&&(n.encoding=t.encoding),n.minFilter=t.minFilter,n.magFilter=t.magFilter,n.anisotropy=t.anisotropy,n.flipY=t.flipY,void 0!==t.premultiplyAlpha&&(n.premultiplyAlpha=t.premultiplyAlpha),void 0!==t.unpackAlignment&&(n.unpackAlignment=t.unpackAlignment),void 0!==e&&e(n),n},ac.prototype.load=function(t,e,r,i){var s=this;new n.FileLoader(this.manager).load(t,(function(t){e(s.parse(JSON.parse(t)))}),r,i)},ac.prototype.parse=function(t){var e=new ec(void 0!==t.data.toArrayBuffer?t.data.toArrayBuffer():t.data,t.encoding);return e.name=t.name,e.uuid=t.uuid,e},lc.prototype=Object.create(i.prototype),lc.prototype.load=function(t,e,r,i){""===this.texturePath&&(this.texturePath=t.substring(0,t.lastIndexOf("/")+1));var s=this;new n.FileLoader(this.manager).load(t,(function(t){s.parse(JSON.parse(t),e)}),r,i)},lc.prototype.parse=function(t,e){this.parseResources(t.resources),this.parseShape(t.shapes),this.parseImages(t.images),this.parseGeometries(t.geometries),this.parseVideos(t.videos),this.parseAudio(t.audio),this.parseFonts(t.fonts),this.parseTextures(t.textures),this.parseMaterials(t.materials);var n=this.parseObject(t.object);return void 0!==t.skeletons&&(this.parseSkeletons(t.skeletons,n),this.bindSkeletons(n)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(n),n},lc.prototype.setTexturePath=function(t){this.texturePath=t},lc.prototype.setCrossOrigin=function(t){this.crossOrigin=t},lc.prototype.parseResources=function(t){if(void 0!==t)for(var e in t){var n=new Fl(t[e].data,t[e].encoding);n.format=t[e].format,n.name=t[e].name,n.uuid=t[e].uuid,this.resources[n.uuid]=n}return this.resources},lc.prototype.parseShape=function(t){if(void 0!==t)for(var e=0,n=t.length;e<n;e++){var r=(new Shape).fromJSON(t[e]);this.shapes[r.uuid]=r}return this.shapes},lc.prototype.parseGeometries=function(t){if(void 0!==t){var e=new Zl;e.setShapes(this.shapes),e.setImages(this.images);for(var n=0;n<t.length;n++)this.geometries[t[n].uuid]=e.parse(t[n])}return this.geometries},lc.prototype.parseMaterials=function(t){if(void 0!==t){var e=new Hl;for(var n in e.setTextures(this.textures),t)this.materials[t[n].uuid]=e.parse(t[n])}return this.materials},lc.prototype.parseImages=function(t){if(void 0!==t){var e=new Vl;for(var n in t)this.images[t[n].uuid]=e.parse(t[n])}return this.images},lc.prototype.parseVideos=function(t){if(void 0!==t){var e=new ac;for(var n in t)this.videos[t[n].uuid]=e.parse(t[n])}return this.videos},lc.prototype.parseAudio=function(t){if(void 0!==t){var e=new Kl;for(var n in t)this.audio[t[n].uuid]=e.parse(t[n])}return this.audio},lc.prototype.parseFonts=function(t){if(void 0!==t){var e=new Ql;for(var n in t)this.fonts[t[n].uuid]=e.parse(t[n])}return this.fonts},lc.prototype.parseTextures=function(t){if(void 0!==t){var e=new oc;for(var n in e.setImages(this.images),e.setVideos(this.videos),t)this.textures[t[n].uuid]=e.parse(t[n])}return this.textures},lc.prototype.parseSkeletons=function(t,e){if(void 0!==t)for(var r=0;r<t.length;r++)this.skeletons[t[r].uuid]=n.Skeleton.fromJSON(t[r],e,this);return this.skeletons},lc.prototype.bindSkeletons=function(t){var e=this;t.traverse((function(t){if(t.isSkinnedMesh&&void 0!==t.skeletonUUID){var n=e.skeletons[t.skeletonUUID];if(void 0===n)return void console.warn("nunuStudio: ObjectLoader Skeleton not found.",t.skeletonUUID);delete t.skeletonUUID,t.bind(n,t.bindMatrix)}}))},lc.prototype.parseObject=function(t){var e;try{switch(t.type){case"SpineAnimation":for(var r=0;r<t.textures.length;r++)t.textures[r].texture=this.getTexture(t.textures[r].texture);e=new Cl(t.json,t.atlas,"",t.textures),void 0!==t.animation&&(e.animation=t.animation,e.track=t.track,e.loop=t.loop),void 0!==t.skin&&(e.skin=t.skin);break;case"Audio":(e=new Qi(this.getAudio(t.audio))).autoplay=t.autoplay,e.startTime=t.startTime,e.playbackRate=t.playbackRate,e.loop=void 0!==t.source?t.source.loop:t.loop,void 0!==t.volume&&(e.volume=t.volume);break;case"PositionalAudio":(e=new vo(this.getAudio(t.audio))).autoplay=t.autoplay,e.startTime=t.startTime,e.playbackRate=t.playbackRate,e.loop=void 0!==t.source?t.source.loop:t.loop,void 0!==t.volume&&(e.volume=t.volume),e.distanceModel=t.distanceModel,e.panningModel=t.panningModel;break;case"Physics":e=ho.fromJSON(t);break;case"ParticleEmiter":e=bc.fromJSON(t,this);break;case"LensFlare":for(e=new eo,void 0!==t.lensFlares&&(t.elements=t.lensFlares),r=0;r<t.elements.length;r++)e.addFlare(this.getTexture(t.elements[r].texture),t.elements[r].size,t.elements[r].distance,new n.Color(t.elements[r].color));break;case"TextMesh":case"Text3D":e=new kl(t.text,this.getMaterial(t.material),this.getFont(t.font),t.height,t.bevel,t.bevelThickness,t.bevelSize,t.size,t.curveSegments,t.extruded);break;case"Program":(e=new Cc(t.name)).description=t.description,e.author=t.author,e.version=t.version,e.ar=!0===t.ar,e.vr=t.vr,e.vrScale=t.vrScale,void 0!==t.rendererConfig?e.rendererConfig.fromJSON(t.rendererConfig):(e.rendererConfig.antialiasing=t.antialiasing,e.rendererConfig.shadows=t.shadows,e.rendererConfig.shadowsType=t.shadowsType,e.rendererConfig.toneMapping=t.toneMapping,e.rendererConfig.toneMappingExposure=t.toneMappingExposure),void 0!==t.lockPointer&&(e.lockPointer=t.lockPointer),void 0!==t.defaultScene&&(e.defaultScene=t.defaultScene),void 0!==t.handlePixelRatio&&(e.handlePixelRatio=t.handlePixelRatio);break;case"Sky":if(e=new To(t.autoUpdate,t.dayTime,t.sunDistance,t.time),void 0!==t.sun&&(e.sun.shadow.fromJSON(t.sun.shadow),void 0!==t.sun.castShadow&&(e.sun.castShadow=t.sun.castShadow)),void 0!==t.colorTop)for(e.colorTop=[],r=0;r<t.colorTop.length;r++)e.colorTop.push(new n.Color(t.colorTop[r]));if(void 0!==t.colorBottom)for(e.colorBottom=[],r=0;r<t.colorBottom.length;r++)e.colorBottom.push(new n.Color(t.colorBottom[r]));void 0!==t.sunColor&&(e.sunColor=t.sunColor),void 0!==t.moonColor&&(e.moonColor=t.moonColor),void 0!==t.intensity&&(e.intensity=t.intensity);break;case"CubeCamera":e=new ts(t.near,t.far,t.resolution,t.autoUpdate);break;case"FirstPersonControls":(e=new qs).sensitivity=t.sensitivity,e.needsButtonPressed=t.needsButtonPressed,e.movementEnabled=t.movementEnabled,e.moveSpeed=t.moveSpeed,e.moveOnPlane=t.moveOnPlane,e.moveKeys=t.moveKeys;break;case"OrbitControls":(e=new ao).distance=t.distance,e.maxDistance=t.maxDistance,e.minDistance=t.minDistance,e.sensitivity=t.sensitivity,e.limitUp=t.limitUp,e.limitDown=t.limitDown,e.needsButtonPressed=t.needsButtonPressed,e.zoomEnabled=t.zoomEnabled,e.movementEnabled=t.movementEnabled,void 0!==t.smooth&&(e.smooth=t.smooth,e.friction=t.friction,e.speed=t.speed,e.invertNavigation=t.invertNavigation),void 0!==t.center&&(e.center.fromArray(t.center),e.vector.fromArray(t.vector));break;case"Scene":e=new Bc,void 0!==t.background&&(Number.isInteger(t.background)?e.background=new n.Color(t.background):e.background=this.getTexture(t.background)),void 0!==t.environment&&(e.environment=this.getTexture(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?e.fog=new n.Fog(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(e.fog=new n.FogExp2(t.fog.color,t.fog.density))),void 0!==t.defaultCamera&&(e.defaultCamera=this.parse(t.defaultCamera)),void 0!==t.cameras&&(e.cameras=t.cameras),void 0!==t.usePhysics&&(e.usePhysics=t.usePhysics),void 0!==t.world&&(e.world.gravity.set(t.world.gravity.x,t.world.gravity.y,t.world.gravity.z),e.world.quatNormalizeSkip=t.world.quatNormalizeSkip,e.world.quatNormalizeFast=t.world.quatNormalizeFast,e.world.solver.tolerance=t.world.solver.tolerance,e.world.solver.iterations=t.world.solver.iterations);break;case"PerspectiveCamera":e=new uo(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(e.focus=t.focus),void 0!==t.zoom&&(e.zoom=t.zoom),void 0!==t.filmGauge&&(e.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(e.filmOffset=t.filmOffset),void 0!==t.view&&(e.view=Object.assign({},t.view)),void 0!==t.viewport&&(t.viewport instanceof Array?(e.viewport.size.fromArray(t.viewport),e.viewport.offset.fromArray(t.offset)):e.viewport.fromJSON(t.viewport)),void 0!==t.clearColor&&(e.clearColor=t.clearColor),void 0!==t.clearDepth&&(e.clearDepth=t.clearDepth),void 0!==t.clearStencil&&(e.clearStencil=t.clearStencil),void 0!==t.order&&(e.order=t.order),void 0!==t.composer&&(e.composer=Vs.fromJSON(t.composer));break;case"OrthographicCamera":e=new co(t.size,t.aspect,t.mode,t.near,t.far),void 0!==t.viewport&&(t.viewport instanceof Array?(e.viewport.size.fromArray(t.viewport),e.viewport.offset.fromArray(t.offset)):e.viewport.fromJSON(t.viewport)),void 0!==t.clearColor&&(e.clearColor=t.clearColor),void 0!==t.clearDepth&&(e.clearDepth=t.clearDepth),void 0!==t.clearStencil&&(e.clearStencil=t.clearStencil),void 0!==t.order&&(e.order=t.order),void 0!==t.composer&&(e.composer=Vs.fromJSON(t.composer)),void 0!==t.zoom&&(e.zoom=t.zoom),void 0!==t.view&&(e.view=Object.assign({},t.view));break;case"Script":e=new xo(t.code,t.mode);break;case"PythonScript":e=new Nl(t.code);break;case"NodeScript":(e=new NodeScript).graph=Object2D.parse(t.graph);break;case"RectAreaLight":e=new bo(t.color,t.intensity,t.width,t.height);break;case"AmbientLight":e=new Zi(t.color,t.intensity);break;case"DirectionalLight":e=new es(t.color,t.intensity);break;case"PointLight":e=new po(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":e=new Bl(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":e=new Zs(t.color,t.groundColor,t.intensity);break;case"HTMLView":(e=new Js).height=t.height,e.width=t.width,e.url=t.url;break;case"LightProbe":(e=new so).sh.fromArray(t.sh);break;case"InstancedMesh":(e=new Qs(this.getGeometry(t.geometry),this.getMaterial(t.material),t.count)).instanceMatrix=new n.BufferAttribute(new Float32Array(t.instanceMatrix.array),16);break;case"SkinnedMesh":e=new wo(this.getGeometry(t.geometry),this.getMaterial(t.material)),void 0!==t.skeleton&&(e.skeletonUUID=t.skeleton),void 0!==t.bindMode&&(e.bindMode=t.bindMode),void 0!==t.bindMatrix&&e.bindMatrix.fromArray(t.bindMatrix);break;case"Mesh":e=new oo(this.getGeometry(t.geometry),this.getMaterial(t.material));break;case"TextBitmap":e=Ol.fromJSON(t,this.getTexture(t.texture));break;case"TextSprite":e=zl.fromJSON(t);break;case"LOD":e=new n.LOD;break;case"Line":e=new n.Line(this.getGeometry(t.geometry),this.getMaterial(t.material),t.mode);break;case"LineLoop":e=new n.LineLoop(this.getGeometry(t.geometry),this.getMaterial(t.material));break;case"LineSegments":e=new n.LineSegments(this.getGeometry(t.geometry),this.getMaterial(t.material));break;case"PointCloud":case"Points":e=new n.Points(this.getGeometry(t.geometry),this.getMaterial(t.material));break;case"Sprite":e=new Ll(this.getMaterial(t.material));break;case"Group":default:e=new Xs;break;case"BillboardGroup":e=new Gl;break;case"Bone":e=new n.Bone}}catch(n){console.error("nunuStudio: Error parsing and creating object "+t.uuid+", object skiped.",n,t),e=new Xs}if(e.uuid=t.uuid,e.name=t.name,e.locked=!0===t.locked||!0===t.hidden,e.folded=!0===t.folded,void 0!==t.frustumCulled&&(e.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(e.renderOrder=t.renderOrder),void 0!==t.animations)for(e.animations=[],r=0;r<t.animations.length;r++){var i=n.AnimationClip.parse(t.animations[r]);void 0!==t.animations[r].uuid&&(i.uuid=t.animations[r].uuid),e.animations.push(i)}if(void 0!==t.matrix&&(e.matrix.fromArray(t.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale)),void 0!==t.position&&e.position.fromArray(t.position),void 0!==t.rotation&&e.rotation.fromArray(t.rotation),void 0!==t.quaternion&&e.quaternion.fromArray(t.quaternion),void 0!==t.scale&&e.scale.fromArray(t.scale),e.castShadow=!0===t.castShadow,e.receiveShadow=!0===t.receiveShadow,void 0!==t.shadow&&e.shadow.fromJSON(t.shadow),e.visible=!0===t.visible,void 0!==t.userData&&(e.userData=t.userData),void 0!==t.layers&&(e.layers.mask=t.layers),void 0!==t.children)for(var s in t.children)e.add(this.parseObject(t.children[s]));if(void 0!==t.matrixAutoUpdate&&(e.matrixAutoUpdate=t.matrixAutoUpdate,e.matrixAutoUpdate||(e.updateMatrix(),e.updateMatrixWorld(!0))),"Program"===t.type)e.copyResources(this);else if("Scene"===t.type)for(r=0;r<e.cameras.length;r++){var o=e.getCamera(e.cameras[r]);null!==o?e.cameras[r]=o:e.cameras.splice(r,1)}else if("LOD"===t.type)for(var a=t.levels,l=0;l<a.length;l++){var c=a[l];void 0!==(s=e.getObjectByProperty("uuid",c.object))&&e.addLevel(s,c.distance)}return e};const cc="// All uniforms used by vertex / fragment shaders\nuniform float deltaTime;\nuniform float runTime;\nuniform sampler2D textureSampler;\nuniform vec4 textureAnimation;\nuniform float scale;\n",uc="varying vec4 vColor;\n\n#ifdef SHOULD_ROTATE_TEXTURE\n    varying float vAngle;\n#endif\n\n#ifdef SHOULD_CALCULATE_SPRITE\n    varying vec4 vSpriteSheet;\n#endif",hc="// Branch-avoiding comparison fns\n//- http:// theorangeduck.com/page/avoiding-shader-conditionals\nfloat when_gt(float x, float y) {\n    return max(sign(x - y), 0.0);\n}\n\nfloat when_lt(float x, float y) {\n    return min(max(1.0 - sign(x - y), 0.0), 1.0);\n}\n\nfloat when_eq(float x, float y) {\n    return 1.0 - abs(sign(x - y));\n}\n\nfloat when_ge(float x, float y) {\n  return 1.0 - when_lt(x, y);\n}\n\nfloat when_le(float x, float y) {\n  return 1.0 - when_gt(x, y);\n}\n\n// Branch-avoiding logical operators (to be used with above comparison fns)\nfloat and(float a, float b) {\n    return a * b;\n}\n\nfloat or(float a, float b) {\n    return min(a + b, 1.0);\n}";var pc={vertex:["// Register color-packing define statements.\n#define PACKED_COLOR_SIZE 256.0\n#define PACKED_COLOR_DIVISOR 255.0",cc,"// All attributes used by the vertex shader.\n//\n// Note that some attributes are squashed into other ones\n//\n// Drag is stored in acceleration.w\nattribute vec4 acceleration;\nattribute vec3 velocity;\nattribute vec4 rotation;\nattribute vec3 rotationCenter;\nattribute vec4 params;\nattribute vec4 size;\nattribute vec4 angle;\nattribute vec4 color;\nattribute vec4 opacity;",uc,n.ShaderChunk.common,n.ShaderChunk.logdepthbuf_pars_vertex,n.ShaderChunk.fog_pars_vertex,hc,"// From:\n//- http:// stackoverflow.com/a/12553149\n//- https:// stackoverflow.com/questions/22895237/hexadecimal-to-rgb-values-in-webgl-shader\n// unpackColor\nvec3 unpackColor(in float hex) {\n    vec3 c = vec3(0.0);\n\n    float r = mod((hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE);\n    float g = mod((hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE);\n    float b = mod(hex, PACKED_COLOR_SIZE);\n\n    c.r = r / PACKED_COLOR_DIVISOR;\n    c.g = g / PACKED_COLOR_DIVISOR;\n    c.b = b / PACKED_COLOR_DIVISOR;\n\n    return c;\n}\n\n// unpackRotationAxis\nvec3 unpackRotationAxis(in float hex) {\n    vec3 c = vec3(0.0);\n\n    float r = mod((hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE);\n    float g = mod((hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE);\n    float b = mod(hex, PACKED_COLOR_SIZE);\n\n    c.r = r / PACKED_COLOR_DIVISOR;\n    c.g = g / PACKED_COLOR_DIVISOR;\n    c.b = b / PACKED_COLOR_DIVISOR;\n\n    c *= vec3(2.0);\n    c -= vec3(1.0);\n\n    return c;\n}\n\n// floatOverLifetime:\nfloat getFloatOverLifetime(in float positionInTime, in vec4 attr) {\n    highp float value = 0.0;\n    float deltaAge = positionInTime * float(VALUE_OVER_LIFETIME_LENGTH - 1);\n    float fIndex = 0.0;\n    float shouldApplyValue = 0.0;\n\n    // This might look a little odd, but it's faster in the testing I\"ve done than using branches. Uses basic maths to avoid branching.\n    //\n    // Take a look at the branch-avoidance functions defined above, and be sure to check out The Orange Duck site where I got this from (link above).\n    //\n    // Fix for static emitters (age is always zero).\n    value += attr[0] * when_eq(deltaAge, 0.0);\n\n    for(int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i) {\n        fIndex = float(i);\n        shouldApplyValue = and(when_gt(deltaAge, fIndex), when_le(deltaAge, fIndex + 1.0));\n        value += shouldApplyValue * mix(attr[i], attr[i + 1], deltaAge - fIndex);\n    }\n\n    return value;\n}\n\n// colorOverLifetime\nvec3 getColorOverLifetime(in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4) {\n    vec3 value = vec3(0.0);\n    value.x = getFloatOverLifetime(positionInTime, vec4(color1.x, color2.x, color3.x, color4.x));\n    value.y = getFloatOverLifetime(positionInTime, vec4(color1.y, color2.y, color3.y, color4.y));\n    value.z = getFloatOverLifetime(positionInTime, vec4(color1.z, color2.z, color3.z, color4.z));\n    return value;\n}\n\n// paramFetchingFunctions\nfloat getAlive() {\n    return params.x;\n}\n\nfloat getAge() {\n    return params.y;\n}\n\nfloat getMaxAge() {\n    return params.z;\n}\n\nfloat getWiggle() {\n    return params.w;\n}\n\n// forceFetchingFunctions\nvec4 getPosition(in float age) {\n    return modelViewMatrix * vec4(position, 1.0);\n}\n\nvec3 getVelocity(in float age) {\n    return velocity * age;\n}\n\nvec3 getAcceleration(in float age) {\n    return acceleration.xyz * age;\n}\n\n\n// rotationFunctions\n// Huge thanks to:\n//- http:// www.neilmendoza.com/glsl-rotation-about-an-arbitrary-axis/\n#ifdef SHOULD_ROTATE_PARTICLES\nmat4 getRotationMatrix(in vec3 axis, in float angle) {\n   axis = normalize(axis);\n   float s = sin(angle);\n   float c = cos(angle);\n   float oc = 1.0 - c;\n\n   return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n               oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n               oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n               0.0,                                0.0,                                0.0,                                1.0);\n}\n\nvec3 getRotation(in vec3 pos, in float positionInTime) {\n  if(rotation.y == 0.0) {\n       return pos;\n  }\n\n  vec3 axis = unpackRotationAxis(rotation.x);\n  vec3 center = rotationCenter;\n  vec3 translated;\n  mat4 rotationMatrix;\n\n  float angle = 0.0;\n  angle += when_eq(rotation.z, 0.0) * rotation.y;\n  angle += when_gt(rotation.z, 0.0) * mix(0.0, rotation.y, positionInTime);\n  translated = rotationCenter - pos;\n  rotationMatrix = getRotationMatrix(axis, angle);\n  return center - vec3(rotationMatrix * vec4(translated, 0.0));\n}\n#endif\n","void main() {","// Setup\nhighp float age = getAge();\nhighp float alive = getAlive();\nhighp float maxAge = getMaxAge();\nhighp float positionInTime = (age / maxAge);\nhighp float isAlive = when_gt(alive, 0.0);\n#ifdef SHOULD_WIGGLE_PARTICLES\n\tfloat wiggleAmount = positionInTime * getWiggle();\n\tfloat wiggleSin = isAlive * sin(wiggleAmount);\n\tfloat wiggleCos = isAlive * cos(wiggleAmount);\n#endif\n\n// Forces\n// Get forces & position\nvec3 vel = getVelocity(age);\nvec3 accel = getAcceleration(age);\nvec3 force = vec3(0.0);\nvec3 pos = vec3(position);\n\n// Calculate the required drag to apply to the forces.\nfloat drag = 1.0 - (positionInTime * 0.5) * acceleration.w;\n\n// Integrate forces\nforce += vel;\nforce *= drag;\nforce += accel * age;\npos += force;\n\n// Wiggly wiggly wiggle!\n#ifdef SHOULD_WIGGLE_PARTICLES\n\tpos.x += wiggleSin;\n\tpos.y += wiggleCos;\n\tpos.z += wiggleSin;\n#endif\n\n// Rotate the emitter around it's central point\n#ifdef SHOULD_ROTATE_PARTICLES\n\tpos = getRotation(pos, positionInTime);\n#endif\n\n// Convert pos to a world-space value\nvec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\n\n// Determine point size.\nhighp float pointSize = getFloatOverLifetime(positionInTime, size) * isAlive;\n\n// Determine perspective\n#ifdef HAS_PERSPECTIVE\n\tfloat perspective = scale / length(mvPosition.xyz);\n#else\n\tfloat perspective = 1.0;\n#endif\n\n// Apply perpective to pointSize value\nfloat pointSizePerspective = pointSize * perspective;\n\n// Determine color and opacity for this particle\n#ifdef COLORIZE\n\tvec3 c = isAlive * getColorOverLifetime(\n\t\tpositionInTime,\n\t\tunpackColor(color.x),\n\t\tunpackColor(color.y),\n\t\tunpackColor(color.z),\n\t\tunpackColor(color.w)\n\t);\n#else\n\tvec3 c = vec3(1.0);\n#endif\n\nfloat o = isAlive * getFloatOverLifetime(positionInTime, opacity);\n\n// Assign color to vColor varying.\nvColor = vec4(c, o);\n\n// Determine angle\n#ifdef SHOULD_ROTATE_TEXTURE\n\tvAngle = isAlive * getFloatOverLifetime(positionInTime, angle);\n#endif\n\n// If this particle is using a sprite-sheet as a texture, we\"ll have to figure out what frame of the texture the particle is using at it's current position in time.\n#ifdef SHOULD_CALCULATE_SPRITE\n\tfloat framesX = textureAnimation.x;\n\tfloat framesY = textureAnimation.y;\n\tfloat loopCount = textureAnimation.w;\n\tfloat totalFrames = textureAnimation.z;\n\tfloat frameNumber = mod((positionInTime * loopCount) * totalFrames, totalFrames);\n\n\tfloat column = floor(mod(frameNumber, framesX));\n\tfloat row = floor((frameNumber - column) / framesX);\n\n\tfloat columnNorm = column / framesX;\n\tfloat rowNorm = row / framesY;\n\n\tvSpriteSheet.x = 1.0 / framesX;\n\tvSpriteSheet.y = 1.0 / framesY;\n\tvSpriteSheet.z = columnNorm;\n\tvSpriteSheet.w = rowNorm;\n#endif\n\n// Write values\n// Set PointSize according to size at current point in time.\ngl_PointSize = pointSizePerspective;\ngl_Position = projectionMatrix * mvPosition;",n.ShaderChunk.logdepthbuf_vertex,n.ShaderChunk.fog_vertex,"}"].join("\n"),fragment:[cc,n.ShaderChunk.common,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.logdepthbuf_pars_fragment,uc,hc,"void main() {","    vec3 outgoingLight = vColor.xyz;","    ","    #ifdef ALPHATEST","       if(vColor.w < float(ALPHATEST)) discard;","    #endif","// Rotate Texture\nvec2 vUv = vec2(gl_PointCoord.x, 1.0 - gl_PointCoord.y);\n\n#ifdef SHOULD_ROTATE_TEXTURE\n   float x = gl_PointCoord.x - 0.5;\n   float y = 1.0 - gl_PointCoord.y - 0.5;\n   float c = cos(-vAngle);\n   float s = sin(-vAngle);\n\n   vUv = vec2(c * x + s * y + 0.5, c * y - s * x + 0.5);\n#endif\n\n// Spritesheets overwrite angle calculations.\n#ifdef SHOULD_CALCULATE_SPRITE\n    float framesX = vSpriteSheet.x;\n    float framesY = vSpriteSheet.y;\n    float columnNorm = vSpriteSheet.z;\n    float rowNorm = vSpriteSheet.w;\n\n    vUv.x = gl_PointCoord.x * framesX + columnNorm;\n    vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);\n#endif\n\nvec4 rotatedTexture = texture2D(textureSampler, vUv);\n",n.ShaderChunk.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;","    gl_FragColor = vec4(outgoingLight.xyz, rotatedTexture.w * vColor.w);",n.ShaderChunk.fog_fragment,"}"].join("\n")};function dc(t,e,n,r){this.componentSize=n||1,this.size=e||1,this.TypedArrayConstructor=t||Float32Array,this.array=new t(e*this.componentSize),this.indexOffset=r||0}function fc(t,e,n){this.type="string"==typeof t&&fc.typeSizeMap.hasOwnProperty(t)?t:"f",this.componentSize=fc.typeSizeMap[this.type],this.arrayType=n||Float32Array,this.typedArray=null,this.bufferAttribute=null,this.dynamicBuffer=Boolean(e),this.updateMin=0,this.updateMax=0}dc.constructor=dc,dc.prototype.setSize=function(t,e){var n=this.array.length;return e||(t*=this.componentSize),t<n?this.shrink(t):t>n?this.grow(t):void 0},dc.prototype.shrink=function(t){return this.array=this.array.subarray(0,t),this.size=t,this},dc.prototype.grow=function(t){var e=this.array,n=new this.TypedArrayConstructor(t);return n.set(e),this.array=n,this.size=t,this},dc.prototype.splice=function(t,e){t*=this.componentSize,e*=this.componentSize;for(var n=[],r=this.array,i=r.length,s=0;s<i;++s)(s<t||s>=e)&&n.push(r[s]);return this.setFromArray(0,n),this},dc.prototype.setFromArray=function(t,e){var n=t+e.length;return n>this.array.length?this.grow(n):n<this.array.length&&this.shrink(n),this.array.set(e,this.indexOffset+t),this},dc.prototype.setVec2=function(t,e){return this.setVec2Components(t,e.x,e.y)},dc.prototype.setVec2Components=function(t,e,n){var r=this.array,i=this.indexOffset+t*this.componentSize;return r[i]=e,r[i+1]=n,this},dc.prototype.setVec3=function(t,e){return this.setVec3Components(t,e.x,e.y,e.z)},dc.prototype.setVec3Components=function(t,e,n,r){var i=this.array,s=this.indexOffset+t*this.componentSize;return i[s]=e,i[s+1]=n,i[s+2]=r,this},dc.prototype.setVec4=function(t,e){return this.setVec4Components(t,e.x,e.y,e.z,e.w)},dc.prototype.setVec4Components=function(t,e,n,r,i){var s=this.array,o=this.indexOffset+t*this.componentSize;return s[o]=e,s[o+1]=n,s[o+2]=r,s[o+3]=i,this},dc.prototype.setMat3=function(t,e){return this.setFromArray(this.indexOffset+t*this.componentSize,e.elements)},dc.prototype.setMat4=function(t,e){return this.setFromArray(this.indexOffset+t*this.componentSize,e.elements)},dc.prototype.setColor=function(t,e){return this.setVec3Components(t,e.r,e.g,e.b)},dc.prototype.setNumber=function(t,e){return this.array[this.indexOffset+t*this.componentSize]=e,this},dc.prototype.getValueAtIndex=function(t){return this.array[this.indexOffset+t]},dc.prototype.getComponentValueAtIndex=function(t){return this.array.subarray(this.indexOffset+t*this.componentSize)},fc.constructor=fc,fc.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16},fc.prototype.setUpdateRange=function(t,e){this.updateMin=Math.min(t*this.componentSize,this.updateMin*this.componentSize),this.updateMax=Math.max(e*this.componentSize,this.updateMax*this.componentSize)},fc.prototype.flagUpdate=function(){var t=this.bufferAttribute.updateRange;t.offset=this.updateMin,t.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length),this.bufferAttribute.needsUpdate=!0},fc.prototype.resetUpdateRange=function(){this.updateMin=0,this.updateMax=0},fc.prototype.resetDynamic=function(){this.bufferAttribute.usage=this.dynamicBuffer?n.DynamicDrawUsage:n.StaticDrawUsage},fc.prototype.splice=function(t,e){this.typedArray.splice(t,e),this.forceUpdateAll()},fc.prototype.forceUpdateAll=function(){this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.updateRange.offset=0,this.bufferAttribute.updateRange.count=-1,this.bufferAttribute.usage=n.StaticDrawUsage,this.bufferAttribute.needsUpdate=!0},fc.prototype._ensureTypedArray=function(t){null!==this.typedArray&&this.typedArray.size===t*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==t?this.typedArray.setSize(t):null===this.typedArray&&(this.typedArray=new dc(this.arrayType,t,this.componentSize)))},fc.prototype._createBufferAttribute=function(t){if(this._ensureTypedArray(t),null!==this.bufferAttribute)return this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.count=this.bufferAttribute.array.length/this.bufferAttribute.itemSize,void(this.bufferAttribute.needsUpdate=!0);this.bufferAttribute=new n.BufferAttribute(this.typedArray.array,this.componentSize),this.bufferAttribute.usage=this.dynamicBuffer?n.DynamicDrawUsage:n.StaticDrawUsage},fc.prototype.getLength=function(){return null===this.typedArray?0:this.typedArray.array.length};var mc,_c={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(t,e,n){return typeof t===e?t:n},ensureArrayTypedArg:function(t,e,n){if(Array.isArray(t)){for(var r=t.length-1;r>=0;--r)if(typeof t[r]!==e)return n;return t}return this.ensureTypedArg(t,e,n)},ensureInstanceOf:function(t,e,n){return void 0!==e&&t instanceof e?t:n},ensureArrayInstanceOf:function(t,e,n){if(Array.isArray(t)){for(var r=t.length-1;r>=0;--r)if(void 0!==e&&t[r]instanceof e==0)return n;return t}return this.ensureInstanceOf(t,e,n)},ensureValueOverLifetimeCompliance:function(t,e,n){e=e||3,n=n||3,!1===Array.isArray(t._value)&&(t._value=[t._value]),!1===Array.isArray(t._spread)&&(t._spread=[t._spread]);var r=this.clamp(t._value.length,e,n),i=this.clamp(t._spread.length,e,n),s=Math.max(r,i);t._value.length!==s&&(t._value=this.interpolateArray(t._value,s)),t._spread.length!==s&&(t._spread=this.interpolateArray(t._spread,s))},interpolateArray:function(t,e){for(var n=t.length,r=["function"==typeof t[0].clone?t[0].clone():t[0]],i=(n-1)/(e-1),s=1;s<e-1;++s){var o=s*i,a=Math.floor(o),l=Math.ceil(o),c=o-a;r[s]=this.lerpTypeAgnostic(t[a],t[l],c)}return r.push("function"==typeof t[n-1].clone?t[n-1].clone():t[n-1]),r},clamp:function(t,e,n){return Math.max(e,Math.min(t,n))},zeroToEpsilon:function(t,e){var n=1e-5,r=t;return r=e?Math.random()*n*10:n,t<0&&t>-1e-5&&(r=-r),r},lerpTypeAgnostic:function(t,e,r){var i,s=this.types;return typeof t===s.NUMBER&&typeof e===s.NUMBER?t+(e-t)*r:t instanceof n.Vector2&&e instanceof n.Vector2?((i=t.clone()).x=this.lerp(t.x,e.x,r),i.y=this.lerp(t.y,e.y,r),i):t instanceof n.Vector3&&e instanceof n.Vector3?((i=t.clone()).x=this.lerp(t.x,e.x,r),i.y=this.lerp(t.y,e.y,r),i.z=this.lerp(t.z,e.z,r),i):t instanceof n.Vector4&&e instanceof n.Vector4?((i=t.clone()).x=this.lerp(t.x,e.x,r),i.y=this.lerp(t.y,e.y,r),i.z=this.lerp(t.z,e.z,r),i.w=this.lerp(t.w,e.w,r),i):t instanceof n.Color&&e instanceof n.Color?((i=t.clone()).r=this.lerp(t.r,e.r,r),i.g=this.lerp(t.g,e.g,r),i.b=this.lerp(t.b,e.b,r),i):void console.warn("nunuStudio: Invalid argument types, or argument types do not match.",t,e)},lerp:function(t,e,n){return t+(e-t)*n},roundToNearestMultiple:function(t,e){var n;return 0===e||0==(n=Math.abs(t)%e)?t:t<0?-(Math.abs(t)-n):t+e-n},arrayValuesAreEqual:function(t){for(var e=0;e<t.length-1;++e)if(t[e]!==t[e+1])return!1;return!0},randomFloat:function(t,e){return t+e*(Math.random()-.5)},randomVector3:function(t,e,n,r,i){var s=n.x+(Math.random()*r.x-.5*r.x),o=n.y+(Math.random()*r.y-.5*r.y),a=n.z+(Math.random()*r.z-.5*r.z);i&&(s=.5*-i.x+this.roundToNearestMultiple(s,i.x),o=.5*-i.y+this.roundToNearestMultiple(o,i.y),a=.5*-i.z+this.roundToNearestMultiple(a,i.z)),t.typedArray.setVec3Components(e,s,o,a)},randomColor:function(t,e,n,r){var i=n.r+Math.random()*r.x,s=n.g+Math.random()*r.y,o=n.b+Math.random()*r.z;i=this.clamp(i,0,1),s=this.clamp(s,0,1),o=this.clamp(o,0,1),t.typedArray.setVec3Components(e,i,s,o)},randomColorAsHex:(mc=new n.Color,function(t,e,n,r){for(var i=n.length,s=[],o=0;o<i;++o){var a=r[o];mc.copy(n[o]),mc.r+=Math.random()*a.x-.5*a.x,mc.g+=Math.random()*a.y-.5*a.y,mc.b+=Math.random()*a.z-.5*a.z,mc.r=this.clamp(mc.r,0,1),mc.g=this.clamp(mc.g,0,1),mc.b=this.clamp(mc.b,0,1),s.push(mc.getHex())}t.typedArray.setVec4Components(e,s[0],s[1],s[2],s[3])}),randomVector3OnSphere:function(t,e,n,r,i,s,o,a){var l=2*Math.random()-1,c=6.2832*Math.random(),u=Math.sqrt(1-l*l),h=this.randomFloat(r,i),p=0,d=0,f=0;o&&(h=Math.round(h/o)*o),p=u*Math.cos(c)*h,d=u*Math.sin(c)*h,f=l*h,p*=s.x,d*=s.y,f*=s.z,p+=n.x,d+=n.y,f+=n.z,t.typedArray.setVec3Components(e,p,d,f)},seededRandom:function(t){var e=1e4*Math.sin(t);return e-(0|e)},randomVector3OnDisc:function(t,e,n,r,i,s,o){var a=6.2832*Math.random(),l=Math.abs(this.randomFloat(r,i)),c=0,u=0,h=0;o&&(l=Math.round(l/o)*o),c=Math.cos(a)*l,u=Math.sin(a)*l,c*=s.x,u*=s.y,c+=n.x,u+=n.y,h+=n.z,t.typedArray.setVec3Components(e,c,u,h)},randomDirectionVector3OnSphere:function(){var t=new n.Vector3;return function(e,n,r,i,s,o,a,l){t.copy(o),t.x-=r,t.y-=i,t.z-=s,t.normalize().multiplyScalar(-this.randomFloat(a,l)),e.typedArray.setVec3Components(n,t.x,t.y,t.z)}}(),randomDirectionVector3OnDisc:function(){var t=new n.Vector3;return function(e,n,r,i,s,o,a,l){t.copy(o),t.x-=r,t.y-=i,t.z-=s,t.normalize().multiplyScalar(-this.randomFloat(a,l)),e.typedArray.setVec3Components(n,t.x,t.y,0)}}(),getPackedRotationAxis:function(){var t=new n.Vector3,e=new n.Vector3,r=new n.Color,i=new n.Vector3(1,1,1);return function(n,s){return t.copy(n).normalize(),e.copy(s).normalize(),t.x+=.5*-s.x+Math.random()*s.x,t.y+=.5*-s.y+Math.random()*s.y,t.z+=.5*-s.z+Math.random()*s.z,t.normalize().add(i).multiplyScalar(.5),r.setRGB(t.x,t.y,t.z),r.getHex()}}()},gc={BOX:1,SPHERE:2,DISC:3};function yc(t){for(var e in(t=_c.ensureTypedArg(t,_c.types.OBJECT,{})).position=_c.ensureTypedArg(t.position,_c.types.OBJECT,{}),t.velocity=_c.ensureTypedArg(t.velocity,_c.types.OBJECT,{}),t.acceleration=_c.ensureTypedArg(t.acceleration,_c.types.OBJECT,{}),t.radius=_c.ensureTypedArg(t.radius,_c.types.OBJECT,{}),t.drag=_c.ensureTypedArg(t.drag,_c.types.OBJECT,{}),t.rotation=_c.ensureTypedArg(t.rotation,_c.types.OBJECT,{}),t.color=_c.ensureTypedArg(t.color,_c.types.OBJECT,{}),t.opacity=_c.ensureTypedArg(t.opacity,_c.types.OBJECT,{}),t.size=_c.ensureTypedArg(t.size,_c.types.OBJECT,{}),t.angle=_c.ensureTypedArg(t.angle,_c.types.OBJECT,{}),t.wiggle=_c.ensureTypedArg(t.wiggle,_c.types.OBJECT,{}),t.maxAge=_c.ensureTypedArg(t.maxAge,_c.types.OBJECT,{}),t.onParticleSpawn&&console.warn("nunuStudio: onParticleSpawn has been removed. Please set properties directly to alter values at runtime."),this.uuid=n.Math.generateUUID(),this.type=_c.ensureTypedArg(t.type,_c.types.NUMBER,gc.BOX),this.position={_value:_c.ensureInstanceOf(t.position.value,n.Vector3,new n.Vector3),_spread:_c.ensureInstanceOf(t.position.spread,n.Vector3,new n.Vector3),_spreadClamp:_c.ensureInstanceOf(t.position.spreadClamp,n.Vector3,new n.Vector3),_distribution:_c.ensureTypedArg(t.position.distribution,_c.types.NUMBER,this.type),_randomise:_c.ensureTypedArg(t.position.randomise,_c.types.BOOLEAN,!1),_radius:_c.ensureTypedArg(t.position.radius,_c.types.NUMBER,10),_radiusScale:_c.ensureInstanceOf(t.position.radiusScale,n.Vector3,new n.Vector3(1,1,1)),_distributionClamp:_c.ensureTypedArg(t.position.distributionClamp,_c.types.NUMBER,0)},this.velocity={_value:_c.ensureInstanceOf(t.velocity.value,n.Vector3,new n.Vector3),_spread:_c.ensureInstanceOf(t.velocity.spread,n.Vector3,new n.Vector3),_distribution:_c.ensureTypedArg(t.velocity.distribution,_c.types.NUMBER,this.type),_randomise:_c.ensureTypedArg(t.position.randomise,_c.types.BOOLEAN,!1)},this.acceleration={_value:_c.ensureInstanceOf(t.acceleration.value,n.Vector3,new n.Vector3),_spread:_c.ensureInstanceOf(t.acceleration.spread,n.Vector3,new n.Vector3),_distribution:_c.ensureTypedArg(t.acceleration.distribution,_c.types.NUMBER,this.type),_randomise:_c.ensureTypedArg(t.position.randomise,_c.types.BOOLEAN,!1)},this.drag={_value:_c.ensureTypedArg(t.drag.value,_c.types.NUMBER,0),_spread:_c.ensureTypedArg(t.drag.spread,_c.types.NUMBER,0),_randomise:_c.ensureTypedArg(t.position.randomise,_c.types.BOOLEAN,!1)},this.wiggle={_value:_c.ensureTypedArg(t.wiggle.value,_c.types.NUMBER,0),_spread:_c.ensureTypedArg(t.wiggle.spread,_c.types.NUMBER,0)},this.rotation={_axis:_c.ensureInstanceOf(t.rotation.axis,n.Vector3,new n.Vector3(0,1,0)),_axisSpread:_c.ensureInstanceOf(t.rotation.axisSpread,n.Vector3,new n.Vector3),_angle:_c.ensureTypedArg(t.rotation.angle,_c.types.NUMBER,0),_angleSpread:_c.ensureTypedArg(t.rotation.angleSpread,_c.types.NUMBER,0),_static:_c.ensureTypedArg(t.rotation.static,_c.types.BOOLEAN,!1),_center:_c.ensureInstanceOf(t.rotation.center,n.Vector3,this.position._value.clone()),_randomise:_c.ensureTypedArg(t.position.randomise,_c.types.BOOLEAN,!1)},this.maxAge={_value:_c.ensureTypedArg(t.maxAge.value,_c.types.NUMBER,2),_spread:_c.ensureTypedArg(t.maxAge.spread,_c.types.NUMBER,0)},this.color={_value:_c.ensureArrayInstanceOf(t.color.value,n.Color,new n.Color),_spread:_c.ensureArrayInstanceOf(t.color.spread,n.Vector3,new n.Vector3),_randomise:_c.ensureTypedArg(t.position.randomise,_c.types.BOOLEAN,!1)},this.opacity={_value:_c.ensureArrayTypedArg(t.opacity.value,_c.types.NUMBER,1),_spread:_c.ensureArrayTypedArg(t.opacity.spread,_c.types.NUMBER,0),_randomise:_c.ensureTypedArg(t.position.randomise,_c.types.BOOLEAN,!1)},this.size={_value:_c.ensureArrayTypedArg(t.size.value,_c.types.NUMBER,1),_spread:_c.ensureArrayTypedArg(t.size.spread,_c.types.NUMBER,0),_randomise:_c.ensureTypedArg(t.position.randomise,_c.types.BOOLEAN,!1)},this.angle={_value:_c.ensureArrayTypedArg(t.angle.value,_c.types.NUMBER,0),_spread:_c.ensureArrayTypedArg(t.angle.spread,_c.types.NUMBER,0),_randomise:_c.ensureTypedArg(t.position.randomise,_c.types.BOOLEAN,!1)},this.particleCount=_c.ensureTypedArg(t.particleCount,_c.types.NUMBER,100),this.duration=_c.ensureTypedArg(t.duration,_c.types.NUMBER,null),this.isStatic=_c.ensureTypedArg(t.isStatic,_c.types.BOOLEAN,!1),this.activeMultiplier=_c.ensureTypedArg(t.activeMultiplier,_c.types.NUMBER,1),this.direction=_c.ensureTypedArg(t.direction,_c.types.NUMBER,1),this.alive=_c.ensureTypedArg(t.alive,_c.types.BOOLEAN,!0),this.particlesPerSecond=0,this.activationIndex=0,this.attributeOffset=0,this.attributeEnd=0,this.age=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.resetFlags={position:_c.ensureTypedArg(t.position.randomise,_c.types.BOOLEAN,!1)||_c.ensureTypedArg(t.radius.randomise,_c.types.BOOLEAN,!1),velocity:_c.ensureTypedArg(t.velocity.randomise,_c.types.BOOLEAN,!1),acceleration:_c.ensureTypedArg(t.acceleration.randomise,_c.types.BOOLEAN,!1)||_c.ensureTypedArg(t.drag.randomise,_c.types.BOOLEAN,!1),rotation:_c.ensureTypedArg(t.rotation.randomise,_c.types.BOOLEAN,!1),rotationCenter:_c.ensureTypedArg(t.rotation.randomise,_c.types.BOOLEAN,!1),size:_c.ensureTypedArg(t.size.randomise,_c.types.BOOLEAN,!1),color:_c.ensureTypedArg(t.color.randomise,_c.types.BOOLEAN,!1),opacity:_c.ensureTypedArg(t.opacity.randomise,_c.types.BOOLEAN,!1),angle:_c.ensureTypedArg(t.angle.randomise,_c.types.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"},this.updateMap)this.updateMap.hasOwnProperty(e)&&(this.updateCounts[this.updateMap[e]]=0,this.updateFlags[this.updateMap[e]]=!1,this._createGetterSetters(this[e],e));this.bufferUpdateRanges={},this.attributeKeys=null,this.attributeCount=0,_c.ensureValueOverLifetimeCompliance(this.color,bc.valueOverLifetimeLength,bc.valueOverLifetimeLength),_c.ensureValueOverLifetimeCompliance(this.opacity,bc.valueOverLifetimeLength,bc.valueOverLifetimeLength),_c.ensureValueOverLifetimeCompliance(this.size,bc.valueOverLifetimeLength,bc.valueOverLifetimeLength),_c.ensureValueOverLifetimeCompliance(this.angle,bc.valueOverLifetimeLength,bc.valueOverLifetimeLength)}function vc(t){(t=_c.ensureTypedArg(t,_c.types.OBJECT,{})).texture=_c.ensureTypedArg(t.texture,_c.types.OBJECT,{}),this.uuid=n.Math.generateUUID(),this.fixedTimeStep=_c.ensureTypedArg(t.fixedTimeStep,_c.types.NUMBER,.016),this.texture=_c.ensureInstanceOf(t.texture.value,n.Texture,null),this.textureFrames=_c.ensureInstanceOf(t.texture.frames,n.Vector2,new n.Vector2(1,1)),this.textureFrameCount=_c.ensureTypedArg(t.texture.frameCount,_c.types.NUMBER,this.textureFrames.x*this.textureFrames.y),this.textureLoop=_c.ensureTypedArg(t.texture.loop,_c.types.NUMBER,1),this.textureFrames.max(new n.Vector2(1,1)),this.hasPerspective=_c.ensureTypedArg(t.hasPerspective,_c.types.BOOLEAN,!0),this.colorize=_c.ensureTypedArg(t.colorize,_c.types.BOOLEAN,!0),this.maxParticleCount=_c.ensureTypedArg(t.maxParticleCount,_c.types.NUMBER,null),this.blending=_c.ensureTypedArg(t.blending,_c.types.NUMBER,n.AdditiveBlending),this.transparent=_c.ensureTypedArg(t.transparent,_c.types.BOOLEAN,!0),this.alphaTest=parseFloat(_c.ensureTypedArg(t.alphaTest,_c.types.NUMBER,0)),this.depthWrite=_c.ensureTypedArg(t.depthWrite,_c.types.BOOLEAN,!1),this.depthTest=_c.ensureTypedArg(t.depthTest,_c.types.BOOLEAN,!0),this.fog=_c.ensureTypedArg(t.fog,_c.types.BOOLEAN,!0),this.scale=_c.ensureTypedArg(t.scale,_c.types.NUMBER,300),this.emitters=[],this.emitterIDs=[],this.pool=[],this.poolCreationSettings=null,this._createNewWhenPoolEmpty=0,this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!1,this.particleCount=0,this.uniforms={textureSampler:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new n.Vector4(this.textureFrames.x,this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}},this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:bc.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,SHOULD_CALCULATE_SPRITE:this.textureFrames.x>1||this.textureFrames.y>1},this.attributes={position:new fc("v3",!0),acceleration:new fc("v4",!0),velocity:new fc("v3",!0),rotation:new fc("v4",!0),rotationCenter:new fc("v3",!0),params:new fc("v4",!0),size:new fc("v4",!0),angle:new fc("v4",!0),color:new fc("v4",!0),opacity:new fc("v4",!0)},this.attributeKeys=Object.keys(this.attributes),this.attributeCount=this.attributeKeys.length,this.material=new n.ShaderMaterial({uniforms:this.uniforms,vertexShader:pc.vertex,fragmentShader:pc.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog}),this.geometry=new n.BufferGeometry,this.mesh=new n.Points(this.geometry,this.material),null===this.maxParticleCount&&console.warn("nunuStudio: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")}function bc(t,e){this.group=new vc(void 0!==t?t:bc.defaultGroup),this.emitter=new yc(void 0!==e?e:bc.defaultEmitter),this.group.addEmitter(this.emitter),n.Points.call(this,this.group.geometry,this.group.material),this.type="ParticleEmiter",this.name="particle",this.frustumCulled=!1,this.dynamicEmitter=!1,this.clock=new n.Clock,this.temp=new n.Vector4;var r=this;Object.defineProperties(this,{texture:{get:function(){return r.group.texture},set:function(t){r.group.texture=t}}})}function xc(){n.Object3D.call(this),i.call(this)}function wc(t){if(this.backgroundColor=null,this.backend=wc.WEBGL2,this.autoClear=!1,this.autoClearColor=!1,this.autoClearDepth=!1,this.autoClearStencil=!1,this.antialiasing=!0,this.shadows=!0,this.stencil=!0,this.shadowsType=n.PCFSoftShadowMap,this.shadowsAutoUpdate=!0,this.toneMapping=n.NoToneMapping,this.toneMappingExposure=1,this.sortObjects=!0,this.gammaFactor=2,this.precision="highp",this.alpha=!0,this.premultipliedAlpha=!0,this.preserveDrawingBuffer=!1,this.powerPreference="high-performance",this.logarithmicDepthBuffer=!1,this.physicallyCorrectLights=!1,this.checkShaderErrors=!0,this.maxMorphTargets=8,this.maxMorphNormals=4,void 0!==t)for(var e in this)void 0!==t[e]&&(this[e]=t[e])}function Sc(){this.desktop={fullscreen:!1,frame:!0,resizable:!0}}yc.constructor=yc,yc.prototype._createGetterSetters=function(t,e){var n=this;for(var r in t)if(t.hasOwnProperty(r)){var i=r.replace("_","");Object.defineProperty(t,i,{get:function(t){return function(){return this[t]}}(r),set:function(t){return function(r){var i=n.updateMap[e],s=this[t],o=bc.valueOverLifetimeLength;"_rotationCenter"===t?(n.updateFlags.rotationCenter=!0,n.updateCounts.rotationCenter=0):"_randomise"===t?n.resetFlags[i]=r:(n.updateFlags[i]=!0,n.updateCounts[i]=0),n.group._updateDefines(),this[t]=r,Array.isArray(s)&&_c.ensureValueOverLifetimeCompliance(n[e],o,o)}}(r)})}},yc.prototype._setBufferUpdateRanges=function(t){this.attributeKeys=t,this.attributeCount=t.length;for(var e=this.attributeCount-1;e>=0;--e)this.bufferUpdateRanges[t[e]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}},yc.prototype._calculatePPSValue=function(t){var e=this.particleCount;this.duration?this.particlesPerSecond=e/(t<this.duration?t:this.duration):this.particlesPerSecond=e/t},yc.prototype._setAttributeOffset=function(t){this.attributeOffset=t,this.activationIndex=t,this.activationEnd=t+this.particleCount},yc.prototype._assignValue=function(t,e){switch(t){case"position":this._assignPositionValue(e);break;case"velocity":case"acceleration":this._assignForceValue(e,t);break;case"size":case"opacity":this._assignAbsLifetimeValue(e,t);break;case"angle":this._assignAngleValue(e);break;case"params":this._assignParamsValue(e);break;case"rotation":this._assignRotationValue(e);break;case"color":this._assignColorValue(e)}},yc.prototype._assignPositionValue=function(t){var e=this.position,n=this.attributes.position,r=e._value,i=e._spread;switch(e._distribution){case gc.BOX:_c.randomVector3(n,t,r,i,e._spreadClamp);break;case gc.SPHERE:_c.randomVector3OnSphere(n,t,r,e._radius,e._spread.x,e._radiusScale,e._spreadClamp.x,e._distributionClamp||this.particleCount);break;case gc.DISC:_c.randomVector3OnDisc(n,t,r,e._radius,e._spread.x,e._radiusScale,e._spreadClamp.x)}},yc.prototype._assignForceValue=function(t,e){var n,r,i,s,o,a=this[e],l=a._value,c=a._spread;switch(a._distribution){case gc.BOX:_c.randomVector3(this.attributes[e],t,l,c);break;case gc.SPHERE:r=(n=this.attributes.position.typedArray.array)[o=3*t],i=n[o+1],s=n[o+2],_c.randomDirectionVector3OnSphere(this.attributes[e],t,r,i,s,this.position._value,a._value.x,a._spread.x);break;case gc.DISC:r=(n=this.attributes.position.typedArray.array)[o=3*t],i=n[o+1],s=n[o+2],_c.randomDirectionVector3OnDisc(this.attributes[e],t,r,i,s,this.position._value,a._value.x,a._spread.x)}if("acceleration"===e){var u=_c.clamp(_c.randomFloat(this.drag._value,this.drag._spread),0,1);this.attributes.acceleration.typedArray.array[4*t+3]=u}},yc.prototype._assignAbsLifetimeValue=function(t,e){var n,r=this.attributes[e].typedArray,i=this[e];_c.arrayValuesAreEqual(i._value)&&_c.arrayValuesAreEqual(i._spread)?(n=Math.abs(_c.randomFloat(i._value[0],i._spread[0])),r.setVec4Components(t,n,n,n,n)):r.setVec4Components(t,Math.abs(_c.randomFloat(i._value[0],i._spread[0])),Math.abs(_c.randomFloat(i._value[1],i._spread[1])),Math.abs(_c.randomFloat(i._value[2],i._spread[2])),Math.abs(_c.randomFloat(i._value[3],i._spread[3])))},yc.prototype._assignAngleValue=function(t){var e,n=this.attributes.angle.typedArray,r=this.angle;_c.arrayValuesAreEqual(r._value)&&_c.arrayValuesAreEqual(r._spread)?(e=_c.randomFloat(r._value[0],r._spread[0]),n.setVec4Components(t,e,e,e,e)):n.setVec4Components(t,_c.randomFloat(r._value[0],r._spread[0]),_c.randomFloat(r._value[1],r._spread[1]),_c.randomFloat(r._value[2],r._spread[2]),_c.randomFloat(r._value[3],r._spread[3]))},yc.prototype._assignParamsValue=function(t){this.attributes.params.typedArray.setVec4Components(t,this.isStatic?1:0,0,Math.abs(_c.randomFloat(this.maxAge._value,this.maxAge._spread)),_c.randomFloat(this.wiggle._value,this.wiggle._spread))},yc.prototype._assignRotationValue=function(t){this.attributes.rotation.typedArray.setVec3Components(t,_c.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),_c.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1),this.attributes.rotationCenter.typedArray.setVec3(t,this.rotation._center)},yc.prototype._assignColorValue=function(t){_c.randomColorAsHex(this.attributes.color,t,this.color._value,this.color._spread)},yc.prototype._resetParticle=function(t){for(var e,n,r=this.resetFlags,i=this.updateFlags,s=this.updateCounts,o=this.attributeKeys,a=this.attributeCount-1;a>=0;--a)n=i[e=o[a]],!0!==r[e]&&!0!==n||(this._assignValue(e,t),this._updateAttributeUpdateRange(e,t),!0===n&&s[e]===this.particleCount?(i[e]=!1,s[e]=0):!0===n&&++s[e])},yc.prototype._updateAttributeUpdateRange=function(t,e){var n=this.bufferUpdateRanges[t];n.min=Math.min(e,n.min),n.max=Math.max(e,n.max)},yc.prototype._resetBufferRanges=function(){for(var t=this.bufferUpdateRanges,e=this.bufferUpdateKeys,n=this.bufferUpdateCount-1;n>=0;--n){var r=e[n];t[r].min=Number.POSITIVE_INFINITY,t[r].max=Number.NEGATIVE_INFINITY}},yc.prototype._onRemove=function(){this.particlesPerSecond=0,this.attributeOffset=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.age=0},yc.prototype._decrementParticleCount=function(){--this.activeParticleCount},yc.prototype._incrementParticleCount=function(){++this.activeParticleCount},yc.prototype._checkParticleAges=function(t,e,n,r){for(var i,s,o,a,l=e-1;l>=t;--l)0!==(a=n[i=4*l])&&(o=n[i+1],s=n[i+2],1===this.direction?(o+=r)>=s&&(o=0,a=0,this._decrementParticleCount()):(o-=r)<=0&&(o=s,a=0,this._decrementParticleCount()),n[i]=a,n[i+1]=o,this._updateAttributeUpdateRange("params",l))},yc.prototype._activateParticles=function(t,e,n,r){for(var i,s,o=this.direction,a=t;a<e;++a)0!==n[i=4*a]&&1!==this.particleCount||(this._incrementParticleCount(),n[i]=1,this._resetParticle(a),s=r*(a-t),n[i+1]=-1===o?n[i+2]-s:s,this._updateAttributeUpdateRange("params",a))},yc.prototype.tick=function(t){if(!this.isStatic){null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);var e=this.attributeOffset,n=e+this.particleCount,r=this.paramsArray,i=this.particlesPerSecond*this.activeMultiplier*t,s=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(e,n,r,t),!1!==this.alive){if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);var o=1===this.particleCount?s:0|s,a=Math.min(o+i,this.activationEnd),l=a-this.activationIndex|0,c=l>0?t/l:0;this._activateParticles(o,a,r,c),this.activationIndex+=i,this.activationIndex>n&&(this.activationIndex=e),this.age+=t}else this.age=0}},yc.prototype.reset=function(t){if(this.age=0,this.alive=!1,!0===t){for(var e,n=this.attributeOffset,r=n+this.particleCount,i=this.paramsArray,s=this.attributes.params.bufferAttribute,o=r-1;o>=n;--o)i[e=4*o]=0,i[e+1]=0;s.updateRange.offset=0,s.updateRange.count=-1,s.needsUpdate=!0}return this},yc.prototype.enable=function(){return this.alive=!0,this},yc.prototype.disable=function(){return this.alive=!1,this},yc.prototype.remove=function(){return null!==this.group?this.group.removeEmitter(this):console.error("nunuStudio: ParticleEmitterControl does not belong to a group, cannot remove."),this},yc.prototype.toJSON=function(t){var e={};e.uuid=this.uuid,e.type=this.type,e.direction=this.direction,e.particleCount=this.particleCount,e.duration=this.duration,e.isStatic=this.isStatic,e.maxAge={},e.maxAge.value=this.maxAge.value,e.maxAge.spread=this.maxAge.spread,e.position={},e.position.value=this.position.value.toArray(),e.position.spread=this.position.spread.toArray(),e.position.radius=this.position.radius,e.position.radiusScale=this.position.radiusScale.toArray(),e.velocity={},e.velocity.value=this.velocity.value.toArray(),e.velocity.spread=this.velocity.spread.toArray(),e.acceleration={},e.acceleration.value=this.acceleration.value.toArray(),e.acceleration.spread=this.acceleration.spread.toArray(),e.wiggle={},e.wiggle.value=this.wiggle.value,e.wiggle.spread=this.wiggle.spread,e.opacity={},e.opacity.value=this.opacity.value.slice(0),e.opacity.spread=this.opacity.spread,e.size={},e.size.value=this.size.value.slice(0),e.size.spread=this.size.spread,e.angle={},e.angle.value=this.angle.value.slice(0),e.angle.spread=this.angle.spread,e.color={},e.color.value=[];for(var n=0;n<this.color.value.length;n++)e.color.value.push(this.color.value[n].getHex());for(e.color.spread=[],n=0;n<this.color.spread.length;n++)e.color.spread.push(this.color.spread[n].toArray());return e},vc.constructor=vc,vc.prototype._updateDefines=function(){for(var t,e=this.emitters,n=this.defines,r=e.length-1;r>=0;--r)t=e[r],n.SHOULD_CALCULATE_SPRITE||(n.SHOULD_ROTATE_TEXTURE=n.SHOULD_ROTATE_TEXTURE||Boolean(Math.max(Math.max.apply(null,t.angle.value),Math.max.apply(null,t.angle.spread)))),n.SHOULD_ROTATE_PARTICLES=n.SHOULD_ROTATE_PARTICLES||Boolean(Math.max(t.rotation.angle,t.rotation.angleSpread)),n.SHOULD_WIGGLE_PARTICLES=n.SHOULD_WIGGLE_PARTICLES||Boolean(Math.max(t.wiggle.value,t.wiggle.spread));this.material.needsUpdate=!0},vc.prototype._applyAttributesToGeometry=function(){var t,e,n=this.attributes,r=this.geometry,i=r.attributes;for(var s in n)n.hasOwnProperty(s)&&(t=n[s],(e=i[s])?e.array=t.typedArray.array:r.setAttribute(s,t.bufferAttribute),t.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)},vc.prototype.addEmitter=function(t){if(t instanceof yc!=0)if(this.emitterIDs.indexOf(t.uuid)>-1)console.error("nunuStudio: ParticleEmitterControl already exists in this group.");else{if(null===t.group){var e=this.attributes,n=this.particleCount,r=n+t.particleCount;for(var i in this.particleCount=r,null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("nunuStudio: ParticleGroup maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount),t._calculatePPSValue(t.maxAge._value+t.maxAge._spread),t._setBufferUpdateRanges(this.attributeKeys),t._setAttributeOffset(n),t.group=this,t.attributes=this.attributes,e)e.hasOwnProperty(i)&&e[i]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);for(var s=n;s<r;++s)t._assignPositionValue(s),t._assignForceValue(s,"velocity"),t._assignForceValue(s,"acceleration"),t._assignAbsLifetimeValue(s,"opacity"),t._assignAbsLifetimeValue(s,"size"),t._assignAngleValue(s),t._assignRotationValue(s),t._assignParamsValue(s),t._assignColorValue(s);return this._applyAttributesToGeometry(),this.emitters.push(t),this.emitterIDs.push(t.uuid),this._updateDefines(t),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this}console.error("nunuStudio: ParticleEmitterControl already belongs to another group.")}else console.error("nunuStudio: emitter argument must be instance of ParticleEmitterControl.",t)},vc.prototype.removeEmitter=function(t){var e=this.emitterIDs.indexOf(t.uuid);if(t instanceof yc!=0)if(-1!==e){for(var n=t.attributeOffset,r=n+t.particleCount,i=this.attributes.params.typedArray,s=n;s<r;++s)i.array[4*s]=0,i.array[4*s+1]=0;for(var o in this.emitters.splice(e,1),this.emitterIDs.splice(e,1),this.attributes)this.attributes.hasOwnProperty(o)&&this.attributes[o].splice(n,r);this.particleCount-=t.particleCount,t._onRemove(),this._attributesNeedRefresh=!0}else console.error("nunuStudio: ParticleEmitterControl does not exist in this group. Will not remove.");else console.error("nunuStudio: emitter argument must be instance of ParticleEmitterControl. Was provided with:",t)},vc.prototype.getFromPool=function(){var t=this.pool,e=this._createNewWhenPoolEmpty;if(t.length)return t.pop();if(e){var n=new yc(this.poolCreationSettings);return this.addEmitter(n),n}return null},vc.prototype.releaseIntoPool=function(t){if(t instanceof yc!=0)return t.reset(),this.pool.unshift(t),this;console.error("nunuStudio: Argument is not instanceof ParticleEmitterControl:",t)},vc.prototype.getPool=function(){return this.pool},vc.prototype.addPool=function(t,e,n){var r;this.poolCreationSettings=e,this._createNewWhenPoolEmpty=Boolean(n);for(var i=0;i<t;++i)r=Array.isArray(e)?new yc(e[i]):new yc(e),this.addEmitter(r),this.releaseIntoPool(r);return this},vc.prototype._triggerSingleEmitter=function(t){var e=this.getFromPool(),r=this;if(null!==e)return t instanceof n.Vector3&&(e.position.value.copy(t),e.position.value=e.position.value),e.enable(),setTimeout((function(){e.disable(),r.releaseIntoPool(e)}),1e3*Math.max(e.duration,e.maxAge.value+e.maxAge.spread)),this;console.log("nunuStudio: ParticleGroup pool ran out.")},vc.prototype.triggerEmitter=function(t,e){if("number"==typeof t&&t>1)for(var n=0;n<t;++n)this._triggerSingleEmitter(e);else this._triggerSingleEmitter(e);return this},vc.prototype._updateUniforms=function(t){this.uniforms.runTime.value+=t,this.uniforms.deltaTime.value=t},vc.prototype._resetBufferRanges=function(){for(var t=this.attributeKeys,e=this.attributeCount-1;e>=0;--e)this.attributes[t[e]].resetUpdateRange()},vc.prototype._updateBuffers=function(t){for(var e,n,r,i=this.attributeKeys,s=this.attributes,o=t.bufferUpdateRanges,a=this.attributeCount-1;a>=0;--a)n=o[e=i[a]],(r=s[e]).setUpdateRange(n.min,n.max),r.flagUpdate()},vc.prototype.tick=function(t){var e=this.emitters,n=e.length,r=t||this.fixedTimeStep,i=this.attributeKeys,s=this.attributes;if(this._updateUniforms(r),this._resetBufferRanges(),0!==n||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(var o,a=0;a<n;++a)(o=e[a]).tick(r),this._updateBuffers(o);if(!0===this._attributesNeedDynamicReset){for(a=this.attributeCount-1;a>=0;--a)s[i[a]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(a=this.attributeCount-1;a>=0;--a)s[i[a]].forceUpdateAll();this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!0}}},vc.prototype.dispose=function(){return this.geometry.dispose(),this.material.dispose(),this},vc.prototype.toJSON=function(t){var e={texture:{}};return e.texture.value=this.texture.uuid,e.texture.frames=this.textureFrames.toArray(),e.texture.frameCount=this.textureFrameCount,e.texture.loop=this.textureLoop,e.fixedTimeStep=this.fixedTimeStep,e.hasPerspective=this.hasPerspective,e.colorize=this.colorize,e.maxParticleCount=this.maxParticleCount,e.transparent=this.transparent,e.blending=this.blending,e.alphaTest=this.alphaTest,e.depthWrite=this.depthWrite,e.depthTest=this.depthTest,e.fog=this.fog,e.scale=this.scale,e},bc.valueOverLifetimeLength=4,bc.prototype=Object.create(n.Points.prototype),bc.defaultEmitter={particleCount:200,velocity:{value:new n.Vector3(0,0,0),spread:new n.Vector3(3,3,3)},acceleration:{value:new n.Vector3(0,0,0),spread:new n.Vector3(0,0,0)}},bc.defaultGroup={texture:{value:null},maxParticleCount:200,blending:n.AdditiveBlending,fog:!1,depthWrite:!1,depthTest:!0,transparent:!0,hasPerspective:!0},bc.prototype.reload=function(){this.dispose();var t=this.children;this.children=[];var e=(new lc).parse(this.toJSON());this.children=t,this.group=e.group,this.emitter=e.emitter,this.geometry=this.group.geometry,this.material=this.group.material},bc.prototype.updateMatrix=function(){this.dynamicEmitter?(this.matrix.makeRotationFromQuaternion(this.quaternion),this.matrix.scale(this.scale)):this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},bc.prototype.onBeforeRender=function(t,e,n,r){this.group.uniforms.scale.value=t.getCurrentViewport(this.temp).w,this.group.tick(this.clock.getDelta()),!0===this.dynamicEmitter&&(this.emitter.position.value=this.position)},bc.prototype.dispose=function(){this.group.dispose(),n.Object3D.prototype.dispose.call(this)},bc.prototype.toJSON=function(t){var e=this.material,r=this.geometry;this.material=void 0,this.geometry=void 0;var i=this.group.texture,s=n.Object3D.prototype.toJSON.call(this,t,(function(t,e){i=i.toJSON(t)}));return this.material=e,this.geometry=r,s.object.group=this.group.toJSON(t),s.object.emitter=this.emitter.toJSON(t),s},bc.fromJSON=function(t,e){function r(t){return Array.isArray(t)?(new n.Vector3).fromArray(t):new n.Vector3(t.x,t.y,t.z)}if(void 0!==t.group){var i=t.group;i.texture.value=e.getTexture(i.texture.value),i.texture.frames=(new n.Vector2).fromArray(i.texture.frames||[1,1])}if(void 0!==t.emitter){var s=t.emitter;s.position.value=r(s.position.value),s.position.spread=r(s.position.spread),s.velocity.value=r(s.velocity.value),s.velocity.spread=r(s.velocity.spread),s.acceleration.value=r(s.acceleration.value),s.acceleration.spread=r(s.acceleration.spread);for(var o=0;o<s.color.value.length;o++)s.color.value[o]=new n.Color(s.color.value[o]),s.color.spread[o]=r(s.color.spread[o])}return new bc(t.group,t.emitter)},xc.prototype=Object.create(n.Object3D.prototype),Object.assign(xc.prototype,i.prototype),xc.prototype.dispose=function(){for(var t=0;t<i.libraries.length;t++){var e=i.libraries[t];for(var n in this[e])this[e][n].dispose instanceof Function&&this[e][n].dispose()}},xc.prototype.removeGeometry=function(t,e){this.traverse((function(n){void 0!==n.geometry&&n.geometry.uuid===t.uuid&&(n.geometry=e)})),delete this.geometries[t.uuid]},xc.prototype.getResourceByName=function(t){for(var e in this.resources)if(this.resources[e].name===t)return this.resources[e];return console.warn("nunuStudio: Resource "+t+" not found"),null},xc.prototype.addResource=function(t){t instanceof Xi&&(this.resources[t.uuid]=t)},xc.prototype.removeResource=function(t){delete this.resources[t.uuid]},xc.prototype.getImageByName=function(t){for(var e in this.images)if(this.images[e].name===t)return this.images[e];return console.warn("nunuStudio: Resource "+t+" not found"),null},xc.prototype.removeImage=function(t){t instanceof Yi&&delete this.images[t.uuid]},xc.prototype.getVideoByName=function(t){for(var e in this.videos)if(this.videos[e].name===t)return this.videos[e];return console.warn("nunuStudio: Resource "+t+" not found"),null},xc.prototype.removeVideo=function(t){t instanceof ec&&delete this.videos[t.uuid]},xc.prototype.getMaterialByName=function(t){for(var e in this.materials)if(this.materials[e].name===t)return this.materials[e];return console.warn("nunuStudio: Resource "+t+" not found"),null},xc.prototype.addMaterial=function(t){t instanceof n.Material&&(this.materials[t.uuid]=t)},xc.prototype.removeMaterial=function(t,e,r){void 0===e&&(e=new n.MeshBasicMaterial),void 0===r&&(r=new n.SpriteMaterial),t instanceof n.Material&&(delete this.materials[t.uuid],this.traverse((function(i){void 0!==i.material&&i.material.uuid===t.uuid&&(i instanceof n.Sprite?i.material=r:i.material=e)})))},xc.prototype.getTextureByName=function(t){for(var e in this.textures)if(this.textures[e].name===t)return this.textures[e];return console.warn("nunuStudio: Resource "+t+" not found"),null},xc.prototype.addTexture=function(t){material instanceof n.Texture&&(this.textures[t.uuid]=t)},xc.prototype.removeTexture=function(t,e){void 0===e&&(e=new n.Texture),t instanceof n.Texture&&(delete this.textures[t.uuid],this.traverse((function(n){if(void 0!==n.material){var r=n.material;r.map&&r.map.uuid===t.uuid&&(r.map=e,r.needsUpdate=!0),r.bumpMap&&r.bumpMap.uuid===t.uuid&&(r.bumpMap=e,r.needsUpdate=!0),r.normalMap&&r.normalMap.uuid===t.uuid&&(r.normalMap=e,r.needsUpdate=!0),r.displacementMap&&r.displacementMap.uuid===t.uuid&&(r.displacementMap=e,r.needsUpdate=!0),r.specularMap&&r.specularMap.uuid===t.uuid&&(r.specularMap=e,r.needsUpdate=!0),r.emissiveMap&&r.emissiveMap.uuid===t.uuid&&(r.emissiveMap=e,r.needsUpdate=!0),r.alphaMap&&r.alphaMap.uuid===t.uuid&&(r.alphaMap=e,r.needsUpdate=!0),r.roughnessMap&&r.roughnessMap.uuid===t.uuid&&(r.roughnessMap=e,r.needsUpdate=!0),r.metalnessMap&&r.metalnessMap.uuid===t.uuid&&(r.metalnessMap=e,r.needsUpdate=!0),r.envMap&&r.envMap.uuid===t.uuid&&(r.envMap=null,r.needsUpdate=!0)}else n instanceof bc&&n.group.texture.uuid===t.uuid&&(n.group.texture=e)})))},xc.prototype.getFontByName=function(t){for(var e in this.fonts)if(this.fonts[e].name===t)return this.fonts[e];return console.warn("nunuStudio: Resource "+t+" not found"),null},xc.prototype.addFont=function(t){t instanceof _o&&(this.fonts[t.uuid]=t)},xc.prototype.removeFont=function(t,e){void 0===e&&(e=new _o),t instanceof _o&&(delete this.fonts[t.uuid],this.traverse((function(n){void 0!==n.font&&n.font.uuid===t.uuid&&n.setFont(e)})))},xc.prototype.getAudioByName=function(t){for(var e in this.audio)if(this.audio[e].name===t)return this.audio[e];return console.warn("nunuStudio: Resource "+t+" not found"),null},xc.prototype.addAudio=function(t){t instanceof yo&&(this.audio[t.uuid]=t)},xc.prototype.removeAudio=function(t,e){void 0===e&&(e=new yo),t instanceof yo&&(delete this.audio[t.uuid],this.traverse((function(n){void 0!==n.audio&&n.audio.uuid===t.uuid&&n.setAudio(e)})))},wc.WEBGL=1,wc.WEBGL2=2,wc.prototype.createRenderer=function(t){var e=null;if(this.backend===wc.WEBGL2)try{e=t.getContext("webgl2",{xrCompatible:!0})}catch(t){console.warn("nunuStudio: Failed to create WebGL2 context",t)}var r={canvas:t,context:e,precision:this.precision,alpha:this.alpha,premultipliedAlpha:this.premultipliedAlpha,antialias:this.antialiasing,stencil:this.stencil,preserveDrawingBuffer:this.preserveDrawingBuffer,powerPreference:this.powerPreference,logarithmicDepthBuffer:this.logarithmicDepthBuffer},i=new n.WebGLRenderer(r);return this.apply(i),null!==this.backgroundColor&&(t.style.backgroundColor=this.backgroundColor),i},wc.prototype.apply=function(t){t.autoClear=this.autoClear,t.autoClearColor=this.autoClearColor,t.autoClearDepth=this.autoClearDepth,t.autoClearStencil=this.autoClearStencil,t.shadowMap.enabled=this.shadows,t.shadowMap.type=this.shadowsType,t.shadowMap.autoUpdate=this.shadowsAutoUpdate,t.shadowMap.needsUpdate=!0,t.toneMapping=this.toneMapping,t.toneMappingExposure=this.toneMappingExposure,t.debug.checkShaderErrors=this.checkShaderErrors,t.sortObjects=this.sortObjects,t.gammaFactor=this.gammaFactor,t.physicallyCorrectLights=this.physicallyCorrectLights,t.maxMorphTargets=this.maxMorphTargets,t.maxMorphNormals=this.maxMorphNormals},wc.prototype.toJSON=function(){return{backgroundColor:this.backgroundColor,backend:this.backend,autoClear:this.autoClear,autoClearColor:this.autoClearColor,autoClearDepth:this.autoClearDepth,autoClearStencil:this.autoClearStencil,antialiasing:this.antialiasing,shadows:this.shadows,stencil:this.stencil,shadowsType:this.shadowsType,shadowsAutoUpdate:this.shadowsAutoUpdate,toneMapping:this.toneMapping,toneMappingExposure:this.toneMappingExposure,sortObjects:this.sortObjects,checkShaderErrors:this.checkShaderErrors,gammaFactor:this.gammaFactor,precision:this.precision,alpha:this.alpha,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:this.preserveDrawingBuffer,powerPreference:this.powerPreference,logarithmicDepthBuffer:this.logarithmicDepthBuffer,physicallyCorrectLights:this.physicallyCorrectLights,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals}},wc.prototype.fromJSON=function(t){this.backgroundColor=t.backgroundColor,this.backend=t.backend,this.autoClear=t.autoClear,this.autoClearColor=t.autoClearColor,this.autoClearDepth=t.autoClearDepth,this.autoClearStencil=t.autoClearStencil,this.antialiasing=t.antialiasing,this.shadows=t.shadows,this.stencil=t.stencil,this.shadowsType=t.shadowsType,this.shadowsAutoUpdate=t.shadowsAutoUpdate,this.toneMapping=t.toneMapping,this.toneMappingExposure=t.toneMappingExposure,this.sortObjects=t.sortObjects,this.checkShaderErrors=t.checkShaderErrors,this.gammaFactor=t.gammaFactor,this.precision=t.precision,this.alpha=t.alpha,this.premultipliedAlpha=t.premultipliedAlpha,this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.powerPreference=t.powerPreference,this.logarithmicDepthBuffer=t.logarithmicDepthBuffer,this.physicallyCorrectLights=t.physicallyCorrectLights,this.maxMorphTargets=t.maxMorphTargets,this.maxMorphNormals=t.maxMorphNormals};var Mc=__webpack_require__(872);function Tc(t,e){this.element=document.createElement(void 0!==e?e:"div"),this.element.style.position="absolute",this.element.style.overflow="hidden",this.event=new ji,this.parent=null,void 0!==t&&this.attachTo(t),this.visible=!0,this.size=new n.Vector2(0,0),this.position=new n.Vector2(0,0),this._mode=Tc.TOP_LEFT}function Ec(t){this.program=null,this.renderer=null,this.running=!1,this.canvasFitWindow=!1,this.canvas=t,this.events=new ji,void 0===t&&(this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0px",this.canvas.style.top="0px",this.canvasFitWindow=!0,document.body.appendChild(this.canvas))}function Ac(){}function $c(){}function Cc(){xc.call(this),this.type="Program",this.matrixAutoUpdate=!1,this.app=null,this.name="program",this.description="",this.author="",this.version="0.0.0",this.lockPointer=!1,this.handlePixelRatio=!0,this.ar=!0,this.vr=!0,this.vrScale=1,this.rendererConfig=new wc,this.targetConfig=new Sc,this.defaultScene=null,this.defaultCamera=null,this.scene=null,this.keyboard=null,this.mouse=null,this.renderer=null,this.canvas=null,this.division=null,this.manager=new ji,this.clock=new n.Clock,this.xrEnabled=!1,this.xrMode=Cc.XR_NONE}function Bc(){n.Scene.call(this),this.name="scene",this.matrixAutoUpdate=!1,this.usePhysics=!0,this.world=new Li,this.world.defaultContactMaterial.contactEquationStiffness=1e9,this.world.defaultContactMaterial.contactEquationRelaxation=4,this.world.quatNormalizeSkip=0,this.world.quatNormalizeFast=!1,this.world.gravity.set(0,-9.8,0),this.world.broadphase=new Q,this.world.solver=new Qn(new Xn),this.world.solver.tolerance=.05,this.world.solver.iterations=7,this.background=null,this.alpha=1,this.cameras=[],this.defaultCamera=null,this.delta=0,this.raycaster=new n.Raycaster,this.useOctree=!1,this.octree=null,this.octreeUpdateScheduled=!1,this.octreeMatches=[],this.program=null,this.canvas=null,this.mouse=new n.Vector2(0,0)}function Lc(t){n.AnimationMixer.call(this,t),this.playing=!1}Tc.prototype.constructor=Tc,Tc.prototype.isComponent=!0,Tc.TOP_LEFT=0,Tc.TOP_RIGHT=1,Tc.BOTTOM_LEFT=2,Tc.BOTTOM_RIGHT=3,Tc.preventDefault=function(t){t.preventDefault()},Tc.prototype.addEvent=function(t,e){this.event.addAndCreate(this.element,t,e)},Tc.prototype.removeEvent=function(t){this.event.remove(this.element,t)},Tc.prototype.replaceEvent=function(t,e){this.event.remove(this.element,t),this.event.addAndCreate(this.element,t,e)},Tc.prototype.addClass=function(t){this.element.classList.add(t)},Tc.prototype.removeClass=function(t){this.element.classList.contains(t)&&this.element.classList.remove(t)},Tc.prototype.setStyle=function(t,e){this.element.style[t]=e},Tc.prototype.setStyles=function(t){for(var e in t)this.element.style[e]=t[e]},Tc.prototype.preventDragEvents=function(){this.element.ondrop=Tc.preventDefault,this.element.ondragover=Tc.preventDefault},Tc.prototype.setAltText=function(t){var e=document.createElement("div");e.style.position="absolute",e.style.display="none",e.style.alignItems="center",e.style.zIndex="10000",e.style.border="3px solid",e.style.borderRadius="5px",e.style.color="var(--color-light)",e.style.backgroundColor="var(--bar-color)",e.style.borderColor="var(--bar-color)",e.style.height="fit-content",document.body.appendChild(e);var n=document.createTextNode(t);e.appendChild(n);var r=this.destroy;return this.destroy=function(){r.call(this),document.body.contains(e)&&document.body.removeChild(e)},this.element.style.pointerEvents="auto",this.addEvent("mousemove",(function(t){e.style.display="flex",e.style.left=t.clientX+8+"px",e.style.top=t.clientY-20+"px"})),this.addEvent("mouseout",(function(){e.style.display="none"})),e},Tc.prototype.setOnClick=function(t){this.addEvent("click",t)},Tc.prototype.removeAllChildren=function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild)},Tc.prototype.attachTo=function(t){this.parent!==t&&void 0!==t&&(null!==this.parent&&Tc.prototype.destroy.call(this),this.parent=t,!0===t.isComponent?t.element.appendChild(this.element):(console.warn("nunuStudio: Parent is not a Component.",this),this.parent.appendChild(this.element)))},Tc.prototype.watchPointer=function(){var t=this;this.pointerInside=!1,this.element.addEventListener("mouseenter",(function(){t.pointerInside=!0})),this.element.addEventListener("mouseleave",(function(){t.pointerInside=!1}))},Tc.prototype.destroy=function(){null!==this.parent&&(!0===this.parent.isComponent?this.parent.element.contains(this.element)&&(this.parent.element.removeChild(this.element),this.parent=null):(console.warn("nunuStudio: Parent is not a Component.",this),this.parent.contains(this.element)&&(this.parent.removeChild(this.element),this.parent=null)))},Tc.prototype.setMode=function(t){this._mode=t,this.element.style.bottom=null,this.element.style.top=null,this.element.style.right=null,this.element.style.left=null},Tc.prototype.center=function(){this.position.set((this.parent.size.x-this.size.x)/2,(this.parent.size.y-this.size.y)/2)},Tc.prototype.setVisibility=function(t){this.visible=t,this.updateVisibility()},Tc.prototype.updateVisibility=function(){this.element.style.display=this.visible?"block":"none"},Tc.prototype.updatePosition=function(t){void 0!==t&&(this._mode=t),this._mode===Tc.TOP_LEFT||this._mode===Tc.TOP_RIGHT?this.element.style.top=this.position.y+"px":this.element.style.bottom=this.position.y+"px",this._mode===Tc.TOP_LEFT||this._mode===Tc.BOTTOM_LEFT?this.element.style.left=this.position.x+"px":this.element.style.right=this.position.x+"px"},Tc.prototype.updateSize=function(){this.element.style.width=this.size.x+"px",this.element.style.height=this.size.y+"px"},Tc.prototype.updateInterface=function(){this.updateVisibility(),this.visible&&(this.updateSize(),this.updatePosition())},Ec.loadApp=function(t,e){"string"==typeof e&&(e=document.getElementById(e));var n=new Ec(e);n.loadRunProgram(t),window.addEventListener("resize",(function(){jc.isFullscreen()?(n.canvas.width=window.innerWidth,n.canvas.height=window.innerHeight):n.canvas.parentElement&&(n.canvas.width=n.canvas.parentElement.offsetWidth,n.canvas.height=n.canvas.parentElement.offsetHeight),n.resize()}))},Ec.prototype.run=function(){if(null!==this.program){if(this.renderer=this.program.rendererConfig.createRenderer(this.canvas),this.program.app=this,this.program.defaultCamera=new uo(60,1,.1,1e5),this.program.defaultCamera.position.set(0,5,-5),this.program.setRenderer(this.renderer),this.program.initialize(),this.program.lockPointer){var t=this.canvas,e=this.mouse;this.events.add(t,"click",(function(){e.setLock(!0)}))}var n=this;this.events.add(window,"beforeunload",(function(){n.exit()})),this.events.create(),this.resize(),this.resume()}else console.warn("nunuStudio: no program is loaded [app.loadPogram(fname)]")},Ec.prototype.loadRunProgram=function(t,e,n){this.loadProgramAsync(t,(function(t){t.run(),void 0!==e&&e(t)}),n)},Ec.prototype.loadProgram=function(t){if(t.endsWith(".isp")){var e=new lc,n=qi.readFile(t);this.program=e.parse(JSON.parse(n))}else if(t.endsWith(".nsp")){e=new lc,n=qi.readFileArrayBuffer(t);var r=new Mc.fG}this.program=e.parse(r.decode(n))},Ec.prototype.loadProgramAsync=function(t,e,n){var r=this;t.endsWith(".isp")?qi.readFile(t,!1,(function(t){var n=new lc;r.program=n.parse(JSON.parse(t)),void 0!==e&&e(r)}),(function(t){var e=t.lengthComputable?t.loaded/t.total*100:0;n(e,t)})):t.endsWith(".nsp")&&qi.readFileArrayBuffer(t,!1,(function(t){var n=new lc,i=new Mc.fG;r.program=n.parse(i.decode(t)),void 0!==e&&e(r)}),(function(t){var e=t.lengthComputable?t.loaded/t.total*100:0;n(e,t)}))},Ec.prototype.update=function(){this.program.update(),this.program.render(this.renderer)},Ec.prototype.exit=function(){this.events.destroy(),null!==this.program&&(this.program.dispose(),this.program=null),null!==this.renderer&&(this.renderer.dispose(),this.renderer=null),void 0!==this.onExit&&this.onExit()},Ec.prototype.resume=function(){if(null!==this.program&&!this.running){var t=this;this.renderer.setAnimationLoop((function(){t.update()})),this.running=!0}},Ec.prototype.pause=function(){this.running=!1,this.renderer.setAnimationLoop(null)},Ec.prototype.setCanvas=function(t){this.canvas=t,this.canvasFitWindow=!1},Ec.prototype.resize=function(){if(null!==this.canvas&&null!==this.program&&null!==this.renderer){var t=1,e=1;this.canvasFitWindow?(this.canvas.style.width=window.innerWidth+"px",this.canvas.style.height=window.innerHeight+"px",t=window.innerWidth,e=window.innerHeight):(t=this.canvas.offsetWidth,e=this.canvas.offsetHeight),this.program.handlePixelRatio&&(t*=window.devicePixelRatio,e*=window.devicePixelRatio),this.renderer.setSize(t,e,!1),this.program.resize(t,e)}},Ec.prototype.sendData=function(t){null!==this.program&&this.program.receiveDataApp(t)},Ec.prototype.setOnDataReceived=function(t){this.onDataReceived=t},Ec.prototype.setOnExit=function(t){this.onExit=t},Ec.prototype.vrAvailable=function(){return null!==this.program&&this.program.vrAvailable()},Ec.prototype.toggleVR=function(){this.vrAvailable()?this.program.xrEnabled?this.program.exitVR():this.program.enterVR():console.warn("nunuStudio: Loaded program is not VR enabled.")},Ec.prototype.arAvailable=function(){return null!==this.program&&this.program.arAvailable()},Ec.prototype.toggleAR=function(){this.arAvailable()?this.program.xrEnabled?this.program.exitAR():this.program.enterAR():console.warn("nunuStudio: Loaded program is not AR enabled.")},Ec.prototype.toggleFullscreen=function(t){var e=jc.isFullscreen();void 0===t&&(t=this.canvas),jc.setFullscreen(!e,t)},Ac.webXRAvailable=!1,Ac.webXRSession=null,Ac.webVRAvailable=!1,Ac.webVRDisplay=null,Ac.vrAvailable=function(){return Ac.webXRAvailable||Ac.webVRAvailable},Ac.enterVR=function(t,e){Ac.webXRAvailable?Ac.getWebXRSession().then((function(n){t.xr.enabled=!0,t.xr.setSession(n),Ac.webXRSession=n,void 0!==e&&e()})).catch((function(t){console.warn("nunuStudio: Failed to start VR WebXR session.",t)})):Ac.webVRAvailable?Ac.getWebVRDisplay().then((function(n){displays.length>0&&(Ac.webVRDisplay=displays[0],Ac.webVRDisplay.isPresenting||(t.xr.enabled=!0,t.xr.setDevice(Ac.webVRDisplay),Ac.webVRDisplay.requestPresent([{source:t.domElement}]),void 0!==e&&e()))})).catch((function(t){console.warn("nunuStudio: Failed to start VR WebVR session.",t)})):console.warn("nunuStudio: VR support is not available.")},Ac.exitVR=function(t){Ac.webXRAvailable&&null!==Ac.webXRSession?(t.xr.enabled=!1,t.xr.setSession(null),Ac.webXRSession.end(),Ac.webXRSession=null):Ac.webVRAvailable&&null!==Ac.webVRDisplay&&Ac.webVRDisplay.isPresenting&&(t.xr.enabled=!1,t.xr.setDevice(null),Ac.webVRDisplay.exitPresent(),Ac.webVRDisplay=null)},Ac.getWebXRSession=function(){return Ac.webXRAvailable?navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor"]}):Promise.reject("WebXR support is not available.")},Ac.getWebVRDisplay=function(t){return Ac.webVRAvailable?navigator.getVRDisplays():Promise.reject("WebVR support is not available.")},void 0!==navigator.xr&&void 0!==navigator.xr.isSessionSupported?navigator.xr.isSessionSupported("immersive-vr").then((function(t){Ac.webXRAvailable=t})):void 0!==navigator.getVRDisplays&&navigator.getVRDisplays().then((function(t){Ac.webVRAvailable=t.length>0})),$c.OPAQUE="opaque",$c.ADDITIVE="additive",$c.ALPHA_BLEND="alpha-blend",$c.webXRAvailable=!1,$c.webXRSession=null,$c.arAvailable=function(){return $c.webXRAvailable},$c.enterAR=function(t,e){$c.webXRAvailable?$c.getWebXRSession().then((function(n){t.xr.enabled=!0,t.xr.setReferenceSpaceType("local"),t.xr.setSession(n),console.log("nunuStudio: New AR WebXR session created",n),$c.webXRSession=n,void 0!==e&&e()})).catch((function(t){console.warn("nunuStudio: Failed to start AR WebXR session.",t)})):console.warn("nunuStudio: AR support is not available.")},$c.exitAR=function(t){$c.webXRAvailable&&null!==$c.webXRSession&&(t.xr.enabled=!1,t.xr.setSession(null),$c.webXRSession.end(),$c.webXRSession=null)},$c.getWebXRSession=function(){return $c.webXRAvailable?navigator.xr.requestSession("immersive-ar",{}):Promise.reject("WebXR support is not available.")},void 0!==navigator.xr&&void 0!==navigator.xr.isSessionSupported&&navigator.xr.isSessionSupported("immersive-ar").then((function(t){$c.webXRAvailable=t})),Cc.XR_NONE=0,Cc.XR_VR=1,Cc.XR_AR=2,Cc.prototype=Object.create(xc.prototype),Cc.prototype.initialize=function(){if(null===this.mouse&&(this.mouse=new zi,this.mouse.setCanvas(this.canvas),this.mouse.create()),null===this.keyboard&&(this.keyboard=new Ws,this.keyboard.create()),this.manager.create(),null!==this.defaultScene){for(var t=0;t<this.children.length;t++)if(this.children[t].uuid===this.defaultScene){this.setScene(this.children[t]);break}}else this.children.length>0&&this.setScene(this.children[0]);this.lockPointer&&null!==this.mouse&&this.mouse.setLock(!0),this.clock.start()},Cc.prototype.setMouseKeyboard=function(t,e){this.mouse!==t&&(null!==this.mouse&&this.mouse.dispose(),this.mouse=t),this.keyboard!==e&&(null!==this.keyboard&&this.keyboard.dispose(),this.keyboard=e)},Cc.prototype.setRenderer=function(t,e){this.renderer=t,this.renderer.autoClear=!1,this.canvas=t.domElement,this.division=this.canvas.parentElement,e&&this.updateRenderer()},Cc.prototype.update=function(){var t=this.clock.getDelta();this.mouse.update(),this.keyboard.update(),this.scene.update(t)},Cc.prototype.render=function(t){this.scene.render(t)},Cc.prototype.resize=function(t,e){null!==this.defaultCamera&&this.defaultCamera.resize(t,e),this.scene.resize(t,e)},Cc.prototype.updateRenderer=function(){null!==this.renderer&&this.rendererConfig.apply(this.renderer)},Cc.prototype.arAvailable=function(){return this.ar&&$c.arAvailable()},Cc.prototype.enterAR=function(){if(this.arAvailable()&&!this.xrEnabled){var t=this;$c.enterAR(this.renderer,(function(){t.xrMode=Cc.XR_AR,t.xrEnabled=!0}))}},Cc.prototype.exitAR=function(){this.xrEnabled&&($c.exitAR(this.renderer),this.xrMode=Cc.XR_NONE,this.xrEnabled=!1)},Cc.prototype.vrAvailable=function(){return this.vr&&Ac.vrAvailable()},Cc.prototype.enterVR=function(){if(this.vrAvailable()&&!this.xrEnabled){var t=this;Ac.enterVR(this.renderer,(function(){t.xrMode=Cc.XR_VR,t.xrEnabled=!0}))}},Cc.prototype.exitVR=function(){this.vr&&(Ac.exitVR(this.renderer),this.xrMode=Cc.XR_NONE,this.xrEnabled=!1)},Cc.prototype.setScene=function(t){"string"==typeof t&&(t=this.getObjectByName(t)),null!==this.scene&&this.scene.dispose(),this.scene=t,null!==this.scene?(null===this.scene.defaultCamera&&(this.scene.defaultCamera=this.defaultCamera),this.scene.initialize(),null!==this.canvas&&this.scene.resize(this.canvas.width,this.canvas.height)):console.warn("nunuStudio: Program setScene scene is null.")},Cc.prototype.remove=function(t){if(t instanceof n.Scene){var e=this.children.indexOf(t);e>-1&&(this.children.splice(e,1),t.parent=null),t===this.scene&&(this.scene.dispose(),this.scene=null),0===this.children.length&&(this.scene=null)}else console.warn("nunuStudio: Trying to remove Object3D from program, only Scene objects allowed.")},Cc.prototype.add=function(t){t instanceof n.Scene?(t.parent=this,this.children.push(t)):console.warn("nunuStudio: Trying to add Object3D to program, only Scene objects allowed.")},Cc.prototype.clone=function(){return(new lc).parse(this.toJSON())},Cc.prototype.setInitialScene=function(t){this.defaultScene=t.uuid},Cc.prototype.dispose=function(){null!==this.mouse&&(this.lockPointer&&this.mouse.setLock(!1),this.mouse.dispose()),null!==this.keyboard&&this.keyboard.dispose(),this.manager.destroy(),null!==this.scene?this.scene.dispose():console.warn("nunuStudio: Program dispose() scene is null.",this),xc.prototype.dispose.call(this),n.Object3D.prototype.dispose.call(this)},Cc.prototype.receiveDataApp=function(t){var e=!1;this.traverse((function(n){n instanceof xo&&(n.appData(t),e=!0)})),e||console.warn("nunuStudio: No script with onAppData found",t)},Cc.prototype.sendDataApp=function(t){null!==this.app?void 0!==this.app.onDataReceived?this.app.onDataReceived(t):console.warn("nunuStudio: Send app data communication",t):console.warn("nunuStudio: Data sent to app",t)},Cc.prototype.toJSON=function(t,e){var r=this,s=n.Object3D.prototype.toJSON.call(this,t,(function(t){if(!1!==e)for(var n=0;n<i.libraries.length;n++){var s=r[i.libraries[n]];for(var o in s){var a=s[o];void 0===t[i.libraries[n]][a.uuid]&&(t[i.libraries[n]][a.uuid]=a.toJSON(t))}}}));return null!==this.defaultScene&&(s.object.defaultScene=this.defaultScene),s.object.author=this.author,s.object.description=this.description,s.object.version=this.version,s.object.lockPointer=this.lockPointer,s.object.handlePixelRatio=this.handlePixelRatio,s.object.ar=this.ar,s.object.vr=this.vr,s.object.vrScale=this.vrScale,s.object.rendererConfig=this.rendererConfig.toJSON(),s},Bc.prototype=Object.create(n.Scene.prototype),Bc.prototype.initialize=function(){this.program=this.parent,this.canvas=this.parent.canvas,n.Object3D.prototype.initialize.call(this);for(var t=0;t<this.children.length;t++)this.children[t].traverse((function(t){t.initialize()}))},Bc.prototype.update=function(t){this.mouse.set(this.program.mouse.position.x/this.canvas.width*2-1,-2*this.program.mouse.position.y/this.canvas.height+1),this.cameras.length>0?this.raycaster.setFromCamera(this.mouse,this.cameras[0]):null!==this.defaultCamera&&this.raycaster.setFromCamera(this.mouse,this.defaultCamera),this.usePhysics&&this.world.step(t<.05?t:.05);for(var e=0;e<this.children.length;e++)this.children[e].traverse((function(e){e.update(t)}))},Bc.prototype.resize=function(t,e){null!==this.defaultCamera&&this.defaultCamera.resize(t,e);for(var n=0;n<this.cameras.length;n++)this.cameras[n].resize(t,e);for(n=0;n<this.children.length;n++)this.children[n].traverse((function(n){n.resize(t,e)}))},Bc.prototype.dispose=function(){for(var t=0;t<this.children.length;t++)this.children[t].traverse((function(t){t.dispose()}))},Bc.prototype.render=function(t){if(t.setClearColor(this.background,this.alpha),this.cameras.length>0)if(this.program.xrEnabled){if(this.program.xrMode===Cc.XR_VR)for(var e=0;e<this.cameras.length;e++)this.cameras[e].render(t,this);else if(this.program.xrMode===Cc.XR_AR)for(t.setClearColor(null),e=0;e<this.cameras.length;e++)t.render(this,this.cameras[e])}else{for(t.setScissorTest(!0),e=0;e<this.cameras.length;e++)this.cameras[e].setupRenderer(t),this.cameras[e].render(t,this);t.setScissorTest(!1)}else null!==this.defaultCamera&&(this.program.xrMode===Cc.XR_AR?(t.setClearColor(null),t.render(this,this.defaultCamera)):this.defaultCamera.render(t,this))},Bc.prototype.getCamera=function(t,e){if(void 0===e&&(e=this),t===e.uuid)return e;for(var n=e.children,r=0;r<n.length;r++){var i=this.getCamera(t,n[r]);if(null!==i)return i}return null},Bc.prototype.addCamera=function(t){-1===this.cameras.indexOf(t)&&(this.cameras.push(t),this.updateCameraOrder())},Bc.prototype.updateCameraOrder=function(){this.cameras.sort((function(t,e){return t.order>e.order}))},Bc.prototype.removeCamera=function(t){var e=this.cameras.indexOf(t);e>-1&&this.cameras.splice(e,1)},Bc.prototype.isCameraActive=function(t){return this.cameras.indexOf(t)>-1},Bc.prototype.setFogMode=function(t){var e=null!==this.fog?this.fog.color.getHex():"#FFFFFF";t===n.Fog.LINEAR?this.fog=new n.Fog(e,5,20):t===n.Fog.EXPONENTIAL?this.fog=new n.FogExp2(e,.01):t===n.Fog.NONE&&(this.fog=null)},Bc.prototype.toJSON=function(t){if(!this.parent||"Program"!==this.parent.type)return console.warn("nunuStudio: Scene is not on top level serializing as Group."),this.type="Group",n.Object3D.prototype.toJSON.call(this,t);var e=this,r=n.Object3D.prototype.toJSON.call(this,t,(function(t,r){e.background instanceof n.Color?r.background=e.background.toJSON(t):e.background instanceof n.Texture&&(r.background=e.background.toJSON(t).uuid),e.environment instanceof n.Texture&&(r.environment=e.environment.toJSON(t).uuid)}));if(null!==this.defaultCamera){var i=new n.Vector3,s=new n.Quaternion,o=new n.Vector3;this.defaultCamera.matrixWorld.decompose(i,s,o);var a=this.defaultCamera.toJSON(t);a.object.position=i.toArray(),a.object.quaternion=s.toArray(),a.object.scale=o.toArray(),r.object.defaultCamera=a}null!==this.fog&&(r.object.fog=this.fog.toJSON()),r.object.usePhysics=this.usePhysics,r.object.cameras=[];for(var l=0;l<this.cameras.length;l++)r.object.cameras.push(this.cameras[l].uuid);return r.object.world={},r.object.world.gravity=this.world.gravity,r.object.world.quatNormalizeSkip=this.world.quatNormalizeSkip,r.object.world.quatNormalizeFast=this.world.quatNormalizeFast,r.object.world.solver={},r.object.world.solver.tolerance=this.world.solver.tolerance,r.object.world.solver.iterations=this.world.solver.iterations,r},Lc.prototype=Object.create(n.AnimationMixer.prototype),Lc.prototype.createActions=function(t){for(var e=0;e<t.length;e++){var n=this.clipAction(t[e]);n.setLoop(t[e].loop),n.weight=t[e].weight,n.timeScale=t[e].timeScale,n.enabled=t[e].enabled,n.play()}return this._actions},Lc.prototype.setTime=function(t){this.time=t;for(var e=0;e<this._actions.length;e++)this._actions[e].time=t;this.update(0,!0)},Lc.prototype.play=function(){this.playing=!0},Lc.prototype.stop=function(){this.setTime(0),this.playing=!1},Lc.prototype.pause=function(){this.playing=!1},Lc.prototype.dispose=function(){this.stopAllAction(),this.uncacheRoot(this._root)},Lc.prototype.update=function(t,e){if(this.playing||e){this.time+=t;for(var n=Math.sign(t),r=0;r<this._actions.length;r++)this._actions[r]._update(this.time,t,n,this._accuIndex);for(r=0;r<this._bindings.length;r++)this._bindings[r].apply(this._accuIndex)}return this};var Rc=__webpack_require__(412);Rc.Object3D.prototype.folded=!1,Rc.Object3D.prototype.locked=!1,Rc.Object3D.prototype.contains=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].uuid===t.uuid||this.children[e].contains(t))return!0;return!1},Rc.Object3D.prototype.playAnimation=function(){void 0!==this.mixer&&this.mixer.play()},Rc.Object3D.prototype.stopAnimation=function(){void 0!==this.mixer&&this.mixer.stop()},Rc.Object3D.prototype.initialize=function(){void 0!==this.animations&&(this.mixer=new Lc(this),this.mixer.createActions(this.animations),this.mixer.play())},Rc.Object3D.prototype.update=function(t){void 0!==this.mixer&&this.mixer.update(t)},Rc.Object3D.prototype.resize=function(t,e){},Rc.Object3D.prototype.dispose=function(){void 0!==this.mixer&&this.mixer.dispose()},Rc.Object3D.prototype.addAbove=function(t,e){if(t===this)return console.error("Object3D.add: object can't be added as a child of itself.",t),this;if(t&&t.isTHREE.Object3D){null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"});var n=this.children.indexOf(e);this.children.splice(n,0,t)}else console.error("Object3D.add: object not an instance of THREE.Object3D.",t);return this},Rc.Object3D.prototype.addBellow=function(t,e){if(t===this)return console.error("Object3D.add: object can't be added as a child of itself.",t),this;if(t&&t.isTHREE.Object3D){null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"});var n=this.children.indexOf(e)+1;this.children.splice(n,0,t)}else console.error("Object3D.add: object not an instance of THREE.Object3D.",t);return this},Rc.Object3D.prototype.getScene=function(){for(var t=this;null!==t.parent;)if((t=t.parent)instanceof Bc)return t;return null},Rc.Object3D.prototype.removeAll=function(){for(;this.children.length>0;)this.remove(this.children[0])},Rc.Object3D.prototype.isEmpty=function(){return 0===this.children.length},Rc.Object3D.prototype.destroy=function(){for(;this.children.length>0;)this.children[0].destroy();null!==this.parent&&(this.dispose&&this.dispose(),this.parent.remove(this),this.parent=null)},Rc.Object3D.prototype.toJSON=function(t,e,r){var s=void 0===t,o={};s&&(t=new i,o.metadata={version:VERSION,type:"Object3D"});var a={};if(a.uuid=this.uuid,a.type=this.type,a.name=this.name,a.folded=this.folded,a.locked=this.locked,a.castShadow=this.castShadow,a.receiveShadow=this.receiveShadow,a.visible=this.visible,a.matrixAutoUpdate=this.matrixAutoUpdate,a.frustumCulled=this.frustumCulled,a.renderOrder=this.renderOrder,a.position=this.position.toArray(),a.quaternion=this.quaternion.toArray(),a.scale=this.scale.toArray(),a.layers=this.layers.mask,a.userData=this.userData,void 0!==this.geometry){a.geometry=f(t.geometries,this.geometry);var l=this.geometry.parameters;if(void 0!==l&&void 0!==l.shapes){var c=l.shapes;if(Array.isArray(c))for(var u=0,h=c.length;u<h;u++){var p=c[u];f(t.shapes,p)}else f(t.shapes,c)}}if(void 0!==this.material)if(this.material instanceof n.Material)a.material=f(t.materials,this.material);else if(this.material instanceof Array){var d=[];for(u=0;u<this.material.length;u++)d.push(f(t.materials,this.material[u]));a.material=d}if(void 0!==this.animations&&this.animations.length>0)for(a.animations=[],u=0;u<this.animations.length;u++)a.animations.push(n.AnimationClip.toJSON(this.animations[u]));if(o.object=a,void 0!==e&&e(t,a,o),!1!==r&&this.children.length>0)for(a.children=[],u=0;u<this.children.length;u++)this.children[u].locked||a.children.push(this.children[u].toJSON(t).object);return s&&(o.geometries=m(t.geometries),o.materials=m(t.materials),o.textures=m(t.textures),o.images=m(t.images),o.videos=m(t.videos),o.audio=m(t.audio),o.fonts=m(t.fonts),o.skeletons=m(t.skeletons),o.resources=m(t.resources),o.shapes=m(t.shapes)),o;function f(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}function m(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}},__webpack_require__(870);var Nc=__webpack_require__(412),Pc={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array},Ic=function(t){if(void 0!==t.array){var e=new Pc[t.type](t.array),r=new(t.isInstancedBufferAttribute?n.InstancedBufferAttribute:n.BufferAttribute)(e,t.itemSize,t.normalized);return void 0!==t.name&&(r.name=t.name),r}if("BufferAttribute"===t.type)e=new Pc[t.typedArray.type](t.typedArray.array),r=new n.BufferAttribute(e,t.itemSize,t.normalized);else if("InstancedBufferAttribute"===t.type)e=new Pc[t.typedArray.type](t.typedArray.array),r=new n.InstancedBufferAttribute(e,t.itemSize,t.normalized,t.meshPerAttribute);else if("InterleavedBufferAttribute"===t.type){e=new Pc[t.data.typedArray.type](t.data.typedArray.array);var i=new n.InterleavedBuffer(e,t.data.stride);i.setUsage(t.data.usage),i.count=t.data.count,r=new n.InterleavedBufferAttribute(i,t.itemSize,t.offset,t.normalized)}return void 0!==t.name&&(r.name=t.name),r};Nc.BufferGeometryLoader.prototype.parse=function(t){var e=t.isInstancedBufferGeometry?new n.InstancedBufferGeometry:new n.BufferGeometry,r=t.data.index;if(void 0!==r){var i=new Pc[r.type](r.array);e.setIndex(new n.BufferAttribute(i,1))}var s=t.data.attributes;for(var o in s)e.setAttribute(o,Ic(s[o]));var a=t.data.morphAttributes;if(a)for(var o in a){for(var l=a[o],c=[],u=0,h=l.length;u<h;u++)c.push(Ic(l[u]));e.morphAttributes[o]=c}t.data.morphTargetsRelative&&(e.morphTargetsRelative=!0);var p=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==p){u=0;for(var d=p.length;u!==d;++u){var f=p[u];e.addGroup(f.start,f.count,f.materialIndex)}}var m=t.data.boundingSphere;if(void 0!==m){var _=new n.Vector3;void 0!==m.center&&_.fromArray(m.center),e.boundingSphere=new n.Sphere(_,m.radius)}return t.name&&(e.name=t.name),t.userData&&(e.userData=t.userData),e};var Oc=__webpack_require__(412);Oc.Material.prototype.dispose=function(){function t(t){null!=t&&t.dispose()}this.dispatchEvent({type:"dispose"}),t(this.map),t(this.bumpMap),t(this.normalMap),t(this.displacementMap),t(this.specularMap),t(this.emissiveMap),t(this.alphaMap),t(this.roughnessMap),t(this.metalnessMap),t(this.envMap)},Oc.Material.prototype.toJSON=function(t){void 0===t&&(t={textures:{},images:{},videos:{}});var e={};function r(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}if(e.uuid=this.uuid,e.type=this.type,e.name=this.name,e.toneMapped=this.toneMapped,e.depthFunc=this.depthFunc,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,this.color&&this.color.isColor&&(e.color=this.color.getHex()),void 0!==this.roughness&&(e.roughness=this.roughness),void 0!==this.metalness&&(e.metalness=this.metalness),this.specular&&this.specular.isColor&&(e.specular=this.specular.getHex()),void 0!==this.shininess&&(e.shininess=this.shininess),void 0!==this.clearcoat&&(e.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(e.clearcoatRoughness=this.clearcoatRoughness),void 0!==this.transmission&&(e.transmission=this.transmission),this.map&&this.map.isTexture&&(e.map=this.map.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(e.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(e.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap&&this.bumpMap.isTexture&&(e.bumpMap=this.bumpMap.toJSON(t).uuid,e.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(e.normalMap=this.normalMap.toJSON(t).uuid,e.normalMapType=this.normalMapType,e.normalScale=this.normalScale.toArray()),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(e.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,e.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(e.displacementMap=this.displacementMap.toJSON(t).uuid,e.displacementScale=this.displacementScale,e.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(e.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(e.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissive&&this.emissive.isColor&&(e.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(e.emissiveIntensity=this.emissiveIntensity),this.matcap&&this.matcap.isTexture&&(e.matcap=this.matcap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(e.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(e.aoMap=this.aoMap.toJSON(t).uuid),this.aoMapIntensity&&(e.aoMapIntensity=this.aoMapIntensity),this.specularMap&&this.specularMap.isTexture&&(e.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(e.envMap=this.envMap.toJSON(t).uuid,e.reflectivity=this.reflectivity,this.combine&&(e.combine=this.combine),this.envMapIntensity&&(e.envMapIntensity=this.envMapIntensity),this.refractionRatio&&(e.refractionRatio=this.refractionRatio)),this.gradientMap&&this.gradientMap.isTexture&&(e.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(e.size=this.size),void 0!==this.sizeAttenuation&&(e.sizeAttenuation=this.sizeAttenuation),void 0!==this.rotation&&(e.rotation=this.rotation),void 0!==this.linewidth&&(e.linewidth=this.linewidth),void 0!==this.dashSize&&(e.dashSize=this.dashSize),void 0!==this.gapSize&&(e.gapSize=this.gapSize),void 0!==this.scale&&(e.scale=this.scale),this.blending!==n.NormalBlending&&(e.blending=this.blending),this.side!==n.FrontSide&&(e.side=this.side),this.vertexColors!==n.NoColors&&(e.vertexColors=this.vertexColors),e.flatShading=this.flatShading,this.opacity<1&&(e.opacity=this.opacity),!0===this.transparent&&(e.transparent=this.transparent),!0===this.dithering&&(e.dithering=!0),this.alphaTest>0&&(e.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(e.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(e.wireframe=this.wireframe),this.wireframeLinewidth>1&&(e.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(e.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(e.wireframeLinejoin=this.wireframeLinejoin),e.skinning=this.skinning,e.morphTargets=this.morphTargets,void 0!==this.morphNormals&&(e.morphNormals=this.morphNormals),void 0===t){var i=r(t.textures),s=r(t.images),o=r(t.videos);i.length>0&&(e.textures=i),s.length>0&&(e.images=s),o.length>0&&(e.videos=o)}return e},__webpack_require__(412).Points.prototype.raycast=function(t,e){null===this.geometry.boundingBox&&this.geometry.computeBoundingBox();var r=new n.Box3;r.copy(this.geometry.boundingBox),r.applyMatrix4(this.matrixWorld),null!==t.ray.intersectBox(r,new n.Vector3)&&e.push({object:this})};var Fc,kc,Dc,Uc,zc=__webpack_require__(412);function jc(){}function Gc(){}function Hc(){this.vendor=-1,this.product=-1,this.connected=!1,this.gamepad=null,this.buttons=[];for(var t=navigator.getGamepads(),e=0;e<t.length;e++)if(null!==t[e]){this.setGamepad(t[e]);break}null===this.gamepad&&console.warn("nunuStudio: No gamepad found")}function Vc(){this.alpha=0,this.beta=0,this.gamma=0,this.orientation=0,this.events=new ji;var t=this;this.events.add(window,"orientationchange",(function(e){t.orientation=n.Math.degToRad(window.orientation)})),this.events.add(window,"deviceorientation",(function(e){t.alpha=n.Math.degToRad(e.alpha),t.beta=n.Math.degToRad(e.beta),t.gamma=n.Math.degToRad(e.gamma)})),this.events.create()}function Wc(t){this.size=new n.Vector2(2,2),this.halfSize=new n.Vector2(1,1),this.matrix=new n.Matrix4,this.cache={camera:{fov:0,style:""},objects:new WeakMap},this.domElement=void 0!==t?t:document.createElement("div"),this.domElement.style.overflow="hidden",this.domElement.style.pointerEvents="none",this.cameraElement=document.createElement("div"),this.cameraElement.style.WebkitTransformStyle="preserve-3d",this.cameraElement.style.transformStyle="preserve-3d",this.domElement.appendChild(this.cameraElement)}function qc(t){Ys.call(this,t)}function Xc(t){ec.call(this),this.format="url",this.encoding=qi.getFileExtension(t),this.data=t}function Yc(t,e,r){this.bufferGeometry=!1,this.direction=new n.Vector3(0,1,0),this.angle=void 0!==t?t:Math.PI,this.start=void 0!==e?e:0,this.end=void 0!==r?r:1}function Jc(){this.events=[]}function Zc(t,e){this.x=t||0,this.y=e||0}function Qc(t){void 0!==t?this.m=t:this.identity()}function Kc(){}function tu(){this.uuid=Kc.generate(),this.children=[],this.parent=null,this.level=0,this.position=new Zc(0,0),this.origin=new Zc(0,0),this.scale=new Zc(1,1),this.rotation=0,this.visible=!0,this.layer=0,this.matrix=new Qc,this.globalMatrix=new Qc,this.inverseGlobalMatrix=new Qc,this.masks=[],this.matrixAutoUpdate=!0,this.matrixNeedsUpdate=!0,this.draggable=!1,this.pointerEvents=!0,this.ignoreViewport=!1,this.saveContextState=!0,this.restoreContextState=!0,this.pointerInside=!1,this.beingDragged=!1,this.serializable=!0}function eu(){this.pressed=!1,this.justPressed=!1,this.justReleased=!1}function nu(t,e){this._keys=new Array(5),this._position=new Zc(0,0),this._positionUpdated=!1,this._delta=new Zc(0,0),this._wheel=0,this._wheelUpdated=!1,this._doubleClicked=new Array(5),this.keys=new Array(5),this.position=new Zc(0,0),this.delta=new Zc(0,0),this.wheel=0,this.doubleClicked=new Array(5),this.domElement=void 0!==t?t:window,this.canvas=null,void 0!==e&&this.setCanvas(e),this.events=new Jc;for(var n=0;n<5;n++)this._doubleClicked[n]=!1,this.doubleClicked[n]=!1,this._keys[n]=new eu,this.keys[n]=new eu;var r=this;if(void 0!==window.onmousewheel?this.events.add(this.domElement,"mousewheel",(function(t){r._wheel=t.deltaY,r._wheelUpdated=!0})):void 0!==window.addEventListener?this.events.add(this.domElement,"DOMMouseScroll",(function(t){r._wheel=30*t.detail,r._wheelUpdated=!0})):this.events.add(this.domElement,"wheel",(function(t){r._wheel=t.deltaY,r._wheelUpdated=!0})),void 0!==window.ontouchstart||navigator.msMaxTouchPoints>0){var i=new Zc(0,0);this.events.add(this.domElement,"touchstart",(function(t){var e=t.touches[0];r.updatePosition(e.clientX,e.clientY,0,0),r.updateKey(nu.LEFT,eu.DOWN),i.set(e.clientX,e.clientY)})),this.events.add(this.domElement,"touchend",(function(t){r.updateKey(nu.LEFT,eu.UP)})),this.events.add(this.domElement,"touchcancel",(function(t){r.updateKey(nu.LEFT,eu.UP)})),this.events.add(document.body,"touchmove",(function(t){var e=t.touches[0];r.updatePosition(e.clientX,e.clientY,e.clientX-i.x,e.clientY-i.y),i.set(e.clientX,e.clientY)}))}this.events.add(this.domElement,"mousemove",(function(t){r.updatePosition(t.clientX,t.clientY,t.movementX,t.movementY)})),this.events.add(this.domElement,"mousedown",(function(t){r.updateKey(t.which-1,eu.DOWN)})),this.events.add(this.domElement,"mouseup",(function(t){r.updateKey(t.which-1,eu.UP)})),this.events.add(this.domElement,"dragstart",(function(t){r.updateKey(t.which-1,eu.UP)})),this.events.add(this.domElement,"dblclick",(function(t){r._doubleClicked[t.which-1]=!0})),this.create()}function ru(t){this.uuid=Kc.generate(),this.canvas=t,this.position=new Zc(0,0),this.scale=1,this.rotation=0,this.matrix=new Qc,this.inverseMatrix=new Qc,this.matrixNeedsUpdate=!0,this.moveOnScale=!1,this.rotationPoint=null}function iu(t){this.viewport=t,this.dragButton=nu.RIGHT,this.allowScale=!0,this.moveOnScale=!1,this.allowRotation=!0,this.rotationPoint=null,this.rotationInitial=0}function su(t){this.callback=t,this.running=!1,this.id=-1}function ou(t,e){void 0===e&&(e={alpha:!0,imageSmoothingEnabled:!0,imageSmoothingQuality:"low",globalCompositeOperation:"source-over"}),this.canvas=t,this.container=null,this.context=this.canvas.getContext("2d",{alpha:e.alpha}),this.context.imageSmoothingEnabled=e.imageSmoothingEnabled,this.context.imageSmoothingQuality=e.imageSmoothingQuality,this.context.globalCompositeOperation=e.globalCompositeOperation,this.pointer=new nu(window,this.canvas),this.autoClear=!0}function au(t,e){this.min=void 0!==t?t:new Zc,this.max=void 0!==e?e:new Zc}function lu(){tu.call(this)}function cu(){lu.call(this),this.box=new au(new Zc(-50,-35),new Zc(50,35)),this.invert=!1}function uu(){this.cache=null,this.needsUpdate=!0}function hu(t){uu.call(this),this.color=t||"#000000"}function pu(){tu.call(this),this.box=new au(new Zc(-50,-50),new Zc(50,50)),this.strokeStyle=new hu("#000000"),this.lineWidth=1,this.fillStyle=new hu("#FFFFFF")}function du(){tu.call(this),this.radius=10,this.strokeStyle=new hu("#000000"),this.lineWidth=1,this.fillStyle=new hu("#FFFFFF")}function fu(){tu.call(this),this.from=new Zc,this.to=new Zc,this.dashPattern=[5,5],this.strokeStyle=new hu("#000000"),this.lineWidth=1}function mu(){tu.call(this),this.text="",this.font="16px Arial",this.strokeStyle=null,this.lineWidth=1,this.fillStyle=new hu("#000000"),this.textAlign="center",this.textBaseline="middle"}function _u(t){tu.call(this),this.box=new au,this.image=document.createElement("img"),void 0!==t&&this.setImage(t)}function gu(t){tu.call(this),this.parentElement=null,this.element=document.createElement(t||"div"),this.element.style.transformStyle="preserve-3d",this.element.style.position="absolute",this.element.style.top="0px",this.element.style.bottom="0px",this.element.style.transformOrigin="0px 0px",this.element.style.overflow="auto",this.element.style.pointerEvents="none",this.size=new Zc(100,100)}function yu(t){tu.call(this),this.box=new au,this.image=document.createElement("img"),this.repetition="repeat",void 0!==t&&this.setImage(t)}function vu(){mu.call(this),this.maxWidth=null,this.lineHeight=null}function bu(){fu.call(this),this.fromCp=new Zc,this.toCp=new Zc}function xu(){fu.call(this),this.controlPoint=new Zc}function wu(){pu.call(this),this.radius=5}function Su(){tu.call(this),this.box=new au(new Zc(-50,-35),new Zc(50,35)),this.strokeStyle=new hu("rgb(0, 153, 255)"),this.lineWidth=1,this.fillStyle=new hu("rgba(0, 153, 255, 0.3)"),this.min=0,this.max=10,this.data=[]}function Mu(t,e){this.offset=t,this.color=e}function Tu(){uu.call(this),this.colors=[]}function Eu(){Tu.call(this),this.start=new Zc(-100,0),this.end=new Zc(100,0)}function Au(){tu.call(this),this.value=50,this.min=0,this.max=100,this.radius=80,this.lineWidth=10,this.startAngle=Math.PI,this.endAngle=2*Math.PI,this.dial=!1,this.baseStyle=new hu("#e9ecf1"),this.barStyle=new Eu,this.barStyle.start.set(-100,0),this.barStyle.end.set(100,0),this.barStyle.addColorStop(0,"#e5ff50"),this.barStyle.addColorStop(.5,"#50ff67"),this.barStyle.addColorStop(1,"#32adff")}function $u(t){uu.call(this),this.source=t||document.createElement("img"),this.repetition="repeat",this.matrix=new Qc}function Cu(){Tu.call(this),this.start=new Zc(0,0),this.startRadius=10,this.end=new Zc(0,0),this.endRadius=50}function Bu(){tu.call(this)}function Lu(){bu.call(this),this.lineWidth=2,this.outputSocket=null,this.inputSocket=null}function Ru(t,e,n,r){du.call(this),this.draggable=!0,this.radius=6,this.layer=1,this.name=void 0!==r?r:"",this.category=void 0!==n?n:"",this.multiple=!0,this.direction=e,this.node=t,this.connectors=[],this.creatingConnection=!1,this.text=new mu,this.text.text=this.name,this.direction===Ru.INPUT?(this.text.position.x-=10,this.text.textAlign="right"):this.direction===Ru.OUTPUT&&(this.text.position.x+=10,this.text.textAlign="left"),this.add(this.text)}function Nu(){wu.call(this),this.draggable=!0,this.inputs=[],this.outputs=[]}function Pu(){}function Iu(){}function Ou(){n.Group.call(this),this.type="NodeScript",this.name="script",this.graph=new Bu}function Fu(t,e){this.uuid=n.Math.generateUUID(),this.data=t,this.callback=e}function ku(t,e){this.size=e,this.file=t,this.workers=[],this.next=0,this.createWorkers(),this.tasks={}}function Du(t,e){this.callback=t,this.time=e,this.running=!1,this.id=-1}function Uu(t){this.callback=t,this.running=!1,this.id=-1}function zu(){}function ju(){}zc.Skeleton.prototype.toJSON=function(){var t={};void 0===this.uuid&&(this.uuid=n.Math.generateUUID()),t.uuid=this.uuid,t.bones=[];for(var e=0;e<this.bones.length;e++)t.bones.push(this.bones[e].uuid);for(t.boneInverses=[],e=0;e<this.boneInverses.length;e++)t.boneInverses.push(this.boneInverses[e].toArray());return t},zc.Skeleton.fromJSON=function(t,e){for(var r=[],i=[],s=0;s<t.bones.length;s++){var o=e.getObjectByProperty("uuid",t.bones[s]);void 0===o&&(console.warn("Skeleton.fromJSON: Not found Bone with uuid "+t.bones[s]),o=new n.Bone),r.push(o),i.push((new n.Matrix4).fromArray(t.boneInverses[s]))}var a=new zc.Skeleton(r,i);return a.uuid=t.uuid,a},__webpack_require__(819),__webpack_require__(412).Texture.prototype.toJSON=function(t){if(void 0!==t.textures[this.uuid])return t.textures[this.uuid];var e={metadata:{version:VERSION,type:"Texture"},uuid:this.uuid,name:this.name,category:this.category,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return t.textures[this.uuid]=e,e},jc.NAME="nunuStudio",jc.NWJS=200,jc.BROWSER=201,jc.CORDOVA=202,jc.copyNamespace=function(t,e){for(var n in void 0===e&&(e=window),t)n in e||(e[n]=t[n])},jc.getQueryParameters=function(){for(var t=location.search.substring(1).split("&"),e={},n=0;n<t.length;n++){var r=t[n].split("=");if(r.length>1){var i=unescape(r[0]).replace(new RegExp('"',"g"),""),s=unescape(r[1]).replace(new RegExp('"',"g"),"");e[i]=s}}return e},jc.createWorker=function(t,e){var n=new Blob([t],{type:"application/javascript"}),r=new Worker(URL.createObjectURL(n));return void 0!==e&&(r.onmessage=e),r},jc.webAudioAvailable=function(){return void 0!==window.AudioContext||void 0!==window.webkitAudioContext},jc.webGLAvailable=function(){try{var t=document.createElement("canvas");return(t.getContext("webgl")||t.getContext("experimental-webgl")).getSupportedExtensions(),!0}catch(t){}return!1},jc.getPlatform=function(){return void 0!==window.nw?jc.NWJS:void 0!==window.cordova?jc.CORDOVA:jc.BROWSER},jc.runningOnDesktop=function(){return void 0!==window.nw},jc.openWebpage=function(t){jc.runningOnDesktop()?window.require("nw.gui").Shell.openExternal(t):window.open(t)},jc.isFullscreen=function(){return!0===document.webkitIsFullScreen||!0===document.mozFullScreen||!0===document.webkitIsFullScreen||!0===document.webkitIsFullScreen||!0===document.fullscreen||!1},jc.setFullscreen=function(t,e){var n=jc.isFullscreen();void 0===t&&(t=!n),!0===t?(void 0===e&&(e=document.body),!1===n&&(e.requestFullscreen=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen,void 0!==e.requestFullscreen&&e.requestFullscreen())):!0===n&&(document.exitFullscreen=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen,void 0!==document.exitFullscreen&&document.exitFullscreen())},Gc.ARROW_LEFT=37,Gc.ARROW_UP=38,Gc.ARROW_RIGHT=39,Gc.ARROW_DOWN=40,Gc.ENTER=13,Gc.BACK=10009,Gc.VOLUME_UP=447,Gc.VOLUME_DOWN=448,Gc.VOLUME_MUTE=449,Gc.CHANNEL_UP=427,Gc.CHANNEL_DOWN=428,Gc.F0_RED=403,Gc.F1_GREEN=404,Gc.F2_YELLOW=405,Gc.F3_BLUE=406,Gc.NUM_0=48,Gc.NUM_1=49,Gc.NUM_2=50,Gc.NUM_3=51,Gc.NUM_4=52,Gc.NUM_5=53,Gc.NUM_6=54,Gc.NUM_7=55,Gc.NUM_8=56,Gc.NUM_9=57,Gc.MINUS=189,Gc.E_MANUAL=10146,Gc.PREVIOUS_CHANNEL=10190,Gc.PICTURE_SIZE=10140,Gc.SOCCER=10228,Gc.TELETEXT=10200,Gc.SEARCH=10225,Gc.GUIDE=458,Gc.SOURCE=10072,Gc.EXTRA=10253,Gc.MTS=10195,Gc.MEDIA_PLAY_PAUSE=10252,Gc.MENU=18,Gc.MEDIA_REWIND=412,Gc.TOOLS=10135,Gc.MEDIA_FAST_FORWARD=417,Gc.INFO=457,Gc.MEDIA_PLAY=415,Gc.EXIT=10182,Gc.MEDIA_PAUSE=19,Gc.MEDIA_STOP=413,Gc.CAPTION=10221,Gc.MEDIA_RECORD=416,Gc.CHANNEL_LIST=10073,Gc.MEDIA_TRACK_PREVIOUS=10232,Gc.MEDIA_TRACK_NEXT=10233,Gc.MEDIA_3D=10199,Hc.prototype=Hc,Hc.prototype.constructor=Hc,Hc.prototype.setGamepad=function(t){if(null!=t){this.index=t.index,this.gamepad=t,this.buttons=[];for(var e=0;e<t.buttons.length;e++)this.buttons.push(new Ui);this.setProductVendor(t),this.connected=!0}else console.warn("nunuStudio: No gamepad found"),this.disconnect()},Hc.prototype.disconnect=function(){this.vendor=-1,this.product=-1,this.connected=!1,this.gamepad=null,this.buttons=[]},Hc.prototype.setProductVendor=function(t){try{var e=t.id.split(":");return this.vendor=e[1].split(" ")[1],void(this.product=e[2].replace(" ","").replace(")",""))}catch(t){}try{return e=t.id.split("-"),this.vendor=e[0],void(this.product=e[1])}catch(t){}},Hc.prototype.update=function(t){if(this.gamepad=navigator.getGamepads()[this.index],void 0!==this.gamepad)for(var e=0;e<this.buttons.length;e++)this.buttons[e].update(this.gamepad.buttons[e].pressed?Ui.DOWN:Ui.UP)},Hc.prototype.getAnalogueButton=function(t){return t>this.buttons.length||t<0?0:this.gamepad.buttons[t].value},Hc.prototype.getAxis=function(t){return t>this.gamepad.axes.length||t<0?0:this.gamepad.axes[t]},Hc.prototype.buttonExists=function(t){return t>=0&&t<this.buttons.length},Hc.prototype.buttonPressed=function(t){return!!this.buttons[t]&&this.buttons[t].pressed},Hc.prototype.buttonJustPressed=function(t){return!!this.buttons[t]&&this.buttons[t].justPressed},Hc.prototype.buttonJustReleased=function(t){return!!this.buttons[t]&&this.buttons[t].justReleased},Hc.LEFT=14,Hc.RIGHT=15,Hc.DOWN=13,Hc.UP=12,Hc.SELECT=8,Hc.START=9,Hc.HOME=16,Hc.LEFT_TRIGGER_A=4,Hc.LEFT_TRIGGER_B=6,Hc.RIGHT_TRIGGER_A=5,Hc.RIGHT_TRIGGER_B=7,Hc.L1=4,Hc.L2=6,Hc.L3=6,Hc.R1=5,Hc.R2=7,Hc.R3=11,Hc.A=0,Hc.B=1,Hc.C=2,Hc.D=3,Hc.X=2,Hc.Y=3,Hc.LEFT_ANALOGUE_BUT=10,Hc.LEFT_ANALOGUE_HOR=0,Hc.LEFT_ANALOGUE_VERT=1,Hc.RIGHT_ANALOGUE_BUT=11,Hc.RIGHT_ANALOGUE_HOR=2,Hc.RIGHT_ANALOGUE_VERT=3,Vc.prototype.setObjectQuaternion=(Fc=new n.Euler,kc=new n.Quaternion,Dc=new n.Vector3(0,0,1),Uc=new n.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(t){Fc.set(this.beta,this.alpha,-this.gamma,"YXZ"),t.quaternion.setFromEuler(Fc),t.quaternion.multiply(Uc),t.quaternion.multiply(kc.setFromAxisAngle(Dc,-this.orientation))}),Vc.prototype.dispose=function(){this.events.destroy()},Wc.prototype.getSize=function(){return{width:this.size.x,height:this.size.y}},Wc.prototype.setSize=function(t,e){this.size.set(t,e),this.halfSize.set(t/2,e/2),this.domElement.style.width=t+"px",this.domElement.style.height=e+"px",this.cameraElement.style.width=t+"px",this.cameraElement.style.height=e+"px"},Wc.prototype.render=function(t,e){function n(t){var e=t.elements;return"matrix3d("+e[0]+","+-e[1]+","+e[2]+","+e[3]+","+e[4]+","+-e[5]+","+e[6]+","+e[7]+","+e[8]+","+-e[9]+","+e[10]+","+e[11]+","+e[12]+","+-e[13]+","+e[14]+","+e[15]+")"}function r(t,e){var n=t.elements;return"translate(-50%,-50%)matrix3d("+n[0]+","+n[1]+","+n[2]+","+n[3]+","+-n[4]+","+-n[5]+","+-n[6]+","+-n[7]+","+n[8]+","+n[9]+","+n[10]+","+n[11]+","+n[12]+","+n[13]+","+n[14]+","+n[15]+")"}var i,s=this,o=e.projectionMatrix.elements[5]*this.halfSize.y;this.cache.camera.fov!==o&&(e.isPerspectiveCamera&&(this.domElement.style.WebkitPerspective=o+"px",this.domElement.style.perspective=o+"px"),this.cache.camera.fov=o),t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld();var a=(i=e.isOrthographicCamera?"scale("+o+")translate("+-(e.right+e.left)/2+"px,"+(e.top+e.bottom)/2+"px)"+n(e.matrixWorldInverse):"translateZ("+o+"px)"+n(e.matrixWorldInverse))+"translate("+this.halfSize.x+"px,"+this.halfSize.y+"px)";this.cache.camera.style!==a&&(this.cameraElement.style.WebkitTransform=a,this.cameraElement.style.transform=a,this.cache.camera.style=a),function t(e,n,i){if(!0===e.isCSS3DObject){var o;!0===e.isCSS3DSprite?(matrix.copy(n.matrixWorldInverse),matrix.transpose(),matrix.copyPosition(e.matrixWorld),matrix.scale(e.scale),matrix.elements[3]=0,matrix.elements[7]=0,matrix.elements[11]=0,matrix.elements[15]=1,o=r(matrix)):o=r(e.matrixWorld);var a=e.element,l=s.cache.objects.get(e);void 0!==l&&l.style===o||(a.style.WebkitTransform=o,a.style.transform=o,s.cache.objects.set(e,{style:o})),a.parentNode!==s.cameraElement&&s.cameraElement.appendChild(a)}for(var c=0,u=e.children.length;c<u;c++)t(e.children[c],n,i)}(t,e,i)},qc.prototype=Object.create(Ys.prototype),qc.prototype.constructor=qc,qc.prototype.isCSS3DSprite=!0,Xc.prototype=Object.create(ec.prototype),Yc.prototype.modify=function(t){t instanceof n.BufferGeometry?((t=new n.Geometry).fromBufferGeometry(Editor.selection[0].geometry),t.mergeVertices()):t=t.clone();for(var e=new n.Quaternion,r=0;r<t.vertices.length;r++){var i=t.vertices[r].y;if(i>=this.start&&i<=this.end){var s=(i-this.start)/(this.end-this.start);e.setFromAxisAngle(this.direction,this.angle*s),t.vertices[r].applyQuaternion(e)}else i>this.end&&(e.setFromAxisAngle(this.direction,this.angle),t.vertices[r].applyQuaternion(e))}if(t.computeVertexNormals(),t.verticesNeedUpdate=!0,this.bufferGeometry){var o=new n.BufferGeometry;return o.fromGeometry(t),o}return t},Jc.prototype.add=function(t,e,n){this.events.push([t,e,n,!1])},Jc.prototype.clear=function(){this.destroy(),this.events=[]},Jc.prototype.create=function(){for(var t=0;t<this.events.length;t++){var e=this.events[t];e[0].addEventListener(e[1],e[2]),e[3]=!0}},Jc.prototype.destroy=function(){for(var t=0;t<this.events.length;t++){var e=this.events[t];e[0].removeEventListener(e[1],e[2]),e[3]=!1}},Zc.prototype.set=function(t,e){this.x=t,this.y=e},Zc.prototype.setScalar=function(t){this.x=t,this.y=t},Zc.prototype.clone=function(){return new Zc(this.x,this.y)},Zc.prototype.copy=function(t){this.x=t.x,this.y=t.y},Zc.prototype.add=function(t){this.x+=t.x,this.y+=t.y},Zc.prototype.addScalar=function(t){this.x+=t,this.y+=t},Zc.prototype.addVectors=function(t,e){this.x=t.x+e.x,this.y=t.y+e.y},Zc.prototype.addScaledVector=function(t,e){this.x+=t.x*e,this.y+=t.y*e},Zc.prototype.sub=function(t){this.x-=t.x,this.y-=t.y},Zc.prototype.subScalar=function(t){this.x-=t,this.y-=t},Zc.prototype.subVectors=function(t,e){this.x=t.x-e.x,this.y=t.y-e.y},Zc.prototype.multiply=function(t){this.x*=t.x,this.y*=t.y},Zc.prototype.multiplyScalar=function(t){this.x*=t,this.y*=t},Zc.prototype.divide=function(t){this.x/=t.x,this.y/=t.y},Zc.prototype.divideScalar=function(t){return this.multiplyScalar(1/t)},Zc.prototype.min=function(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y)},Zc.prototype.max=function(t){this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y)},Zc.prototype.clamp=function(t,e){this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y))},Zc.prototype.clampScalar=function(t,e){this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y))},Zc.prototype.clampLength=function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},Zc.prototype.floor=function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y)},Zc.prototype.ceil=function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y)},Zc.prototype.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y)},Zc.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},Zc.prototype.dot=function(t){return this.x*t.x+this.y*t.y},Zc.prototype.cross=function(t){return this.x*t.y-this.y*t.x},Zc.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},Zc.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Zc.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)},Zc.prototype.normalize=function(){return this.divideScalar(this.length()||1)},Zc.prototype.angle=function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},Zc.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},Zc.prototype.distanceToSquared=function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},Zc.prototype.manhattanDistanceTo=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},Zc.prototype.setLength=function(t){return this.normalize().multiplyScalar(t)},Zc.prototype.lerp=function(t,e){this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e},Zc.prototype.lerpVectors=function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},Zc.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},Zc.prototype.fromArray=function(t){this.set(t[0],t[1])},Zc.prototype.toArray=function(){return[this.x,this.y]},Zc.prototype.rotateAround=function(t,e){var n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y},Qc.prototype.copy=function(t){this.m=t.m.slice(0)},Qc.prototype.clone=function(){return new Qc(this.m.slice(0))},Qc.prototype.identity=function(){this.m=[1,0,0,1,0,0]},Qc.prototype.multiply=function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],n=this.m[1]*t.m[0]+this.m[3]*t.m[1],r=this.m[0]*t.m[2]+this.m[2]*t.m[3],i=this.m[1]*t.m[2]+this.m[3]*t.m[3],s=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],o=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m=[e,n,r,i,s,o]},Qc.prototype.premultiply=function(t){var e=t.m[0]*this.m[0]+t.m[2]*this.m[1],n=t.m[1]*this.m[0]+t.m[3]*this.m[1],r=t.m[0]*this.m[2]+t.m[2]*this.m[3],i=t.m[1]*this.m[2]+t.m[3]*this.m[3],s=t.m[0]*this.m[4]+t.m[2]*this.m[5]+t.m[4],o=t.m[1]*this.m[4]+t.m[3]*this.m[5]+t.m[5];this.m=[e,n,r,i,s,o]},Qc.prototype.compose=function(t,e,n,r,i,s,o){if(this.m=[1,0,0,1,t,e],0!==o){var a=Math.cos(o),l=Math.sin(o);this.multiply(new Qc([a,l,-l,a,0,0]))}1===n&&1===r||this.scale(n,r),0===i&&0===s||this.multiply(new Qc([1,0,0,1,-i,-s]))},Qc.prototype.translate=function(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e},Qc.prototype.rotate=function(t){var e=Math.cos(t),n=Math.sin(t),r=this.m[0]*e+this.m[2]*n,i=this.m[1]*e+this.m[3]*n,s=this.m[0]*-n+this.m[2]*e,o=this.m[1]*-n+this.m[3]*e;this.m[0]=r,this.m[1]=i,this.m[2]=s,this.m[3]=o},Qc.prototype.scale=function(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e},Qc.prototype.setPosition=function(t,e){this.m[4]=t,this.m[5]=e},Qc.prototype.getScale=function(){return new Zc(this.m[0],this.m[3])},Qc.prototype.getPosition=function(){return new Zc(this.m[4],this.m[5])},Qc.prototype.skew=function(t,e){this.multiply(new Qc([1,Math.tan(e),Math.tan(t),1,0,0]))},Qc.prototype.determinant=function(){return 1/(this.m[0]*this.m[3]-this.m[1]*this.m[2])},Qc.prototype.getInverse=function(){var t=this.determinant();return new Qc([this.m[3]*t,-this.m[1]*t,-this.m[2]*t,this.m[0]*t,t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),t*(this.m[1]*this.m[4]-this.m[0]*this.m[5])])},Qc.prototype.transformPoint=function(t){return new Zc(t.x*this.m[0]+t.y*this.m[2]+this.m[4],t.x*this.m[1]+t.y*this.m[3]+this.m[5])},Qc.prototype.setContextTransform=function(t){t.setTransform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},Qc.prototype.tranformContext=function(t){t.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},Qc.prototype.cssTransform=function(){return"matrix("+this.m[0]+","+this.m[1]+","+this.m[2]+","+this.m[3]+","+this.m[4]+","+this.m[5]+")"},Kc.generate=function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);return function(){var e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&n]+t[n>>8&255]+"-"+t[n>>16&15|64]+t[n>>24&255]+"-"+t[63&r|128]+t[r>>8&255]+"-"+t[r>>16&255]+t[r>>24&255]+t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]).toUpperCase()}}(),tu.prototype.constructor=tu,tu.prototype.type="Object2D",tu.types=new Map([[tu.prototype.type,tu]]),tu.register=function(t,e){tu.types.set(e,t)},tu.prototype.getWorldPointIntersections=function(t,e){void 0===e&&(e=[]);var n=this.inverseGlobalMatrix.transformPoint(t);this.isInside(n)&&e.push(this);for(var r=0;r<this.children.length;r++)this.children[r].getWorldPointIntersections(t,e);return e},tu.prototype.isWorldPointInside=function(t,e){var n=this.inverseGlobalMatrix.transformPoint(t);if(this.isInside(n))return!0;if(e)for(var r=0;r<this.children.length;r++)if(this.children[r].isWorldPointInside(t,!0))return!0;return!1},tu.prototype.destroy=function(){null!==this.parent&&this.parent.remove(this)},tu.prototype.traverse=function(t){t(this);for(var e=0;e<this.children.length;e++)this.children[e].traverse(t)},tu.prototype.getChildByUUID=function(t){var e=null;return this.traverse((function(n){n.uuid===t&&(e=n)})),e},tu.prototype.add=function(t){t.parent=this,t.level=this.level+1,t.traverse((function(t){null!==t.onAdd&&t.onAdd(this)})),this.children.push(t)},tu.prototype.remove=function(t){var e=this.children.indexOf(t);if(-1!==e){var n=this.children[e];n.parent=null,n.level=0,n.traverse((function(t){null!==t.onRemove&&t.onRemove(this)})),this.children.splice(e,1)}},tu.prototype.isInside=function(t){return!1},tu.prototype.updateMatrix=function(t){(this.matrixAutoUpdate||this.matrixNeedsUpdate)&&(this.matrix.compose(this.position.x,this.position.y,this.scale.x,this.scale.y,this.origin.x,this.origin.y,this.rotation),this.globalMatrix.copy(this.matrix),null!==this.parent&&this.globalMatrix.premultiply(this.parent.globalMatrix),this.inverseGlobalMatrix=this.globalMatrix.getInverse(),this.matrixNeedsUpdate=!1)},tu.prototype.transform=function(t,e,n,r){this.globalMatrix.tranformContext(t)},tu.prototype.style=null,tu.prototype.draw=null,tu.prototype.onPointerDrag=function(t,e,n,r){this.position.add(n)},tu.prototype.onPointerDragStart=null,tu.prototype.onPointerDragEnd=null,tu.prototype.onAdd=null,tu.prototype.onRemove=null,tu.prototype.onUpdate=null,tu.prototype.onPointerEnter=null,tu.prototype.onPointerLeave=null,tu.prototype.onPointerOver=null,tu.prototype.onButtonPressed=null,tu.prototype.onDoubleClick=null,tu.prototype.onButtonDown=null,tu.prototype.onButtonUp=null,tu.prototype.serialize=function(t){var e={uuid:this.uuid,type:this.type,position:this.position.toArray(),origin:this.origin.toArray(),scale:this.scale.toArray(),rotation:this.rotation,visible:this.visible,layer:this.layer,matrix:this.matrix.m,globalMatrix:this.globalMatrix.m,inverseGlobalMatrix:this.inverseGlobalMatrix.m,matrixAutoUpdate:this.matrixAutoUpdate,draggable:this.draggable,pointerEvents:this.pointerEvents,ignoreViewport:this.ignoreViewport,saveContextState:this.saveContextState,restoreContextState:this.restoreContextState,children:[],masks:[]};if(!1!==t)for(var n=0;n<this.children.length;n++)this.children[n].serializable&&e.children.push(this.children[n].serialize());for(n=0;n<this.masks.length;n++)e.masks.push(this.masks[n].uuid);return e},tu.prototype.parse=function(t,e){this.uuid=t.uuid,this.position.fromArray(t.position),this.origin.fromArray(t.origin),this.scale.fromArray(t.scale),this.rotation=t.rotation,this.visible=t.visible,this.layer=t.layer,this.matrix=new Qc(t.matrix),this.globalMatrix=new Qc(t.globalMatrix),this.inverseGlobalMatrix=new Qc(t.inverseGlobalMatrix),this.matrixAutoUpdate=t.matrixAutoUpdate,this.draggable=t.draggable,this.pointerEvents=t.pointerEvents,this.ignoreViewport=t.ignoreViewport,this.saveContextState=t.saveContextState,this.restoreContextState=t.restoreContextState;for(var n=0;n<this.masks.length;n++)t.masks.push(e.getChildByUUID(t.masks[n]))},tu.parse=function(t){for(var e=[],n=function t(n){if(!tu.types.has(n.type))throw new Error("Object type "+n.type+" unknown. Cannot parse data.");var r=new(tu.types.get(n.type));r.uuid=n.uuid,e.push({object:r,data:n});for(var i=0;i<n.children.length;i++)r.add(t(n.children[i]));return r}(t),r=0;r<e.length;r++)e[r].object.parse(e[r].data,n);return n},eu.DOWN=-1,eu.UP=1,eu.RESET=0,eu.prototype.constructor=eu,eu.prototype.update=function(t){this.justPressed=!1,this.justReleased=!1,t===eu.DOWN?(!1===this.pressed&&(this.justPressed=!0),this.pressed=!0):t===eu.UP?(this.pressed&&(this.justReleased=!0),this.pressed=!1):t===eu.RESET&&(this.justReleased=!1,this.justPressed=!1)},eu.prototype.set=function(t,e,n){this.justPressed=t,this.pressed=e,this.justReleased=n},eu.prototype.reset=function(){this.justPressed=!1,this.pressed=!1,this.justReleased=!1},nu.prototype=nu,nu.prototype.constructor=nu,nu.LEFT=0,nu.MIDDLE=1,nu.RIGHT=2,nu.BACK=3,nu.FORWARD=4,nu.setCanvas=function(t){this.canvas=t,t.pointerInside=!1,t.addEventListener("mouseenter",(function(){this.pointerInside=!0})),t.addEventListener("mouseleave",(function(){this.pointerInside=!1}))},nu.insideCanvas=function(){return null!==this.canvas&&this.canvas.pointerInside},nu.buttonPressed=function(t){return this.keys[t].pressed},nu.buttonDoubleClicked=function(t){return this.doubleClicked[t]},nu.buttonJustPressed=function(t){return this.keys[t].justPressed},nu.buttonJustReleased=function(t){return this.keys[t].justReleased},nu.updatePosition=function(t,e,n,r){if(null!==this.canvas){var i=this.canvas.getBoundingClientRect();t-=i.left,e-=i.top}this._position.set(t,e),this._delta.x+=n,this._delta.y+=r,this._positionUpdated=!0},nu.updateKey=function(t,e){t>-1&&this._keys[t].update(e)},nu.update=function(){for(var t=0;t<5;t++)this._keys[t].justPressed&&this.keys[t].justPressed&&(this._keys[t].justPressed=!1),this._keys[t].justReleased&&this.keys[t].justReleased&&(this._keys[t].justReleased=!1),this.keys[t].set(this._keys[t].justPressed,this._keys[t].pressed,this._keys[t].justReleased),!0===this._doubleClicked[t]?(this.doubleClicked[t]=!0,this._doubleClicked[t]=!1):this.doubleClicked[t]=!1;this._wheelUpdated?(this.wheel=this._wheel,this._wheelUpdated=!1):this.wheel=0,this._positionUpdated?(this.delta.copy(this._delta),this.position.copy(this._position),this._delta.set(0,0),this._positionUpdated=!1):(this.delta.x=0,this.delta.y=0)},nu.create=function(){this.events.create()},nu.dispose=function(){this.events.destroy()},ru.prototype.updateMatrix=function(){if(this.matrixNeedsUpdate){if(this.matrix.m=[1,0,0,1,this.position.x,this.position.y],0!==this.rotation){var t=Math.cos(this.rotation),e=Math.sin(this.rotation);this.matrix.multiply(new Qc([t,e,-e,t,0,0]))}1!==this.scale&&this.matrix.scale(this.scale,this.scale),this.inverseMatrix=this.matrix.getInverse(),this.matrixNeedsUpdate=!1}},ru.prototype.centerObject=function(t,e){var n=t.globalMatrix.transformPoint(new Zc);n.multiplyScalar(-this.scale),n.x+=e.width/2,n.y+=e.height/2,this.position.copy(n),this.matrixNeedsUpdate=!0},iu.prototype.update=function(t){if(this.allowScale&&0!==t.wheel){var e=.001*t.wheel*this.viewport.scale;if(this.viewport.scale-=e,this.viewport.matrixNeedsUpdate=!0,this.moveOnScale&&null!==t.canvas){this.viewport.updateMatrix();var n=this.viewport.inverseMatrix.transformPoint(t.position),r=new Zc(t.canvas.width/2,t.canvas.height/2);r=this.viewport.inverseMatrix.transformPoint(r);var i=n.clone();i.sub(r),i.multiplyScalar(.1),this.viewport.position.sub(i),this.viewport.matrixNeedsUpdate=!0}}if(this.allowRotation&&t.buttonPressed(nu.RIGHT)&&t.buttonPressed(nu.LEFT))if(null===this.rotationPoint)this.rotationPoint=t.position.clone(),this.rotationInitial=this.viewport.rotation;else{var s=t.position.clone();s.sub(this.rotationPoint),this.viewport.rotation=this.rotationInitial+s.angle(),this.viewport.matrixNeedsUpdate=!0}else this.rotationPoint=null,t.buttonPressed(this.dragButton)&&(this.viewport.position.x+=t.delta.x,this.viewport.position.y+=t.delta.y,this.viewport.matrixNeedsUpdate=!0)},su.prototype.start=function(){if(!this.running){this.running=!0;var t=this;!function e(){t.callback(),t.running&&(t.id=requestAnimationFrame(e))}()}},su.prototype.stop=function(){this.running=!1,cancelAnimationFrame(this.id)},ou.prototype.getDomContainer=function(){return null!==this.container?this.container:this.canvas.parentElement},ou.prototype.createRenderLoop=function(t,e,n){var r=this,i=new iu(e),s=new su((function(){void 0!==n&&n(),i.update(r.pointer),r.update(t,e)}));return s.start(),s},ou.prototype.dispose=function(t,e,n){this.pointer.dispose()},ou.prototype.update=function(t,e){var n=[];t.traverse((function(t){t.visible&&n.push(t)})),n.sort((function(t,e){return e.layer===t.layer?e.level-t.level:e.layer-t.layer}));var r=this.pointer;r.update(),e.updateMatrix();for(var i=r.position.clone(),s=e.inverseMatrix.transformPoint(i),o=0;o<n.length;o++)if((l=n[o]).pointerEvents){var a=l.inverseGlobalMatrix.transformPoint(l.ignoreViewport?i:s);if(l.isInside(a)){if(l.pointerInside||null===l.onPointerEnter||l.onPointerEnter(r,e),null!==l.onPointerOver&&l.onPointerOver(r,e),r.buttonDoubleClicked(nu.LEFT)&&null!==l.onDoubleClick&&l.onDoubleClick(r,e),r.buttonPressed(nu.LEFT)&&null!==l.onButtonPressed&&l.onButtonPressed(r,e),r.buttonJustReleased(nu.LEFT)&&null!==l.onButtonUp&&l.onButtonUp(r,e),r.buttonJustPressed(nu.LEFT)&&(null!==l.onButtonDown&&l.onButtonDown(r,e),l.draggable)){l.beingDragged=!0,null!==l.onPointerDragStart&&l.onPointerDragStart(r,e);break}l.pointerInside=!0}else l.pointerInside&&(null!==l.onPointerLeave&&l.onPointerLeave(r,e),l.pointerInside=!1);r.buttonJustReleased(nu.LEFT)&&l.draggable&&(!0===l.beingDragged&&null!==l.onPointerDragEnd&&l.onPointerDragEnd(r,e),l.beingDragged=!1)}for(o=0;o<n.length;o++){var l;if((l=n[o]).beingDragged&&null!==l.onPointerDrag){var c=r.position.clone();c.sub(r.delta);var u=e.inverseMatrix.transformPoint(r.position),h=e.inverseMatrix.transformPoint(c),p=u.clone();p.sub(h),l.onPointerDrag(r,e,p,u)}null!==l.onUpdate&&l.onUpdate()}for(t.traverse((function(t){t.updateMatrix()})),this.context.setTransform(1,0,0,1,0,0),this.autoClear&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),o=n.length-1;o>=0;o--)if(!n[o].isMask){n[o].saveContextState&&this.context.save();for(var d=n[o].masks,f=0;f<d.length;f++)d[f].ignoreViewport||e.matrix.setContextTransform(this.context),d[f].transform(this.context,e,this.canvas,this),d[f].clip(this.context,e,this.canvas);n[o].ignoreViewport?d.length>0&&this.context.setTransform(1,0,0,1,0,0):e.matrix.setContextTransform(this.context),n[o].transform(this.context,e,this.canvas,this),null!==n[o].style&&n[o].style(this.context,e,this.canvas),null!==n[o].draw&&n[o].draw(this.context,e,this.canvas),n[o].restoreContextState&&this.context.restore()}},au.prototype.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},au.prototype.setFromPoints=function(t){this.min=new Zc(1/0,1/0),this.max=new Zc(-1/0,-1/0);for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},au.prototype.setFromCenterAndSize=function(t,e){var n=(new Zc).copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},au.prototype.clone=function(){var t=new au;return t.copy(this),t},au.prototype.copy=function(t){this.min.copy(t.min),this.max.copy(t.max)},au.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y},au.prototype.getCenter=function(t){return void 0===t&&(t=new Zc),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5),t},au.prototype.getSize=function(t){return void 0===t&&(t=new Zc),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min),t},au.prototype.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},au.prototype.expandByVector=function(t){this.min.sub(t),this.max.add(t)},au.prototype.expandByScalar=function(t){this.min.addScalar(-t),this.max.addScalar(t)},au.prototype.containsPoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},au.prototype.containsBox=function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},au.prototype.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},au.prototype.distanceToPoint=function(t){return(new Zc).copy(t).clamp(this.min,this.max).sub(t).length()},au.prototype.intersect=function(t){this.min.max(t.min),this.max.min(t.max)},au.prototype.union=function(t){this.min.min(t.min),this.max.max(t.max)},au.prototype.translate=function(t){this.min.add(t),this.max.add(t)},au.prototype.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},au.prototype.toArray=function(){return[this.min.x,this.min.y,this.max.x,this.max.y]},au.prototype.fromArray=function(t){this.min.set(t[0],t[1]),this.max.set(t[2],t[3])},lu.prototype=Object.create(tu.prototype),lu.prototype.constructor=lu,lu.prototype.type="Mask",tu.register(lu,"Mask"),lu.prototype.isMask=!0,lu.prototype.clip=function(t,e,n){},cu.prototype=Object.create(lu.prototype),cu.prototype.constructor=cu,cu.prototype.type="BoxMask",tu.register(cu,"BoxMask"),cu.prototype.isInside=function(t){return this.box.containsPoint(t)},cu.prototype.clip=function(t,e,n){t.beginPath();var r=this.box.max.x-this.box.min.x;if(this.invert)t.rect(this.box.min.x-1e4,-5e3,1e4,1e4),t.rect(this.box.max.x,-5e3,1e4,1e4),t.rect(this.box.min.x,this.box.min.y-1e4,r,1e4),t.rect(this.box.min.x,this.box.max.y,r,1e4);else{var i=this.box.max.y-this.box.min.y;t.fillRect(this.box.min.x,this.box.min.y,r,i)}t.clip()},uu.prototype.get=function(t){},uu.prototype.serialize=function(){},uu.prototype.parse=function(t){},uu.types=new Map([]),uu.register=function(t,e){uu.types.set(e,t)},uu.parse=function(t){var e=new(uu.types.get(t.type));return e.parse(t),e},hu.prototype=Object.create(uu.prototype),uu.register(hu,"Color"),hu.prototype.get=function(t){return this.color},hu.prototype.serialize=function(){return{type:"Color",color:this.color}},hu.prototype.parse=function(t){this.color=t.color},pu.prototype=Object.create(tu.prototype),pu.prototype.constructor=pu,pu.prototype.type="Box",tu.register(pu,"Box"),pu.prototype.onPointerEnter=function(t,e){this.fillStyle=new hu("#CCCCCC")},pu.prototype.onPointerLeave=function(t,e){this.fillStyle=new hu("#FFFFFF")},pu.prototype.isInside=function(t){return this.box.containsPoint(t)},pu.prototype.draw=function(t,e,n){var r=this.box.max.x-this.box.min.x,i=this.box.max.y-this.box.min.y;null!==this.fillStyle&&(t.fillStyle=this.fillStyle.get(t),t.fillRect(this.box.min.x,this.box.min.y,r,i)),null!==this.strokeStyle&&(t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeStyle.get(t),t.strokeRect(this.box.min.x,this.box.min.y,r,i))},pu.prototype.serialize=function(t){var e=tu.prototype.serialize.call(this,t);return e.box=this.box.toArray(),e.strokeStyle=null!==this.strokeStyle?this.strokeStyle.serialize():null,e.lineWidth=this.lineWidth,e.fillStyle=null!==this.fillStyle?this.fillStyle.serialize():null,e},pu.prototype.parse=function(t,e){tu.prototype.parse.call(this,t,e),this.box.fromArray(t.box),this.strokeStyle=null!==t.strokeStyle?uu.parse(t.strokeStyle):null,this.lineWidth=t.lineWidth,this.fillStyle=null!==t.fillStyle?uu.parse(t.fillStyle):null},du.prototype=Object.create(tu.prototype),du.prototype.constructor=du,du.prototype.type="Circle",tu.register(du,"Circle"),du.prototype.isInside=function(t){return t.length()<=this.radius},du.prototype.onPointerEnter=function(t,e){this.fillStyle=new hu("#CCCCCC")},du.prototype.onPointerLeave=function(t,e){this.fillStyle=new hu("#FFFFFF")},du.prototype.draw=function(t,e,n){t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI),null!==this.fillStyle&&(t.fillStyle=this.fillStyle.get(t),t.fill()),null!==this.strokeStyle&&(t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeStyle.get(t),t.stroke())},du.prototype.serialize=function(t){var e=tu.prototype.serialize.call(this,t);return e.radius=this.radius,e.strokeStyle=null!==this.strokeStyle?this.strokeStyle.serialize():null,e.lineWidth=this.lineWidth,e.fillStyle=null!==this.fillStyle?this.fillStyle.serialize():null,e},du.prototype.parse=function(t,e){tu.prototype.parse.call(this,t,e),this.radius=t.radius,this.strokeStyle=null!==t.strokeStyle?uu.parse(t.strokeStyle):null,this.lineWidth=t.lineWidth,this.fillStyle=null!==t.fillStyle?uu.parse(t.fillStyle):null},fu.prototype=Object.create(tu.prototype),fu.prototype.constructor=fu,fu.prototype.type="Line",tu.register(fu,"Line"),fu.prototype.style=function(t,e,n){t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeStyle.get(t),t.setLineDash(this.dashPattern)},fu.prototype.draw=function(t,e,n){t.beginPath(),t.moveTo(this.from.x,this.from.y),t.lineTo(this.to.x,this.to.y),t.stroke()},fu.prototype.serialize=function(t){var e=tu.prototype.serialize.call(this,t);return e.from=this.from.toArray(),e.to=this.to.toArray(),e.dashPattern=this.dashPattern,e.strokeStyle=null!==this.strokeStyle?this.strokeStyle.serialize():null,e.lineWidth=this.lineWidth,e},fu.prototype.parse=function(t,e){tu.prototype.parse.call(this,t,e),this.to.fromArray(t.to),this.from.fromArray(t.from),this.dashPattern=t.dashPattern,this.strokeStyle=null!==t.strokeStyle?uu.parse(t.strokeStyle):null,this.lineWidth=t.lineWidth},mu.prototype=Object.create(tu.prototype),mu.prototype.constructor=mu,mu.prototype.type="Text",tu.register(mu,"Text"),mu.prototype.draw=function(t,e,n){t.font=this.font,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,null!==this.fillStyle&&(t.fillStyle=this.fillStyle.get(t),t.fillText(this.text,0,0)),null!==this.strokeStyle&&(t.strokeStyle=this.strokeStyle.get(t),t.strokeText(this.text,0,0))},mu.prototype.serialize=function(t){var e=tu.prototype.serialize.call(this,t);return e.text=this.text,e.font=this.font,e.strokeStyle=null!==this.strokeStyle?this.strokeStyle.serialize():null,e.lineWidth=this.lineWidth,e.fillStyle=null!==this.fillStyle?this.fillStyle.serialize():null,e.textAlign=this.textAlign,e.textBaseline=this.textBaseline,e},mu.prototype.parse=function(t,e){tu.prototype.parse.call(this,t,e),this.text=t.text,this.font=t.font,this.strokeStyle=null!==t.strokeStyle?Style.parse(t.strokeStyle):null,this.lineWidth=t.lineWidth,this.fillStyle=null!==t.fillStyle?Style.parse(t.fillStyle):null,this.textAlign=t.textAlign,this.textBaseline=t.textBaseline},_u.prototype=Object.create(tu.prototype),_u.prototype.constructor=_u,_u.prototype.type="Image",tu.register(_u,"Image"),_u.prototype.setImage=function(t){var e=this;this.image.onload=function(){e.box.min.set(0,0),e.box.max.set(this.naturalWidth,this.naturalHeight)},this.image.src=t},_u.prototype.isInside=function(t){return this.box.containsPoint(t)},_u.prototype.draw=function(t,e,n){this.image.src.length>0&&t.drawImage(this.image,0,0,this.image.naturalWidth,this.image.naturalHeight,this.box.min.x,this.box.min.y,this.box.max.x-this.box.min.x,this.box.max.y-this.box.min.y)},_u.prototype.serialize=function(t){var e=tu.prototype.serialize.call(this,t);return e.box=this.box.toArray(),e.image=this.image.src,e},_u.prototype.parse=function(t,e){tu.prototype.parse.call(this,t,e),this.box.fromArray(t.box),this.image.src=t.image},gu.prototype=Object.create(tu.prototype),gu.prototype.constructor=gu,gu.prototype.type="DOM",tu.register(gu,"DOM"),gu.prototype.onAdd=function(){null!==this.parentElement&&this.parentElement.appendChild(this.element)},gu.prototype.onRemove=function(){null!==this.parentElement&&this.parentElement.removeChild(this.element)},gu.prototype.transform=function(t,e,n,r){if(null===this.parentElement&&(this.parentElement=r.getDomContainer(),this.parentElement.appendChild(this.element)),this.ignoreViewport)this.element.style.transform=this.globalMatrix.cssTransform();else{var i=e.matrix.clone();i.multiply(this.globalMatrix),this.element.style.transform=i.cssTransform()}this.element.style.width=this.size.x+"px",this.element.style.height=this.size.y+"px",this.element.style.display=this.visible?"block":"none"},gu.prototype.serialize=function(t){var e=tu.prototype.serialize.call(this,t);return e.size=this.size.toArray(),e.element=this.element.outerHTML,e},gu.prototype.parse=function(t,e){tu.prototype.parse.call(this,t,e),this.size.fromArray(t.size);var n=(new DOMParser).parseFromString(this.element.outerHTML,"text/html");this.element=n.body.children[0]},yu.prototype=Object.create(tu.prototype),yu.prototype.constructor=yu,yu.prototype.type="Pattern",tu.register(yu,"Pattern"),yu.prototype.setImage=function(t){var e=this;this.image.onload=function(){e.box.min.set(0,0),e.box.max.set(this.naturalWidth,this.naturalHeight)},this.image.src=t},yu.prototype.isInside=function(t){return this.box.containsPoint(t)},yu.prototype.draw=function(t,e,n){var r=this.box.max.x-this.box.min.x,i=this.box.max.y-this.box.min.y;if(this.image.src.length>0){var s=t.createPattern(this.image,this.repetition);t.fillStyle=s,t.fillRect(this.box.min.x,this.box.min.y,r,i)}},yu.prototype.serialize=function(t){var e=tu.prototype.serialize.call(this,t);return e.box=this.box.toArray(),e.image=this.image.src,e.repetition=this.repetition,e},yu.prototype.parse=function(t,e){tu.prototype.parse.call(this,t,e),this.box.fromArray(t.box),this.image.src=t.image,this.repetition=t.repetition},vu.prototype=Object.create(mu.prototype),vu.prototype.constructor=vu,vu.prototype.type="MultiLineText",tu.register(vu,"MultiLineText"),vu.prototype.draw=function(t,e,n){t.font=this.font,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline;for(var r=this.lineHeight||Number.parseFloat(this.font),i=this.text.split("\n"),s=0,o=0;o<i.length;o++){var a=i[o],l=t.measureText(a),c=[];if(null!==this.maxWidth&&l.width>this.maxWidth)for(;a.length>0;){for(var u="",h=t.measureText(u+a[0]);h.width<this.maxWidth&&a.length>0;)u+=a[0],a=a.substr(1),h=t.measureText(u+a[0]);c.push(u)}else c=[a];for(var p=0;p<c.length;p++)null!==this.fillStyle&&(t.fillStyle=this.fillStyle.get(t),t.fillText(c[p],this.position.x,this.position.y+s)),null!==this.strokeStyle&&(t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeStyle.get(t),t.strokeText(c[p],this.position.x,this.position.y+s)),s+=r}},vu.prototype.serialize=function(t){var e=mu.prototype.serialize.call(this,t);return e.maxWidth=this.maxWidth,e.lineHeight=this.lineHeight,e},vu.prototype.parse=function(t,e){mu.prototype.parse.call(this,t,e),this.maxWidth=t.maxWidth,this.lineHeight=t.lineHeight},bu.prototype=Object.create(fu.prototype),bu.prototype.constructor=bu,bu.prototype.type="BezierCurve",tu.register(bu,"BezierCurve"),bu.curveHelper=function(t){var e=new du;e.radius=3,e.layer=t.layer+1,e.draggable=!0,e.onPointerDrag=function(n,r,i){tu.prototype.onPointerDrag.call(this,n,r,i),t.fromCp.copy(e.position)},t.parent.add(e);var n=new fu;n.from=t.from,n.to=t.fromCp,t.parent.add(n);var r=new du;r.radius=3,r.layer=t.layer+1,r.draggable=!0,r.onPointerDrag=function(e,n,i){tu.prototype.onPointerDrag.call(this,e,n,i),t.toCp.copy(r.position)},t.parent.add(r);var i=new fu;i.from=t.to,i.to=t.toCp,t.parent.add(i)},bu.prototype.draw=function(t,e,n){t.beginPath(),t.moveTo(this.from.x,this.from.y),t.bezierCurveTo(this.fromCp.x,this.fromCp.y,this.toCp.x,this.toCp.y,this.to.x,this.to.y),t.stroke()},bu.prototype.serialize=function(t){var e=fu.prototype.serialize.call(this,t);return e.fromCp=this.fromCp.toArray(),e.toCp=this.toCp.toArray(),e},bu.prototype.parse=function(t,e){fu.prototype.parse.call(this,t,e),this.fromCp.fromArray(t.fromCp),this.toCp.fromArray(t.toCp)},xu.prototype=Object.create(fu.prototype),xu.prototype.constructor=xu,xu.prototype.type="QuadraticCurve",tu.register(xu,"QuadraticCurve"),xu.curveHelper=function(t){var e=new fu;e.from=t.from,e.to=t.controlPoint,t.parent.add(e);var n=new du;n.radius=3,n.layer=t.layer+1,n.draggable=!0,n.position=t.controlPoint,n.onPointerDrag=function(e,r,i){tu.prototype.onPointerDrag.call(this,e,r,i),t.controlPoint.copy(n.position)},t.parent.add(n);var r=new fu;r.from=t.to,r.to=t.controlPoint,t.parent.add(r)},xu.prototype.draw=function(t,e,n){t.beginPath(),t.moveTo(this.from.x,this.from.y),t.quadraticCurveTo(this.controlPoint.x,this.controlPoint.y,this.to.x,this.to.y),t.stroke()},xu.prototype.serialize=function(t){var e=fu.prototype.serialize.call(this,t);return e.controlPoint=this.controlPoint.toArray(),e},xu.prototype.parse=function(t,e){fu.prototype.parse.call(this,t,e),this.controlPoint.fromArray(t.controlPoint)},wu.prototype=Object.create(pu.prototype),wu.prototype.constructor=wu,wu.prototype.type="RoundedBox",tu.register(wu,"RoundedBox"),wu.roundRect=function(t,e,n,r,i,s){t.beginPath(),t.moveTo(e+s,n),t.lineTo(e+r-s,n),t.quadraticCurveTo(e+r,n,e+r,n+s),t.lineTo(e+r,n+i-s),t.quadraticCurveTo(e+r,n+i,e+r-s,n+i),t.lineTo(e+s,n+i),t.quadraticCurveTo(e,n+i,e,n+i-s),t.lineTo(e,n+s),t.quadraticCurveTo(e,n,e+s,n),t.closePath()},wu.prototype.draw=function(t,e,n){var r=this.box.max.x-this.box.min.x,i=this.box.max.y-this.box.min.y;null!==this.fillStyle&&(t.fillStyle=this.fillStyle.get(t),wu.roundRect(t,this.box.min.x,this.box.min.y,r,i,this.radius),t.fill()),null!==this.strokeStyle&&(t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeStyle.get(t),wu.roundRect(t,this.box.min.x,this.box.min.y,r,i,this.radius),t.stroke())},wu.prototype.serialize=function(t){var e=pu.prototype.serialize.call(this,t);return e.radius=this.radius,e},wu.prototype.parse=function(t,e){pu.prototype.parse.call(this,t,e),this.radius=t.radius},Su.prototype=Object.create(tu.prototype),Su.prototype.constructor=Su,Su.prototype.type="Graph",tu.register(Su,"Graph"),Su.prototype.isInside=function(t){return this.box.containsPoint(t)},Su.prototype.draw=function(t,e,n){if(0!==this.data.length){var r=this.box.max.x-this.box.min.x,i=this.box.max.y-this.box.min.y;t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeStyle.get(t),t.beginPath();var s=r/(this.data.length-1),o=this.max-this.min;t.moveTo(this.box.min.x,this.box.max.y-(this.data[0]-this.min)/o*i);for(var a=1,l=s;a<this.data.length;l+=s,a++)t.lineTo(this.box.min.x+l,this.box.max.y-(this.data[a]-this.min)/o*i);t.stroke(),null!==this.fillStyle&&(t.fillStyle=this.fillStyle.get(t),t.lineTo(this.box.max.x,this.box.max.y),t.lineTo(this.box.min.x,this.box.max.y),t.fill())}},Su.prototype.serialize=function(t){var e=tu.prototype.serialize.call(this,t);return e.box=this.box.toArray(),e.strokeStyle=null!==this.strokeStyle?this.strokeStyle.serialize():null,e.lineWidth=this.lineWidth,e.fillStyle=null!==this.fillStyle?this.fillStyle.serialize():null,e.min=this.min,e.max=this.max,e.data=this.data,e},Su.prototype.parse=function(t,e){tu.prototype.parse.call(this,t,e),this.box.fromArray(t.box),this.strokeStyle=null!==t.strokeStyle?Style.parse(t.strokeStyle):null,this.lineWidth=t.lineWidth,this.fillStyle=null!==t.fillStyle?Style.parse(t.fillStyle):null,this.min=t.min,this.max=t.max,this.data=t.data},Tu.prototype=Object.create(uu.prototype),Tu.prototype.addColorStop=function(t,e){this.colors.push(new Mu(t,e))},Tu.prototype.serialize=function(){return{colors:this.colors}},Tu.prototype.parse=function(t){for(var e=[],n=0;n<t.colors.length;n++)e.push(new Mu(t.colors[n].offset,t.colors[n].color));this.colors=e},Eu.prototype=Object.create(Tu.prototype),uu.register(Eu,"LinearGradient"),Eu.prototype.get=function(t){for(var e=t.createLinearGradient(this.start.x,this.start.y,this.end.x,this.end.y),n=0;n<this.colors.length;n++)e.addColorStop(this.colors[n].offset,this.colors[n].color);return e},Eu.prototype.serialize=function(){var t=Tu.prototype.serialize.call(this);return Object.assign(t,{type:"LinearGradient",start:this.start.toArray(),end:this.end.toArray()}),t},Eu.prototype.parse=function(t){Tu.prototype.parse.call(this,t),this.start.fromArray(t.start),this.end.fromArray(t.end)},Au.prototype=Object.create(tu.prototype),Au.prototype.constructor=Au,Au.prototype.type="Gauge",tu.register(Au,"Gauge"),Au.prototype.isInside=function(t){return t.length()<=this.radius},Au.prototype.draw=function(t,e,n){var r=this.value/(this.max-this.min),i=[this.startAngle,this.endAngle],s=i[0]+(i[1]-i[0])*r,o=[0,0];t.lineWidth=this.lineWidth,t.lineCap="round",t.strokeStyle=this.baseStyle.get(t),t.beginPath(),t.arc(o[0],o[1],this.radius,i[0],i[1]),t.stroke();var a=t.createLinearGradient(-this.radius,0,this.radius,0);if(t.strokeStyle=this.barStyle.get(t),t.lineWidth=this.lineWidth,t.beginPath(),t.arc(o[0],o[1],this.radius,i[0],s),t.stroke(),this.dial){var l=(this.startAngle-this.endAngle)*r,c=[Math.cos(l)*this.radius,Math.sin(l)*this.radius];c[0]=c[0]-o[0],c[1]=c[1]-o[1],t.fillStyle="#FFFFFF",t.beginPath(),t.arc(c[0],c[1],this.lineWidth/2,0,2*Math.PI),t.fill(),t.fillStyle=a,t.beginPath(),t.arc(c[0],c[1],this.lineWidth/3,0,2*Math.PI),t.fill()}},Au.prototype.serialize=function(t){return tu.prototype.serialize.call(this,t)},Au.prototype.parse=function(t,e){tu.prototype.parse.call(this,t,e)},$u.prototype=Object.create(uu.prototype),uu.register($u,"Pattern"),$u.prototype.setTransform=function(t){this.matrix.m=t,this.needsUpdate=!0},$u.prototype.get=function(t){return(this.needsUpdate||null===this.cache)&&(this.cache=t.createPattern(this.source,this.repetition),this.cache.setTransform(this.matrix.cssTransform()),this.needsUpdate=!1),this.cache},$u.prototype.serialize=function(){var t=Tu.prototype.serialize.call(this);return Object.assign(t,{type:"Pattern",matrix:this.matrix.m,repetition:this.repetition,source:this.source}),t},$u.prototype.parse=function(t){Tu.prototype.parse.call(this,t),this.matrix=new Qc(t.matrix),this.repetition=t.repetition,this.source=t.source},Cu.prototype=Object.create(Tu.prototype),uu.register(Cu,"RadialGradient"),Cu.prototype.get=function(t){for(var e=t.createRadialGradient(this.start.x,this.start.y,this.startRadius,this.end.x,this.end.y,this.endRadius),n=0;n<this.colors.length;n++)e.addColorStop(this.colors[n].offset,this.colors[n].color);return e},Cu.prototype.serialize=function(){var t=Tu.prototype.serialize.call(this);return Object.assign(t,{type:"RadialGradient",start:this.start.toArray(),end:this.end.toArray(),startRadius:this.startRadius,endRadius:this.endRadius}),t},Cu.prototype.parse=function(t){Tu.prototype.parse.call(this,t),this.start.fromArray(t.start),this.end.fromArray(t.end),this.startRadius=t.startRadius,this.endRadius=t.endRadius},Bu.prototype=Object.create(tu.prototype),Bu.prototype.constructor=Bu,Bu.prototype.type="NodeGraph",tu.register(Bu,"NodeGraph"),Bu.prototype.addNode=function(t){for(var e=0,n=0,r=0;r<this.children.length;r++)this.children[r].position.x>e&&(e=this.children[r].position.x),this.children[r].position.y>n&&(n=this.children[r].position.y);return t.position.set(e+200,n/2),this.add(t),null!==t.registerSockets&&t.registerSockets(),t},Lu.prototype=Object.create(bu.prototype),Lu.prototype.constructor=Lu,Lu.prototype.type="NodeConnector",tu.register(Lu,"NodeConnector"),Lu.prototype.destroy=function(){bu.prototype.destroy.call(this),null!==this.outputSocket&&(this.outputSocket.removeConnector(this),this.outputSocket=null),null!==this.inputSocket&&(this.inputSocket.removeConnector(this),this.inputSocket=null)},Lu.prototype.onUpdate=function(){null!==this.outputSocket&&this.from.copy(this.outputSocket.position),null!==this.inputSocket&&this.to.copy(this.inputSocket.position),this.fromCp.copy(this.from),this.fromCp.add(this.to),this.fromCp.multiplyScalar(.5),this.toCp.copy(this.fromCp);var t=.5,e=this.to.y-this.from.y,n=this.to.x-this.from.x;Math.abs(n)>Math.abs(e)?(this.toCp.x+=n*t,this.fromCp.x-=n*t):(this.toCp.y+=e*t,this.fromCp.y-=e*t)},Lu.prototype.serialize=function(t){var e=bu.prototype.serialize.call(this,t);return e.outputSocket=null!==this.outputSocket?this.outputSocket.uuid:null,e.inputSocket=null!==this.inputSocket?this.inputSocket.uuid:null,e},Lu.prototype.parse=function(t,e){bu.prototype.parse.call(this,t,e),null!==t.outputSocket&&(this.outputSocket=e.getChildByUUID(t.outputSocket)),null!==t.inputSocket&&(this.inputSocket=e.getChildByUUID(t.inputSocket))},Ru.prototype=Object.create(du.prototype),Ru.prototype.constructor=Ru,Ru.prototype.type="NodeSocket",tu.register(Ru,"NodeSocket"),Ru.INPUT=1,Ru.OUTPUT=2,Ru.prototype.getValue=function(){return this.direction===Ru.INPUT&&this.connectors.length>0&&null!==this.connectors[0].outputSocket?this.connectors[0].outputSocket.getValue():null},Ru.prototype.connectTo=function(t){if(!this.isCompatible(t))throw new Error("Sockets are not compatible they cannot be connected.");var e=new Lu;return this.attachConnector(e),t.attachConnector(e),e},Ru.prototype.attachConnector=function(t){this.canAddConnector()||this.destroyConnectors(),this.direction===Ru.INPUT?t.inputSocket=this:this.direction===Ru.OUTPUT&&(t.outputSocket=this),this.connectors.push(t),null===t.parent&&this.parent.add(t)},Ru.prototype.isCompatible=function(t){return this.direction!==t.direction&&this.category===t.category},Ru.prototype.canAddConnector=function(){return!(this.connectors.length>0&&(this.direction===Ru.INPUT||this.direction===Ru.OUTPUT&&!this.multiple))},Ru.prototype.canConnect=function(t){return this.isCompatible(t)&&this.canAddConnector()},Ru.prototype.removeConnector=function(t){var e=this.connectors.indexOf(t);-1!==e&&(this.connectors.splice(e,1),t.destroy())},Ru.prototype.destroyConnectors=function(){for(var t=0;t<this.connectors.length;t++)this.connectors[t].destroy()},Ru.prototype.destroy=function(){du.prototype.destroy.call(this),this.destroyConnectors()},Ru.prototype.onPointerDragStart=function(t,e){this.creatingConnection=!0,this.attachConnector(new Lu)},Ru.prototype.onPointerDrag=function(t,e,n,r){this.creatingConnection&&(this.direction===Ru.INPUT?this.connectors[this.connectors.length-1].from.copy(r):this.direction===Ru.OUTPUT&&this.connectors[this.connectors.length-1].to.copy(r))},Ru.prototype.onPointerDragEnd=function(t,e){if(this.creatingConnection){for(var n=e.inverseMatrix.transformPoint(t.position),r=this.parent.getWorldPointIntersections(n),i=!1,s=0;s<r.length;s++)if(r[s]instanceof Ru&&this.isCompatible(r[s])){r[s].attachConnector(this.connectors[this.connectors.length-1]),i=!0;break}i||this.connectors[this.connectors.length-1].destroy()}this.creatingConnection=!1},Ru.prototype.serialize=function(t){var e=du.prototype.serialize.call(this,t);e.name=this.name,e.category=this.category,e.multiple=this.multiple,e.direction=this.direction,e.node=this.node.uuid,e.connectors=[];for(var n=0;n<this.connectors.length;n++)e.connectors.push(this.connectors[n].uuid);return e},Ru.prototype.parse=function(t,e){du.prototype.parse.call(this,t,e),this.name=t.name,this.category=t.category,this.multiple=t.multiple,this.direction=t.direction,this.node=e.getChildByUUID(t.node);for(var n=0;n<t.connectors.length;n++)this.connectors.push(e.getChildByUUID(t.connectors[n]))},Nu.prototype=Object.create(wu.prototype),Nu.prototype.constructor=Nu,Nu.prototype.type="Node",tu.register(Nu,"Node"),Nu.prototype.registerSockets=null,Nu.prototype.addInput=function(t,e){var n=new Ru(this,Ru.INPUT,t,e);return this.inputs.push(n),this.parent.add(n),n},Nu.prototype.addOutput=function(t,e){var n=new Ru(this,Ru.OUTPUT,t,e);return this.outputs.push(n),this.parent.add(n),n},Nu.prototype.getOutput=function(t){for(var e=0;e<this.outputs.length;e++)if(this.outputs[e].name===t)return this.outputs[e];return null},Nu.prototype.getInput=function(t){for(var e=0;e<this.inputs.length;e++)if(this.inputs[e].name===t)return this.inputs[e];return null},Nu.prototype.destroy=function(){wu.prototype.destroy.call(this);for(var t=0;t<this.inputs.length;t++)this.inputs[t].destroy();for(t=0;t<this.outputs.length;t++)this.outputs[t].destroy()},Nu.prototype.onUpdate=function(){for(var t=this.box.max.y-this.box.min.y,e=t/(this.inputs.length+1),n=this.box.min.y+e,r=0;r<this.inputs.length;r++)this.inputs[r].position.set(this.position.x+this.box.min.x,this.position.y+(n+e*r));for(e=t/(this.outputs.length+1),n=this.box.min.y+e,r=0;r<this.outputs.length;r++)this.outputs[r].position.set(this.position.x+this.box.max.x,this.position.y+(n+e*r))},Nu.prototype.serialize=function(t){var e=wu.prototype.serialize.call(this,t);e.inputs=[];for(var n=0;n<this.inputs.length;n++)e.inputs.push(this.inputs[n].uuid);for(e.outputs=[],n=0;n<this.outputs.length;n++)e.outputs.push(this.outputs[n].uuid);return e},Nu.prototype.parse=function(t,e){wu.prototype.parse.call(this,t,e);for(var n=0;n<t.inputs.length;n++)this.inputs.push(e.getChildByUUID(t.inputs[n]));for(n=0;n<t.outputs.length;n++)this.outputs.push(e.getChildByUUID(t.outputs[n]))},Pu.rotateTool=function(t){var e=new du;e.radius=4,e.layer=t.layer+1,e.onPointerDrag=function(e,n,r){t.rotation+=.001*r.x},t.add(e)},Pu.boxResizeTool=function(t){if(void 0!==t.box){var e=new du;e.radius=4,e.layer=t.layer+1,e.draggable=!0,e.onPointerDrag=function(n,r,i){tu.prototype.onPointerDrag.call(this,n,r,i),t.box.min.copy(e.position),s()},t.add(e);var n=new du;n.radius=4,n.layer=t.layer+1,n.draggable=!0,n.onPointerDrag=function(e,r,i){tu.prototype.onPointerDrag.call(this,e,r,i),t.box.max.x=n.position.x,t.box.min.y=n.position.y,s()},t.add(n);var r=new du;r.radius=4,r.layer=t.layer+1,r.draggable=!0,r.onPointerDrag=function(e,n,i){tu.prototype.onPointerDrag.call(this,e,n,i),t.box.max.copy(r.position),s()},t.add(r);var i=new du;i.radius=4,i.layer=t.layer+1,i.draggable=!0,i.onPointerDrag=function(e,n,r){tu.prototype.onPointerDrag.call(this,e,n,r),t.box.min.x=i.position.x,t.box.max.y=i.position.y,s()},t.add(i),s()}else console.warn("escher.js: Helpers.boxResizeTool(), object box property missing.");function s(){e.position.copy(t.box.min),r.position.copy(t.box.max),n.position.set(t.box.max.x,t.box.min.y),i.position.set(t.box.min.x,t.box.max.y)}},Iu.read=function(t,e,n){var r=new XMLHttpRequest;r.overrideMimeType("text/plain"),r.open("GET",t,!0),void 0!==e&&(r.onload=function(){e(r.response)}),void 0!==n&&(r.onerror=n),r.send(null)},Iu.write=function(t,e){var n=new Blob([e],{type:"octet/stream"}),r=document.createElement("a");r.download=t,r.href=window.URL.createObjectURL(n),r.style.display="none",r.onclick=function(){document.body.removeChild(this)},document.body.appendChild(r),r.click()},Iu.select=function(t,e){var n=document.createElement("input");n.type="file",n.style.display="none",document.body.appendChild(n),void 0!==e&&(n.accept=e),n.onchange=function(e){void 0!==t&&t(n.files),document.body.removeChild(n)},n.click()},Ou.prototype=Object.create(n.Group.prototype),Ou.prototype.addNode=function(t){this.graph.addNode(t)},Ou.prototype.initialize=function(){n.Object3D.prototype.initialize.call(this)},Ou.prototype.update=function(t){n.Object3D.prototype.update.call(this,t)},Ou.prototype.dispose=function(){n.Object3D.prototype.dispose.call(this)},Ou.prototype.resize=function(t,e){},Ou.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return e.object.graph=this.graph.serialize(),e},ku.prototype.createWorkers=function(){for(var t=0;t<this.workers.length;t++)this.workers[t].terminate();var e=this;function n(t){var n=t.data.uuid;if(void 0===e.tasks[n])throw new Error("Unknown worker task "+n);e.tasks[n].callback(t.data.data),delete e.tasks[n]}for(this.workers=[],this.next=0,t=0;t<this.size;t++){var r=new Worker(this.file);r.onmessage=n,this.workers.push(r)}},ku.prototype.runTask=function(t,e){var n=new Fu(t,e);this.tasks[n.uuid]=n,this.workers[this.next].postMessage({data:n.data,uuid:n.uuid}),this.next++,this.next>=this.workers.length&&(this.next=0)},Du.prototype.start=function(){if(!this.running){this.running=!0;var t=this;!function e(){t.callback(),t.running&&(t.id=setTimeout(e,t.time))}()}},Du.prototype.stop=function(){this.running=!1,clearTimeout(self.id)},Uu.prototype.start=function(){if(!this.running){this.running=!0;var t=this;!function e(){t.callback(),t.running&&(t.id=requestAnimationFrame(e))}()}},Uu.prototype.stop=function(){this.running=!1,cancelAnimationFrame(this.id)},zu.set=function(t,e){"object"==typeof e?window.localStorage.setItem(t,JSON.stringify(e)):window.localStorage.setItem(t,e)},zu.get=function(t){var e=window.localStorage.getItem(t);try{return JSON.parse(e)}catch(t){return e}},zu.exists=function(t){return null!==window.localStorage.getItem(t)},zu.delete=function(t){return window.localStorage.removeItem(t)},ju.getRoot=function(t){for(var e=t;null!==e.parent;)e=e.parent;return e},ju.centerUnitary=function(t){var e=ju.calculateBoundingBox(t);if(null!==e){var r=new n.Vector3;e.getSize(r);var i=1/(r.x>r.y?r.x>r.z?r.x:r.z:r.y>r.z?r.y:r.z),s=new n.Vector3;e.getCenter(s),s.multiplyScalar(i),t.scale.set(i,i,i),t.position.set(-s.x,-i*e.min.y,-s.z)}},ju.calculateBoundingBox=function(t){var e=null;return t.traverse((function(t){var r=null;if(!0===t.isSprite){var i=new n.Vector3;t.getWorldPosition(i),r=new n.Box3(i.clone().subScalar(.5),i.clone().addScalar(.5))}else void 0!==t.geometry&&(t.geometry.computeBoundingBox(),(r=t.geometry.boundingBox.clone()).applyMatrix4(t.matrixWorld),t.geometry.computeBoundingBox(),r=t.geometry.boundingBox);null!==r&&(null===e?e=r:(r.min.x<e.min.x&&(e.min.x=r.min.x),r.max.x>e.max.x&&(e.max.x=r.max.x),r.min.y<e.min.y&&(e.min.y=r.min.y),r.max.y>e.max.y&&(e.max.y=r.max.y),r.min.z<e.min.z&&(e.min.z=r.min.z),r.max.z>e.max.z&&(e.max.z=r.max.z)))})),e},ju.centerGeometryOrigin=function(t){t.traverse((function(t){if(void 0!==t.geometry){t.geometry.computeBoundingBox();var e=t.geometry.boundingBox.clone().getCenter(new n.Vector3);t.position.add(e);var r=new n.Matrix4;r.makeTranslation(-e.x,-e.y,-e.z),t.geometry.applyMatrix4(r)}}))},ju.convertToBufferGeometry=function(t){t.traverse((function(t){void 0!==t.geometry&&!0===t.geometry.isGeometry&&(t.geometry=(new n.BufferGeometry).fromGeometry(t.geometry))}))};var Gu=function(){var t,e,r,i,s=0,o=new n.Vector3;function a(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new h,this.unassigned=new h,this.vertices=[]}function l(){this.normal=new n.Vector3,this.midpoint=new n.Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=s,this.edge=null}function c(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}function u(t){this.point=t,this.prev=null,this.next=null,this.face=null}function h(){this.head=null,this.tail=null}return Object.assign(a.prototype,{setFromPoints:function(t){!0!==Array.isArray(t)&&console.error("THREE.ConvexHull: Points parameter is not an array."),t.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.vertices.push(new u(t[e]));return this.compute(),this},setFromObject:function(t){var e=[];return t.updateMatrixWorld(!0),t.traverse((function(t){var r,i,s,o=t.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(r=0,i=a.length;r<i;r++)(s=a[r].clone()).applyMatrix4(t.matrixWorld),e.push(s)}else if(o.isBufferGeometry){var l=o.attributes.position;if(void 0!==l)for(r=0,i=l.count;r<i;r++)(s=new n.Vector3).fromBufferAttribute(l,r).applyMatrix4(t.matrixWorld),e.push(s)}})),this.setFromPoints(e)},containsPoint:function(t){for(var e=this.faces,n=0,r=e.length;n<r;n++)if(e[n].distanceToPoint(t)>this.tolerance)return!1;return!0},intersectRay:function(t,e){for(var n=this.faces,r=-1/0,i=1/0,s=0,o=n.length;s<o;s++){var a=n[s],l=a.distanceToPoint(t.origin),c=a.normal.dot(t.direction);if(l>0&&c>=0)return null;var u=0!==c?-l/c:0;if(!(u<=0)&&(c>0?i=Math.min(u,i):r=Math.max(u,r),r>i))return null}return r!==-1/0?t.at(r,e):t.at(i,e),e},intersectsRay:function(t){return null!==this.intersectRay(t,o)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(t,e){return t.face=e,null===e.outside?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this},removeVertexFromFace:function(t,e){return t===e.outside&&(null!==t.next&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this},removeAllVerticesFromFace:function(t){if(null!==t.outside){for(var e=t.outside,n=t.outside;null!==n.next&&n.next.face===t;)n=n.next;return this.assigned.removeSubList(e,n),e.prev=n.next=null,t.outside=null,e}},deleteFaceVertices:function(t,e){var n=this.removeAllVerticesFromFace(t);if(void 0!==n)if(void 0===e)this.unassigned.appendChain(n);else{var r=n;do{var i=r.next;e.distanceToPoint(r.point)>this.tolerance?this.addVertexToFace(r,e):this.unassigned.append(r),r=i}while(null!==r)}return this},resolveUnassignedPoints:function(t){if(!1===this.unassigned.isEmpty()){var e=this.unassigned.first();do{for(var n=e.next,r=this.tolerance,i=null,o=0;o<t.length;o++){var a=t[o];if(a.mark===s){var l=a.distanceToPoint(e.point);if(l>r&&(r=l,i=a),r>1e3*this.tolerance)break}}null!==i&&this.addVertexToFace(e,i),e=n}while(null!==e)}return this},computeExtremes:function(){var t,e,r,i=new n.Vector3,s=new n.Vector3,o=[],a=[];for(t=0;t<3;t++)o[t]=a[t]=this.vertices[0];for(i.copy(this.vertices[0].point),s.copy(this.vertices[0].point),t=0,e=this.vertices.length;t<e;t++){var l=this.vertices[t],c=l.point;for(r=0;r<3;r++)c.getComponent(r)<i.getComponent(r)&&(i.setComponent(r,c.getComponent(r)),o[r]=l);for(r=0;r<3;r++)c.getComponent(r)>s.getComponent(r)&&(s.setComponent(r,c.getComponent(r)),a[r]=l)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(i.x),Math.abs(s.x))+Math.max(Math.abs(i.y),Math.abs(s.y))+Math.max(Math.abs(i.z),Math.abs(s.z))),{min:o,max:a}},computeInitialHull:function(){void 0===t&&(t=new n.Line3,e=new n.Plane,r=new n.Vector3);var i,s,o,a,c,u,h,p,d,f=this.vertices,m=this.computeExtremes(),_=m.min,g=m.max,y=0,v=0;for(u=0;u<3;u++)(d=g[u].point.getComponent(u)-_[u].point.getComponent(u))>y&&(y=d,v=u);for(s=_[v],o=g[v],y=0,t.set(s.point,o.point),u=0,h=this.vertices.length;u<h;u++)(i=f[u])!==s&&i!==o&&(t.closestPointToPoint(i.point,!0,r),(d=r.distanceToSquared(i.point))>y&&(y=d,a=i));for(y=-1,e.setFromCoplanarPoints(s.point,o.point,a.point),u=0,h=this.vertices.length;u<h;u++)(i=f[u])!==s&&i!==o&&i!==a&&(d=Math.abs(e.distanceToPoint(i.point)))>y&&(y=d,c=i);var b=[];if(e.distanceToPoint(c.point)<0)for(b.push(l.create(s,o,a),l.create(c,o,s),l.create(c,a,o),l.create(c,s,a)),u=0;u<3;u++)p=(u+1)%3,b[u+1].getEdge(2).setTwin(b[0].getEdge(p)),b[u+1].getEdge(1).setTwin(b[p+1].getEdge(0));else for(b.push(l.create(s,a,o),l.create(c,s,o),l.create(c,o,a),l.create(c,a,s)),u=0;u<3;u++)p=(u+1)%3,b[u+1].getEdge(2).setTwin(b[0].getEdge((3-u)%3)),b[u+1].getEdge(0).setTwin(b[p+1].getEdge(1));for(u=0;u<4;u++)this.faces.push(b[u]);for(u=0,h=f.length;u<h;u++)if((i=f[u])!==s&&i!==o&&i!==a&&i!==c){y=this.tolerance;var x=null;for(p=0;p<4;p++)(d=this.faces[p].distanceToPoint(i.point))>y&&(y=d,x=this.faces[p]);null!==x&&this.addVertexToFace(i,x)}return this},reindexFaces:function(){for(var t=[],e=0;e<this.faces.length;e++){var n=this.faces[e];n.mark===s&&t.push(n)}return this.faces=t,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var t,e=0,n=this.assigned.first().face,r=n.outside;do{var i=n.distanceToPoint(r.point);i>e&&(e=i,t=r),r=r.next}while(null!==r&&r.face===n);return t}},computeHorizon:function(t,e,n,r){var i;this.deleteFaceVertices(n),n.mark=1,i=null===e?e=n.getEdge(0):e.next;do{var o=i.twin,a=o.face;a.mark===s&&(a.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,o,a,r):r.push(i)),i=i.next}while(i!==e);return this},addAdjoiningFace:function(t,e){var n=l.create(t,e.tail(),e.head());return this.faces.push(n),n.getEdge(-1).setTwin(e.twin),n.getEdge(0)},addNewFaces:function(t,e){this.newFaces=[];for(var n=null,r=null,i=0;i<e.length;i++){var s=e[i],o=this.addAdjoiningFace(t,s);null===n?n=o:o.next.setTwin(r),this.newFaces.push(o.face),r=o}return n.next.setTwin(r),this},addVertexToHull:function(t){var e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var t;for(this.computeInitialHull();void 0!==(t=this.nextVertexToAdd());)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(l,{create:function(t,e,n){var r=new l,i=new c(t,r),s=new c(e,r),o=new c(n,r);return i.next=o.prev=s,s.next=i.prev=o,o.next=s.prev=i,r.edge=i,r.compute()}}),Object.assign(l.prototype,{getEdge:function(t){for(var e=this.edge;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e},compute:function(){void 0===i&&(i=new n.Triangle);var t=this.edge.tail(),e=this.edge.head(),r=this.edge.next.head();return i.set(t.point,e.point,r.point),i.getNormal(this.normal),i.getMidpoint(this.midpoint),this.area=i.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(t){return this.normal.dot(t)-this.constant}}),Object.assign(c.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceTo(t.point):-1},lengthSquared:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceToSquared(t.point):-1},setTwin:function(t){return this.twin=t,t.twin=this,this}}),Object.assign(h.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(t,e){return e.prev=t.prev,e.next=t,null===e.prev?this.head=e:e.prev.next=e,t.prev=e,this},insertAfter:function(t,e){return e.prev=t,e.next=t.next,null===e.next?this.tail=e:e.next.prev=e,t.next=e,this},append:function(t){return null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this},appendChain:function(t){for(null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail;null!==t.next;)t=t.next;return this.tail=t,this},remove:function(t){return null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this},removeSubList:function(t,e){return null===t.prev?this.head=e.next:t.prev.next=e.next,null===e.next?this.tail=t.prev:e.next.prev=t.prev,this},isEmpty:function(){return null===this.head}}),a}();function Hu(){}function Vu(){}Hu.Type={BOX:"Box",CYLINDER:"Cylinder",SPHERE:"Sphere",HULL:"ConvexPolyhedron"},Hu.createShape=function(t,e){if(void 0!==e)return e===Hu.Type.BOX?Hu.createBoundingBoxShape(t):e===Hu.Type.CYLINDER?Hu.createBoundingCylinderShape(t):e===Hu.Type.SPHERE?Hu.createBoundingSphereShape(t):e===Hu.Type.HULL?Hu.createConvexPolyhedron(t):null;var n=Hu.getGeometry(t);if(!n)return null;switch(n.type){case"BoxGeometry":case"BoxBufferGeometry":default:return Hu.createBoxShape(n);case"CylinderGeometry":case"CylinderBufferGeometry":return Hu.createCylinderShape(n);case"PlaneGeometry":case"PlaneBufferGeometry":return Hu.createPlaneShape(n);case"SphereGeometry":case"SphereBufferGeometry":return Hu.createSphereShape(n);case"TubeGeometry":return Hu.createTubeShape(n);case"Geometry":case"BufferGeometry":return Hu.createConvexPolyhedron(t)}},Hu.createBoxShape=function(t){if(!Hu.getVertices(t).length)return null;t.computeBoundingBox();var e=t.boundingBox;return new E(new a((e.max.x-e.min.x)/2,(e.max.y-e.min.y)/2,(e.max.z-e.min.z)/2))},Hu.createBoundingBoxShape=function(t){var e=new Box3;if(e.setFromObject(t),!isFinite(e.min.lengthSq()))return null;var r=new E(new a((e.max.x-e.min.x)/2,(e.max.y-e.min.y)/2,(e.max.z-e.min.z)/2));return t.updateMatrixWorld(),(new n.Vector3).setFromMatrixPosition(t.matrixWorld),r},Hu.createConvexPolyhedron=function(t){var e=new Gu;e.setFromObject(t);for(var n=[],r=[],i=[],s=0;s<e.faces.length;s++){var o=e.faces[s],l=o.edge;do{var c=l.head().point;n.push(new a(c.x,c.y,c.z)),l=l.next}while(l!==o.edge);r.push([n.length-3,n.length-2,n.length-1]),i.push(new a(o.normal.x,o.normal.y,o.normal.z))}return new S(n,r,i)},Hu.createCylinderShape=function(t){var e=t.parameters,n=new fn(e.radiusTop,e.radiusBottom,e.height,e.radialSegments);return n.orientation=new _,n.orientation.setFromEuler(0,0,0,"XYZ").normalize(),n},Hu.createBoundingCylinderShape=function(t){var e=["x","y","z"],n=e.splice(e.indexOf("y"),1)&&e,r=Hu.getGeometry(t);r.computeBoundingBox(),r.computeBoundingSphere();var i=r.boundingBox.max.y-r.boundingBox.min.y,s=.5*Math.max(r.boundingBox.max[n[0]]-r.boundingBox.min[n[0]],r.boundingBox.max[n[1]]-r.boundingBox.min[n[1]]),o=new fn(s,s,i,12);return o.orientation=new _,o.orientation.setFromEuler(Math.PI/2,0,0,"XYZ").normalize(),o},Hu.createPlaneShape=function(t){t.computeBoundingBox();var e=t.boundingBox;return new E(new a((e.max.x-e.min.x)/2,(e.max.y-e.min.y)/2,(e.max.z-e.min.z)/2))},Hu.createSphereShape=function(t){return new en(t.parameters.radius)},Hu.createBoundingSphereShape=function(t){var e=Hu.getGeometry(t);return e.computeBoundingSphere(),new en(e.boundingSphere.radius)},Hu.createTubeShape=function(t){var e=new n.BufferGeometry;return e.fromGeometry(t),createTrimeshShape(e)},Hu.createTrimeshShape=function(t){var e=Hu.getVertices(t);if(!e||0===e.length)return null;var n=Object.keys(e).map(Number);return new Nn(e,n)},Hu.getGeometry=function(t){var e=Hu.getMeshes(t);if(0===e.length)return null;var r=new n.Geometry;if(1===e.length){var i=new n.Vector3,s=new n.Quaternion,o=new n.Vector3(1,1,1);return r=e[0].geometry.clone(),e[0].updateMatrixWorld(),e[0].matrixWorld.decompose(i,s,o),r.scale(o.x,o.y,o.z)}for(var a=new n.Geometry,l=e.pop();void 0!==l;)l.updateMatrixWorld(),l.geometry instanceof n.BufferGeometry?(r.fromBufferGeometry(l.geometry),a.merge(r,l.matrixWorld)):a.merge(l.geometry,l.matrixWorld),l=e.pop();var c=new n.Matrix4;return c.scale(t.scale),a.applyMatrix4(c),a},Hu.getVertices=function(t){return t instanceof n.Geometry&&(t=(new n.BufferGeometry).fromGeometry(t)),t.attributes.position.array},Hu.getMeshes=function(t){var e=[];return t.traverse((function(t){t instanceof n.Mesh&&e.push(t)})),e},Vu.scales=new Map([["Y",1e24],["Z",1e21],["E",1e18],["P",1e15],["T",1e12],["G",1e9],["M",1e6],["k",1e3],["m",.001],["u",1e-6],["n",1e-9],["p",1e-12],["f",1e-15],["a",1e-18],["z",1e-21],["y",1e-24]]),Vu.units=new Map([["m",new Map([["i",function(t){return t/39.3701}]])],["i",new Map([["m",function(t){return 39.3701*t}]])],["g",null],["s",null],["c",new Map([["k",function(t){return t-273.15}],["f",function(t){return(t-32)/1.8}]])],["k",new Map([["c",function(t){return t+273.15}],["f",function(t){return(t-32)/1.8+273.15}]])],["f",new Map([["c",function(t){return 1.8*t+32}],["k",function(t){return 1.8*t-459.67}]])],["d",new Map([["r",function(t){return t*(180/Math.PI)}]])],["r",new Map([["d",function(t){return t/(180/Math.PI)}]])]]),Vu.convert=function(t,e,n){e.length>1&&(t*=Vu.scales.get(e.charAt(0)),e=e.slice(1));var r=1;return n.length>1&&(r=Vu.scales.get(n.charAt(0)),n=n.slice(1)),e===n?t/r:Vu.units.get(n).get(e)(t)/r}})(),__webpack_exports__})()));